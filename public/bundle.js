function debounce(t,e){var n=null;return function(){var i=this,o=arguments;clearTimeout(n),n=setTimeout(function(){t.apply(i,o)},e)}}function dataURItoBlob(t){for(var e=atob(t.split(",")[1]),n=t.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(e.length),o=new Uint8Array(i),r=0;r<e.length;r++)o[r]=e.charCodeAt(r);try{return new Blob([i],{type:n})}catch(s){var a=window.WebKitBlobBuilder||window.MozBlobBuilder,u=new a;return u.append(i),u.getBlob(n)}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e));
}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defaults(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}!function t(e,n,i){function o(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return o(n?n:t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){(function(e){"use strict";function n(t,e,n){t[e]||i(t,e,{writable:!0,configurable:!0,value:n})}var i=t(3)["default"];if(t(284),t(2),t(6),e._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");e._babelPolyfill=!0,n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2,284:284,3:3,6:6}],2:[function(t,e,n){e.exports=t(285)},{285:285}],3:[function(t,e,n){e.exports={"default":t(4),__esModule:!0}},{4:4}],4:[function(t,e,n){var i=t(5);e.exports=function(t,e,n){return i.setDesc(t,e,n)}},{5:5}],5:[function(t,e,n){var i=Object;e.exports={create:i.create,getProto:i.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:i.getOwnPropertyDescriptor,setDesc:i.defineProperty,setDescs:i.defineProperties,getKeys:i.keys,getNames:i.getOwnPropertyNames,getSymbols:i.getOwnPropertySymbols,each:[].forEach}},{}],6:[function(t,e,n){t(118),e.exports=t(26).RegExp.escape},{118:118,26:26}],7:[function(t,e,n){e.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},{}],8:[function(t,e,n){var i=t(21);e.exports=function(t,e){if("number"!=typeof t&&"Number"!=i(t))throw TypeError(e);return+t}},{21:21}],9:[function(t,e,n){var i=t(115)("unscopables"),o=Array.prototype;void 0==o[i]&&t(41)(o,i,{}),e.exports=function(t){o[i][t]=!0}},{115:115,41:41}],10:[function(t,e,n){e.exports=function(t,e,n,i){if(!(t instanceof e)||void 0!==i&&i in t)throw TypeError(n+": incorrect invocation!");return t}},{}],11:[function(t,e,n){var i=t(50);e.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},{50:50}],12:[function(t,e,n){"use strict";var i=t(109),o=t(105),r=t(108);e.exports=[].copyWithin||function(t,e){var n=i(this),s=r(n.length),a=o(t,s),u=o(e,s),l=arguments.length>2?arguments[2]:void 0,c=Math.min((void 0===l?s:o(l,s))-u,s-a),d=1;for(a>u&&u+c>a&&(d=-1,u+=c-1,a+=c-1);c-- >0;)u in n?n[a]=n[u]:delete n[a],a+=d,u+=d;return n}},{105:105,108:108,109:109}],13:[function(t,e,n){"use strict";var i=t(109),o=t(105),r=t(108);e.exports=function(t){for(var e=i(this),n=r(e.length),s=arguments.length,a=o(s>1?arguments[1]:void 0,n),u=s>2?arguments[2]:void 0,l=void 0===u?n:o(u,n);l>a;)e[a++]=t;return e}},{105:105,108:108,109:109}],14:[function(t,e,n){var i=t(38);e.exports=function(t,e){var n=[];return i(t,!1,n.push,n,e),n}},{38:38}],15:[function(t,e,n){var i=t(107),o=t(108),r=t(105);e.exports=function(t){return function(e,n,s){var a,u=i(e),l=o(u.length),c=r(s,l);if(t&&n!=n){for(;l>c;)if(a=u[c++],a!=a)return!0}else for(;l>c;c++)if((t||c in u)&&u[c]===n)return t||c;return!t&&-1}}},{105:105,107:107,108:108}],16:[function(t,e,n){var i=t(27),o=t(46),r=t(109),s=t(108),a=t(18);e.exports=function(t,e){var n=1==t,u=2==t,l=3==t,c=4==t,d=6==t,h=5==t||d,p=e||a;return function(e,a,f){for(var m,g,b=r(e),_=o(b),y=i(a,f,3),v=s(_.length),w=0,k=n?p(e,v):u?p(e,0):void 0;v>w;w++)if((h||w in _)&&(m=_[w],g=y(m,w,b),t))if(n)k[w]=g;else if(g)switch(t){case 3:return!0;case 5:return m;case 6:return w;case 2:k.push(m)}else if(c)return!1;return d?-1:l||c?c:k}}},{108:108,109:109,18:18,27:27,46:46}],17:[function(t,e,n){var i=t(7),o=t(109),r=t(46),s=t(108);e.exports=function(t,e,n,a,u){i(e);var l=o(t),c=r(l),d=s(l.length),h=u?d-1:0,p=u?-1:1;if(2>n)for(;;){if(h in c){a=c[h],h+=p;break}if(h+=p,u?0>h:h>=d)throw TypeError("Reduce of empty array with no initial value")}for(;u?h>=0:d>h;h+=p)h in c&&(a=e(a,c[h],h,l));return a}},{108:108,109:109,46:46,7:7}],18:[function(t,e,n){var i=t(50),o=t(48),r=t(115)("species");e.exports=function(t,e){var n;return o(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!o(n.prototype)||(n=void 0),i(n)&&(n=n[r],null===n&&(n=void 0))),new(void 0===n?Array:n)(e)}},{115:115,48:48,50:50}],19:[function(t,e,n){"use strict";var i=t(7),o=t(50),r=t(45),s=[].slice,a={},u=function(t,e,n){if(!(e in a)){for(var i=[],o=0;e>o;o++)i[o]="a["+o+"]";a[e]=Function("F,a","return new F("+i.join(",")+")")}return a[e](t,n)};e.exports=Function.bind||function(t){var e=i(this),n=s.call(arguments,1),a=function(){var i=n.concat(s.call(arguments));return this instanceof a?u(e,i.length,i):r(e,i,t)};return o(e.prototype)&&(a.prototype=e.prototype),a}},{45:45,50:50,7:7}],20:[function(t,e,n){var i=t(21),o=t(115)("toStringTag"),r="Arguments"==i(function(){return arguments}());e.exports=function(t){var e,n,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=(e=Object(t))[o])?n:r?i(e):"Object"==(s=i(e))&&"function"==typeof e.callee?"Arguments":s}},{115:115,21:21}],21:[function(t,e,n){var i={}.toString;e.exports=function(t){return i.call(t).slice(8,-1)}},{}],22:[function(t,e,n){"use strict";var i=t(68).f,o=t(67),r=(t(41),t(86)),s=t(27),a=t(10),u=t(28),l=t(38),c=t(54),d=t(56),h=t(91),p=t(29),f=t(63).fastKey,m=p?"_s":"size",g=function(t,e){var n,i=f(e);if("F"!==i)return t._i[i];for(n=t._f;n;n=n.n)if(n.k==e)return n};e.exports={getConstructor:function(t,e,n,c){var d=t(function(t,i){a(t,d,e,"_i"),t._i=o(null),t._f=void 0,t._l=void 0,t[m]=0,void 0!=i&&l(i,n,t[c],t)});return r(d.prototype,{clear:function(){for(var t=this,e=t._i,n=t._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete e[n.i];t._f=t._l=void 0,t[m]=0},"delete":function(t){var e=this,n=g(e,t);if(n){var i=n.n,o=n.p;delete e._i[n.i],n.r=!0,o&&(o.n=i),i&&(i.p=o),e._f==n&&(e._f=i),e._l==n&&(e._l=o),e[m]--}return!!n},forEach:function(t){a(this,d,"forEach");for(var e,n=s(t,arguments.length>1?arguments[1]:void 0,3);e=e?e.n:this._f;)for(n(e.v,e.k,this);e&&e.r;)e=e.p},has:function(t){return!!g(this,t)}}),p&&i(d.prototype,"size",{get:function(){return u(this[m])}}),d},def:function(t,e,n){var i,o,r=g(t,e);return r?r.v=n:(t._l=r={i:o=f(e,!0),k:e,v:n,p:i=t._l,n:void 0,r:!1},t._f||(t._f=r),i&&(i.n=r),t[m]++,"F"!==o&&(t._i[o]=r)),t},getEntry:g,setStrong:function(t,e,n){c(t,e,function(t,e){this._t=t,this._k=e,this._l=void 0},function(){for(var t=this,e=t._k,n=t._l;n&&n.r;)n=n.p;return t._t&&(t._l=n=n?n.n:t._t._f)?"keys"==e?d(0,n.k):"values"==e?d(0,n.v):d(0,[n.k,n.v]):(t._t=void 0,d(1))},n?"entries":"values",!n,!0),h(e)}}},{10:10,27:27,28:28,29:29,38:38,41:41,54:54,56:56,63:63,67:67,68:68,86:86,91:91}],23:[function(t,e,n){var i=t(20),o=t(14);e.exports=function(t){return function(){if(i(this)!=t)throw TypeError(t+"#toJSON isn't generic");return o(this)}}},{14:14,20:20}],24:[function(t,e,n){"use strict";var i=t(86),o=t(63).getWeak,r=t(11),s=t(50),a=t(10),u=t(38),l=t(16),c=t(40),d=l(5),h=l(6),p=0,f=function(t){return t._l||(t._l=new m)},m=function(){this.a=[]},g=function(t,e){return d(t.a,function(t){return t[0]===e})};m.prototype={get:function(t){var e=g(this,t);return e?e[1]:void 0},has:function(t){return!!g(this,t)},set:function(t,e){var n=g(this,t);n?n[1]=e:this.a.push([t,e])},"delete":function(t){var e=h(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}},e.exports={getConstructor:function(t,e,n,r){var l=t(function(t,i){a(t,l,e,"_i"),t._i=p++,t._l=void 0,void 0!=i&&u(i,n,t[r],t)});return i(l.prototype,{"delete":function(t){if(!s(t))return!1;var e=o(t);return e===!0?f(this)["delete"](t):e&&c(e,this._i)&&delete e[this._i]},has:function(t){if(!s(t))return!1;var e=o(t);return e===!0?f(this).has(t):e&&c(e,this._i)}}),l},def:function(t,e,n){var i=o(r(e),!0);return i===!0?f(t).set(e,n):i[t._i]=n,t},ufstore:f}},{10:10,11:11,16:16,38:38,40:40,50:50,63:63,86:86}],25:[function(t,e,n){"use strict";var i=t(39),o=t(33),r=t(87),s=t(86),a=t(63),u=t(38),l=t(10),c=t(50),d=t(35),h=t(55),p=t(92),f=t(44);e.exports=function(t,e,n,m,g,b){var _=i[t],y=_,v=g?"set":"add",w=y&&y.prototype,k={},C=function(t){var e=w[t];r(w,t,"delete"==t?function(t){return b&&!c(t)?!1:e.call(this,0===t?0:t)}:"has"==t?function(t){return b&&!c(t)?!1:e.call(this,0===t?0:t)}:"get"==t?function(t){return b&&!c(t)?void 0:e.call(this,0===t?0:t)}:"add"==t?function(t){return e.call(this,0===t?0:t),this}:function(t,n){return e.call(this,0===t?0:t,n),this})};if("function"==typeof y&&(b||w.forEach&&!d(function(){(new y).entries().next()}))){var S=new y,x=S[v](b?{}:-0,1)!=S,E=d(function(){S.has(1)}),P=h(function(t){new y(t)}),T=!b&&d(function(){for(var t=new y,e=5;e--;)t[v](e,e);return!t.has(-0)});P||(y=e(function(e,n){l(e,y,t);var i=f(new _,e,y);return void 0!=n&&u(n,g,i[v],i),i}),y.prototype=w,w.constructor=y),(E||T)&&(C("delete"),C("has"),g&&C("get")),(T||x)&&C(v),b&&w.clear&&delete w.clear}else y=m.getConstructor(e,t,g,v),s(y.prototype,n),a.NEED=!0;return p(y,t),k[t]=y,o(o.G+o.W+o.F*(y!=_),k),b||m.setStrong(y,t,g),y}},{10:10,33:33,35:35,38:38,39:39,44:44,50:50,55:55,63:63,86:86,87:87,92:92}],26:[function(t,e,n){var i=e.exports={version:"2.1.1"};"number"==typeof __e&&(__e=i)},{}],27:[function(t,e,n){var i=t(7);e.exports=function(t,e,n){if(i(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,o){return t.call(e,n,i,o)}}return function(){return t.apply(e,arguments)}}},{7:7}],28:[function(t,e,n){e.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},{}],29:[function(t,e,n){e.exports=!t(35)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{35:35}],30:[function(t,e,n){var i=t(50),o=t(39).document,r=i(o)&&i(o.createElement);e.exports=function(t){return r?o.createElement(t):{}}},{39:39,50:50}],31:[function(t,e,n){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],32:[function(t,e,n){var i=t(76),o=t(73),r=t(77);e.exports=function(t){var e=i(t),n=o.f;if(n)for(var s,a=n(t),u=r.f,l=0;a.length>l;)u.call(t,s=a[l++])&&e.push(s);return e}},{73:73,76:76,77:77}],33:[function(t,e,n){var i=t(39),o=t(26),r=t(41),s=t(87),a=t(27),u="prototype",l=function(t,e,n){var c,d,h,p,f=t&l.F,m=t&l.G,g=t&l.S,b=t&l.P,_=t&l.B,y=m?i:g?i[e]||(i[e]={}):(i[e]||{})[u],v=m?o:o[e]||(o[e]={}),w=v[u]||(v[u]={});m&&(n=e);for(c in n)d=!f&&y&&void 0!==y[c],h=(d?y:n)[c],p=_&&d?a(h,i):b&&"function"==typeof h?a(Function.call,h):h,y&&s(y,c,h,t&l.U),v[c]!=h&&r(v,c,p),b&&w[c]!=h&&(w[c]=h)};i.core=o,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},{26:26,27:27,39:39,41:41,87:87}],34:[function(t,e,n){var i=t(115)("match");e.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[i]=!1,!"/./"[t](e)}catch(o){}}return!0}},{115:115}],35:[function(t,e,n){e.exports=function(t){try{return!!t()}catch(e){return!0}}},{}],36:[function(t,e,n){"use strict";var i=t(41),o=t(87),r=t(35),s=t(28),a=t(115);e.exports=function(t,e,n){var u=a(t),l=n(s,u,""[t]),c=l[0],d=l[1];r(function(){var e={};return e[u]=function(){return 7},7!=""[t](e)})&&(o(String.prototype,t,c),i(RegExp.prototype,u,2==e?function(t,e){return d.call(t,this,e)}:function(t){return d.call(t,this)}))}},{115:115,28:28,35:35,41:41,87:87}],37:[function(t,e,n){"use strict";var i=t(11);e.exports=function(){var t=i(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},{11:11}],38:[function(t,e,n){var i=t(27),o=t(52),r=t(47),s=t(11),a=t(108),u=t(116);e.exports=function(t,e,n,l,c){var d,h,p,f=c?function(){return t}:u(t),m=i(n,l,e?2:1),g=0;if("function"!=typeof f)throw TypeError(t+" is not iterable!");if(r(f))for(d=a(t.length);d>g;g++)e?m(s(h=t[g])[0],h[1]):m(t[g]);else for(p=f.call(t);!(h=p.next()).done;)o(p,m,h.value,e)}},{108:108,11:11,116:116,27:27,47:47,52:52}],39:[function(t,e,n){var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},{}],40:[function(t,e,n){var i={}.hasOwnProperty;e.exports=function(t,e){return i.call(t,e)}},{}],41:[function(t,e,n){var i=t(68),o=t(85);e.exports=t(29)?function(t,e,n){return i.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},{29:29,68:68,85:85}],42:[function(t,e,n){e.exports=t(39).document&&document.documentElement},{39:39}],43:[function(t,e,n){e.exports=!t(29)&&!t(35)(function(){return 7!=Object.defineProperty(t(30)("div"),"a",{get:function(){return 7}}).a})},{29:29,30:30,35:35}],44:[function(t,e,n){var i=t(50),o=t(90).set;e.exports=function(t,e,n){var r,s=e.constructor;return s!==n&&"function"==typeof s&&(r=s.prototype)!==n.prototype&&i(r)&&o&&o(t,r),t}},{50:50,90:90}],45:[function(t,e,n){e.exports=function(t,e,n){var i=void 0===n;switch(e.length){case 0:return i?t():t.call(n);case 1:return i?t(e[0]):t.call(n,e[0]);case 2:return i?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return i?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return i?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}return t.apply(n,e)}},{}],46:[function(t,e,n){var i=t(21);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==i(t)?t.split(""):Object(t)}},{21:21}],47:[function(t,e,n){var i=t(57),o=t(115)("iterator"),r=Array.prototype;e.exports=function(t){return void 0!==t&&(i.Array===t||r[o]===t)}},{115:115,57:57}],48:[function(t,e,n){var i=t(21);e.exports=Array.isArray||function(t){return"Array"==i(t)}},{21:21}],49:[function(t,e,n){var i=t(50),o=Math.floor;e.exports=function(t){return!i(t)&&isFinite(t)&&o(t)===t}},{50:50}],50:[function(t,e,n){e.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},{}],51:[function(t,e,n){var i=t(50),o=t(21),r=t(115)("match");e.exports=function(t){var e;return i(t)&&(void 0!==(e=t[r])?!!e:"RegExp"==o(t))}},{115:115,21:21,50:50}],52:[function(t,e,n){var i=t(11);e.exports=function(t,e,n,o){try{return o?e(i(n)[0],n[1]):e(n)}catch(r){var s=t["return"];throw void 0!==s&&i(s.call(t)),r}}},{11:11}],53:[function(t,e,n){"use strict";var i=t(67),o=t(85),r=t(92),s={};t(41)(s,t(115)("iterator"),function(){return this}),e.exports=function(t,e,n){t.prototype=i(s,{next:o(1,n)}),r(t,e+" Iterator")}},{115:115,41:41,67:67,85:85,92:92}],54:[function(t,e,n){"use strict";var i=t(59),o=t(33),r=t(87),s=t(41),a=t(40),u=t(57),l=t(53),c=t(92),d=t(74),h=t(115)("iterator"),p=!([].keys&&"next"in[].keys()),f="@@iterator",m="keys",g="values",b=function(){return this};e.exports=function(t,e,n,_,y,v,w){l(n,e,_);var k,C,S,x=function(t){if(!p&&t in I)return I[t];switch(t){case m:return function(){return new n(this,t)};case g:return function(){return new n(this,t)}}return function(){return new n(this,t)}},E=e+" Iterator",P=y==g,T=!1,I=t.prototype,A=I[h]||I[f]||y&&I[y],B=A||x(y),O=y?P?x("entries"):B:void 0,M="Array"==e?I.entries||A:A;if(M&&(S=d(M.call(new t)),S!==Object.prototype&&(c(S,E,!0),i||a(S,h)||s(S,h,b))),P&&A&&A.name!==g&&(T=!0,B=function(){return A.call(this)}),i&&!w||!p&&!T&&I[h]||s(I,h,B),u[e]=B,u[E]=b,y)if(k={values:P?B:x(g),keys:v?B:x(m),entries:O},w)for(C in k)C in I||r(I,C,k[C]);else o(o.P+o.F*(p||T),e,k);return k}},{115:115,33:33,40:40,41:41,53:53,57:57,59:59,74:74,87:87,92:92}],55:[function(t,e,n){var i=t(115)("iterator"),o=!1;try{var r=[7][i]();r["return"]=function(){o=!0},Array.from(r,function(){throw 2})}catch(s){}e.exports=function(t,e){if(!e&&!o)return!1;var n=!1;try{var r=[7],s=r[i]();s.next=function(){n=!0},r[i]=function(){return s},t(r)}catch(a){}return n}},{115:115}],56:[function(t,e,n){e.exports=function(t,e){return{value:e,done:!!t}}},{}],57:[function(t,e,n){e.exports={}},{}],58:[function(t,e,n){var i=t(76),o=t(107);e.exports=function(t,e){for(var n,r=o(t),s=i(r),a=s.length,u=0;a>u;)if(r[n=s[u++]]===e)return n}},{107:107,76:76}],59:[function(t,e,n){e.exports=!1},{}],60:[function(t,e,n){e.exports=Math.expm1||function(t){return 0==(t=+t)?t:t>-1e-6&&1e-6>t?t+t*t/2:Math.exp(t)-1}},{}],61:[function(t,e,n){e.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&1e-8>t?t-t*t/2:Math.log(1+t)}},{}],62:[function(t,e,n){e.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:0>t?-1:1}},{}],63:[function(t,e,n){var i=t(114)("meta"),o=t(50),r=t(40),s=t(68).f,a=0,u=Object.isExtensible||function(){return!0},l=!t(35)(function(){return u(Object.preventExtensions({}))}),c=function(t){s(t,i,{value:{i:"O"+ ++a,w:{}}})},d=function(t,e){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!r(t,i)){if(!u(t))return"F";if(!e)return"E";c(t)}return t[i].i},h=function(t,e){if(!r(t,i)){if(!u(t))return!0;if(!e)return!1;c(t)}return t[i].w},p=function(t){return l&&f.NEED&&u(t)&&!r(t,i)&&c(t),t},f=e.exports={KEY:i,NEED:!1,fastKey:d,getWeak:h,onFreeze:p}},{114:114,35:35,40:40,50:50,68:68}],64:[function(t,e,n){var i=t(147),o=t(33),r=t(94)("metadata"),s=r.store||(r.store=new(t(253))),a=function(t,e,n){var o=s.get(t);if(!o){if(!n)return;s.set(t,o=new i)}var r=o.get(e);if(!r){if(!n)return;o.set(e,r=new i)}return r},u=function(t,e,n){var i=a(e,n,!1);return void 0===i?!1:i.has(t)},l=function(t,e,n){var i=a(e,n,!1);return void 0===i?void 0:i.get(t)},c=function(t,e,n,i){a(n,i,!0).set(t,e)},d=function(t,e){var n=a(t,e,!1),i=[];return n&&n.forEach(function(t,e){i.push(e)}),i},h=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},p=function(t){o(o.S,"Reflect",t)};e.exports={store:s,map:a,has:u,get:l,set:c,keys:d,key:h,exp:p}},{147:147,253:253,33:33,94:94}],65:[function(t,e,n){var i,o,r,s=t(39),a=t(104).set,u=s.MutationObserver||s.WebKitMutationObserver,l=s.process,c=s.Promise,d="process"==t(21)(l),h=function(){var t,e,n;for(d&&(t=l.domain)&&(l.domain=null,t.exit());i;)e=i.domain,n=i.fn,e&&e.enter(),n(),e&&e.exit(),i=i.next;o=void 0,t&&t.enter()};if(d)r=function(){l.nextTick(h)};else if(u){var p=1,f=document.createTextNode("");new u(h).observe(f,{characterData:!0}),r=function(){f.data=p=-p}}else r=c&&c.resolve?function(){c.resolve().then(h)}:function(){a.call(s,h)};e.exports=function(t){var e={fn:t,next:void 0,domain:d&&l.domain};o&&(o.next=e),i||(i=e,r()),o=e}},{104:104,21:21,39:39}],66:[function(t,e,n){"use strict";var i=t(76),o=t(73),r=t(77),s=t(109),a=t(46);e.exports=t(35)(function(){var t=Object.assign,e={},n={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(t){n[t]=t}),7!=t({},e)[i]||Object.keys(t({},n)).join("")!=o})?function(t,e){for(var n=s(t),u=arguments.length,l=1,c=o.f,d=r.f;u>l;)for(var h,p=a(arguments[l++]),f=c?i(p).concat(c(p)):i(p),m=f.length,g=0;m>g;)d.call(p,h=f[g++])&&(n[h]=p[h]);return n}:Object.assign},{109:109,35:35,46:46,73:73,76:76,77:77}],67:[function(t,e,n){var i=t(11),o=t(69),r=t(31),s=t(93)("IE_PROTO"),a=function(){},u="prototype",l=function(){var e,n=t(30)("iframe"),i=r.length,o=">";for(n.style.display="none",t(42).appendChild(n),n.src="javascript:",e=n.contentWindow.document,e.open(),e.write("<script>document.F=Object</script"+o),e.close(),l=e.F;i--;)delete l[u][r[i]];return l()};e.exports=Object.create||function(t,e){var n;return null!==t?(a[u]=i(t),n=new a,a[u]=null,n[s]=t):n=l(),void 0===e?n:o(n,e)}},{11:11,30:30,31:31,42:42,69:69,93:93}],68:[function(t,e,n){var i=t(11),o=t(43),r=t(110),s=Object.defineProperty;n.f=t(29)?Object.defineProperty:function(t,e,n){if(i(t),e=r(e,!0),i(n),o)try{return s(t,e,n)}catch(a){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},{11:11,110:110,29:29,43:43}],69:[function(t,e,n){var i=t(68),o=t(11),r=t(76);e.exports=t(29)?Object.defineProperties:function(t,e){o(t);for(var n,s=r(e),a=s.length,u=0;a>u;)i.f(t,n=s[u++],e[n]);return t}},{11:11,29:29,68:68,76:76}],70:[function(t,e,n){var i=t(77),o=t(85),r=t(107),s=t(110),a=t(40),u=t(43),l=Object.getOwnPropertyDescriptor;n.f=t(29)?l:function(t,e){if(t=r(t),e=s(e,!0),u)try{return l(t,e)}catch(n){}return a(t,e)?o(!i.f.call(t,e),t[e]):void 0}},{107:107,110:110,29:29,40:40,43:43,77:77,85:85}],71:[function(t,e,n){var i=t(107),o=t(72).f,r={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(t){try{return o.f(t)}catch(e){return s.slice()}};e.exports.f=function(t){return s&&"[object Window]"==r.call(t)?a(t):o(i(t))}},{107:107,72:72}],72:[function(t,e,n){var i=t(75),o=t(31).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return i(t,o)}},{31:31,75:75}],73:[function(t,e,n){n.f=Object.getOwnPropertySymbols},{}],74:[function(t,e,n){var i=t(40),o=t(109),r=t(93)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(t){return t=o(t),i(t,r)?t[r]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?s:null}},{109:109,40:40,93:93}],75:[function(t,e,n){var i=t(40),o=t(107),r=t(15)(!1),s=t(93)("IE_PROTO");e.exports=function(t,e){var n,a=o(t),u=0,l=[];for(n in a)n!=s&&i(a,n)&&l.push(n);for(;e.length>u;)i(a,n=e[u++])&&(~r(l,n)||l.push(n));return l}},{107:107,15:15,40:40,93:93}],76:[function(t,e,n){var i=t(75),o=t(31);e.exports=Object.keys||function(t){return i(t,o)}},{31:31,75:75}],77:[function(t,e,n){n.f={}.propertyIsEnumerable},{}],78:[function(t,e,n){var i=t(33),o=t(26),r=t(35);e.exports=function(t,e){var n=(o.Object||{})[t]||Object[t],s={};s[t]=e(n),i(i.S+i.F*r(function(){n(1)}),"Object",s)}},{26:26,33:33,35:35}],79:[function(t,e,n){var i=t(76),o=t(107),r=t(77).f;e.exports=function(t){return function(e){for(var n,s=o(e),a=i(s),u=a.length,l=0,c=[];u>l;)r.call(s,n=a[l++])&&c.push(t?[n,s[n]]:s[n]);return c}}},{107:107,76:76,77:77}],80:[function(t,e,n){var i=t(72),o=t(73),r=t(11),s=t(39).Reflect;e.exports=s&&s.ownKeys||function(t){var e=i.f(r(t)),n=o.f;return n?e.concat(n(t)):e}},{11:11,39:39,72:72,73:73}],81:[function(t,e,n){var i=t(39).parseFloat,o=t(102).trim;e.exports=1/i(t(103)+"-0")!==-(1/0)?function(t){var e=o(String(t),3),n=i(e);return 0===n&&"-"==e.charAt(0)?-0:n}:i},{102:102,103:103,39:39}],82:[function(t,e,n){var i=t(39).parseInt,o=t(102).trim,r=t(103),s=/^[\-+]?0[xX]/;e.exports=8!==i(r+"08")||22!==i(r+"0x16")?function(t,e){var n=o(String(t),3);return i(n,e>>>0||(s.test(n)?16:10))}:i},{102:102,103:103,39:39}],83:[function(t,e,n){"use strict";var i=t(84),o=t(45),r=t(7);e.exports=function(){for(var t=r(this),e=arguments.length,n=Array(e),s=0,a=i._,u=!1;e>s;)(n[s]=arguments[s++])===a&&(u=!0);return function(){var i,r=this,s=arguments.length,l=0,c=0;if(!u&&!s)return o(t,n,r);if(i=n.slice(),u)for(;e>l;l++)i[l]===a&&(i[l]=arguments[c++]);for(;s>c;)i.push(arguments[c++]);return o(t,i,r)}}},{45:45,7:7,84:84}],84:[function(t,e,n){e.exports=t(39)},{39:39}],85:[function(t,e,n){e.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},{}],86:[function(t,e,n){var i=t(87);e.exports=function(t,e,n){for(var o in e)i(t,o,e[o],n);return t}},{87:87}],87:[function(t,e,n){var i=t(39),o=t(41),r=t(40),s=t(114)("src"),a="toString",u=Function[a],l=(""+u).split(a);t(26).inspectSource=function(t){return u.call(t)},(e.exports=function(t,e,n,a){var u="function"==typeof n;u&&(r(n,"name")||o(n,"name",e)),t[e]!==n&&(u&&(r(n,s)||o(n,s,t[e]?""+t[e]:l.join(String(e)))),t===i?t[e]=n:a?t[e]?t[e]=n:o(t,e,n):(delete t[e],o(t,e,n)))})(Function.prototype,a,function(){return"function"==typeof this&&this[s]||u.call(this)})},{114:114,26:26,39:39,40:40,41:41}],88:[function(t,e,n){e.exports=function(t,e){var n=e===Object(e)?function(t){return e[t]}:e;return function(e){return String(e).replace(t,n)}}},{}],89:[function(t,e,n){e.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},{}],90:[function(t,e,n){var i=t(50),o=t(11),r=function(t,e){if(o(t),!i(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,n,i){try{i=t(27)(Function.call,t(70).f(Object.prototype,"__proto__").set,2),i(e,[]),n=!(e instanceof Array)}catch(o){n=!0}return function(t,e){return r(t,e),n?t.__proto__=e:i(t,e),t}}({},!1):void 0),check:r}},{11:11,27:27,50:50,70:70}],91:[function(t,e,n){"use strict";var i=t(39),o=t(68),r=t(29),s=t(115)("species");e.exports=function(t){var e=i[t];r&&e&&!e[s]&&o.f(e,s,{configurable:!0,get:function(){return this}})}},{115:115,29:29,39:39,68:68}],92:[function(t,e,n){var i=t(68).f,o=t(40),r=t(115)("toStringTag");
e.exports=function(t,e,n){t&&!o(t=n?t:t.prototype,r)&&i(t,r,{configurable:!0,value:e})}},{115:115,40:40,68:68}],93:[function(t,e,n){var i=t(94)("keys"),o=t(114);e.exports=function(t){return i[t]||(i[t]=o(t))}},{114:114,94:94}],94:[function(t,e,n){var i=t(39),o="__core-js_shared__",r=i[o]||(i[o]={});e.exports=function(t){return r[t]||(r[t]={})}},{39:39}],95:[function(t,e,n){var i=t(11),o=t(7),r=t(115)("species");e.exports=function(t,e){var n,s=i(t).constructor;return void 0===s||void 0==(n=i(s)[r])?e:o(n)}},{11:11,115:115,7:7}],96:[function(t,e,n){var i=t(35);e.exports=function(t,e){return!!t&&i(function(){e?t.call(null,function(){},1):t.call(null)})}},{35:35}],97:[function(t,e,n){var i=t(106),o=t(28);e.exports=function(t){return function(e,n){var r,s,a=String(o(e)),u=i(n),l=a.length;return 0>u||u>=l?t?"":void 0:(r=a.charCodeAt(u),55296>r||r>56319||u+1===l||(s=a.charCodeAt(u+1))<56320||s>57343?t?a.charAt(u):r:t?a.slice(u,u+2):(r-55296<<10)+(s-56320)+65536)}}},{106:106,28:28}],98:[function(t,e,n){var i=t(51),o=t(28);e.exports=function(t,e,n){if(i(e))throw TypeError("String#"+n+" doesn't accept regex!");return String(o(t))}},{28:28,51:51}],99:[function(t,e,n){var i=t(33),o=t(35),r=t(28),s=/"/g,a=function(t,e,n,i){var o=String(r(t)),a="<"+e;return""!==n&&(a+=" "+n+'="'+String(i).replace(s,"&quot;")+'"'),a+">"+o+"</"+e+">"};e.exports=function(t,e){var n={};n[t]=e(a),i(i.P+i.F*o(function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}),"String",n)}},{28:28,33:33,35:35}],100:[function(t,e,n){var i=t(108),o=t(101),r=t(28);e.exports=function(t,e,n,s){var a=String(r(t)),u=a.length,l=void 0===n?" ":String(n),c=i(e);if(u>=c)return a;""==l&&(l=" ");var d=c-u,h=o.call(l,Math.ceil(d/l.length));return h.length>d&&(h=h.slice(0,d)),s?h+a:a+h}},{101:101,108:108,28:28}],101:[function(t,e,n){"use strict";var i=t(106),o=t(28);e.exports=function(t){var e=String(o(this)),n="",r=i(t);if(0>r||r==1/0)throw RangeError("Count can't be negative");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}},{106:106,28:28}],102:[function(t,e,n){var i=t(33),o=t(28),r=t(35),s=t(103),a="["+s+"]",u="",l=RegExp("^"+a+a+"*"),c=RegExp(a+a+"*$"),d=function(t,e,n){var o={},a=r(function(){return!!s[t]()||u[t]()!=u}),l=o[t]=a?e(h):s[t];n&&(o[n]=l),i(i.P+i.F*a,"String",o)},h=d.trim=function(t,e){return t=String(o(t)),1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(c,"")),t};e.exports=d},{103:103,28:28,33:33,35:35}],103:[function(t,e,n){e.exports="	\n\x0B\f\r \u2028\u2029\ufeff"},{}],104:[function(t,e,n){var i,o,r,s=t(27),a=t(45),u=t(42),l=t(30),c=t(39),d=c.process,h=c.setImmediate,p=c.clearImmediate,f=c.MessageChannel,m=0,g={},b="onreadystatechange",_=function(){var t=+this;if(g.hasOwnProperty(t)){var e=g[t];delete g[t],e()}},y=function(t){_.call(t.data)};h&&p||(h=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return g[++m]=function(){a("function"==typeof t?t:Function(t),e)},i(m),m},p=function(t){delete g[t]},"process"==t(21)(d)?i=function(t){d.nextTick(s(_,t,1))}:f?(o=new f,r=o.port2,o.port1.onmessage=y,i=s(r.postMessage,r,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(i=function(t){c.postMessage(t+"","*")},c.addEventListener("message",y,!1)):i=b in l("script")?function(t){u.appendChild(l("script"))[b]=function(){u.removeChild(this),_.call(t)}}:function(t){setTimeout(s(_,t,1),0)}),e.exports={set:h,clear:p}},{21:21,27:27,30:30,39:39,42:42,45:45}],105:[function(t,e,n){var i=t(106),o=Math.max,r=Math.min;e.exports=function(t,e){return t=i(t),0>t?o(t+e,0):r(t,e)}},{106:106}],106:[function(t,e,n){var i=Math.ceil,o=Math.floor;e.exports=function(t){return isNaN(t=+t)?0:(t>0?o:i)(t)}},{}],107:[function(t,e,n){var i=t(46),o=t(28);e.exports=function(t){return i(o(t))}},{28:28,46:46}],108:[function(t,e,n){var i=t(106),o=Math.min;e.exports=function(t){return t>0?o(i(t),9007199254740991):0}},{106:106}],109:[function(t,e,n){var i=t(28);e.exports=function(t){return Object(i(t))}},{28:28}],110:[function(t,e,n){var i=t(50);e.exports=function(t,e){if(!i(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!i(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!i(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!i(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},{50:50}],111:[function(t,e,n){"use strict";if(t(29)){var i=t(59),o=t(39),r=t(35),s=t(33),a=t(113),u=t(112),l=t(27),c=t(10),d=t(85),h=t(41),p=t(86),f=(t(49),t(106)),m=t(108),g=t(105),b=t(110),_=t(40),y=t(89),v=t(20),w=t(50),k=t(109),C=t(47),S=t(67),x=t(74),E=t(72).f,P=(t(117),t(116)),T=t(114),I=t(115),A=t(16),B=t(15),O=t(95),M=t(129),$=t(57),D=t(55),R=t(91),L=t(13),F=t(12),N=t(68),j=t(70),U=N.f,V=j.f,H=o.RangeError,z=o.TypeError,q=o.Uint8Array,W="ArrayBuffer",Q="Shared"+W,Y="BYTES_PER_ELEMENT",G="prototype",K=Array[G],J=u.ArrayBuffer,X=u.DataView,Z=A(0),tt=A(2),et=A(3),nt=A(4),it=A(5),ot=A(6),rt=B(!0),st=B(!1),at=M.values,ut=M.keys,lt=M.entries,ct=K.lastIndexOf,dt=K.reduce,ht=K.reduceRight,pt=K.join,ft=K.sort,mt=K.slice,gt=K.toString,bt=K.toLocaleString,_t=I("iterator"),yt=I("toStringTag"),vt=T("typed_constructor"),wt=T("def_constructor"),kt=a.CONSTR,Ct=a.TYPED,St=a.VIEW,xt="Wrong length!",Et=A(1,function(t,e){return Ot(O(t,t[wt]),e)}),Pt=r(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Tt=!!q&&!!q[G].set&&r(function(){new q(1).set({})}),It=function(t,e){if(void 0===t)throw z(xt);var n=+t,i=m(t);if(e&&!y(n,i))throw H(xt);return i},At=function(t,e){var n=f(t);if(0>n||n%e)throw H("Wrong offset!");return n},Bt=function(t){if(w(t)&&Ct in t)return t;throw z(t+" is not a typed array!")},Ot=function(t,e){if(!(w(t)&&vt in t))throw z("It is not a typed array constructor!");return new t(e)},Mt=function(t,e){return $t(O(t,t[wt]),e)},$t=function(t,e){for(var n=0,i=e.length,o=Ot(t,i);i>n;)o[n]=e[n++];return o},Dt=function(t,e,n){U(t,e,{get:function(){return this._d[n]}})},Rt=function(t){var e,n,i,o,r,s,a=k(t),u=arguments.length,c=u>1?arguments[1]:void 0,d=void 0!==c,h=P(a);if(void 0!=h&&!C(h)){for(s=h.call(a),i=[],e=0;!(r=s.next()).done;e++)i.push(r.value);a=i}for(d&&u>2&&(c=l(c,arguments[2],2)),e=0,n=m(a.length),o=Ot(this,n);n>e;e++)o[e]=d?c(a[e],e):a[e];return o},Lt=function(){for(var t=0,e=arguments.length,n=Ot(this,e);e>t;)n[t]=arguments[t++];return n},Ft=!!q&&r(function(){bt.call(new q(1))}),Nt=function(){return bt.apply(Ft?mt.call(Bt(this)):Bt(this),arguments)},jt={copyWithin:function(t,e){return F.call(Bt(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return nt(Bt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return L.apply(Bt(this),arguments)},filter:function(t){return Mt(this,tt(Bt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return it(Bt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return ot(Bt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(Bt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return st(Bt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return rt(Bt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return pt.apply(Bt(this),arguments)},lastIndexOf:function(t){return ct.apply(Bt(this),arguments)},map:function(t){return Et(Bt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return dt.apply(Bt(this),arguments)},reduceRight:function(t){return ht.apply(Bt(this),arguments)},reverse:function(){for(var t,e=this,n=Bt(e).length,i=Math.floor(n/2),o=0;i>o;)t=e[o],e[o++]=e[--n],e[n]=t;return e},slice:function(t,e){return Mt(this,mt.call(Bt(this),t,e))},some:function(t){return et(Bt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return ft.call(Bt(this),t)},subarray:function(t,e){var n=Bt(this),i=n.length,o=g(t,i);return new(O(n,n[wt]))(n.buffer,n.byteOffset+o*n.BYTES_PER_ELEMENT,m((void 0===e?i:g(e,i))-o))}},Ut=function(t){Bt(this);var e=At(arguments[1],1),n=this.length,i=k(t),o=m(i.length),r=0;if(o+e>n)throw H(xt);for(;o>r;)this[e+r]=i[r++]},Vt={entries:function(){return lt.call(Bt(this))},keys:function(){return ut.call(Bt(this))},values:function(){return at.call(Bt(this))}},Ht=function(t,e){return w(t)&&t[Ct]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},zt=function(t,e){return Ht(t,e=b(e,!0))?d(2,t[e]):V(t,e)},qt=function(t,e,n){return!(Ht(t,e=b(e,!0))&&w(n)&&_(n,"value"))||_(n,"get")||_(n,"set")||n.configurable||_(n,"writable")&&!n.writable||_(n,"enumerable")&&!n.enumerable?U(t,e,n):(t[e]=n.value,t)};kt||(j.f=zt,N.f=qt),s(s.S+s.F*!kt,"Object",{getOwnPropertyDescriptor:zt,defineProperty:qt}),r(function(){gt.call({})})&&(gt=bt=function(){return pt.call(this)});var Wt=p({},jt);p(Wt,Vt),h(Wt,_t,Vt.values),p(Wt,{set:Ut,constructor:function(){},toString:gt,toLocaleString:Nt}),Dt(Wt,"buffer","b"),Dt(Wt,"byteOffset","o"),Dt(Wt,"byteLength","l"),Dt(Wt,"length","e"),U(Wt,yt,{get:function(){return this[Ct]}}),e.exports=function(t,e,n,u){u=!!u;var l=t+(u?"Clamped":"")+"Array",d="Uint8Array"!=l,p="get"+t,f="set"+t,g=o[l],b=g||{},_=g&&x(g),y=!g||!a.ABV,k={},C=g&&g[G],P=function(t,n){var i=t._d;return i.v[p](n*e+i.o,Pt)},T=function(t,n,i){var o=t._d;u&&(i=(i=Math.round(i))<0?0:i>255?255:255&i),o.v[f](n*e+o.o,i,Pt)},I=function(t,e){U(t,e,{get:function(){return P(this,e)},set:function(t){return T(this,e,t)},enumerable:!0})};y?(g=n(function(t,n,i,o){c(t,g,l,"_d");var r,s,a,u,d=0,p=0;if(w(n)){if(!(n instanceof J||(u=v(n))==W||u==Q))return Ct in n?$t(g,n):Rt.call(g,n);r=n,p=At(i,e);var f=n.byteLength;if(void 0===o){if(f%e)throw H(xt);if(s=f-p,0>s)throw H(xt)}else if(s=m(o)*e,s+p>f)throw H(xt);a=s/e}else a=It(n,!0),s=a*e,r=new J(s);for(h(t,"_d",{b:r,o:p,l:s,e:a,v:new X(r)});a>d;)I(t,d++)}),C=g[G]=S(Wt),h(C,"constructor",g)):D(function(t){new g(null),new g(t)},!0)||(g=n(function(t,n,i,o){c(t,g,l);var r;return w(n)?n instanceof J||(r=v(n))==W||r==Q?void 0!==o?new b(n,At(i,e),o):void 0!==i?new b(n,At(i,e)):new b(n):Ct in n?$t(g,n):Rt.call(g,n):new b(It(n,d))}),Z(_!==Function.prototype?E(b).concat(E(_)):E(b),function(t){t in g||h(g,t,b[t])}),g[G]=C,i||(C.constructor=g));var A=C[_t],B=!!A&&("values"==A.name||void 0==A.name),O=Vt.values;h(g,vt,!0),h(C,Ct,l),h(C,St,!0),h(C,wt,g),(u?new g(1)[yt]==l:yt in C)||U(C,yt,{get:function(){return l}}),k[l]=g,s(s.G+s.W+s.F*(g!=b),k),s(s.S,l,{BYTES_PER_ELEMENT:e,from:Rt,of:Lt}),Y in C||h(C,Y,e),s(s.P,l,jt),s(s.P+s.F*Tt,l,{set:Ut}),s(s.P+s.F*!B,l,Vt),s(s.P+s.F*(C.toString!=gt),l,{toString:gt}),s(s.P+s.F*(r(function(){return[1,2].toLocaleString()!=new g([1,2]).toLocaleString()})||!r(function(){C.toLocaleString.call([1,2])})),l,{toLocaleString:Nt}),$[l]=B?A:O,i||B||h(C,_t,O),R(l)}}else e.exports=function(){}},{10:10,105:105,106:106,108:108,109:109,110:110,112:112,113:113,114:114,115:115,116:116,117:117,12:12,129:129,13:13,15:15,16:16,20:20,27:27,29:29,33:33,35:35,39:39,40:40,41:41,47:47,49:49,50:50,55:55,57:57,59:59,67:67,68:68,70:70,72:72,74:74,85:85,86:86,89:89,91:91,95:95}],112:[function(t,e,n){"use strict";var i=t(39),o=t(29),r=t(59),s=t(113),a=t(41),u=t(86),l=t(35),c=t(10),d=t(106),h=t(108),p=t(72).f,f=t(68).f,m=t(13),g=t(92),b="ArrayBuffer",_="DataView",y="prototype",v="Wrong length!",w="Wrong index!",k=i[b],C=i[_],S=i.Math,x=(i.parseInt,i.RangeError),E=i.Infinity,P=k,T=S.abs,I=S.pow,A=(S.min,S.floor),B=S.log,O=S.LN2,M="buffer",$="byteLength",D="byteOffset",R=o?"_b":M,L=o?"_l":$,F=o?"_o":D,N=function(t,e,n){var i,o,r,s=Array(n),a=8*n-e-1,u=(1<<a)-1,l=u>>1,c=23===e?I(2,-24)-I(2,-77):0,d=0,h=0>t||0===t&&0>1/t?1:0;for(t=T(t),t!=t||t===E?(o=t!=t?1:0,i=u):(i=A(B(t)/O),t*(r=I(2,-i))<1&&(i--,r*=2),t+=i+l>=1?c/r:c*I(2,1-l),t*r>=2&&(i++,r/=2),i+l>=u?(o=0,i=u):i+l>=1?(o=(t*r-1)*I(2,e),i+=l):(o=t*I(2,l-1)*I(2,e),i=0));e>=8;s[d++]=255&o,o/=256,e-=8);for(i=i<<e|o,a+=e;a>0;s[d++]=255&i,i/=256,a-=8);return s[--d]|=128*h,s},j=function(t,e,n){var i,o=8*n-e-1,r=(1<<o)-1,s=r>>1,a=o-7,u=n-1,l=t[u--],c=127&l;for(l>>=7;a>0;c=256*c+t[u],u--,a-=8);for(i=c&(1<<-a)-1,c>>=-a,a+=e;a>0;i=256*i+t[u],u--,a-=8);if(0===c)c=1-s;else{if(c===r)return i?NaN:l?-E:E;i+=I(2,e),c-=s}return(l?-1:1)*i*I(2,c-e)},U=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},V=function(t){return[255&t]},H=function(t){return[255&t,t>>8&255]},z=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},q=function(t){return N(t,52,8)},W=function(t){return N(t,23,4)},Q=function(t,e,n){f(t[y],e,{get:function(){return this[n]}})},Y=function(t,e,n,i){var o=+n,r=d(o);if(o!=r||0>r||r+e>t[L])throw x(w);var s=t[R]._b,a=r+t[F],u=s.slice(a,a+e);return i?u:u.reverse()},G=function(t,e,n,i,o,r){var s=+n,a=d(s);if(s!=a||0>a||a+e>t[L])throw x(w);for(var u=t[R]._b,l=a+t[F],c=i(+o),h=0;e>h;h++)u[l+h]=c[r?h:e-h-1]},K=function(t,e){c(t,k,b);var n=+e,i=h(n);if(n!=i)throw x(v);return i};if(s.ABV){if(!l(function(){new k})||!l(function(){new k(.5)})){k=function(t){return new P(K(this,t))};for(var J,X=k[y]=P[y],Z=p(P),tt=0;Z.length>tt;)(J=Z[tt++])in k||a(k,J,P[J]);r||(X.constructor=k)}var et=new C(new k(2)),nt=C[y].setInt8;et.setInt8(0,2147483648),et.setInt8(1,2147483649),!et.getInt8(0)&&et.getInt8(1)||u(C[y],{setInt8:function(t,e){nt.call(this,t,e<<24>>24)},setUint8:function(t,e){nt.call(this,t,e<<24>>24)}},!0)}else k=function(t){var e=K(this,t);this._b=m.call(Array(e),0),this[L]=e},C=function(t,e,n){c(this,C,_),c(t,k,_);var i=t[L],o=d(e);if(0>o||o>i)throw x("Wrong offset!");if(n=void 0===n?i-o:h(n),o+n>i)throw x(v);this[R]=t,this[F]=o,this[L]=n},o&&(Q(k,$,"_l"),Q(C,M,"_b"),Q(C,$,"_l"),Q(C,D,"_o")),u(C[y],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var e=Y(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Y(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return U(Y(this,4,t,arguments[1]))},getUint32:function(t){return U(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return j(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return j(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){G(this,1,t,V,e)},setUint8:function(t,e){G(this,1,t,V,e)},setInt16:function(t,e){G(this,2,t,H,e,arguments[2])},setUint16:function(t,e){G(this,2,t,H,e,arguments[2])},setInt32:function(t,e){G(this,4,t,z,e,arguments[2])},setUint32:function(t,e){G(this,4,t,z,e,arguments[2])},setFloat32:function(t,e){G(this,4,t,W,e,arguments[2])},setFloat64:function(t,e){G(this,8,t,q,e,arguments[2])}});g(k,b),g(C,_),a(C[y],s.VIEW,!0),n[b]=k,n[_]=C},{10:10,106:106,108:108,113:113,13:13,29:29,35:35,39:39,41:41,59:59,68:68,72:72,86:86,92:92}],113:[function(t,e,n){for(var i,o=t(39),r=t(41),s=t(114),a=s("typed_array"),u=s("view"),l=!(!o.ArrayBuffer||!o.DataView),c=l,d=0,h=9,p="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");h>d;)(i=o[p[d++]])?(r(i.prototype,a,!0),r(i.prototype,u,!0)):c=!1;e.exports={ABV:l,CONSTR:c,TYPED:a,VIEW:u}},{114:114,39:39,41:41}],114:[function(t,e,n){var i=0,o=Math.random();e.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+o).toString(36))}},{}],115:[function(t,e,n){var i=t(94)("wks"),o=t(114),r=t(39).Symbol,s="function"==typeof r;e.exports=function(t){return i[t]||(i[t]=s&&r[t]||(s?r:o)("Symbol."+t))}},{114:114,39:39,94:94}],116:[function(t,e,n){var i=t(20),o=t(115)("iterator"),r=t(57);e.exports=t(26).getIteratorMethod=function(t){return void 0!=t?t[o]||t["@@iterator"]||r[i(t)]:void 0}},{115:115,20:20,26:26,57:57}],117:[function(t,e,n){var i=t(20),o=t(115)("iterator"),r=t(57);e.exports=t(26).isIterable=function(t){var e=Object(t);return void 0!==e[o]||"@@iterator"in e||r.hasOwnProperty(i(e))}},{115:115,20:20,26:26,57:57}],118:[function(t,e,n){var i=t(33),o=t(88)(/[\\^$*+?.()|[\]{}]/g,"\\$&");i(i.S,"RegExp",{escape:function(t){return o(t)}})},{33:33,88:88}],119:[function(t,e,n){var i=t(33);i(i.P,"Array",{copyWithin:t(12)}),t(9)("copyWithin")},{12:12,33:33,9:9}],120:[function(t,e,n){"use strict";var i=t(33),o=t(16)(4);i(i.P+i.F*!t(96)([].every,!0),"Array",{every:function(t){return o(this,t,arguments[1])}})},{16:16,33:33,96:96}],121:[function(t,e,n){var i=t(33);i(i.P,"Array",{fill:t(13)}),t(9)("fill")},{13:13,33:33,9:9}],122:[function(t,e,n){"use strict";var i=t(33),o=t(16)(2);i(i.P+i.F*!t(96)([].filter,!0),"Array",{filter:function(t){return o(this,t,arguments[1])}})},{16:16,33:33,96:96}],123:[function(t,e,n){"use strict";var i=t(33),o=t(16)(6),r="findIndex",s=!0;r in[]&&Array(1)[r](function(){s=!1}),i(i.P+i.F*s,"Array",{findIndex:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),t(9)(r)},{16:16,33:33,9:9}],124:[function(t,e,n){"use strict";var i=t(33),o=t(16)(5),r="find",s=!0;r in[]&&Array(1)[r](function(){s=!1}),i(i.P+i.F*s,"Array",{find:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),t(9)(r)},{16:16,33:33,9:9}],125:[function(t,e,n){"use strict";var i=t(33),o=t(16)(0),r=t(96)([].forEach,!0);i(i.P+i.F*!r,"Array",{forEach:function(t){return o(this,t,arguments[1])}})},{16:16,33:33,96:96}],126:[function(t,e,n){"use strict";var i=t(27),o=t(33),r=t(109),s=t(52),a=t(47),u=t(108),l=t(116);o(o.S+o.F*!t(55)(function(t){Array.from(t)}),"Array",{from:function(t){var e,n,o,c,d=r(t),h="function"==typeof this?this:Array,p=arguments.length,f=p>1?arguments[1]:void 0,m=void 0!==f,g=0,b=l(d);if(m&&(f=i(f,p>2?arguments[2]:void 0,2)),void 0==b||h==Array&&a(b))for(e=u(d.length),n=new h(e);e>g;g++)n[g]=m?f(d[g],g):d[g];else for(c=b.call(d),n=new h;!(o=c.next()).done;g++)n[g]=m?s(c,f,[o.value,g],!0):o.value;return n.length=g,n}})},{108:108,109:109,116:116,27:27,33:33,47:47,52:52,55:55}],127:[function(t,e,n){"use strict";var i=t(33),o=t(15)(!1);i(i.P+i.F*!t(96)([].indexOf),"Array",{indexOf:function(t){return o(this,t,arguments[1])}})},{15:15,33:33,96:96}],128:[function(t,e,n){var i=t(33);i(i.S,"Array",{isArray:t(48)})},{33:33,48:48}],129:[function(t,e,n){"use strict";var i=t(9),o=t(56),r=t(57),s=t(107);e.exports=t(54)(Array,"Array",function(t,e){this._t=s(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,o(1)):"keys"==e?o(0,n):"values"==e?o(0,t[n]):o(0,[n,t[n]])},"values"),r.Arguments=r.Array,i("keys"),i("values"),i("entries")},{107:107,54:54,56:56,57:57,9:9}],130:[function(t,e,n){"use strict";var i=t(33),o=t(107),r=[].join;i(i.P+i.F*(t(46)!=Object||!t(96)(r)),"Array",{join:function(t){return r.call(o(this),void 0===t?",":t)}})},{107:107,33:33,46:46,96:96}],131:[function(t,e,n){"use strict";var i=t(33),o=t(107),r=t(106),s=t(108);i(i.P+i.F*!t(96)([].lastIndexOf),"Array",{lastIndexOf:function(t){var e=o(this),n=s(e.length),i=n-1;for(arguments.length>1&&(i=Math.min(i,r(arguments[1]))),0>i&&(i=n+i);i>=0;i--)if(i in e&&e[i]===t)return i;return-1}})},{106:106,107:107,108:108,33:33,96:96}],132:[function(t,e,n){"use strict";var i=t(33),o=t(16)(1);i(i.P+i.F*!t(96)([].map,!0),"Array",{map:function(t){return o(this,t,arguments[1])}})},{16:16,33:33,96:96}],133:[function(t,e,n){"use strict";var i=t(33);i(i.S+i.F*t(35)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,e=arguments.length,n=new("function"==typeof this?this:Array)(e);e>t;)n[t]=arguments[t++];return n.length=e,n}})},{33:33,35:35}],134:[function(t,e,n){"use strict";var i=t(33),o=t(17);i(i.P+i.F*!t(96)([].reduceRight,!0),"Array",{reduceRight:function(t){return o(this,t,arguments.length,arguments[1],!0)}})},{17:17,33:33,96:96}],135:[function(t,e,n){"use strict";var i=t(33),o=t(17);i(i.P+i.F*!t(96)([].reduce,!0),"Array",{reduce:function(t){return o(this,t,arguments.length,arguments[1],!1)}})},{17:17,33:33,96:96}],136:[function(t,e,n){"use strict";var i=t(33),o=t(42),r=t(21),s=t(105),a=t(108),u=[].slice;i(i.P+i.F*t(35)(function(){o&&u.call(o)}),"Array",{slice:function(t,e){var n=a(this.length),i=r(this);if(e=void 0===e?n:e,"Array"==i)return u.call(this,t,e);for(var o=s(t,n),l=s(e,n),c=a(l-o),d=Array(c),h=0;c>h;h++)d[h]="String"==i?this.charAt(o+h):this[o+h];return d}})},{105:105,108:108,21:21,33:33,35:35,42:42}],137:[function(t,e,n){"use strict";var i=t(33),o=t(16)(3);i(i.P+i.F*!t(96)([].some,!0),"Array",{some:function(t){return o(this,t,arguments[1])}})},{16:16,33:33,96:96}],138:[function(t,e,n){"use strict";var i=t(33),o=t(7),r=t(109),s=t(35),a=[].sort,u=[1,2,3];i(i.P+i.F*(s(function(){u.sort(void 0)})||!s(function(){u.sort(null)})||!t(96)(a)),"Array",{sort:function(t){return void 0===t?a.call(r(this)):a.call(r(this),o(t))}})},{109:109,33:33,35:35,7:7,96:96}],139:[function(t,e,n){t(91)("Array")},{91:91}],140:[function(t,e,n){var i=t(33);i(i.S,"Date",{now:function(){return+new Date}})},{33:33}],141:[function(t,e,n){"use strict";var i=t(33),o=t(35),r=function(t){return t>9?t:"0"+t};i(i.P+i.F*(o(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!o(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){if(!isFinite(this))throw RangeError("Invalid time value");var t=this,e=t.getUTCFullYear(),n=t.getUTCMilliseconds(),i=0>e?"-":e>9999?"+":"";return i+("00000"+Math.abs(e)).slice(i?-6:-4)+"-"+r(t.getUTCMonth()+1)+"-"+r(t.getUTCDate())+"T"+r(t.getUTCHours())+":"+r(t.getUTCMinutes())+":"+r(t.getUTCSeconds())+"."+(n>99?n:"0"+r(n))+"Z"}})},{33:33,35:35}],142:[function(t,e,n){"use strict";var i=t(33),o=t(109),r=t(110);i(i.P+i.F*t(35)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var e=o(this),n=r(e);return"number"!=typeof n||isFinite(n)?e.toISOString():null}})},{109:109,110:110,33:33,35:35}],143:[function(t,e,n){var i=Date.prototype,o="Invalid Date",r="toString",s=i[r];new Date(NaN)+""!=o&&t(87)(i,r,function(){var t=+this;return t===t?s.call(this):o})},{87:87}],144:[function(t,e,n){var i=t(33);i(i.P,"Function",{bind:t(19)})},{19:19,33:33}],145:[function(t,e,n){"use strict";var i=t(50),o=t(74),r=t(115)("hasInstance"),s=Function.prototype;r in s||t(68).f(s,r,{value:function(t){if("function"!=typeof this||!i(t))return!1;if(!i(this.prototype))return t instanceof this;for(;t=o(t);)if(this.prototype===t)return!0;return!1}})},{115:115,50:50,68:68,74:74}],146:[function(t,e,n){var i=t(68).f,o=t(85),r=t(40),s=Function.prototype,a=/^\s*function ([^ (]*)/,u="name";u in s||t(29)&&i(s,u,{configurable:!0,get:function(){var t=(""+this).match(a),e=t?t[1]:"";return r(this,u)||i(this,u,o(5,e)),e}})},{29:29,40:40,68:68,85:85}],147:[function(t,e,n){"use strict";var i=t(22);e.exports=t(25)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=i.getEntry(this,t);return e&&e.v},set:function(t,e){return i.def(this,0===t?0:t,e)}},i,!0)},{22:22,25:25}],148:[function(t,e,n){var i=t(33),o=t(61),r=Math.sqrt,s=Math.acosh;i(i.S+i.F*!(s&&710==Math.floor(s(Number.MAX_VALUE))),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:o(t-1+r(t-1)*r(t+1))}})},{33:33,61:61}],149:[function(t,e,n){function i(t){return isFinite(t=+t)&&0!=t?0>t?-i(-t):Math.log(t+Math.sqrt(t*t+1)):t}var o=t(33);o(o.S,"Math",{asinh:i})},{33:33}],150:[function(t,e,n){var i=t(33);i(i.S,"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},{33:33}],151:[function(t,e,n){var i=t(33),o=t(62);i(i.S,"Math",{cbrt:function(t){return o(t=+t)*Math.pow(Math.abs(t),1/3)}})},{33:33,62:62}],152:[function(t,e,n){var i=t(33);i(i.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},{33:33}],153:[function(t,e,n){var i=t(33),o=Math.exp;i(i.S,"Math",{cosh:function(t){return(o(t=+t)+o(-t))/2}})},{33:33}],154:[function(t,e,n){var i=t(33);i(i.S,"Math",{expm1:t(60)})},{33:33,60:60}],155:[function(t,e,n){var i=t(33),o=t(62),r=Math.pow,s=r(2,-52),a=r(2,-23),u=r(2,127)*(2-a),l=r(2,-126),c=function(t){return t+1/s-1/s};i(i.S,"Math",{fround:function(t){var e,n,i=Math.abs(t),r=o(t);return l>i?r*c(i/l/a)*l*a:(e=(1+a/s)*i,n=e-(e-i),n>u||n!=n?r*(1/0):r*n)}})},{33:33,62:62}],156:[function(t,e,n){var i=t(33),o=Math.abs;i(i.S,"Math",{hypot:function(t,e){for(var n,i,r=0,s=0,a=arguments.length,u=0;a>s;)n=o(arguments[s++]),n>u?(i=u/n,r=r*i*i+1,u=n):n>0?(i=n/u,r+=i*i):r+=n;return u===1/0?1/0:u*Math.sqrt(r)}})},{33:33}],157:[function(t,e,n){var i=t(33),o=Math.imul;i(i.S+i.F*t(35)(function(){return-5!=o(4294967295,5)||2!=o.length}),"Math",{imul:function(t,e){var n=65535,i=+t,o=+e,r=n&i,s=n&o;return 0|r*s+((n&i>>>16)*s+r*(n&o>>>16)<<16>>>0)}})},{33:33,35:35}],158:[function(t,e,n){var i=t(33);i(i.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},{33:33}],159:[function(t,e,n){var i=t(33);i(i.S,"Math",{log1p:t(61)})},{33:33,61:61}],160:[function(t,e,n){var i=t(33);i(i.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},{33:33}],161:[function(t,e,n){var i=t(33);i(i.S,"Math",{sign:t(62)})},{33:33,62:62}],162:[function(t,e,n){var i=t(33),o=t(60),r=Math.exp;i(i.S+i.F*t(35)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(o(t)-o(-t))/2:(r(t-1)-r(-t-1))*(Math.E/2)}})},{33:33,35:35,60:60}],163:[function(t,e,n){var i=t(33),o=t(60),r=Math.exp;i(i.S,"Math",{tanh:function(t){var e=o(t=+t),n=o(-t);return e==1/0?1:n==1/0?-1:(e-n)/(r(t)+r(-t))}})},{33:33,60:60}],164:[function(t,e,n){var i=t(33);i(i.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},{33:33}],165:[function(t,e,n){"use strict";var i=t(39),o=t(40),r=t(21),s=t(44),a=t(110),u=t(35),l=t(72).f,c=t(70).f,d=t(68).f,h=t(102).trim,p="Number",f=i[p],m=f,g=f.prototype,b=r(t(67)(g))==p,_="trim"in String.prototype,y=function(t){var e=a(t,!1);if("string"==typeof e&&e.length>2){e=_?e.trim():h(e,3);var n,i,o,r=e.charCodeAt(0);if(43===r||45===r){if(n=e.charCodeAt(2),88===n||120===n)return NaN}else if(48===r){switch(e.charCodeAt(1)){case 66:case 98:i=2,o=49;break;case 79:case 111:i=8,o=55;break;default:return+e}for(var s,u=e.slice(2),l=0,c=u.length;c>l;l++)if(s=u.charCodeAt(l),48>s||s>o)return NaN;return parseInt(u,i)}}return+e};if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof f&&(b?u(function(){g.valueOf.call(n)}):r(n)!=p)?s(new m(y(e)),n,f):y(e)};for(var v,w=t(29)?l(m):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),k=0;w.length>k;k++)o(m,v=w[k])&&!o(f,v)&&d(f,v,c(m,v));f.prototype=g,g.constructor=f,t(87)(i,p,f)}},{102:102,110:110,21:21,29:29,35:35,39:39,40:40,44:44,67:67,68:68,70:70,72:72,87:87}],166:[function(t,e,n){var i=t(33);i(i.S,"Number",{EPSILON:Math.pow(2,-52)})},{33:33}],167:[function(t,e,n){var i=t(33),o=t(39).isFinite;i(i.S,"Number",{isFinite:function(t){return"number"==typeof t&&o(t)}})},{33:33,39:39}],168:[function(t,e,n){var i=t(33);i(i.S,"Number",{isInteger:t(49)})},{33:33,49:49}],169:[function(t,e,n){var i=t(33);i(i.S,"Number",{isNaN:function(t){return t!=t}})},{33:33}],170:[function(t,e,n){var i=t(33),o=t(49),r=Math.abs;i(i.S,"Number",{isSafeInteger:function(t){return o(t)&&r(t)<=9007199254740991}})},{33:33,49:49}],171:[function(t,e,n){var i=t(33);i(i.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},{33:33}],172:[function(t,e,n){var i=t(33);i(i.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},{33:33}],173:[function(t,e,n){var i=t(33),o=t(81);i(i.S+i.F*(Number.parseFloat!=o),"Number",{parseFloat:o})},{33:33,81:81}],174:[function(t,e,n){var i=t(33),o=t(82);i(i.S+i.F*(Number.parseInt!=o),"Number",{parseInt:o})},{33:33,82:82}],175:[function(t,e,n){"use strict";var i=t(33),o=(t(10),t(106)),r=t(8),s=t(101),a=1..toFixed,u=Math.floor,l=[0,0,0,0,0,0],c="Number.toFixed: incorrect invocation!",d="0",h=function(t,e){for(var n=-1,i=e;++n<6;)i+=t*l[n],l[n]=i%1e7,i=u(i/1e7)},p=function(t){for(var e=6,n=0;--e>=0;)n+=l[e],l[e]=u(n/t),n=n%t*1e7},f=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==l[t]){var n=String(l[t]);e=""===e?n:e+s.call(d,7-n.length)+n}return e},m=function(t,e,n){return 0===e?n:e%2===1?m(t,e-1,n*t):m(t*t,e/2,n)},g=function(t){for(var e=0,n=t;n>=4096;)e+=12,n/=4096;for(;n>=2;)e+=1,n/=2;return e};i(i.P+i.F*(!!a&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==0xde0b6b3a7640080.toFixed(0))||!t(35)(function(){a.call({})})),"Number",{toFixed:function(t){var e,n,i,a,u=r(this,c),l=o(t),b="",_=d;if(0>l||l>20)throw RangeError(c);if(u!=u)return"NaN";if(-1e21>=u||u>=1e21)return String(u);if(0>u&&(b="-",u=-u),u>1e-21)if(e=g(u*m(2,69,1))-69,n=0>e?u*m(2,-e,1):u/m(2,e,1),n*=4503599627370496,e=52-e,e>0){for(h(0,n),i=l;i>=7;)h(1e7,0),i-=7;for(h(m(10,i,1),0),i=e-1;i>=23;)p(1<<23),i-=23;p(1<<i),h(1,1),p(2),_=f()}else h(0,n),h(1<<-e,0),_=f()+s.call(d,l);return l>0?(a=_.length,_=b+(l>=a?"0."+s.call(d,l-a)+_:_.slice(0,a-l)+"."+_.slice(a-l))):_=b+_,_}})},{10:10,101:101,106:106,33:33,35:35,8:8}],176:[function(t,e,n){"use strict";var i=t(33),o=t(35),r=t(8),s=1..toPrecision;i(i.P+i.F*(o(function(){return"1"!==s.call(1,void 0)})||!o(function(){s.call({})})),"Number",{toPrecision:function(t){var e=r(this,"Number#toPrecision: incorrect invocation!");return void 0===t?s.call(e):s.call(e,t)}})},{33:33,35:35,8:8}],177:[function(t,e,n){var i=t(33);i(i.S+i.F,"Object",{assign:t(66)})},{33:33,66:66}],178:[function(t,e,n){var i=t(33);i(i.S,"Object",{create:t(67)})},{33:33,67:67}],179:[function(t,e,n){var i=t(33);i(i.S+i.F*!t(29),"Object",{defineProperties:t(69)})},{29:29,33:33,69:69}],180:[function(t,e,n){var i=t(33);i(i.S+i.F*!t(29),"Object",{defineProperty:t(68).f})},{29:29,33:33,68:68}],181:[function(t,e,n){var i=t(50),o=t(63).onFreeze;t(78)("freeze",function(t){return function(e){return t&&i(e)?t(o(e)):e}})},{50:50,63:63,78:78}],182:[function(t,e,n){var i=t(107),o=t(70).f;t(78)("getOwnPropertyDescriptor",function(){return function(t,e){return o(i(t),e)}})},{107:107,70:70,78:78}],183:[function(t,e,n){t(78)("getOwnPropertyNames",function(){return t(71).f})},{71:71,78:78}],184:[function(t,e,n){var i=t(109),o=t(74);t(78)("getPrototypeOf",function(){return function(t){return o(i(t))}})},{109:109,74:74,78:78}],185:[function(t,e,n){var i=t(50);t(78)("isExtensible",function(t){return function(e){return i(e)?t?t(e):!0:!1}})},{50:50,78:78}],186:[function(t,e,n){var i=t(50);t(78)("isFrozen",function(t){return function(e){return i(e)?t?t(e):!1:!0}})},{50:50,78:78}],187:[function(t,e,n){var i=t(50);t(78)("isSealed",function(t){return function(e){return i(e)?t?t(e):!1:!0}})},{50:50,78:78}],188:[function(t,e,n){var i=t(33);i(i.S,"Object",{is:t(89)})},{33:33,89:89}],189:[function(t,e,n){var i=t(109),o=t(76);t(78)("keys",function(){return function(t){return o(i(t))}})},{109:109,76:76,78:78}],190:[function(t,e,n){var i=t(50),o=t(63).onFreeze;t(78)("preventExtensions",function(t){return function(e){return t&&i(e)?t(o(e)):e}})},{50:50,63:63,78:78}],191:[function(t,e,n){var i=t(50),o=t(63).onFreeze;t(78)("seal",function(t){return function(e){return t&&i(e)?t(o(e)):e}})},{50:50,63:63,78:78}],192:[function(t,e,n){var i=t(33);i(i.S,"Object",{setPrototypeOf:t(90).set})},{33:33,90:90}],193:[function(t,e,n){"use strict";var i=t(20),o={};o[t(115)("toStringTag")]="z",o+""!="[object z]"&&t(87)(Object.prototype,"toString",function(){return"[object "+i(this)+"]"},!0)},{115:115,20:20,87:87}],194:[function(t,e,n){var i=t(33),o=t(81);i(i.G+i.F*(parseFloat!=o),{parseFloat:o})},{33:33,81:81}],195:[function(t,e,n){var i=t(33),o=t(82);i(i.G+i.F*(parseInt!=o),{parseInt:o})},{33:33,82:82}],196:[function(t,e,n){"use strict";var i,o,r,s=t(59),a=t(39),u=t(27),l=t(20),c=t(33),d=t(50),h=(t(11),t(7)),p=t(10),f=t(38),m=(t(90).set,t(95)),g=t(104).set,b=t(65),_="Promise",y=a.TypeError,v=a.process,w=a[_],k="process"==l(v),C=function(){},S=!!function(){try{var e=w.resolve(1),n=e.constructor=function(t){t(C,C)},i=function(t){t(C,C)};return t(68)(n,t(115)("species"),{value:i}),(k||"function"==typeof PromiseRejectionEvent)&&e.then(C)instanceof i}catch(o){}}(),x=function(t,e){return t===e||t===w&&e===r},E=function(t){var e;return d(t)&&"function"==typeof(e=t.then)?e:!1},P=function(t){return x(w,t)?new T(t):new o(t)},T=o=function(t){var e,n;this.promise=new t(function(t,i){
if(void 0!==e||void 0!==n)throw y("Bad Promise constructor");e=t,n=i}),this.resolve=h(e),this.reject=h(n)},I=function(t){try{t()}catch(e){return{error:e}}},A=function(t,e){if(!t._n){t._n=!0;var n=t._c;b(function(){for(var i=t._v,o=1==t._s,r=0,s=function(e){var n,r,s=o?e.ok:e.fail,a=e.resolve,u=e.reject;try{s?(o||(2==t._h&&M(t),t._h=1),n=s===!0?i:s(i),n===e.promise?u(y("Promise-chain cycle")):(r=E(n))?r.call(n,a,u):a(n)):u(i)}catch(l){u(l)}};n.length>r;)s(n[r++]);t._c=[],t._n=!1,e&&!t._h&&B(t)})}},B=function(t){g.call(a,function(){if(O(t)){var e,n,i=t._v;k?v.emit("unhandledRejection",i,t):(e=a.onunhandledrejection)?e({promise:t,reason:i}):(n=a.console)&&n.error&&n.error("Unhandled promise rejection",i),t._h=2}t._a=void 0})},O=function(t){var e,n=t._a||t._c,i=0;if(1==t._h)return!1;for(;n.length>i;)if(e=n[i++],e.fail||!O(e.promise))return!1;return!0},M=function(t){g.call(a,function(){var e;k?v.emit("rejectionHandled",t):(e=a.onrejectionhandled)&&e({promise:t,reason:t._v})})},$=function(t){var e=this;e._d||(e._d=!0,e=e._w||e,e._v=t,e._s=2,e._a||(e._a=e._c.slice()),A(e,!0))},D=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw y("Promise can't be resolved itself");(e=E(t))?b(function(){var i={_w:n,_d:!1};try{e.call(t,u(D,i,1),u($,i,1))}catch(o){$.call(i,o)}}):(n._v=t,n._s=1,A(n,!1))}catch(i){$.call({_w:n,_d:!1},i)}}};S||(w=function(t){p(this,w,_,"_h"),h(t),i.call(this);try{t(u(D,this,1),u($,this,1))}catch(e){$.call(this,e)}},i=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},i.prototype=t(86)(w.prototype,{then:function(t,e){var n=P(m(this,w));return n.ok="function"==typeof t?t:!0,n.fail="function"==typeof e&&e,this._c.push(n),this._a&&this._a.push(n),this._s&&A(this,!1),n.promise},"catch":function(t){return this.then(void 0,t)}}),T=function(){var t=new i;this.promise=t,this.resolve=u(D,t,1),this.reject=u($,t,1)}),c(c.G+c.W+c.F*!S,{Promise:w}),t(92)(w,_),t(91)(_),r=t(26)[_],c(c.S+c.F*!S,_,{reject:function(t){var e=P(this),n=e.reject;return n(t),e.promise}}),c(c.S+c.F*(s||!S),_,{resolve:function(t){if(t instanceof w&&x(t.constructor,this))return t;var e=P(this),n=e.resolve;return n(t),e.promise}}),c(c.S+c.F*!(S&&t(55)(function(t){w.all(t)["catch"](C)})),_,{all:function(t){var e=this,n=P(e),i=n.resolve,o=n.reject,r=I(function(){var n=[],r=0,s=1;f(t,!1,function(t){var a=r++,u=!1;n.push(void 0),s++,e.resolve(t).then(function(t){u||(u=!0,n[a]=t,--s||i(n))},o)}),--s||i(n)});return r&&o(r.error),n.promise},race:function(t){var e=this,n=P(e),i=n.reject,o=I(function(){f(t,!1,function(t){e.resolve(t).then(n.resolve,i)})});return o&&i(o.error),n.promise}})},{10:10,104:104,11:11,115:115,20:20,26:26,27:27,33:33,38:38,39:39,50:50,55:55,59:59,65:65,68:68,7:7,86:86,90:90,91:91,92:92,95:95}],197:[function(t,e,n){var i=t(33),o=Function.apply;i(i.S,"Reflect",{apply:function(t,e,n){return o.call(t,e,n)}})},{33:33}],198:[function(t,e,n){var i=t(33),o=t(67),r=t(7),s=t(11),a=t(50),u=t(19);i(i.S+i.F*t(35)(function(){function t(){}return!(Reflect.construct(function(){},[],t)instanceof t)}),"Reflect",{construct:function(t,e){r(t);var n=arguments.length<3?t:r(arguments[2]);if(t==n){if(void 0!=e)switch(s(e).length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var i=[null];return i.push.apply(i,e),new(u.apply(t,i))}var l=n.prototype,c=o(a(l)?l:Object.prototype),d=Function.apply.call(t,c,e);return a(d)?d:c}})},{11:11,19:19,33:33,35:35,50:50,67:67,7:7}],199:[function(t,e,n){var i=t(68),o=t(33),r=t(11),s=t(110);o(o.S+o.F*t(35)(function(){Reflect.defineProperty(i.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,e,n){r(t),e=s(e,!0),r(n);try{return i.f(t,e,n),!0}catch(o){return!1}}})},{11:11,110:110,33:33,35:35,68:68}],200:[function(t,e,n){var i=t(33),o=t(70).f,r=t(11);i(i.S,"Reflect",{deleteProperty:function(t,e){var n=o(r(t),e);return n&&!n.configurable?!1:delete t[e]}})},{11:11,33:33,70:70}],201:[function(t,e,n){"use strict";var i=t(33),o=t(11),r=function(t){this._t=o(t),this._i=0;var e,n=this._k=[];for(e in t)n.push(e)};t(53)(r,"Object",function(){var t,e=this,n=e._k;do if(e._i>=n.length)return{value:void 0,done:!0};while(!((t=n[e._i++])in e._t));return{value:t,done:!1}}),i(i.S,"Reflect",{enumerate:function(t){return new r(t)}})},{11:11,33:33,53:53}],202:[function(t,e,n){var i=t(70),o=t(33),r=t(11);o(o.S,"Reflect",{getOwnPropertyDescriptor:function(t,e){return i.f(r(t),e)}})},{11:11,33:33,70:70}],203:[function(t,e,n){var i=t(33),o=t(74),r=t(11);i(i.S,"Reflect",{getPrototypeOf:function(t){return o(r(t))}})},{11:11,33:33,74:74}],204:[function(t,e,n){function i(t,e){var n,a,c=arguments.length<3?t:arguments[2];return l(t)===c?t[e]:(n=o.f(t,e))?s(n,"value")?n.value:void 0!==n.get?n.get.call(c):void 0:u(a=r(t))?i(a,e,c):void 0}var o=t(70),r=t(74),s=t(40),a=t(33),u=t(50),l=t(11);a(a.S,"Reflect",{get:i})},{11:11,33:33,40:40,50:50,70:70,74:74}],205:[function(t,e,n){var i=t(33);i(i.S,"Reflect",{has:function(t,e){return e in t}})},{33:33}],206:[function(t,e,n){var i=t(33),o=t(11),r=Object.isExtensible;i(i.S,"Reflect",{isExtensible:function(t){return o(t),r?r(t):!0}})},{11:11,33:33}],207:[function(t,e,n){var i=t(33);i(i.S,"Reflect",{ownKeys:t(80)})},{33:33,80:80}],208:[function(t,e,n){var i=t(33),o=t(11),r=Object.preventExtensions;i(i.S,"Reflect",{preventExtensions:function(t){o(t);try{return r&&r(t),!0}catch(e){return!1}}})},{11:11,33:33}],209:[function(t,e,n){var i=t(33),o=t(90);o&&i(i.S,"Reflect",{setPrototypeOf:function(t,e){o.check(t,e);try{return o.set(t,e),!0}catch(n){return!1}}})},{33:33,90:90}],210:[function(t,e,n){function i(t,e,n){var u,h,p=arguments.length<4?t:arguments[3],f=r.f(c(t),e);if(!f){if(d(h=s(t)))return i(h,e,n,p);f=l(0)}return a(f,"value")?f.writable!==!1&&d(p)?(u=r.f(p,e)||l(0),u.value=n,o.f(p,e,u),!0):!1:void 0===f.set?!1:(f.set.call(p,n),!0)}var o=t(68),r=t(70),s=t(74),a=t(40),u=t(33),l=t(85),c=t(11),d=t(50);u(u.S,"Reflect",{set:i})},{11:11,33:33,40:40,50:50,68:68,70:70,74:74,85:85}],211:[function(t,e,n){var i=t(39),o=t(44),r=t(68).f,s=t(72).f,a=t(51),u=t(37),l=i.RegExp,c=l,d=l.prototype,h=/a/g,p=/a/g,f=new l(h)!==h;if(t(29)&&(!f||t(35)(function(){return p[t(115)("match")]=!1,l(h)!=h||l(p)==p||"/a/i"!=l(h,"i")}))){l=function(t,e){var n=this instanceof l,i=a(t),r=void 0===e;return!n&&i&&t.constructor===l&&r?t:o(f?new c(i&&!r?t.source:t,e):c((i=t instanceof l)?t.source:t,i&&r?u.call(t):e),n?this:d,l)};for(var m=(function(t){t in l||r(l,t,{configurable:!0,get:function(){return c[t]},set:function(e){c[t]=e}})}),g=s(c),b=0;g.length>b;)m(g[b++]);d.constructor=l,l.prototype=d,t(87)(i,"RegExp",l)}t(91)("RegExp")},{115:115,29:29,35:35,37:37,39:39,44:44,51:51,68:68,72:72,87:87,91:91}],212:[function(t,e,n){t(29)&&"g"!=/./g.flags&&t(68).f(RegExp.prototype,"flags",{configurable:!0,get:t(37)})},{29:29,37:37,68:68}],213:[function(t,e,n){t(36)("match",1,function(t,e,n){return[function(n){"use strict";var i=t(this),o=void 0==n?void 0:n[e];return void 0!==o?o.call(n,i):new RegExp(n)[e](String(i))},n]})},{36:36}],214:[function(t,e,n){t(36)("replace",2,function(t,e,n){return[function(i,o){"use strict";var r=t(this),s=void 0==i?void 0:i[e];return void 0!==s?s.call(i,r,o):n.call(String(r),i,o)},n]})},{36:36}],215:[function(t,e,n){t(36)("search",1,function(t,e,n){return[function(n){"use strict";var i=t(this),o=void 0==n?void 0:n[e];return void 0!==o?o.call(n,i):new RegExp(n)[e](String(i))},n]})},{36:36}],216:[function(t,e,n){t(36)("split",2,function(e,n,i){"use strict";var o=t(51),r=i,s=[].push,a="split",u="length",l="lastIndex";if("c"=="abbc"[a](/(b)*/)[1]||4!="test"[a](/(?:)/,-1)[u]||2!="ab"[a](/(?:ab)*/)[u]||4!="."[a](/(.?)(.?)/)[u]||"."[a](/()()/)[u]>1||""[a](/.?/)[u]){var c=void 0===/()??/.exec("")[1];i=function(t,e){var n=String(this);if(void 0===t&&0===e)return[];if(!o(t))return r.call(n,t,e);var i,a,d,h,p,f=[],m=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),g=0,b=void 0===e?4294967295:e>>>0,_=new RegExp(t.source,m+"g");for(c||(i=new RegExp("^"+_.source+"$(?!\\s)",m));(a=_.exec(n))&&(d=a.index+a[0][u],!(d>g&&(f.push(n.slice(g,a.index)),!c&&a[u]>1&&a[0].replace(i,function(){for(p=1;p<arguments[u]-2;p++)void 0===arguments[p]&&(a[p]=void 0)}),a[u]>1&&a.index<n[u]&&s.apply(f,a.slice(1)),h=a[0][u],g=d,f[u]>=b)));)_[l]===a.index&&_[l]++;return g===n[u]?!h&&_.test("")||f.push(""):f.push(n.slice(g)),f[u]>b?f.slice(0,b):f}}else"0"[a](void 0,0)[u]&&(i=function(t,e){return void 0===t&&0===e?[]:r.call(this,t,e)});return[function(t,o){var r=e(this),s=void 0==t?void 0:t[n];return void 0!==s?s.call(t,r,o):i.call(String(r),t,o)},i]})},{36:36,51:51}],217:[function(t,e,n){"use strict";t(212);var i=t(11),o=t(37),r=t(29),s="toString",a=/./[s],u=function(e){t(87)(RegExp.prototype,s,e,!0)};t(35)(function(){return"/a/b"!=a.call({source:"a",flags:"b"})})?u(function(){var t=i(this);return"/".concat(t.source,"/","flags"in t?t.flags:!r&&t instanceof RegExp?o.call(t):void 0)}):a.name!=s&&u(function(){return a.call(this)})},{11:11,212:212,29:29,35:35,37:37,87:87}],218:[function(t,e,n){"use strict";var i=t(22);e.exports=t(25)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return i.def(this,t=0===t?0:t,t)}},i)},{22:22,25:25}],219:[function(t,e,n){"use strict";t(99)("anchor",function(t){return function(e){return t(this,"a","name",e)}})},{99:99}],220:[function(t,e,n){"use strict";t(99)("big",function(t){return function(){return t(this,"big","","")}})},{99:99}],221:[function(t,e,n){"use strict";t(99)("blink",function(t){return function(){return t(this,"blink","","")}})},{99:99}],222:[function(t,e,n){"use strict";t(99)("bold",function(t){return function(){return t(this,"b","","")}})},{99:99}],223:[function(t,e,n){"use strict";var i=t(33),o=t(97)(!1);i(i.P,"String",{codePointAt:function(t){return o(this,t)}})},{33:33,97:97}],224:[function(t,e,n){"use strict";var i=t(33),o=t(108),r=t(98),s="endsWith",a=""[s];i(i.P+i.F*t(34)(s),"String",{endsWith:function(t){var e=r(this,t,s),n=arguments.length>1?arguments[1]:void 0,i=o(e.length),u=void 0===n?i:Math.min(o(n),i),l=String(t);return a?a.call(e,l,u):e.slice(u-l.length,u)===l}})},{108:108,33:33,34:34,98:98}],225:[function(t,e,n){"use strict";t(99)("fixed",function(t){return function(){return t(this,"tt","","")}})},{99:99}],226:[function(t,e,n){"use strict";t(99)("fontcolor",function(t){return function(e){return t(this,"font","color",e)}})},{99:99}],227:[function(t,e,n){"use strict";t(99)("fontsize",function(t){return function(e){return t(this,"font","size",e)}})},{99:99}],228:[function(t,e,n){var i=t(33),o=t(105),r=String.fromCharCode,s=String.fromCodePoint;i(i.S+i.F*(!!s&&1!=s.length),"String",{fromCodePoint:function(t){for(var e,n=[],i=arguments.length,s=0;i>s;){if(e=+arguments[s++],o(e,1114111)!==e)throw RangeError(e+" is not a valid code point");n.push(65536>e?r(e):r(((e-=65536)>>10)+55296,e%1024+56320))}return n.join("")}})},{105:105,33:33}],229:[function(t,e,n){"use strict";var i=t(33),o=t(98),r="includes";i(i.P+i.F*t(34)(r),"String",{includes:function(t){return!!~o(this,t,r).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},{33:33,34:34,98:98}],230:[function(t,e,n){"use strict";t(99)("italics",function(t){return function(){return t(this,"i","","")}})},{99:99}],231:[function(t,e,n){"use strict";var i=t(97)(!0);t(54)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=i(e,n),this._i+=t.length,{value:t,done:!1})})},{54:54,97:97}],232:[function(t,e,n){"use strict";t(99)("link",function(t){return function(e){return t(this,"a","href",e)}})},{99:99}],233:[function(t,e,n){var i=t(33),o=t(107),r=t(108);i(i.S,"String",{raw:function(t){for(var e=o(t.raw),n=r(e.length),i=arguments.length,s=[],a=0;n>a;)s.push(String(e[a++])),i>a&&s.push(String(arguments[a]));return s.join("")}})},{107:107,108:108,33:33}],234:[function(t,e,n){var i=t(33);i(i.P,"String",{repeat:t(101)})},{101:101,33:33}],235:[function(t,e,n){"use strict";t(99)("small",function(t){return function(){return t(this,"small","","")}})},{99:99}],236:[function(t,e,n){"use strict";var i=t(33),o=t(108),r=t(98),s="startsWith",a=""[s];i(i.P+i.F*t(34)(s),"String",{startsWith:function(t){var e=r(this,t,s),n=o(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),i=String(t);return a?a.call(e,i,n):e.slice(n,n+i.length)===i}})},{108:108,33:33,34:34,98:98}],237:[function(t,e,n){"use strict";t(99)("strike",function(t){return function(){return t(this,"strike","","")}})},{99:99}],238:[function(t,e,n){"use strict";t(99)("sub",function(t){return function(){return t(this,"sub","","")}})},{99:99}],239:[function(t,e,n){"use strict";t(99)("sup",function(t){return function(){return t(this,"sup","","")}})},{99:99}],240:[function(t,e,n){"use strict";t(102)("trim",function(t){return function(){return t(this,3)}})},{102:102}],241:[function(t,e,n){"use strict";var i=t(39),o=t(26),r=t(40),s=t(29),a=t(33),u=t(87),l=t(63).KEY,c=t(35),d=t(94),h=t(92),p=t(114),f=t(115),m=t(58),g=t(32),b=t(48),_=t(11),y=t(107),v=t(110),w=t(85),k=t(67),C=t(71),S=t(70),x=t(68),E=S.f,P=x.f,T=C.f,I=i.Symbol,A=i.JSON,B=A&&A.stringify,O=!1,M=f("_hidden"),$={}.propertyIsEnumerable,D=d("symbol-registry"),R=d("symbols"),L=Object.prototype,F="function"==typeof I,N=s&&c(function(){return 7!=k(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a})?function(t,e,n){var i=E(L,e);i&&delete L[e],P(t,e,n),i&&t!==L&&P(L,e,i)}:P,j=function(t){var e=R[t]=k(I.prototype);return e._k=t,s&&O&&N(L,t,{configurable:!0,set:function(e){r(this,M)&&r(this[M],t)&&(this[M][t]=!1),N(this,t,w(1,e))}}),e},U=function(t){return"symbol"==typeof t},V=function(t,e,n){return _(t),e=v(e,!0),_(n),r(R,e)?(n.enumerable?(r(t,M)&&t[M][e]&&(t[M][e]=!1),n=k(n,{enumerable:w(0,!1)})):(r(t,M)||P(t,M,w(1,{})),t[M][e]=!0),N(t,e,n)):P(t,e,n)},H=function(t,e){_(t);for(var n,i=g(e=y(e)),o=0,r=i.length;r>o;)V(t,n=i[o++],e[n]);return t},z=function(t,e){return void 0===e?k(t):H(k(t),e)},q=function(t){var e=$.call(this,t=v(t,!0));return e||!r(this,t)||!r(R,t)||r(this,M)&&this[M][t]?e:!0},W=function(t,e){var n=E(t=y(t),e=v(e,!0));return!n||!r(R,e)||r(t,M)&&t[M][e]||(n.enumerable=!0),n},Q=function(t){for(var e,n=T(y(t)),i=[],o=0;n.length>o;)r(R,e=n[o++])||e==M||e==l||i.push(e);return i},Y=function(t){for(var e,n=T(y(t)),i=[],o=0;n.length>o;)r(R,e=n[o++])&&i.push(R[e]);return i},G=function(t){if(void 0!==t&&!U(t)){for(var e,n,i=[t],o=1;arguments.length>o;)i.push(arguments[o++]);return e=i[1],"function"==typeof e&&(n=e),!n&&b(e)||(e=function(t,e){return n&&(e=n.call(this,t,e)),U(e)?void 0:e}),i[1]=e,B.apply(A,i)}},K=c(function(){var t=I();return"[null]"!=B([t])||"{}"!=B({a:t})||"{}"!=B(Object(t))});F||(I=function(){if(U(this))throw TypeError("Symbol is not a constructor");return j(p(arguments.length>0?arguments[0]:void 0))},u(I.prototype,"toString",function(){return this._k}),U=function(t){return t instanceof I},S.f=W,x.f=V,t(72).f=C.f=Q,t(77).f=q,t(73).f=Y,s&&!t(59)&&u(L,"propertyIsEnumerable",q,!0)),a(a.G+a.W+a.F*!F,{Symbol:I});for(var J="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),X=0;J.length>X;){var Z=J[X++],tt=o.Symbol,et=f(Z);Z in tt||P(tt,Z,{value:F?et:j(et)})}O=!0,a(a.S+a.F*!F,"Symbol",{"for":function(t){return r(D,t+="")?D[t]:D[t]=I(t)},keyFor:function(t){return m(D,t)},useSetter:function(){O=!0},useSimple:function(){O=!1}}),a(a.S+a.F*!F,"Object",{create:z,defineProperty:V,defineProperties:H,getOwnPropertyDescriptor:W,getOwnPropertyNames:Q,getOwnPropertySymbols:Y}),A&&a(a.S+a.F*(!F||K),"JSON",{stringify:G}),h(I,"Symbol"),h(Math,"Math",!0),h(i.JSON,"JSON",!0)},{107:107,11:11,110:110,114:114,115:115,26:26,29:29,32:32,33:33,35:35,39:39,40:40,48:48,58:58,59:59,63:63,67:67,68:68,70:70,71:71,72:72,73:73,77:77,85:85,87:87,92:92,94:94}],242:[function(t,e,n){"use strict";var i=t(33),o=t(113),r=t(112),s=t(11),a=t(105),u=t(108),l=t(50),c=(t(115)("typed_array"),t(39).ArrayBuffer),d=t(95),h=r.ArrayBuffer,p=r.DataView,f=o.ABV&&c.isView,m=h.prototype.slice,g=o.VIEW,b="ArrayBuffer";i(i.G+i.W+i.F*(c!==h),{ArrayBuffer:h}),i(i.S+i.F*!o.CONSTR,b,{isView:function(t){return f&&f(t)||l(t)&&g in t}}),i(i.P+i.U+i.F*t(35)(function(){return!new h(2).slice(1,void 0).byteLength}),b,{slice:function(t,e){if(void 0!==m&&void 0===e)return m.call(s(this),t);for(var n=s(this).byteLength,i=a(t,n),o=a(void 0===e?n:e,n),r=new(d(this,h))(u(o-i)),l=new p(this),c=new p(r),f=0;o>i;)c.setUint8(f++,l.getUint8(i++));return r}}),t(91)(b)},{105:105,108:108,11:11,112:112,113:113,115:115,33:33,35:35,39:39,50:50,91:91,95:95}],243:[function(t,e,n){var i=t(33);i(i.G+i.W+i.F*!t(113).ABV,{DataView:t(112).DataView})},{112:112,113:113,33:33}],244:[function(t,e,n){t(111)("Float32",4,function(t){return function(e,n,i){return t(this,e,n,i)}})},{111:111}],245:[function(t,e,n){t(111)("Float64",8,function(t){return function(e,n,i){return t(this,e,n,i)}})},{111:111}],246:[function(t,e,n){t(111)("Int16",2,function(t){return function(e,n,i){return t(this,e,n,i)}})},{111:111}],247:[function(t,e,n){t(111)("Int32",4,function(t){return function(e,n,i){return t(this,e,n,i)}})},{111:111}],248:[function(t,e,n){t(111)("Int8",1,function(t){return function(e,n,i){return t(this,e,n,i)}})},{111:111}],249:[function(t,e,n){t(111)("Uint16",2,function(t){return function(e,n,i){return t(this,e,n,i)}})},{111:111}],250:[function(t,e,n){t(111)("Uint32",4,function(t){return function(e,n,i){return t(this,e,n,i)}})},{111:111}],251:[function(t,e,n){t(111)("Uint8",1,function(t){return function(e,n,i){return t(this,e,n,i)}})},{111:111}],252:[function(t,e,n){t(111)("Uint8",1,function(t){return function(e,n,i){return t(this,e,n,i)}},!0)},{111:111}],253:[function(t,e,n){"use strict";var i,o=t(16)(0),r=t(87),s=t(63),a=t(66),u=t(24),l=t(50),c=(t(40),s.getWeak),d=Object.isExtensible,h=u.ufstore,p={},f=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},m={get:function(t){if(l(t)){var e=c(t);return e===!0?h(this).get(t):e?e[this._i]:void 0}},set:function(t,e){return u.def(this,t,e)}},g=e.exports=t(25)("WeakMap",f,m,u,!0,!0);7!=(new g).set((Object.freeze||Object)(p),7).get(p)&&(i=u.getConstructor(f),a(i.prototype,m),s.NEED=!0,o(["delete","has","get","set"],function(t){var e=g.prototype,n=e[t];r(e,t,function(e,o){if(l(e)&&!d(e)){this._f||(this._f=new i);var r=this._f[t](e,o);return"set"==t?this:r}return n.call(this,e,o)})}))},{16:16,24:24,25:25,40:40,50:50,63:63,66:66,87:87}],254:[function(t,e,n){"use strict";var i=t(24);t(25)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return i.def(this,t,!0)}},i,!1,!0)},{24:24,25:25}],255:[function(t,e,n){"use strict";var i=t(33),o=t(15)(!0);i(i.P,"Array",{includes:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),t(9)("includes")},{15:15,33:33,9:9}],256:[function(t,e,n){var i=t(33),o=t(21);i(i.S,"Error",{isError:function(t){return"Error"===o(t)}})},{21:21,33:33}],257:[function(t,e,n){var i=t(33);i(i.P+i.R,"Map",{toJSON:t(23)("Map")})},{23:23,33:33}],258:[function(t,e,n){var i=t(33);i(i.S,"Math",{iaddh:function(t,e,n,i){var o=t>>>0,r=e>>>0,s=n>>>0;return r+(i>>>0)+((o&s|(o|s)&~(o+s>>>0))>>>31)|0}})},{33:33}],259:[function(t,e,n){var i=t(33);i(i.S,"Math",{imulh:function(t,e){var n=65535,i=+t,o=+e,r=i&n,s=o&n,a=i>>16,u=o>>16,l=(a*s>>>0)+(r*s>>>16);return a*u+(l>>16)+((r*u>>>0)+(l&n)>>16)}})},{33:33}],260:[function(t,e,n){var i=t(33);i(i.S,"Math",{isubh:function(t,e,n,i){var o=t>>>0,r=e>>>0,s=n>>>0;return r-(i>>>0)-((~o&s|~(o^s)&o-s>>>0)>>>31)|0}})},{33:33}],261:[function(t,e,n){var i=t(33);i(i.S,"Math",{umulh:function(t,e){var n=65535,i=+t,o=+e,r=i&n,s=o&n,a=i>>>16,u=o>>>16,l=(a*s>>>0)+(r*s>>>16);return a*u+(l>>>16)+((r*u>>>0)+(l&n)>>>16)}})},{33:33}],262:[function(t,e,n){var i=t(33),o=t(79)(!0);i(i.S,"Object",{entries:function(t){return o(t)}})},{33:33,79:79}],263:[function(t,e,n){var i=t(33),o=t(80),r=t(107),s=t(85),a=t(70),u=t(68);i(i.S,"Object",{getOwnPropertyDescriptors:function(t){for(var e,n,i=r(t),l=a.f,c=o(i),d={},h=0;c.length>h;)n=l(i,e=c[h++]),e in d?u.f(d,e,s(0,n)):d[e]=n;return d}})},{107:107,33:33,68:68,70:70,80:80,85:85}],264:[function(t,e,n){var i=t(33),o=t(79)(!1);i(i.S,"Object",{values:function(t){return o(t)}})},{33:33,79:79}],265:[function(t,e,n){var i=t(64),o=t(11),r=i.key,s=i.set;i.exp({defineMetadata:function(t,e,n,i){s(t,e,o(n),r(i))}})},{11:11,64:64}],266:[function(t,e,n){var i=t(64),o=t(11),r=i.key,s=i.map,a=i.store;i.exp({deleteMetadata:function(t,e){var n=arguments.length<3?void 0:r(arguments[2]),i=s(o(e),n,!1);if(void 0===i||!i["delete"](t))return!1;if(i.size)return!0;var u=a.get(e);return u["delete"](n),!!u.size||a["delete"](e)}})},{11:11,64:64}],267:[function(t,e,n){var i=t(218),o=t(14),r=t(64),s=t(11),a=t(74),u=r.keys,l=r.key,c=function(t,e){var n=u(t,e),r=a(t);if(null===r)return n;var s=c(r,e);return s.length?n.length?o(new i(n.concat(s))):s:n};r.exp({getMetadataKeys:function(t){return c(s(t),arguments.length<2?void 0:l(arguments[1]))}})},{11:11,14:14,218:218,64:64,74:74}],268:[function(t,e,n){var i=t(64),o=t(11),r=t(74),s=i.has,a=i.get,u=i.key,l=function(t,e,n){var i=s(t,e,n);if(i)return a(t,e,n);var o=r(e);return null!==o?l(t,o,n):void 0};i.exp({getMetadata:function(t,e){return l(t,o(e),arguments.length<3?void 0:u(arguments[2]))}})},{11:11,64:64,74:74}],269:[function(t,e,n){var i=t(64),o=t(11),r=i.keys,s=i.key;i.exp({getOwnMetadataKeys:function(t){return r(o(t),arguments.length<2?void 0:s(arguments[1]))}})},{11:11,64:64}],270:[function(t,e,n){var i=t(64),o=t(11),r=i.get,s=i.key;i.exp({getOwnMetadata:function(t,e){return r(t,o(e),arguments.length<3?void 0:s(arguments[2]))}})},{11:11,64:64}],271:[function(t,e,n){var i=t(64),o=t(11),r=t(74),s=i.has,a=i.key,u=function(t,e,n){var i=s(t,e,n);if(i)return!0;var o=r(e);return null!==o?u(t,o,n):!1};i.exp({hasMetadata:function(t,e){return u(t,o(e),arguments.length<3?void 0:a(arguments[2]))}})},{11:11,64:64,74:74}],272:[function(t,e,n){var i=t(64),o=t(11),r=i.has,s=i.key;i.exp({hasOwnMetadata:function(t,e){return r(t,o(e),arguments.length<3?void 0:s(arguments[2]))}})},{11:11,64:64}],273:[function(t,e,n){var i=t(64),o=t(11),r=t(7),s=i.key,a=i.set;i.exp({metadata:function(t,e){return function(n,i){a(t,e,(void 0!==i?o:r)(n),s(i))}}})},{11:11,64:64,7:7}],274:[function(t,e,n){var i=t(33);i(i.P+i.R,"Set",{toJSON:t(23)("Set")})},{23:23,33:33}],275:[function(t,e,n){"use strict";var i=t(33),o=t(97)(!0);i(i.P,"String",{at:function(t){return o(this,t)}})},{33:33,97:97}],276:[function(t,e,n){"use strict";var i=t(33),o=t(100);i(i.P,"String",{padEnd:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},{100:100,33:33}],277:[function(t,e,n){"use strict";var i=t(33),o=t(100);i(i.P,"String",{padStart:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},{100:100,33:33}],278:[function(t,e,n){"use strict";t(102)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},{102:102}],279:[function(t,e,n){"use strict";t(102)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},{102:102}],280:[function(t,e,n){var i=t(33);i(i.S,"System",{global:t(39)})},{33:33,39:39}],281:[function(t,e,n){for(var i=t(129),o=t(87),r=t(39),s=t(41),a=t(57),u=t(115),l=u("iterator"),c=u("toStringTag"),d=a.Array,h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],p=0;5>p;p++){var f,m=h[p],g=r[m],b=g&&g.prototype;if(b){b[l]||s(b,l,d),b[c]||s(b,c,m),a[m]=d;for(f in i)b[f]||o(b,f,i[f],!0)}}},{115:115,129:129,39:39,41:41,57:57,87:87}],282:[function(t,e,n){var i=t(33),o=t(104);i(i.G+i.B,{setImmediate:o.set,clearImmediate:o.clear})},{104:104,33:33}],283:[function(t,e,n){var i=t(39),o=t(33),r=t(45),s=t(83),a=i.navigator,u=!!a&&/MSIE .\./.test(a.userAgent),l=function(t){return u?function(e,n){return t(r(s,[].slice.call(arguments,2),"function"==typeof e?e:Function(e)),n)}:t};o(o.G+o.B+o.F*u,{setTimeout:l(i.setTimeout),setInterval:l(i.setInterval)})},{33:33,39:39,45:45,83:83}],284:[function(t,e,n){t(241),t(178),t(180),t(179),t(182),t(184),t(189),t(183),t(181),t(191),t(190),t(186),t(187),t(185),t(177),t(188),t(192),t(193),t(144),t(146),t(145),t(195),t(194),t(165),t(175),t(176),t(166),t(167),t(168),t(169),t(170),t(171),t(172),t(173),t(174),t(148),t(149),t(150),t(151),t(152),t(153),t(154),t(155),t(156),t(157),t(158),t(159),t(160),t(161),t(162),t(163),t(164),t(228),t(233),t(240),t(231),t(223),t(224),t(229),t(234),t(236),t(219),t(220),t(221),t(222),t(225),t(226),t(227),t(230),t(232),t(235),t(237),t(238),t(239),t(140),t(143),t(141),t(142),t(128),t(126),t(133),t(130),t(136),t(138),t(125),t(132),t(122),t(137),t(120),t(135),t(134),t(127),t(131),t(119),t(121),t(124),t(123),t(139),t(129),t(211),t(217),t(212),t(213),t(214),t(215),t(216),t(196),t(147),t(218),t(253),t(254),t(242),t(243),t(248),t(251),t(252),t(246),t(249),t(247),t(250),t(244),t(245),t(197),t(198),t(199),t(200),t(201),t(204),t(202),t(203),t(205),t(206),t(207),t(208),t(210),t(209),t(255),t(275),t(277),t(276),t(278),t(279),t(263),t(264),t(262),t(257),t(274),t(280),t(256),t(258),t(260),t(259),t(261),t(265),t(266),t(268),t(267),t(270),t(269),t(271),t(272),t(273),t(283),t(282),t(281),e.exports=t(26)},{119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,127:127,128:128,129:129,130:130,131:131,132:132,133:133,134:134,135:135,136:136,137:137,138:138,139:139,140:140,141:141,142:142,143:143,144:144,145:145,146:146,147:147,148:148,149:149,150:150,151:151,152:152,153:153,154:154,155:155,156:156,157:157,158:158,159:159,160:160,161:161,162:162,163:163,164:164,165:165,166:166,167:167,168:168,169:169,170:170,171:171,172:172,173:173,174:174,175:175,176:176,177:177,178:178,179:179,180:180,181:181,182:182,183:183,184:184,185:185,186:186,187:187,188:188,189:189,190:190,191:191,192:192,193:193,194:194,195:195,196:196,197:197,198:198,199:199,200:200,201:201,202:202,203:203,204:204,205:205,206:206,207:207,208:208,209:209,210:210,211:211,212:212,213:213,214:214,215:215,216:216,217:217,218:218,219:219,220:220,221:221,222:222,223:223,224:224,225:225,226:226,227:227,228:228,229:229,230:230,231:231,232:232,233:233,234:234,235:235,236:236,237:237,238:238,239:239,240:240,241:241,242:242,243:243,244:244,245:245,246:246,247:247,248:248,249:249,250:250,251:251,252:252,253:253,254:254,255:255,256:256,257:257,258:258,259:259,26:26,260:260,261:261,262:262,263:263,264:264,265:265,266:266,267:267,268:268,269:269,270:270,271:271,272:272,273:273,274:274,275:275,276:276,277:277,278:278,279:279,280:280,281:281,282:282,283:283}],285:[function(t,e,n){(function(t){!function(t){"use strict";function n(t,e,n,i){var r=Object.create((e||o).prototype),s=new p(i||[]);return r._invoke=c(t,n,s),r}function i(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(i){return{type:"throw",arg:i}}}function o(){}function r(){}function s(){}function a(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function u(t){this.arg=t}function l(t){function e(e,n){var i=t[e](n),s=i.value;return s instanceof u?Promise.resolve(s.arg).then(o,r):Promise.resolve(s).then(function(t){return i.value=t,i})}function n(t,n){function o(){return e(t,n)}return i=i?i.then(o,o):new Promise(function(t){t(o())})}"object"==typeof process&&process.domain&&(e=process.domain.bind(e));var i,o=e.bind(t,"next"),r=e.bind(t,"throw");e.bind(t,"return"),this._invoke=n}function c(t,e,n){var o=w;return function(r,s){if(o===C)throw new Error("Generator is already running");if(o===S){if("throw"===r)throw s;return m()}for(;;){var a=n.delegate;if(a){if("return"===r||"throw"===r&&a.iterator[r]===g){n.delegate=null;var u=a.iterator["return"];if(u){var l=i(u,a.iterator,s);if("throw"===l.type){r="throw",s=l.arg;continue}}if("return"===r)continue}var l=i(a.iterator[r],a.iterator,s);if("throw"===l.type){n.delegate=null,r="throw",s=l.arg;continue}r="next",s=g;var c=l.arg;if(!c.done)return o=k,c;n[a.resultName]=c.value,n.next=a.nextLoc,n.delegate=null}if("next"===r)n._sent=s,o===k?n.sent=s:n.sent=g;else if("throw"===r){if(o===w)throw o=S,s;n.dispatchException(s)&&(r="next",s=g)}else"return"===r&&n.abrupt("return",s);o=C;var l=i(t,e,n);if("normal"===l.type){o=n.done?S:k;var c={value:l.arg,done:n.done};if(l.arg!==x)return c;n.delegate&&"next"===r&&(s=g)}else"throw"===l.type&&(o=S,r="throw",s=l.arg)}}}function d(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function h(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(d,this),this.reset(!0)}function f(t){if(t){var e=t[_];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function o(){for(;++n<t.length;)if(b.call(t,n))return o.value=t[n],o.done=!1,o;return o.value=g,o.done=!0,o};return i.next=i}}return{next:m}}function m(){return{value:g,done:!0}}var g,b=Object.prototype.hasOwnProperty,_="function"==typeof Symbol&&Symbol.iterator||"@@iterator",y="object"==typeof e,v=t.regeneratorRuntime;if(v)return void(y&&(e.exports=v));v=t.regeneratorRuntime=y?e.exports:{},v.wrap=n;var w="suspendedStart",k="suspendedYield",C="executing",S="completed",x={},E=s.prototype=o.prototype;r.prototype=E.constructor=s,s.constructor=r,r.displayName="GeneratorFunction",v.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return e?e===r||"GeneratorFunction"===(e.displayName||e.name):!1},v.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):t.__proto__=s,t.prototype=Object.create(E),t},v.awrap=function(t){return new u(t)},a(l.prototype),v.async=function(t,e,i,o){var r=new l(n(t,e,i,o));return v.isGeneratorFunction(e)?r:r.next().then(function(t){return t.done?t.value:r.next()})},a(E),E[_]=function(){return this},E.toString=function(){return"[object Generator]"},v.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},v.values=f,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=g,this.done=!1,this.delegate=null,this.tryEntries.forEach(h),!t)for(var e in this)"t"===e.charAt(0)&&b.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){function e(e,i){return r.type="throw",r.arg=t,n.next=e,!!i}if(this.done)throw t;for(var n=this,i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],r=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var s=b.call(o,"catchLoc"),a=b.call(o,"finallyLoc");if(s&&a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&b.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=t,r.arg=e,o?this.next=o.finallyLoc:this.complete(r),x},complete:function(t,e){if("throw"===t.type)throw t.arg;"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=t.arg,this.next="end"):"normal"===t.type&&e&&(this.next=e)},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),h(n),x}},"catch":function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;h(n)}return o}}throw new Error("illegal catch attempt")},
delegateYield:function(t,e,n){return this.delegate={iterator:f(t),resultName:e,nextLoc:n},x}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]),window.define=function(t){try{delete window.define}catch(e){window.define=void 0}window.when=t()},window.define.amd={},function(t,e){"use strict";t(function(){function t(t,e,n,o){return i(t).then(e,n,o)}function n(t,e){this._message=t,this.inspect=e}function i(t){return s(function(e){e(t)})}function o(e){return t(e,l)}function r(){function t(t,r,s){e.resolve=e.resolver.resolve=function(e){return o?i(e):(o=!0,t(e),n)},e.reject=e.resolver.reject=function(t){return o?i(l(t)):(o=!0,r(t),n)},e.notify=e.resolver.notify=function(t){return s(t),t}}var e,n,o;return e={promise:V,resolve:V,reject:V,notify:V,resolver:{resolve:V,reject:V,notify:V}},e.promise=n=s(t),e}function s(t){return a(t,U.PromiseStatus&&U.PromiseStatus())}function a(t,e){function i(t,e,n,i){function o(o){o._message(t,e,n,i)}b?b.push(o):I(function(){o(f)})}function o(){return f?f.inspect():T()}function r(t,n,o){var r=arguments;return a(function(t,e,n){i("when",r,t,n)},e&&e.observed())}function s(t){b&&(f=h(t),m(b,f),b=V,e&&g(f,e))}function u(t){s(l(t))}function c(t){b&&m(b,d(t))}var p,f,b=[];p=new n(i,o),p.then=r;try{t(s,u,c)}catch(_){u(_)}return p}function u(t){return c(new p(t),function(){return E(t)})}function l(t){return c(new f(t),function(){return P(t)})}function c(t,e){return new n(function(e,n,i){try{i(t[e].apply(t,n))}catch(o){i(l(o))}},e)}function d(t){return new n(function(e,n,i,o){var r=n[2];try{o("function"==typeof r?r(t):t)}catch(s){o(s)}})}function h(t){return t instanceof n?t:t===Object(t)&&"then"in t?s(function(e,n,i){I(function(){try{var o=t.then;"function"==typeof o?$(o,t,e,n,i):e(u(t))}catch(r){n(r)}})}):u(t)}function p(t){this.value=t}function f(t){this.reason=t}function m(t,e){I(function(){for(var n,i=0;n=t[i++];)n(e)})}function g(t,e){t._message("when",[function(){e.fulfilled()},function(t){e.rejected(t)}],B,B)}function b(t){return t&&"function"==typeof t.then}function _(e,n,i,o,r){return t(e,function(e){function a(i,o,r){function s(t){p(t)}function a(t){h(t)}var u,l,c,d,h,p,f,m;if(f=e.length>>>0,u=Math.max(0,Math.min(n,f)),c=[],l=f-u+1,d=[],u)for(p=function(t){d.push(t),--l||(h=p=B,o(d))},h=function(t){c.push(t),--u||(h=p=B,i(c))},m=0;f>m;++m)m in e&&t(e[m],a,s,r);else i(c)}return s(a).then(i,o,r)})}function y(t,e,n,i){function o(t){return e?e(t[0]):t[0]}return _(t,1,o,n,i)}function v(t,e,n,i){return S(t,B).then(e,n,i)}function w(){return S(arguments,B)}function k(t){return S(t,E,P)}function C(t,e){return S(t,e)}function S(e,n,i){return t(e,function(e){function o(o,r,s){function a(e,a){t(e,n,i).then(function(t){u[a]=t,s(t),--c||o(u)},r)}var u,l,c,d;if(c=l=e.length>>>0,u=[],!c)return void o(u);for(d=0;l>d;d++)d in e?a(e[d],d):--c}return s(o)})}function x(e,n){var i=$(M,arguments,1);return t(e,function(e){var o;return o=e.length,i[0]=function(e,i,r){return t(e,function(e){return t(i,function(t){return n(e,t,r,o)})})},O.apply(e,i)})}function E(t){return{state:"fulfilled",value:t}}function P(t){return{state:"rejected",reason:t}}function T(){return{state:"pending"}}function I(t){1===R.push(t)&&D(A)}function A(){for(var t,e=0;t=R[e++];)t();R=[]}function B(t){return t}t.promise=s,t.resolve=i,t.reject=o,t.defer=r,t.join=w,t.all=v,t.map=C,t.reduce=x,t.settle=k,t.any=y,t.some=_,t.isPromise=b,n.prototype={otherwise:function(t){return this.then(V,t)},ensure:function(t){function e(){return i(t())}return this.then(e,e)["yield"](this)},"yield":function(t){return this.then(function(){return t})},tap:function(t){return this.then(t)["yield"](this)},spread:function(t){return this.then(function(e){return v(e,function(e){return t.apply(V,e)})})},always:function(t,e){return this.then(t,t,e)}},p.prototype.when=function(t){return"function"==typeof t?t(this.value):this.value},f.prototype.when=function(t,e){if("function"==typeof e)return e(this.reason);throw this.reason};var O,M,$,D,R,L,F,N,j,U,V;if(R=[],L=e.setTimeout,U="undefined"!=typeof console?console:t,"function"==typeof setImmediate)D=setImmediate.bind(e);else if("undefined"!=typeof MessageChannel){var H=new MessageChannel;H.port1.onmessage=A,D=function(){H.port2.postMessage(0)}}else D="object"==typeof process&&process.nextTick?process.nextTick:"object"==typeof vertx?vertx.runOnLoop:function(t){L(t,0)};return F=Function.prototype,N=F.call,$=F.bind?N.bind(N):function(t,e){return t.apply(e,M.call(arguments,2))},j=[],M=j.slice,O=j.reduce||function(t){var e,n,i,o,r;if(r=0,e=Object(this),o=e.length>>>0,n=arguments,n.length<=1)for(;;){if(r in e){i=e[r++];break}if(++r>=o)throw new TypeError}else i=n[1];for(;o>r;++r)r in e&&(i=t(i,e[r],r,e));return i},t})}("function"==typeof define&&define.amd?define:function(t){module.exports=t()},this);var docCookies={getItem:function(t){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(t,e,n,i,o,r){if(!t||/^(?:expires|max\-age|path|domain|secure)$/i.test(t))return!1;var s="";if(n)switch(n.constructor){case Number:s=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:s="; expires="+n;break;case Date:s="; expires="+n.toUTCString()}return document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+s+(o?"; domain="+o:"")+(i?"; path="+i:"")+(r?"; secure":""),!0},removeItem:function(t,e,n){return t&&this.hasItem(t)?(document.cookie=encodeURIComponent(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(e?"; path="+e:""),!0):!1},hasItem:function(t){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var t=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),e=0;e<t.length;e++)t[e]=decodeURIComponent(t[e]);return t}};!function(){function t(e,n){e instanceof t?(this.enc=e.enc,this.pos=e.pos):(this.enc=e,this.pos=n)}function e(t,e,n,i,o){this.stream=t,this.header=e,this.length=n,this.tag=i,this.sub=o}function n(t){var e,n,i="";for(e=0;e+3<=t.length;e+=3)n=parseInt(t.substring(e,e+3),16),i+=et.charAt(n>>6)+et.charAt(63&n);for(e+1==t.length?(n=parseInt(t.substring(e,e+1),16),i+=et.charAt(n<<2)):e+2==t.length&&(n=parseInt(t.substring(e,e+2),16),i+=et.charAt(n>>2)+et.charAt((3&n)<<4));(3&i.length)>0;)i+=nt;return i}function i(t){var e,n,i,o="",r=0;for(e=0;e<t.length&&t.charAt(e)!=nt;++e)i=et.indexOf(t.charAt(e)),0>i||(0==r?(o+=c(i>>2),n=3&i,r=1):1==r?(o+=c(n<<2|i>>4),n=15&i,r=2):2==r?(o+=c(n),o+=c(i>>2),n=3&i,r=3):(o+=c(n<<2|i>>4),o+=c(15&i),r=0));return 1==r&&(o+=c(n<<2)),o}function o(t){var e,n=i(t),o=new Array;for(e=0;2*e<n.length;++e)o[e]=parseInt(n.substring(2*e,2*e+2),16);return o}function r(t,e,n){null!=t&&("number"==typeof t?this.fromNumber(t,e,n):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function s(){return new r(null)}function a(t,e,n,i,o,r){for(;--r>=0;){var s=e*this[t++]+n[i]+o;o=Math.floor(s/67108864),n[i++]=67108863&s}return o}function u(t,e,n,i,o,r){for(var s=32767&e,a=e>>15;--r>=0;){var u=32767&this[t],l=this[t++]>>15,c=a*u+l*s;u=s*u+((32767&c)<<15)+n[i]+(1073741823&o),o=(u>>>30)+(c>>>15)+a*l+(o>>>30),n[i++]=1073741823&u}return o}function l(t,e,n,i,o,r){for(var s=16383&e,a=e>>14;--r>=0;){var u=16383&this[t],l=this[t++]>>14,c=a*u+l*s;u=s*u+((16383&c)<<14)+n[i]+o,o=(u>>28)+(c>>14)+a*l,n[i++]=268435455&u}return o}function c(t){return ut.charAt(t)}function d(t,e){var n=lt[t.charCodeAt(e)];return null==n?-1:n}function h(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function p(t){this.t=1,this.s=0>t?-1:0,t>0?this[0]=t:-1>t?this[0]=t+this.DV:this.t=0}function f(t){var e=s();return e.fromInt(t),e}function m(t,e){var n;if(16==e)n=4;else if(8==e)n=3;else if(256==e)n=8;else if(2==e)n=1;else if(32==e)n=5;else{if(4!=e)return void this.fromRadix(t,e);n=2}this.t=0,this.s=0;for(var i=t.length,o=!1,s=0;--i>=0;){var a=8==n?255&t[i]:d(t,i);0>a?"-"==t.charAt(i)&&(o=!0):(o=!1,0==s?this[this.t++]=a:s+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-s)-1)<<s,this[this.t++]=a>>this.DB-s):this[this.t-1]|=a<<s,s+=n,s>=this.DB&&(s-=this.DB))}8==n&&0!=(128&t[0])&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),o&&r.ZERO.subTo(this,this)}function g(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}function b(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var n,i=(1<<e)-1,o=!1,r="",s=this.t,a=this.DB-s*this.DB%e;if(s-- >0)for(a<this.DB&&(n=this[s]>>a)>0&&(o=!0,r=c(n));s>=0;)e>a?(n=(this[s]&(1<<a)-1)<<e-a,n|=this[--s]>>(a+=this.DB-e)):(n=this[s]>>(a-=e)&i,0>=a&&(a+=this.DB,--s)),n>0&&(o=!0),o&&(r+=c(n));return o?r:"0"}function _(){var t=s();return r.ZERO.subTo(this,t),t}function y(){return this.s<0?this.negate():this}function v(t){var e=this.s-t.s;if(0!=e)return e;var n=this.t;if(e=n-t.t,0!=e)return this.s<0?-e:e;for(;--n>=0;)if(0!=(e=this[n]-t[n]))return e;return 0}function w(t){var e,n=1;return 0!=(e=t>>>16)&&(t=e,n+=16),0!=(e=t>>8)&&(t=e,n+=8),0!=(e=t>>4)&&(t=e,n+=4),0!=(e=t>>2)&&(t=e,n+=2),0!=(e=t>>1)&&(t=e,n+=1),n}function k(){return this.t<=0?0:this.DB*(this.t-1)+w(this[this.t-1]^this.s&this.DM)}function C(t,e){var n;for(n=this.t-1;n>=0;--n)e[n+t]=this[n];for(n=t-1;n>=0;--n)e[n]=0;e.t=this.t+t,e.s=this.s}function S(t,e){for(var n=t;n<this.t;++n)e[n-t]=this[n];e.t=Math.max(this.t-t,0),e.s=this.s}function x(t,e){var n,i=t%this.DB,o=this.DB-i,r=(1<<o)-1,s=Math.floor(t/this.DB),a=this.s<<i&this.DM;for(n=this.t-1;n>=0;--n)e[n+s+1]=this[n]>>o|a,a=(this[n]&r)<<i;for(n=s-1;n>=0;--n)e[n]=0;e[s]=a,e.t=this.t+s+1,e.s=this.s,e.clamp()}function E(t,e){e.s=this.s;var n=Math.floor(t/this.DB);if(n>=this.t)return void(e.t=0);var i=t%this.DB,o=this.DB-i,r=(1<<i)-1;e[0]=this[n]>>i;for(var s=n+1;s<this.t;++s)e[s-n-1]|=(this[s]&r)<<o,e[s-n]=this[s]>>i;i>0&&(e[this.t-n-1]|=(this.s&r)<<o),e.t=this.t-n,e.clamp()}function P(t,e){for(var n=0,i=0,o=Math.min(t.t,this.t);o>n;)i+=this[n]-t[n],e[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i-=t.s;n<this.t;)i+=this[n],e[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i-=t[n],e[n++]=i&this.DM,i>>=this.DB;i-=t.s}e.s=0>i?-1:0,-1>i?e[n++]=this.DV+i:i>0&&(e[n++]=i),e.t=n,e.clamp()}function T(t,e){var n=this.abs(),i=t.abs(),o=n.t;for(e.t=o+i.t;--o>=0;)e[o]=0;for(o=0;o<i.t;++o)e[o+n.t]=n.am(0,i[o],e,o,0,n.t);e.s=0,e.clamp(),this.s!=t.s&&r.ZERO.subTo(e,e)}function I(t){for(var e=this.abs(),n=t.t=2*e.t;--n>=0;)t[n]=0;for(n=0;n<e.t-1;++n){var i=e.am(n,e[n],t,2*n,0,1);(t[n+e.t]+=e.am(n+1,2*e[n],t,2*n+1,i,e.t-n-1))>=e.DV&&(t[n+e.t]-=e.DV,t[n+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(n,e[n],t,2*n,0,1)),t.s=0,t.clamp()}function A(t,e,n){var i=t.abs();if(!(i.t<=0)){var o=this.abs();if(o.t<i.t)return null!=e&&e.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=s());var a=s(),u=this.s,l=t.s,c=this.DB-w(i[i.t-1]);c>0?(i.lShiftTo(c,a),o.lShiftTo(c,n)):(i.copyTo(a),o.copyTo(n));var d=a.t,h=a[d-1];if(0!=h){var p=h*(1<<this.F1)+(d>1?a[d-2]>>this.F2:0),f=this.FV/p,m=(1<<this.F1)/p,g=1<<this.F2,b=n.t,_=b-d,y=null==e?s():e;for(a.dlShiftTo(_,y),n.compareTo(y)>=0&&(n[n.t++]=1,n.subTo(y,n)),r.ONE.dlShiftTo(d,y),y.subTo(a,a);a.t<d;)a[a.t++]=0;for(;--_>=0;){var v=n[--b]==h?this.DM:Math.floor(n[b]*f+(n[b-1]+g)*m);if((n[b]+=a.am(0,v,n,_,0,d))<v)for(a.dlShiftTo(_,y),n.subTo(y,n);n[b]<--v;)n.subTo(y,n)}null!=e&&(n.drShiftTo(d,e),u!=l&&r.ZERO.subTo(e,e)),n.t=d,n.clamp(),c>0&&n.rShiftTo(c,n),0>u&&r.ZERO.subTo(n,n)}}}function B(t){var e=s();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(r.ZERO)>0&&t.subTo(e,e),e}function O(t){this.m=t}function M(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function $(t){return t}function D(t){t.divRemTo(this.m,null,t)}function R(t,e,n){t.multiplyTo(e,n),this.reduce(n)}function L(t,e){t.squareTo(e),this.reduce(e)}function F(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return e=e*(2-(15&t)*e)&15,e=e*(2-(255&t)*e)&255,e=e*(2-((65535&t)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function N(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function j(t){var e=s();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(r.ZERO)>0&&this.m.subTo(e,e),e}function U(t){var e=s();return t.copyTo(e),this.reduce(e),e}function V(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var n=32767&t[e],i=n*this.mpl+((n*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(n=e+this.m.t,t[n]+=this.m.am(0,i,t,e,0,this.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function H(t,e){t.squareTo(e),this.reduce(e)}function z(t,e,n){t.multiplyTo(e,n),this.reduce(n)}function q(){return 0==(this.t>0?1&this[0]:this.s)}function W(t,e){if(t>4294967295||1>t)return r.ONE;var n=s(),i=s(),o=e.convert(this),a=w(t)-1;for(o.copyTo(n);--a>=0;)if(e.sqrTo(n,i),(t&1<<a)>0)e.mulTo(i,o,n);else{var u=n;n=i,i=u}return e.revert(n)}function Q(t,e){var n;return n=256>t||e.isEven()?new O(e):new N(e),this.exp(t,n)}function Y(t,e){return new r(t,e)}function G(t,e){if(e<t.length+11)throw new Error("Message too long for RSA");for(var n=new Array,i=t.length-1;i>=0&&e>0;){var o=t.charCodeAt(i--);128>o?n[--e]=o:o>127&&2048>o?(n[--e]=63&o|128,n[--e]=o>>6|192):(n[--e]=63&o|128,n[--e]=o>>6&63|128,n[--e]=o>>12|224)}n[--e]=0;for(var s=0,a=0,u=0;e>2;)0==u&&(a=ct.random.randomWords(1,0)[0]),s=a>>u&255,u=(u+8)%32,0!=s&&(n[--e]=s);return n[--e]=2,n[--e]=0,new r(n)}function K(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function J(t,e){if(!(null!=t&&null!=e&&t.length>0&&e.length>0))throw new Error("Invalid RSA public key");this.n=Y(t,16),this.e=parseInt(e,16)}function X(t){return t.modPowInt(this.e,this.n)}function Z(t){var e=G(t,this.n.bitLength()+7>>3);if(null==e)return null;var n=this.doPublic(e);if(null==n)return null;var i=n.toString(16);return 0==(1&i.length)?i:"0"+i}t.prototype.get=function(t){if(void 0==t&&(t=this.pos++),t>=this.enc.length)throw"Requesting byte offset "+t+" on a stream of length "+this.enc.length;return this.enc[t]},t.prototype.hexDigits="0123456789ABCDEF",t.prototype.hexByte=function(t){return this.hexDigits.charAt(t>>4&15)+this.hexDigits.charAt(15&t)},t.prototype.hexDump=function(t,e){for(var n="",i=t;e>i;++i)switch(n+=this.hexByte(this.get(i)),15&i){case 7:n+="  ";break;case 15:n+="\n";break;default:n+=" "}return n},t.prototype.parseStringISO=function(t,e){for(var n="",i=t;e>i;++i)n+=String.fromCharCode(this.get(i));return n},t.prototype.parseStringUTF=function(t,e){for(var n="",i=0,o=t;e>o;){var i=this.get(o++);n+=String.fromCharCode(128>i?i:i>191&&224>i?(31&i)<<6|63&this.get(o++):(15&i)<<12|(63&this.get(o++))<<6|63&this.get(o++))}return n},t.prototype.reTime=/^((?:1[89]|2\d)?\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,t.prototype.parseTime=function(t,e){var n=this.parseStringISO(t,e),i=this.reTime.exec(n);return i?(n=i[1]+"-"+i[2]+"-"+i[3]+" "+i[4],i[5]&&(n+=":"+i[5],i[6]&&(n+=":"+i[6],i[7]&&(n+="."+i[7]))),i[8]&&(n+=" UTC","Z"!=i[8]&&(n+=i[8],i[9]&&(n+=":"+i[9]))),n):"Unrecognized time: "+n},t.prototype.parseInteger=function(t,e){var n=e-t;if(n>4){n<<=3;var i=this.get(t);if(0==i)n-=8;else for(;128>i;)i<<=1,--n;return"("+n+" bit)"}for(var o=0,r=t;e>r;++r)o=o<<8|this.get(r);return o},t.prototype.parseBitString=function(t,e){var n=this.get(t),i=(e-t-1<<3)-n,o="("+i+" bit)";if(20>=i){var r=n;o+=" ";for(var s=e-1;s>t;--s){for(var a=this.get(s),u=r;8>u;++u)o+=a>>u&1?"1":"0";r=0}}return o},t.prototype.parseOctetString=function(t,e){var n=e-t,i="("+n+" byte) ";n>20&&(e=t+20);for(var o=t;e>o;++o)i+=this.hexByte(this.get(o));return n>20&&(i+=String.fromCharCode(8230)),i},t.prototype.parseOID=function(t,e){for(var n,i=0,o=0,r=t;e>r;++r){var s=this.get(r);i=i<<7|127&s,o+=7,128&s||(void 0==n?n=parseInt(i/40)+"."+i%40:n+="."+(o>=31?"bigint":i),i=o=0),n+=String.fromCharCode()}return n},e.prototype.typeName=function(){if(void 0==this.tag)return"unknown";var t=this.tag>>6,e=(this.tag>>5&1,31&this.tag);switch(t){case 0:switch(e){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString";default:return"Universal_"+e.toString(16)}case 1:return"Application_"+e.toString(16);case 2:return"["+e+"]";case 3:return"Private_"+e.toString(16)}},e.prototype.content=function(){if(void 0==this.tag)return null;var t=this.tag>>6;if(0!=t)return null==this.sub?null:"("+this.sub.length+")";var e=31&this.tag,n=this.posContent(),i=Math.abs(this.length);switch(e){case 1:return 0==this.stream.get(n)?"false":"true";case 2:return this.stream.parseInteger(n,n+i);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(n,n+i);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(n,n+i);case 6:return this.stream.parseOID(n,n+i);case 16:case 17:return"("+this.sub.length+" elem)";case 12:return this.stream.parseStringUTF(n,n+i);case 18:case 19:case 20:case 21:case 22:case 26:return this.stream.parseStringISO(n,n+i);case 23:case 24:return this.stream.parseTime(n,n+i)}return null},e.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null==this.sub?"null":this.sub.length)+"]"},e.prototype.print=function(t){if(void 0==t&&(t=""),document.writeln(t+this),null!=this.sub){t+="  ";for(var e=0,n=this.sub.length;n>e;++e)this.sub[e].print(t)}},e.prototype.toPrettyString=function(t){void 0==t&&(t="");var e=t+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(e+="+"),e+=this.length,32&this.tag?e+=" (constructed)":3!=this.tag&&4!=this.tag||null==this.sub||(e+=" (encapsulates)"),e+="\n",null!=this.sub){t+="  ";for(var n=0,i=this.sub.length;i>n;++n)e+=this.sub[n].toPrettyString(t)}return e},e.prototype.posStart=function(){return this.stream.pos},e.prototype.posContent=function(){return this.stream.pos+this.header},e.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},e.decodeLength=function(t){var e=t.get(),n=127&e;if(n==e)return n;if(n>3)throw"Length over 24 bits not supported at position "+(t.pos-1);if(0==n)return-1;e=0;for(var i=0;n>i;++i)e=e<<8|t.get();return e},e.hasContent=function(n,i,o){if(32&n)return!0;if(3>n||n>4)return!1;var r=new t(o);3==n&&r.get();var s=r.get();if(s>>6&1)return!1;try{var a=e.decodeLength(r);return r.pos-o.pos+a==i}catch(u){return!1}},e.decode=function(n){n instanceof t||(n=new t(n,0));var i=new t(n),o=n.get(),r=e.decodeLength(n),s=n.pos-i.pos,a=null;if(e.hasContent(o,r,n)){var u=n.pos;if(3==o&&n.get(),a=[],r>=0){for(var l=u+r;n.pos<l;)a[a.length]=e.decode(n);if(n.pos!=l)throw"Content size is not correct for container starting at offset "+u}else try{for(;;){var c=e.decode(n);if(0==c.tag)break;a[a.length]=c}r=u-n.pos}catch(d){throw"Exception while decoding undefined length content: "+d}}else n.pos+=r;return new e(i,s,r,o,a)};var tt,et="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",nt="=",it=0xdeadbeefcafe,ot=15715070==(16777215&it);ot&&"Microsoft Internet Explorer"==navigator.appName?(r.prototype.am=u,tt=30):ot&&"Netscape"!=navigator.appName?(r.prototype.am=a,tt=26):(r.prototype.am=l,tt=28),r.prototype.DB=tt,r.prototype.DM=(1<<tt)-1,r.prototype.DV=1<<tt;var rt=52;r.prototype.FV=Math.pow(2,rt),r.prototype.F1=rt-tt,r.prototype.F2=2*tt-rt;var st,at,ut="0123456789abcdefghijklmnopqrstuvwxyz",lt=new Array;for(st="0".charCodeAt(0),at=0;9>=at;++at)lt[st++]=at;for(st="a".charCodeAt(0),at=10;36>at;++at)lt[st++]=at;for(st="A".charCodeAt(0),at=10;36>at;++at)lt[st++]=at;O.prototype.convert=M,O.prototype.revert=$,O.prototype.reduce=D,O.prototype.mulTo=R,O.prototype.sqrTo=L,N.prototype.convert=j,N.prototype.revert=U,N.prototype.reduce=V,N.prototype.mulTo=z,N.prototype.sqrTo=H,r.prototype.copyTo=h,r.prototype.fromInt=p,r.prototype.fromString=m,r.prototype.clamp=g,r.prototype.dlShiftTo=C,r.prototype.drShiftTo=S,r.prototype.lShiftTo=x,r.prototype.rShiftTo=E,r.prototype.subTo=P,r.prototype.multiplyTo=T,r.prototype.squareTo=I,r.prototype.divRemTo=A,r.prototype.invDigit=F,r.prototype.isEven=q,r.prototype.exp=W,r.prototype.toString=b,r.prototype.negate=_,r.prototype.abs=y,r.prototype.compareTo=v,r.prototype.bitLength=k,r.prototype.mod=B,r.prototype.modPowInt=Q,r.ZERO=f(0),r.ONE=f(1),K.prototype.doPublic=X,K.prototype.setPublic=J,K.prototype.encrypt=Z;var ct={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};"undefined"!=typeof module&&module.exports&&(module.exports=ct),ct.cipher.aes=function(t){this._tables[0][0][0]||this._precompute();var e,n,i,o,r,s=this._tables[0][4],a=this._tables[1],u=t.length,l=1;if(4!==u&&6!==u&&8!==u)throw new ct.exception.invalid("invalid aes key size");for(this._key=[o=t.slice(0),r=[]],e=u;4*u+28>e;e++)i=o[e-1],(e%u===0||8===u&&e%u===4)&&(i=s[i>>>24]<<24^s[i>>16&255]<<16^s[i>>8&255]<<8^s[255&i],e%u===0&&(i=i<<8^i>>>24^l<<24,l=l<<1^283*(l>>7))),o[e]=o[e-u]^i;for(n=0;e;n++,e--)i=o[3&n?e:e-4],r[n]=4>=e||4>n?i:a[0][s[i>>>24]]^a[1][s[i>>16&255]]^a[2][s[i>>8&255]]^a[3][s[255&i]]},ct.cipher.aes.prototype={encrypt:function(t){return this._crypt(t,0)},decrypt:function(t){return this._crypt(t,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var t,e,n,i,o,r,s,a,u,l=this._tables[0],c=this._tables[1],d=l[4],h=c[4],p=[],f=[];for(t=0;256>t;t++)f[(p[t]=t<<1^283*(t>>7))^t]=t;for(e=n=0;!d[e];e^=i||1,n=f[n]||1)for(s=n^n<<1^n<<2^n<<3^n<<4,s=s>>8^255&s^99,d[e]=s,h[s]=e,r=p[o=p[i=p[e]]],u=16843009*r^65537*o^257*i^16843008*e,a=257*p[s]^16843008*s,t=0;4>t;t++)l[t][e]=a=a<<24^a>>>8,c[t][s]=u=u<<24^u>>>8;for(t=0;5>t;t++)l[t]=l[t].slice(0),c[t]=c[t].slice(0)},_crypt:function(t,e){if(4!==t.length)throw new ct.exception.invalid("invalid aes block size");var n,i,o,r,s=this._key[e],a=t[0]^s[0],u=t[e?3:1]^s[1],l=t[2]^s[2],c=t[e?1:3]^s[3],d=s.length/4-2,h=4,p=[0,0,0,0],f=this._tables[e],m=f[0],g=f[1],b=f[2],_=f[3],y=f[4];for(r=0;d>r;r++)n=m[a>>>24]^g[u>>16&255]^b[l>>8&255]^_[255&c]^s[h],i=m[u>>>24]^g[l>>16&255]^b[c>>8&255]^_[255&a]^s[h+1],o=m[l>>>24]^g[c>>16&255]^b[a>>8&255]^_[255&u]^s[h+2],c=m[c>>>24]^g[a>>16&255]^b[u>>8&255]^_[255&l]^s[h+3],h+=4,a=n,u=i,l=o;for(r=0;4>r;r++)p[e?3&-r:r]=y[a>>>24]<<24^y[u>>16&255]<<16^y[l>>8&255]<<8^y[255&c]^s[h++],n=a,a=u,u=l,l=c,c=n;return p}},ct.bitArray={bitSlice:function(t,e,n){return t=ct.bitArray._shiftRight(t.slice(e/32),32-(31&e)).slice(1),void 0===n?t:ct.bitArray.clamp(t,n-e)},extract:function(t,e,n){var i,o=Math.floor(-e-n&31);return i=-32&(e+n-1^e)?t[e/32|0]<<32-o^t[e/32+1|0]>>>o:t[e/32|0]>>>o,i&(1<<n)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var n=t[t.length-1],i=ct.bitArray.getPartial(n);return 32===i?t.concat(e):ct.bitArray._shiftRight(e,i,0|n,t.slice(0,t.length-1))},bitLength:function(t){var e,n=t.length;return 0===n?0:(e=t[n-1],32*(n-1)+ct.bitArray.getPartial(e))},clamp:function(t,e){if(32*t.length<e)return t;t=t.slice(0,Math.ceil(e/32));var n=t.length;return e=31&e,n>0&&e&&(t[n-1]=ct.bitArray.partial(e,t[n-1]&2147483648>>e-1,1)),t},partial:function(t,e,n){return 32===t?e:(n?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(ct.bitArray.bitLength(t)!==ct.bitArray.bitLength(e))return!1;var n,i=0;for(n=0;n<t.length;n++)i|=t[n]^e[n];return 0===i},_shiftRight:function(t,e,n,i){var o,r,s=0;for(void 0===i&&(i=[]);e>=32;e-=32)i.push(n),n=0;if(0===e)return i.concat(t);for(o=0;o<t.length;o++)i.push(n|t[o]>>>e),n=t[o]<<32-e;return s=t.length?t[t.length-1]:0,r=ct.bitArray.getPartial(s),i.push(ct.bitArray.partial(e+r&31,e+r>32?n:i.pop(),1)),i},_xor4:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}},ct.codec.hex={fromBits:function(t){var e,n="";for(e=0;e<t.length;e++)n+=((0|t[e])+0xf00000000000).toString(16).substr(4);return n.substr(0,ct.bitArray.bitLength(t)/4)},toBits:function(t){var e,n,i=[];for(t=t.replace(/\s|0x/g,""),n=t.length,t+="00000000",e=0;e<t.length;e+=8)i.push(0^parseInt(t.substr(e,8),16));return ct.bitArray.clamp(i,4*n)}},ct.codec.utf8String={fromBits:function(t){var e,n,i="",o=ct.bitArray.bitLength(t);for(e=0;o/8>e;e++)0===(3&e)&&(n=t[e/4]),i+=String.fromCharCode(n>>>24),n<<=8;return decodeURIComponent(escape(i))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,n=[],i=0;for(e=0;e<t.length;e++)i=i<<8|t.charCodeAt(e),3===(3&e)&&(n.push(i),i=0);return 3&e&&n.push(ct.bitArray.partial(8*(3&e),i)),n}},ct.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,n){var i,o="",r=0,s=ct.codec.base64._chars,a=0,u=ct.bitArray.bitLength(t);for(n&&(s=s.substr(0,62)+"-_"),i=0;6*o.length<u;)o+=s.charAt((a^t[i]>>>r)>>>26),6>r?(a=t[i]<<6-r,r+=26,i++):(a<<=6,r-=6);for(;3&o.length&&!e;)o+="=";return o},toBits:function(t,e){t=t.replace(/\s|=/g,"");var n,i,o=[],r=0,s=ct.codec.base64._chars,a=0;for(e&&(s=s.substr(0,62)+"-_"),n=0;n<t.length;n++){if(i=s.indexOf(t.charAt(n)),0>i)throw new ct.exception.invalid("this isn't base64!");r>26?(r-=26,o.push(a^i>>>r),a=i<<32-r):(r+=6,a^=i<<32-r)}return 56&r&&o.push(ct.bitArray.partial(56&r,a,1)),o}},ct.codec.base64url={fromBits:function(t){return ct.codec.base64.fromBits(t,1,1)},toBits:function(t){return ct.codec.base64.toBits(t,1)}},void 0===ct.beware&&(ct.beware={}),ct.beware["CBC mode is dangerous because it doesn't protect message integrity."]=function(){ct.mode.cbc={name:"cbc",encrypt:function(t,e,n,i){if(i&&i.length)throw new ct.exception.invalid("cbc can't authenticate data");if(128!==ct.bitArray.bitLength(n))throw new ct.exception.invalid("cbc iv must be 128 bits");var o,r=ct.bitArray,s=r._xor4,a=r.bitLength(e),u=0,l=[];if(7&a)throw new ct.exception.invalid("pkcs#5 padding only works for multiples of a byte");for(o=0;a>=u+128;o+=4,u+=128)n=t.encrypt(s(n,e.slice(o,o+4))),l.splice(o,0,n[0],n[1],n[2],n[3]);return a=16843009*(16-(a>>3&15)),n=t.encrypt(s(n,r.concat(e,[a,a,a,a]).slice(o,o+4))),l.splice(o,0,n[0],n[1],n[2],n[3]),l},decrypt:function(t,e,n,i){if(i&&i.length)throw new ct.exception.invalid("cbc can't authenticate data");if(128!==ct.bitArray.bitLength(n))throw new ct.exception.invalid("cbc iv must be 128 bits");if(127&ct.bitArray.bitLength(e)||!e.length)throw new ct.exception.corrupt("cbc ciphertext must be a positive multiple of the block size");var o,r,s,a=ct.bitArray,u=a._xor4,l=[];for(i=i||[],o=0;o<e.length;o+=4)r=e.slice(o,o+4),s=u(n,t.decrypt(r)),l.splice(o,0,s[0],s[1],s[2],s[3]),n=r;if(r=255&l[o-1],0==r||r>16)throw new ct.exception.corrupt("pkcs#5 padding corrupt");if(s=16843009*r,!a.equal(a.bitSlice([s,s,s,s],0,8*r),a.bitSlice(l,32*l.length-8*r,32*l.length)))throw new ct.exception.corrupt("pkcs#5 padding corrupt");return a.bitSlice(l,0,32*l.length-8*r)}}},ct.misc.hmac=function(t,e){this._hash=e=e||ct.hash.sha256;var n,i=[[],[]],o=e.prototype.blockSize/32;for(this._baseHash=[new e,new e],t.length>o&&(t=e.hash(t)),n=0;o>n;n++)i[0][n]=909522486^t[n],i[1][n]=1549556828^t[n];this._baseHash[0].update(i[0]),this._baseHash[1].update(i[1])},ct.misc.hmac.prototype.encrypt=ct.misc.hmac.prototype.mac=function(t,e){var n=new this._hash(this._baseHash[0]).update(t,e).finalize();return new this._hash(this._baseHash[1]).update(n).finalize()},ct.hash.sha256=function(t){this._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},ct.hash.sha256.hash=function(t){return(new ct.hash.sha256).update(t).finalize()},ct.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(t){"string"==typeof t&&(t=ct.codec.utf8String.toBits(t));var e,n=this._buffer=ct.bitArray.concat(this._buffer,t),i=this._length,o=this._length=i+ct.bitArray.bitLength(t);for(e=512+i&-512;o>=e;e+=512)this._block(n.splice(0,16));return this},finalize:function(){var t,e=this._buffer,n=this._h;for(e=ct.bitArray.concat(e,[ct.bitArray.partial(1,1)]),t=e.length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(0|this._length);e.length;)this._block(e.splice(0,16));return this.reset(),n},_init:[],_key:[],_precompute:function(){function t(t){return 4294967296*(t-Math.floor(t))|0}var e,n=0,i=2;t:for(;64>n;i++){for(e=2;i>=e*e;e++)if(i%e===0)continue t;8>n&&(this._init[n]=t(Math.pow(i,.5))),this._key[n]=t(Math.pow(i,1/3)),n++}},_block:function(t){var e,n,i,o,r=t.slice(0),s=this._h,a=this._key,u=s[0],l=s[1],c=s[2],d=s[3],h=s[4],p=s[5],f=s[6],m=s[7];for(e=0;64>e;e++)16>e?n=r[e]:(i=r[e+1&15],o=r[e+14&15],n=r[15&e]=(i>>>7^i>>>18^i>>>3^i<<25^i<<14)+(o>>>17^o>>>19^o>>>10^o<<15^o<<13)+r[15&e]+r[e+9&15]|0),n=n+m+(h>>>6^h>>>11^h>>>25^h<<26^h<<21^h<<7)+(f^h&(p^f))+a[e],m=f,f=p,p=h,h=d+n|0,d=c,c=l,l=u,u=n+(l&c^d&(l^c))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;s[0]=s[0]+u|0,s[1]=s[1]+l|0,s[2]=s[2]+c|0,s[3]=s[3]+d|0,s[4]=s[4]+h|0,s[5]=s[5]+p|0,s[6]=s[6]+f|0,s[7]=s[7]+m|0}},ct.random={randomWords:function(t,e){var n,i,o=[],r=this.isReady(e);if(r===this._NOT_READY)throw new ct.exception.notReady("generator isn't seeded");for(r&this._REQUIRES_RESEED&&this._reseedFromPools(!(r&this._READY)),n=0;t>n;n+=4)(n+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),i=this._gen4words(),o.push(i[0],i[1],i[2],i[3]);return this._gate(),o.slice(0,t)},setDefaultParanoia:function(t){this._defaultParanoia=t},addEntropy:function(t,e,n){n=n||"user";var i,o,r,s=(new Date).valueOf(),a=this._robins[n],u=this.isReady(),l=0;switch(i=this._collectorIds[n],void 0===i&&(i=this._collectorIds[n]=this._collectorIdNext++),void 0===a&&(a=this._robins[n]=0),this._robins[n]=(this._robins[n]+1)%this._pools.length,typeof t){case"number":void 0===e&&(e=1),this._pools[a].update([i,this._eventId++,1,e,s,1,0|t]);break;case"object":var c=Object.prototype.toString.call(t);if("[object Uint32Array]"===c){for(r=[],o=0;o<t.length;o++)r.push(t[o]);t=r}else for("[object Array]"!==c&&(l=1),o=0;o<t.length&&!l;o++)"number"!=typeof t[o]&&(l=1);if(!l){if(void 0===e)for(e=0,o=0;o<t.length;o++)for(r=t[o];r>0;)e++,r>>>=1;this._pools[a].update([i,this._eventId++,2,e,s,t.length].concat(t))}break;case"string":void 0===e&&(e=t.length),this._pools[a].update([i,this._eventId++,3,e,s,t.length]),this._pools[a].update(t);break;default:l=1}if(l)throw new ct.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[a]+=e,this._poolStrength+=e,u===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(t){var e=this._PARANOIA_LEVELS[void 0!==t?t:this._defaultParanoia];
return this._strength&&this._strength>=e?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=e?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(t){var e=this._PARANOIA_LEVELS[t?t:this._defaultParanoia];return this._strength>=e?1:this._poolStrength>e?1:this._poolStrength/e},startCollectors:function(){if(!this._collectorsStarted){if(window.addEventListener)window.addEventListener("load",this._loadTimeCollector,!1),window.addEventListener("mousemove",this._mouseCollector,!1);else{if(!document.attachEvent)throw new ct.exception.bug("can't attach event");document.attachEvent("onload",this._loadTimeCollector),document.attachEvent("onmousemove",this._mouseCollector)}this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._loadTimeCollector,!1),window.removeEventListener("mousemove",this._mouseCollector,!1)):window.detachEvent&&(window.detachEvent("onload",this._loadTimeCollector),window.detachEvent("onmousemove",this._mouseCollector)),this._collectorsStarted=!1)},addEventListener:function(t,e){this._callbacks[t][this._callbackI++]=e},removeEventListener:function(t,e){var n,i,o=this._callbacks[t],r=[];for(i in o)o.hasOwnProperty(i)&&o[i]===e&&r.push(i);for(n=0;n<r.length;n++)i=r[n],delete o[i]},_pools:[new ct.hash.sha256],_poolEntropy:[0],_reseedCount:0,_robins:{},_eventId:0,_collectorIds:{},_collectorIdNext:0,_strength:0,_poolStrength:0,_nextReseed:0,_key:[0,0,0,0,0,0,0,0],_counter:[0,0,0,0],_cipher:void 0,_defaultParanoia:6,_collectorsStarted:!1,_callbacks:{progress:{},seeded:{}},_callbackI:0,_NOT_READY:0,_READY:1,_REQUIRES_RESEED:2,_MAX_WORDS_PER_BURST:65536,_PARANOIA_LEVELS:[0,48,64,96,128,192,256,384,512,768,1024],_MILLISECONDS_PER_RESEED:3e4,_BITS_PER_RESEED:80,_gen4words:function(){for(var t=0;4>t&&(this._counter[t]=this._counter[t]+1|0,!this._counter[t]);t++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new ct.cipher.aes(this._key)},_reseed:function(t){this._key=ct.hash.sha256.hash(this._key.concat(t)),this._cipher=new ct.cipher.aes(this._key);for(var e=0;4>e&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);},_reseedFromPools:function(t){var e,n=[],i=0;for(this._nextReseed=n[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED,e=0;16>e;e++)n.push(4294967296*Math.random()|0);for(e=0;e<this._pools.length&&(n=n.concat(this._pools[e].finalize()),i+=this._poolEntropy[e],this._poolEntropy[e]=0,t||!(this._reseedCount&1<<e));e++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new ct.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=i,i>this._strength&&(this._strength=i),this._reseedCount++,this._reseed(n)},_mouseCollector:function(t){var e=t.x||t.clientX||t.offsetX||0,n=t.y||t.clientY||t.offsetY||0;ct.random.addEntropy([e,n],2,"mouse")},_loadTimeCollector:function(){ct.random.addEntropy((new Date).valueOf(),2,"loadtime")},_fireEvent:function(t,e){var n,i=ct.random._callbacks[t],o=[];for(n in i)i.hasOwnProperty(n)&&o.push(i[n]);for(n=0;n<o.length;n++)o[n](e)}},function(){try{var t=new Uint32Array(32);crypto.getRandomValues(t),ct.random.addEntropy(t,1024,"crypto.getRandomValues")}catch(e){}}(),function(){for(var t in ct.beware)ct.beware.hasOwnProperty(t)&&ct.beware[t]()}();var dt={sjcl:ct,version:"1.3.10"};dt.generateAesKey=function(){return{key:ct.random.randomWords(8,0),encrypt:function(t){return this.encryptWithIv(t,ct.random.randomWords(4,0))},encryptWithIv:function(t,e){var n=new ct.cipher.aes(this.key),i=ct.codec.utf8String.toBits(t),o=ct.mode.cbc.encrypt(n,i,e),r=ct.bitArray.concat(e,o);return ct.codec.base64.fromBits(r)}}},dt.create=function(t){return new dt.EncryptionClient(t)},dt.EncryptionClient=function(t){var i=this,r=[];i.publicKey=t,i.version=dt.version;var s=function(t,e){var n,i,o;n=document.createElement(t);for(i in e)e.hasOwnProperty(i)&&(o=e[i],n.setAttribute(i,o));return n},a=function(t){return window.jQuery&&t instanceof jQuery?t[0]:t.nodeType&&1===t.nodeType?t:document.getElementById(t)},u=function(t){var e,n,i,o,r=[];if("INTEGER"===t.typeName()&&(e=t.posContent(),n=t.posEnd(),i=t.stream.hexDump(e,n).replace(/[ \n]/g,""),r.push(i)),null!==t.sub)for(o=0;o<t.sub.length;o++)r=r.concat(u(t.sub[o]));return r},l=function(t){var e,n,i=[],o=t.children;for(n=0;n<o.length;n++)e=o[n],1===e.nodeType&&e.attributes["data-encrypted-name"]?i.push(e):e.children&&e.children.length>0&&(i=i.concat(l(e)));return i},c=function(){var n,i,r,s,a,l;try{a=o(t),n=e.decode(a)}catch(c){throw"Invalid encryption key. Please use the key labeled 'Client-Side Encryption Key'"}if(r=u(n),2!==r.length)throw"Invalid encryption key. Please use the key labeled 'Client-Side Encryption Key'";return s=r[0],i=r[1],l=new K,l.setPublic(s,i),l},d=function(){return{key:ct.random.randomWords(8,0),sign:function(t){var e=new ct.misc.hmac(this.key,ct.hash.sha256),n=e.encrypt(t);return ct.codec.base64.fromBits(n)}}};i.encrypt=function(t){var e=c(),o=dt.generateAesKey(),r=d(),s=o.encrypt(t),a=r.sign(ct.codec.base64.toBits(s)),u=ct.bitArray.concat(o.key,r.key),l=ct.codec.base64.fromBits(u),h=e.encrypt(l),p="$bt4|javascript_"+i.version.replace(/\./g,"_")+"$",f=null;return h&&(f=n(h)),p+f+"$"+s+"$"+a},i.encryptForm=function(t){var e,n,o,u,c,d;for(t=a(t),d=l(t);r.length>0;){try{t.removeChild(r[0])}catch(h){}r.splice(0,1)}for(c=0;c<d.length;c++)e=d[c],o=e.getAttribute("data-encrypted-name"),n=i.encrypt(e.value),e.removeAttribute("name"),u=s("input",{value:n,type:"hidden",name:o}),r.push(u),t.appendChild(u)},i.onSubmitEncryptForm=function(t,e){var n;t=a(t),n=function(n){return i.encryptForm(t),e?e(n):n},window.jQuery?window.jQuery(t).submit(n):t.addEventListener?t.addEventListener("submit",n,!1):t.attachEvent&&t.attachEvent("onsubmit",n)},i.formEncrypter={encryptForm:i.encryptForm,extractForm:a,onSubmitEncryptForm:i.onSubmitEncryptForm},ct.random.startCollectors()},window.Braintree=dt}(),!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.braintree=t()}}(function(){var t;return function e(t,n,i){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n?n:e)},c,c.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e){(function(n){"use strict";function i(){}function o(t){if("CONFIGURATION"===t.type||"IMMEDIATE"===t.type)throw new Error(t.message);try{console.error(JSON.stringify(t))}catch(e){}}function r(t,e,i){var o;if(!(e in h))throw new Error(e+" is an unsupported integration");d.isFunction(i[f.ROOT_SUCCESS_CALLBACK])&&(_=function(t){i[f.ROOT_SUCCESS_CALLBACK](g(t))}),d.isFunction(i[f.ROOT_ERROR_CALLBACK])&&(v=i[f.ROOT_ERROR_CALLBACK]),d.isFunction(i[f.ROOT_READY_CALLBACK])&&(y=i[f.ROOT_READY_CALLBACK]),m(y),p.on(p.events.ERROR,v),p.on(p.events.PAYMENT_METHOD_RECEIVED,_),p.on(p.events.WARNING,function(t){try{console.warn(t)}catch(e){}}),o={clientToken:t,integrationType:e,merchantConfiguration:i,analyticsConfiguration:{sdkVersion:"braintree/web"+s,merchantAppId:n.location.host}},a._getConfiguration(o,function(t,n){return t?void p.emit(p.events.ERROR,{message:t.errors}):(o.gatewayConfiguration=n,b(o),p.on(p.events.CONFIGURATION_REQUEST,function(t){t({enableCORS:o.merchantConfiguration.enableCORS,configuration:o.gatewayConfiguration,integration:o.integrationType,analyticsConfiguration:o.analyticsConfiguration})}),p.emit(p.events.ASYNC_DEPENDENCY_INITIALIZING),h[e].initialize(o),void p.emit(p.events.ASYNC_DEPENDENCY_READY))})}var s="2.11.2",a=t("braintree-api"),u=t("braintree-paypal"),l=t("braintree-dropin"),c=t("braintree-form"),d=t("braintree-utilities"),h=t("./integrations"),p=t("braintree-bus"),f=t("./constants"),m=t("./lib/dependency-ready"),g=t("./lib/sanitize-payload"),b=t("./lib/analytics-sender").listenForAnalytics,_=i,y=i,v=o;e.exports={api:a,cse:n.Braintree,paypal:u,dropin:l,Form:c,setup:r,VERSION:s}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./constants":358,"./integrations":362,"./lib/analytics-sender":364,"./lib/dependency-ready":365,"./lib/sanitize-payload":366,"braintree-api":21,"braintree-bus":50,"braintree-dropin":246,"braintree-form":256,"braintree-paypal":324,"braintree-utilities":344}],2:[function(t,e){(function(n){"use strict";function i(t){var e=t.analyticsConfiguration||{},i=n.braintree?n.braintree.VERSION:null,o=i?"braintree/web/"+i:"";return{sdkVersion:e.sdkVersion||o,merchantAppId:e.merchantAppId||n.location.host}}function o(t){var e,n,o;this.attrs={},t.hasOwnProperty("sharedCustomerIdentifier")&&(this.attrs.sharedCustomerIdentifier=t.sharedCustomerIdentifier),e=a(t.clientToken),o=i(t),this.driver=t.driver||m({enableCORS:g(t)}),this.analyticsUrl=e.analytics?e.analytics.url:void 0,this.clientApiUrl=e.clientApiUrl,this.customerId=t.customerId,this.challenges=e.challenges,this.integration=t.integration||"",this.sdkVersion=o.sdkVersion,this.merchantAppId=o.merchantAppId,n=s.create(this,{container:t.container,clientToken:e}),this.verify3DS=r.bind(n.verify,n),this.attrs.authorizationFingerprint=e.authorizationFingerprint,this.attrs.sharedCustomerIdentifierType=t.sharedCustomerIdentifierType,e.merchantAccountId&&(this.attrs.merchantAccountId=e.merchantAccountId),this.requestTimeout=t.hasOwnProperty("timeout")?t.timeout:6e4}var r=t("braintree-utilities"),s=t("braintree-3ds"),a=t("./parse-client-token"),u=t("./util"),l=t("./sepa-mandate"),c=t("./europe-bank-account"),d=t("./credit-card"),h=t("./coinbase-account"),p=t("./paypal-account"),f=t("./normalize-api-fields").normalizeCreditCardFields,m=t("./request/choose-driver"),g=t("./should-enable-cors");o.prototype.getCreditCards=function(t){this.driver.get(u.joinUrlFragments([this.clientApiUrl,"v1","payment_methods"]),this.attrs,function(t){var e=0,n=t.paymentMethods.length,i=[];for(e;n>e;e++)i.push(new d(t.paymentMethods[e]));return i},t,this.requestTimeout)},o.prototype.tokenizeCoinbase=function(t,e){t.options={validate:!1},this.addCoinbase(t,function(t,n){t?e(t,null):n&&n.nonce?e(t,n):e("Unable to tokenize coinbase account.",null)})},o.prototype.tokenizePayPalAccount=function(t,e){t.options={validate:!1},this.addPayPalAccount(t,function(t,n){t?e(t,null):n&&n.nonce?e(null,n):e("Unable to tokenize paypal account.",null)})},o.prototype.tokenizeCard=function(t,e){t.options={validate:!1},this.addCreditCard(t,function(t,n){n&&n.nonce?e(t,n.nonce,{type:n.type,details:n.details}):e("Unable to tokenize card.",null)})},o.prototype.lookup3DS=function(t,e){var n=u.joinUrlFragments([this.clientApiUrl,"v1/payment_methods",t.nonce,"three_d_secure/lookup"]),i=u.mergeOptions(this.attrs,{amount:t.amount});this.driver.post(n,i,function(t){return t},e,this.requestTimeout)},o.prototype.createSEPAMandate=function(t,e){var n=u.mergeOptions(this.attrs,{sepaMandate:t});this.driver.post(u.joinUrlFragments([this.clientApiUrl,"v1","sepa_mandates.json"]),n,function(t){return{sepaMandate:new l(t.europeBankAccounts[0].sepaMandates[0]),sepaBankAccount:new c(t.europeBankAccounts[0])}},e,this.requestTimeout)},o.prototype.getSEPAMandate=function(t,e){var n=u.mergeOptions(this.attrs,t);this.driver.get(u.joinUrlFragments([this.clientApiUrl,"v1","sepa_mandates.json"]),n,function(t){return{sepaMandate:new l(t.sepaMandates[0])}},e,this.requestTimeout)},o.prototype.addCoinbase=function(t,e){var n;delete t.share,n=u.mergeOptions(this.attrs,{coinbaseAccount:t,_meta:{integration:this.integration||"custom",source:"coinbase"}}),this.driver.post(u.joinUrlFragments([this.clientApiUrl,"v1","payment_methods/coinbase_accounts"]),n,function(t){return new h(t.coinbaseAccounts[0])},e,this.requestTimeout)},o.prototype.addPayPalAccount=function(t,e){var n;delete t.share,n=u.mergeOptions(this.attrs,{paypalAccount:t,_meta:{integration:this.integration||"paypal",source:"paypal"}}),this.driver.post(u.joinUrlFragments([this.clientApiUrl,"v1","payment_methods","paypal_accounts"]),n,function(t){return new p(t.paypalAccounts[0])},e,this.requestTimeout)},o.prototype.addCreditCard=function(t,e){var n,i,o=t.share;delete t.share,i=f(t),n=u.mergeOptions(this.attrs,{share:o,creditCard:i,_meta:{integration:this.integration||"custom",source:"form"}}),this.driver.post(u.joinUrlFragments([this.clientApiUrl,"v1","payment_methods/credit_cards"]),n,function(t){return new d(t.creditCards[0])},e,this.requestTimeout)},o.prototype.sendAnalyticsEvents=function(t,e){var i,o,r=this.analyticsUrl,s=[];if(t=u.isArray(t)?t:[t],!r)return void(e&&e.apply(null,[null,{}]));for(o in t)t.hasOwnProperty(o)&&s.push({kind:t[o]});i=u.mergeOptions(this.attrs,{braintree_library_version:this.sdkVersion,analytics:s,_meta:{merchantAppId:this.merchantAppId,platform:"web",platformVersion:n.navigator.userAgent,integrationType:this.integration,sdkVersion:this.sdkVersion}}),this.driver.post(r,i,function(t){return t},e,this.requestTimeout)},o.prototype.decryptBrowserswitchPayload=function(t,e){var n=u.mergeOptions(this.attrs,{asymmetric_encrypted_payload:t}),i=u.joinUrlFragments([this.clientApiUrl,"/v1/paypal_browser_switch/decrypt"]);this.driver.post(i,n,function(t){return t},e,this.requestTimeout)},o.prototype.encryptBrowserswitchReturnPayload=function(t,e,n){var i=u.mergeOptions(this.attrs,{payload:t,aesKey:e}),o=u.joinUrlFragments([this.clientApiUrl,"/v1/paypal_browser_switch/encrypt"]);this.driver.post(o,i,function(t){return t},n,this.requestTimeout)},o.prototype.exchangePaypalTokenForConsentCode=function(t,e){var n=u.mergeOptions(this.attrs,t);this.attrs.merchantAccountId&&(n.merchant_account_id=this.attrs.merchantAccountId);var i=u.joinUrlFragments([this.clientApiUrl,"/v1/paypal_account_service/merchant_consent"]);this.driver.post(i,n,function(t){return t},e,this.requestTimeout)},e.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./coinbase-account":3,"./credit-card":5,"./europe-bank-account":6,"./normalize-api-fields":8,"./parse-client-token":9,"./paypal-account":10,"./request/choose-driver":13,"./sepa-mandate":18,"./should-enable-cors":19,"./util":20,"braintree-3ds":29,"braintree-utilities":41}],3:[function(t,e){"use strict";function n(t){var e,n;for(e=0;e<i.length;e++)n=i[e],this[n]=t[n]}var i=["nonce","type","description","details"];e.exports=n},{}],4:[function(t,e){e.exports={errors:{UNKNOWN_ERROR:"Unknown error",INVALID_TIMEOUT:"Timeout must be a number"}}},{}],5:[function(t,e){"use strict";function n(t){var e,n;for(e=0;e<i.length;e++)n=i[e],this[n]=t[n]}var i=["billingAddress","branding","createdAt","createdAtMerchant","createdAtMerchantName","details","isLocked","lastUsedAt","lastUsedAtMerchant","lastUsedAtMerchantName","lastUsedByCurrentMerchant","nonce","securityQuestions","type"];e.exports=n},{}],6:[function(t,e){"use strict";function n(t){var e,n=["bic","maskedIBAN","nonce","accountHolderName"],i=0;for(i=0;i<n.length;i++)e=n[i],this[e]=t[e]}e.exports=n},{}],7:[function(t,e){"use strict";function n(t,e){var n=i(t.clientToken),a={authorizationFingerprint:n.authorizationFingerprint},u=r({enableCORS:s(t)});u.get(n.configUrl,a,function(t){return o.mergeOptions(n,t)},e,t.timeout)}var i=t("./parse-client-token"),o=t("./util"),r=t("./request/choose-driver"),s=t("./should-enable-cors");e.exports=n},{"./parse-client-token":9,"./request/choose-driver":13,"./should-enable-cors":19,"./util":20}],8:[function(t,e){"use strict";function n(t){var e,n={billingAddress:t.billingAddress||{}};for(e in t)if(t.hasOwnProperty(e))switch(e.replace(/_/,"").toLowerCase()){case"postalcode":case"countryname":case"countrycodenumeric":case"countrycodealpha2":case"countrycodealpha3":case"region":case"extendedaddress":case"locality":case"firstname":case"lastname":case"company":case"streetaddress":n.billingAddress[e]=t[e];break;default:n[e]=t[e]}return n}e.exports={normalizeCreditCardFields:n}},{}],9:[function(t,e){"use strict";function n(t){var e;if(!t)throw new Error("Braintree API Client Misconfigured: clientToken required.");if("object"==typeof t&&null!==t)e=t;else{try{t=window.atob(t)}catch(n){}try{e=JSON.parse(t)}catch(o){throw new Error("Braintree API Client Misconfigured: clientToken is not valid JSON.")}}if(!e.hasOwnProperty("clientApiUrl")||!i.isWhitelistedDomain(e.clientApiUrl))throw new Error("Braintree API Client Misconfigured: the clientApiUrl provided in the clientToken is invalid.");return e}var i=t("braintree-utilities");t("./polyfill"),e.exports=n},{"./polyfill":11,"braintree-utilities":41}],10:[function(t,e){"use strict";function n(t){var e,n;for(e=0;e<i.length;e++)n=i[e],this[n]=t[n]}var i=["nonce","type","description","details"];e.exports=n},{}],11:[function(t,e){(function(t){"use strict";var n=function(t){var e=new RegExp("^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{4})([=]{1,2})?$"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="";if(!e.test(t))throw new Error("Non base64 encoded input passed to window.atob polyfill");var o=0;do{var r=n.indexOf(t.charAt(o++)),s=n.indexOf(t.charAt(o++)),a=n.indexOf(t.charAt(o++)),u=n.indexOf(t.charAt(o++)),l=(63&r)<<2|s>>4&3,c=(15&s)<<4|a>>2&15,d=(3&a)<<6|63&u;i+=String.fromCharCode(l)+(c?String.fromCharCode(c):"")+(d?String.fromCharCode(d):"")}while(o<t.length);return i};t.atob=t.atob||n,e.exports={atobPolyfill:n}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],12:[function(t,e){(function(n){"use strict";function i(){return d?new XMLHttpRequest:new XDomainRequest}function o(t,e,n,i,o){var r=a.createURLParams(t,e);s("GET",r,null,n,i,o)}function r(t,e,n,i,o){s("POST",t,e,n,i,o)}function s(t,e,n,o,r,s){var a,h,p=i();r=r||function(){},d?p.onreadystatechange=function(){4===p.readyState&&(a=p.status,h=l(p.responseText),a>=400||0===a?r.call(null,h||{errors:c.errors.UNKNOWN_ERROR},null):a>0&&r.call(null,null,o(h)))}:(p.onload=function(){r.call(null,null,o(l(p.responseText)))},p.onerror=function(){r.call(null,p.responseText,null)},p.onprogress=function(){},p.ontimeout=function(){r.call(null,{errors:c.errors.UNKNOWN_ERROR},null)}),p.open(t,e,!0),p.timeout=null==s?6e4:s,d&&"POST"===t&&p.setRequestHeader("Content-Type","application/json"),setTimeout(function(){p.send(u(t,n))},0)}var a=t("../util"),u=t("./prep-body"),l=t("./parse-body"),c=t("../constants"),d=n.XMLHttpRequest&&"withCredentials"in new n.XMLHttpRequest;e.exports={get:o,post:r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../constants":4,"../util":20,"./parse-body":16,"./prep-body":17}],13:[function(t,e){"use strict";function n(t){var e=r.getUserAgent(),n=!(r.isHTTP()&&/(MSIE\s(8|9))|(Phantom)/.test(e));return t=t||{},t.enableCORS&&n?o:i}var i=t("./jsonp-driver"),o=t("./ajax-driver"),r=t("../util");e.exports=n},{"../util":20,"./ajax-driver":12,"./jsonp-driver":14}],14:[function(t,e){"use strict";function n(t,e){return t.status>=400?[t,null]:[null,e(t)]}function i(){}function o(t,e,o,r,s,a){var c;s=s||i,null==a&&(a=6e4),c=r(t,e,function(t,e){l[e]&&(clearTimeout(l[e]),s.apply(null,n(t,function(t){return o(t)})))}),"number"==typeof a?l[c]=setTimeout(function(){l[c]=null,s.apply(null,[{errors:u.errors.UNKNOWN_ERROR},null])},a):s.apply(null,[{errors:u.errors.INVALID_TIMEOUT},null])}function r(t,e,n,i,r){e._method="POST",o(t,e,n,a.get,i,r)}function s(t,e,n,i,r){o(t,e,n,a.get,i,r)}var a=t("./jsonp"),u=t("../constants"),l=[];e.exports={get:s,post:r}},{"../constants":4,"./jsonp":15}],15:[function(t,e){(function(n){"use strict";function i(t,e){var n=document.createElement("script"),i=!1;n.src=t,n.async=!0;var o=e||l.error;"function"==typeof o&&(n.onerror=function(e){o({url:t,event:e})}),n.onload=n.onreadystatechange=function(){i||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(i=!0,n.onload=n.onreadystatechange=null,n&&n.parentNode&&n.parentNode.removeChild(n))},s||(s=document.getElementsByTagName("head")[0]),s.appendChild(n)}function o(t,e,n,o){var r,s;return o=o||l.callbackName||"callback",s=o+"_json"+a.generateUUID(),e[o]=s,r=a.createURLParams(t,e),u[s]=function(t){n(t,s);try{delete u[s]}catch(e){}u[s]=null},i(r),s}function r(t){l=t}var s,a=t("../util"),u=n,l={};e.exports={get:o,init:r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":20}],16:[function(t,e){"use strict";e.exports=function(t){try{t=JSON.parse(t)}catch(e){}return t}},{}],17:[function(t,e){"use strict";var n=t("lodash.isstring");e.exports=function(t,e){if(!n(t))throw new Error("Method must be a string");return"get"!==t.toLowerCase()&&null!=e&&(e=n(e)?e:JSON.stringify(e)),e}},{"lodash.isstring":49}],18:[function(t,e){"use strict";function n(t){var e,n=0,i=["accountHolderName","bic","longFormURL","mandateReferenceNumber","maskedIBAN","shortForm"];for(n=0;n<i.length;n++)e=i[n],this[e]=t[e]}e.exports=n},{}],19:[function(t,e){"use strict";e.exports=function(t){return null!=t.enableCORS?t.enableCORS:t.merchantConfiguration?t.merchantConfiguration.enableCORS:!1}},{}],20:[function(t,e){(function(n){"use strict";function i(t){var e,n,i=[];for(n=0;n<t.length;n++)e=t[n],"/"===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),"/"===e.charAt(0)&&(e=e.substring(1)),i.push(e);return i.join("/")}function o(t){return t&&"object"==typeof t&&"number"==typeof t.length&&"[object Array]"===Object.prototype.toString.call(t)||!1}function r(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.floor(16*Math.random()),n="x"===t?e:3&e|8;return n.toString(16)})}function s(t,e){var n,i={};for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i}function a(t,e){var n,i,r,s=[];for(r in t)t.hasOwnProperty(r)&&(i=t[r],n=e?o(t)?e+"[]":e+"["+r+"]":r,s.push("object"==typeof i?a(i,n):encodeURIComponent(n)+"="+encodeURIComponent(i)));return s.join("&")}function u(t,e){return t=t||"",!d(e)&&h(e)&&(t+=-1===t.indexOf("?")?"?":"",t+=-1!==t.indexOf("=")?"&":"",t+=a(e)),t}function l(){return n.navigator.userAgent}function c(){return"http:"===n.location.protocol}var d=t("lodash.isempty"),h=t("lodash.isobject");e.exports={joinUrlFragments:i,isArray:o,generateUUID:r,mergeOptions:s,stringify:a,createURLParams:u,getUserAgent:l,isHTTP:c}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash.isempty":42,"lodash.isobject":48}],21:[function(t,e){"use strict";function n(t){return new i(t)}var i=t("./lib/client"),o=t("./lib/util"),r=t("./lib/parse-client-token"),s=t("./lib/get-configuration");e.exports={Client:i,configure:n,util:o,parseClientToken:r,_getConfiguration:s}},{"./lib/client":2,"./lib/get-configuration":7,"./lib/parse-client-token":9,"./lib/util":20}],22:[function(t,e){"use strict";function n(t,e){if(e=e||"["+t+"] is not a valid DOM Element",t&&t.nodeType&&1===t.nodeType)return t;if(t&&window.jQuery&&(t instanceof jQuery||"jquery"in Object(t))&&0!==t.length)return t[0];if("string"==typeof t&&document.getElementById(t))return document.getElementById(t);throw new Error(e)}e.exports={normalizeElement:n}},{}],23:[function(t,e){"use strict";function n(t,e,n,i){t.addEventListener?t.addEventListener(e,n,i):t.attachEvent&&t.attachEvent("on"+e,n)}function i(t,e,n,i){t.removeEventListener?t.removeEventListener(e,n,i):t.detachEvent&&t.detachEvent("on"+e,n)}e.exports={addEventListener:n,removeEventListener:i}},{}],24:[function(t,e){"use strict";function n(t){return"[object Function]"===o.call(t)}function i(t,e){return function(){t.apply(e,arguments)}}var o=Object.prototype.toString;e.exports={bind:i,isFunction:n}},{}],25:[function(t,e){"use strict";function n(){return"https:"===window.location.protocol}function i(t){switch(t){case null:case void 0:return"";case!0:return"1";case!1:return"0";default:return encodeURIComponent(t)}}function o(t,e){var n,r,s=[];for(r in t)if(t.hasOwnProperty(r)){var a=t[r];n=e?e+"["+r+"]":r,"object"==typeof a?s.push(o(a,n)):void 0!==a&&null!==a&&s.push(i(n)+"="+i(a))}return s.join("&")}function r(t){for(var e={},n=t.split("&"),i=0;i<n.length;i++){var o=n[i].split("="),r=o[0],s=decodeURIComponent(o[1]);e[r]=s}return e}function s(t){var e=t.split("?");return 2!==e.length?{}:r(e[1])}e.exports={isBrowserHttps:n,makeQueryString:o,decodeQueryString:r,getParams:s}},{}],26:[function(t,e){var n=t("./lib/dom"),i=t("./lib/url"),o=t("./lib/fn"),r=t("./lib/events");e.exports={normalizeElement:n.normalizeElement,isBrowserHttps:i.isBrowserHttps,makeQueryString:i.makeQueryString,decodeQueryString:i.decodeQueryString,getParams:i.getParams,removeEventListener:r.removeEventListener,addEventListener:r.addEventListener,bind:o.bind,isFunction:o.isFunction}},{"./lib/dom":22,"./lib/events":23,"./lib/fn":24,"./lib/url":25}],27:[function(t,e){"use strict";function n(t,e){var n=window.getComputedStyle?getComputedStyle(t):t.currentStyle;return n[e]}function i(){return{html:{height:r.style.height||"",overflow:n(r,"overflow"),position:n(r,"position")},body:{height:s.style.height||"",overflow:n(s,"overflow")}}}function o(t,e){this.assetsUrl=t,this.container=e||document.body,this.iframe=null,r=document.documentElement,s=document.body,this.merchantPageDefaultStyles=i()}var r,s,a=t("braintree-utilities"),u=t("../shared/receiver"),l="1.3.0";o.prototype.get=function(t,e){var n=this,i=this.constructAuthorizationURL(t);this.container&&a.isFunction(this.container)?this.container(i+"&no_style=1"):this.insertIframe(i),new u(function(t){a.isFunction(n.container)||n.removeIframe(),e(t)})},o.prototype.removeIframe=function(){this.container&&this.container.nodeType&&1===this.container.nodeType?this.container.removeChild(this.iframe):this.container&&window.jQuery&&this.container instanceof jQuery?$(this.iframe,this.container).remove():"string"==typeof this.container&&document.getElementById(this.container).removeChild(this.iframe),this.unlockMerchantWindowSize()},o.prototype.insertIframe=function(t){var e=document.createElement("iframe");if(e.src=t,this.applyStyles(e),this.lockMerchantWindowSize(),this.container&&this.container.nodeType&&1===this.container.nodeType)this.container.appendChild(e);else if(this.container&&window.jQuery&&this.container instanceof jQuery&&0!==this.container.length)this.container.append(e);else{if("string"!=typeof this.container||!document.getElementById(this.container))throw new Error("Unable to find valid container for iframe.");document.getElementById(this.container).appendChild(e)}this.iframe=e},o.prototype.applyStyles=function(t){t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.height="100%",t.style.width="100%",t.setAttribute("frameborder","0"),t.setAttribute("allowTransparency","true"),t.style.border="0",t.style.zIndex="99999"},o.prototype.lockMerchantWindowSize=function(){r.style.overflow="hidden",s.style.overflow="hidden",s.style.height="100%"},o.prototype.unlockMerchantWindowSize=function(){var t=this.merchantPageDefaultStyles;s.style.height=t.body.height,s.style.overflow=t.body.overflow,r.style.overflow=t.html.overflow},o.prototype.constructAuthorizationURL=function(t){var e,n=window.location.href;return n.indexOf("#")>-1&&(n=n.split("#")[0]),e=a.makeQueryString({acsUrl:t.acsUrl,pareq:t.pareq,termUrl:t.termUrl+"&three_d_secure_version="+l,md:t.md,parentUrl:n}),this.assetsUrl+"/3ds/"+l+"/html/style_frame?"+e},e.exports=o},{"../shared/receiver":34,"braintree-utilities":26}],28:[function(t,e){"use strict";function n(){}function i(t,e){e=e||{},this.clientToken=e.clientToken,this.container=e.container,this.api=t,this.nonce=null,this._loader=null,this._boundHandleUserClose=o.bind(this._handleUserClose,this)}var o=t("braintree-utilities"),r=t("./authorization_service"),s=t("./loader");i.prototype.verify=function(t,e){if(!o.isFunction(e))throw this.api.sendAnalyticsEvents("3ds.web.no_callback"),new Error("No suitable callback argument was given");o.isFunction(t.onUserClose)&&(this._onUserClose=t.onUserClose),o.isFunction(t.onLookupComplete)&&(this._onLookupComplete=t.onLookupComplete),(void 0===t.useDefaultLoader||t.useDefaultLoader===!0)&&this._createDefaultLoader();var n={nonce:"",amount:t.amount},i=t.creditCard;if("string"==typeof i)n.nonce=i,this.api.sendAnalyticsEvents("3ds.web.verify.nonce"),this.startVerification(n,e);else{var r=this,s=function(t,i){return t?(r._removeDefaultLoader(),e(t)):(n.nonce=i,void r.startVerification(n,e))};this.api.sendAnalyticsEvents("3ds.web.verify.credit_card"),this.api.tokenizeCard(i,s)}},i.prototype.startVerification=function(t,e){this.api.lookup3DS(t,o.bind(this.handleLookupResponse(e),this))},i.prototype.handleLookupResponse=function(t){var e=this;return function(n,i){var s;this._onLookupComplete(),n?t(n.error):i.lookup&&i.lookup.acsUrl&&i.lookup.acsUrl.length>0?(e.nonce=i.paymentMethod.nonce,s=new r(this.clientToken.assetsUrl,this.container),s.get(i.lookup,o.bind(this.handleAuthenticationResponse(t),this)),this._detachListeners(),this._attachListeners()):(e.nonce=i.paymentMethod.nonce,t(null,{nonce:e.nonce,verificationDetails:i.threeDSecureInfo}))}},i.prototype.handleAuthenticationResponse=function(t){return function(e){var n,i=o.decodeQueryString(e);i.user_closed||(n=JSON.parse(i.auth_response),n.success?t(null,{nonce:n.paymentMethod.nonce,verificationDetails:n.threeDSecureInfo}):n.threeDSecureInfo&&n.threeDSecureInfo.liabilityShiftPossible?t(null,{nonce:this.nonce,verificationDetails:n.threeDSecureInfo}):t(n.error))}},i.prototype._attachListeners=function(){o.addEventListener(window,"message",this._boundHandleUserClose)},i.prototype._detachListeners=function(){o.removeEventListener(window,"message",this._boundHandleUserClose)},i.prototype._createDefaultLoader=function(){this._loader=new s,document.body.appendChild(this._loader.getElement())},i.prototype._removeDefaultLoader=function(){if(this._loader){var t=this._loader.getElement(),e=t.parentNode;e&&e.removeChild(t),this._loader.dispose(),this._loader=null}},i.prototype._handleUserClose=function(t){"user_closed=true"===t.data&&this._onUserClose()},i.prototype._onUserClose=n,i.prototype._onLookupComplete=function(){this._removeDefaultLoader()},e.exports=i},{"./authorization_service":27,"./loader":30,"braintree-utilities":26}],29:[function(t,e){"use strict";var n=t("./client");e.exports={create:function(t,e){var i=new n(t,e);return i}}},{"./client":28}],30:[function(t,e){"use strict";function n(){this._element=document.createElement("div"),this._element.style.cssText=this._cssDeclarations,this._display=null,this._initialize()}var i=t("./loader_display"),o=t("./loader_message"),r=t("./loader_spinner");n.prototype._cssDeclarations=["filter:progid:DXImageTransform.Microsoft.Gradient(StartColorStr=#7F000000, EndColorStr=#7F000000)","background-color: rgba(0, 0, 0, 0.5)","display: table","height: 100%","left: 0","position: fixed","right: 0","top: 0","width: 100%","z-index: 99999"].join(";"),n.prototype.getElement=function(){return this._element},n.prototype.dispose=function(){this._display.dispose(),this._display=null,this._element=null},n.prototype._initialize=function(){var t=new r,e=window.SVGElement&&window.SVGAnimateElement&&window.SVGAnimateTransformElement;e||(t=new o("Loading...")),this._display=new i(t),this.getElement().appendChild(this._display.getElement())},e.exports=n},{"./loader_display":31,"./loader_message":32,"./loader_spinner":33}],31:[function(t,e){"use strict";function n(t){this._element=document.createElement("div"),
this._element.style.cssText=this._cssDeclarations,this._displayObject=t,this._initialize()}n.prototype._cssDeclarations=["display: table-cell","vertical-align: middle"].join(";"),n.prototype.getElement=function(){return this._element},n.prototype.dispose=function(){this._displayObject.dispose(),this._displayObject=null,this._element=null},n.prototype._initialize=function(){this.getElement().appendChild(this._displayObject.getElement())},e.exports=n},{}],32:[function(t,e){"use strict";function n(t){this._element=document.createElement("div"),this._element.style.cssText=this._cssDeclarations,this._element.innerHTML=t}n.prototype._cssDeclarations=["color: #fff","font-family: Helvetica, sans-serif","font-size: 12px","text-align: center"].join(";"),n.prototype.getElement=function(){return this._element},n.prototype.dispose=function(){this._element=null},e.exports=n},{}],33:[function(t,e){"use strict";function n(){this._element=document.createElement("div"),this._element.style.cssText=this._cssDeclarations,this._element.innerHTML=this._markup}n.prototype._cssDeclarations=["height: 36px","margin-left: auto","margin-right: auto","width: 36px"].join(";"),n.prototype._markup=['<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"','width="100%" height="100%" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">','  <path fill="#FFF" d="M43.935,25.145c0-10.318-8.364-18.683-18.683-18.683c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615c8.072,0,14.615,6.543,14.615,14.615H43.935z">','    <animateTransform attributeType="xml"','    attributeName="transform"','    type="rotate"','    from="0 25 25"','    to="360 25 25"','    dur="780ms"','    repeatCount="indefinite"','    calcMode="spline"','    keySplines="0.44, 0.22, 0, 1"','    keyTimes="0;1"/>',"  </path>","</svg>"].join(""),n.prototype.getElement=function(){return this._element},n.prototype.dispose=function(){this._element=null},e.exports=n},{}],34:[function(t,e){"use strict";function n(t){this.postMessageReceiver(t),this.hashChangeReceiver(t)}var i=t("braintree-utilities");n.prototype.postMessageReceiver=function(t){var e=this;this.wrappedCallback=function(n){var i=n.data;(/^(auth_response=)/.test(i)||"user_closed=true"===i)&&(t(i),e.stopListening())},i.addEventListener(window,"message",this.wrappedCallback)},n.prototype.hashChangeReceiver=function(t){var e,n=window.location.hash,i=this;this.poll=setInterval(function(){e=window.location.hash,e.length>0&&e!==n&&(i.stopListening(),e=e.substring(1,e.length),t(e),window.location.hash=n.length>0?n:"")},10)},n.prototype.stopListening=function(){clearTimeout(this.poll),i.removeEventListener(window,"message",this.wrappedCallback)},e.exports=n},{"braintree-utilities":26}],35:[function(t,e){"use strict";var n,i=Array.prototype.indexOf;n=i?function(t,e){return t.indexOf(e)}:function(t,e){for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n;return-1},e.exports={indexOf:n}},{}],36:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],37:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],38:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],39:[function(t,e){"use strict";function n(t){var e,n,i,o,r=[{min:0,max:180,chars:7},{min:181,max:620,chars:14},{min:621,max:960,chars:22}];for(o=r.length,t=t||window.innerWidth,n=0;o>n;n++)i=r[n],t>=i.min&&t<=i.max&&(e=i.chars);return e||60}function i(t,e){var n,i;return-1===t.indexOf("@")?t:(t=t.split("@"),n=t[0],i=t[1],n.length>e&&(n=n.slice(0,e)+"..."),i.length>e&&(i="..."+i.slice(-e)),n+"@"+i)}e.exports={truncateEmail:i,getMaxCharLength:n}},{}],40:[function(t,e){"use strict";function n(){return"https:"===window.location.protocol}function i(t){switch(t){case null:case void 0:return"";case!0:return"1";case!1:return"0";default:return encodeURIComponent(t)}}function o(t,e){var n,r,s=[];for(r in t)if(t.hasOwnProperty(r)){var a=t[r];n=e?e+"["+r+"]":r,"object"==typeof a?s.push(o(a,n)):void 0!==a&&null!==a&&s.push(i(n)+"="+i(a))}return s.join("&")}function r(t){for(var e={},n=t.split("&"),i=0;i<n.length;i++){var o=n[i].split("="),r=o[0],s=decodeURIComponent(o[1]);e[r]=s}return e}function s(t){var e=t.split("?");return 2!==e.length?{}:r(e[1])}function a(t){if(t=t.toLowerCase(),!/^http/.test(t))return!1;l.href=t;var e=l.hostname.split("."),n=e.slice(-2).join(".");return-1!==u.indexOf(c,n)}var u=t("./array"),l=document.createElement("a"),c=["paypal.com","braintreepayments.com","braintreegateway.com","localhost"];e.exports={isBrowserHttps:n,makeQueryString:o,decodeQueryString:r,getParams:s,isWhitelistedDomain:a}},{"./array":35}],41:[function(t,e){var n=t("./lib/dom"),i=t("./lib/url"),o=t("./lib/fn"),r=t("./lib/events"),s=t("./lib/string"),a=t("./lib/array");e.exports={string:s,array:a,normalizeElement:n.normalizeElement,isBrowserHttps:i.isBrowserHttps,makeQueryString:i.makeQueryString,decodeQueryString:i.decodeQueryString,getParams:i.getParams,isWhitelistedDomain:i.isWhitelistedDomain,removeEventListener:r.removeEventListener,addEventListener:r.addEventListener,bind:o.bind,isFunction:o.isFunction}},{"./lib/array":35,"./lib/dom":36,"./lib/events":37,"./lib/fn":38,"./lib/string":39,"./lib/url":40}],42:[function(t,e){function n(t){return!!t&&"object"==typeof t}function i(t){return function(e){return null==e?void 0:e[t]}}function o(t){return null!=t&&r(p(t))}function r(t){return"number"==typeof t&&t>-1&&t%1==0&&h>=t}function s(t){return null==t?!0:o(t)&&(u(t)||c(t)||a(t)||n(t)&&l(t.splice))?!t.length:!d(t).length}var a=t("lodash.isarguments"),u=t("lodash.isarray"),l=t("lodash.isfunction"),c=t("lodash.isstring"),d=t("lodash.keys"),h=9007199254740991,p=i("length");e.exports=s},{"lodash.isarguments":43,"lodash.isarray":44,"lodash.isfunction":45,"lodash.isstring":49,"lodash.keys":46}],43:[function(t,e){function n(t){return!!t&&"object"==typeof t}function i(t){return function(e){return null==e?void 0:e[t]}}function o(t){return null!=t&&r(d(t))}function r(t){return"number"==typeof t&&t>-1&&t%1==0&&c>=t}function s(t){return n(t)&&o(t)&&u.call(t,"callee")&&!l.call(t,"callee")}var a=Object.prototype,u=a.hasOwnProperty,l=a.propertyIsEnumerable,c=9007199254740991,d=i("length");e.exports=s},{}],44:[function(t,e){function n(t){return!!t&&"object"==typeof t}function i(t,e){var n=null==t?void 0:t[e];return a(n)?n:void 0}function o(t){return"number"==typeof t&&t>-1&&t%1==0&&b>=t}function r(t){return s(t)&&f.call(t)==l}function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function a(t){return null==t?!1:r(t)?m.test(h.call(t)):n(t)&&c.test(t)}var u="[object Array]",l="[object Function]",c=/^\[object .+?Constructor\]$/,d=Object.prototype,h=Function.prototype.toString,p=d.hasOwnProperty,f=d.toString,m=RegExp("^"+h.call(p).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),g=i(Array,"isArray"),b=9007199254740991,_=g||function(t){return n(t)&&o(t.length)&&f.call(t)==u};e.exports=_},{}],45:[function(t,e){function n(t){return i(t)&&s.call(t)==o}function i(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var o="[object Function]",r=Object.prototype,s=r.toString;e.exports=n},{}],46:[function(t,e){function n(t){return function(e){return null==e?void 0:e[t]}}function i(t){return null!=t&&r(b(t))}function o(t,e){return t="number"==typeof t||h.test(t)?+t:-1,e=null==e?g:e,t>-1&&t%1==0&&e>t}function r(t){return"number"==typeof t&&t>-1&&t%1==0&&g>=t}function s(t){for(var e=u(t),n=e.length,i=n&&t.length,s=!!i&&r(i)&&(d(t)||c(t)),a=-1,l=[];++a<n;){var h=e[a];(s&&o(h,i)||f.call(t,h))&&l.push(h)}return l}function a(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function u(t){if(null==t)return[];a(t)||(t=Object(t));var e=t.length;e=e&&r(e)&&(d(t)||c(t))&&e||0;for(var n=t.constructor,i=-1,s="function"==typeof n&&n.prototype===t,u=Array(e),l=e>0;++i<e;)u[i]=i+"";for(var h in t)l&&o(h,e)||"constructor"==h&&(s||!f.call(t,h))||u.push(h);return u}var l=t("lodash._getnative"),c=t("lodash.isarguments"),d=t("lodash.isarray"),h=/^\d+$/,p=Object.prototype,f=p.hasOwnProperty,m=l(Object,"keys"),g=9007199254740991,b=n("length"),_=m?function(t){var e=null==t?void 0:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&i(t)?s(t):a(t)?m(t):[]}:s;e.exports=_},{"lodash._getnative":47,"lodash.isarguments":43,"lodash.isarray":44}],47:[function(t,e){function n(t){return!!t&&"object"==typeof t}function i(t,e){var n=null==t?void 0:t[e];return s(n)?n:void 0}function o(t){return r(t)&&h.call(t)==a}function r(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function s(t){return null==t?!1:o(t)?p.test(c.call(t)):n(t)&&u.test(t)}var a="[object Function]",u=/^\[object .+?Constructor\]$/,l=Object.prototype,c=Function.prototype.toString,d=l.hasOwnProperty,h=l.toString,p=RegExp("^"+c.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=i},{}],48:[function(t,e){function n(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=n},{}],49:[function(t,e){function n(t){return!!t&&"object"==typeof t}function i(t){return"string"==typeof t||n(t)&&s.call(t)==o}var o="[object String]",r=Object.prototype,s=r.toString;e.exports=i},{}],50:[function(t,e){"use strict";var n=t("framebus");n.events=t("./lib/events"),e.exports=n},{"./lib/events":51,framebus:52}],51:[function(t,e){"use strict";for(var n=["PAYMENT_METHOD_REQUEST","PAYMENT_METHOD_RECEIVED","PAYMENT_METHOD_GENERATED","PAYMENT_METHOD_NOT_GENERATED","PAYMENT_METHOD_CANCELLED","PAYMENT_METHOD_ERROR","CONFIGURATION_REQUEST","ROOT_METADATA_REQUEST","ERROR","WARNING","UI_POPUP_DID_OPEN","UI_POPUP_DID_CLOSE","UI_POPUP_FORCE_CLOSE","ASYNC_DEPENDENCY_INITIALIZING","ASYNC_DEPENDENCY_READY","USER_FORM_SUBMIT_REQUEST","SEND_ANALYTICS_EVENTS"],i={},o=0;o<n.length;o++){var r=n[o];i[r]=r}e.exports=i},{}],52:[function(e,n,i){"use strict";!function(e,o){"object"==typeof i&&"undefined"!=typeof n?n.exports=o():"function"==typeof t&&t.amd?t([],o):e.framebus=o()}(this,function(){function t(t){return null==t?!1:null==t.Window?!1:t.constructor!==t.Window?!1:(y.push(t),!0)}function e(t){var e,n={};for(e in _)_.hasOwnProperty(e)&&(n[e]=_[e]);return n._origin=t||"*",n}function n(t){var e,n,i=r(this);return s(t)?!1:s(i)?!1:(n=Array.prototype.slice.call(arguments,1),e=a(t,n,i),e===!1?!1:(p(b.top,e,i),!0))}function i(t,e){var n=r(this);return g(t,e,n)?!1:(v[n]=v[n]||{},v[n][t]=v[n][t]||[],v[n][t].push(e),!0)}function o(t,e){var n,i,o=r(this);if(g(t,e,o))return!1;if(i=v[o]&&v[o][t],!i)return!1;for(n=0;n<i.length;n++)if(i[n]===e)return i.splice(n,1),!0;return!1}function r(t){return t&&t._origin||"*"}function s(t){return"string"!=typeof t}function a(t,e,n){var i=!1,o={event:t,origin:n},r=e[e.length-1];"function"==typeof r&&(o.reply=m(r,n),e=e.slice(0,-1)),o.args=e;try{i=w+JSON.stringify(o)}catch(s){throw new Error("Could not stringify event: "+s.message)}return i}function u(t){var e,n,i,o;if(t.data.slice(0,w.length)!==w)return!1;try{e=JSON.parse(t.data.slice(w.length))}catch(r){return!1}return null!=e.reply&&(n=t.origin,i=t.source,o=e.reply,e.reply=function(t){var e=a(o,[t],n);return e===!1?!1:void i.postMessage(e,n)},e.args.push(e.reply)),e}function l(t){b||(b=t||window,b.addEventListener?b.addEventListener("message",d,!1):b.attachEvent?b.attachEvent("onmessage",d):null===b.onmessage?b.onmessage=d:b=null)}function c(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"===t?e:3&e|8;return n.toString(16)})}function d(t){var e;s(t.data)||(e=u(t),e&&(h("*",e.event,e.args,t),h(t.origin,e.event,e.args,t),f(t.data,e.origin,t.source)))}function h(t,e,n,i){var o;if(v[t]&&v[t][e])for(o=0;o<v[t][e].length;o++)v[t][e][o].apply(i,n)}function p(t,e,n){var i;try{t.postMessage(e,n)}catch(o){return}for(t.opener&&!t.opener.closed&&t.opener!==b&&p(t.opener.top,e,n),i=0;i<t.frames.length;i++)p(t.frames[i],e,n)}function f(t,e,n){var i,o;for(i=y.length-1;i>=0;i--)o=y[i],o.closed===!0?y=y.slice(i,1):n!==o&&p(o.top,t,e)}function m(t,e){function n(o,r){t(o,r),_.target(e).unsubscribe(i,n)}var i=c();return _.target(e).subscribe(i,n),i}function g(t,e,n){return s(t)?!0:"function"!=typeof e?!0:!!s(n)}var b,_,y=[],v={},w="/*framebus*/";return l(),_={target:e,include:t,publish:n,pub:n,trigger:n,emit:n,subscribe:i,sub:i,on:i,unsubscribe:o,unsub:o,off:o}})},{}],53:[function(t,e){"use strict";function n(t,e){a.emit(a.events.ERROR,{type:e,message:t})}function i(t){t=t||{};var e=t.coinbase;if(null==t.apiClient)n("settings.apiClient is required for coinbase",u);else if(t.configuration.coinbaseEnabled)if(e&&(e.container||e.button))if(e.container&&e.button)n("options.coinbase.container and options.coinbase.button are mutually exclusive",u);else{if(s.isSupportedBrowser())return!0;n("Coinbase is not supported by your browser. Please consider upgrading","UNSUPPORTED_BROWSER")}else n("Either options.coinbase.container or options.coinbase.button is required for Coinbase integrations",u);else n("Coinbase is not enabled for your merchant account",u);return!1}function o(t){return i(t)?new r(t):void 0}var r=t("./lib/coinbase"),s=t("./lib/detector"),a=t("braintree-bus"),u="CONFIGURATION";e.exports={create:o}},{"./lib/coinbase":56,"./lib/detector":58,"braintree-bus":64}],54:[function(t,e){(function(t){"use strict";function n(e){return e=e||t.navigator.userAgent,/AppleWebKit\//.test(e)&&/Mobile\//.test(e)?e.replace(/.* OS ([0-9_]+) like Mac OS X.*/,"$1").replace(/_/g,"."):null}function i(e){e=e||t.navigator.userAgent;var n=null,i=/MSIE.(\d+)/.exec(e);return/Trident/.test(e)&&(n=11),i&&(n=parseInt(i[1],10)),n}function o(e){return e=e||t.navigator.userAgent,/Android/.test(e)?e.replace(/^.* Android ([0-9\.]+).*$/,"$1"):null}e.exports={ieVersion:i,iOSSafariVersion:n,androidVersion:o}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],55:[function(t,e){"use strict";function n(t,e,n){return t?(i.emit(i.events.ERROR,t.error),void n._sendAnalyticsEvent("generate.nonce.failed")):(i.emit(i.events.PAYMENT_METHOD_GENERATED,e),void n._sendAnalyticsEvent("generate.nonce.succeeded"))}var i=t("braintree-bus");e.exports={tokenize:n}},{"braintree-bus":64}],56:[function(t,e){(function(n){"use strict";function i(t){return{clientId:t.configuration.coinbase.clientId,redirectUrl:t.configuration.coinbase.redirectUrl,scopes:t.configuration.coinbase.scopes||l.SCOPES,meta:{authorizations_merchant_account:t.configuration.coinbase.merchantAccount||""}}}function o(t){var e;this.buttonId=t.coinbase.button||l.BUTTON_ID,this.apiClient=t.apiClient,this.assetsUrl=t.configuration.assetsUrl,this.environment=t.configuration.coinbase.environment,this._onOAuthSuccess=r.bind(this._onOAuthSuccess,this),this._handleButtonClick=r.bind(this._handleButtonClick,this),this.popupParams=i(t),this.redirectDoneInterval=null,t.coinbase.container?(e=r.normalizeElement(t.coinbase.container),this._insertFrame(e)):(n.braintreeCoinbasePopupCallback=this._onOAuthSuccess,e=document.body,r.addEventListener(e,"click",this._handleButtonClick),this._sendAnalyticsEvent("initialized"))}var r=t("braintree-utilities"),s=t("./dom/composer"),a=t("./url-composer"),u=t("./callbacks"),l=t("./constants"),c=t("./detector"),d=t("braintree-bus");o.prototype._sendAnalyticsEvent=function(t){var e=this.apiClient.integration+".web.coinbase.";this.apiClient.sendAnalyticsEvents(e+t)},o.prototype._insertFrame=function(t){var e=s.createFrame({src:this.assetsUrl+"/coinbase/"+l.VERSION+"/coinbase-frame.html"});d.emit(d.events.ASYNC_DEPENDENCY_INITIALIZING),t.appendChild(e)},o.prototype._onOAuthSuccess=function(t){return t.code?(d.emit("coinbase:view:navigate","loading"),this._sendAnalyticsEvent("popup.authorized"),this.apiClient.tokenizeCoinbase({code:t.code,query:a.getQueryString()},r.bind(function(t,e){u.tokenize.apply(null,[t,e,this])},this)),void this._closePopup()):(this._sendAnalyticsEvent("popup.denied"),void this._closePopup())},o.prototype._clearPollForRedirectDone=function(){this.redirectDoneInterval&&(clearInterval(this.redirectDoneInterval),this.redirectDoneInterval=null)},o.prototype._closePopup=function(t){t=t||this.popup,c.shouldCloseFromParent()&&t.close(),this._popupCleanup()},o.prototype._popupCleanup=function(){this._clearPollForRedirectDone(),d.emit(d.events.UI_POPUP_DID_CLOSE,{source:l.INTEGRATION_NAME})},o.prototype._pollForRedirectDone=function(t){var e=setInterval(r.bind(function(){var e;if(null==t||t.closed)return this._sendAnalyticsEvent("popup.aborted"),void this._popupCleanup();try{if("about:blank"===t.location.href)throw new Error("Not finished loading");e=r.decodeQueryString(t.location.search.replace(/^\?/,"")).code}catch(n){return}this._onOAuthSuccess({code:e})},this),100);return this.redirectDoneInterval=e,e},o.prototype._openPopup=function(){var t;this._sendAnalyticsEvent("popup.started"),t=s.createPopup(a.compose(this._getOAuthBaseUrl(),this.popupParams)),t.focus(),this._pollForRedirectDone(t),d.trigger(d.events.UI_POPUP_DID_OPEN,{source:l.INTEGRATION_NAME}),d.on(d.events.UI_POPUP_FORCE_CLOSE,function(e){e.target===l.INTEGRATION_NAME&&t.close()}),this.popup=t},o.prototype._getOAuthBaseUrl=function(){var t;return t="shared_sandbox"===this.environment?l.SANDBOX_OAUTH_BASE_URL:l.PRODUCTION_OAUTH_BASE_URL},o.prototype._handleButtonClick=function(t){for(var e=t.target||t.srcElement;;){if(null==e)return;if(e===t.currentTarget)return;if(e.id===this.buttonId)break;e=e.parentNode}t&&t.preventDefault?t.preventDefault():t.returnValue=!1,this._openPopup()},e.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./callbacks":55,"./constants":57,"./detector":58,"./dom/composer":60,"./url-composer":63,"braintree-bus":64,"braintree-utilities":73}],57:[function(t,e){"use strict";e.exports={PRODUCTION_OAUTH_BASE_URL:"https://coinbase.com",SANDBOX_OAUTH_BASE_URL:"https://sandbox.coinbase.com",ORIGIN_URL:"https://www.coinbase.com",FRAME_NAME:"braintree-coinbase-frame",POPUP_NAME:"coinbase",BUTTON_ID:"bt-coinbase-button",SCOPES:"send",VERSION:"0.2.2",INTEGRATION_NAME:"Coinbase"}},{}],58:[function(t,e){"use strict";function n(){var t=s.ieVersion();return!t||t>8}function i(){var t=s.androidVersion();return null==t?!1:/^5/.test(t)}function o(){return!(i()||r())}function r(){var t=s.iOSSafariVersion();return null==t?!1:/^8\.0/.test(t)||/^8\.1$/.test(t)}var s=t("./browser");e.exports={isSupportedBrowser:n,shouldCloseFromParent:o,shouldDisplayIOSClose:r,shouldDisplayLollipopClose:i}},{"./browser":54}],59:[function(t,e){"use strict";function n(t){var e=document.createElement("button");return t=t||{},e.id=t.id||"coinbase-button",e.style.backgroundColor=t.backgroundColor||"#EEE",e.style.color=t.color||"#4597C3",e.style.border=t.border||"0",e.style.borderRadius=t.borderRadius||"6px",e.style.padding=t.padding||"12px",e.innerHTML=t.innerHTML||"coinbase",e}e.exports={create:n}},{}],60:[function(t,e){"use strict";var n=t("./popup"),i=t("./button"),o=t("./frame");e.exports={createButton:i.create,createPopup:n.create,createFrame:o.create}},{"./button":59,"./frame":61,"./popup":62}],61:[function(t,e){"use strict";function n(t){return o({src:t.src,name:i.FRAME_NAME,height:"70px",width:"100%",style:{padding:0,margin:0,border:0,outline:"none"}})}var i=t("../constants"),o=t("iframer");e.exports={create:n}},{"../constants":57,iframer:74}],62:[function(t,e){(function(n){"use strict";function i(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push([n,t[n]].join("="));return e.join(",")}function o(){var t=850,e=600;return i({width:t,height:e,left:(screen.width-t)/2,top:(screen.height-e)/4})}function r(t){return n.open(t,s.POPUP_NAME,o())}var s=t("../constants");e.exports={create:r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../constants":57}],63:[function(t,e){"use strict";function n(){return"version="+o.VERSION}function i(t,e){var i=t+"/oauth/authorize?response_type=code",o=e.redirectUrl+"?"+n();if(i+="&redirect_uri="+encodeURIComponent(o),i+="&client_id="+e.clientId,e.scopes&&(i+="&scope="+encodeURIComponent(e.scopes)),e.meta)for(var r in e.meta)e.meta.hasOwnProperty(r)&&(i+="&meta["+encodeURIComponent(r)+"]="+encodeURIComponent(e.meta[r]));return i}var o=t("./constants");e.exports={compose:i,getQueryString:n}},{"./constants":57}],64:[function(t,e,n){arguments[4][50][0].apply(n,arguments)},{"./lib/events":65,dup:50,framebus:66}],65:[function(t,e,n){arguments[4][51][0].apply(n,arguments)},{dup:51}],66:[function(t,e,n){arguments[4][52][0].apply(n,arguments)},{dup:52}],67:[function(t,e,n){arguments[4][35][0].apply(n,arguments)},{dup:35}],68:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],69:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],70:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],71:[function(t,e,n){arguments[4][39][0].apply(n,arguments)},{dup:39}],72:[function(t,e,n){arguments[4][40][0].apply(n,arguments)},{"./array":67,dup:40}],73:[function(t,e,n){arguments[4][41][0].apply(n,arguments)},{"./lib/array":67,"./lib/dom":68,"./lib/events":69,"./lib/fn":70,"./lib/string":71,"./lib/url":72,dup:41}],74:[function(t,e){"use strict";var n=t("lodash.assign"),i=t("lodash.isstring"),o=t("./lib/default-attributes");e.exports=function(t){var e=document.createElement("iframe"),r=n({},o,t);r.style&&!i(r.style)&&(n(e.style,r.style),delete r.style);for(var s in r)r.hasOwnProperty(s)&&e.setAttribute(s,r[s]);return e.getAttribute("id")||(e.id=e.name),e}},{"./lib/default-attributes":75,"lodash.assign":76,"lodash.isstring":87}],75:[function(t,e){e.exports={frameBorder:0,allowtransparency:!0}},{}],76:[function(t,e){function n(t,e,n){for(var i=-1,o=r(e),s=o.length;++i<s;){var a=o[i],u=t[a],l=n(u,e[a],a,t,e);(l===l?l===u:u!==u)&&(void 0!==u||a in t)||(t[a]=l)}return t}var i=t("lodash._baseassign"),o=t("lodash._createassigner"),r=t("lodash.keys"),s=o(function(t,e,o){return o?n(t,e,o):i(t,e)});e.exports=s},{"lodash._baseassign":77,"lodash._createassigner":79,"lodash.keys":83}],77:[function(t,e){function n(t,e){return null==e?t:i(e,o(e),t)}var i=t("lodash._basecopy"),o=t("lodash.keys");e.exports=n},{"lodash._basecopy":78,"lodash.keys":83}],78:[function(t,e){function n(t,e,n){n||(n={});for(var i=-1,o=e.length;++i<o;){var r=e[i];n[r]=t[r]}return n}e.exports=n},{}],79:[function(t,e){function n(t){return r(function(e,n){var r=-1,s=null==e?0:n.length,a=s>2?n[s-2]:void 0,u=s>2?n[2]:void 0,l=s>1?n[s-1]:void 0;for("function"==typeof a?(a=i(a,l,5),s-=2):(a="function"==typeof l?l:void 0,s-=a?1:0),u&&o(n[0],n[1],u)&&(a=3>s?void 0:a,s=1);++r<s;){var c=n[r];c&&t(e,c,a)}return e})}var i=t("lodash._bindcallback"),o=t("lodash._isiterateecall"),r=t("lodash.restparam");e.exports=n},{"lodash._bindcallback":80,"lodash._isiterateecall":81,"lodash.restparam":82}],80:[function(t,e){function n(t,e,n){if("function"!=typeof t)return i;if(void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,o){return t.call(e,n,i,o)};case 4:return function(n,i,o,r){return t.call(e,n,i,o,r)};case 5:return function(n,i,o,r,s){return t.call(e,n,i,o,r,s)}}return function(){return t.apply(e,arguments)}}function i(t){return t}e.exports=n},{}],81:[function(t,e){function n(t){return function(e){return null==e?void 0:e[t]}}function i(t){return null!=t&&s(c(t))}function o(t,e){return t="number"==typeof t||u.test(t)?+t:-1,e=null==e?l:e,t>-1&&t%1==0&&e>t}function r(t,e,n){if(!a(n))return!1;var r=typeof e;if("number"==r?i(n)&&o(e,n.length):"string"==r&&e in n){var s=n[e];return t===t?t===s:s!==s}return!1}function s(t){return"number"==typeof t&&t>-1&&t%1==0&&l>=t}function a(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var u=/^\d+$/,l=9007199254740991,c=n("length");e.exports=r},{}],82:[function(t,e){function n(t,e){if("function"!=typeof t)throw new TypeError(i);return e=o(void 0===e?t.length-1:+e||0,0),function(){for(var n=arguments,i=-1,r=o(n.length-e,0),s=Array(r);++i<r;)s[i]=n[e+i];switch(e){case 0:return t.call(this,s);case 1:return t.call(this,n[0],s);case 2:return t.call(this,n[0],n[1],s)}var a=Array(e+1);for(i=-1;++i<e;)a[i]=n[i];return a[e]=s,t.apply(this,a)}}var i="Expected a function",o=Math.max;e.exports=n},{}],83:[function(t,e,n){arguments[4][46][0].apply(n,arguments)},{dup:46,"lodash._getnative":84,"lodash.isarguments":85,"lodash.isarray":86}],84:[function(t,e,n){arguments[4][47][0].apply(n,arguments)},{dup:47}],85:[function(t,e,n){arguments[4][43][0].apply(n,arguments)},{dup:43}],86:[function(t,e,n){arguments[4][44][0].apply(n,arguments)},{dup:44}],87:[function(t,e,n){arguments[4][49][0].apply(n,arguments)},{dup:49}],88:[function(t,e,n){arguments[4][2][0].apply(n,arguments)},{"./coinbase-account":89,"./credit-card":91,"./europe-bank-account":92,"./normalize-api-fields":94,"./parse-client-token":95,"./paypal-account":96,"./request/choose-driver":99,"./sepa-mandate":104,"./should-enable-cors":105,"./util":106,"braintree-3ds":115,"braintree-utilities":127,dup:2}],89:[function(t,e,n){arguments[4][3][0].apply(n,arguments)},{dup:3}],90:[function(t,e,n){arguments[4][4][0].apply(n,arguments)},{dup:4}],91:[function(t,e,n){arguments[4][5][0].apply(n,arguments)},{dup:5}],92:[function(t,e,n){arguments[4][6][0].apply(n,arguments)},{dup:6}],93:[function(t,e,n){arguments[4][7][0].apply(n,arguments)},{"./parse-client-token":95,"./request/choose-driver":99,"./should-enable-cors":105,"./util":106,dup:7}],94:[function(t,e,n){arguments[4][8][0].apply(n,arguments)},{dup:8}],95:[function(t,e,n){arguments[4][9][0].apply(n,arguments)},{"./polyfill":97,"braintree-utilities":127,dup:9}],96:[function(t,e,n){arguments[4][10][0].apply(n,arguments)},{dup:10}],97:[function(t,e,n){arguments[4][11][0].apply(n,arguments)},{dup:11}],98:[function(t,e,n){arguments[4][12][0].apply(n,arguments)},{"../constants":90,"../util":106,"./parse-body":102,"./prep-body":103,dup:12}],99:[function(t,e,n){arguments[4][13][0].apply(n,arguments)},{"../util":106,"./ajax-driver":98,"./jsonp-driver":100,dup:13}],100:[function(t,e,n){arguments[4][14][0].apply(n,arguments)},{"../constants":90,"./jsonp":101,dup:14}],101:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{"../util":106,dup:15}],102:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{dup:16}],103:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{dup:17,"lodash.isstring":135}],104:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],105:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],106:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20,"lodash.isempty":128,"lodash.isobject":134}],107:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{"./lib/client":88,"./lib/get-configuration":93,"./lib/parse-client-token":95,"./lib/util":106,dup:21}],108:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],109:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],110:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],111:[function(t,e,n){arguments[4][25][0].apply(n,arguments)},{dup:25}],112:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{"./lib/dom":108,"./lib/events":109,"./lib/fn":110,"./lib/url":111,dup:26}],113:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{"../shared/receiver":120,"braintree-utilities":112,dup:27}],114:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./authorization_service":113,"./loader":116,"braintree-utilities":112,dup:28}],115:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{"./client":114,dup:29}],116:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{"./loader_display":117,"./loader_message":118,"./loader_spinner":119,dup:30}],117:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],118:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],119:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{dup:33}],120:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{"braintree-utilities":112,dup:34}],121:[function(t,e,n){arguments[4][35][0].apply(n,arguments)},{dup:35}],122:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],123:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],124:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],125:[function(t,e,n){arguments[4][39][0].apply(n,arguments)},{dup:39}],126:[function(t,e,n){arguments[4][40][0].apply(n,arguments)},{"./array":121,dup:40}],127:[function(t,e,n){arguments[4][41][0].apply(n,arguments)},{"./lib/array":121,"./lib/dom":122,"./lib/events":123,"./lib/fn":124,"./lib/string":125,"./lib/url":126,dup:41}],128:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{dup:42,"lodash.isarguments":129,"lodash.isarray":130,"lodash.isfunction":131,"lodash.isstring":135,"lodash.keys":132}],129:[function(t,e,n){arguments[4][43][0].apply(n,arguments)},{dup:43}],130:[function(t,e,n){arguments[4][44][0].apply(n,arguments)},{dup:44}],131:[function(t,e,n){arguments[4][45][0].apply(n,arguments)},{dup:45}],132:[function(t,e,n){arguments[4][46][0].apply(n,arguments)},{dup:46,"lodash._getnative":133,"lodash.isarguments":129,"lodash.isarray":130}],133:[function(t,e,n){arguments[4][47][0].apply(n,arguments)},{dup:47}],134:[function(t,e,n){arguments[4][48][0].apply(n,arguments)},{dup:48}],135:[function(t,e,n){arguments[4][49][0].apply(n,arguments)},{dup:49}],136:[function(t,e,n){arguments[4][50][0].apply(n,arguments)},{"./lib/events":137,dup:50,framebus:138}],137:[function(t,e,n){arguments[4][51][0].apply(n,arguments)},{dup:51}],138:[function(t,e,n){arguments[4][52][0].apply(n,arguments)},{dup:52}],139:[function(t,e,n){arguments[4][2][0].apply(n,arguments)},{"./coinbase-account":140,"./credit-card":142,"./europe-bank-account":143,"./normalize-api-fields":145,"./parse-client-token":146,"./paypal-account":147,"./request/choose-driver":150,"./sepa-mandate":155,"./should-enable-cors":156,"./util":157,"braintree-3ds":166,"braintree-utilities":178,dup:2}],140:[function(t,e,n){arguments[4][3][0].apply(n,arguments)},{dup:3}],141:[function(t,e,n){arguments[4][4][0].apply(n,arguments)},{dup:4}],142:[function(t,e,n){arguments[4][5][0].apply(n,arguments)},{dup:5}],143:[function(t,e,n){arguments[4][6][0].apply(n,arguments)},{dup:6}],144:[function(t,e,n){arguments[4][7][0].apply(n,arguments)},{"./parse-client-token":146,"./request/choose-driver":150,"./should-enable-cors":156,"./util":157,dup:7}],145:[function(t,e,n){arguments[4][8][0].apply(n,arguments)},{dup:8}],146:[function(t,e,n){arguments[4][9][0].apply(n,arguments)},{"./polyfill":148,"braintree-utilities":178,dup:9}],147:[function(t,e,n){arguments[4][10][0].apply(n,arguments)},{dup:10}],148:[function(t,e,n){arguments[4][11][0].apply(n,arguments)},{dup:11}],149:[function(t,e,n){arguments[4][12][0].apply(n,arguments)},{"../constants":141,"../util":157,"./parse-body":153,"./prep-body":154,dup:12}],150:[function(t,e,n){arguments[4][13][0].apply(n,arguments)},{"../util":157,"./ajax-driver":149,"./jsonp-driver":151,dup:13}],151:[function(t,e,n){arguments[4][14][0].apply(n,arguments)},{"../constants":141,"./jsonp":152,dup:14}],152:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{"../util":157,dup:15}],153:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{dup:16}],154:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{dup:17,"lodash.isstring":186}],155:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],156:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],157:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20,"lodash.isempty":179,"lodash.isobject":185}],158:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{"./lib/client":139,"./lib/get-configuration":144,"./lib/parse-client-token":146,"./lib/util":157,dup:21}],159:[function(t,e,n){arguments[4][22][0].apply(n,arguments);
},{dup:22}],160:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],161:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],162:[function(t,e,n){arguments[4][25][0].apply(n,arguments)},{dup:25}],163:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{"./lib/dom":159,"./lib/events":160,"./lib/fn":161,"./lib/url":162,dup:26}],164:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{"../shared/receiver":171,"braintree-utilities":163,dup:27}],165:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./authorization_service":164,"./loader":167,"braintree-utilities":163,dup:28}],166:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{"./client":165,dup:29}],167:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{"./loader_display":168,"./loader_message":169,"./loader_spinner":170,dup:30}],168:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],169:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],170:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{dup:33}],171:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{"braintree-utilities":163,dup:34}],172:[function(t,e,n){arguments[4][35][0].apply(n,arguments)},{dup:35}],173:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],174:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],175:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],176:[function(t,e,n){arguments[4][39][0].apply(n,arguments)},{dup:39}],177:[function(t,e,n){arguments[4][40][0].apply(n,arguments)},{"./array":172,dup:40}],178:[function(t,e,n){arguments[4][41][0].apply(n,arguments)},{"./lib/array":172,"./lib/dom":173,"./lib/events":174,"./lib/fn":175,"./lib/string":176,"./lib/url":177,dup:41}],179:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{dup:42,"lodash.isarguments":180,"lodash.isarray":181,"lodash.isfunction":182,"lodash.isstring":186,"lodash.keys":183}],180:[function(t,e,n){arguments[4][43][0].apply(n,arguments)},{dup:43}],181:[function(t,e,n){arguments[4][44][0].apply(n,arguments)},{dup:44}],182:[function(t,e,n){arguments[4][45][0].apply(n,arguments)},{dup:45}],183:[function(t,e,n){arguments[4][46][0].apply(n,arguments)},{dup:46,"lodash._getnative":184,"lodash.isarguments":180,"lodash.isarray":181}],184:[function(t,e,n){arguments[4][47][0].apply(n,arguments)},{dup:47}],185:[function(t,e,n){arguments[4][48][0].apply(n,arguments)},{dup:48}],186:[function(t,e,n){arguments[4][49][0].apply(n,arguments)},{dup:49}],187:[function(t,e,n){arguments[4][50][0].apply(n,arguments)},{"./lib/events":188,dup:50,framebus:189}],188:[function(t,e,n){arguments[4][51][0].apply(n,arguments)},{dup:51}],189:[function(t,e,n){arguments[4][52][0].apply(n,arguments)},{dup:52}],190:[function(t,e,n){arguments[4][35][0].apply(n,arguments)},{dup:35}],191:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],192:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],193:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],194:[function(t,e,n){arguments[4][39][0].apply(n,arguments)},{dup:39}],195:[function(t,e,n){arguments[4][40][0].apply(n,arguments)},{"./array":190,dup:40}],196:[function(t,e,n){arguments[4][41][0].apply(n,arguments)},{"./lib/array":190,"./lib/dom":191,"./lib/events":192,"./lib/fn":193,"./lib/string":194,"./lib/url":195,dup:41}],197:[function(t,e){function n(t){var e=window.getComputedStyle?getComputedStyle(t):t.currentStyle;return{overflow:e.overflow||"",height:t.style.height||""}}function i(){return{html:{node:document.documentElement,styles:n(document.documentElement)},body:{node:document.body,styles:n(document.body)}}}function o(t,e){if(!t)throw new Error('Parameter "clientToken" cannot be null');e=e||{},this._clientToken=r.parseClientToken(t),this._clientOptions=e,this.container=e.container,this.merchantPageDefaultStyles=null,this.paymentMethodNonceInputField=e.paymentMethodNonceInputField,this.frame=null,this.popup=null,this.insertFrameFunction=e.insertFrame,this.onSuccess=e.onSuccess,this.onCancelled=e.onCancelled,this.onUnsupported=e.onUnsupported,this.loggedInView=null,this.loggedOutView=null,this.insertUI=!0}var r=t("braintree-api"),s=t("braintree-bus"),a=t("braintree-utilities"),u=t("./logged-in-view"),l=t("./logged-out-view"),c=t("./overlay-view"),d=t("../shared/util/browser"),h=t("../shared/util/dom"),p=t("../shared/constants"),f=t("../shared/util/util"),m=t("../shared/get-locale");o.prototype.getViewerUrl=function(){var t=this._clientToken.paypal.assetsUrl;return t+"/pwpp/"+p.VERSION+"/html/braintree-frame.html"},o.prototype.getProxyUrl=function(){var t=this._clientToken.paypal.assetsUrl;return t+"/pwpp/"+p.VERSION+"/html/proxy-frame.html"},o.prototype.initialize=function(){if(!this._clientToken.paypalEnabled)return void("function"==typeof this.onUnsupported&&this.onUnsupported(new Error("PayPal is not enabled")));if(!this._isBrowserSecure())return void("function"==typeof this.onUnsupported&&this.onUnsupported(new Error("unsupported protocol detected")));if(this._isHermesCapable()){if(!this._isHermesSupportedCurrency())return void("function"==typeof this.onUnsupported&&this.onUnsupported(new Error("This PayPal integration does not support this currency")));if(!this._isHermesSupportedCountries())return void("function"==typeof this.onUnsupported&&this.onUnsupported(new Error("This PayPal integration does not support this locale")));if(!this._isValidAmount())return void("function"==typeof this.onUnsupported&&this.onUnsupported(new Error("Amount must be a number")))}return this._isMisconfiguredUnvettedMerchant()?void("function"==typeof this.onUnsupported&&this.onUnsupported(new Error("Unvetted merchants must provide a payeeEmail, amount, and currency"))):(this._overrideClientTokenProperties(),d.isProxyFrameRequired()&&this._insertProxyFrame(),this._setupDomElements(),this._setupPaymentMethodNonceInputField(),this._setupViews(),void this._createBusSubscribers())},o.prototype._isSupportedOption=function(t,e){for(var n=e.length,i=!1,o=0;n>o;o++)t.toLowerCase()===e[o].toLowerCase()&&(i=!0);return i},o.prototype._isHermesSupportedCurrency=function(){return this._isSupportedOption(this._clientOptions.currency,p.ARIES_SUPPORTED_CURRENCIES)},o.prototype._isHermesSupportedCountries=function(){return this._isSupportedOption(m(this._clientOptions.locale).split("_")[1],p.ARIES_SUPPORTED_COUNTRIES)},o.prototype._isValidAmount=function(){var t=parseFloat(this._clientOptions.amount);return"number"==typeof t&&!isNaN(t)&&t>=0},o.prototype._isMisconfiguredUnvettedMerchant=function(){return this._clientToken.paypal.unvettedMerchant&&(!this._isHermesCapable()||!this._clientToken.paypal.payeeEmail)},o.prototype._isBrowserSecure=function(){return a.isBrowserHttps()||d.isPopupSupported()||this._clientToken.paypal.allowHttp},o.prototype._overrideClientTokenProperties=function(){this._clientOptions.displayName&&(this._clientToken.paypal.displayName=this._clientOptions.displayName)},o.prototype._setupDomElements=function(){this.insertUI&&(this.container=a.normalizeElement(this.container))},o.prototype._setupPaymentMethodNonceInputField=function(){if(this.insertUI){var t=this.paymentMethodNonceInputField;a.isFunction(t)||(t=void 0!==t?a.normalizeElement(t):this._createPaymentMethodNonceInputField(),this.paymentMethodNonceInputField=t)}},o.prototype._setupViews=function(){var t=this._clientToken.paypal.assetsUrl;this.insertUI&&(this.loggedInView=new u({container:this.container,assetsUrl:t}),this.loggedOutView=new l({assetsUrl:t,container:this.container,isCheckout:this._isHermesCapable(),locale:this._clientOptions.locale,merchantId:"merchantId"}),a.addEventListener(this.loggedOutView.container,"click",a.bind(this._handleContainerClick,this)),a.addEventListener(this.loggedInView.logoutNode,"click",a.bind(this._handleLogout,this)))},o.prototype._createBusSubscribers=function(){s.subscribe("getClientToken",a.bind(this._handleGetClientToken,this)),s.subscribe("getClientOptions",a.bind(this._handleGetClientOptions,this)),s.subscribe("closePayPalModal",a.bind(this._handleCloseMessage,this)),s.subscribe("receivePayPalData",a.bind(this._handleSuccessfulAuthentication,this))},o.prototype._createPaymentMethodNonceInputField=function(){var t=document.createElement("input");return t.name="payment_method_nonce",t.type="hidden",this.container.appendChild(t)},o.prototype._createFrame=function(){var t,e=document.createElement("iframe");return this._isHermesCapable()?(t=p.ARIES_FRAME_NAME,e.style.background="#FFFFFF"):t=p.FRAME_NAME,e.src=this.getViewerUrl(),e.id=t,e.name=t,e.allowTransparency=!0,e.height="100%",e.width="100%",e.frameBorder=0,e.style.position=d.isMobile()?"absolute":"fixed",e.style.top=0,e.style.left=0,e.style.bottom=0,e.style.zIndex=20001,e.style.padding=0,e.style.margin=0,e.style.border=0,e.style.outline="none",e},o.prototype._removeFrame=function(t){t=t||document.body,this.frame&&t.contains(this.frame)&&(t.removeChild(this.frame),this._unlockMerchantWindowSize())},o.prototype._insertFrame=function(){this.insertFrameFunction?this.insertFrameFunction(this.getViewerUrl()):(this.frame=this._createFrame(),document.body.appendChild(this.frame)),this._lockMerchantWindowSize()},o.prototype._handleContainerClick=function(t){function e(t){return t.className.match(/paypal-button(?!-widget)/)||"braintree-paypal-button"===t.id}var n=t.target||t.srcElement;(e(n)||e(n.parentNode))&&(t.preventDefault?t.preventDefault():t.returnValue=!1,this._open())},o.prototype._setMerchantPageDefaultStyles=function(){this.merchantPageDefaultStyles=i()},o.prototype._open=function(){this._isHermesCapable()&&this._addCorrelationIdToClientToken(),d.isPopupSupported()?this._openPopup():this._openModal()},o.prototype._close=function(){d.isPopupSupported()?this._closePopup():this._closeModal()},o.prototype._openModal=function(){this._removeFrame(),this._insertFrame()},o.prototype._isHermesCapable=function(){return!!this._clientOptions.singleUse&&!!this._clientOptions.amount&&!!this._clientOptions.currency},o.prototype._openPopup=function(){var t,e,n,i=[],o=window.outerWidth||document.documentElement.clientWidth,r=window.outerHeight||document.documentElement.clientHeight,s="undefined"==typeof window.screenY?window.screenTop:window.screenY,a="undefined"==typeof window.screenX?window.screenLeft:window.screenX;this._isHermesCapable()?(t=p.ARIES_POPUP_NAME,n=p.ARIES_POPUP_HEIGHT,e=p.ARIES_POPUP_WIDTH):(t=p.POPUP_NAME,n=p.POPUP_HEIGHT,e=p.POPUP_WIDTH);var u=(o-e)/2+a,l=(r-n)/2+s;return i.push("height="+n),i.push("width="+e),i.push("top="+l),i.push("left="+u),i.push(p.POPUP_OPTIONS),this.popup=window.open(this.getViewerUrl(),t,i.join(",")),d.isOverlaySupported()&&(this.overlayView=new c(this.popup,this._clientToken.paypal.assetsUrl),this.overlayView.render()),this.popup.focus(),this.popup},o.prototype._addCorrelationIdToClientToken=function(){this._clientToken.correlationId=f.generateUid()},o.prototype._createProxyFrame=function(){var t=document.createElement("iframe");return t.src=this.getProxyUrl(),t.id=p.BRIDGE_FRAME_NAME,t.name=p.BRIDGE_FRAME_NAME,t.allowTransparency=!0,t.height=0,t.width=0,t.frameBorder=0,t.style.position="static",t.style.padding=0,t.style.margin=0,t.style.border=0,t.style.outline="none",t},o.prototype._insertProxyFrame=function(){this.proxyFrame=this._createProxyFrame(),document.body.appendChild(this.proxyFrame)},o.prototype._closeModal=function(){this._removeFrame()},o.prototype._closePopup=function(){this.popup&&(this.popup.close(),this.popup=null),this.overlayView&&d.isOverlaySupported()&&this.overlayView.remove()},o.prototype._clientTokenData=function(){return{analyticsUrl:this._clientToken.analytics?this._clientToken.analytics.url:void 0,authorizationFingerprint:this._clientToken.authorizationFingerprint,clientApiUrl:this._clientToken.clientApiUrl,displayName:this._clientToken.paypal.displayName,paypalBaseUrl:this._clientToken.paypal.assetsUrl,paypalClientId:this._clientToken.paypal.clientId,paypalPrivacyUrl:this._clientToken.paypal.privacyUrl,paypalUserAgreementUrl:this._clientToken.paypal.userAgreementUrl,unvettedMerchant:this._clientToken.paypal.unvettedMerchant,payeeEmail:this._clientToken.paypal.payeeEmail,correlationId:this._clientToken.correlationId,offline:this._clientOptions.offline||this._clientToken.paypal.environmentNoNetwork,sdkVersion:this._clientToken.sdkVersion,merchantAppId:this._clientToken.merchantAppId}},o.prototype._handleGetClientToken=function(t){t(this._clientTokenData())},o.prototype._clientOptionsData=function(){return{locale:this._clientOptions.locale||"en_us",onetime:this._clientOptions.singleUse||!1,integration:this._clientOptions.integration||"paypal",enableShippingAddress:this._clientOptions.enableShippingAddress||!1,enableBillingAddress:this._clientOptions.enableBillingAddress||!1,enableHermes:this._isHermesCapable(),amount:this._clientOptions.amount||null,currency:this._clientOptions.currency||null,shippingAddressOverride:this._clientOptions.shippingAddressOverride||null,enableCORS:this._clientOptions.enableCORS}},o.prototype._handleGetClientOptions=function(t){t(this._clientOptionsData())},o.prototype._handleSuccessfulAuthentication=function(t){this._close(),t.type=p.NONCE_TYPE,a.isFunction(this.paymentMethodNonceInputField)?this.paymentMethodNonceInputField(t.nonce):(this._showLoggedInContent(t.details.email),this._setNonceInputValue(t.nonce)),a.isFunction(this.onSuccess)&&this.onSuccess(t)},o.prototype._lockMerchantWindowSize=function(){this._setMerchantPageDefaultStyles(),document.documentElement.style.height="100%",document.documentElement.style.overflow="hidden",document.body.style.height="100%",document.body.style.overflow="hidden"},o.prototype._unlockMerchantWindowSize=function(){this.merchantPageDefaultStyles&&(document.documentElement.style.height=this.merchantPageDefaultStyles.html.styles.height,document.documentElement.style.overflow=this.merchantPageDefaultStyles.html.styles.overflow,document.body.style.height=this.merchantPageDefaultStyles.body.styles.height,document.body.style.overflow=this.merchantPageDefaultStyles.body.styles.overflow)},o.prototype._handleCloseMessage=function(){this._removeFrame()},o.prototype._showLoggedInContent=function(t){this.loggedOutView.hide(),h.setTextContent(this.loggedInView.emailNode,t),this.loggedInView.show()},o.prototype._handleLogout=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,this.loggedInView.hide(),this.loggedOutView.show(),this._setNonceInputValue(""),a.isFunction(this.onCancelled)&&this.onCancelled()},o.prototype._setNonceInputValue=function(t){this.paymentMethodNonceInputField.value=t},e.exports=o},{"../shared/constants":201,"../shared/get-locale":203,"../shared/util/browser":208,"../shared/util/dom":209,"../shared/util/util":210,"./logged-in-view":198,"./logged-out-view":199,"./overlay-view":200,"braintree-api":158,"braintree-bus":187,"braintree-utilities":196}],198:[function(t,e){function n(t){this.options=t,this.container=this.createViewContainer(),this.createPayPalName(),this.emailNode=this.createEmailNode(),this.logoutNode=this.createLogoutNode()}var i=t("../shared/constants");n.prototype.createViewContainer=function(){var t=document.createElement("div");t.id="braintree-paypal-loggedin";var e=["display: none","max-width: 500px","overflow: hidden","padding: 16px","background-image: url("+this.options.assetsUrl+"/pwpp/"+i.VERSION+"/images/paypal-small.png)","background-image: url("+this.options.assetsUrl+"/pwpp/"+i.VERSION+"/images/paypal-small.svg), none","background-position: 20px 50%","background-repeat: no-repeat","background-size: 13px 15px","border-top: 1px solid #d1d4d6","border-bottom: 1px solid #d1d4d6"].join(";");return t.style.cssText=e,this.options.container.appendChild(t),t},n.prototype.createPayPalName=function(){var t=document.createElement("span");t.id="bt-pp-name",t.innerHTML="PayPal";var e=["color: #283036","font-size: 13px","font-weight: 800",'font-family: "Helvetica Neue", Helvetica, Arial, sans-serif',"margin-left: 36px","-webkit-font-smoothing: antialiased","-moz-font-smoothing: antialiased","-ms-font-smoothing: antialiased","font-smoothing: antialiased"].join(";");return t.style.cssText=e,this.container.appendChild(t)},n.prototype.createEmailNode=function(){var t=document.createElement("span");t.id="bt-pp-email";var e=["color: #6e787f","font-size: 13px",'font-family: "Helvetica Neue", Helvetica, Arial, sans-serif',"margin-left: 5px","-webkit-font-smoothing: antialiased","-moz-font-smoothing: antialiased","-ms-font-smoothing: antialiased","font-smoothing: antialiased"].join(";");return t.style.cssText=e,this.container.appendChild(t)},n.prototype.createLogoutNode=function(){var t=document.createElement("button");t.id="bt-pp-cancel",t.innerHTML="Cancel";var e=["color: #3d95ce","font-size: 11px",'font-family: "Helvetica Neue", Helvetica, Arial, sans-serif',"line-height: 20px","margin: 0 0 0 25px","padding: 0","background-color: transparent","border: 0","cursor: pointer","text-decoration: underline","float: right","-webkit-font-smoothing: antialiased","-moz-font-smoothing: antialiased","-ms-font-smoothing: antialiased","font-smoothing: antialiased"].join(";");return t.style.cssText=e,this.container.appendChild(t)},n.prototype.show=function(){this.container.style.display="block"},n.prototype.hide=function(){this.container.style.display="none"},e.exports=n},{"../shared/constants":201}],199:[function(t,e){function n(t){this.options=t,this.assetsUrl=this.options.assetsUrl,this.container=this.createViewContainer(),this.options.isCheckout?this.createCheckoutWithPayPalButton():this.createPayWithPayPalButton()}var i=(t("braintree-utilities"),t("../shared/constants")),o=t("../shared/get-locale");n.prototype.createViewContainer=function(){var t=document.createElement("div");return t.id="braintree-paypal-loggedout",this.options.container.appendChild(t),t},n.prototype.createPayWithPayPalButton=function(){var t=document.createElement("a");t.id="braintree-paypal-button",t.href="#";var e=["display: block","width: 115px","height: 44px","overflow: hidden"].join(";");t.style.cssText=e;var n=new Image;n.src=this.assetsUrl+"/pwpp/"+i.VERSION+"/images/pay-with-paypal.png",n.setAttribute("alt","Pay with PayPal");var o=["max-width: 100%","display: block","width: 100%","height: 100%","outline: none","border: 0"].join(";");n.style.cssText=o,t.appendChild(n),this.container.appendChild(t)},n.prototype.createCheckoutWithPayPalButton=function(){var t=document.createElement("script");t.src="//www.paypalobjects.com/api/button.js",t.async=!0,t.setAttribute("data-merchant",this.options.merchantId),t.setAttribute("data-button","checkout"),t.setAttribute("data-type","button"),t.setAttribute("data-width","150"),t.setAttribute("data-height","44"),t.setAttribute("data-lc",o(this.options.locale)),this.container.appendChild(t)},n.prototype.show=function(){this.container.style.display="block"},n.prototype.hide=function(){this.container.style.display="none"},e.exports=n},{"../shared/constants":201,"../shared/get-locale":203,"braintree-utilities":196}],200:[function(t,e){function n(t,e){this.popup=t,this.assetsUrl=e,this.spriteSrc=this.assetsUrl+"/pwpp/"+o.VERSION+"/images/pp_overlay_sprite.png",this._create(),this._setupEvents(),this._pollForPopup()}var i=t("braintree-utilities"),o=t("../shared/constants");n.prototype.render=function(){document.body.contains(this.el)||document.body.appendChild(this.el)},n.prototype.remove=function(){document.body.contains(this.el)&&document.body.removeChild(this.el)},n.prototype._create=function(){this.el=document.createElement("div"),this.el.className="bt-overlay",this._setStyles(this.el,["z-index: 20001","position: fixed","top: 0","left: 0","height: 100%","width: 100%","text-align: center","background: #000","background: rgba(0,0,0,0.7)",'-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=52)"']),this.el.appendChild(this._createCloseIcon()),this.el.appendChild(this._createMessage())},n.prototype._createCloseIcon=function(){return this.closeIcon=document.createElement("div"),this.closeIcon.className="bt-close-overlay",this._setStyles(this.closeIcon,["position: absolute","top: 10px","right: 10px","cursor: pointer","background: url("+this.spriteSrc+") no-repeat 0 -67px","height: 14px","width: 14px"]),this.closeIcon},n.prototype._createMessage=function(){var t=document.createElement("div");return this._setStyles(t,["position: relative","top: 50%","max-width: 350px",'font-family: "HelveticaNeue", "HelveticaNeue-Light", "Helvetica Neue Light", helvetica, arial, sans-serif',"font-size: 14px","line-height: 20px","margin: -70px auto 0"]),t.appendChild(this._createLogo()),t.appendChild(this._createExplanation()),t.appendChild(this._createFocusLink()),t},n.prototype._createExplanation=function(){var t=document.createElement("div");return this._setStyles(t,["color: #FFF","margin-bottom: 20px"]),t.innerHTML="Don't see the secure PayPal browser? We'll help you re-launch the window to complete your purchase.",t},n.prototype._createLogo=function(){var t=document.createElement("div");return this._setStyles(t,["background: url("+this.spriteSrc+") no-repeat 0 0","width: 94px","height: 25px","margin: 0 auto 26px auto"]),t},n.prototype._createFocusLink=function(){return this.focusLink=document.createElement("a"),this._setStyles(this.focusLink,["color: #009be1","cursor: pointer"]),this.focusLink.innerHTML="Continue",this.focusLink},n.prototype._setStyles=function(t,e){var n=e.join(";");t.style.cssText=n},n.prototype._setupEvents=function(){i.addEventListener(this.closeIcon,"click",i.bind(this._handleClose,this)),i.addEventListener(this.focusLink,"click",i.bind(this._handleFocus,this))},n.prototype._handleClose=function(t){t.preventDefault(),this.remove(),this.popup.close()},n.prototype._handleFocus=function(t){t.preventDefault(),this.popup.focus()},n.prototype._pollForPopup=function(){var t=setInterval(i.bind(function(){this.popup&&this.popup.closed&&(clearInterval(t),this.remove())},this),100)},e.exports=n},{"../shared/constants":201,"braintree-utilities":196}],201:[function(t,e,n){var i="1.5.3";n.VERSION=i,n.POPUP_NAME="braintree_paypal_popup",n.ARIES_POPUP_NAME="PPFrameRedirect",n.FRAME_NAME="braintree-paypal-frame",n.ARIES_FRAME_NAME="PPFrameRedirect",n.POPUP_PATH="/pwpp/"+i+"/html/braintree-frame.html",n.POPUP_OPTIONS="resizable,scrollbars",n.POPUP_HEIGHT=470,n.POPUP_WIDTH=410,n.ARIES_POPUP_HEIGHT=535,n.ARIES_POPUP_WIDTH=450,n.BRIDGE_FRAME_NAME="bt-proxy-frame",n.ARIES_SUPPORTED_CURRENCIES=["USD","GBP","EUR","AUD","CAD","DKK","NOK","PLN","SEK","CHF","TRY"],n.ARIES_SUPPORTED_COUNTRIES=["US","GB","AU","CA","ES","FR","DE","IT","NL","NO","PL","CH","TR","DK","BE","AT"],n.NONCE_TYPE="PayPalAccount",n.ILLEGAL_XHR_ERROR="Illegal XHR request attempted"},{}],202:[function(t,e){"use strict";e.exports={us:"en_us",gb:"en_uk",uk:"en_uk",de:"de_de",fr:"fr_fr",it:"it_it",es:"es_es",ca:"en_ca",au:"en_au",at:"de_de",be:"en_us",ch:"de_de",dk:"da_dk",nl:"nl_nl",no:"no_no",pl:"pl_pl",se:"sv_se",tr:"tr_tr",bg:"en_us",cy:"en_us",hr:"en_us",is:"en_us",kh:"en_us",mt:"en_us",my:"en_us",ru:"ru_ru"}},{}],203:[function(t,e){"use strict";function n(t){return-1!==t.indexOf("_")&&5===t.length}function i(t){var e;for(var n in r)r.hasOwnProperty(n)&&(n===t?e=r[n]:r[n]===t&&(e=r[n]));return e}function o(t){var e;if(t=t?t.toLowerCase():"us",t=t.replace(/-/g,"_"),e=n(t)?t:i(t)){var o=e.split("_");return[o[0],o[1].toUpperCase()].join("_")}return"en_US"}var r=t("../shared/data/country-code-lookup");e.exports=o},{"../shared/data/country-code-lookup":202}],204:[function(t,e){function n(){return d.matchUserAgent("Android")&&!i()}function i(){return d.matchUserAgent("Chrome")||d.matchUserAgent("CriOS")}function o(){return d.matchUserAgent("Firefox")}function r(){return d.matchUserAgent("Trident")||d.matchUserAgent("MSIE")}function s(){return d.matchUserAgent("Opera")||d.matchUserAgent("OPR")}function a(){return s()&&"[object OperaMini]"===p.call(window.operamini)}function u(){return d.matchUserAgent("Safari")&&!i()&&!n()}function l(){return h.isIos()&&!i()&&!u()}function c(){var t=/Version\/[\w\.]+ Chrome\/[\w\.]+ Mobile/;return h.isAndroid()&&d.matchUserAgent(t)}var d=t("./useragent"),h=t("./platform"),p=Object.prototype.toString;e.exports={isAndroid:n,isChrome:i,isFirefox:o,isIE:r,isOpera:s,isOperaMini:a,isSafari:u,isIosWebView:l,isAndroidWebView:c}},{"./platform":206,"./useragent":207}],205:[function(t,e){function n(){return!i()&&(s.isAndroid()||s.isIpod()||s.isIphone()||r.matchUserAgent("IEMobile"))}function i(){return s.isIpad()||s.isAndroid()&&!r.matchUserAgent("Mobile")}function o(){return!n()&&!i()}var r=t("./useragent"),s=t("./platform");e.exports={isMobile:n,isTablet:i,isDesktop:o}},{"./platform":206,"./useragent":207}],206:[function(t,e){function n(){return a.matchUserAgent("Android")}function i(){return a.matchUserAgent("iPad")}function o(){return a.matchUserAgent("iPod")}function r(){return a.matchUserAgent("iPhone")&&!o()}function s(){return i()||o()||r()}var a=t("./useragent");e.exports={isAndroid:n,isIpad:i,isIpod:o,isIphone:r,isIos:s}},{"./useragent":207}],207:[function(t,e,n){function i(){return r}function o(t){var e=n.getNativeUserAgent(),i=e.match(t);return!!i}var r=window.navigator.userAgent;n.getNativeUserAgent=i,n.matchUserAgent=o},{}],208:[function(t,e){function n(){return i()&&window.outerWidth<600}function i(){return f.test(p)}function o(){return!!window.postMessage}function r(){if(l.isOperaMini())return!1;if(c.isDesktop())return!0;if(c.isMobile()||c.isTablet()){if(l.isIE())return!1;if(d.isAndroid())return!l.isAndroidWebView();if(d.isIos())return!(l.isChrome()||l.isSafari()&&h.matchUserAgent(/OS (?:8_1|8_0|8)(?!_\d)/i)||l.isIosWebView())}return!1}function s(){if(l.isIE()&&h.matchUserAgent(/MSIE 8\.0/))return!1;try{return window.self===window.top}catch(t){return!1}}function a(){return l.isIE()}function u(){var t=null,e="";try{new ActiveXObject("")}catch(n){e=n.name}try{t=!!new ActiveXObject("htmlfile")}catch(n){t=!1}return t="ReferenceError"===e||t!==!1,!t}var l=t("../useragent/browser"),c=t("../useragent/device"),d=t("../useragent/platform"),h=t("../useragent/useragent"),p=window.navigator.userAgent,f=/[Mm]obi|tablet|iOS|Android|IEMobile|Windows\sPhone/;e.exports={isMobile:n,isMobileDevice:i,detectedPostMessage:o,isPopupSupported:r,isOverlaySupported:s,isProxyFrameRequired:a,isMetroBrowser:u}},{"../useragent/browser":204,"../useragent/device":205,"../useragent/platform":206,"../useragent/useragent":207}],209:[function(t,e){function n(t,e){var n="innerText";document&&document.body&&"textContent"in document.body&&(n="textContent"),t[n]=e}e.exports={setTextContent:n}},{}],210:[function(t,e){function n(){for(var t="",e=0;32>e;e++){var n=Math.floor(16*Math.random());t+=n.toString(16)}return t}function i(t){return/^(true|1)$/i.test(t)}function o(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&apos;")}function r(t){var e=t.indexOf("?"),n={};if(e>=0&&(t=t.substr(e+1)),0!==t.length){for(var i=t.split("&"),o=0,r=i.length;r>o;o++){var s=i[o],a=s.indexOf("="),u=s.substr(0,a),l=s.substr(a+1),c=decodeURIComponent(l);c=c.replace(/</g,"&lt;").replace(/>/g,"&gt;"),"false"===c&&(c=!1),(void 0===c||"true"===c)&&(c=!0),n[u]=c}return n}}function s(t){return t&&"[object Function]"===Object.prototype.toString.call(t)}function a(t){t.preventDefault?t.preventDefault():t.returnValue=!1}var u="function"==typeof String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(/^\s+|\s+$/,"")},l="function"==typeof window.btoa?function(t){return window.btoa(t)}:function(t){for(var e,n,i,o,r,s,a,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0;c<t.length;)e=t.charCodeAt(c++),n=t.charCodeAt(c++),i=t.charCodeAt(c++),o=e>>2,r=(3&e)<<4|n>>4,s=(15&n)<<2|i>>6,a=63&i,isNaN(n)?s=a=64:isNaN(i)&&(a=64),l=l+u.charAt(o)+u.charAt(r)+u.charAt(s)+u.charAt(a);return l};e.exports={trim:u,btoa:l,generateUid:n,castToBoolean:i,htmlEscape:o,parseUrlParams:r,isFunction:s,preventDefault:a}},{}],211:[function(t,e){"use strict";function n(t){this.host=t||window,this.handlers=[],i.addEventListener(this.host,"message",i.bind(this.receive,this))}var i=t("braintree-utilities");n.prototype.receive=function(t){var e,i,o,r;try{o=JSON.parse(t.data)}catch(s){return}for(r=o.type,i=new n.Message(this,t.source,o.data),e=0;e<this.handlers.length;e++)this.handlers[e].type===r&&this.handlers[e].handler(i)},n.prototype.send=function(t,e,n){t.postMessage(JSON.stringify({type:e,data:n}),"*")},n.prototype.register=function(t,e){this.handlers.push({type:t,handler:e})},n.prototype.unregister=function(t,e){for(var n=this.handlers.length-1;n>=0;n--)if(this.handlers[n].type===t&&this.handlers[n].handler===e)return this.handlers.splice(n,1)},n.Message=function(t,e,n){this.bus=t,this.source=e,this.content=n},n.Message.prototype.reply=function(t,e){this.bus.send(this.source,t,e)},e.exports=n},{"braintree-utilities":221}],212:[function(t,e){"use strict";function n(t,e){this.bus=t,this.target=e,this.handlers=[],this.bus.register("publish",i.bind(this._handleMessage,this))}var i=t("braintree-utilities");n.prototype._handleMessage=function(t){var e,n=t.content,i=this.handlers[n.channel];if("undefined"!=typeof i)for(e=0;e<i.length;e++)i[e](n.data)},n.prototype.publish=function(t,e){this.bus.send(this.target,"publish",{channel:t,data:e})},n.prototype.subscribe=function(t,e){this.handlers[t]=this.handlers[t]||[],this.handlers[t].push(e)},n.prototype.unsubscribe=function(t,e){var n,i=this.handlers[t];if("undefined"!=typeof i)for(n=0;n<i.length;n++)i[n]===e&&i.splice(n,1)},e.exports=n},{"braintree-utilities":221}],213:[function(t,e){"use strict";function n(t){this.bus=t,this.frames=[],this.handlers=[]}n.prototype.subscribe=function(t,e){this.handlers[t]=this.handlers[t]||[],this.handlers[t].push(e)},n.prototype.registerFrame=function(t){this.frames.push(t)},n.prototype.unregisterFrame=function(t){for(var e=0;e<this.frames.length;e++)this.frames[e]===t&&this.frames.splice(e,1)},n.prototype.publish=function(t,e){var n,i=this.handlers[t];if("undefined"!=typeof i)for(n=0;n<i.length;n++)i[n](e);for(n=0;n<this.frames.length;n++)this.bus.send(this.frames[n],"publish",{channel:t,data:e})},n.prototype.unsubscribe=function(t,e){var n,i=this.handlers[t];if("undefined"!=typeof i)for(n=0;n<i.length;n++)i[n]===e&&i.splice(n,1)},e.exports=n},{}],214:[function(t,e){"use strict";function n(t,e){this.bus=t,this.target=e||window.parent,this.counter=0,this.callbacks={},this.bus.register("rpc_response",i.bind(this._handleResponse,this))}var i=t("braintree-utilities");n.prototype._handleResponse=function(t){var e=t.content,n=this.callbacks[e.id];"function"==typeof n&&(n.apply(null,e.response),delete this.callbacks[e.id])},n.prototype.invoke=function(t,e,n){var i=this.counter++;this.callbacks[i]=n,this.bus.send(this.target,"rpc_request",{id:i,method:t,args:e})},e.exports=n},{"braintree-utilities":221}],215:[function(t,e){"use strict";function n(t){this.bus=t,this.methods={},this.bus.register("rpc_request",i.bind(this._handleRequest,this))}var i=t("braintree-utilities");n.prototype._handleRequest=function(t){var e,n=t.content,i=n.args||[],o=this.methods[n.method];"function"==typeof o&&(e=function(){t.reply("rpc_response",{id:n.id,response:Array.prototype.slice.call(arguments)})},i.push(e),o.apply(null,i))},n.prototype.define=function(t,e){this.methods[t]=e},e.exports=n},{"braintree-utilities":221}],216:[function(t,e){var n=t("./lib/message-bus"),i=t("./lib/pubsub-client"),o=t("./lib/pubsub-server"),r=t("./lib/rpc-client"),s=t("./lib/rpc-server");e.exports={MessageBus:n,PubsubClient:i,PubsubServer:o,RPCClient:r,RPCServer:s}},{"./lib/message-bus":211,"./lib/pubsub-client":212,"./lib/pubsub-server":213,"./lib/rpc-client":214,"./lib/rpc-server":215}],217:[function(t,e){"use strict";function n(t,e){if(e=e||"["+t+"] is not a valid DOM Element",t&&t.nodeType&&1===t.nodeType)return t;if(t&&window.jQuery&&t instanceof jQuery&&0!==t.length)return t[0];
if("string"==typeof t&&document.getElementById(t))return document.getElementById(t);throw new Error(e)}e.exports={normalizeElement:n}},{}],218:[function(t,e){"use strict";function n(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}function i(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent("on"+e,n)}e.exports={removeEventListener:i,addEventListener:n}},{}],219:[function(t,e){"use strict";function n(t){return"[object Function]"===Object.prototype.toString.call(t)}function i(t,e){return function(){t.apply(e,arguments)}}e.exports={bind:i,isFunction:n}},{}],220:[function(t,e,n){arguments[4][25][0].apply(n,arguments)},{dup:25}],221:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{"./lib/dom":217,"./lib/events":218,"./lib/fn":219,"./lib/url":220,dup:26}],222:[function(t,e,n){arguments[4][35][0].apply(n,arguments)},{dup:35}],223:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],224:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],225:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],226:[function(t,e,n){arguments[4][39][0].apply(n,arguments)},{dup:39}],227:[function(t,e,n){arguments[4][40][0].apply(n,arguments)},{"./array":222,dup:40}],228:[function(t,e,n){arguments[4][41][0].apply(n,arguments)},{"./lib/array":222,"./lib/dom":223,"./lib/events":224,"./lib/fn":225,"./lib/string":226,"./lib/url":227,dup:41}],229:[function(t,e){(function(t){"use strict";function n(t){if(("string"==typeof t||t instanceof String)&&(t=document.getElementById(t)),!(t instanceof HTMLFormElement))throw new TypeError("FormNapper requires an HTMLFormElement element or the id string of one.");this.htmlForm=t}n.prototype.hijack=function(e){function n(t){t.preventDefault?t.preventDefault():t.returnValue=!1,e(t)}null!=t.addEventListener?this.htmlForm.addEventListener("submit",n,!1):null!=t.attachEvent?this.htmlForm.attachEvent("onsubmit",n):this.htmlForm.onsubmit=n},n.prototype.inject=function(t,e){var n=this.htmlForm.querySelector('input[name="'+t+'"]');null==n&&(n=document.createElement("input"),n.type="hidden",n.name=t,this.htmlForm.appendChild(n)),n.value=e},n.prototype.submit=function(){HTMLFormElement.prototype.submit.call(this.htmlForm)},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],230:[function(t,e,n){arguments[4][74][0].apply(n,arguments)},{"./lib/default-attributes":231,dup:74,"lodash.assign":232,"lodash.isstring":243}],231:[function(t,e,n){arguments[4][75][0].apply(n,arguments)},{dup:75}],232:[function(t,e,n){arguments[4][76][0].apply(n,arguments)},{dup:76,"lodash._baseassign":233,"lodash._createassigner":235,"lodash.keys":239}],233:[function(t,e,n){arguments[4][77][0].apply(n,arguments)},{dup:77,"lodash._basecopy":234,"lodash.keys":239}],234:[function(t,e,n){arguments[4][78][0].apply(n,arguments)},{dup:78}],235:[function(t,e,n){arguments[4][79][0].apply(n,arguments)},{dup:79,"lodash._bindcallback":236,"lodash._isiterateecall":237,"lodash.restparam":238}],236:[function(t,e,n){arguments[4][80][0].apply(n,arguments)},{dup:80}],237:[function(t,e,n){arguments[4][81][0].apply(n,arguments)},{dup:81}],238:[function(t,e,n){arguments[4][82][0].apply(n,arguments)},{dup:82}],239:[function(t,e,n){arguments[4][46][0].apply(n,arguments)},{dup:46,"lodash._getnative":240,"lodash.isarguments":241,"lodash.isarray":242}],240:[function(t,e,n){arguments[4][47][0].apply(n,arguments)},{dup:47}],241:[function(t,e,n){arguments[4][43][0].apply(n,arguments)},{dup:43}],242:[function(t,e,n){arguments[4][44][0].apply(n,arguments)},{dup:44}],243:[function(t,e,n){arguments[4][49][0].apply(n,arguments)},{dup:49}],244:[function(t,e){"use strict";function n(t){this.apiClient=t}var i=["getCreditCards","unlockCreditCard","sendAnalyticsEvents"];n.prototype.attach=function(t){function e(e){t.define(e,function(){n.apiClient[e].apply(n.apiClient,arguments)})}var n=this,o=0,r=i.length;for(o;r>o;o++)e(i[o])},e.exports=n},{}],245:[function(t,e){"use strict";function n(t,e){var n=window.getComputedStyle?getComputedStyle(t):t.currentStyle;return n[e]}function i(){return{html:{height:s.style.height||"",overflow:n(s,"overflow"),position:n(s,"position")},body:{height:a.style.height||"",overflow:n(a,"overflow")}}}function o(){var t=/Android|iPhone|iPod|iPad/i.test(window.navigator.userAgent);return t}function r(t){var e,n,i;this.merchantConfiguration=t.merchantConfiguration,this.encodedClientToken=t.gatewayConfiguration,this.analyticsConfiguration=t.analyticsConfiguration,this.paypalOptions=t.merchantConfiguration.paypal,this.container=null,this.merchantFormManager=null,this.root=t.root,this.configurationRequests=[],this.braintreeApiClient=u.configure({clientToken:t.gatewayConfiguration,analyticsConfiguration:this.analyticsConfiguration,integration:"dropin",enableCORS:this.merchantConfiguration.enableCORS}),this.paymentMethodNonceReceivedCallback=t.merchantConfiguration.paymentMethodNonceReceived,this.clientToken=u.parseClientToken(t.gatewayConfiguration),this.bus=new c.MessageBus(this.root),this.rpcServer=new c.RPCServer(this.bus),this.apiProxyServer=new h(this.braintreeApiClient),this.apiProxyServer.attach(this.rpcServer),e=t.inlineFramePath||this.clientToken.assetsUrl+"/dropin/"+_+"/inline-frame.html",n=t.modalFramePath||this.clientToken.assetsUrl+"/dropin/"+_+"/modal-frame.html",s=document.documentElement,a=document.body,this.frames={inline:this._createFrame(e,g.INLINE_FRAME_NAME),modal:this._createFrame(n,g.MODAL_FRAME_NAME)},this.container=d.normalizeElement(t.merchantConfiguration.container,"Unable to find valid container."),i=d.normalizeElement(t.merchantConfiguration.form||this._findClosest(this.container,"form")),this.merchantFormManager=new p({form:i,frames:this.frames,onSubmit:this.paymentMethodNonceReceivedCallback,apiClient:this.braintreeApiClient}).initialize(),t.gatewayConfiguration.paypalEnabled&&t.gatewayConfiguration.paypal&&(d.isBrowserHttps()||t.gatewayConfiguration.paypal.allowHttp)&&this._configurePayPal(),this.braintreeApiClient.sendAnalyticsEvents("dropin.web.initialized")}var s,a,u=t("braintree-api"),l=t("braintree-bus"),c=t("braintree-rpc"),d=t("braintree-utilities"),h=t("./api-proxy-server"),p=t("./merchant-form-manager"),f=t("./frame-container"),m=t("../shared/paypal-service"),g=t("../shared/constants"),b=t("braintree-paypal/src/shared/util/browser"),_="1.8.3";r.prototype.initialize=function(){var t,e=this;this._initializeModal(),l.emit(l.events.ASYNC_DEPENDENCY_INITIALIZING),this.container.appendChild(this.frames.inline.element),a.appendChild(this.frames.modal.element),this.rpcServer.define("receiveSharedCustomerIdentifier",function(n){for(e.braintreeApiClient.attrs.sharedCustomerIdentifier=n,e.braintreeApiClient.attrs.sharedCustomerIdentifierType="browser_session_cookie_store",t=0;t<e.configurationRequests.length;t++)e.configurationRequests[t](e.encodedClientToken);e.configurationRequests=[]}),l.on(l.events.PAYMENT_METHOD_GENERATED,d.bind(this._handleAltPayData,this)),this.rpcServer.define("getConfiguration",function(t){t({enableCORS:e.merchantConfiguration.enableCORS,clientToken:e.encodedClientToken,analyticsConfiguration:e.analyticsConfiguration,merchantHttps:d.isBrowserHttps()})}),this.rpcServer.define("getPayPalOptions",function(t){t(e.paypalOptions)}),this.rpcServer.define("selectPaymentMethod",function(t){e.frames.modal.rpcClient.invoke("selectPaymentMethod",[t]),e._showModal()}),this.rpcServer.define("sendAddedPaymentMethod",function(t){e.merchantFormManager.setNoncePayload(t),e.frames.inline.rpcClient.invoke("receiveNewPaymentMethod",[t])}),this.rpcServer.define("sendUsedPaymentMethod",function(t){e.frames.inline.rpcClient.invoke("selectPaymentMethod",[t])}),this.rpcServer.define("sendUnlockedNonce",function(t){e.merchantFormManager.setNoncePayload(t)}),this.rpcServer.define("clearNonce",function(){e.merchantFormManager.clearNoncePayload()}),this.rpcServer.define("closeDropInModal",function(){e._hideModal()}),this.rpcServer.define("setInlineFrameHeight",function(t){e.frames.inline.element.style.height=t+"px"}),this.bus.register("ready",function(t){t.source===e.frames.inline.element.contentWindow?e.frames.inline.rpcClient=new c.RPCClient(e.bus,t.source):t.source===e.frames.modal.element.contentWindow&&(e.frames.modal.rpcClient=new c.RPCClient(e.bus,t.source))})},r.prototype._createFrame=function(t,e){return new f(t,e)},r.prototype._initializeModal=function(){this.frames.modal.element.style.display="none",this.frames.modal.element.style.position=o()?"absolute":"fixed",this.frames.modal.element.style.top="0",this.frames.modal.element.style.left="0",this.frames.modal.element.style.height="100%",this.frames.modal.element.style.width="100%"},r.prototype._lockMerchantWindowSize=function(){setTimeout(function(){s.style.overflow="hidden",a.style.overflow="hidden",a.style.height="100%",o()&&(s.style.position="relative",s.style.height=window.innerHeight+"px")},160)},r.prototype._unlockMerchantWindowSize=function(){var t=this.merchantPageDefaultStyles;a.style.height=t.body.height,a.style.overflow=t.body.overflow,s.style.overflow=t.html.overflow,o()&&(s.style.height=t.html.height,s.style.position=t.html.position)},r.prototype._showModal=function(){var t=this,e=this.frames.modal.element;this.merchantPageDefaultStyles=i(),e.style.display="block",this.frames.modal.rpcClient.invoke("open",[],function(){setTimeout(function(){t._lockMerchantWindowSize(),e.contentWindow.focus()},200)})},r.prototype._hideModal=function(){this._unlockMerchantWindowSize(),this.frames.modal.element.style.display="none"},r.prototype._configurePayPal=function(){b.isPopupSupported()||(this.ppClient=new m({clientToken:this.clientToken,paypal:this.paypalOptions}),this.rpcServer.define("openPayPalModal",d.bind(this.ppClient._openModal,this.ppClient))),l.on("receivePayPalData",d.bind(this._handleAltPayData,this))},r.prototype._handleAltPayData=function(t){this.merchantFormManager.setNoncePayload(t),this.frames.inline.rpcClient.invoke("receiveNewPaymentMethod",[t]),this.frames.modal.rpcClient.invoke("modalViewClose")},r.prototype._findClosest=function(t,e){e=e.toUpperCase();do if(t.nodeName===e)return t;while(t=t.parentNode);throw"Unable to find a valid "+e},e.exports=r},{"../shared/constants":249,"../shared/paypal-service":250,"./api-proxy-server":244,"./frame-container":247,"./merchant-form-manager":248,"braintree-api":107,"braintree-bus":136,"braintree-paypal/src/shared/util/browser":208,"braintree-rpc":216,"braintree-utilities":228}],246:[function(t,e){"use strict";function n(t){var e=new i(t);return e.initialize(),e}var i=t("./client"),o="1.8.3";e.exports={create:n,VERSION:o}},{"./client":245}],247:[function(t,e){"use strict";function n(){var t,e=document.createElement("fakeelement");for(t in u)if("undefined"!=typeof e.style[t])return u[t];return null}function i(t){function e(n){n.target===t&&"height"===n.propertyName&&(r.emit(r.events.ASYNC_DEPENDENCY_READY),t.removeEventListener(i,e))}var i=n();i?t.addEventListener(i,e):setTimeout(function(){r.emit(r.events.ASYNC_DEPENDENCY_READY)},500)}function o(t,e){var n="height 210ms cubic-bezier(0.390, 0.575, 0.565, 1.000)";this.element=a({name:e,width:"100%",height:"68",style:{transition:n,WebkitTransition:n,MozTransition:n,msTransition:n,OTransition:n,border:"0",zIndex:"9999"}}),this.element.src=t,e===s.INLINE_FRAME_NAME&&i(this.element)}var r=t("braintree-bus"),s=t("../shared/constants"),a=t("iframer"),u={transition:"transitionend","-o-transition":"otransitionEnd","-moz-transition":"transitionend","-webkit-transition":"webkitTransitionEnd"};e.exports=o},{"../shared/constants":249,"braintree-bus":136,iframer:230}],248:[function(t,e){"use strict";function n(t){this.formNapper=new o(t.form),this.frames=t.frames,this.onSubmit=t.onSubmit,this.apiClient=t.apiClient}var i=t("braintree-utilities"),o=t("form-napper");n.prototype.initialize=function(){return this._isSubmitBased()&&this._setElements(),this._setEvents(),this},n.prototype.setNoncePayload=function(t){this.noncePayload=t},n.prototype.clearNoncePayload=function(){this.noncePayload=null},n.prototype._isSubmitBased=function(){return!this.onSubmit},n.prototype._isCallbackBased=function(){return!!this.onSubmit},n.prototype._setElements=function(){this.formNapper.inject("payment_method_nonce","")},n.prototype._setEvents=function(){this.formNapper.hijack(i.bind(this._handleFormSubmit,this))},n.prototype._handleFormSubmit=function(t){this.noncePayload&&this.noncePayload.nonce?this._handleNonceReply(t):this.frames.inline.rpcClient.invoke("requestNonce",[],i.bind(function(e){this.setNoncePayload(e),this._handleNonceReply(t)},this))},n.prototype._handleNonceReply=function(t){this._isCallbackBased()?this.apiClient.sendAnalyticsEvents("dropin.web.end.callback",i.bind(function(){var e=this.noncePayload;e.originalEvent=t,this.onSubmit(e),setTimeout(i.bind(function(){this.frames.inline.rpcClient.invoke("clearLoadingState"),this.frames.inline.rpcClient.invoke("receiveNewPaymentMethod",[e])},this),200)},this)):this._triggerFormSubmission()},n.prototype._triggerFormSubmission=function(){this.formNapper.inject("payment_method_nonce",this.noncePayload.nonce),this.apiClient.sendAnalyticsEvents("dropin.web.end.auto-submit",i.bind(function(){this.formNapper.submit()},this))},e.exports=n},{"braintree-utilities":228,"form-napper":229}],249:[function(t,e){e.exports={PAYPAL_INTEGRATION_NAME:"PayPal",INLINE_FRAME_NAME:"braintree-dropin-frame",MODAL_FRAME_NAME:"braintree-dropin-modal-frame",PAYMENT_METHOD_TYPES:["CoinbaseAccount","PayPalAccount","CreditCard"],cssClassMap:{"American Express":"american-express","Diners Club":"diners-club",DinersClub:"diners-club",Discover:"discover",JCB:"jcb",Maestro:"maestro",MasterCard:"master-card",Solo:"solo",Switch:"switch",UKMaestro:"maestro",UnionPay:"unionpay",Visa:"visa"}}},{}],250:[function(t,e){"use strict";function n(t){var e=t.clientToken,n=t.paypal||{},o=new i(e,{container:document.createElement("div"),displayName:n.displayName,locale:n.locale,singleUse:n.singleUse,amount:n.amount,currency:n.currency,onSuccess:n.onSuccess,enableShippingAddress:n.enableShippingAddress,shippingAddressOverride:n.shippingAddressOverride,enableBillingAddress:n.enableBillingAddress});return o.initialize(),o}var i=t("braintree-paypal/src/external/client");e.exports=n},{"braintree-paypal/src/external/client":197}],251:[function(t,e){(function(t){"use strict";function n(t,e){e=e||{};var o,s,a=t.children;for(s=0;s<a.length;s++)if(o=a[s],r(o)){var u=o.getAttribute("data-braintree-name");"postal_code"===u?e.billingAddress={postalCode:o.value}:e[u]=o.value,i(o)}else o.children&&o.children.length>0&&n(o,e);return e}function i(t){try{t.attributes.removeNamedItem("name")}catch(e){}}function o(t){n(t)}function r(t){return t.nodeType===s&&t.attributes["data-braintree-name"]}var s=t.Node?t.Node.ELEMENT_NODE:1;e.exports={extractValues:n,scrubAllAttributes:o,scrubAttributes:i,isBraintreeNode:r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],252:[function(t,e){"use strict";function n(t,e,n,i){this.client=t,this.htmlForm=e,this.isCreditCardForm=i!==!1,this.paymentMethodNonceInput=n,this.model=new s,this.setEvents()}var i=t("braintree-utilities"),o=t("./fields"),r=t("braintree-bus"),s=t("./models/payment-method-model"),a={message:"Unable to process payments at this time",type:"IMMEDIATE"};n.prototype.setEvents=function(){this.onSubmitHandler=i.bind(this.handleSubmit,this),this.onExternalNonceReceived=i.bind(this.onExternalNonceReceived,this),this.clearExternalNonce=i.bind(this.clearExternalNonce,this),i.addEventListener(this.htmlForm,"submit",this.onSubmitHandler),r.on(r.events.PAYMENT_METHOD_GENERATED,this.onExternalNonceReceived),r.on(r.events.PAYMENT_METHOD_CANCELLED,this.clearExternalNonce)},n.prototype.handleSubmit=function(t){var e;return t.preventDefault?t.preventDefault():t.returnValue=!1,this.isCreditCardForm?(e=this.model.get("type"),e&&"CreditCard"!==e?(o.scrubAllAttributes(this.htmlForm),void this.onNonceReceived(null,this.model.attributes)):void this.client.tokenizeCard(o.extractValues(this.htmlForm),i.bind(function(t,e,n){t?this.onNonceReceived(a,null):(this.model.set({nonce:e,type:n.type,details:n.details}),this.onNonceReceived(null,this.model.attributes))},this))):void this.onNonceReceived(null,this.model.attributes)},n.prototype.writeNonceToDOM=function(){this.paymentMethodNonceInput.value=this.model.get("nonce")},n.prototype.onExternalNonceReceived=function(t){this.model.set(t),this.writeNonceToDOM()},n.prototype.clearExternalNonce=function(){this.model.reset()},n.prototype.onNonceReceived=function(t){var e=this.htmlForm;return t?void r.emit(r.events.ERROR,a):(i.removeEventListener(e,"submit",this.onSubmitHandler),this.writeNonceToDOM(),void(e.submit&&("function"==typeof e.submit||e.submit.call)?e.submit():setTimeout(function(){e.querySelector('[type="submit"]').click()},1)))},e.exports=n},{"./fields":251,"./models/payment-method-model":254,"braintree-bus":257,"braintree-utilities":264}],253:[function(t,e){"use strict";e.exports=function(t){var e;if("object"==typeof t)return t;e="payment_method_nonce","string"==typeof t&&(e=t);var n=document.createElement("input");return n.name=e,n.type="hidden",n}},{}],254:[function(t,e){"use strict";function n(){this.reset()}n.prototype.get=function(t){return this.attributes[t]},n.prototype.set=function(t){this.attributes=t||{}},n.prototype.reset=function(){this.attributes={}},e.exports=n},{}],255:[function(t,e){"use strict";e.exports=function(t){for(var e=t.getElementsByTagName("*"),n={},i=0;i<e.length;i++){var o=e[i].getAttribute("data-braintree-name");n[o]=!0}if(!n.number)throw new Error('Unable to find an input with data-braintree-name="number" in your form. Please add one.');if(n.expiration_date){if(n.expiration_month||n.expiration_year)throw new Error('You have inputs with data-braintree-name="expiration_date" AND data-braintree-name="expiration_(year|month)". Please use either "expiration_date" or "expiration_year" and "expiration_month".')}else{if(!n.expiration_month&&!n.expiration_year)throw new Error('Unable to find an input with data-braintree-name="expiration_date" in your form. Please add one.');if(!n.expiration_month)throw new Error('Unable to find an input with data-braintree-name="expiration_month" in your form. Please add one.');if(!n.expiration_year)throw new Error('Unable to find an input with data-braintree-name="expiration_year" in your form. Please add one.')}}},{}],256:[function(t,e){"use strict";function n(t,e){var n,s,a=document.getElementById(e.id),u=e&&e.hasOwnProperty("useCreditCard")?e.useCreditCard:!0;if(!a)throw new Error('Unable to find form with id: "'+e.id+'"');return u&&o(a),n=r(e.paymentMethodNonceInputField),a.appendChild(n),s=new i(t,a,n,u)}var i=t("./lib/form"),o=t("./lib/validate-annotations"),r=t("./lib/get-nonce-input");e.exports={setup:n}},{"./lib/form":252,"./lib/get-nonce-input":253,"./lib/validate-annotations":255}],257:[function(t,e,n){arguments[4][50][0].apply(n,arguments)},{"./lib/events":258,dup:50,framebus:259}],258:[function(t,e,n){arguments[4][51][0].apply(n,arguments)},{dup:51}],259:[function(t,e,n){arguments[4][52][0].apply(n,arguments)},{dup:52}],260:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],261:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],262:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],263:[function(t,e,n){arguments[4][25][0].apply(n,arguments)},{dup:25}],264:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{"./lib/dom":260,"./lib/events":261,"./lib/fn":262,"./lib/url":263,dup:26}],265:[function(t,e,n){arguments[4][2][0].apply(n,arguments)},{"./coinbase-account":266,"./credit-card":268,"./europe-bank-account":269,"./normalize-api-fields":271,"./parse-client-token":272,"./paypal-account":273,"./request/choose-driver":276,"./sepa-mandate":281,"./should-enable-cors":282,"./util":283,"braintree-3ds":292,"braintree-utilities":304,dup:2}],266:[function(t,e,n){arguments[4][3][0].apply(n,arguments)},{dup:3}],267:[function(t,e,n){arguments[4][4][0].apply(n,arguments)},{dup:4}],268:[function(t,e,n){arguments[4][5][0].apply(n,arguments)},{dup:5}],269:[function(t,e,n){arguments[4][6][0].apply(n,arguments)},{dup:6}],270:[function(t,e,n){arguments[4][7][0].apply(n,arguments)},{"./parse-client-token":272,"./request/choose-driver":276,"./should-enable-cors":282,"./util":283,dup:7}],271:[function(t,e,n){arguments[4][8][0].apply(n,arguments)},{dup:8}],272:[function(t,e,n){arguments[4][9][0].apply(n,arguments)},{"./polyfill":274,"braintree-utilities":304,dup:9}],273:[function(t,e,n){arguments[4][10][0].apply(n,arguments)},{dup:10}],274:[function(t,e,n){arguments[4][11][0].apply(n,arguments)},{dup:11}],275:[function(t,e,n){arguments[4][12][0].apply(n,arguments)},{"../constants":267,"../util":283,"./parse-body":279,"./prep-body":280,dup:12}],276:[function(t,e,n){arguments[4][13][0].apply(n,arguments)},{"../util":283,"./ajax-driver":275,"./jsonp-driver":277,dup:13}],277:[function(t,e,n){arguments[4][14][0].apply(n,arguments)},{"../constants":267,"./jsonp":278,dup:14}],278:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{"../util":283,dup:15}],279:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{dup:16}],280:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{dup:17,"lodash.isstring":312}],281:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],282:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],283:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20,"lodash.isempty":305,"lodash.isobject":311}],284:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{"./lib/client":265,"./lib/get-configuration":270,"./lib/parse-client-token":272,"./lib/util":283,dup:21}],285:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],286:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],287:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],288:[function(t,e,n){arguments[4][25][0].apply(n,arguments)},{dup:25}],289:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{"./lib/dom":285,"./lib/events":286,"./lib/fn":287,"./lib/url":288,dup:26}],290:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{"../shared/receiver":297,"braintree-utilities":289,dup:27}],291:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./authorization_service":290,"./loader":293,"braintree-utilities":289,dup:28}],292:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{"./client":291,dup:29}],293:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{"./loader_display":294,"./loader_message":295,"./loader_spinner":296,dup:30}],294:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],295:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],296:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{dup:33}],297:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{"braintree-utilities":289,dup:34}],298:[function(t,e,n){arguments[4][35][0].apply(n,arguments)},{dup:35}],299:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],300:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],301:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],302:[function(t,e,n){arguments[4][39][0].apply(n,arguments)},{dup:39}],303:[function(t,e,n){arguments[4][40][0].apply(n,arguments)},{"./array":298,dup:40}],304:[function(t,e,n){arguments[4][41][0].apply(n,arguments)},{"./lib/array":298,"./lib/dom":299,"./lib/events":300,"./lib/fn":301,"./lib/string":302,"./lib/url":303,dup:41}],305:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{dup:42,"lodash.isarguments":306,"lodash.isarray":307,"lodash.isfunction":308,"lodash.isstring":312,"lodash.keys":309}],306:[function(t,e,n){arguments[4][43][0].apply(n,arguments)},{dup:43}],307:[function(t,e,n){arguments[4][44][0].apply(n,arguments)},{dup:44}],308:[function(t,e,n){arguments[4][45][0].apply(n,arguments)},{dup:45}],309:[function(t,e,n){arguments[4][46][0].apply(n,arguments)},{dup:46,"lodash._getnative":310,"lodash.isarguments":306,"lodash.isarray":307}],310:[function(t,e,n){arguments[4][47][0].apply(n,arguments)},{dup:47}],311:[function(t,e,n){arguments[4][48][0].apply(n,arguments)},{dup:48}],312:[function(t,e,n){arguments[4][49][0].apply(n,arguments)},{dup:49}],313:[function(t,e,n){arguments[4][50][0].apply(n,arguments)},{"./lib/events":314,dup:50,framebus:315}],314:[function(t,e,n){arguments[4][51][0].apply(n,arguments)},{dup:51}],315:[function(t,e,n){arguments[4][52][0].apply(n,arguments)},{dup:52}],316:[function(t,e,n){arguments[4][35][0].apply(n,arguments)},{dup:35}],317:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],318:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],319:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],320:[function(t,e,n){arguments[4][39][0].apply(n,arguments)},{dup:39}],321:[function(t,e,n){arguments[4][40][0].apply(n,arguments)},{"./array":316,dup:40}],322:[function(t,e,n){arguments[4][41][0].apply(n,arguments)},{"./lib/array":316,"./lib/dom":317,"./lib/events":318,"./lib/fn":319,"./lib/string":320,"./lib/url":321,dup:41}],323:[function(t,e,n){arguments[4][197][0].apply(n,arguments)},{"../shared/constants":328,"../shared/get-locale":330,"../shared/util/browser":335,"../shared/util/dom":336,"../shared/util/util":337,"./logged-in-view":325,"./logged-out-view":326,"./overlay-view":327,"braintree-api":284,"braintree-bus":313,"braintree-utilities":322,dup:197}],324:[function(t,e){function n(t,e){if(!o.detectedPostMessage())return void("function"==typeof e.onUnsupported&&e.onUnsupported(new Error("unsupported browser detected")));var n=new i(t,e);return n.initialize(),n}var i=t("./client"),o=t("../shared/util/browser"),r="1.5.3";e.exports={create:n,_browser:o,VERSION:r}},{"../shared/util/browser":335,"./client":323}],325:[function(t,e,n){arguments[4][198][0].apply(n,arguments)},{"../shared/constants":328,dup:198}],326:[function(t,e,n){arguments[4][199][0].apply(n,arguments)},{"../shared/constants":328,"../shared/get-locale":330,"braintree-utilities":322,dup:199}],327:[function(t,e,n){arguments[4][200][0].apply(n,arguments)},{"../shared/constants":328,"braintree-utilities":322,dup:200}],328:[function(t,e,n){arguments[4][201][0].apply(n,arguments)},{dup:201}],329:[function(t,e,n){arguments[4][202][0].apply(n,arguments)},{dup:202}],330:[function(t,e,n){arguments[4][203][0].apply(n,arguments)},{"../shared/data/country-code-lookup":329,dup:203}],331:[function(t,e,n){arguments[4][204][0].apply(n,arguments)},{"./platform":333,"./useragent":334,dup:204}],332:[function(t,e,n){arguments[4][205][0].apply(n,arguments)},{"./platform":333,"./useragent":334,dup:205}],333:[function(t,e,n){arguments[4][206][0].apply(n,arguments)},{"./useragent":334,dup:206}],334:[function(t,e,n){arguments[4][207][0].apply(n,arguments)},{dup:207}],335:[function(t,e,n){arguments[4][208][0].apply(n,arguments)},{"../useragent/browser":331,"../useragent/device":332,"../useragent/platform":333,"../useragent/useragent":334,dup:208}],336:[function(t,e,n){arguments[4][209][0].apply(n,arguments)},{dup:209}],337:[function(t,e,n){arguments[4][210][0].apply(n,arguments)},{dup:210}],338:[function(t,e,n){arguments[4][35][0].apply(n,arguments)},{dup:35}],339:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],340:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],341:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],342:[function(t,e,n){arguments[4][39][0].apply(n,arguments)},{dup:39}],343:[function(t,e,n){arguments[4][40][0].apply(n,arguments)},{"./array":338,dup:40}],344:[function(t,e,n){arguments[4][41][0].apply(n,arguments)},{"./lib/array":338,"./lib/dom":339,"./lib/events":340,"./lib/fn":341,"./lib/string":342,"./lib/url":343,dup:41}],345:[function(t,e){function n(t,e,n){return"function"==typeof e?i(t,!0,o(e,n,1)):i(t,!0)}var i=t("lodash._baseclone"),o=t("lodash._bindcallback");e.exports=n},{"lodash._baseclone":346,"lodash._bindcallback":356}],346:[function(t,e){(function(n){function i(t,e,n,r,p,m,b){var _;if(n&&(_=p?n(t,r,p):n(t)),void 0!==_)return _;if(!l(t))return t;var y=f(t);if(y){if(_=s(t),!e)return c(t,_)}else{var v=H.call(t),k=v==w;if(v!=S&&v!=g&&(!k||p))return j[v]?u(t,v,e):p?t:{};if(_=a(k?{}:t),!e)return h(_,t)}m||(m=[]),b||(b=[]);for(var C=m.length;C--;)if(m[C]==t)return b[C];return m.push(t),b.push(_),(y?d:o)(t,function(o,r){_[r]=i(o,e,n,r,t,m,b)}),_}function o(t,e){return p(t,e,m)}function r(t){var e=new z(t.byteLength),n=new q(e);return n.set(new q(t)),e}function s(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&V.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function a(t){var e=t.constructor;return"function"==typeof e&&e instanceof e||(e=Object),new e}function u(t,e,n){var i=t.constructor;switch(e){case I:return r(t);case _:case y:return new i(+t);case A:case B:case O:case M:case $:case D:case R:case L:case F:var o=t.buffer;return new i(n?r(o):o,t.byteOffset,t.length);case C:case P:return new i(t);case x:var s=new i(t.source,N.exec(t));s.lastIndex=t.lastIndex}return s}function l(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var c=t("lodash._arraycopy"),d=t("lodash._arrayeach"),h=t("lodash._baseassign"),p=t("lodash._basefor"),f=t("lodash.isarray"),m=t("lodash.keys"),g="[object Arguments]",b="[object Array]",_="[object Boolean]",y="[object Date]",v="[object Error]",w="[object Function]",k="[object Map]",C="[object Number]",S="[object Object]",x="[object RegExp]",E="[object Set]",P="[object String]",T="[object WeakMap]",I="[object ArrayBuffer]",A="[object Float32Array]",B="[object Float64Array]",O="[object Int8Array]",M="[object Int16Array]",$="[object Int32Array]",D="[object Uint8Array]",R="[object Uint8ClampedArray]",L="[object Uint16Array]",F="[object Uint32Array]",N=/\w*$/,j={};j[g]=j[b]=j[I]=j[_]=j[y]=j[A]=j[B]=j[O]=j[M]=j[$]=j[C]=j[S]=j[x]=j[P]=j[D]=j[R]=j[L]=j[F]=!0,j[v]=j[w]=j[k]=j[E]=j[T]=!1;var U=Object.prototype,V=U.hasOwnProperty,H=U.toString,z=n.ArrayBuffer,q=n.Uint8Array;e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._arraycopy":347,"lodash._arrayeach":348,"lodash._baseassign":349,"lodash._basefor":351,"lodash.isarray":352,"lodash.keys":353}],347:[function(t,e){function n(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e}e.exports=n},{}],348:[function(t,e){function n(t,e){for(var n=-1,i=t.length;++n<i&&e(t[n],n,t)!==!1;);return t}e.exports=n},{}],349:[function(t,e,n){arguments[4][77][0].apply(n,arguments)},{dup:77,"lodash._basecopy":350,"lodash.keys":353}],350:[function(t,e,n){arguments[4][78][0].apply(n,arguments)},{dup:78}],351:[function(t,e){function n(t){return function(e,n,o){for(var r=i(e),s=o(e),a=s.length,u=t?a:-1;t?u--:++u<a;){var l=s[u];if(n(r[l],l,r)===!1)break}return e}}function i(t){return o(t)?t:Object(t)}function o(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var r=n();e.exports=r},{}],352:[function(t,e,n){arguments[4][44][0].apply(n,arguments)},{dup:44}],353:[function(t,e,n){arguments[4][46][0].apply(n,arguments)},{dup:46,"lodash._getnative":354,"lodash.isarguments":355,"lodash.isarray":352}],354:[function(t,e,n){arguments[4][47][0].apply(n,arguments)},{dup:47}],355:[function(t,e,n){arguments[4][43][0].apply(n,arguments)},{dup:43}],356:[function(t,e,n){arguments[4][80][0].apply(n,arguments)},{dup:80}],357:[function(t,e){"use strict";function n(t){var e,n={};if(t){for(e in t)t.hasOwnProperty(e)&&(n[i(e)]=t[e]);return n}}function i(t){return t.replace(/([A-Z])/g,function(t){return"_"+t.toLowerCase()})}e.exports={convertToLegacyShippingAddress:n}},{}],358:[function(t,e){"use strict";e.exports={ROOT_SUCCESS_CALLBACK:"onPaymentMethodReceived",ROOT_ERROR_CALLBACK:"onError",
ROOT_READY_CALLBACK:"onReady"}},{}],359:[function(t,e){"use strict";function n(t){var e=s(t.merchantConfiguration);return r.on(r.events.PAYMENT_METHOD_GENERATED,function(t){r.emit(r.events.PAYMENT_METHOD_RECEIVED,t)}),e.configuration=s(t.gatewayConfiguration),e.coinbase=s(e.coinbase||{}),e.apiClient=new i.Client({enableCORS:t.merchantConfiguration.enableCORS,clientToken:t.gatewayConfiguration,integration:"coinbase"}),o.create(e)}var i=t("braintree-api"),o=t("braintree-coinbase"),r=t("braintree-bus"),s=t("lodash.clonedeep");e.exports={initialize:n}},{"braintree-api":21,"braintree-bus":50,"braintree-coinbase":53,"lodash.clonedeep":345}],360:[function(t,e){"use strict";function n(t){var e,n={clientToken:t.gatewayConfiguration,integration:t.integrationType};t.merchantConfiguration.enableCORS&&(n.enableCORS=!0),e=new a.Client(n),i(t,e),o(t),r(t,e)}function i(t,e){var n,i=t.merchantConfiguration,o=i[h.ROOT_SUCCESS_CALLBACK];i.id?(n=u.setup(e,i),d.isFunction(o)&&(n.onNonceReceived=function(t,e){t?p.emit(p.events.ERROR,t):o(e)})):p.on(p.events.PAYMENT_METHOD_GENERATED,function(t){p.emit(p.events.PAYMENT_METHOD_RECEIVED,t)})}function o(t){var e,n,i,o,r=t.merchantConfiguration,a=r.paypal;a&&(e=s(r,"paypal"),n=e("onSuccess"),i=e("onCancelled"),a.paymentMethodNonceInputField||(o=document.createElement("input"),o.id="braintree-custom-integration-dummy-input",a.paymentMethodNonceInputField=o),a.onSuccess=function(t){p.emit(p.events.PAYMENT_METHOD_GENERATED,t),n.apply(null,[t.nonce,t.details.email,f(t.details.shippingAddress)])},a.onCancelled=function(){p.emit(p.events.PAYMENT_METHOD_CANCELLED),i()},r.enableCORS&&(a.enableCORS=!0),l.create(t.gatewayConfiguration,a))}function r(t,e){var n=t.merchantConfiguration;n.coinbase&&(n.configuration=t.gatewayConfiguration,n.apiClient=e,delete n.paypal,c.create(n))}function s(t,e){return function(n){return e in t&&d.isFunction(t[e][n])?t[e][n]:function(){}}}var a=t("braintree-api"),u=t("braintree-form"),l=t("braintree-paypal"),c=t("braintree-coinbase"),d=t("braintree-utilities"),h=t("../constants"),p=t("braintree-bus"),f=t("../compatibility").convertToLegacyShippingAddress;e.exports={initialize:n}},{"../compatibility":357,"../constants":358,"braintree-api":21,"braintree-bus":50,"braintree-coinbase":53,"braintree-form":256,"braintree-paypal":324,"braintree-utilities":344}],361:[function(t,e){"use strict";function n(t){return s.isFunction(t.paymentMethodNonceReceived)?t.paymentMethodNonceReceived:null}function i(t){return s.isFunction(t[u.ROOT_SUCCESS_CALLBACK])}function o(t){var e=t.merchantConfiguration,o=n(e),s=i(e);return(o||s)&&(e.paymentMethodNonceReceived=function(t){o&&o.apply(null,[t.originalEvent,t.nonce]),delete t.originalEvent,a.emit(a.events.PAYMENT_METHOD_RECEIVED,l(t))}),r.create(t)}var r=t("braintree-dropin"),s=t("braintree-utilities"),a=t("braintree-bus"),u=t("../constants"),l=t("../lib/sanitize-payload");e.exports={initialize:o}},{"../constants":358,"../lib/sanitize-payload":366,"braintree-bus":50,"braintree-dropin":246,"braintree-utilities":344}],362:[function(t,e){"use strict";e.exports={custom:t("./custom"),dropin:t("./dropin"),paypal:t("./paypal"),coinbase:t("./coinbase")}},{"./coinbase":359,"./custom":360,"./dropin":361,"./paypal":363}],363:[function(t,e){"use strict";function n(t){return"onSuccess"in t&&s.isFunction(t.onSuccess)?t.onSuccess:"paypal"in t&&s.isFunction(t.paypal.onSuccess)?t.paypal.onSuccess:null}function i(t){return s.isFunction(t[a.ROOT_SUCCESS_CALLBACK])}function o(t){var e=t.merchantConfiguration,o=n(e),s=i(e);return(o||s)&&(e.onSuccess=function(t){o&&o.apply(null,[t.nonce,t.details.email,l(t.details.shippingAddress)]),u.emit(u.events.PAYMENT_METHOD_RECEIVED,t)}),r.create(t.gatewayConfiguration,e)}var r=t("braintree-paypal"),s=t("braintree-utilities"),a=t("../constants"),u=t("braintree-bus"),l=t("../compatibility").convertToLegacyShippingAddress;e.exports={initialize:o}},{"../compatibility":357,"../constants":358,"braintree-bus":50,"braintree-paypal":324,"braintree-utilities":344}],364:[function(t,e){"use strict";function n(t){var e="web."+t.integrationType+".",n=o.configure({enableCORS:t.merchantConfiguration.enableCORS,clientToken:t.gatewayConfiguration,analyticsConfiguration:t.analyticsConfiguration,integration:t.integrationType}),s=i(e,n);r.on(r.events.SEND_ANALYTICS_EVENTS,s)}function i(t,e){return function(n,i){var o;for(n instanceof Array||(n=[n]),o=0;o<n.length;o++)n[o]=t+n[o];e.sendAnalyticsEvents(n,i)}}var o=t("braintree-api"),r=t("braintree-bus");e.exports={listenForAnalytics:n,_createSender:i}},{"braintree-api":21,"braintree-bus":50}],365:[function(t,e){"use strict";function n(t){this.callback=t,this.counter=0,this.attachEvents()}var i=t("braintree-bus"),o=t("braintree-utilities");n.prototype.attachEvents=function(){this.initHandler=o.bind(this.handleDependencyInitializing,this),this.readyHandler=o.bind(this.handleDependencyReady,this),i.on(i.events.ASYNC_DEPENDENCY_INITIALIZING,this.initHandler),i.on(i.events.ASYNC_DEPENDENCY_READY,this.readyHandler)},n.prototype.handleDependencyInitializing=function(){this.counter++},n.prototype.handleDependencyReady=function(){this.counter--,0===this.counter&&(this.detachEvents(),this.callback())},n.prototype.detachEvents=function(){i.off(i.events.ASYNC_DEPENDENCY_INITIALIZING,this.initHandler),i.off(i.events.ASYNC_DEPENDENCY_READY,this.readyHandler)},e.exports=function(t){return new n(t)}},{"braintree-bus":50,"braintree-utilities":344}],366:[function(t,e){"use strict";e.exports=function(t){return{nonce:t.nonce,details:t.details,type:t.type}}},{}]},{},[1])(1)}),function(){"use strict";var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};"undefined"!=typeof module&&module.exports&&(module.exports=sjcl),sjcl.bitArray={bitSlice:function(t,e,n){return t=sjcl.bitArray._shiftRight(t.slice(e/32),32-(31&e)).slice(1),void 0===n?t:sjcl.bitArray.clamp(t,n-e)},extract:function(t,e,n){var i,o=Math.floor(-e-n&31);return i=-32&(e+n-1^e)?t[e/32|0]<<32-o^t[e/32+1|0]>>>o:t[e/32|0]>>>o,i&(1<<n)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var n=t[t.length-1],i=sjcl.bitArray.getPartial(n);return 32===i?t.concat(e):sjcl.bitArray._shiftRight(e,i,0|n,t.slice(0,t.length-1))},bitLength:function(t){var e,n=t.length;return 0===n?0:(e=t[n-1],32*(n-1)+sjcl.bitArray.getPartial(e))},clamp:function(t,e){if(32*t.length<e)return t;t=t.slice(0,Math.ceil(e/32));var n=t.length;return e=31&e,n>0&&e&&(t[n-1]=sjcl.bitArray.partial(e,t[n-1]&2147483648>>e-1,1)),t},partial:function(t,e,n){return 32===t?e:(n?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(sjcl.bitArray.bitLength(t)!==sjcl.bitArray.bitLength(e))return!1;var n,i=0;for(n=0;n<t.length;n++)i|=t[n]^e[n];return 0===i},_shiftRight:function(t,e,n,i){var o,r,s=0;for(void 0===i&&(i=[]);e>=32;e-=32)i.push(n),n=0;if(0===e)return i.concat(t);for(o=0;o<t.length;o++)i.push(n|t[o]>>>e),n=t[o]<<32-e;return s=t.length?t[t.length-1]:0,r=sjcl.bitArray.getPartial(s),i.push(sjcl.bitArray.partial(e+r&31,e+r>32?n:i.pop(),1)),i},_xor4:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}},sjcl.codec.hex={fromBits:function(t){var e,n="";for(e=0;e<t.length;e++)n+=((0|t[e])+0xf00000000000).toString(16).substr(4);return n.substr(0,sjcl.bitArray.bitLength(t)/4)},toBits:function(t){var e,n,i=[];for(t=t.replace(/\s|0x/g,""),n=t.length,t+="00000000",e=0;e<t.length;e+=8)i.push(0^parseInt(t.substr(e,8),16));return sjcl.bitArray.clamp(i,4*n)}},sjcl.hash.sha256=function(t){this._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},sjcl.hash.sha256.hash=function(t){return(new sjcl.hash.sha256).update(t).finalize()},sjcl.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(t){"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t));var e,n=this._buffer=sjcl.bitArray.concat(this._buffer,t),i=this._length,o=this._length=i+sjcl.bitArray.bitLength(t);for(e=512+i&-512;o>=e;e+=512)this._block(n.splice(0,16));return this},finalize:function(){var t,e=this._buffer,n=this._h;for(e=sjcl.bitArray.concat(e,[sjcl.bitArray.partial(1,1)]),t=e.length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(0|this._length);e.length;)this._block(e.splice(0,16));return this.reset(),n},_init:[],_key:[],_precompute:function(){function t(t){return 4294967296*(t-Math.floor(t))|0}var e,n=0,i=2;t:for(;64>n;i++){for(e=2;i>=e*e;e++)if(i%e===0)continue t;8>n&&(this._init[n]=t(Math.pow(i,.5))),this._key[n]=t(Math.pow(i,1/3)),n++}},_block:function(t){var e,n,i,o,r=t.slice(0),s=this._h,a=this._key,u=s[0],l=s[1],c=s[2],d=s[3],h=s[4],p=s[5],f=s[6],m=s[7];for(e=0;64>e;e++)16>e?n=r[e]:(i=r[e+1&15],o=r[e+14&15],n=r[15&e]=(i>>>7^i>>>18^i>>>3^i<<25^i<<14)+(o>>>17^o>>>19^o>>>10^o<<15^o<<13)+r[15&e]+r[e+9&15]|0),n=n+m+(h>>>6^h>>>11^h>>>25^h<<26^h<<21^h<<7)+(f^h&(p^f))+a[e],m=f,f=p,p=h,h=d+n|0,d=c,c=l,l=u,u=n+(l&c^d&(l^c))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;s[0]=s[0]+u|0,s[1]=s[1]+l|0,s[2]=s[2]+c|0,s[3]=s[3]+d|0,s[4]=s[4]+h|0,s[5]=s[5]+p|0,s[6]=s[6]+f|0,s[7]=s[7]+m|0}},sjcl.cipher.aes=function(t){this._tables[0][0][0]||this._precompute();var e,n,i,o,r,s=this._tables[0][4],a=this._tables[1],u=t.length,l=1;if(4!==u&&6!==u&&8!==u)throw new sjcl.exception.invalid("invalid aes key size");for(this._key=[o=t.slice(0),r=[]],e=u;4*u+28>e;e++)i=o[e-1],(e%u===0||8===u&&e%u===4)&&(i=s[i>>>24]<<24^s[i>>16&255]<<16^s[i>>8&255]<<8^s[255&i],e%u===0&&(i=i<<8^i>>>24^l<<24,l=l<<1^283*(l>>7))),o[e]=o[e-u]^i;for(n=0;e;n++,e--)i=o[3&n?e:e-4],4>=e||4>n?r[n]=i:r[n]=a[0][s[i>>>24]]^a[1][s[i>>16&255]]^a[2][s[i>>8&255]]^a[3][s[255&i]]},sjcl.cipher.aes.prototype={encrypt:function(t){return this._crypt(t,0)},decrypt:function(t){return this._crypt(t,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var t,e,n,i,o,r,s,a,u,l=this._tables[0],c=this._tables[1],d=l[4],h=c[4],p=[],f=[];for(t=0;256>t;t++)f[(p[t]=t<<1^283*(t>>7))^t]=t;for(e=n=0;!d[e];e^=i||1,n=f[n]||1)for(s=n^n<<1^n<<2^n<<3^n<<4,s=s>>8^255&s^99,d[e]=s,h[s]=e,r=p[o=p[i=p[e]]],u=16843009*r^65537*o^257*i^16843008*e,a=257*p[s]^16843008*s,t=0;4>t;t++)l[t][e]=a=a<<24^a>>>8,c[t][s]=u=u<<24^u>>>8;for(t=0;5>t;t++)l[t]=l[t].slice(0),c[t]=c[t].slice(0)},_crypt:function(t,e){if(4!==t.length)throw new sjcl.exception.invalid("invalid aes block size");var n,i,o,r,s=this._key[e],a=t[0]^s[0],u=t[e?3:1]^s[1],l=t[2]^s[2],c=t[e?1:3]^s[3],d=s.length/4-2,h=4,p=[0,0,0,0],f=this._tables[e],m=f[0],g=f[1],b=f[2],_=f[3],y=f[4];for(r=0;d>r;r++)n=m[a>>>24]^g[u>>16&255]^b[l>>8&255]^_[255&c]^s[h],i=m[u>>>24]^g[l>>16&255]^b[c>>8&255]^_[255&a]^s[h+1],o=m[l>>>24]^g[c>>16&255]^b[a>>8&255]^_[255&u]^s[h+2],c=m[c>>>24]^g[a>>16&255]^b[u>>8&255]^_[255&l]^s[h+3],h+=4,a=n,u=i,l=o;for(r=0;4>r;r++)p[e?3&-r:r]=y[a>>>24]<<24^y[u>>16&255]<<16^y[l>>8&255]<<8^y[255&c]^s[h++],n=a,a=u,u=l,l=c,c=n;return p}},sjcl.random={randomWords:function(t,e){var n,i,o=[],r=this.isReady(e);if(r===this._NOT_READY)throw new sjcl.exception.notReady("generator isn't seeded");for(r&this._REQUIRES_RESEED&&this._reseedFromPools(!(r&this._READY)),n=0;t>n;n+=4)(n+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),i=this._gen4words(),o.push(i[0],i[1],i[2],i[3]);return this._gate(),o.slice(0,t)},setDefaultParanoia:function(t){this._defaultParanoia=t},addEntropy:function(t,e,n){n=n||"user";var i,o,r,s=(new Date).valueOf(),a=this._robins[n],u=this.isReady(),l=0;switch(i=this._collectorIds[n],void 0===i&&(i=this._collectorIds[n]=this._collectorIdNext++),void 0===a&&(a=this._robins[n]=0),this._robins[n]=(this._robins[n]+1)%this._pools.length,typeof t){case"number":void 0===e&&(e=1),this._pools[a].update([i,this._eventId++,1,e,s,1,0|t]);break;case"object":var c=Object.prototype.toString.call(t);if("[object Uint32Array]"===c){for(r=[],o=0;o<t.length;o++)r.push(t[o]);t=r}else for("[object Array]"!==c&&(l=1),o=0;o<t.length&&!l;o++)"number"!=typeof t[o]&&(l=1);if(!l){if(void 0===e)for(e=0,o=0;o<t.length;o++)for(r=t[o];r>0;)e++,r>>>=1;this._pools[a].update([i,this._eventId++,2,e,s,t.length].concat(t))}break;case"string":void 0===e&&(e=t.length),this._pools[a].update([i,this._eventId++,3,e,s,t.length]),this._pools[a].update(t);break;default:l=1}if(l)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[a]+=e,this._poolStrength+=e,u===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(t){var e=this._PARANOIA_LEVELS[void 0!==t?t:this._defaultParanoia];return this._strength&&this._strength>=e?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=e?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(t){var e=this._PARANOIA_LEVELS[t?t:this._defaultParanoia];return this._strength>=e?1:this._poolStrength>e?1:this._poolStrength/e},startCollectors:function(){if(!this._collectorsStarted){if(window.addEventListener)window.addEventListener("load",this._loadTimeCollector,!1),window.addEventListener("mousemove",this._mouseCollector,!1);else{if(!document.attachEvent)throw new sjcl.exception.bug("can't attach event");document.attachEvent("onload",this._loadTimeCollector),document.attachEvent("onmousemove",this._mouseCollector)}this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._loadTimeCollector,!1),window.removeEventListener("mousemove",this._mouseCollector,!1)):window.detachEvent&&(window.detachEvent("onload",this._loadTimeCollector),window.detachEvent("onmousemove",this._mouseCollector)),this._collectorsStarted=!1)},addEventListener:function(t,e){this._callbacks[t][this._callbackI++]=e},removeEventListener:function(t,e){var n,i,o=this._callbacks[t],r=[];for(i in o)o.hasOwnProperty(i)&&o[i]===e&&r.push(i);for(n=0;n<r.length;n++)i=r[n],delete o[i]},_pools:[new sjcl.hash.sha256],_poolEntropy:[0],_reseedCount:0,_robins:{},_eventId:0,_collectorIds:{},_collectorIdNext:0,_strength:0,_poolStrength:0,_nextReseed:0,_key:[0,0,0,0,0,0,0,0],_counter:[0,0,0,0],_cipher:void 0,_defaultParanoia:6,_collectorsStarted:!1,_callbacks:{progress:{},seeded:{}},_callbackI:0,_NOT_READY:0,_READY:1,_REQUIRES_RESEED:2,_MAX_WORDS_PER_BURST:65536,_PARANOIA_LEVELS:[0,48,64,96,128,192,256,384,512,768,1024],_MILLISECONDS_PER_RESEED:3e4,_BITS_PER_RESEED:80,_gen4words:function(){for(var t=0;4>t&&(this._counter[t]=this._counter[t]+1|0,!this._counter[t]);t++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new sjcl.cipher.aes(this._key)},_reseed:function(t){this._key=sjcl.hash.sha256.hash(this._key.concat(t)),this._cipher=new sjcl.cipher.aes(this._key);for(var e=0;4>e&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);},_reseedFromPools:function(t){var e,n=[],i=0;for(this._nextReseed=n[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED,e=0;16>e;e++)n.push(4294967296*Math.random()|0);for(e=0;e<this._pools.length&&(n=n.concat(this._pools[e].finalize()),i+=this._poolEntropy[e],this._poolEntropy[e]=0,t||!(this._reseedCount&1<<e));e++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new sjcl.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=i,i>this._strength&&(this._strength=i),this._reseedCount++,this._reseed(n)},_mouseCollector:function(t){var e=t.x||t.clientX||t.offsetX||0,n=t.y||t.clientY||t.offsetY||0;sjcl.random.addEntropy([e,n],2,"mouse")},_loadTimeCollector:function(t){sjcl.random.addEntropy((new Date).valueOf(),2,"loadtime")},_fireEvent:function(t,e){var n,i=sjcl.random._callbacks[t],o=[];for(n in i)i.hasOwnProperty(n)&&o.push(i[n]);for(n=0;n<o.length;n++)o[n](e)}},function(){try{var t=new Uint32Array(32);crypto.getRandomValues(t),sjcl.random.addEntropy(t,1024,"crypto.getRandomValues")}catch(e){}}(),"object"!=typeof JSON&&(JSON={}),function(){function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,i,o,r,s,a=gap,u=e[t];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(t)),"function"==typeof rep&&(u=rep.call(e,t,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(r=u.length,n=0;r>n;n+=1)s[n]=str(n,u)||"null";return o=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,o}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;r>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],o=str(i,u),o&&s.push(quote(i)+(gap?": ":":")+o));else for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(o=str(i,u),o&&s.push(quote(i)+(gap?": ":":")+o));return o=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,o}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var n,i,o=t[e];if(o&&"object"==typeof o)for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(i=walk(o,n),void 0!==i?o[n]=i:delete o[n]);return reviver.call(t,e,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),sjcl.random.startCollectors();var BraintreeData={};BraintreeData.Environment=function(t,e,n){this.url=e,this.name=t,this.id=n,this.getId=function(){return this.hasOwnProperty("customId")?this.customId:this.id},this.withId=function(t){return this.customId=t,this}},BraintreeData.iframeId="braintreeDataFrame",BraintreeData.collectionStarted=!1,BraintreeData.environments={qa:new BraintreeData.Environment("qa","https://assets.qa.braintreegateway.com/data","600000"),sandbox:new BraintreeData.Environment("sandbox","https://assets.braintreegateway.com/sandbox/data","600000"),production:new BraintreeData.Environment("production","https://assets.braintreegateway.com/data","600000")},BraintreeData.setup=function(t,e,n){this._setupCollector(n),this._setupForm(e),BraintreeData.FraudNet.initialize()},BraintreeData._setupCollector=function(t){this.collectionStarted=!0,this._initializeEnvironment(t),this._setupIFrame()},BraintreeData._setupForm=function(t){var e=document.getElementById(t);this._addHiddenField(e,"device_data",this._getDeviceData())},BraintreeData._getDeviceData=function(){if(this.collectionStarted)return JSON.stringify({device_session_id:this._getDeviceSessionId(),fraud_merchant_id:this.currentEnvironment.getId(),correlation_id:BraintreeData.FraudNet.getSessionId()});throw"You must call setup or _setupCollector before _getDeviceData."},BraintreeData._addHiddenField=function(t,e,n){if(!this._formHasInput(t,e)){var i=document.createElement("input");i.type="hidden",i.name=e,i.id=e,i.value=n,t.appendChild(i)}},BraintreeData._getDeviceSessionId=function(){var t,e;return void 0==this.deviceSessionId&&(t=sjcl.random.randomWords(4,0),e=sjcl.codec.hex.fromBits(t),this.deviceSessionId=e),this.deviceSessionId},BraintreeData._setupIFrame=function(){var t,e,n=this;document.getElementById(BraintreeData.iframeId)||(t="?m="+this.currentEnvironment.getId()+"&s="+this._getDeviceSessionId(),e=document.createElement("iframe"),e.width=1,e.id=BraintreeData.iframeId,e.height=1,e.frameBorder=0,e.scrolling="no",document.body.appendChild(e),setTimeout(function(){e.src=n.currentEnvironment.url+"/logo.htm"+t,e.innerHTML='<img src="'+n.currentEnvironment.url+"/logo.gif"+t+'" />'},10))},BraintreeData._formHasInput=function(t,e){for(var n=t.getElementsByTagName("input"),i=!1,o=0;o<n.length;o+=1)if(n[o].id==e){i=!0;break}return i},BraintreeData._initializeEnvironment=function(t){if("undefined"==typeof t||!t.hasOwnProperty("name")||!this.environments.hasOwnProperty(t.name))throw t+" is not a valid environment";this.currentEnvironment=this.environments[t.name]},BraintreeData.sjcl=sjcl,window.BraintreeData=BraintreeData,function(t){function e(){var t=s(),e=(new Date).getTime()/1e3;return"https://b.stats.paypal.com/counter.cgi?i=127.0.0.1&p="+t+"&t="+e+"&a=14"}function n(){i(),o()}function i(){var t=document.body.appendChild(document.createElement("script"));t.type="application/json",t.setAttribute("fncls","fnparams-dede7cc5-15fd-4c75-a9f4-36c430ee3a99"),t.text=JSON.stringify(a)}function o(){var t,e,n,i="https://www.paypalobjects.com/webstatic/r/fb/",o=document.createElement("iframe");o.src="javascript:false",o.title="",o.role="presentation",(o.frameElement||o).style.cssText="width: 0; height: 0; border: 0",n=document.getElementsByTagName("script"),n=n[n.length-1],n.parentNode.insertBefore(o,n);try{e=o.contentWindow.document}catch(r){t=document.domain,o.src='javascript:var d=document.open();d.domain="'+t+'";void(0);',e=o.contentWindow.document}e.open()._l=function(){var e=this.createElement("script");t&&(this.domain=t),e.id="js-iframe-async",e.src=i+"fb-all-prod.pp.min.js",this.body.appendChild(e)},e.write('<body onload="document._l();">'),e.close()}var r=BraintreeData.FraudNet={},s=function(){for(var t="",e=0;32>e;e++)t+=Math.floor(16*Math.random()).toString(16);return function(){return t}}(),a={f:s(),s:"BRAINTREE_SIGNIN",b:e()};r.initialize=n,r.getSessionId=s}(this),"function"==typeof window.onBraintreeDataLoad&&window.onBraintreeDataLoad()}(),function(){var t=this,e=t._,n=Array.prototype,i=Object.prototype,o=Function.prototype,r=n.push,s=n.slice,a=n.concat,u=i.toString,l=i.hasOwnProperty,c=Array.isArray,d=Object.keys,h=o.bind,p=function(t){return t instanceof p?t:this instanceof p?void(this._wrapped=t):new p(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports._=p):t._=p,p.VERSION="1.7.0";var f=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,o){return t.call(e,n,i,o)};case 4:return function(n,i,o,r){return t.call(e,n,i,o,r)}}return function(){return t.apply(e,arguments)}};p.iteratee=function(t,e,n){return null==t?p.identity:p.isFunction(t)?f(t,e,n):p.isObject(t)?p.matches(t):p.property(t)},p.each=p.forEach=function(t,e,n){if(null==t)return t;e=f(e,n);var i,o=t.length;if(o===+o)for(i=0;o>i;i++)e(t[i],i,t);else{var r=p.keys(t);for(i=0,o=r.length;o>i;i++)e(t[r[i]],r[i],t)}return t},p.map=p.collect=function(t,e,n){if(null==t)return[];e=p.iteratee(e,n);for(var i,o=t.length!==+t.length&&p.keys(t),r=(o||t).length,s=Array(r),a=0;r>a;a++)i=o?o[a]:a,s[a]=e(t[i],i,t);return s};var m="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(t,e,n,i){null==t&&(t=[]),e=f(e,i,4);var o,r=t.length!==+t.length&&p.keys(t),s=(r||t).length,a=0;if(arguments.length<3){if(!s)throw new TypeError(m);n=t[r?r[a++]:a++]}for(;s>a;a++)o=r?r[a]:a,n=e(n,t[o],o,t);return n},p.reduceRight=p.foldr=function(t,e,n,i){null==t&&(t=[]),e=f(e,i,4);var o,r=t.length!==+t.length&&p.keys(t),s=(r||t).length;if(arguments.length<3){if(!s)throw new TypeError(m);n=t[r?r[--s]:--s]}for(;s--;)o=r?r[s]:s,n=e(n,t[o],o,t);return n},p.find=p.detect=function(t,e,n){var i;return e=p.iteratee(e,n),p.some(t,function(t,n,o){return e(t,n,o)?(i=t,!0):void 0}),i},p.filter=p.select=function(t,e,n){var i=[];return null==t?i:(e=p.iteratee(e,n),p.each(t,function(t,n,o){e(t,n,o)&&i.push(t)}),i)},p.reject=function(t,e,n){return p.filter(t,p.negate(p.iteratee(e)),n)},p.every=p.all=function(t,e,n){if(null==t)return!0;e=p.iteratee(e,n);var i,o,r=t.length!==+t.length&&p.keys(t),s=(r||t).length;for(i=0;s>i;i++)if(o=r?r[i]:i,!e(t[o],o,t))return!1;return!0},p.some=p.any=function(t,e,n){if(null==t)return!1;e=p.iteratee(e,n);var i,o,r=t.length!==+t.length&&p.keys(t),s=(r||t).length;for(i=0;s>i;i++)if(o=r?r[i]:i,e(t[o],o,t))return!0;return!1},p.contains=p.include=function(t,e){return null==t?!1:(t.length!==+t.length&&(t=p.values(t)),p.indexOf(t,e)>=0)},p.invoke=function(t,e){var n=s.call(arguments,2),i=p.isFunction(e);return p.map(t,function(t){return(i?e:t[e]).apply(t,n)})},p.pluck=function(t,e){return p.map(t,p.property(e))},p.where=function(t,e){return p.filter(t,p.matches(e))},p.findWhere=function(t,e){return p.find(t,p.matches(e))},p.max=function(t,e,n){var i,o,r=-(1/0),s=-(1/0);if(null==e&&null!=t){t=t.length===+t.length?t:p.values(t);for(var a=0,u=t.length;u>a;a++)i=t[a],i>r&&(r=i)}else e=p.iteratee(e,n),p.each(t,function(t,n,i){o=e(t,n,i),(o>s||o===-(1/0)&&r===-(1/0))&&(r=t,s=o)});return r},p.min=function(t,e,n){var i,o,r=1/0,s=1/0;if(null==e&&null!=t){t=t.length===+t.length?t:p.values(t);for(var a=0,u=t.length;u>a;a++)i=t[a],r>i&&(r=i)}else e=p.iteratee(e,n),p.each(t,function(t,n,i){o=e(t,n,i),(s>o||o===1/0&&r===1/0)&&(r=t,s=o)});return r},p.shuffle=function(t){for(var e,n=t&&t.length===+t.length?t:p.values(t),i=n.length,o=Array(i),r=0;i>r;r++)e=p.random(0,r),e!==r&&(o[r]=o[e]),o[e]=n[r];return o},p.sample=function(t,e,n){return null==e||n?(t.length!==+t.length&&(t=p.values(t)),t[p.random(t.length-1)]):p.shuffle(t).slice(0,Math.max(0,e))},p.sortBy=function(t,e,n){return e=p.iteratee(e,n),p.pluck(p.map(t,function(t,n,i){return{value:t,index:n,criteria:e(t,n,i)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return t.index-e.index}),"value")};var g=function(t){return function(e,n,i){var o={};return n=p.iteratee(n,i),p.each(e,function(i,r){var s=n(i,r,e);t(o,i,s)}),o}};p.groupBy=g(function(t,e,n){p.has(t,n)?t[n].push(e):t[n]=[e]}),p.indexBy=g(function(t,e,n){t[n]=e}),p.countBy=g(function(t,e,n){p.has(t,n)?t[n]++:t[n]=1}),p.sortedIndex=function(t,e,n,i){n=p.iteratee(n,i,1);for(var o=n(e),r=0,s=t.length;s>r;){var a=r+s>>>1;n(t[a])<o?r=a+1:s=a}return r},p.toArray=function(t){return t?p.isArray(t)?s.call(t):t.length===+t.length?p.map(t,p.identity):p.values(t):[]},p.size=function(t){return null==t?0:t.length===+t.length?t.length:p.keys(t).length},p.partition=function(t,e,n){e=p.iteratee(e,n);var i=[],o=[];return p.each(t,function(t,n,r){(e(t,n,r)?i:o).push(t)}),[i,o]},p.first=p.head=p.take=function(t,e,n){return null!=t?null==e||n?t[0]:0>e?[]:s.call(t,0,e):void 0},p.initial=function(t,e,n){return s.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},p.last=function(t,e,n){return null!=t?null==e||n?t[t.length-1]:s.call(t,Math.max(t.length-e,0)):void 0},p.rest=p.tail=p.drop=function(t,e,n){return s.call(t,null==e||n?1:e)},p.compact=function(t){return p.filter(t,p.identity)};var b=function(t,e,n,i){if(e&&p.every(t,p.isArray))return a.apply(i,t);for(var o=0,s=t.length;s>o;o++){var u=t[o];p.isArray(u)||p.isArguments(u)?e?r.apply(i,u):b(u,e,n,i):n||i.push(u)}return i};p.flatten=function(t,e){return b(t,e,!1,[])},p.without=function(t){return p.difference(t,s.call(arguments,1))},p.uniq=p.unique=function(t,e,n,i){if(null==t)return[];p.isBoolean(e)||(i=n,n=e,e=!1),null!=n&&(n=p.iteratee(n,i));for(var o=[],r=[],s=0,a=t.length;a>s;s++){var u=t[s];if(e)s&&r===u||o.push(u),r=u;else if(n){var l=n(u,s,t);p.indexOf(r,l)<0&&(r.push(l),o.push(u))}else p.indexOf(o,u)<0&&o.push(u)}return o},p.union=function(){return p.uniq(b(arguments,!0,!0,[]))},p.intersection=function(t){if(null==t)return[];for(var e=[],n=arguments.length,i=0,o=t.length;o>i;i++){var r=t[i];if(!p.contains(e,r)){for(var s=1;n>s&&p.contains(arguments[s],r);s++);s===n&&e.push(r)}}return e},p.difference=function(t){var e=b(s.call(arguments,1),!0,!0,[]);return p.filter(t,function(t){return!p.contains(e,t)})},p.zip=function(t){if(null==t)return[];for(var e=p.max(arguments,"length").length,n=Array(e),i=0;e>i;i++)n[i]=p.pluck(arguments,i);return n},p.object=function(t,e){if(null==t)return{};for(var n={},i=0,o=t.length;o>i;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},p.indexOf=function(t,e,n){if(null==t)return-1;var i=0,o=t.length;if(n){if("number"!=typeof n)return i=p.sortedIndex(t,e),t[i]===e?i:-1;i=0>n?Math.max(0,o+n):n}for(;o>i;i++)if(t[i]===e)return i;return-1},p.lastIndexOf=function(t,e,n){if(null==t)return-1;var i=t.length;for("number"==typeof n&&(i=0>n?i+n+1:Math.min(i,n+1));--i>=0;)if(t[i]===e)return i;return-1},p.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=n||1;for(var i=Math.max(Math.ceil((e-t)/n),0),o=Array(i),r=0;i>r;r++,t+=n)o[r]=t;return o};var _=function(){};p.bind=function(t,e){var n,i;if(h&&t.bind===h)return h.apply(t,s.call(arguments,1));if(!p.isFunction(t))throw new TypeError("Bind must be called on a function");return n=s.call(arguments,2),i=function(){if(!(this instanceof i))return t.apply(e,n.concat(s.call(arguments)));_.prototype=t.prototype;var o=new _;_.prototype=null;var r=t.apply(o,n.concat(s.call(arguments)));return p.isObject(r)?r:o}},p.partial=function(t){var e=s.call(arguments,1);return function(){for(var n=0,i=e.slice(),o=0,r=i.length;r>o;o++)i[o]===p&&(i[o]=arguments[n++]);for(;n<arguments.length;)i.push(arguments[n++]);return t.apply(this,i)}},p.bindAll=function(t){var e,n,i=arguments.length;if(1>=i)throw new Error("bindAll must be passed function names");for(e=1;i>e;e++)n=arguments[e],t[n]=p.bind(t[n],t);return t},p.memoize=function(t,e){var n=function(i){var o=n.cache,r=e?e.apply(this,arguments):i;return p.has(o,r)||(o[r]=t.apply(this,arguments)),o[r]};return n.cache={},n},p.delay=function(t,e){var n=s.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},p.defer=function(t){return p.delay.apply(p,[t,1].concat(s.call(arguments,1)))},p.throttle=function(t,e,n){var i,o,r,s=null,a=0;n||(n={});var u=function(){a=n.leading===!1?0:p.now(),s=null,r=t.apply(i,o),s||(i=o=null)};return function(){var l=p.now();a||n.leading!==!1||(a=l);var c=e-(l-a);return i=this,o=arguments,0>=c||c>e?(clearTimeout(s),s=null,a=l,r=t.apply(i,o),s||(i=o=null)):s||n.trailing===!1||(s=setTimeout(u,c)),r}},p.debounce=function(t,e,n){var i,o,r,s,a,u=function(){var l=p.now()-s;e>l&&l>0?i=setTimeout(u,e-l):(i=null,n||(a=t.apply(r,o),i||(r=o=null)))};return function(){r=this,o=arguments,s=p.now();
var l=n&&!i;return i||(i=setTimeout(u,e)),l&&(a=t.apply(r,o),r=o=null),a}},p.wrap=function(t,e){return p.partial(e,t)},p.negate=function(t){return function(){return!t.apply(this,arguments)}},p.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},p.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},p.before=function(t,e){var n;return function(){return--t>0?n=e.apply(this,arguments):e=null,n}},p.once=p.partial(p.before,2),p.keys=function(t){if(!p.isObject(t))return[];if(d)return d(t);var e=[];for(var n in t)p.has(t,n)&&e.push(n);return e},p.values=function(t){for(var e=p.keys(t),n=e.length,i=Array(n),o=0;n>o;o++)i[o]=t[e[o]];return i},p.pairs=function(t){for(var e=p.keys(t),n=e.length,i=Array(n),o=0;n>o;o++)i[o]=[e[o],t[e[o]]];return i},p.invert=function(t){for(var e={},n=p.keys(t),i=0,o=n.length;o>i;i++)e[t[n[i]]]=n[i];return e},p.functions=p.methods=function(t){var e=[];for(var n in t)p.isFunction(t[n])&&e.push(n);return e.sort()},p.extend=function(t){if(!p.isObject(t))return t;for(var e,n,i=1,o=arguments.length;o>i;i++){e=arguments[i];for(n in e)l.call(e,n)&&(t[n]=e[n])}return t},p.pick=function(t,e,n){var i,o={};if(null==t)return o;if(p.isFunction(e)){e=f(e,n);for(i in t){var r=t[i];e(r,i,t)&&(o[i]=r)}}else{var u=a.apply([],s.call(arguments,1));t=new Object(t);for(var l=0,c=u.length;c>l;l++)i=u[l],i in t&&(o[i]=t[i])}return o},p.omit=function(t,e,n){if(p.isFunction(e))e=p.negate(e);else{var i=p.map(a.apply([],s.call(arguments,1)),String);e=function(t,e){return!p.contains(i,e)}}return p.pick(t,e,n)},p.defaults=function(t){if(!p.isObject(t))return t;for(var e=1,n=arguments.length;n>e;e++){var i=arguments[e];for(var o in i)void 0===t[o]&&(t[o]=i[o])}return t},p.clone=function(t){return p.isObject(t)?p.isArray(t)?t.slice():p.extend({},t):t},p.tap=function(t,e){return e(t),t};var y=function(t,e,n,i){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof p&&(t=t._wrapped),e instanceof p&&(e=e._wrapped);var o=u.call(t);if(o!==u.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}if("object"!=typeof t||"object"!=typeof e)return!1;for(var r=n.length;r--;)if(n[r]===t)return i[r]===e;var s=t.constructor,a=e.constructor;if(s!==a&&"constructor"in t&&"constructor"in e&&!(p.isFunction(s)&&s instanceof s&&p.isFunction(a)&&a instanceof a))return!1;n.push(t),i.push(e);var l,c;if("[object Array]"===o){if(l=t.length,c=l===e.length)for(;l--&&(c=y(t[l],e[l],n,i)););}else{var d,h=p.keys(t);if(l=h.length,c=p.keys(e).length===l)for(;l--&&(d=h[l],c=p.has(e,d)&&y(t[d],e[d],n,i)););}return n.pop(),i.pop(),c};p.isEqual=function(t,e){return y(t,e,[],[])},p.isEmpty=function(t){if(null==t)return!0;if(p.isArray(t)||p.isString(t)||p.isArguments(t))return 0===t.length;for(var e in t)if(p.has(t,e))return!1;return!0},p.isElement=function(t){return!(!t||1!==t.nodeType)},p.isArray=c||function(t){return"[object Array]"===u.call(t)},p.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(t){p["is"+t]=function(e){return u.call(e)==="[object "+t+"]"}}),p.isArguments(arguments)||(p.isArguments=function(t){return p.has(t,"callee")}),"function"!=typeof/./&&(p.isFunction=function(t){return"function"==typeof t||!1}),p.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},p.isNaN=function(t){return p.isNumber(t)&&t!==+t},p.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===u.call(t)},p.isNull=function(t){return null===t},p.isUndefined=function(t){return void 0===t},p.has=function(t,e){return null!=t&&l.call(t,e)},p.noConflict=function(){return t._=e,this},p.identity=function(t){return t},p.constant=function(t){return function(){return t}},p.noop=function(){},p.property=function(t){return function(e){return e[t]}},p.matches=function(t){var e=p.pairs(t),n=e.length;return function(t){if(null==t)return!n;t=new Object(t);for(var i=0;n>i;i++){var o=e[i],r=o[0];if(o[1]!==t[r]||!(r in t))return!1}return!0}},p.times=function(t,e,n){var i=Array(Math.max(0,t));e=f(e,n,1);for(var o=0;t>o;o++)i[o]=e(o);return i},p.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},p.now=Date.now||function(){return(new Date).getTime()};var v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},w=p.invert(v),k=function(t){var e=function(e){return t[e]},n="(?:"+p.keys(t).join("|")+")",i=RegExp(n),o=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(o,e):t}};p.escape=k(v),p.unescape=k(w),p.result=function(t,e){if(null!=t){var n=t[e];return p.isFunction(n)?t[e]():n}};var C=0;p.uniqueId=function(t){var e=++C+"";return t?t+e:e},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var S=/(.)^/,x={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},E=/\\|'|\r|\n|\u2028|\u2029/g,P=function(t){return"\\"+x[t]};p.template=function(t,e,n){!e&&n&&(e=n),e=p.defaults({},e,p.templateSettings);var i=RegExp([(e.escape||S).source,(e.interpolate||S).source,(e.evaluate||S).source].join("|")+"|$","g"),o=0,r="__p+='";t.replace(i,function(e,n,i,s,a){return r+=t.slice(o,a).replace(E,P),o=a+e.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?r+="'+\n((__t=("+i+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),e}),r+="';\n",e.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var s=new Function(e.variable||"obj","_",r)}catch(a){throw a.source=r,a}var u=function(t){return s.call(this,t,p)},l=e.variable||"obj";return u.source="function("+l+"){\n"+r+"}",u},p.chain=function(t){var e=p(t);return e._chain=!0,e};var T=function(t){return this._chain?p(t).chain():t};p.mixin=function(t){p.each(p.functions(t),function(e){var n=p[e]=t[e];p.prototype[e]=function(){var t=[this._wrapped];return r.apply(t,arguments),T.call(this,n.apply(p,t))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];p.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],T.call(this,n)}}),p.each(["concat","join","slice"],function(t){var e=n[t];p.prototype[t]=function(){return T.call(this,e.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}.call(this),function(t){var e,n,i=this,o=Function.prototype,r=o.apply,s=o.bind,a=function(t,e){return s?s.call(e,t):function(){return r.call(e,t,arguments)}},u="assert count debug dir dirxml error group groupCollapsed groupEnd info log markTimeline profile profileEnd table time timeEnd trace warn".split(" "),l=function(){},c={};for(e=u.length;e--;)c[u[e]]=l;if(t){for(t.time||(t.timeCounters=n={},t.time=function(t,e){if(t){var i=+new Date,o="KEY"+t.toString();!e&&n[o]||(n[o]=i)}},t.timeEnd=function(e){var i,o=+new Date,r="KEY"+e.toString(),s=n[r];return s&&(i=o-s,t.info(e+": "+i+"ms"),delete n[r]),i}),e=u.length;e--;)t[u[e]]=u[e]in t?a(t,t[u[e]]):l;t.disable=function(){i.console=c},c.enable=function(){i.console=t},c.disable=t.enable=l}else t=i.console=c,t.disable=t.enable=l}("undefined"==typeof console?null:console),function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){function n(t){var e=t.length,n=Z.type(t);return"function"===n||Z.isWindow(t)?!1:1===t.nodeType&&e?!0:"array"===n||0===e||"number"==typeof e&&e>0&&e-1 in t}function i(t,e,n){if(Z.isFunction(e))return Z.grep(t,function(t,i){return!!e.call(t,i,t)!==n});if(e.nodeType)return Z.grep(t,function(t){return t===e!==n});if("string"==typeof e){if(at.test(e))return Z.filter(e,t,n);e=Z.filter(e,t)}return Z.grep(t,function(t){return W.call(e,t)>=0!==n})}function o(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function r(t){var e=ft[t]={};return Z.each(t.match(pt)||[],function(t,n){e[n]=!0}),e}function s(){J.removeEventListener("DOMContentLoaded",s,!1),t.removeEventListener("load",s,!1),Z.ready()}function a(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=Z.expando+a.uid++}function u(t,e,n){var i;if(void 0===n&&1===t.nodeType)if(i="data-"+e.replace(vt,"-$1").toLowerCase(),n=t.getAttribute(i),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:yt.test(n)?Z.parseJSON(n):n}catch(o){}_t.set(t,e,n)}else n=void 0;return n}function l(){return!0}function c(){return!1}function d(){try{return J.activeElement}catch(t){}}function h(t,e){return Z.nodeName(t,"table")&&Z.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function p(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function f(t){var e=Rt.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function m(t,e){for(var n=0,i=t.length;i>n;n++)bt.set(t[n],"globalEval",!e||bt.get(e[n],"globalEval"))}function g(t,e){var n,i,o,r,s,a,u,l;if(1===e.nodeType){if(bt.hasData(t)&&(r=bt.access(t),s=bt.set(e,r),l=r.events)){delete s.handle,s.events={};for(o in l)for(n=0,i=l[o].length;i>n;n++)Z.event.add(e,o,l[o][n])}_t.hasData(t)&&(a=_t.access(t),u=Z.extend({},a),_t.set(e,u))}}function b(t,e){var n=t.getElementsByTagName?t.getElementsByTagName(e||"*"):t.querySelectorAll?t.querySelectorAll(e||"*"):[];return void 0===e||e&&Z.nodeName(t,e)?Z.merge([t],n):n}function _(t,e){var n=e.nodeName.toLowerCase();"input"===n&&St.test(t.type)?e.checked=t.checked:"input"!==n&&"textarea"!==n||(e.defaultValue=t.defaultValue)}function y(e,n){var i,o=Z(n.createElement(e)).appendTo(n.body),r=t.getDefaultComputedStyle&&(i=t.getDefaultComputedStyle(o[0]))?i.display:Z.css(o[0],"display");return o.detach(),r}function v(t){var e=J,n=jt[t];return n||(n=y(t,e),"none"!==n&&n||(Nt=(Nt||Z("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement),e=Nt[0].contentDocument,e.write(),e.close(),n=y(t,e),Nt.detach()),jt[t]=n),n}function w(t,e,n){var i,o,r,s,a=t.style;return n=n||Ht(t),n&&(s=n.getPropertyValue(e)||n[e]),n&&(""!==s||Z.contains(t.ownerDocument,t)||(s=Z.style(t,e)),Vt.test(s)&&Ut.test(e)&&(i=a.width,o=a.minWidth,r=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=n.width,a.width=i,a.minWidth=o,a.maxWidth=r)),void 0!==s?s+"":s}function k(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}function C(t,e){if(e in t)return e;for(var n=e[0].toUpperCase()+e.slice(1),i=e,o=Gt.length;o--;)if(e=Gt[o]+n,e in t)return e;return i}function S(t,e,n){var i=qt.exec(e);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):e}function x(t,e,n,i,o){for(var r=n===(i?"border":"content")?4:"width"===e?1:0,s=0;4>r;r+=2)"margin"===n&&(s+=Z.css(t,n+kt[r],!0,o)),i?("content"===n&&(s-=Z.css(t,"padding"+kt[r],!0,o)),"margin"!==n&&(s-=Z.css(t,"border"+kt[r]+"Width",!0,o))):(s+=Z.css(t,"padding"+kt[r],!0,o),"padding"!==n&&(s+=Z.css(t,"border"+kt[r]+"Width",!0,o)));return s}function E(t,e,n){var i=!0,o="width"===e?t.offsetWidth:t.offsetHeight,r=Ht(t),s="border-box"===Z.css(t,"boxSizing",!1,r);if(0>=o||null==o){if(o=w(t,e,r),(0>o||null==o)&&(o=t.style[e]),Vt.test(o))return o;i=s&&(K.boxSizingReliable()||o===t.style[e]),o=parseFloat(o)||0}return o+x(t,e,n||(s?"border":"content"),i,r)+"px"}function P(t,e){for(var n,i,o,r=[],s=0,a=t.length;a>s;s++)i=t[s],i.style&&(r[s]=bt.get(i,"olddisplay"),n=i.style.display,e?(r[s]||"none"!==n||(i.style.display=""),""===i.style.display&&Ct(i)&&(r[s]=bt.access(i,"olddisplay",v(i.nodeName)))):(o=Ct(i),"none"===n&&o||bt.set(i,"olddisplay",o?n:Z.css(i,"display"))));for(s=0;a>s;s++)i=t[s],i.style&&(e&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=e?r[s]||"":"none"));return t}function T(t,e,n,i,o){return new T.prototype.init(t,e,n,i,o)}function I(){return setTimeout(function(){Kt=void 0}),Kt=Z.now()}function A(t,e){var n,i=0,o={height:t};for(e=e?1:0;4>i;i+=2-e)n=kt[i],o["margin"+n]=o["padding"+n]=t;return e&&(o.opacity=o.width=t),o}function B(t,e,n){for(var i,o=(ne[e]||[]).concat(ne["*"]),r=0,s=o.length;s>r;r++)if(i=o[r].call(n,e,t))return i}function O(t,e,n){var i,o,r,s,a,u,l,c,d=this,h={},p=t.style,f=t.nodeType&&Ct(t),m=bt.get(t,"fxshow");n.queue||(a=Z._queueHooks(t,"fx"),null==a.unqueued&&(a.unqueued=0,u=a.empty.fire,a.empty.fire=function(){a.unqueued||u()}),a.unqueued++,d.always(function(){d.always(function(){a.unqueued--,Z.queue(t,"fx").length||a.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],l=Z.css(t,"display"),c="none"===l?bt.get(t,"olddisplay")||v(t.nodeName):l,"inline"===c&&"none"===Z.css(t,"float")&&(p.display="inline-block")),n.overflow&&(p.overflow="hidden",d.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(i in e)if(o=e[i],Xt.exec(o)){if(delete e[i],r=r||"toggle"===o,o===(f?"hide":"show")){if("show"!==o||!m||void 0===m[i])continue;f=!0}h[i]=m&&m[i]||Z.style(t,i)}else l=void 0;if(Z.isEmptyObject(h))"inline"===("none"===l?v(t.nodeName):l)&&(p.display=l);else{m?"hidden"in m&&(f=m.hidden):m=bt.access(t,"fxshow",{}),r&&(m.hidden=!f),f?Z(t).show():d.done(function(){Z(t).hide()}),d.done(function(){var e;bt.remove(t,"fxshow");for(e in h)Z.style(t,e,h[e])});for(i in h)s=B(f?m[i]:0,i,d),i in m||(m[i]=s.start,f&&(s.end=s.start,s.start="width"===i||"height"===i?1:0))}}function M(t,e){var n,i,o,r,s;for(n in t)if(i=Z.camelCase(n),o=e[i],r=t[n],Z.isArray(r)&&(o=r[1],r=t[n]=r[0]),n!==i&&(t[i]=r,delete t[n]),s=Z.cssHooks[i],s&&"expand"in s){r=s.expand(r),delete t[i];for(n in r)n in t||(t[n]=r[n],e[n]=o)}else e[i]=o}function $(t,e,n){var i,o,r=0,s=ee.length,a=Z.Deferred().always(function(){delete u.elem}),u=function(){if(o)return!1;for(var e=Kt||I(),n=Math.max(0,l.startTime+l.duration-e),i=n/l.duration||0,r=1-i,s=0,u=l.tweens.length;u>s;s++)l.tweens[s].run(r);return a.notifyWith(t,[l,r,n]),1>r&&u?n:(a.resolveWith(t,[l]),!1)},l=a.promise({elem:t,props:Z.extend({},e),opts:Z.extend(!0,{specialEasing:{}},n),originalProperties:e,originalOptions:n,startTime:Kt||I(),duration:n.duration,tweens:[],createTween:function(e,n){var i=Z.Tween(t,l.opts,e,n,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(i),i},stop:function(e){var n=0,i=e?l.tweens.length:0;if(o)return this;for(o=!0;i>n;n++)l.tweens[n].run(1);return e?a.resolveWith(t,[l,e]):a.rejectWith(t,[l,e]),this}}),c=l.props;for(M(c,l.opts.specialEasing);s>r;r++)if(i=ee[r].call(l,t,c,l.opts))return i;return Z.map(c,B,l),Z.isFunction(l.opts.start)&&l.opts.start.call(t,l),Z.fx.timer(Z.extend(u,{elem:t,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function D(t){return function(e,n){"string"!=typeof e&&(n=e,e="*");var i,o=0,r=e.toLowerCase().match(pt)||[];if(Z.isFunction(n))for(;i=r[o++];)"+"===i[0]?(i=i.slice(1)||"*",(t[i]=t[i]||[]).unshift(n)):(t[i]=t[i]||[]).push(n)}}function R(t,e,n,i){function o(a){var u;return r[a]=!0,Z.each(t[a]||[],function(t,a){var l=a(e,n,i);return"string"!=typeof l||s||r[l]?s?!(u=l):void 0:(e.dataTypes.unshift(l),o(l),!1)}),u}var r={},s=t===ye;return o(e.dataTypes[0])||!r["*"]&&o("*")}function L(t,e){var n,i,o=Z.ajaxSettings.flatOptions||{};for(n in e)void 0!==e[n]&&((o[n]?t:i||(i={}))[n]=e[n]);return i&&Z.extend(!0,t,i),t}function F(t,e,n){for(var i,o,r,s,a=t.contents,u=t.dataTypes;"*"===u[0];)u.shift(),void 0===i&&(i=t.mimeType||e.getResponseHeader("Content-Type"));if(i)for(o in a)if(a[o]&&a[o].test(i)){u.unshift(o);break}if(u[0]in n)r=u[0];else{for(o in n){if(!u[0]||t.converters[o+" "+u[0]]){r=o;break}s||(s=o)}r=r||s}return r?(r!==u[0]&&u.unshift(r),n[r]):void 0}function N(t,e,n,i){var o,r,s,a,u,l={},c=t.dataTypes.slice();if(c[1])for(s in t.converters)l[s.toLowerCase()]=t.converters[s];for(r=c.shift();r;)if(t.responseFields[r]&&(n[t.responseFields[r]]=e),!u&&i&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),u=r,r=c.shift())if("*"===r)r=u;else if("*"!==u&&u!==r){if(s=l[u+" "+r]||l["* "+r],!s)for(o in l)if(a=o.split(" "),a[1]===r&&(s=l[u+" "+a[0]]||l["* "+a[0]])){s===!0?s=l[o]:l[o]!==!0&&(r=a[0],c.unshift(a[1]));break}if(s!==!0)if(s&&t["throws"])e=s(e);else try{e=s(e)}catch(d){return{state:"parsererror",error:s?d:"No conversion from "+u+" to "+r}}}return{state:"success",data:e}}function j(t,e,n,i){var o;if(Z.isArray(e))Z.each(e,function(e,o){n||Se.test(t)?i(t,o):j(t+"["+("object"==typeof o?e:"")+"]",o,n,i)});else if(n||"object"!==Z.type(e))i(t,e);else for(o in e)j(t+"["+o+"]",e[o],n,i)}function U(t){return Z.isWindow(t)?t:9===t.nodeType&&t.defaultView}var V=[],H=V.slice,z=V.concat,q=V.push,W=V.indexOf,Q={},Y=Q.toString,G=Q.hasOwnProperty,K={},J=t.document,X="2.1.3",Z=function(t,e){return new Z.fn.init(t,e)},tt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,et=/^-ms-/,nt=/-([\da-z])/gi,it=function(t,e){return e.toUpperCase()};Z.fn=Z.prototype={jquery:X,constructor:Z,selector:"",length:0,toArray:function(){return H.call(this)},get:function(t){return null!=t?0>t?this[t+this.length]:this[t]:H.call(this)},pushStack:function(t){var e=Z.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t,e){return Z.each(this,t,e)},map:function(t){return this.pushStack(Z.map(this,function(e,n){return t.call(e,n,e)}))},slice:function(){return this.pushStack(H.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,n=+t+(0>t?e:0);return this.pushStack(n>=0&&e>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:q,sort:V.sort,splice:V.splice},Z.extend=Z.fn.extend=function(){var t,e,n,i,o,r,s=arguments[0]||{},a=1,u=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[a]||{},a++),"object"==typeof s||Z.isFunction(s)||(s={}),a===u&&(s=this,a--);u>a;a++)if(null!=(t=arguments[a]))for(e in t)n=s[e],i=t[e],s!==i&&(l&&i&&(Z.isPlainObject(i)||(o=Z.isArray(i)))?(o?(o=!1,r=n&&Z.isArray(n)?n:[]):r=n&&Z.isPlainObject(n)?n:{},s[e]=Z.extend(l,r,i)):void 0!==i&&(s[e]=i));return s},Z.extend({expando:"jQuery"+(X+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===Z.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){return!Z.isArray(t)&&t-parseFloat(t)+1>=0},isPlainObject:function(t){return"object"!==Z.type(t)||t.nodeType||Z.isWindow(t)?!1:!t.constructor||G.call(t.constructor.prototype,"isPrototypeOf")},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?Q[Y.call(t)]||"object":typeof t},globalEval:function(t){var e,n=eval;t=Z.trim(t),t&&(1===t.indexOf("use strict")?(e=J.createElement("script"),e.text=t,J.head.appendChild(e).parentNode.removeChild(e)):n(t))},camelCase:function(t){return t.replace(et,"ms-").replace(nt,it)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e,i){var o,r=0,s=t.length,a=n(t);if(i){if(a)for(;s>r&&(o=e.apply(t[r],i),o!==!1);r++);else for(r in t)if(o=e.apply(t[r],i),o===!1)break}else if(a)for(;s>r&&(o=e.call(t[r],r,t[r]),o!==!1);r++);else for(r in t)if(o=e.call(t[r],r,t[r]),o===!1)break;return t},trim:function(t){return null==t?"":(t+"").replace(tt,"")},makeArray:function(t,e){var i=e||[];return null!=t&&(n(Object(t))?Z.merge(i,"string"==typeof t?[t]:t):q.call(i,t)),i},inArray:function(t,e,n){return null==e?-1:W.call(e,t,n)},merge:function(t,e){for(var n=+e.length,i=0,o=t.length;n>i;i++)t[o++]=e[i];return t.length=o,t},grep:function(t,e,n){for(var i,o=[],r=0,s=t.length,a=!n;s>r;r++)i=!e(t[r],r),i!==a&&o.push(t[r]);return o},map:function(t,e,i){var o,r=0,s=t.length,a=n(t),u=[];if(a)for(;s>r;r++)o=e(t[r],r,i),null!=o&&u.push(o);else for(r in t)o=e(t[r],r,i),null!=o&&u.push(o);return z.apply([],u)},guid:1,proxy:function(t,e){var n,i,o;return"string"==typeof e&&(n=t[e],e=t,t=n),Z.isFunction(t)?(i=H.call(arguments,2),o=function(){return t.apply(e||this,i.concat(H.call(arguments)))},o.guid=t.guid=t.guid||Z.guid++,o):void 0},now:Date.now,support:K}),Z.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){Q["[object "+e+"]"]=e.toLowerCase()});var ot=function(t){function e(t,e,n,i){var o,r,s,a,u,l,d,p,f,m;if((e?e.ownerDocument||e:j)!==O&&B(e),e=e||O,n=n||[],a=e.nodeType,"string"!=typeof t||!t||1!==a&&9!==a&&11!==a)return n;if(!i&&$){if(11!==a&&(o=_t.exec(t)))if(s=o[1]){if(9===a){if(r=e.getElementById(s),!r||!r.parentNode)return n;if(r.id===s)return n.push(r),n}else if(e.ownerDocument&&(r=e.ownerDocument.getElementById(s))&&F(e,r)&&r.id===s)return n.push(r),n}else{if(o[2])return X.apply(n,e.getElementsByTagName(t)),n;if((s=o[3])&&w.getElementsByClassName)return X.apply(n,e.getElementsByClassName(s)),n}if(w.qsa&&(!D||!D.test(t))){if(p=d=N,f=e,m=1!==a&&t,1===a&&"object"!==e.nodeName.toLowerCase()){for(l=x(t),(d=e.getAttribute("id"))?p=d.replace(vt,"\\$&"):e.setAttribute("id",p),p="[id='"+p+"'] ",u=l.length;u--;)l[u]=p+h(l[u]);f=yt.test(t)&&c(e.parentNode)||e,m=l.join(",")}if(m)try{return X.apply(n,f.querySelectorAll(m)),n}catch(g){}finally{d||e.removeAttribute("id")}}}return P(t.replace(ut,"$1"),e,n,i)}function n(){function t(n,i){return e.push(n+" ")>k.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function i(t){return t[N]=!0,t}function o(t){var e=O.createElement("div");try{return!!t(e)}catch(n){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function r(t,e){for(var n=t.split("|"),i=t.length;i--;)k.attrHandle[n[i]]=e}function s(t,e){var n=e&&t,i=n&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||Q)-(~t.sourceIndex||Q);if(i)return i;if(n)for(;n=n.nextSibling;)if(n===e)return-1;return t?1:-1}function a(t){return function(e){var n=e.nodeName.toLowerCase();return"input"===n&&e.type===t}}function u(t){return function(e){var n=e.nodeName.toLowerCase();return("input"===n||"button"===n)&&e.type===t}}function l(t){return i(function(e){return e=+e,i(function(n,i){for(var o,r=t([],n.length,e),s=r.length;s--;)n[o=r[s]]&&(n[o]=!(i[o]=n[o]))})})}function c(t){return t&&"undefined"!=typeof t.getElementsByTagName&&t}function d(){}function h(t){for(var e=0,n=t.length,i="";n>e;e++)i+=t[e].value;return i}function p(t,e,n){var i=e.dir,o=n&&"parentNode"===i,r=V++;return e.first?function(e,n,r){for(;e=e[i];)if(1===e.nodeType||o)return t(e,n,r)}:function(e,n,s){var a,u,l=[U,r];if(s){for(;e=e[i];)if((1===e.nodeType||o)&&t(e,n,s))return!0}else for(;e=e[i];)if(1===e.nodeType||o){if(u=e[N]||(e[N]={}),(a=u[i])&&a[0]===U&&a[1]===r)return l[2]=a[2];if(u[i]=l,l[2]=t(e,n,s))return!0}}}function f(t){return t.length>1?function(e,n,i){for(var o=t.length;o--;)if(!t[o](e,n,i))return!1;return!0}:t[0]}function m(t,n,i){for(var o=0,r=n.length;r>o;o++)e(t,n[o],i);return i}function g(t,e,n,i,o){for(var r,s=[],a=0,u=t.length,l=null!=e;u>a;a++)(r=t[a])&&(n&&!n(r,i,o)||(s.push(r),l&&e.push(a)));return s}function b(t,e,n,o,r,s){return o&&!o[N]&&(o=b(o)),r&&!r[N]&&(r=b(r,s)),i(function(i,s,a,u){var l,c,d,h=[],p=[],f=s.length,b=i||m(e||"*",a.nodeType?[a]:a,[]),_=!t||!i&&e?b:g(b,h,t,a,u),y=n?r||(i?t:f||o)?[]:s:_;if(n&&n(_,y,a,u),o)for(l=g(y,p),o(l,[],a,u),c=l.length;c--;)(d=l[c])&&(y[p[c]]=!(_[p[c]]=d));if(i){if(r||t){if(r){for(l=[],c=y.length;c--;)(d=y[c])&&l.push(_[c]=d);r(null,y=[],l,u)}for(c=y.length;c--;)(d=y[c])&&(l=r?tt(i,d):h[c])>-1&&(i[l]=!(s[l]=d))}}else y=g(y===s?y.splice(f,y.length):y),r?r(null,s,y,u):X.apply(s,y)})}function _(t){for(var e,n,i,o=t.length,r=k.relative[t[0].type],s=r||k.relative[" "],a=r?1:0,u=p(function(t){return t===e},s,!0),l=p(function(t){return tt(e,t)>-1},s,!0),c=[function(t,n,i){var o=!r&&(i||n!==T)||((e=n).nodeType?u(t,n,i):l(t,n,i));return e=null,o}];o>a;a++)if(n=k.relative[t[a].type])c=[p(f(c),n)];else{if(n=k.filter[t[a].type].apply(null,t[a].matches),n[N]){for(i=++a;o>i&&!k.relative[t[i].type];i++);return b(a>1&&f(c),a>1&&h(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(ut,"$1"),n,i>a&&_(t.slice(a,i)),o>i&&_(t=t.slice(i)),o>i&&h(t))}c.push(n)}return f(c)}function y(t,n){var o=n.length>0,r=t.length>0,s=function(i,s,a,u,l){var c,d,h,p=0,f="0",m=i&&[],b=[],_=T,y=i||r&&k.find.TAG("*",l),v=U+=null==_?1:Math.random()||.1,w=y.length;for(l&&(T=s!==O&&s);f!==w&&null!=(c=y[f]);f++){if(r&&c){for(d=0;h=t[d++];)if(h(c,s,a)){u.push(c);break}l&&(U=v)}o&&((c=!h&&c)&&p--,i&&m.push(c))}if(p+=f,o&&f!==p){for(d=0;h=n[d++];)h(m,b,s,a);if(i){if(p>0)for(;f--;)m[f]||b[f]||(b[f]=K.call(u));b=g(b)}X.apply(u,b),l&&!i&&b.length>0&&p+n.length>1&&e.uniqueSort(u)}return l&&(U=v,T=_),m};return o?i(s):s}var v,w,k,C,S,x,E,P,T,I,A,B,O,M,$,D,R,L,F,N="sizzle"+1*new Date,j=t.document,U=0,V=0,H=n(),z=n(),q=n(),W=function(t,e){return t===e&&(A=!0),0},Q=1<<31,Y={}.hasOwnProperty,G=[],K=G.pop,J=G.push,X=G.push,Z=G.slice,tt=function(t,e){for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n;return-1},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",nt="[\\x20\\t\\r\\n\\f]",it="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ot=it.replace("w","w#"),rt="\\["+nt+"*("+it+")(?:"+nt+"*([*^$|!~]?=)"+nt+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ot+"))|)"+nt+"*\\]",st=":("+it+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+rt+")*)|.*)\\)|)",at=new RegExp(nt+"+","g"),ut=new RegExp("^"+nt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+nt+"+$","g"),lt=new RegExp("^"+nt+"*,"+nt+"*"),ct=new RegExp("^"+nt+"*([>+~]|"+nt+")"+nt+"*"),dt=new RegExp("="+nt+"*([^\\]'\"]*?)"+nt+"*\\]","g"),ht=new RegExp(st),pt=new RegExp("^"+ot+"$"),ft={ID:new RegExp("^#("+it+")"),CLASS:new RegExp("^\\.("+it+")"),TAG:new RegExp("^("+it.replace("w","w*")+")"),ATTR:new RegExp("^"+rt),PSEUDO:new RegExp("^"+st),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+nt+"*(even|odd|(([+-]|)(\\d*)n|)"+nt+"*(?:([+-]|)"+nt+"*(\\d+)|))"+nt+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+nt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+nt+"*((?:-\\d)?\\d*)"+nt+"*\\)|)(?=[^-]|$)","i")},mt=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,bt=/^[^{]+\{\s*\[native \w/,_t=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,yt=/[+~]/,vt=/'|\\/g,wt=new RegExp("\\\\([\\da-f]{1,6}"+nt+"?|("+nt+")|.)","ig"),kt=function(t,e,n){var i="0x"+e-65536;return i!==i||n?e:0>i?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320)},Ct=function(){B()};try{X.apply(G=Z.call(j.childNodes),j.childNodes),G[j.childNodes.length].nodeType}catch(St){X={apply:G.length?function(t,e){J.apply(t,Z.call(e))}:function(t,e){for(var n=t.length,i=0;t[n++]=e[i++];);t.length=n-1}}}w=e.support={},S=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return e?"HTML"!==e.nodeName:!1},B=e.setDocument=function(t){var e,n,i=t?t.ownerDocument||t:j;return i!==O&&9===i.nodeType&&i.documentElement?(O=i,M=i.documentElement,n=i.defaultView,n&&n!==n.top&&(n.addEventListener?n.addEventListener("unload",Ct,!1):n.attachEvent&&n.attachEvent("onunload",Ct)),$=!S(i),w.attributes=o(function(t){return t.className="i",!t.getAttribute("className")}),w.getElementsByTagName=o(function(t){return t.appendChild(i.createComment("")),!t.getElementsByTagName("*").length}),w.getElementsByClassName=bt.test(i.getElementsByClassName),w.getById=o(function(t){return M.appendChild(t).id=N,!i.getElementsByName||!i.getElementsByName(N).length}),w.getById?(k.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&$){var n=e.getElementById(t);return n&&n.parentNode?[n]:[]}},k.filter.ID=function(t){var e=t.replace(wt,kt);return function(t){return t.getAttribute("id")===e}}):(delete k.find.ID,k.filter.ID=function(t){var e=t.replace(wt,kt);return function(t){var n="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return n&&n.value===e}}),k.find.TAG=w.getElementsByTagName?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):w.qsa?e.querySelectorAll(t):void 0}:function(t,e){var n,i=[],o=0,r=e.getElementsByTagName(t);if("*"===t){for(;n=r[o++];)1===n.nodeType&&i.push(n);return i}return r},k.find.CLASS=w.getElementsByClassName&&function(t,e){return $?e.getElementsByClassName(t):void 0},R=[],D=[],(w.qsa=bt.test(i.querySelectorAll))&&(o(function(t){M.appendChild(t).innerHTML="<a id='"+N+"'></a><select id='"+N+"-\f]' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&D.push("[*^$]="+nt+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||D.push("\\["+nt+"*(?:value|"+et+")"),t.querySelectorAll("[id~="+N+"-]").length||D.push("~="),t.querySelectorAll(":checked").length||D.push(":checked"),t.querySelectorAll("a#"+N+"+*").length||D.push(".#.+[+~]")}),o(function(t){var e=i.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&D.push("name"+nt+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||D.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),D.push(",.*:")})),(w.matchesSelector=bt.test(L=M.matches||M.webkitMatchesSelector||M.mozMatchesSelector||M.oMatchesSelector||M.msMatchesSelector))&&o(function(t){w.disconnectedMatch=L.call(t,"div"),L.call(t,"[s!='']:x"),R.push("!=",st)}),D=D.length&&new RegExp(D.join("|")),R=R.length&&new RegExp(R.join("|")),e=bt.test(M.compareDocumentPosition),F=e||bt.test(M.contains)?function(t,e){var n=9===t.nodeType?t.documentElement:t,i=e&&e.parentNode;return t===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):t.compareDocumentPosition&&16&t.compareDocumentPosition(i)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},W=e?function(t,e){if(t===e)return A=!0,0;var n=!t.compareDocumentPosition-!e.compareDocumentPosition;return n?n:(n=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&n||!w.sortDetached&&e.compareDocumentPosition(t)===n?t===i||t.ownerDocument===j&&F(j,t)?-1:e===i||e.ownerDocument===j&&F(j,e)?1:I?tt(I,t)-tt(I,e):0:4&n?-1:1)}:function(t,e){if(t===e)return A=!0,0;var n,o=0,r=t.parentNode,a=e.parentNode,u=[t],l=[e];if(!r||!a)return t===i?-1:e===i?1:r?-1:a?1:I?tt(I,t)-tt(I,e):0;if(r===a)return s(t,e);for(n=t;n=n.parentNode;)u.unshift(n);for(n=e;n=n.parentNode;)l.unshift(n);for(;u[o]===l[o];)o++;return o?s(u[o],l[o]):u[o]===j?-1:l[o]===j?1:0},i):O},e.matches=function(t,n){return e(t,null,null,n)},e.matchesSelector=function(t,n){if((t.ownerDocument||t)!==O&&B(t),n=n.replace(dt,"='$1']"),w.matchesSelector&&$&&(!R||!R.test(n))&&(!D||!D.test(n)))try{var i=L.call(t,n);if(i||w.disconnectedMatch||t.document&&11!==t.document.nodeType)return i}catch(o){}return e(n,O,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==O&&B(t),F(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==O&&B(t);var n=k.attrHandle[e.toLowerCase()],i=n&&Y.call(k.attrHandle,e.toLowerCase())?n(t,e,!$):void 0;return void 0!==i?i:w.attributes||!$?t.getAttribute(e):(i=t.getAttributeNode(e))&&i.specified?i.value:null},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,n=[],i=0,o=0;if(A=!w.detectDuplicates,I=!w.sortStable&&t.slice(0),t.sort(W),A){for(;e=t[o++];)e===t[o]&&(i=n.push(o));for(;i--;)t.splice(n[i],1)}return I=null,t},C=e.getText=function(t){var e,n="",i=0,o=t.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)n+=C(t)}else if(3===o||4===o)return t.nodeValue;
}else for(;e=t[i++];)n+=C(e);return n},k=e.selectors={cacheLength:50,createPseudo:i,match:ft,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(wt,kt),t[3]=(t[3]||t[4]||t[5]||"").replace(wt,kt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,n=!t[6]&&t[2];return ft.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":n&&ht.test(n)&&(e=x(n,!0))&&(e=n.indexOf(")",n.length-e)-n.length)&&(t[0]=t[0].slice(0,e),t[2]=n.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(wt,kt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=H[t+" "];return e||(e=new RegExp("(^|"+nt+")"+t+"("+nt+"|$)"))&&H(t,function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,n,i){return function(o){var r=e.attr(o,t);return null==r?"!="===n:n?(r+="","="===n?r===i:"!="===n?r!==i:"^="===n?i&&0===r.indexOf(i):"*="===n?i&&r.indexOf(i)>-1:"$="===n?i&&r.slice(-i.length)===i:"~="===n?(" "+r.replace(at," ")+" ").indexOf(i)>-1:"|="===n?r===i||r.slice(0,i.length+1)===i+"-":!1):!0}},CHILD:function(t,e,n,i,o){var r="nth"!==t.slice(0,3),s="last"!==t.slice(-4),a="of-type"===e;return 1===i&&0===o?function(t){return!!t.parentNode}:function(e,n,u){var l,c,d,h,p,f,m=r!==s?"nextSibling":"previousSibling",g=e.parentNode,b=a&&e.nodeName.toLowerCase(),_=!u&&!a;if(g){if(r){for(;m;){for(d=e;d=d[m];)if(a?d.nodeName.toLowerCase()===b:1===d.nodeType)return!1;f=m="only"===t&&!f&&"nextSibling"}return!0}if(f=[s?g.firstChild:g.lastChild],s&&_){for(c=g[N]||(g[N]={}),l=c[t]||[],p=l[0]===U&&l[1],h=l[0]===U&&l[2],d=p&&g.childNodes[p];d=++p&&d&&d[m]||(h=p=0)||f.pop();)if(1===d.nodeType&&++h&&d===e){c[t]=[U,p,h];break}}else if(_&&(l=(e[N]||(e[N]={}))[t])&&l[0]===U)h=l[1];else for(;(d=++p&&d&&d[m]||(h=p=0)||f.pop())&&((a?d.nodeName.toLowerCase()!==b:1!==d.nodeType)||!++h||(_&&((d[N]||(d[N]={}))[t]=[U,h]),d!==e)););return h-=o,h===i||h%i===0&&h/i>=0}}},PSEUDO:function(t,n){var o,r=k.pseudos[t]||k.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return r[N]?r(n):r.length>1?(o=[t,t,"",n],k.setFilters.hasOwnProperty(t.toLowerCase())?i(function(t,e){for(var i,o=r(t,n),s=o.length;s--;)i=tt(t,o[s]),t[i]=!(e[i]=o[s])}):function(t){return r(t,0,o)}):r}},pseudos:{not:i(function(t){var e=[],n=[],o=E(t.replace(ut,"$1"));return o[N]?i(function(t,e,n,i){for(var r,s=o(t,null,i,[]),a=t.length;a--;)(r=s[a])&&(t[a]=!(e[a]=r))}):function(t,i,r){return e[0]=t,o(e,null,r,n),e[0]=null,!n.pop()}}),has:i(function(t){return function(n){return e(t,n).length>0}}),contains:i(function(t){return t=t.replace(wt,kt),function(e){return(e.textContent||e.innerText||C(e)).indexOf(t)>-1}}),lang:i(function(t){return pt.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(wt,kt).toLowerCase(),function(e){var n;do if(n=$?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return n=n.toLowerCase(),n===t||0===n.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var n=t.location&&t.location.hash;return n&&n.slice(1)===e.id},root:function(t){return t===M},focus:function(t){return t===O.activeElement&&(!O.hasFocus||O.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!k.pseudos.empty(t)},header:function(t){return gt.test(t.nodeName)},input:function(t){return mt.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:l(function(){return[0]}),last:l(function(t,e){return[e-1]}),eq:l(function(t,e,n){return[0>n?n+e:n]}),even:l(function(t,e){for(var n=0;e>n;n+=2)t.push(n);return t}),odd:l(function(t,e){for(var n=1;e>n;n+=2)t.push(n);return t}),lt:l(function(t,e,n){for(var i=0>n?n+e:n;--i>=0;)t.push(i);return t}),gt:l(function(t,e,n){for(var i=0>n?n+e:n;++i<e;)t.push(i);return t})}},k.pseudos.nth=k.pseudos.eq;for(v in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})k.pseudos[v]=a(v);for(v in{submit:!0,reset:!0})k.pseudos[v]=u(v);return d.prototype=k.filters=k.pseudos,k.setFilters=new d,x=e.tokenize=function(t,n){var i,o,r,s,a,u,l,c=z[t+" "];if(c)return n?0:c.slice(0);for(a=t,u=[],l=k.preFilter;a;){i&&!(o=lt.exec(a))||(o&&(a=a.slice(o[0].length)||a),u.push(r=[])),i=!1,(o=ct.exec(a))&&(i=o.shift(),r.push({value:i,type:o[0].replace(ut," ")}),a=a.slice(i.length));for(s in k.filter)!(o=ft[s].exec(a))||l[s]&&!(o=l[s](o))||(i=o.shift(),r.push({value:i,type:s,matches:o}),a=a.slice(i.length));if(!i)break}return n?a.length:a?e.error(t):z(t,u).slice(0)},E=e.compile=function(t,e){var n,i=[],o=[],r=q[t+" "];if(!r){for(e||(e=x(t)),n=e.length;n--;)r=_(e[n]),r[N]?i.push(r):o.push(r);r=q(t,y(o,i)),r.selector=t}return r},P=e.select=function(t,e,n,i){var o,r,s,a,u,l="function"==typeof t&&t,d=!i&&x(t=l.selector||t);if(n=n||[],1===d.length){if(r=d[0]=d[0].slice(0),r.length>2&&"ID"===(s=r[0]).type&&w.getById&&9===e.nodeType&&$&&k.relative[r[1].type]){if(e=(k.find.ID(s.matches[0].replace(wt,kt),e)||[])[0],!e)return n;l&&(e=e.parentNode),t=t.slice(r.shift().value.length)}for(o=ft.needsContext.test(t)?0:r.length;o--&&(s=r[o],!k.relative[a=s.type]);)if((u=k.find[a])&&(i=u(s.matches[0].replace(wt,kt),yt.test(r[0].type)&&c(e.parentNode)||e))){if(r.splice(o,1),t=i.length&&h(r),!t)return X.apply(n,i),n;break}}return(l||E(t,d))(i,e,!$,n,yt.test(t)&&c(e.parentNode)||e),n},w.sortStable=N.split("").sort(W).join("")===N,w.detectDuplicates=!!A,B(),w.sortDetached=o(function(t){return 1&t.compareDocumentPosition(O.createElement("div"))}),o(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||r("type|href|height|width",function(t,e,n){return n?void 0:t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),w.attributes&&o(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||r("value",function(t,e,n){return n||"input"!==t.nodeName.toLowerCase()?void 0:t.defaultValue}),o(function(t){return null==t.getAttribute("disabled")})||r(et,function(t,e,n){var i;return n?void 0:t[e]===!0?e.toLowerCase():(i=t.getAttributeNode(e))&&i.specified?i.value:null}),e}(t);Z.find=ot,Z.expr=ot.selectors,Z.expr[":"]=Z.expr.pseudos,Z.unique=ot.uniqueSort,Z.text=ot.getText,Z.isXMLDoc=ot.isXML,Z.contains=ot.contains;var rt=Z.expr.match.needsContext,st=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,at=/^.[^:#\[\.,]*$/;Z.filter=function(t,e,n){var i=e[0];return n&&(t=":not("+t+")"),1===e.length&&1===i.nodeType?Z.find.matchesSelector(i,t)?[i]:[]:Z.find.matches(t,Z.grep(e,function(t){return 1===t.nodeType}))},Z.fn.extend({find:function(t){var e,n=this.length,i=[],o=this;if("string"!=typeof t)return this.pushStack(Z(t).filter(function(){for(e=0;n>e;e++)if(Z.contains(o[e],this))return!0}));for(e=0;n>e;e++)Z.find(t,o[e],i);return i=this.pushStack(n>1?Z.unique(i):i),i.selector=this.selector?this.selector+" "+t:t,i},filter:function(t){return this.pushStack(i(this,t||[],!1))},not:function(t){return this.pushStack(i(this,t||[],!0))},is:function(t){return!!i(this,"string"==typeof t&&rt.test(t)?Z(t):t||[],!1).length}});var ut,lt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ct=Z.fn.init=function(t,e){var n,i;if(!t)return this;if("string"==typeof t){if(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:lt.exec(t),!n||!n[1]&&e)return!e||e.jquery?(e||ut).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof Z?e[0]:e,Z.merge(this,Z.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:J,!0)),st.test(n[1])&&Z.isPlainObject(e))for(n in e)Z.isFunction(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return i=J.getElementById(n[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=J,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):Z.isFunction(t)?"undefined"!=typeof ut.ready?ut.ready(t):t(Z):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),Z.makeArray(t,this))};ct.prototype=Z.fn,ut=Z(J);var dt=/^(?:parents|prev(?:Until|All))/,ht={children:!0,contents:!0,next:!0,prev:!0};Z.extend({dir:function(t,e,n){for(var i=[],o=void 0!==n;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(o&&Z(t).is(n))break;i.push(t)}return i},sibling:function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n}}),Z.fn.extend({has:function(t){var e=Z(t,this),n=e.length;return this.filter(function(){for(var t=0;n>t;t++)if(Z.contains(this,e[t]))return!0})},closest:function(t,e){for(var n,i=0,o=this.length,r=[],s=rt.test(t)||"string"!=typeof t?Z(t,e||this.context):0;o>i;i++)for(n=this[i];n&&n!==e;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&Z.find.matchesSelector(n,t))){r.push(n);break}return this.pushStack(r.length>1?Z.unique(r):r)},index:function(t){return t?"string"==typeof t?W.call(Z(t),this[0]):W.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(Z.unique(Z.merge(this.get(),Z(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),Z.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return Z.dir(t,"parentNode")},parentsUntil:function(t,e,n){return Z.dir(t,"parentNode",n)},next:function(t){return o(t,"nextSibling")},prev:function(t){return o(t,"previousSibling")},nextAll:function(t){return Z.dir(t,"nextSibling")},prevAll:function(t){return Z.dir(t,"previousSibling")},nextUntil:function(t,e,n){return Z.dir(t,"nextSibling",n)},prevUntil:function(t,e,n){return Z.dir(t,"previousSibling",n)},siblings:function(t){return Z.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return Z.sibling(t.firstChild)},contents:function(t){return t.contentDocument||Z.merge([],t.childNodes)}},function(t,e){Z.fn[t]=function(n,i){var o=Z.map(this,e,n);return"Until"!==t.slice(-5)&&(i=n),i&&"string"==typeof i&&(o=Z.filter(i,o)),this.length>1&&(ht[t]||Z.unique(o),dt.test(t)&&o.reverse()),this.pushStack(o)}});var pt=/\S+/g,ft={};Z.Callbacks=function(t){t="string"==typeof t?ft[t]||r(t):Z.extend({},t);var e,n,i,o,s,a,u=[],l=!t.once&&[],c=function(r){for(e=t.memory&&r,n=!0,a=o||0,o=0,s=u.length,i=!0;u&&s>a;a++)if(u[a].apply(r[0],r[1])===!1&&t.stopOnFalse){e=!1;break}i=!1,u&&(l?l.length&&c(l.shift()):e?u=[]:d.disable())},d={add:function(){if(u){var n=u.length;!function r(e){Z.each(e,function(e,n){var i=Z.type(n);"function"===i?t.unique&&d.has(n)||u.push(n):n&&n.length&&"string"!==i&&r(n)})}(arguments),i?s=u.length:e&&(o=n,c(e))}return this},remove:function(){return u&&Z.each(arguments,function(t,e){for(var n;(n=Z.inArray(e,u,n))>-1;)u.splice(n,1),i&&(s>=n&&s--,a>=n&&a--)}),this},has:function(t){return t?Z.inArray(t,u)>-1:!(!u||!u.length)},empty:function(){return u=[],s=0,this},disable:function(){return u=l=e=void 0,this},disabled:function(){return!u},lock:function(){return l=void 0,e||d.disable(),this},locked:function(){return!l},fireWith:function(t,e){return!u||n&&!l||(e=e||[],e=[t,e.slice?e.slice():e],i?l.push(e):c(e)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!n}};return d},Z.extend({Deferred:function(t){var e=[["resolve","done",Z.Callbacks("once memory"),"resolved"],["reject","fail",Z.Callbacks("once memory"),"rejected"],["notify","progress",Z.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var t=arguments;return Z.Deferred(function(n){Z.each(e,function(e,r){var s=Z.isFunction(t[e])&&t[e];o[r[1]](function(){var t=s&&s.apply(this,arguments);t&&Z.isFunction(t.promise)?t.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[r[0]+"With"](this===i?n.promise():this,s?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?Z.extend(t,i):i}},o={};return i.pipe=i.then,Z.each(e,function(t,r){var s=r[2],a=r[3];i[r[1]]=s.add,a&&s.add(function(){n=a},e[1^t][2].disable,e[2][2].lock),o[r[0]]=function(){return o[r[0]+"With"](this===o?i:this,arguments),this},o[r[0]+"With"]=s.fireWith}),i.promise(o),t&&t.call(o,o),o},when:function(t){var e,n,i,o=0,r=H.call(arguments),s=r.length,a=1!==s||t&&Z.isFunction(t.promise)?s:0,u=1===a?t:Z.Deferred(),l=function(t,n,i){return function(o){n[t]=this,i[t]=arguments.length>1?H.call(arguments):o,i===e?u.notifyWith(n,i):--a||u.resolveWith(n,i)}};if(s>1)for(e=new Array(s),n=new Array(s),i=new Array(s);s>o;o++)r[o]&&Z.isFunction(r[o].promise)?r[o].promise().done(l(o,i,r)).fail(u.reject).progress(l(o,n,e)):--a;return a||u.resolveWith(i,r),u.promise()}});var mt;Z.fn.ready=function(t){return Z.ready.promise().done(t),this},Z.extend({isReady:!1,readyWait:1,holdReady:function(t){t?Z.readyWait++:Z.ready(!0)},ready:function(t){(t===!0?--Z.readyWait:Z.isReady)||(Z.isReady=!0,t!==!0&&--Z.readyWait>0||(mt.resolveWith(J,[Z]),Z.fn.triggerHandler&&(Z(J).triggerHandler("ready"),Z(J).off("ready"))))}}),Z.ready.promise=function(e){return mt||(mt=Z.Deferred(),"complete"===J.readyState?setTimeout(Z.ready):(J.addEventListener("DOMContentLoaded",s,!1),t.addEventListener("load",s,!1))),mt.promise(e)},Z.ready.promise();var gt=Z.access=function(t,e,n,i,o,r,s){var a=0,u=t.length,l=null==n;if("object"===Z.type(n)){o=!0;for(a in n)Z.access(t,e,a,n[a],!0,r,s)}else if(void 0!==i&&(o=!0,Z.isFunction(i)||(s=!0),l&&(s?(e.call(t,i),e=null):(l=e,e=function(t,e,n){return l.call(Z(t),n)})),e))for(;u>a;a++)e(t[a],n,s?i:i.call(t[a],a,e(t[a],n)));return o?t:l?e.call(t):u?e(t[0],n):r};Z.acceptData=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType},a.uid=1,a.accepts=Z.acceptData,a.prototype={key:function(t){if(!a.accepts(t))return 0;var e={},n=t[this.expando];if(!n){n=a.uid++;try{e[this.expando]={value:n},Object.defineProperties(t,e)}catch(i){e[this.expando]=n,Z.extend(t,e)}}return this.cache[n]||(this.cache[n]={}),n},set:function(t,e,n){var i,o=this.key(t),r=this.cache[o];if("string"==typeof e)r[e]=n;else if(Z.isEmptyObject(r))Z.extend(this.cache[o],e);else for(i in e)r[i]=e[i];return r},get:function(t,e){var n=this.cache[this.key(t)];return void 0===e?n:n[e]},access:function(t,e,n){var i;return void 0===e||e&&"string"==typeof e&&void 0===n?(i=this.get(t,e),void 0!==i?i:this.get(t,Z.camelCase(e))):(this.set(t,e,n),void 0!==n?n:e)},remove:function(t,e){var n,i,o,r=this.key(t),s=this.cache[r];if(void 0===e)this.cache[r]={};else{Z.isArray(e)?i=e.concat(e.map(Z.camelCase)):(o=Z.camelCase(e),e in s?i=[e,o]:(i=o,i=i in s?[i]:i.match(pt)||[])),n=i.length;for(;n--;)delete s[i[n]]}},hasData:function(t){return!Z.isEmptyObject(this.cache[t[this.expando]]||{})},discard:function(t){t[this.expando]&&delete this.cache[t[this.expando]]}};var bt=new a,_t=new a,yt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,vt=/([A-Z])/g;Z.extend({hasData:function(t){return _t.hasData(t)||bt.hasData(t)},data:function(t,e,n){return _t.access(t,e,n)},removeData:function(t,e){_t.remove(t,e)},_data:function(t,e,n){return bt.access(t,e,n)},_removeData:function(t,e){bt.remove(t,e)}}),Z.fn.extend({data:function(t,e){var n,i,o,r=this[0],s=r&&r.attributes;if(void 0===t){if(this.length&&(o=_t.get(r),1===r.nodeType&&!bt.get(r,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&(i=s[n].name,0===i.indexOf("data-")&&(i=Z.camelCase(i.slice(5)),u(r,i,o[i])));bt.set(r,"hasDataAttrs",!0)}return o}return"object"==typeof t?this.each(function(){_t.set(this,t)}):gt(this,function(e){var n,i=Z.camelCase(t);if(r&&void 0===e){if(n=_t.get(r,t),void 0!==n)return n;if(n=_t.get(r,i),void 0!==n)return n;if(n=u(r,i,void 0),void 0!==n)return n}else this.each(function(){var n=_t.get(this,i);_t.set(this,i,e),-1!==t.indexOf("-")&&void 0!==n&&_t.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){_t.remove(this,t)})}}),Z.extend({queue:function(t,e,n){var i;return t?(e=(e||"fx")+"queue",i=bt.get(t,e),n&&(!i||Z.isArray(n)?i=bt.access(t,e,Z.makeArray(n)):i.push(n)),i||[]):void 0},dequeue:function(t,e){e=e||"fx";var n=Z.queue(t,e),i=n.length,o=n.shift(),r=Z._queueHooks(t,e),s=function(){Z.dequeue(t,e)};"inprogress"===o&&(o=n.shift(),i--),o&&("fx"===e&&n.unshift("inprogress"),delete r.stop,o.call(t,s,r)),!i&&r&&r.empty.fire()},_queueHooks:function(t,e){var n=e+"queueHooks";return bt.get(t,n)||bt.access(t,n,{empty:Z.Callbacks("once memory").add(function(){bt.remove(t,[e+"queue",n])})})}}),Z.fn.extend({queue:function(t,e){var n=2;return"string"!=typeof t&&(e=t,t="fx",n--),arguments.length<n?Z.queue(this[0],t):void 0===e?this:this.each(function(){var n=Z.queue(this,t,e);Z._queueHooks(this,t),"fx"===t&&"inprogress"!==n[0]&&Z.dequeue(this,t)})},dequeue:function(t){return this.each(function(){Z.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var n,i=1,o=Z.Deferred(),r=this,s=this.length,a=function(){--i||o.resolveWith(r,[r])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";s--;)n=bt.get(r[s],t+"queueHooks"),n&&n.empty&&(i++,n.empty.add(a));return a(),o.promise(e)}});var wt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,kt=["Top","Right","Bottom","Left"],Ct=function(t,e){return t=e||t,"none"===Z.css(t,"display")||!Z.contains(t.ownerDocument,t)},St=/^(?:checkbox|radio)$/i;!function(){var t=J.createDocumentFragment(),e=t.appendChild(J.createElement("div")),n=J.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),e.appendChild(n),K.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",K.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var xt="undefined";K.focusinBubbles="onfocusin"in t;var Et=/^key/,Pt=/^(?:mouse|pointer|contextmenu)|click/,Tt=/^(?:focusinfocus|focusoutblur)$/,It=/^([^.]*)(?:\.(.+)|)$/;Z.event={global:{},add:function(t,e,n,i,o){var r,s,a,u,l,c,d,h,p,f,m,g=bt.get(t);if(g)for(n.handler&&(r=n,n=r.handler,o=r.selector),n.guid||(n.guid=Z.guid++),(u=g.events)||(u=g.events={}),(s=g.handle)||(s=g.handle=function(e){return typeof Z!==xt&&Z.event.triggered!==e.type?Z.event.dispatch.apply(t,arguments):void 0}),e=(e||"").match(pt)||[""],l=e.length;l--;)a=It.exec(e[l])||[],p=m=a[1],f=(a[2]||"").split(".").sort(),p&&(d=Z.event.special[p]||{},p=(o?d.delegateType:d.bindType)||p,d=Z.event.special[p]||{},c=Z.extend({type:p,origType:m,data:i,handler:n,guid:n.guid,selector:o,needsContext:o&&Z.expr.match.needsContext.test(o),namespace:f.join(".")},r),(h=u[p])||(h=u[p]=[],h.delegateCount=0,d.setup&&d.setup.call(t,i,f,s)!==!1||t.addEventListener&&t.addEventListener(p,s,!1)),d.add&&(d.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),o?h.splice(h.delegateCount++,0,c):h.push(c),Z.event.global[p]=!0)},remove:function(t,e,n,i,o){var r,s,a,u,l,c,d,h,p,f,m,g=bt.hasData(t)&&bt.get(t);if(g&&(u=g.events)){for(e=(e||"").match(pt)||[""],l=e.length;l--;)if(a=It.exec(e[l])||[],p=m=a[1],f=(a[2]||"").split(".").sort(),p){for(d=Z.event.special[p]||{},p=(i?d.delegateType:d.bindType)||p,h=u[p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=r=h.length;r--;)c=h[r],!o&&m!==c.origType||n&&n.guid!==c.guid||a&&!a.test(c.namespace)||i&&i!==c.selector&&("**"!==i||!c.selector)||(h.splice(r,1),c.selector&&h.delegateCount--,d.remove&&d.remove.call(t,c));s&&!h.length&&(d.teardown&&d.teardown.call(t,f,g.handle)!==!1||Z.removeEvent(t,p,g.handle),delete u[p])}else for(p in u)Z.event.remove(t,p+e[l],n,i,!0);Z.isEmptyObject(u)&&(delete g.handle,bt.remove(t,"events"))}},trigger:function(e,n,i,o){var r,s,a,u,l,c,d,h=[i||J],p=G.call(e,"type")?e.type:e,f=G.call(e,"namespace")?e.namespace.split("."):[];if(s=a=i=i||J,3!==i.nodeType&&8!==i.nodeType&&!Tt.test(p+Z.event.triggered)&&(p.indexOf(".")>=0&&(f=p.split("."),p=f.shift(),f.sort()),l=p.indexOf(":")<0&&"on"+p,e=e[Z.expando]?e:new Z.Event(p,"object"==typeof e&&e),e.isTrigger=o?2:3,e.namespace=f.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=i),n=null==n?[e]:Z.makeArray(n,[e]),d=Z.event.special[p]||{},o||!d.trigger||d.trigger.apply(i,n)!==!1)){if(!o&&!d.noBubble&&!Z.isWindow(i)){for(u=d.delegateType||p,Tt.test(u+p)||(s=s.parentNode);s;s=s.parentNode)h.push(s),a=s;a===(i.ownerDocument||J)&&h.push(a.defaultView||a.parentWindow||t)}for(r=0;(s=h[r++])&&!e.isPropagationStopped();)e.type=r>1?u:d.bindType||p,c=(bt.get(s,"events")||{})[e.type]&&bt.get(s,"handle"),c&&c.apply(s,n),c=l&&s[l],c&&c.apply&&Z.acceptData(s)&&(e.result=c.apply(s,n),e.result===!1&&e.preventDefault());return e.type=p,o||e.isDefaultPrevented()||d._default&&d._default.apply(h.pop(),n)!==!1||!Z.acceptData(i)||l&&Z.isFunction(i[p])&&!Z.isWindow(i)&&(a=i[l],a&&(i[l]=null),Z.event.triggered=p,i[p](),Z.event.triggered=void 0,a&&(i[l]=a)),e.result}},dispatch:function(t){t=Z.event.fix(t);var e,n,i,o,r,s=[],a=H.call(arguments),u=(bt.get(this,"events")||{})[t.type]||[],l=Z.event.special[t.type]||{};if(a[0]=t,t.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,t)!==!1){for(s=Z.event.handlers.call(this,t,u),e=0;(o=s[e++])&&!t.isPropagationStopped();)for(t.currentTarget=o.elem,n=0;(r=o.handlers[n++])&&!t.isImmediatePropagationStopped();)t.namespace_re&&!t.namespace_re.test(r.namespace)||(t.handleObj=r,t.data=r.data,i=((Z.event.special[r.origType]||{}).handle||r.handler).apply(o.elem,a),void 0!==i&&(t.result=i)===!1&&(t.preventDefault(),t.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,t),t.result}},handlers:function(t,e){var n,i,o,r,s=[],a=e.delegateCount,u=t.target;if(a&&u.nodeType&&(!t.button||"click"!==t.type))for(;u!==this;u=u.parentNode||this)if(u.disabled!==!0||"click"!==t.type){for(i=[],n=0;a>n;n++)r=e[n],o=r.selector+" ",void 0===i[o]&&(i[o]=r.needsContext?Z(o,this).index(u)>=0:Z.find(o,this,null,[u]).length),i[o]&&i.push(r);i.length&&s.push({elem:u,handlers:i})}return a<e.length&&s.push({elem:this,handlers:e.slice(a)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var n,i,o,r=e.button;return null==t.pageX&&null!=e.clientX&&(n=t.target.ownerDocument||J,i=n.documentElement,o=n.body,t.pageX=e.clientX+(i&&i.scrollLeft||o&&o.scrollLeft||0)-(i&&i.clientLeft||o&&o.clientLeft||0),t.pageY=e.clientY+(i&&i.scrollTop||o&&o.scrollTop||0)-(i&&i.clientTop||o&&o.clientTop||0)),t.which||void 0===r||(t.which=1&r?1:2&r?3:4&r?2:0),t}},fix:function(t){if(t[Z.expando])return t;var e,n,i,o=t.type,r=t,s=this.fixHooks[o];for(s||(this.fixHooks[o]=s=Pt.test(o)?this.mouseHooks:Et.test(o)?this.keyHooks:{}),i=s.props?this.props.concat(s.props):this.props,t=new Z.Event(r),e=i.length;e--;)n=i[e],t[n]=r[n];return t.target||(t.target=J),3===t.target.nodeType&&(t.target=t.target.parentNode),s.filter?s.filter(t,r):t},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==d()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===d()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&Z.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(t){return Z.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,n,i){var o=Z.extend(new Z.Event,n,{type:t,isSimulated:!0,originalEvent:{}});i?Z.event.trigger(o,null,e):Z.event.dispatch.call(e,o),o.isDefaultPrevented()&&n.preventDefault()}},Z.removeEvent=function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n,!1)},Z.Event=function(t,e){return this instanceof Z.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&t.returnValue===!1?l:c):this.type=t,e&&Z.extend(this,e),this.timeStamp=t&&t.timeStamp||Z.now(),void(this[Z.expando]=!0)):new Z.Event(t,e)},Z.Event.prototype={isDefaultPrevented:c,isPropagationStopped:c,isImmediatePropagationStopped:c,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=l,t&&t.preventDefault&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=l,t&&t.stopPropagation&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=l,t&&t.stopImmediatePropagation&&t.stopImmediatePropagation(),this.stopPropagation()}},Z.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){Z.event.special[t]={delegateType:e,bindType:e,handle:function(t){var n,i=this,o=t.relatedTarget,r=t.handleObj;return o&&(o===i||Z.contains(i,o))||(t.type=r.origType,n=r.handler.apply(this,arguments),t.type=e),n}}}),K.focusinBubbles||Z.each({focus:"focusin",blur:"focusout"},function(t,e){var n=function(t){Z.event.simulate(e,t.target,Z.event.fix(t),!0)};Z.event.special[e]={setup:function(){var i=this.ownerDocument||this,o=bt.access(i,e);o||i.addEventListener(t,n,!0),bt.access(i,e,(o||0)+1)},teardown:function(){var i=this.ownerDocument||this,o=bt.access(i,e)-1;o?bt.access(i,e,o):(i.removeEventListener(t,n,!0),bt.remove(i,e))}}}),Z.fn.extend({on:function(t,e,n,i,o){var r,s;if("object"==typeof t){"string"!=typeof e&&(n=n||e,e=void 0);for(s in t)this.on(s,e,n,t[s],o);return this}if(null==n&&null==i?(i=e,n=e=void 0):null==i&&("string"==typeof e?(i=n,n=void 0):(i=n,n=e,e=void 0)),i===!1)i=c;else if(!i)return this;return 1===o&&(r=i,i=function(t){return Z().off(t),r.apply(this,arguments)},i.guid=r.guid||(r.guid=Z.guid++)),this.each(function(){Z.event.add(this,t,i,n,e)})},one:function(t,e,n,i){return this.on(t,e,n,i,1)},off:function(t,e,n){var i,o;if(t&&t.preventDefault&&t.handleObj)return i=t.handleObj,Z(t.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof t){for(o in t)this.off(o,e,t[o]);return this}return e!==!1&&"function"!=typeof e||(n=e,e=void 0),n===!1&&(n=c),this.each(function(){Z.event.remove(this,t,n,e)})},trigger:function(t,e){return this.each(function(){Z.event.trigger(t,e,this)})},triggerHandler:function(t,e){var n=this[0];return n?Z.event.trigger(t,e,n,!0):void 0}});var At=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Bt=/<([\w:]+)/,Ot=/<|&#?\w+;/,Mt=/<(?:script|style|link)/i,$t=/checked\s*(?:[^=]|=\s*.checked.)/i,Dt=/^$|\/(?:java|ecma)script/i,Rt=/^true\/(.*)/,Lt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ft={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ft.optgroup=Ft.option,Ft.tbody=Ft.tfoot=Ft.colgroup=Ft.caption=Ft.thead,Ft.th=Ft.td,Z.extend({clone:function(t,e,n){var i,o,r,s,a=t.cloneNode(!0),u=Z.contains(t.ownerDocument,t);if(!(K.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||Z.isXMLDoc(t)))for(s=b(a),r=b(t),i=0,o=r.length;o>i;i++)_(r[i],s[i]);if(e)if(n)for(r=r||b(t),s=s||b(a),i=0,o=r.length;o>i;i++)g(r[i],s[i]);else g(t,a);return s=b(a,"script"),s.length>0&&m(s,!u&&b(t,"script")),a},buildFragment:function(t,e,n,i){for(var o,r,s,a,u,l,c=e.createDocumentFragment(),d=[],h=0,p=t.length;p>h;h++)if(o=t[h],o||0===o)if("object"===Z.type(o))Z.merge(d,o.nodeType?[o]:o);else if(Ot.test(o)){for(r=r||c.appendChild(e.createElement("div")),s=(Bt.exec(o)||["",""])[1].toLowerCase(),a=Ft[s]||Ft._default,r.innerHTML=a[1]+o.replace(At,"<$1></$2>")+a[2],l=a[0];l--;)r=r.lastChild;Z.merge(d,r.childNodes),r=c.firstChild,r.textContent=""}else d.push(e.createTextNode(o));for(c.textContent="",h=0;o=d[h++];)if((!i||-1===Z.inArray(o,i))&&(u=Z.contains(o.ownerDocument,o),r=b(c.appendChild(o),"script"),u&&m(r),n))for(l=0;o=r[l++];)Dt.test(o.type||"")&&n.push(o);return c},cleanData:function(t){for(var e,n,i,o,r=Z.event.special,s=0;void 0!==(n=t[s]);s++){if(Z.acceptData(n)&&(o=n[bt.expando],o&&(e=bt.cache[o]))){if(e.events)for(i in e.events)r[i]?Z.event.remove(n,i):Z.removeEvent(n,i,e.handle);bt.cache[o]&&delete bt.cache[o]}delete _t.cache[n[_t.expando]]}}}),Z.fn.extend({text:function(t){return gt(this,function(t){return void 0===t?Z.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=h(this,t);e.appendChild(t)}})},prepend:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=h(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},remove:function(t,e){for(var n,i=t?Z.filter(t,this):this,o=0;null!=(n=i[o]);o++)e||1!==n.nodeType||Z.cleanData(b(n)),n.parentNode&&(e&&Z.contains(n.ownerDocument,n)&&m(b(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(Z.cleanData(b(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return Z.clone(this,t,e)})},html:function(t){return gt(this,function(t){var e=this[0]||{},n=0,i=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Mt.test(t)&&!Ft[(Bt.exec(t)||["",""])[1].toLowerCase()]){t=t.replace(At,"<$1></$2>");try{for(;i>n;n++)e=this[n]||{},1===e.nodeType&&(Z.cleanData(b(e,!1)),e.innerHTML=t);e=0}catch(o){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=arguments[0];return this.domManip(arguments,function(e){t=this.parentNode,Z.cleanData(b(this)),t&&t.replaceChild(e,this)}),t&&(t.length||t.nodeType)?this:this.remove()},detach:function(t){return this.remove(t,!0)},domManip:function(t,e){t=z.apply([],t);var n,i,o,r,s,a,u=0,l=this.length,c=this,d=l-1,h=t[0],m=Z.isFunction(h);if(m||l>1&&"string"==typeof h&&!K.checkClone&&$t.test(h))return this.each(function(n){var i=c.eq(n);m&&(t[0]=h.call(this,n,i.html())),i.domManip(t,e)});if(l&&(n=Z.buildFragment(t,this[0].ownerDocument,!1,this),i=n.firstChild,1===n.childNodes.length&&(n=i),i)){for(o=Z.map(b(n,"script"),p),r=o.length;l>u;u++)s=n,u!==d&&(s=Z.clone(s,!0,!0),r&&Z.merge(o,b(s,"script"))),e.call(this[u],s,u);if(r)for(a=o[o.length-1].ownerDocument,Z.map(o,f),u=0;r>u;u++)s=o[u],Dt.test(s.type||"")&&!bt.access(s,"globalEval")&&Z.contains(a,s)&&(s.src?Z._evalUrl&&Z._evalUrl(s.src):Z.globalEval(s.textContent.replace(Lt,"")))}return this}}),Z.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){Z.fn[t]=function(t){for(var n,i=[],o=Z(t),r=o.length-1,s=0;r>=s;s++)n=s===r?this:this.clone(!0),
Z(o[s])[e](n),q.apply(i,n.get());return this.pushStack(i)}});var Nt,jt={},Ut=/^margin/,Vt=new RegExp("^("+wt+")(?!px)[a-z%]+$","i"),Ht=function(e){return e.ownerDocument.defaultView.opener?e.ownerDocument.defaultView.getComputedStyle(e,null):t.getComputedStyle(e,null)};!function(){function e(){s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",s.innerHTML="",o.appendChild(r);var e=t.getComputedStyle(s,null);n="1%"!==e.top,i="4px"===e.width,o.removeChild(r)}var n,i,o=J.documentElement,r=J.createElement("div"),s=J.createElement("div");s.style&&(s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",K.clearCloneStyle="content-box"===s.style.backgroundClip,r.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",r.appendChild(s),t.getComputedStyle&&Z.extend(K,{pixelPosition:function(){return e(),n},boxSizingReliable:function(){return null==i&&e(),i},reliableMarginRight:function(){var e,n=s.appendChild(J.createElement("div"));return n.style.cssText=s.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",n.style.marginRight=n.style.width="0",s.style.width="1px",o.appendChild(r),e=!parseFloat(t.getComputedStyle(n,null).marginRight),o.removeChild(r),s.removeChild(n),e}}))}(),Z.swap=function(t,e,n,i){var o,r,s={};for(r in e)s[r]=t.style[r],t.style[r]=e[r];o=n.apply(t,i||[]);for(r in e)t.style[r]=s[r];return o};var zt=/^(none|table(?!-c[ea]).+)/,qt=new RegExp("^("+wt+")(.*)$","i"),Wt=new RegExp("^([+-])=("+wt+")","i"),Qt={position:"absolute",visibility:"hidden",display:"block"},Yt={letterSpacing:"0",fontWeight:"400"},Gt=["Webkit","O","Moz","ms"];Z.extend({cssHooks:{opacity:{get:function(t,e){if(e){var n=w(t,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(t,e,n,i){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var o,r,s,a=Z.camelCase(e),u=t.style;return e=Z.cssProps[a]||(Z.cssProps[a]=C(u,a)),s=Z.cssHooks[e]||Z.cssHooks[a],void 0===n?s&&"get"in s&&void 0!==(o=s.get(t,!1,i))?o:u[e]:(r=typeof n,"string"===r&&(o=Wt.exec(n))&&(n=(o[1]+1)*o[2]+parseFloat(Z.css(t,e)),r="number"),null!=n&&n===n&&("number"!==r||Z.cssNumber[a]||(n+="px"),K.clearCloneStyle||""!==n||0!==e.indexOf("background")||(u[e]="inherit"),s&&"set"in s&&void 0===(n=s.set(t,n,i))||(u[e]=n)),void 0)}},css:function(t,e,n,i){var o,r,s,a=Z.camelCase(e);return e=Z.cssProps[a]||(Z.cssProps[a]=C(t.style,a)),s=Z.cssHooks[e]||Z.cssHooks[a],s&&"get"in s&&(o=s.get(t,!0,n)),void 0===o&&(o=w(t,e,i)),"normal"===o&&e in Yt&&(o=Yt[e]),""===n||n?(r=parseFloat(o),n===!0||Z.isNumeric(r)?r||0:o):o}}),Z.each(["height","width"],function(t,e){Z.cssHooks[e]={get:function(t,n,i){return n?zt.test(Z.css(t,"display"))&&0===t.offsetWidth?Z.swap(t,Qt,function(){return E(t,e,i)}):E(t,e,i):void 0},set:function(t,n,i){var o=i&&Ht(t);return S(t,n,i?x(t,e,i,"border-box"===Z.css(t,"boxSizing",!1,o),o):0)}}}),Z.cssHooks.marginRight=k(K.reliableMarginRight,function(t,e){return e?Z.swap(t,{display:"inline-block"},w,[t,"marginRight"]):void 0}),Z.each({margin:"",padding:"",border:"Width"},function(t,e){Z.cssHooks[t+e]={expand:function(n){for(var i=0,o={},r="string"==typeof n?n.split(" "):[n];4>i;i++)o[t+kt[i]+e]=r[i]||r[i-2]||r[0];return o}},Ut.test(t)||(Z.cssHooks[t+e].set=S)}),Z.fn.extend({css:function(t,e){return gt(this,function(t,e,n){var i,o,r={},s=0;if(Z.isArray(e)){for(i=Ht(t),o=e.length;o>s;s++)r[e[s]]=Z.css(t,e[s],!1,i);return r}return void 0!==n?Z.style(t,e,n):Z.css(t,e)},t,e,arguments.length>1)},show:function(){return P(this,!0)},hide:function(){return P(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){Ct(this)?Z(this).show():Z(this).hide()})}}),Z.Tween=T,T.prototype={constructor:T,init:function(t,e,n,i,o,r){this.elem=t,this.prop=n,this.easing=o||"swing",this.options=e,this.start=this.now=this.cur(),this.end=i,this.unit=r||(Z.cssNumber[n]?"":"px")},cur:function(){var t=T.propHooks[this.prop];return t&&t.get?t.get(this):T.propHooks._default.get(this)},run:function(t){var e,n=T.propHooks[this.prop];return this.options.duration?this.pos=e=Z.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):T.propHooks._default.set(this),this}},T.prototype.init.prototype=T.prototype,T.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=Z.css(t.elem,t.prop,""),e&&"auto"!==e?e:0):t.elem[t.prop]},set:function(t){Z.fx.step[t.prop]?Z.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[Z.cssProps[t.prop]]||Z.cssHooks[t.prop])?Z.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},T.propHooks.scrollTop=T.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},Z.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},Z.fx=T.prototype.init,Z.fx.step={};var Kt,Jt,Xt=/^(?:toggle|show|hide)$/,Zt=new RegExp("^(?:([+-])=|)("+wt+")([a-z%]*)$","i"),te=/queueHooks$/,ee=[O],ne={"*":[function(t,e){var n=this.createTween(t,e),i=n.cur(),o=Zt.exec(e),r=o&&o[3]||(Z.cssNumber[t]?"":"px"),s=(Z.cssNumber[t]||"px"!==r&&+i)&&Zt.exec(Z.css(n.elem,t)),a=1,u=20;if(s&&s[3]!==r){r=r||s[3],o=o||[],s=+i||1;do a=a||".5",s/=a,Z.style(n.elem,t,s+r);while(a!==(a=n.cur()/i)&&1!==a&&--u)}return o&&(s=n.start=+s||+i||0,n.unit=r,n.end=o[1]?s+(o[1]+1)*o[2]:+o[2]),n}]};Z.Animation=Z.extend($,{tweener:function(t,e){Z.isFunction(t)?(e=t,t=["*"]):t=t.split(" ");for(var n,i=0,o=t.length;o>i;i++)n=t[i],ne[n]=ne[n]||[],ne[n].unshift(e)},prefilter:function(t,e){e?ee.unshift(t):ee.push(t)}}),Z.speed=function(t,e,n){var i=t&&"object"==typeof t?Z.extend({},t):{complete:n||!n&&e||Z.isFunction(t)&&t,duration:t,easing:n&&e||e&&!Z.isFunction(e)&&e};return i.duration=Z.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in Z.fx.speeds?Z.fx.speeds[i.duration]:Z.fx.speeds._default,null!=i.queue&&i.queue!==!0||(i.queue="fx"),i.old=i.complete,i.complete=function(){Z.isFunction(i.old)&&i.old.call(this),i.queue&&Z.dequeue(this,i.queue)},i},Z.fn.extend({fadeTo:function(t,e,n,i){return this.filter(Ct).css("opacity",0).show().end().animate({opacity:e},t,n,i)},animate:function(t,e,n,i){var o=Z.isEmptyObject(t),r=Z.speed(e,n,i),s=function(){var e=$(this,Z.extend({},t),r);(o||bt.get(this,"finish"))&&e.stop(!0)};return s.finish=s,o||r.queue===!1?this.each(s):this.queue(r.queue,s)},stop:function(t,e,n){var i=function(t){var e=t.stop;delete t.stop,e(n)};return"string"!=typeof t&&(n=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,o=null!=t&&t+"queueHooks",r=Z.timers,s=bt.get(this);if(o)s[o]&&s[o].stop&&i(s[o]);else for(o in s)s[o]&&s[o].stop&&te.test(o)&&i(s[o]);for(o=r.length;o--;)r[o].elem!==this||null!=t&&r[o].queue!==t||(r[o].anim.stop(n),e=!1,r.splice(o,1));!e&&n||Z.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,n=bt.get(this),i=n[t+"queue"],o=n[t+"queueHooks"],r=Z.timers,s=i?i.length:0;for(n.finish=!0,Z.queue(this,t,[]),o&&o.stop&&o.stop.call(this,!0),e=r.length;e--;)r[e].elem===this&&r[e].queue===t&&(r[e].anim.stop(!0),r.splice(e,1));for(e=0;s>e;e++)i[e]&&i[e].finish&&i[e].finish.call(this);delete n.finish})}}),Z.each(["toggle","show","hide"],function(t,e){var n=Z.fn[e];Z.fn[e]=function(t,i,o){return null==t||"boolean"==typeof t?n.apply(this,arguments):this.animate(A(e,!0),t,i,o)}}),Z.each({slideDown:A("show"),slideUp:A("hide"),slideToggle:A("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){Z.fn[t]=function(t,n,i){return this.animate(e,t,n,i)}}),Z.timers=[],Z.fx.tick=function(){var t,e=0,n=Z.timers;for(Kt=Z.now();e<n.length;e++)t=n[e],t()||n[e]!==t||n.splice(e--,1);n.length||Z.fx.stop(),Kt=void 0},Z.fx.timer=function(t){Z.timers.push(t),t()?Z.fx.start():Z.timers.pop()},Z.fx.interval=13,Z.fx.start=function(){Jt||(Jt=setInterval(Z.fx.tick,Z.fx.interval))},Z.fx.stop=function(){clearInterval(Jt),Jt=null},Z.fx.speeds={slow:600,fast:200,_default:400},Z.fn.delay=function(t,e){return t=Z.fx?Z.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,n){var i=setTimeout(e,t);n.stop=function(){clearTimeout(i)}})},function(){var t=J.createElement("input"),e=J.createElement("select"),n=e.appendChild(J.createElement("option"));t.type="checkbox",K.checkOn=""!==t.value,K.optSelected=n.selected,e.disabled=!0,K.optDisabled=!n.disabled,t=J.createElement("input"),t.value="t",t.type="radio",K.radioValue="t"===t.value}();var ie,oe,re=Z.expr.attrHandle;Z.fn.extend({attr:function(t,e){return gt(this,Z.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){Z.removeAttr(this,t)})}}),Z.extend({attr:function(t,e,n){var i,o,r=t.nodeType;if(t&&3!==r&&8!==r&&2!==r)return typeof t.getAttribute===xt?Z.prop(t,e,n):(1===r&&Z.isXMLDoc(t)||(e=e.toLowerCase(),i=Z.attrHooks[e]||(Z.expr.match.bool.test(e)?oe:ie)),void 0===n?i&&"get"in i&&null!==(o=i.get(t,e))?o:(o=Z.find.attr(t,e),null==o?void 0:o):null!==n?i&&"set"in i&&void 0!==(o=i.set(t,n,e))?o:(t.setAttribute(e,n+""),n):void Z.removeAttr(t,e))},removeAttr:function(t,e){var n,i,o=0,r=e&&e.match(pt);if(r&&1===t.nodeType)for(;n=r[o++];)i=Z.propFix[n]||n,Z.expr.match.bool.test(n)&&(t[i]=!1),t.removeAttribute(n)},attrHooks:{type:{set:function(t,e){if(!K.radioValue&&"radio"===e&&Z.nodeName(t,"input")){var n=t.value;return t.setAttribute("type",e),n&&(t.value=n),e}}}}}),oe={set:function(t,e,n){return e===!1?Z.removeAttr(t,n):t.setAttribute(n,n),n}},Z.each(Z.expr.match.bool.source.match(/\w+/g),function(t,e){var n=re[e]||Z.find.attr;re[e]=function(t,e,i){var o,r;return i||(r=re[e],re[e]=o,o=null!=n(t,e,i)?e.toLowerCase():null,re[e]=r),o}});var se=/^(?:input|select|textarea|button)$/i;Z.fn.extend({prop:function(t,e){return gt(this,Z.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[Z.propFix[t]||t]})}}),Z.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(t,e,n){var i,o,r,s=t.nodeType;if(t&&3!==s&&8!==s&&2!==s)return r=1!==s||!Z.isXMLDoc(t),r&&(e=Z.propFix[e]||e,o=Z.propHooks[e]),void 0!==n?o&&"set"in o&&void 0!==(i=o.set(t,n,e))?i:t[e]=n:o&&"get"in o&&null!==(i=o.get(t,e))?i:t[e]},propHooks:{tabIndex:{get:function(t){return t.hasAttribute("tabindex")||se.test(t.nodeName)||t.href?t.tabIndex:-1}}}}),K.optSelected||(Z.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null}}),Z.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){Z.propFix[this.toLowerCase()]=this});var ae=/[\t\r\n\f]/g;Z.fn.extend({addClass:function(t){var e,n,i,o,r,s,a="string"==typeof t&&t,u=0,l=this.length;if(Z.isFunction(t))return this.each(function(e){Z(this).addClass(t.call(this,e,this.className))});if(a)for(e=(t||"").match(pt)||[];l>u;u++)if(n=this[u],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(ae," "):" ")){for(r=0;o=e[r++];)i.indexOf(" "+o+" ")<0&&(i+=o+" ");s=Z.trim(i),n.className!==s&&(n.className=s)}return this},removeClass:function(t){var e,n,i,o,r,s,a=0===arguments.length||"string"==typeof t&&t,u=0,l=this.length;if(Z.isFunction(t))return this.each(function(e){Z(this).removeClass(t.call(this,e,this.className))});if(a)for(e=(t||"").match(pt)||[];l>u;u++)if(n=this[u],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(ae," "):"")){for(r=0;o=e[r++];)for(;i.indexOf(" "+o+" ")>=0;)i=i.replace(" "+o+" "," ");s=t?Z.trim(i):"",n.className!==s&&(n.className=s)}return this},toggleClass:function(t,e){var n=typeof t;return"boolean"==typeof e&&"string"===n?e?this.addClass(t):this.removeClass(t):Z.isFunction(t)?this.each(function(n){Z(this).toggleClass(t.call(this,n,this.className,e),e)}):this.each(function(){if("string"===n)for(var e,i=0,o=Z(this),r=t.match(pt)||[];e=r[i++];)o.hasClass(e)?o.removeClass(e):o.addClass(e);else n!==xt&&"boolean"!==n||(this.className&&bt.set(this,"__className__",this.className),this.className=this.className||t===!1?"":bt.get(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",n=0,i=this.length;i>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(ae," ").indexOf(e)>=0)return!0;return!1}});var ue=/\r/g;Z.fn.extend({val:function(t){var e,n,i,o=this[0];{if(arguments.length)return i=Z.isFunction(t),this.each(function(n){var o;1===this.nodeType&&(o=i?t.call(this,n,Z(this).val()):t,null==o?o="":"number"==typeof o?o+="":Z.isArray(o)&&(o=Z.map(o,function(t){return null==t?"":t+""})),e=Z.valHooks[this.type]||Z.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,o,"value")||(this.value=o))});if(o)return e=Z.valHooks[o.type]||Z.valHooks[o.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(n=e.get(o,"value"))?n:(n=o.value,"string"==typeof n?n.replace(ue,""):null==n?"":n)}}}),Z.extend({valHooks:{option:{get:function(t){var e=Z.find.attr(t,"value");return null!=e?e:Z.trim(Z.text(t))}},select:{get:function(t){for(var e,n,i=t.options,o=t.selectedIndex,r="select-one"===t.type||0>o,s=r?null:[],a=r?o+1:i.length,u=0>o?a:r?o:0;a>u;u++)if(n=i[u],(n.selected||u===o)&&(K.optDisabled?!n.disabled:null===n.getAttribute("disabled"))&&(!n.parentNode.disabled||!Z.nodeName(n.parentNode,"optgroup"))){if(e=Z(n).val(),r)return e;s.push(e)}return s},set:function(t,e){for(var n,i,o=t.options,r=Z.makeArray(e),s=o.length;s--;)i=o[s],(i.selected=Z.inArray(i.value,r)>=0)&&(n=!0);return n||(t.selectedIndex=-1),r}}}}),Z.each(["radio","checkbox"],function(){Z.valHooks[this]={set:function(t,e){return Z.isArray(e)?t.checked=Z.inArray(Z(t).val(),e)>=0:void 0}},K.checkOn||(Z.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}),Z.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){Z.fn[e]=function(t,n){return arguments.length>0?this.on(e,null,t,n):this.trigger(e)}}),Z.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)},bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,n,i){return this.on(e,t,n,i)},undelegate:function(t,e,n){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",n)}});var le=Z.now(),ce=/\?/;Z.parseJSON=function(t){return JSON.parse(t+"")},Z.parseXML=function(t){var e,n;if(!t||"string"!=typeof t)return null;try{n=new DOMParser,e=n.parseFromString(t,"text/xml")}catch(i){e=void 0}return e&&!e.getElementsByTagName("parsererror").length||Z.error("Invalid XML: "+t),e};var de=/#.*$/,he=/([?&])_=[^&]*/,pe=/^(.*?):[ \t]*([^\r\n]*)$/gm,fe=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,me=/^(?:GET|HEAD)$/,ge=/^\/\//,be=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,_e={},ye={},ve="*/".concat("*"),we=t.location.href,ke=be.exec(we.toLowerCase())||[];Z.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:we,type:"GET",isLocal:fe.test(ke[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ve,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":Z.parseJSON,"text xml":Z.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?L(L(t,Z.ajaxSettings),e):L(Z.ajaxSettings,t)},ajaxPrefilter:D(_e),ajaxTransport:D(ye),ajax:function(t,e){function n(t,e,n,s){var u,c,b,_,v,k=e;2!==y&&(y=2,a&&clearTimeout(a),i=void 0,r=s||"",w.readyState=t>0?4:0,u=t>=200&&300>t||304===t,n&&(_=F(d,w,n)),_=N(d,_,w,u),u?(d.ifModified&&(v=w.getResponseHeader("Last-Modified"),v&&(Z.lastModified[o]=v),v=w.getResponseHeader("etag"),v&&(Z.etag[o]=v)),204===t||"HEAD"===d.type?k="nocontent":304===t?k="notmodified":(k=_.state,c=_.data,b=_.error,u=!b)):(b=k,!t&&k||(k="error",0>t&&(t=0))),w.status=t,w.statusText=(e||k)+"",u?f.resolveWith(h,[c,k,w]):f.rejectWith(h,[w,k,b]),w.statusCode(g),g=void 0,l&&p.trigger(u?"ajaxSuccess":"ajaxError",[w,d,u?c:b]),m.fireWith(h,[w,k]),l&&(p.trigger("ajaxComplete",[w,d]),--Z.active||Z.event.trigger("ajaxStop")))}"object"==typeof t&&(e=t,t=void 0),e=e||{};var i,o,r,s,a,u,l,c,d=Z.ajaxSetup({},e),h=d.context||d,p=d.context&&(h.nodeType||h.jquery)?Z(h):Z.event,f=Z.Deferred(),m=Z.Callbacks("once memory"),g=d.statusCode||{},b={},_={},y=0,v="canceled",w={readyState:0,getResponseHeader:function(t){var e;if(2===y){if(!s)for(s={};e=pe.exec(r);)s[e[1].toLowerCase()]=e[2];e=s[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===y?r:null},setRequestHeader:function(t,e){var n=t.toLowerCase();return y||(t=_[n]=_[n]||t,b[t]=e),this},overrideMimeType:function(t){return y||(d.mimeType=t),this},statusCode:function(t){var e;if(t)if(2>y)for(e in t)g[e]=[g[e],t[e]];else w.always(t[w.status]);return this},abort:function(t){var e=t||v;return i&&i.abort(e),n(0,e),this}};if(f.promise(w).complete=m.add,w.success=w.done,w.error=w.fail,d.url=((t||d.url||we)+"").replace(de,"").replace(ge,ke[1]+"//"),d.type=e.method||e.type||d.method||d.type,d.dataTypes=Z.trim(d.dataType||"*").toLowerCase().match(pt)||[""],null==d.crossDomain&&(u=be.exec(d.url.toLowerCase()),d.crossDomain=!(!u||u[1]===ke[1]&&u[2]===ke[2]&&(u[3]||("http:"===u[1]?"80":"443"))===(ke[3]||("http:"===ke[1]?"80":"443")))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=Z.param(d.data,d.traditional)),R(_e,d,e,w),2===y)return w;l=Z.event&&d.global,l&&0===Z.active++&&Z.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!me.test(d.type),o=d.url,d.hasContent||(d.data&&(o=d.url+=(ce.test(o)?"&":"?")+d.data,delete d.data),d.cache===!1&&(d.url=he.test(o)?o.replace(he,"$1_="+le++):o+(ce.test(o)?"&":"?")+"_="+le++)),d.ifModified&&(Z.lastModified[o]&&w.setRequestHeader("If-Modified-Since",Z.lastModified[o]),Z.etag[o]&&w.setRequestHeader("If-None-Match",Z.etag[o])),(d.data&&d.hasContent&&d.contentType!==!1||e.contentType)&&w.setRequestHeader("Content-Type",d.contentType),w.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+ve+"; q=0.01":""):d.accepts["*"]);for(c in d.headers)w.setRequestHeader(c,d.headers[c]);if(d.beforeSend&&(d.beforeSend.call(h,w,d)===!1||2===y))return w.abort();v="abort";for(c in{success:1,error:1,complete:1})w[c](d[c]);if(i=R(ye,d,e,w)){w.readyState=1,l&&p.trigger("ajaxSend",[w,d]),d.async&&d.timeout>0&&(a=setTimeout(function(){w.abort("timeout")},d.timeout));try{y=1,i.send(b,n)}catch(k){if(!(2>y))throw k;n(-1,k)}}else n(-1,"No Transport");return w},getJSON:function(t,e,n){return Z.get(t,e,n,"json")},getScript:function(t,e){return Z.get(t,void 0,e,"script")}}),Z.each(["get","post"],function(t,e){Z[e]=function(t,n,i,o){return Z.isFunction(n)&&(o=o||i,i=n,n=void 0),Z.ajax({url:t,type:e,dataType:o,data:n,success:i})}}),Z._evalUrl=function(t){return Z.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},Z.fn.extend({wrapAll:function(t){var e;return Z.isFunction(t)?this.each(function(e){Z(this).wrapAll(t.call(this,e))}):(this[0]&&(e=Z(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this)},wrapInner:function(t){return Z.isFunction(t)?this.each(function(e){Z(this).wrapInner(t.call(this,e))}):this.each(function(){var e=Z(this),n=e.contents();n.length?n.wrapAll(t):e.append(t)})},wrap:function(t){var e=Z.isFunction(t);return this.each(function(n){Z(this).wrapAll(e?t.call(this,n):t)})},unwrap:function(){return this.parent().each(function(){Z.nodeName(this,"body")||Z(this).replaceWith(this.childNodes)}).end()}}),Z.expr.filters.hidden=function(t){return t.offsetWidth<=0&&t.offsetHeight<=0},Z.expr.filters.visible=function(t){return!Z.expr.filters.hidden(t)};var Ce=/%20/g,Se=/\[\]$/,xe=/\r?\n/g,Ee=/^(?:submit|button|image|reset|file)$/i,Pe=/^(?:input|select|textarea|keygen)/i;Z.param=function(t,e){var n,i=[],o=function(t,e){e=Z.isFunction(e)?e():null==e?"":e,i[i.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(void 0===e&&(e=Z.ajaxSettings&&Z.ajaxSettings.traditional),Z.isArray(t)||t.jquery&&!Z.isPlainObject(t))Z.each(t,function(){o(this.name,this.value)});else for(n in t)j(n,t[n],e,o);return i.join("&").replace(Ce,"+")},Z.fn.extend({serialize:function(){return Z.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=Z.prop(this,"elements");return t?Z.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!Z(this).is(":disabled")&&Pe.test(this.nodeName)&&!Ee.test(t)&&(this.checked||!St.test(t))}).map(function(t,e){var n=Z(this).val();return null==n?null:Z.isArray(n)?Z.map(n,function(t){return{name:e.name,value:t.replace(xe,"\r\n")}}):{name:e.name,value:n.replace(xe,"\r\n")}}).get()}}),Z.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(t){}};var Te=0,Ie={},Ae={0:200,1223:204},Be=Z.ajaxSettings.xhr();t.attachEvent&&t.attachEvent("onunload",function(){for(var t in Ie)Ie[t]()}),K.cors=!!Be&&"withCredentials"in Be,K.ajax=Be=!!Be,Z.ajaxTransport(function(t){var e;return K.cors||Be&&!t.crossDomain?{send:function(n,i){var o,r=t.xhr(),s=++Te;if(r.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(o in t.xhrFields)r[o]=t.xhrFields[o];t.mimeType&&r.overrideMimeType&&r.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(o in n)r.setRequestHeader(o,n[o]);e=function(t){return function(){e&&(delete Ie[s],e=r.onload=r.onerror=null,"abort"===t?r.abort():"error"===t?i(r.status,r.statusText):i(Ae[r.status]||r.status,r.statusText,"string"==typeof r.responseText?{text:r.responseText}:void 0,r.getAllResponseHeaders()))}},r.onload=e(),r.onerror=e("error"),e=Ie[s]=e("abort");try{r.send(t.hasContent&&t.data||null)}catch(a){if(e)throw a}},abort:function(){e&&e()}}:void 0}),Z.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(t){return Z.globalEval(t),t}}}),Z.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),Z.ajaxTransport("script",function(t){if(t.crossDomain){var e,n;return{send:function(i,o){e=Z("<script>").prop({async:!0,charset:t.scriptCharset,src:t.url}).on("load error",n=function(t){e.remove(),n=null,t&&o("error"===t.type?404:200,t.type)}),J.head.appendChild(e[0])},abort:function(){n&&n()}}}});var Oe=[],Me=/(=)\?(?=&|$)|\?\?/;Z.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Oe.pop()||Z.expando+"_"+le++;return this[t]=!0,t}}),Z.ajaxPrefilter("json jsonp",function(e,n,i){var o,r,s,a=e.jsonp!==!1&&(Me.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Me.test(e.data)&&"data");return a||"jsonp"===e.dataTypes[0]?(o=e.jsonpCallback=Z.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Me,"$1"+o):e.jsonp!==!1&&(e.url+=(ce.test(e.url)?"&":"?")+e.jsonp+"="+o),e.converters["script json"]=function(){return s||Z.error(o+" was not called"),s[0]},e.dataTypes[0]="json",r=t[o],t[o]=function(){s=arguments},i.always(function(){t[o]=r,e[o]&&(e.jsonpCallback=n.jsonpCallback,Oe.push(o)),s&&Z.isFunction(r)&&r(s[0]),s=r=void 0}),"script"):void 0}),Z.parseHTML=function(t,e,n){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(n=e,e=!1),e=e||J;var i=st.exec(t),o=!n&&[];return i?[e.createElement(i[1])]:(i=Z.buildFragment([t],e,o),o&&o.length&&Z(o).remove(),Z.merge([],i.childNodes))};var $e=Z.fn.load;Z.fn.load=function(t,e,n){if("string"!=typeof t&&$e)return $e.apply(this,arguments);var i,o,r,s=this,a=t.indexOf(" ");return a>=0&&(i=Z.trim(t.slice(a)),t=t.slice(0,a)),Z.isFunction(e)?(n=e,e=void 0):e&&"object"==typeof e&&(o="POST"),s.length>0&&Z.ajax({url:t,type:o,dataType:"html",data:e}).done(function(t){r=arguments,s.html(i?Z("<div>").append(Z.parseHTML(t)).find(i):t)}).complete(n&&function(t,e){s.each(n,r||[t.responseText,e,t])}),this},Z.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){Z.fn[e]=function(t){return this.on(e,t)}}),Z.expr.filters.animated=function(t){return Z.grep(Z.timers,function(e){return t===e.elem}).length};var De=t.document.documentElement;Z.offset={setOffset:function(t,e,n){var i,o,r,s,a,u,l,c=Z.css(t,"position"),d=Z(t),h={};"static"===c&&(t.style.position="relative"),a=d.offset(),r=Z.css(t,"top"),u=Z.css(t,"left"),l=("absolute"===c||"fixed"===c)&&(r+u).indexOf("auto")>-1,l?(i=d.position(),s=i.top,o=i.left):(s=parseFloat(r)||0,o=parseFloat(u)||0),Z.isFunction(e)&&(e=e.call(t,n,a)),null!=e.top&&(h.top=e.top-a.top+s),null!=e.left&&(h.left=e.left-a.left+o),"using"in e?e.using.call(t,h):d.css(h)}},Z.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){Z.offset.setOffset(this,t,e)});var e,n,i=this[0],o={top:0,left:0},r=i&&i.ownerDocument;if(r)return e=r.documentElement,Z.contains(e,i)?(typeof i.getBoundingClientRect!==xt&&(o=i.getBoundingClientRect()),n=U(r),{top:o.top+n.pageYOffset-e.clientTop,left:o.left+n.pageXOffset-e.clientLeft}):o},position:function(){if(this[0]){var t,e,n=this[0],i={top:0,left:0};return"fixed"===Z.css(n,"position")?e=n.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),Z.nodeName(t[0],"html")||(i=t.offset()),i.top+=Z.css(t[0],"borderTopWidth",!0),i.left+=Z.css(t[0],"borderLeftWidth",!0)),{top:e.top-i.top-Z.css(n,"marginTop",!0),left:e.left-i.left-Z.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||De;t&&!Z.nodeName(t,"html")&&"static"===Z.css(t,"position");)t=t.offsetParent;return t||De})}}),Z.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var i="pageYOffset"===n;Z.fn[e]=function(o){return gt(this,function(e,o,r){var s=U(e);return void 0===r?s?s[n]:e[o]:void(s?s.scrollTo(i?t.pageXOffset:r,i?r:t.pageYOffset):e[o]=r)},e,o,arguments.length,null)}}),Z.each(["top","left"],function(t,e){Z.cssHooks[e]=k(K.pixelPosition,function(t,n){return n?(n=w(t,e),Vt.test(n)?Z(t).position()[e]+"px":n):void 0})}),Z.each({Height:"height",Width:"width"},function(t,e){Z.each({padding:"inner"+t,content:e,"":"outer"+t},function(n,i){Z.fn[i]=function(i,o){var r=arguments.length&&(n||"boolean"!=typeof i),s=n||(i===!0||o===!0?"margin":"border");return gt(this,function(e,n,i){var o;return Z.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(o=e.documentElement,Math.max(e.body["scroll"+t],o["scroll"+t],e.body["offset"+t],o["offset"+t],o["client"+t])):void 0===i?Z.css(e,n,s):Z.style(e,n,i,s)},e,r?i:void 0,r,null)}})}),Z.fn.size=function(){return this.length},Z.fn.andSelf=Z.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return Z});var Re=t.jQuery,Le=t.$;return Z.noConflict=function(e){return t.$===Z&&(t.$=Le),e&&t.jQuery===Z&&(t.jQuery=Re),Z},typeof e===xt&&(t.jQuery=t.$=Z),Z}),jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(t,e,n,i,o){return jQuery.easing[jQuery.easing.def](t,e,n,i,o)},easeInQuad:function(t,e,n,i,o){return i*(e/=o)*e+n},easeOutQuad:function(t,e,n,i,o){return-i*(e/=o)*(e-2)+n},easeInOutQuad:function(t,e,n,i,o){return(e/=o/2)<1?i/2*e*e+n:-i/2*(--e*(e-2)-1)+n},easeInCubic:function(t,e,n,i,o){return i*(e/=o)*e*e+n},easeOutCubic:function(t,e,n,i,o){return i*((e=e/o-1)*e*e+1)+n},easeInOutCubic:function(t,e,n,i,o){return(e/=o/2)<1?i/2*e*e*e+n:i/2*((e-=2)*e*e+2)+n},easeInQuart:function(t,e,n,i,o){return i*(e/=o)*e*e*e+n},easeOutQuart:function(t,e,n,i,o){return-i*((e=e/o-1)*e*e*e-1)+n},easeInOutQuart:function(t,e,n,i,o){return(e/=o/2)<1?i/2*e*e*e*e+n:-i/2*((e-=2)*e*e*e-2)+n},easeInQuint:function(t,e,n,i,o){return i*(e/=o)*e*e*e*e+n},easeOutQuint:function(t,e,n,i,o){return i*((e=e/o-1)*e*e*e*e+1)+n},easeInOutQuint:function(t,e,n,i,o){return(e/=o/2)<1?i/2*e*e*e*e*e+n:i/2*((e-=2)*e*e*e*e+2)+n},easeInSine:function(t,e,n,i,o){return-i*Math.cos(e/o*(Math.PI/2))+i+n},easeOutSine:function(t,e,n,i,o){return i*Math.sin(e/o*(Math.PI/2))+n},easeInOutSine:function(t,e,n,i,o){return-i/2*(Math.cos(Math.PI*e/o)-1)+n},easeInExpo:function(t,e,n,i,o){return 0==e?n:i*Math.pow(2,10*(e/o-1))+n},easeOutExpo:function(t,e,n,i,o){return e==o?n+i:i*(-Math.pow(2,-10*e/o)+1)+n},easeInOutExpo:function(t,e,n,i,o){return 0==e?n:e==o?n+i:(e/=o/2)<1?i/2*Math.pow(2,10*(e-1))+n:i/2*(-Math.pow(2,-10*--e)+2)+n},easeInCirc:function(t,e,n,i,o){return-i*(Math.sqrt(1-(e/=o)*e)-1)+n},easeOutCirc:function(t,e,n,i,o){return i*Math.sqrt(1-(e=e/o-1)*e)+n},easeInOutCirc:function(t,e,n,i,o){return(e/=o/2)<1?-i/2*(Math.sqrt(1-e*e)-1)+n:i/2*(Math.sqrt(1-(e-=2)*e)+1)+n},easeInElastic:function(t,e,n,i,o){var r=1.70158,s=0,a=i;if(0==e)return n;if(1==(e/=o))return n+i;if(s||(s=.3*o),a<Math.abs(i)){a=i;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(i/a);return-(a*Math.pow(2,10*(e-=1))*Math.sin((e*o-r)*(2*Math.PI)/s))+n},easeOutElastic:function(t,e,n,i,o){var r=1.70158,s=0,a=i;if(0==e)return n;if(1==(e/=o))return n+i;if(s||(s=.3*o),a<Math.abs(i)){a=i;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(i/a);return a*Math.pow(2,-10*e)*Math.sin((e*o-r)*(2*Math.PI)/s)+i+n},easeInOutElastic:function(t,e,n,i,o){var r=1.70158,s=0,a=i;if(0==e)return n;if(2==(e/=o/2))return n+i;if(s||(s=o*(.3*1.5)),a<Math.abs(i)){a=i;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(i/a);return 1>e?-.5*(a*Math.pow(2,10*(e-=1))*Math.sin((e*o-r)*(2*Math.PI)/s))+n:a*Math.pow(2,-10*(e-=1))*Math.sin((e*o-r)*(2*Math.PI)/s)*.5+i+n},easeInBack:function(t,e,n,i,o,r){return void 0==r&&(r=1.70158),i*(e/=o)*e*((r+1)*e-r)+n},easeOutBack:function(t,e,n,i,o,r){return void 0==r&&(r=1.70158),i*((e=e/o-1)*e*((r+1)*e+r)+1)+n},easeInOutBack:function(t,e,n,i,o,r){return void 0==r&&(r=1.70158),(e/=o/2)<1?i/2*(e*e*(((r*=1.525)+1)*e-r))+n:i/2*((e-=2)*e*(((r*=1.525)+1)*e+r)+2)+n},easeInBounce:function(t,e,n,i,o){return i-jQuery.easing.easeOutBounce(t,o-e,0,i,o)+n},easeOutBounce:function(t,e,n,i,o){return(e/=o)<1/2.75?i*(7.5625*e*e)+n:2/2.75>e?i*(7.5625*(e-=1.5/2.75)*e+.75)+n:2.5/2.75>e?i*(7.5625*(e-=2.25/2.75)*e+.9375)+n:i*(7.5625*(e-=2.625/2.75)*e+.984375)+n},easeInOutBounce:function(t,e,n,i,o){return o/2>e?.5*jQuery.easing.easeInBounce(t,2*e,0,i,o)+n:.5*jQuery.easing.easeOutBounce(t,2*e-o,0,i,o)+.5*i+n}}),function(){"use strict";function t(e,i){function o(t,e){return function(){return t.apply(e,arguments)}}var r;if(i=i||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=i.touchBoundary||10,this.layer=e,this.tapDelay=i.tapDelay||200,this.tapTimeout=i.tapTimeout||700,!t.notNeeded(e)){for(var s=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],a=this,u=0,l=s.length;l>u;u++)a[s[u]]=o(a[s[u]],a);n&&(e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0)),e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,n,i){
var o=Node.prototype.removeEventListener;"click"===t?o.call(e,t,n.hijacked||n,i):o.call(e,t,n,i)},e.addEventListener=function(t,n,i){var o=Node.prototype.addEventListener;"click"===t?o.call(e,t,n.hijacked||(n.hijacked=function(t){t.propagationStopped||n(t)}),i):o.call(e,t,n,i)}),"function"==typeof e.onclick&&(r=e.onclick,e.addEventListener("click",function(t){r(t)},!1),e.onclick=null)}}var e=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!e,i=/iP(ad|hone|od)/.test(navigator.userAgent)&&!e,o=i&&/OS 4_\d(_\d)?/.test(navigator.userAgent),r=i&&/OS [6-7]_\d/.test(navigator.userAgent),s=navigator.userAgent.indexOf("BB10")>0;t.prototype.needsClick=function(t){switch(t.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(t.disabled)return!0;break;case"input":if(i&&"file"===t.type||t.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(t.className)},t.prototype.needsFocus=function(t){switch(t.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(t.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!t.disabled&&!t.readOnly;default:return/\bneedsfocus\b/.test(t.className)}},t.prototype.sendClick=function(t,e){var n,i;document.activeElement&&document.activeElement!==t&&document.activeElement.blur(),i=e.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(t),!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,t.dispatchEvent(n)},t.prototype.determineEventType=function(t){return n&&"select"===t.tagName.toLowerCase()?"mousedown":"click"},t.prototype.focus=function(t){var e;i&&t.setSelectionRange&&0!==t.type.indexOf("date")&&"time"!==t.type&&"month"!==t.type?(e=t.value.length,t.setSelectionRange(e,e)):t.focus()},t.prototype.updateScrollParent=function(t){var e,n;if(e=t.fastClickScrollParent,!e||!e.contains(t)){n=t;do{if(n.scrollHeight>n.offsetHeight){e=n,t.fastClickScrollParent=n;break}n=n.parentElement}while(n)}e&&(e.fastClickLastScrollTop=e.scrollTop)},t.prototype.getTargetElementFromEventTarget=function(t){return t.nodeType===Node.TEXT_NODE?t.parentNode:t},t.prototype.onTouchStart=function(t){var e,n,r;if(t.targetTouches.length>1)return!0;if(e=this.getTargetElementFromEventTarget(t.target),n=t.targetTouches[0],i){if(r=window.getSelection(),r.rangeCount&&!r.isCollapsed)return!0;if(!o){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return t.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(e)}}return this.trackingClick=!0,this.trackingClickStart=t.timeStamp,this.targetElement=e,this.touchStartX=n.pageX,this.touchStartY=n.pageY,t.timeStamp-this.lastClickTime<this.tapDelay&&t.preventDefault(),!0},t.prototype.touchHasMoved=function(t){var e=t.changedTouches[0],n=this.touchBoundary;return Math.abs(e.pageX-this.touchStartX)>n||Math.abs(e.pageY-this.touchStartY)>n},t.prototype.onTouchMove=function(t){return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(t.target)||this.touchHasMoved(t))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},t.prototype.findControl=function(t){return void 0!==t.control?t.control:t.htmlFor?document.getElementById(t.htmlFor):t.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},t.prototype.onTouchEnd=function(t){var e,s,a,u,l,c=this.targetElement;if(!this.trackingClick)return!0;if(t.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(t.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=t.timeStamp,s=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,r&&(l=t.changedTouches[0],c=document.elementFromPoint(l.pageX-window.pageXOffset,l.pageY-window.pageYOffset)||c,c.fastClickScrollParent=this.targetElement.fastClickScrollParent),a=c.tagName.toLowerCase(),"label"===a){if(e=this.findControl(c)){if(this.focus(c),n)return!1;c=e}}else if(this.needsFocus(c))return t.timeStamp-s>100||i&&window.top!==window&&"input"===a?(this.targetElement=null,!1):(this.focus(c),this.sendClick(c,t),i&&"select"===a||(this.targetElement=null,t.preventDefault()),!1);return i&&!o&&(u=c.fastClickScrollParent,u&&u.fastClickLastScrollTop!==u.scrollTop)?!0:(this.needsClick(c)||(t.preventDefault(),this.sendClick(c,t)),!1)},t.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},t.prototype.onMouse=function(t){return this.targetElement?t.forwardedTouchEvent?!0:t.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(t.stopImmediatePropagation?t.stopImmediatePropagation():t.propagationStopped=!0,t.stopPropagation(),t.preventDefault(),!1):!0:!0},t.prototype.onClick=function(t){var e;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===t.target.type&&0===t.detail?!0:(e=this.onMouse(t),e||(this.targetElement=null),e)},t.prototype.destroy=function(){var t=this.layer;n&&(t.removeEventListener("mouseover",this.onMouse,!0),t.removeEventListener("mousedown",this.onMouse,!0),t.removeEventListener("mouseup",this.onMouse,!0)),t.removeEventListener("click",this.onClick,!0),t.removeEventListener("touchstart",this.onTouchStart,!1),t.removeEventListener("touchmove",this.onTouchMove,!1),t.removeEventListener("touchend",this.onTouchEnd,!1),t.removeEventListener("touchcancel",this.onTouchCancel,!1)},t.notNeeded=function(t){var e,i,o,r;if("undefined"==typeof window.ontouchstart)return!0;if(i=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!n)return!0;if(e=document.querySelector("meta[name=viewport]")){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(i>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(s&&(o=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),o[1]>=10&&o[2]>=3&&(e=document.querySelector("meta[name=viewport]")))){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===t.style.msTouchAction||"manipulation"===t.style.touchAction?!0:(r=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1],r>=27&&(e=document.querySelector("meta[name=viewport]"),e&&(-1!==e.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))?!0:"none"===t.style.touchAction||"manipulation"===t.style.touchAction)},t.attach=function(e,n){return new t(e,n)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return t}):"undefined"!=typeof module&&module.exports?(module.exports=t.attach,module.exports.FastClick=t):window.FastClick=t}(),function(t){function e(){if(!d){d=!0;for(var e in c)t(e).each(function(){var n,i;n=t(this),i=n.data("jqae"),(i.containerWidth!=n.width()||i.containerHeight!=n.height())&&u(n,c[e])});d=!1}}function n(t){c[t]&&(delete c[t],c.length||l&&(window.clearInterval(l),l=void 0))}function i(t,n){c[t]=n,l||(l=window.setInterval(function(){e()},200))}function o(){return 3===this.nodeType}function r(e){if(e.contents().length){var n=e.contents(),i=n.eq(n.length-1);if(i.filter(o).length){var s=i.get(0).nodeValue;return s=t.trim(s),""==s?(i.remove(),!0):!1}for(;r(i););return i.contents().length?!1:(i.remove(),!0)}return!1}function s(t){if(t.contents().length){var e=t.contents(),n=e.eq(e.length-1);return n.filter(o).length?n:s(n)}t.append("");var e=t.contents();return e.eq(e.length-1)}function a(e){var n=s(e);if(n.length){var i=n.get(0).nodeValue,o=i.lastIndexOf(" ");return o>-1?(i=t.trim(i.substring(0,o)),n.get(0).nodeValue=i):n.get(0).nodeValue="",!0}return!1}function u(e,n){var i=e.data("jqae");i||(i={});var o=i.wrapperElement;o||(o=e.wrapInner("<div/>").find(">div"),o.css({margin:0,padding:0,border:0}));var u=o.data("jqae");u||(u={});var l=u.originalContent;l?o=u.originalContent.clone(!0).data("jqae",{originalContent:l}).replaceAll(o):o.data("jqae",{originalContent:o.clone(!0)}),e.data("jqae",{wrapperElement:o,containerWidth:e.width(),containerHeight:e.height()});var c=e.height(),d=(parseInt(e.css("padding-top"),10)||0)+(parseInt(e.css("border-top-width"),10)||0)-(o.offset().top-e.offset().top),h=!1,p=o;n.selector&&(p=t(o.find(n.selector).get().reverse())),p.each(function(){var e=t(this),i=e.text(),u=!1;if(o.innerHeight()-e.innerHeight()>c+d)e.remove();else if(r(e),e.contents().length){for(h&&(s(e).get(0).nodeValue+=n.ellipsis,h=!1);o.innerHeight()>c+d;){if(u=a(e),!u){h=!0,e.remove();break}if(r(e),!e.contents().length){h=!0,e.remove();break}s(e).get(0).nodeValue+=n.ellipsis}"onEllipsis"==n.setTitle&&u||"always"==n.setTitle?e.attr("title",i):"never"!=n.setTitle&&e.removeAttr("title")}})}var l,c={},d=!1,h={ellipsis:"...",setTitle:"never",live:!1};t.fn.ellipsis=function(e,o){var r,s;return r=t(this),"string"!=typeof e&&(o=e,e=void 0),s=t.extend({},h,o),s.selector=e,r.each(function(){var e=t(this);u(e,s)}),s.live?i(r.selector,s):n(r.selector),this}}(jQuery),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,i,o,r,s,a=gap,u=e[t];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(t)),"function"==typeof rep&&(u=rep.call(e,t,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(r=u.length,n=0;r>n;n+=1)s[n]=str(n,u)||"null";return o=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,o}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;r>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],o=str(i,u),o&&s.push(quote(i)+(gap?": ":":")+o));else for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(o=str(i,u),o&&s.push(quote(i)+(gap?": ":":")+o));return o=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,o}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx,escapable,gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(t,e){var n,i,o=t[e];if(o&&"object"==typeof o)for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(i=walk(o,n),void 0!==i?o[n]=i:delete o[n]);return reviver.call(t,e,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(t){function e(t,e,n){switch(arguments.length){case 2:return null!=t?t:e;case 3:return null!=t?t:null!=e?e:n;default:throw new Error("Implement me")}}function n(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function i(t){bt.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}function o(t,e){var n=!0;return d(function(){return n&&(i(t),n=!1),e.apply(this,arguments)},e)}function r(t,e){pe[t]||(i(e),pe[t]=!0)}function s(t,e){return function(n){return f(t.call(this,n),e)}}function a(t,e){return function(n){return this.localeData().ordinal(t.call(this,n),e)}}function u(){}function l(t,e){e!==!1&&A(t),h(this,t),this._d=new Date(+t._d)}function c(t){var e=C(t),n=e.year||0,i=e.quarter||0,o=e.month||0,r=e.week||0,s=e.day||0,a=e.hour||0,u=e.minute||0,l=e.second||0,c=e.millisecond||0;this._milliseconds=+c+1e3*l+6e4*u+36e5*a,this._days=+s+7*r,this._months=+o+3*i+12*n,this._data={},this._locale=bt.localeData(),this._bubble()}function d(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return e.hasOwnProperty("toString")&&(t.toString=e.toString),e.hasOwnProperty("valueOf")&&(t.valueOf=e.valueOf),t}function h(t,e){var n,i,o;if("undefined"!=typeof e._isAMomentObject&&(t._isAMomentObject=e._isAMomentObject),"undefined"!=typeof e._i&&(t._i=e._i),"undefined"!=typeof e._f&&(t._f=e._f),"undefined"!=typeof e._l&&(t._l=e._l),"undefined"!=typeof e._strict&&(t._strict=e._strict),"undefined"!=typeof e._tzm&&(t._tzm=e._tzm),"undefined"!=typeof e._isUTC&&(t._isUTC=e._isUTC),"undefined"!=typeof e._offset&&(t._offset=e._offset),"undefined"!=typeof e._pf&&(t._pf=e._pf),"undefined"!=typeof e._locale&&(t._locale=e._locale),Bt.length>0)for(n in Bt)i=Bt[n],o=e[i],"undefined"!=typeof o&&(t[i]=o);return t}function p(t){return 0>t?Math.ceil(t):Math.floor(t)}function f(t,e,n){for(var i=""+Math.abs(t),o=t>=0;i.length<e;)i="0"+i;return(o?n?"+":"":"-")+i}function m(t,e){var n={milliseconds:0,months:0};return n.months=e.month()-t.month()+12*(e.year()-t.year()),t.clone().add(n.months,"M").isAfter(e)&&--n.months,n.milliseconds=+e-+t.clone().add(n.months,"M"),n}function g(t,e){var n;return e=D(e,t),t.isBefore(e)?n=m(t,e):(n=m(e,t),n.milliseconds=-n.milliseconds,n.months=-n.months),n}function b(t,e){return function(n,i){var o,s;return null===i||isNaN(+i)||(r(e,"moment()."+e+"(period, number) is deprecated. Please use moment()."+e+"(number, period)."),s=n,n=i,i=s),n="string"==typeof n?+n:n,o=bt.duration(n,i),_(this,o,t),this}}function _(t,e,n,i){var o=e._milliseconds,r=e._days,s=e._months;i=null==i?!0:i,o&&t._d.setTime(+t._d+o*n),r&&dt(t,"Date",ct(t,"Date")+r*n),s&&lt(t,ct(t,"Month")+s*n),i&&bt.updateOffset(t,r||s)}function y(t){return"[object Array]"===Object.prototype.toString.call(t)}function v(t){return"[object Date]"===Object.prototype.toString.call(t)||t instanceof Date}function w(t,e,n){var i,o=Math.min(t.length,e.length),r=Math.abs(t.length-e.length),s=0;for(i=0;o>i;i++)(n&&t[i]!==e[i]||!n&&x(t[i])!==x(e[i]))&&s++;return s+r}function k(t){if(t){var e=t.toLowerCase().replace(/(.)s$/,"$1");t=se[t]||ae[e]||e}return t}function C(t){var e,n,i={};for(n in t)t.hasOwnProperty(n)&&(e=k(n),e&&(i[e]=t[n]));return i}function S(e){var n,i;if(0===e.indexOf("week"))n=7,i="day";else{if(0!==e.indexOf("month"))return;n=12,i="month"}bt[e]=function(o,r){var s,a,u=bt._locale[e],l=[];if("number"==typeof o&&(r=o,o=t),a=function(t){var e=bt().utc().set(i,t);return u.call(bt._locale,e,o||"")},null!=r)return a(r);for(s=0;n>s;s++)l.push(a(s));return l}}function x(t){var e=+t,n=0;return 0!==e&&isFinite(e)&&(n=e>=0?Math.floor(e):Math.ceil(e)),n}function E(t,e){return new Date(Date.UTC(t,e+1,0)).getUTCDate()}function P(t,e,n){return rt(bt([t,11,31+e-n]),e,n).week}function T(t){return I(t)?366:365}function I(t){return t%4===0&&t%100!==0||t%400===0}function A(t){var e;t._a&&-2===t._pf.overflow&&(e=t._a[St]<0||t._a[St]>11?St:t._a[xt]<1||t._a[xt]>E(t._a[Ct],t._a[St])?xt:t._a[Et]<0||t._a[Et]>23?Et:t._a[Pt]<0||t._a[Pt]>59?Pt:t._a[Tt]<0||t._a[Tt]>59?Tt:t._a[It]<0||t._a[It]>999?It:-1,t._pf._overflowDayOfYear&&(Ct>e||e>xt)&&(e=xt),t._pf.overflow=e)}function B(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length)),t._isValid}function O(t){return t?t.toLowerCase().replace("_","-"):t}function M(t){for(var e,n,i,o,r=0;r<t.length;){for(o=O(t[r]).split("-"),e=o.length,n=O(t[r+1]),n=n?n.split("-"):null;e>0;){if(i=$(o.slice(0,e).join("-")))return i;if(n&&n.length>=e&&w(o,n,!0)>=e-1)break;e--}r++}return null}function $(t){var e=null;if(!At[t]&&Ot)try{e=bt.locale(),require("./locale/"+t),bt.locale(e)}catch(n){}return At[t]}function D(t,e){return e._isUTC?bt(t).zone(e._offset||0):bt(t).local()}function R(t){return t.match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function L(t){var e,n,i=t.match(Rt);for(e=0,n=i.length;n>e;e++)i[e]=he[i[e]]?he[i[e]]:R(i[e]);return function(o){var r="";for(e=0;n>e;e++)r+=i[e]instanceof Function?i[e].call(o,t):i[e];return r}}function F(t,e){return t.isValid()?(e=N(e,t.localeData()),ue[e]||(ue[e]=L(e)),ue[e](t)):t.localeData().invalidDate()}function N(t,e){function n(t){return e.longDateFormat(t)||t}var i=5;for(Lt.lastIndex=0;i>=0&&Lt.test(t);)t=t.replace(Lt,n),Lt.lastIndex=0,i-=1;return t}function j(t,e){var n,i=e._strict;switch(t){case"Q":return Yt;case"DDDD":return Kt;case"YYYY":case"GGGG":case"gggg":return i?Jt:jt;case"Y":case"G":case"g":return Zt;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?Xt:Ut;case"S":if(i)return Yt;case"SS":if(i)return Gt;case"SSS":if(i)return Kt;case"DDD":return Nt;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Ht;case"a":case"A":return e._locale._meridiemParse;case"X":return Wt;case"Z":case"ZZ":return zt;case"T":return qt;case"SSSS":return Vt;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?Gt:Ft;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return Ft;case"Do":return Qt;default:return n=new RegExp(G(Y(t.replace("\\","")),"i"))}}function U(t){t=t||"";var e=t.match(zt)||[],n=e[e.length-1]||[],i=(n+"").match(oe)||["-",0,0],o=+(60*i[1])+x(i[2]);return"+"===i[0]?-o:o}function V(t,e,n){var i,o=n._a;switch(t){case"Q":null!=e&&(o[St]=3*(x(e)-1));break;case"M":case"MM":null!=e&&(o[St]=x(e)-1);break;case"MMM":case"MMMM":i=n._locale.monthsParse(e),null!=i?o[St]=i:n._pf.invalidMonth=e;break;case"D":case"DD":null!=e&&(o[xt]=x(e));break;case"Do":null!=e&&(o[xt]=x(parseInt(e,10)));break;case"DDD":case"DDDD":null!=e&&(n._dayOfYear=x(e));break;case"YY":o[Ct]=bt.parseTwoDigitYear(e);break;case"YYYY":case"YYYYY":case"YYYYYY":o[Ct]=x(e);break;case"a":case"A":n._isPm=n._locale.isPM(e);break;case"H":case"HH":case"h":case"hh":o[Et]=x(e);break;case"m":case"mm":o[Pt]=x(e);break;case"s":case"ss":o[Tt]=x(e);break;case"S":case"SS":case"SSS":case"SSSS":o[It]=x(1e3*("0."+e));break;case"X":n._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=U(e);break;case"dd":case"ddd":case"dddd":i=n._locale.weekdaysParse(e),null!=i?(n._w=n._w||{},n._w.d=i):n._pf.invalidWeekday=e;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":t=t.substr(0,1);case"gggg":case"GGGG":case"GGGGG":t=t.substr(0,2),e&&(n._w=n._w||{},n._w[t]=x(e));break;case"gg":case"GG":n._w=n._w||{},n._w[t]=bt.parseTwoDigitYear(e)}}function H(t){var n,i,o,r,s,a,u;n=t._w,null!=n.GG||null!=n.W||null!=n.E?(s=1,a=4,i=e(n.GG,t._a[Ct],rt(bt(),1,4).year),o=e(n.W,1),r=e(n.E,1)):(s=t._locale._week.dow,a=t._locale._week.doy,i=e(n.gg,t._a[Ct],rt(bt(),s,a).year),o=e(n.w,1),null!=n.d?(r=n.d,s>r&&++o):r=null!=n.e?n.e+s:s),u=st(i,o,r,a,s),t._a[Ct]=u.year,t._dayOfYear=u.dayOfYear}function z(t){var n,i,o,r,s=[];if(!t._d){for(o=W(t),t._w&&null==t._a[xt]&&null==t._a[St]&&H(t),t._dayOfYear&&(r=e(t._a[Ct],o[Ct]),t._dayOfYear>T(r)&&(t._pf._overflowDayOfYear=!0),i=et(r,0,t._dayOfYear),t._a[St]=i.getUTCMonth(),t._a[xt]=i.getUTCDate()),n=0;3>n&&null==t._a[n];++n)t._a[n]=s[n]=o[n];for(;7>n;n++)t._a[n]=s[n]=null==t._a[n]?2===n?1:0:t._a[n];t._d=(t._useUTC?et:tt).apply(null,s),null!=t._tzm&&t._d.setUTCMinutes(t._d.getUTCMinutes()+t._tzm)}}function q(t){var e;t._d||(e=C(t._i),t._a=[e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond],z(t))}function W(t){var e=new Date;return t._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}function Q(t){if(t._f===bt.ISO_8601)return void J(t);t._a=[],t._pf.empty=!0;var e,n,i,o,r,s=""+t._i,a=s.length,u=0;for(i=N(t._f,t._locale).match(Rt)||[],e=0;e<i.length;e++)o=i[e],n=(s.match(j(o,t))||[])[0],n&&(r=s.substr(0,s.indexOf(n)),r.length>0&&t._pf.unusedInput.push(r),s=s.slice(s.indexOf(n)+n.length),u+=n.length),he[o]?(n?t._pf.empty=!1:t._pf.unusedTokens.push(o),V(o,n,t)):t._strict&&!n&&t._pf.unusedTokens.push(o);t._pf.charsLeftOver=a-u,s.length>0&&t._pf.unusedInput.push(s),t._isPm&&t._a[Et]<12&&(t._a[Et]+=12),t._isPm===!1&&12===t._a[Et]&&(t._a[Et]=0),z(t),A(t)}function Y(t){return t.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,e,n,i,o){return e||n||i||o})}function G(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function K(t){var e,i,o,r,s;if(0===t._f.length)return t._pf.invalidFormat=!0,void(t._d=new Date(NaN));for(r=0;r<t._f.length;r++)s=0,e=h({},t),e._pf=n(),e._f=t._f[r],Q(e),B(e)&&(s+=e._pf.charsLeftOver,s+=10*e._pf.unusedTokens.length,e._pf.score=s,(null==o||o>s)&&(o=s,i=e));d(t,i||e)}function J(t){var e,n,i=t._i,o=te.exec(i);if(o){for(t._pf.iso=!0,e=0,n=ne.length;n>e;e++)if(ne[e][1].exec(i)){t._f=ne[e][0]+(o[6]||" ");break}for(e=0,n=ie.length;n>e;e++)if(ie[e][1].exec(i)){t._f+=ie[e][0];break}i.match(zt)&&(t._f+="Z"),Q(t)}else t._isValid=!1}function X(t){J(t),t._isValid===!1&&(delete t._isValid,bt.createFromInputFallback(t))}function Z(e){var n,i=e._i;i===t?e._d=new Date:v(i)?e._d=new Date(+i):null!==(n=Mt.exec(i))?e._d=new Date(+n[1]):"string"==typeof i?X(e):y(i)?(e._a=i.slice(0),z(e)):"object"==typeof i?q(e):"number"==typeof i?e._d=new Date(i):bt.createFromInputFallback(e)}function tt(t,e,n,i,o,r,s){var a=new Date(t,e,n,i,o,r,s);return 1970>t&&a.setFullYear(t),a}function et(t){var e=new Date(Date.UTC.apply(null,arguments));return 1970>t&&e.setUTCFullYear(t),e}function nt(t,e){if("string"==typeof t)if(isNaN(t)){if(t=e.weekdaysParse(t),"number"!=typeof t)return null}else t=parseInt(t,10);return t}function it(t,e,n,i,o){return o.relativeTime(e||1,!!n,t,i)}function ot(t,e,n){var i=bt.duration(t).abs(),o=kt(i.as("s")),r=kt(i.as("m")),s=kt(i.as("h")),a=kt(i.as("d")),u=kt(i.as("M")),l=kt(i.as("y")),c=o<le.s&&["s",o]||1===r&&["m"]||r<le.m&&["mm",r]||1===s&&["h"]||s<le.h&&["hh",s]||1===a&&["d"]||a<le.d&&["dd",a]||1===u&&["M"]||u<le.M&&["MM",u]||1===l&&["y"]||["yy",l];return c[2]=e,c[3]=+t>0,c[4]=n,it.apply({},c)}function rt(t,e,n){var i,o=n-e,r=n-t.day();return r>o&&(r-=7),o-7>r&&(r+=7),i=bt(t).add(r,"d"),{week:Math.ceil(i.dayOfYear()/7),year:i.year()}}function st(t,e,n,i,o){var r,s,a=et(t,0,1).getUTCDay();return a=0===a?7:a,n=null!=n?n:o,r=o-a+(a>i?7:0)-(o>a?7:0),s=7*(e-1)+(n-o)+r+1,{year:s>0?t:t-1,dayOfYear:s>0?s:T(t-1)+s}}function at(e){var n=e._i,i=e._f;return e._locale=e._locale||bt.localeData(e._l),null===n||i===t&&""===n?bt.invalid({nullInput:!0}):("string"==typeof n&&(e._i=n=e._locale.preparse(n)),bt.isMoment(n)?new l(n,!0):(i?y(i)?K(e):Q(e):Z(e),new l(e)))}function ut(t,e){var n,i;if(1===e.length&&y(e[0])&&(e=e[0]),!e.length)return bt();for(n=e[0],i=1;i<e.length;++i)e[i][t](n)&&(n=e[i]);return n}function lt(t,e){var n;return"string"==typeof e&&(e=t.localeData().monthsParse(e),"number"!=typeof e)?t:(n=Math.min(t.date(),E(t.year(),e)),t._d["set"+(t._isUTC?"UTC":"")+"Month"](e,n),t)}function ct(t,e){return t._d["get"+(t._isUTC?"UTC":"")+e]()}function dt(t,e,n){return"Month"===e?lt(t,n):t._d["set"+(t._isUTC?"UTC":"")+e](n)}function ht(t,e){return function(n){return null!=n?(dt(this,t,n),bt.updateOffset(this,e),this):ct(this,t)}}function pt(t){return 400*t/146097}function ft(t){return 146097*t/400}function mt(t){bt.duration.fn[t]=function(){return this._data[t]}}function gt(t){"undefined"==typeof ender&&(_t=wt.moment,wt.moment=t?o("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",bt):bt)}for(var bt,_t,yt,vt="2.8.1",wt="undefined"!=typeof global?global:this,kt=Math.round,Ct=0,St=1,xt=2,Et=3,Pt=4,Tt=5,It=6,At={},Bt=[],Ot="undefined"!=typeof module&&module.exports,Mt=/^\/?Date\((\-?\d+)/i,$t=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Dt=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,Rt=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Lt=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,Ft=/\d\d?/,Nt=/\d{1,3}/,jt=/\d{1,4}/,Ut=/[+\-]?\d{1,6}/,Vt=/\d+/,Ht=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,zt=/Z|[\+\-]\d\d:?\d\d/gi,qt=/T/i,Wt=/[\+\-]?\d+(\.\d{1,3})?/,Qt=/\d{1,2}/,Yt=/\d/,Gt=/\d\d/,Kt=/\d{3}/,Jt=/\d{4}/,Xt=/[+-]?\d{6}/,Zt=/[+-]?\d+/,te=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,ee="YYYY-MM-DDTHH:mm:ssZ",ne=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],ie=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],oe=/([\+\-]|\d\d)/gi,re=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),se={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},ae={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},ue={},le={s:45,m:45,h:22,d:26,M:11},ce="DDD w W M D d".split(" "),de="M D H h m s w W".split(" "),he={M:function(){return this.month()+1},MMM:function(t){return this.localeData().monthsShort(this,t)},MMMM:function(t){return this.localeData().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.localeData().weekdaysMin(this,t)},ddd:function(t){return this.localeData().weekdaysShort(this,t)},dddd:function(t){return this.localeData().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return f(this.year()%100,2)},YYYY:function(){return f(this.year(),4)},YYYYY:function(){return f(this.year(),5)},YYYYYY:function(){var t=this.year(),e=t>=0?"+":"-";return e+f(Math.abs(t),6)},gg:function(){return f(this.weekYear()%100,2)},gggg:function(){return f(this.weekYear(),4)},ggggg:function(){return f(this.weekYear(),5)},GG:function(){return f(this.isoWeekYear()%100,2)},GGGG:function(){return f(this.isoWeekYear(),4)},GGGGG:function(){return f(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return x(this.milliseconds()/100)},SS:function(){return f(x(this.milliseconds()/10),2)},SSS:function(){return f(this.milliseconds(),3)},SSSS:function(){return f(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+f(x(t/60),2)+":"+f(x(t)%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+f(x(t/60),2)+f(x(t)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},pe={},fe=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];ce.length;)yt=ce.pop(),he[yt+"o"]=a(he[yt],yt);for(;de.length;)yt=de.pop(),he[yt+yt]=s(he[yt],2);he.DDDD=s(he.DDD,3),d(u.prototype,{set:function(t){var e,n;for(n in t)e=t[n],"function"==typeof e?this[n]=e:this["_"+n]=e},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,n,i;for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(n=bt.utc([2e3,e]),i="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[e]=new RegExp(i.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,n,i;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;7>e;e++)if(this._weekdaysParse[e]||(n=bt([2e3,1]).day(e),i="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[e]=new RegExp(i.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},isPM:function(t){return"p"===(t+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(t,e,n){return t>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var n=this._calendar[t];return"function"==typeof n?n.apply(e):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,n,i){var o=this._relativeTime[n];return"function"==typeof o?o(t,e,n,i):o.replace(/%d/i,t)},pastFuture:function(t,e){var n=this._relativeTime[t>0?"future":"past"];return"function"==typeof n?n(e):n.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},week:function(t){return rt(t,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),bt=function(e,i,o,r){var s;return"boolean"==typeof o&&(r=o,o=t),s={},s._isAMomentObject=!0,s._i=e,s._f=i,s._l=o,s._strict=r,s._isUTC=!1,s._pf=n(),at(s)},bt.suppressDeprecationWarnings=!1,bt.createFromInputFallback=o("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(t){t._d=new Date(t._i)}),bt.min=function(){var t=[].slice.call(arguments,0);return ut("isBefore",t)},bt.max=function(){
var t=[].slice.call(arguments,0);return ut("isAfter",t)},bt.utc=function(e,i,o,r){var s;return"boolean"==typeof o&&(r=o,o=t),s={},s._isAMomentObject=!0,s._useUTC=!0,s._isUTC=!0,s._l=o,s._i=e,s._f=i,s._strict=r,s._pf=n(),at(s).utc()},bt.unix=function(t){return bt(1e3*t)},bt.duration=function(t,e){var n,i,o,r,s=t,a=null;return bt.isDuration(t)?s={ms:t._milliseconds,d:t._days,M:t._months}:"number"==typeof t?(s={},e?s[e]=t:s.milliseconds=t):(a=$t.exec(t))?(n="-"===a[1]?-1:1,s={y:0,d:x(a[xt])*n,h:x(a[Et])*n,m:x(a[Pt])*n,s:x(a[Tt])*n,ms:x(a[It])*n}):(a=Dt.exec(t))?(n="-"===a[1]?-1:1,o=function(t){var e=t&&parseFloat(t.replace(",","."));return(isNaN(e)?0:e)*n},s={y:o(a[2]),M:o(a[3]),d:o(a[4]),h:o(a[5]),m:o(a[6]),s:o(a[7]),w:o(a[8])}):"object"==typeof s&&("from"in s||"to"in s)&&(r=g(bt(s.from),bt(s.to)),s={},s.ms=r.milliseconds,s.M=r.months),i=new c(s),bt.isDuration(t)&&t.hasOwnProperty("_locale")&&(i._locale=t._locale),i},bt.version=vt,bt.defaultFormat=ee,bt.ISO_8601=function(){},bt.momentProperties=Bt,bt.updateOffset=function(){},bt.relativeTimeThreshold=function(e,n){return le[e]===t?!1:n===t?le[e]:(le[e]=n,!0)},bt.lang=o("moment.lang is deprecated. Use moment.locale instead.",function(t,e){return bt.locale(t,e)}),bt.locale=function(t,e){var n;return t&&(n="undefined"!=typeof e?bt.defineLocale(t,e):bt.localeData(t),n&&(bt.duration._locale=bt._locale=n)),bt._locale._abbr},bt.defineLocale=function(t,e){return null!==e?(e.abbr=t,At[t]||(At[t]=new u),At[t].set(e),bt.locale(t),At[t]):(delete At[t],null)},bt.langData=o("moment.langData is deprecated. Use moment.localeData instead.",function(t){return bt.localeData(t)}),bt.localeData=function(t){var e;if(t&&t._locale&&t._locale._abbr&&(t=t._locale._abbr),!t)return bt._locale;if(!y(t)){if(e=$(t))return e;t=[t]}return M(t)},bt.isMoment=function(t){return t instanceof l||null!=t&&t.hasOwnProperty("_isAMomentObject")},bt.isDuration=function(t){return t instanceof c};for(yt=fe.length-1;yt>=0;--yt)S(fe[yt]);bt.normalizeUnits=function(t){return k(t)},bt.invalid=function(t){var e=bt.utc(NaN);return null!=t?d(e._pf,t):e._pf.userInvalidated=!0,e},bt.parseZone=function(){return bt.apply(null,arguments).parseZone()},bt.parseTwoDigitYear=function(t){return x(t)+(x(t)>68?1900:2e3)},d(bt.fn=l.prototype,{clone:function(){return bt(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var t=bt(this).utc();return 0<t.year()&&t.year()<=9999?F(t,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):F(t,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return B(this)},isDSTShifted:function(){return this._a?this.isValid()&&w(this._a,(this._isUTC?bt.utc(this._a):bt(this._a)).toArray())>0:!1},parsingFlags:function(){return d({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(t){return this.zone(0,t)},local:function(t){return this._isUTC&&(this.zone(0,t),this._isUTC=!1,t&&this.add(this._d.getTimezoneOffset(),"m")),this},format:function(t){var e=F(this,t||bt.defaultFormat);return this.localeData().postformat(e)},add:b(1,"add"),subtract:b(-1,"subtract"),diff:function(t,e,n){var i,o,r=D(t,this),s=6e4*(this.zone()-r.zone());return e=k(e),"year"===e||"month"===e?(i=432e5*(this.daysInMonth()+r.daysInMonth()),o=12*(this.year()-r.year())+(this.month()-r.month()),o+=(this-bt(this).startOf("month")-(r-bt(r).startOf("month")))/i,o-=6e4*(this.zone()-bt(this).startOf("month").zone()-(r.zone()-bt(r).startOf("month").zone()))/i,"year"===e&&(o/=12)):(i=this-r,o="second"===e?i/1e3:"minute"===e?i/6e4:"hour"===e?i/36e5:"day"===e?(i-s)/864e5:"week"===e?(i-s)/6048e5:i),n?o:p(o)},from:function(t,e){return bt.duration({to:this,from:t}).locale(this.locale()).humanize(!e)},fromNow:function(t){return this.from(bt(),t)},calendar:function(t){var e=t||bt(),n=D(e,this).startOf("day"),i=this.diff(n,"days",!0),o=-6>i?"sameElse":-1>i?"lastWeek":0>i?"lastDay":1>i?"sameDay":2>i?"nextDay":7>i?"nextWeek":"sameElse";return this.format(this.localeData().calendar(o,this))},isLeapYear:function(){return I(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?(t=nt(t,this.localeData()),this.add(t-e,"d")):e},month:ht("Month",!0),startOf:function(t){switch(t=k(t)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===t?this.weekday(0):"isoWeek"===t&&this.isoWeekday(1),"quarter"===t&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(t){return t=k(t),this.startOf(t).add(1,"isoWeek"===t?"week":t).subtract(1,"ms")},isAfter:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)>+bt(t).startOf(e)},isBefore:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)<+bt(t).startOf(e)},isSame:function(t,e){return e=e||"ms",+this.clone().startOf(e)===+D(t,this).startOf(e)},min:o("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(t){return t=bt.apply(null,arguments),this>t?this:t}),max:o("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(t){return t=bt.apply(null,arguments),t>this?this:t}),zone:function(t,e){var n,i=this._offset||0;return null==t?this._isUTC?i:this._d.getTimezoneOffset():("string"==typeof t&&(t=U(t)),Math.abs(t)<16&&(t=60*t),!this._isUTC&&e&&(n=this._d.getTimezoneOffset()),this._offset=t,this._isUTC=!0,null!=n&&this.subtract(n,"m"),i!==t&&(!e||this._changeInProgress?_(this,bt.duration(i-t,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,bt.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(t){return t=t?bt(t).zone():0,(this.zone()-t)%60===0},daysInMonth:function(){return E(this.year(),this.month())},dayOfYear:function(t){var e=kt((bt(this).startOf("day")-bt(this).startOf("year"))/864e5)+1;return null==t?e:this.add(t-e,"d")},quarter:function(t){return null==t?Math.ceil((this.month()+1)/3):this.month(3*(t-1)+this.month()%3)},weekYear:function(t){var e=rt(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==t?e:this.add(t-e,"y")},isoWeekYear:function(t){var e=rt(this,1,4).year;return null==t?e:this.add(t-e,"y")},week:function(t){var e=this.localeData().week(this);return null==t?e:this.add(7*(t-e),"d")},isoWeek:function(t){var e=rt(this,1,4).week;return null==t?e:this.add(7*(t-e),"d")},weekday:function(t){var e=(this.day()+7-this.localeData()._week.dow)%7;return null==t?e:this.add(t-e,"d")},isoWeekday:function(t){return null==t?this.day()||7:this.day(this.day()%7?t:t-7)},isoWeeksInYear:function(){return P(this.year(),1,4)},weeksInYear:function(){var t=this.localeData()._week;return P(this.year(),t.dow,t.doy)},get:function(t){return t=k(t),this[t]()},set:function(t,e){return t=k(t),"function"==typeof this[t]&&this[t](e),this},locale:function(e){return e===t?this._locale._abbr:(this._locale=bt.localeData(e),this)},lang:o("moment().lang() is deprecated. Use moment().localeData() instead.",function(e){return e===t?this.localeData():(this._locale=bt.localeData(e),this)}),localeData:function(){return this._locale}}),bt.fn.millisecond=bt.fn.milliseconds=ht("Milliseconds",!1),bt.fn.second=bt.fn.seconds=ht("Seconds",!1),bt.fn.minute=bt.fn.minutes=ht("Minutes",!1),bt.fn.hour=bt.fn.hours=ht("Hours",!0),bt.fn.date=ht("Date",!0),bt.fn.dates=o("dates accessor is deprecated. Use date instead.",ht("Date",!0)),bt.fn.year=ht("FullYear",!0),bt.fn.years=o("years accessor is deprecated. Use year instead.",ht("FullYear",!0)),bt.fn.days=bt.fn.day,bt.fn.months=bt.fn.month,bt.fn.weeks=bt.fn.week,bt.fn.isoWeeks=bt.fn.isoWeek,bt.fn.quarters=bt.fn.quarter,bt.fn.toJSON=bt.fn.toISOString,d(bt.duration.fn=c.prototype,{_bubble:function(){var t,e,n,i=this._milliseconds,o=this._days,r=this._months,s=this._data,a=0;s.milliseconds=i%1e3,t=p(i/1e3),s.seconds=t%60,e=p(t/60),s.minutes=e%60,n=p(e/60),s.hours=n%24,o+=p(n/24),a=p(pt(o)),o-=p(ft(a)),r+=p(o/30),o%=30,a+=p(r/12),r%=12,s.days=o,s.months=r,s.years=a},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return p(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*x(this._months/12)},humanize:function(t){var e=ot(this,!t,this.localeData());return t&&(e=this.localeData().pastFuture(+this,e)),this.localeData().postformat(e)},add:function(t,e){var n=bt.duration(t,e);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(t,e){var n=bt.duration(t,e);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(t){return t=k(t),this[t.toLowerCase()+"s"]()},as:function(t){var e,n;if(t=k(t),e=this._days+this._milliseconds/864e5,"month"===t||"year"===t)return n=this._months+12*pt(e),"month"===t?n:n/12;switch(e+=ft(this._months/12),t){case"week":return e/7;case"day":return e;case"hour":return 24*e;case"minute":return 24*e*60;case"second":return 24*e*60*60;case"millisecond":return 24*e*60*60*1e3;default:throw new Error("Unknown unit "+t)}},lang:bt.fn.lang,locale:bt.fn.locale,toIsoString:o("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var t=Math.abs(this.years()),e=Math.abs(this.months()),n=Math.abs(this.days()),i=Math.abs(this.hours()),o=Math.abs(this.minutes()),r=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(t?t+"Y":"")+(e?e+"M":"")+(n?n+"D":"")+(i||o||r?"T":"")+(i?i+"H":"")+(o?o+"M":"")+(r?r+"S":""):"P0D"},localeData:function(){return this._locale}});for(yt in re)re.hasOwnProperty(yt)&&mt(yt.toLowerCase());bt.duration.fn.asMilliseconds=function(){return this.as("ms")},bt.duration.fn.asSeconds=function(){return this.as("s")},bt.duration.fn.asMinutes=function(){return this.as("m")},bt.duration.fn.asHours=function(){return this.as("h")},bt.duration.fn.asDays=function(){return this.as("d")},bt.duration.fn.asWeeks=function(){return this.as("weeks")},bt.duration.fn.asMonths=function(){return this.as("M")},bt.duration.fn.asYears=function(){return this.as("y")},bt.locale("en",{ordinal:function(t){var e=t%10,n=1===x(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+n}}),Ot?module.exports=bt:"function"==typeof define&&define.amd?(define("moment",function(t,e,n){return n.config&&n.config()&&n.config().noGlobal===!0&&(wt.moment=_t),bt}),gt(!0)):gt()}.call(this),function(t){"function"==typeof define&&define.amd?define(["moment"],t):"object"==typeof exports?module.exports=t(require("../moment")):t(window.moment)}(function(t){return t.defineLocale("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"now",m:"1 m",mm:"%d m",h:"1 h",hh:"%d h",d:"1 d",dd:"%d d",M:"1 mo",MM:"%d mo",y:"1 y",yy:"%d y"},ordinal:function(t){var e=t%10,n=1===~~(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+n},week:{dow:1,doy:4}})}),function(t){"function"==typeof define&&define.amd?define(["moment"],t):"object"==typeof exports?module.exports=t(require("../moment")):t(window.moment)}(function(t){function e(t,e){var n=t.split("_");return e%10===1&&e%100!==11?n[0]:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?n[1]:n[2]}function n(t,n,i){var o={mm:"__",hh:"__",dd:"__",MM:"__",yy:"__"};return"m"===i?"":t+" "+e(o[i],+t)}function i(t,e){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(e)?"accusative":"nominative";return n[i][t.month()]}function o(t,e){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(e)?"accusative":"nominative";return n[i][t.month()]}function r(t,e){var n={nominative:"______".split("_"),accusative:"______".split("_")},i=/\[ ?[] ?(?:|)? ?\] ?dddd/.test(e)?"accusative":"nominative";return n[i][t.day()]}return t.defineLocale("ru",{months:i,monthsShort:o,weekdays:r,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),monthsParse:[/^/i,/^/i,/^/i,/^/i,/^[|]/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i],longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:function(){return 2===this.day()?"[] dddd [] LT":"[] dddd [] LT"},lastWeek:function(){switch(this.day()){case 0:return"[ ] dddd [] LT";case 1:case 2:case 4:return"[ ] dddd [] LT";case 3:case 5:case 6:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:"",m:n,mm:n,h:"1 ",hh:n,d:"1 ",dd:n,M:"1 ",MM:n,y:"1 ",yy:n},meridiem:function(t,e,n){return 4>t?"":12>t?"":17>t?"":""},ordinal:function(t,e){switch(e){case"M":case"d":case"DDD":return t+"-";case"D":return t+"-";case"w":case"W":return t+"-";default:return t}},week:{dow:1,doy:7}})}),function(t){"function"==typeof define&&define.amd?define(["moment"],t):"object"==typeof exports?module.exports=t(require("../moment")):t(window.moment)}(function(t){var e="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),n="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_");return t.defineLocale("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(t,i){return/-MMM-/.test(i)?n[t.month()]:e[t.month()]},weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"Do_Lu_Ma_Mi_Ju_Vi_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [del] YYYY",LLL:"D [de] MMMM [del] YYYY LT",LLLL:"dddd, D [de] MMMM [del] YYYY LT"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"ahora",m:"1 minuto",mm:"%d minutes",h:"1 hora",hh:"%d horas",d:"1 da",dd:"%d das",M:"1 mes",MM:"%d meses",y:"1 ao",yy:"%d aos"},ordinal:"%d",week:{dow:1,doy:4}})}),function(t){"function"==typeof define&&define.amd?define(["moment"],t):"object"==typeof exports?module.exports=t(require("../moment")):t(window.moment)}(function(t){var e={1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'nc",4:"'nc",100:"'nc",6:"'nc",9:"'uncu",10:"'uncu",30:"'uncu",60:"'nc",90:"'nc"};return t.defineLocale("tr",{months:"Ocak_ubat_Mart_Nisan_Mays_Haziran_Temmuz_Austos_Eyll_Ekim_Kasm_Aralk".split("_"),monthsShort:"Oca_ub_Mar_Nis_May_Haz_Tem_Au_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Sal_aramba_Perembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pts_Sal_ar_Per_Cum_Cts".split("_"),weekdaysMin:"Pz_Pt_Sa_a_Pe_Cu_Ct".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[yarn saat] LT",nextWeek:"[haftaya] dddd [saat] LT",lastDay:"[dn] LT",lastWeek:"[geen hafta] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s nce",s:"imdi",m:"1d",mm:"%dd",h:"1s",hh:"%ds",d:"1g",dd:"%dg",M:"1a",MM:"%da",y:"1y",yy:"%dy"},ordinal:function(t){if(0===t)return t+"'nc";var n=t%10,i=t%100-n,o=t>=100?100:null;return t+(e[n]||e[i]||e[o])},week:{dow:1,doy:7}})}),function(t){"function"==typeof define&&define.amd?define(["moment"],t):"object"==typeof exports?module.exports=t(require("../moment")):t(window.moment)}(function(t){return t.defineLocale("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mndag_tisdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_mn_tis_ons_tor_fre_lr".split("_"),weekdaysMin:"s_m_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Igr] LT",nextWeek:"dddd LT",lastWeek:"[Frra] dddd[en] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"fr %s sedan",s:"nu",m:"1m",mm:"%dm",h:"1t",hh:"%dt",d:"1d",dd:"%dd",M:"1mn",MM:"%dmn",y:"1",yy:"%d"},ordinal:function(t){var e=t%10,n=1===~~(t%100/10)?"e":1===e?"a":2===e?"a":"e";return t+n},week:{dow:1,doy:4}})}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("../moment")):"function"==typeof define&&define.amd?define(["moment"],e):e(t.moment)}(this,function(t){"use strict";var e=t.defineLocale("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|siang|sore|malam/,meridiemHour:function(t,e){return 12===t&&(t=0),"pagi"===e?t:"siang"===e?t>=11?t:t+12:"sore"===e||"malam"===e?t+12:void 0},meridiem:function(t,e,n){return 11>t?"pagi":15>t?"siang":19>t?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}});return e}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("../moment")):"function"==typeof define&&define.amd?define(["moment"],e):e(t.moment)}(this,function(t){"use strict";function e(t,e,n,i){var o={s:["mne sekundi","mni sekund","paar sekundit"],m:["he minuti","ks minut"],mm:[t+" minuti",t+" minutit"],h:["he tunni","tund aega","ks tund"],hh:[t+" tunni",t+" tundi"],d:["he peva","ks pev"],M:["kuu aja","kuu aega","ks kuu"],MM:[t+" kuu",t+" kuud"],y:["he aasta","aasta","ks aasta"],yy:[t+" aasta",t+" aastat"]};return e?o[n][2]?o[n][2]:o[n][1]:i?o[n][0]:o[n][1]}var n=t.defineLocale("et",{months:"jaanuar_veebruar_mrts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_mrts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"phapev_esmaspev_teisipev_kolmapev_neljapev_reede_laupev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[Tna,] LT",nextDay:"[Homme,] LT",nextWeek:"[Jrgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s prast",past:"%s tagasi",s:e,m:e,mm:e,h:e,hh:e,d:e,dd:"%d peva",M:e,MM:e,y:e,yy:e},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}});return n}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("../moment")):"function"==typeof define&&define.amd?define(["moment"],e):e(t.moment)}(this,function(t){"use strict";var e={1:"-inci",5:"-inci",8:"-inci",70:"-inci",80:"-inci",2:"-nci",7:"-nci",20:"-nci",50:"-nci",3:"-nc",4:"-nc",100:"-nc",6:"-nc",9:"-uncu",10:"-uncu",30:"-uncu",60:"-nc",90:"-nc"},n=t.defineLocale("az",{months:"yanvar_fevral_mart_aprel_may_iyun_iyul_avqust_sentyabr_oktyabr_noyabr_dekabr".split("_"),monthsShort:"yan_fev_mar_apr_may_iyn_iyl_avq_sen_okt_noy_dek".split("_"),weekdays:"Bazar_Bazar ertsi_rnb axam_rnb_Cm axam_Cm_nb".split("_"),weekdaysShort:"Baz_BzE_Ax_r_CAx_Cm_n".split("_"),weekdaysMin:"Bz_BE_A__CA_C_".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[sabah saat] LT",nextWeek:"[gln hft] dddd [saat] LT",lastDay:"[dnn] LT",lastWeek:"[ken hft] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s vvl",s:"birne saniyy",m:"bir dqiq",mm:"%d dqiq",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir il",yy:"%d il"},meridiemParse:/gec|shr|gndz|axam/,isPM:function(t){return/^(gndz|axam)$/.test(t)},meridiem:function(t,e,n){return 4>t?"gec":12>t?"shr":17>t?"gndz":"axam"},ordinalParse:/\d{1,2}-(nc|inci|nci|nc|nc|uncu)/,ordinal:function(t){if(0===t)return t+"-nc";var n=t%10,i=t%100-n,o=t>=100?100:null;return t+(e[n]||e[i]||e[o])},week:{dow:1,doy:7}});return n}),function(t){"function"==typeof define&&define.amd?define(["moment"],t):"object"==typeof exports?module.exports=t(require("../moment")):t(window.moment)}(function(t){var e={1:"'",5:"'",8:"'",70:"'",80:"'",2:"'",7:"'",20:"'",50:"'",3:"'",4:"'",100:"'",6:"'",9:"'",10:"'",30:"'",60:"'",90:"'"};return t.defineLocale("kk",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[ ] dddd [] LT",lastDay:"[] LT",lastWeek:"[ ] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",m:"1 ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinal:function(t){if(0===t)return t+"'";var n=t%10,i=t%100-n,o=t>=100?100:null;return t+(e[n]||e[i]||e[o])},week:{dow:1,doy:7}})}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("../moment")):"function"==typeof define&&define.amd?define(["moment"],e):e(t.moment)}(this,function(t){"use strict";var e=t.defineLocale("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_man_tir_ons_tor_fre_lr".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd [d.] D. MMMM YYYY HH:mm"},calendar:{sameDay:"[I dag kl.] LT",nextDay:"[I morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[I gr kl.] LT",lastWeek:"[sidste] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"f sekunder",m:"1 minut",mm:"%d minutter",h:"1 time",hh:"%d timer",d:"1 dag",dd:"%d dage",M:"1 mned",MM:"%d mneder",y:"1 r",yy:"%d r"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}});return e}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("../moment")):"function"==typeof define&&define.amd?define(["moment"],e):e(t.moment)}(this,function(t){"use strict";var e="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),n="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),i=t.defineLocale("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(t,i){return/-MMM-/.test(i)?n[t.month()]:e[t.month()]},weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"Zo_Ma_Di_Wo_Do_Vr_Za".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",m:"n minuut",mm:"%d minuten",h:"n uur",hh:"%d uur",d:"n dag",dd:"%d dagen",M:"n maand",MM:"%d maanden",y:"n jaar",yy:"%d jaar"},ordinalParse:/\d{1,2}(ste|de)/,ordinal:function(t){return t+(1===t||8===t||t>=20?"ste":"de")},week:{dow:1,doy:4}});return i}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("../moment")):"function"==typeof define&&define.amd?define(["moment"],e):e(t.moment)}(this,function(t){"use strict";function e(t,e){var n=t.split("_");return e%10===1&&e%100!==11?n[0]:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?n[1]:n[2]}function n(t,n,i){var o={mm:"__",hh:"__",dd:"__",MM:"__",yy:"__"};return"m"===i?n?"":"":"h"===i?n?"":"":t+" "+e(o[i],+t)}function i(t,e){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]? *MMMM?/.test(e)?"accusative":"nominative";return n[i][t.month()]}function o(t,e){var n={nominative:"______".split("_"),accusative:"______".split("_"),genitive:"______".split("_")},i=/(\[[]\]) ?dddd/.test(e)?"accusative":/\[?(?:|)? ?\] ?dddd/.test(e)?"genitive":"nominative";return n[i][t.day()]}function r(t){return function(){return t+""+(11===this.hours()?"":"")+"] LT"}}var s=t.defineLocale("uk",{months:i,monthsShort:"___________".split("_"),weekdays:o,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., HH:mm",LLLL:"dddd, D MMMM YYYY ., HH:mm"},calendar:{sameDay:r("[ "),nextDay:r("[ "),lastDay:r("[ "),nextWeek:r("[] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return r("[] dddd [").call(this);case 1:case 2:case 4:return r("[] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:n,mm:n,h:"",hh:n,d:"",dd:n,M:"",MM:n,y:"",yy:n},meridiemParse:/|||/,isPM:function(t){return/^(|)$/.test(t)},meridiem:function(t,e,n){return 4>t?"":12>t?"":17>t?"":""},ordinalParse:/\d{1,2}-(|)/,ordinal:function(t,e){switch(e){case"M":case"d":case"DDD":case"w":case"W":return t+"-";case"D":return t+"-";default:return t}},week:{dow:1,doy:7}});return s}),function(t,e){if("object"==typeof exports&&exports)e(exports);else{var n={};e(n),"function"==typeof define&&define.amd?define(n):t.Mustache=n}}(this,function(t){function e(t,e){return p.call(t,e)}function n(t){return!e(f,t)}function i(t){return"function"==typeof t}function o(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function r(t){return String(t).replace(/[&<>"'\/]/g,function(t){return b[t]})}function s(t){if(!g(t)||2!==t.length)throw new Error("Invalid tags: "+t);return[new RegExp(o(t[0])+"\\s*"),new RegExp("\\s*"+o(t[1]))]}function a(e,i){function r(){if(E&&!P)for(;x.length;)delete S[x.pop()];else x=[];E=!1,P=!1}i=i||t.tags,e=e||"","string"==typeof i&&(i=i.split(y));for(var a,d,h,p,f,m,g=s(i),b=new c(e),C=[],S=[],x=[],E=!1,P=!1;!b.eos();){if(a=b.pos,h=b.scanUntil(g[0]))for(var T=0,I=h.length;I>T;++T)p=h.charAt(T),n(p)?x.push(S.length):P=!0,S.push(["text",p,a,a+1]),a+=1,"\n"===p&&r();if(!b.scan(g[0]))break;if(E=!0,d=b.scan(k)||"name",b.scan(_),"="===d?(h=b.scanUntil(v),b.scan(v),b.scanUntil(g[1])):"{"===d?(h=b.scanUntil(new RegExp("\\s*"+o("}"+i[1]))),b.scan(w),b.scanUntil(g[1]),d="&"):h=b.scanUntil(g[1]),!b.scan(g[1]))throw new Error("Unclosed tag at "+b.pos);if(f=[d,h,a,b.pos],S.push(f),"#"===d||"^"===d)C.push(f);else if("/"===d){if(m=C.pop(),!m)throw new Error('Unopened section "'+h+'" at '+a);if(m[1]!==h)throw new Error('Unclosed section "'+m[1]+'" at '+a)}else"name"===d||"{"===d||"&"===d?P=!0:"="===d&&(g=s(i=h.split(y)))}if(m=C.pop())throw new Error('Unclosed section "'+m[1]+'" at '+b.pos);return l(u(S))}function u(t){for(var e,n,i=[],o=0,r=t.length;r>o;++o)e=t[o],e&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(i.push(e),n=e));return i}function l(t){for(var e,n,i=[],o=i,r=[],s=0,a=t.length;a>s;++s)switch(e=t[s],e[0]){case"#":case"^":o.push(e),r.push(e),o=e[4]=[];break;case"/":n=r.pop(),n[5]=e[2],o=r.length>0?r[r.length-1][4]:i;break;default:o.push(e)}return i}function c(t){this.string=t,this.tail=t,this.pos=0}function d(t,e){this.view=null==t?{}:t,this.cache={".":this.view},this.parent=e}function h(){this.cache={}}var p=RegExp.prototype.test,f=/\S/,m=Object.prototype.toString,g=Array.isArray||function(t){return"[object Array]"===m.call(t)},b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},_=/\s*/,y=/\s+/,v=/\s*=/,w=/\s*\}/,k=/#|\^|\/|>|\{|&|=|!/;c.prototype.eos=function(){
return""===this.tail},c.prototype.scan=function(t){var e=this.tail.match(t);if(e&&0===e.index){var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n}return""},c.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},d.prototype.push=function(t){return new d(t,this)},d.prototype.lookup=function(t){var e;if(t in this.cache)e=this.cache[t];else{for(var n=this;n;){if(t.indexOf(".")>0){e=n.view;for(var o=t.split("."),r=0;null!=e&&r<o.length;)e=e[o[r++]]}else e=n.view[t];if(null!=e)break;n=n.parent}this.cache[t]=e}return i(e)&&(e=e.call(this.view)),e},h.prototype.clearCache=function(){this.cache={}},h.prototype.parse=function(t,e){var n=this.cache,i=n[t];return null==i&&(i=n[t]=a(t,e)),i},h.prototype.render=function(t,e,n){var i=this.parse(t),o=e instanceof d?e:new d(e);return this.renderTokens(i,o,n,t)},h.prototype.renderTokens=function(e,n,o,r){function s(t){return c.render(t,n,o)}for(var a,u,l="",c=this,d=0,h=e.length;h>d;++d)switch(a=e[d],a[0]){case"#":if(u=n.lookup(a[1]),!u)continue;if(g(u))for(var p=0,f=u.length;f>p;++p)l+=this.renderTokens(a[4],n.push(u[p]),o,r);else if("object"==typeof u||"string"==typeof u)l+=this.renderTokens(a[4],n.push(u),o,r);else if(i(u)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");u=u.call(n.view,r.slice(a[3],a[5]),s),null!=u&&(l+=u)}else l+=this.renderTokens(a[4],n,o,r);break;case"^":u=n.lookup(a[1]),(!u||g(u)&&0===u.length)&&(l+=this.renderTokens(a[4],n,o,r));break;case">":if(!o)continue;u=i(o)?o(a[1]):o[a[1]],null!=u&&(l+=this.renderTokens(this.parse(u),n,o,u));break;case"&":u=n.lookup(a[1]),null!=u&&(l+=u);break;case"name":u=n.lookup(a[1]),null!=u&&(l+=t.escape(u));break;case"text":l+=a[1]}return l},t.name="mustache.js",t.version="0.8.1",t.tags=["{{","}}"];var C=new h;t.clearCache=function(){return C.clearCache()},t.parse=function(t,e){return C.parse(t,e)},t.render=function(t,e,n){return C.render(t,e,n)},t.to_html=function(e,n,o,r){var s=t.render(e,n,o);return i(r)?void r(s):s},t.escape=r,t.Scanner=c,t.Context=d,t.Writer=h}),window.radio=function(t,e){"use strict";function n(t){return arguments.length?n.$.channel(t):n.$.reset(),n.$}return n.$={version:"0.2",channelName:"",channels:[],reset:function(){n.$.channelName="",n.$.channels=[]},broadcast:function(){var t,n,i,o,r=this.channels[this.channelName],s=r.length;for(t=0;s>t;t++)n=r[t],"object"==typeof n&&n.length&&(i=n[0],o=n[1]||e),i.apply(o,arguments);return this},channel:function(t){var e=this.channels;return e[t]||(e[t]=[]),this.channelName=t,this},subscribe:function(){var t,e,n=arguments,i=this.channels[this.channelName],o=n.length,r=[];for(t=0;o>t;t++)r=n[t],e="function"==typeof r?[r]:r,"object"==typeof e&&e.length&&i.push(e);return this},unsubscribe:function(){var t,e,n,i=arguments,o=this.channels[this.channelName],r=i.length,s=o.length,a=0;for(t=0;r>t;t++)for(a=0,s=o.length,e=0;s>e;e++)n=e-a,o[n][0]===i[t]&&(o.splice(n,1),a++);return this}},n}("radio",this),function(t){var e,n={NOT_RESOLVED:"NOT_RESOLVED",IN_RESOLVING:"IN_RESOLVING",RESOLVED:"RESOLVED"},i=function(){var d={trackCircularDependencies:!0,allowMultipleDeclarations:!0},h={},p=!1,f=[],m=function(t,i,o){o||(o=i,i=[]);var r=h[t];r||(r=h[t]={name:t,decl:e}),r.decl={name:t,prev:r.decl,fn:o,state:n.NOT_RESOLVED,deps:i,dependents:[],exports:e}},g=function(e,n,i){"string"==typeof e&&(e=[e]),p||(p=!0,c(v)),f.push({deps:e,cb:function(e,r){r?(i||o)(r):void 0!==n&&n.apply(t,e)}})},b=function(t){var e=h[t];return e?n[e.decl.state]:"NOT_DEFINED"},_=function(t){return!!h[t]},y=function(t){for(var e in t)t.hasOwnProperty(e)&&(d[e]=t[e])},v=function(){p=!1,w()},w=function(){var t,e=f,n=0;for(f=[];t=e[n++];)k(null,t.deps,[],t.cb)},k=function(t,e,n,i){var o=e.length;o||i([]);for(var s,a,u=[],l=function(t,e){if(e)return void i(null,e);if(!--o){for(var n,r=[],s=0;n=u[s++];)r.push(n.exports);i(r)}},c=0,d=o;d>c;){if(s=e[c++],"string"==typeof s){if(!h[s])return void i(null,r(s,t));a=h[s].decl}else a=s;u.push(a),C(a,n,l)}},C=function(e,i,o){if(e.state===n.RESOLVED)return void o(e.exports);if(e.state===n.IN_RESOLVING)return void(d.trackCircularDependencies&&l(e,i)?o(null,s(e,i)):e.dependents.push(o));if(e.dependents.push(o),e.prev&&!d.allowMultipleDeclarations)return void x(e,u(e));d.trackCircularDependencies&&(i=i.slice()).push(e);var r=!1,c=e.prev?e.deps.concat([e.prev]):e.deps;e.state=n.IN_RESOLVING,k(e,c,i,function(n,i){return i?void x(e,i):(n.unshift(function(t,n){return r?void o(null,a(e)):(r=!0,void(n?x(e,n):S(e,t)))}),void e.fn.apply({name:e.name,deps:e.deps,global:t},n))})},S=function(t,i){t.exports=i,t.state=n.RESOLVED;for(var o,r=0;o=t.dependents[r++];)o(i);t.dependents=e},x=function(t,e){t.state=n.NOT_RESOLVED;for(var i,o=0;i=t.dependents[o++];)i(null,e);t.dependents=[]};return{create:i,define:m,require:g,getState:b,isDefined:_,setOptions:y}},o=function(t){c(function(){throw t})},r=function(t,e){return Error(e?'Module "'+e.name+'": can\'t resolve dependence "'+t+'"':'Required module "'+t+"\" can't be resolved")},s=function(t,e){for(var n,i=[],o=0;n=e[o++];)i.push(n.name);return i.push(t.name),Error('Circular dependence has been detected: "'+i.join(" -> ")+'"')},a=function(t){return Error('Declaration of module "'+t.name+'" has already been provided')},u=function(t){return Error('Multiple declarations of module "'+t.name+'" have been detected')},l=function(t,e){for(var n,i=0;n=e[i++];)if(t===n)return!0;return!1},c=function(){var e=[],n=function(t){return 1===e.push(t)},i=function(){var t=e,n=0,i=e.length;for(e=[];i>n;)t[n++]()};if("object"==typeof process&&process.nextTick)return function(t){n(t)&&process.nextTick(i)};if(t.setImmediate)return function(e){n(e)&&t.setImmediate(i)};if(t.postMessage&&!t.opera){var o=!0;if(t.attachEvent){var r=function(){o=!1};t.attachEvent("onmessage",r),t.postMessage("__checkAsync","*"),t.detachEvent("onmessage",r)}if(o){var s="__modules"+ +new Date,a=function(t){t.data===s&&(t.stopPropagation&&t.stopPropagation(),i())};return t.addEventListener?t.addEventListener("message",a,!0):t.attachEvent("onmessage",a),function(e){n(e)&&t.postMessage(s,"*")}}}var u=t.document;if("onreadystatechange"in u.createElement("script")){var l=u.getElementsByTagName("head")[0],c=function(){var t=u.createElement("script");t.onreadystatechange=function(){t.parentNode.removeChild(t),t=t.onreadystatechange=null,i()},l.appendChild(t)};return function(t){n(t)&&c()}}return function(t){n(t)&&setTimeout(i,0)}}();"object"==typeof exports?module.exports=i():t.modules=i()}(this),function(t){var e,n={className:"autosizejs",id:"autosizejs",append:"\n",callback:!1,resizeDelay:10,placeholder:!0},i='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',o=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],r=t(i).data("autosize",!0)[0];r.style.lineHeight="99px","99px"===t(r).css("lineHeight")&&o.push("lineHeight"),r.style.lineHeight="",t.fn.autosize=function(i){return this.length?(i=t.extend({},n,i||{}),r.parentNode!==document.body&&t(document.body).append(r),this.each(function(){function n(){var e,n=window.getComputedStyle?window.getComputedStyle(h,null):!1;n?(e=h.getBoundingClientRect().width,0!==e&&"number"==typeof e||(e=parseInt(n.width,10)),t.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(t,i){e-=parseInt(n[i],10)})):e=p.width(),r.style.width=Math.max(e,0)+"px"}function s(){var s={};if(e=h,r.className=i.className,r.id=i.id,l=parseInt(p.css("maxHeight"),10),t.each(o,function(t,e){s[e]=p.css(e)}),t(r).css(s).attr("wrap",p.attr("wrap")),n(),window.chrome){var a=h.style.width;h.style.width="0px";h.offsetWidth;h.style.width=a}}function a(){var t,o;e!==h?s():n(),!h.value&&i.placeholder?r.value=(p.attr("placeholder")||"")+i.append:r.value=h.value+i.append,r.style.overflowY=h.style.overflowY,o=parseInt(h.style.height,10),r.scrollTop=0,r.scrollTop=9e4,t=r.scrollTop-parseInt(r.style.lineHeight,10),l&&t>l?(h.style.overflowY="scroll",t=l):(h.style.overflowY="hidden",c>t&&(t=c)),t+=f,o!==t&&(h.style.height=t+"px",m&&i.callback.call(h,h))}function u(){clearTimeout(d),d=setTimeout(function(){var t=p.width();b=t,a()},parseInt(i.resizeDelay,10))}var l,c,d,h=this,p=t(h),f=0,m=t.isFunction(i.callback),g={height:h.style.height,overflow:h.style.overflow,overflowY:h.style.overflowY,wordWrap:h.style.wordWrap,resize:h.style.resize},b=p.width(),_=p.css("resize");p.data("autosize")||(p.data("autosize",!0),"border-box"!==p.css("box-sizing")&&"border-box"!==p.css("-moz-box-sizing")&&"border-box"!==p.css("-webkit-box-sizing")||(f=p.outerHeight()-p.height()),c=c=Math.min(parseInt(p.css("minHeight"),10)-f||0,p.height()),p.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word"}),"vertical"===_?p.css("resize","none"):"both"===_&&p.css("resize","horizontal"),"onpropertychange"in h?"oninput"in h?p.on("input.autosize keyup.autosize",a):p.on("propertychange.autosize",function(){"value"===event.propertyName&&a()}):p.on("input.autosize",a),i.resizeDelay!==!1&&t(window).on("resize.autosize",u),p.on("autosize.resize",a),p.on("autosize.resizeIncludeStyle",function(){e=null,a()}),p.on("autosize.destroy",function(){e=null,clearTimeout(d),t(window).off("resize",u),p.off("autosize").off(".autosize").css(g).removeData("autosize")}),a())})):this}}(window.jQuery||window.$),function(t,e){function n(t,e,n){var i=t.children(),o=!1;t.empty();for(var s=0,a=i.length;a>s;s++){var u=i.eq(s);if(t.append(u),n&&t.append(n),r(t,e)){u.remove(),o=!0;break}n&&n.detach()}return o}function i(e,n,s,a,u){var l=!1,c="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",d="script, .dotdotdot-keep";return e.contents().detach().each(function(){var h=this,p=t(h);if("undefined"==typeof h||3==h.nodeType&&0==t.trim(h.data).length)return!0;if(p.is(d))e.append(p);else{if(l)return!0;e.append(p),u&&e[e.is(c)?"after":"append"](u),r(s,a)&&(l=3==h.nodeType?o(p,n,s,a,u):i(p,n,s,a,u),l||(p.detach(),l=!0)),l||u&&u.detach()}}),l}function o(e,n,i,o,a){var c=e[0];if(!c)return!1;var h=l(c),p=-1!==h.indexOf(" ")?" ":"",f="letter"==o.wrap?"":p,m=h.split(f),g=-1,b=-1,_=0,y=m.length-1;for(o.fallbackToLetter&&0==_&&0==y&&(f="",m=h.split(f),y=m.length-1);y>=_&&(0!=_||0!=y);){var v=Math.floor((_+y)/2);if(v==b)break;b=v,u(c,m.slice(0,b+1).join(f)+o.ellipsis),r(i,o)?(y=b,o.fallbackToLetter&&0==_&&0==y&&(f="",m=m[0].split(f),g=-1,b=-1,_=0,y=m.length-1)):(g=b,_=b)}if(-1==g||1==m.length&&0==m[0].length){var w=e.parent();e.detach();var k=a&&a.closest(w).length?a.length:0;w.contents().length>k?c=d(w.contents().eq(-1-k),n):(c=d(w,n,!0),k||w.detach()),c&&(h=s(l(c),o),u(c,h),k&&a&&t(c).parent().append(a))}else h=s(m.slice(0,g+1).join(f),o),u(c,h);return!0}function r(t,e){return t.innerHeight()>e.maxHeight}function s(e,n){for(;t.inArray(e.slice(-1),n.lastCharacter.remove)>-1;)e=e.slice(0,-1);return t.inArray(e.slice(-1),n.lastCharacter.noEllipsis)<0&&(e+=n.ellipsis),e}function a(t){return{width:t.innerWidth(),height:t.innerHeight()}}function u(t,e){t.innerText?t.innerText=e:t.nodeValue?t.nodeValue=e:t.textContent&&(t.textContent=e)}function l(t){return t.innerText?t.innerText:t.nodeValue?t.nodeValue:t.textContent?t.textContent:""}function c(t){do t=t.previousSibling;while(t&&1!==t.nodeType&&3!==t.nodeType);return t}function d(e,n,i){var o,r=e&&e[0];if(r){if(!i){if(3===r.nodeType)return r;if(t.trim(e.text()))return d(e.contents().last(),n)}for(o=c(r);!o;){if(e=e.parent(),e.is(n)||!e.length)return!1;o=c(e[0])}if(o)return d(t(o),n)}return!1}function h(e,n){return e?"string"==typeof e?(e=t(e,n),e.length?e:!1):e.jquery?e:!1:!1}function p(t){for(var e=t.innerHeight(),n=["paddingTop","paddingBottom"],i=0,o=n.length;o>i;i++){var r=parseInt(t.css(n[i]),10);isNaN(r)&&(r=0),e-=r}return e}if(!t.fn.dotdotdot){t.fn.dotdotdot=function(e){if(0==this.length)return t.fn.dotdotdot.debug('No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){t(this).dotdotdot(e)});var o=this;o.data("dotdotdot")&&o.trigger("destroy.dot"),o.data("dotdotdot-style",o.attr("style")||""),o.css("word-wrap","break-word"),"nowrap"===o.css("white-space")&&o.css("white-space","normal"),o.bind_events=function(){return o.bind("update.dot",function(e,a){e.preventDefault(),e.stopPropagation(),u.maxHeight="number"==typeof u.height?u.height:p(o),u.maxHeight+=u.tolerance,"undefined"!=typeof a&&(("string"==typeof a||a instanceof HTMLElement)&&(a=t("<div />").append(a).contents()),a instanceof t&&(s=a)),m=o.wrapInner('<div class="dotdotdot" />').children(),m.contents().detach().end().append(s.clone(!0)).find("br").replaceWith("  <br />  ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var c=!1,d=!1;return l.afterElement&&(c=l.afterElement.clone(!0),c.show(),l.afterElement.detach()),r(m,u)&&(d="children"==u.wrap?n(m,u,c):i(m,o,m,u,c)),m.replaceWith(m.contents()),m=null,t.isFunction(u.callback)&&u.callback.call(o[0],d,s),l.isTruncated=d,d}).bind("isTruncated.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(o[0],l.isTruncated),l.isTruncated}).bind("originalContent.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(o[0],s),s}).bind("destroy.dot",function(t){t.preventDefault(),t.stopPropagation(),o.unwatch().unbind_events().contents().detach().end().append(s).attr("style",o.data("dotdotdot-style")||"").data("dotdotdot",!1)}),o},o.unbind_events=function(){return o.unbind(".dot"),o},o.watch=function(){if(o.unwatch(),"window"==u.watch){var e=t(window),n=e.width(),i=e.height();e.bind("resize.dot"+l.dotId,function(){n==e.width()&&i==e.height()&&u.windowResizeFix||(n=e.width(),i=e.height(),d&&clearInterval(d),d=setTimeout(function(){o.trigger("update.dot")},100))})}else c=a(o),d=setInterval(function(){if(o.is(":visible")){var t=a(o);c.width==t.width&&c.height==t.height||(o.trigger("update.dot"),c=t)}},500);return o},o.unwatch=function(){return t(window).unbind("resize.dot"+l.dotId),d&&clearInterval(d),o};var s=o.contents(),u=t.extend(!0,{},t.fn.dotdotdot.defaults,e),l={},c={},d=null,m=null;return u.lastCharacter.remove instanceof Array||(u.lastCharacter.remove=t.fn.dotdotdot.defaultArrays.lastCharacter.remove),u.lastCharacter.noEllipsis instanceof Array||(u.lastCharacter.noEllipsis=t.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),l.afterElement=h(u.after,o),l.isTruncated=!1,l.dotId=f++,o.data("dotdotdot",!0).bind_events().trigger("update.dot"),u.watch&&o.watch(),o},t.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0},t.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","",",",";",".","!","?"],noEllipsis:[]}},t.fn.dotdotdot.debug=function(t){};var f=1,m=t.fn.html;t.fn.html=function(n){return n!=e&&!t.isFunction(n)&&this.data("dotdotdot")?this.trigger("update",[n]):m.apply(this,arguments)};var g=t.fn.text;t.fn.text=function(n){return n!=e&&!t.isFunction(n)&&this.data("dotdotdot")?(n=t("<div />").text(n).html(),this.trigger("update",[n])):g.apply(this,arguments)}}}(jQuery);var twemoji=function(){"use strict";function t(t){return document.createTextNode(t)}function e(t,e){return"".concat(e.base,e.size,"/",t,e.ext)}function n(t,e){for(var i,o,r=t.childNodes,s=r.length;s--;)i=r[s],o=i.nodeType,3===o?e.push(i):1!==o||f.test(i.nodeName)||n(i,e);return e}function i(t,e){return d(""===e?t.slice(0,-1):3===t.length&&""===t.charAt(1)?t.charAt(0)+t.charAt(2):t)}function o(e,o){for(var r,s,a,u,l,c,d,f,m,g,b,_,y=n(e,[]),v=y.length;v--;){for(r=!1,s=document.createDocumentFragment(),a=y[v],u=a.nodeValue,c=0;l=p.exec(u);)d=l.index,d!==c&&s.appendChild(t(u.slice(c,d))),m=l[0],g=l[1],b=l[2],c=d+m.length,""!==b&&(_=o.callback(i(g,b),o,b),_&&(f=new Image,f.onerror=h.onerror,f.className=o.className,f.setAttribute("draggable","false"),f.alt=m,f.src=_,r=!0,s.appendChild(f))),f||s.appendChild(t(m)),f=null;r&&(c<u.length&&s.appendChild(t(u.slice(c))),a.parentNode.replaceChild(s,a))}return e}function r(t,e){return l(t,function(t,n,o){var r;return""!==o&&(r=e.callback(i(n,o),e,o),r&&(t="<img ".concat('class="',e.className,'" ','draggable="false" ','alt="',t,'" ','src="',r,'"',">"))),t})}function s(t){return"number"==typeof t?t+"x"+t:t}function a(t){var e="string"==typeof t?parseInt(t,16):t;return 65536>e?m(e):(e-=65536,m(55296+(e>>10),56320+(1023&e)))}function u(t,n){return n&&"function"!=typeof n||(n={callback:n}),("string"==typeof t?r:o)(t,{callback:n.callback||e,base:"string"==typeof n.base?n.base:h.base,ext:n.ext||h.ext,size:n.folder||s(n.size||h.size),className:n.className||h.className})}function l(t,e){return String(t).replace(p,e)}function c(t){p.lastIndex=0;var e=p.test(t);return p.lastIndex=0,e}function d(t,e){for(var n=[],i=0,o=0,r=0;r<t.length;)i=t.charCodeAt(r++),o?(n.push((65536+(o-55296<<10)+(i-56320)).toString(16)),o=0):i>=55296&&56319>=i?o=i:n.push(i.toString(16));return n.join(e||"-")}var h={base:("https:"===location.protocol?"https:":"http:")+"//twemoji.maxcdn.com/",ext:".png",size:"36x36",className:"emoji",convert:{fromCodePoint:a,toCodePoint:d},onerror:function(){this.parentNode&&this.parentNode.replaceChild(t(this.alt),this)},parse:u,replace:l,test:c},p=/((?:\ud83c\udde8\ud83c\uddf3|\ud83c\uddfa\ud83c\uddf8|\ud83c\uddf7\ud83c\uddfa|\ud83c\uddf0\ud83c\uddf7|\ud83c\uddef\ud83c\uddf5|\ud83c\uddee\ud83c\uddf9|\ud83c\uddec\ud83c\udde7|\ud83c\uddeb\ud83c\uddf7|\ud83c\uddea\ud83c\uddf8|\ud83c\udde9\ud83c\uddea|\u0039\ufe0f?\u20e3|\u0038\ufe0f?\u20e3|\u0037\ufe0f?\u20e3|\u0036\ufe0f?\u20e3|\u0035\ufe0f?\u20e3|\u0034\ufe0f?\u20e3|\u0033\ufe0f?\u20e3|\u0032\ufe0f?\u20e3|\u0031\ufe0f?\u20e3|\u0030\ufe0f?\u20e3|\u0023\ufe0f?\u20e3|\ud83d\udeb3|\ud83d\udeb1|\ud83d\udeb0|\ud83d\udeaf|\ud83d\udeae|\ud83d\udea6|\ud83d\udea3|\ud83d\udea1|\ud83d\udea0|\ud83d\ude9f|\ud83d\ude9e|\ud83d\ude9d|\ud83d\ude9c|\ud83d\ude9b|\ud83d\ude98|\ud83d\ude96|\ud83d\ude94|\ud83d\ude90|\ud83d\ude8e|\ud83d\ude8d|\ud83d\ude8b|\ud83d\ude8a|\ud83d\ude88|\ud83d\ude86|\ud83d\ude82|\ud83d\ude81|\ud83d\ude36|\ud83d\ude34|\ud83d\ude2f|\ud83d\ude2e|\ud83d\ude2c|\ud83d\ude27|\ud83d\ude26|\ud83d\ude1f|\ud83d\ude1b|\ud83d\ude19|\ud83d\ude17|\ud83d\ude15|\ud83d\ude11|\ud83d\ude10|\ud83d\ude0e|\ud83d\ude08|\ud83d\ude07|\ud83d\ude00|\ud83d\udd67|\ud83d\udd66|\ud83d\udd65|\ud83d\udd64|\ud83d\udd63|\ud83d\udd62|\ud83d\udd61|\ud83d\udd60|\ud83d\udd5f|\ud83d\udd5e|\ud83d\udd5d|\ud83d\udd5c|\ud83d\udd2d|\ud83d\udd2c|\ud83d\udd15|\ud83d\udd09|\ud83d\udd08|\ud83d\udd07|\ud83d\udd06|\ud83d\udd05|\ud83d\udd04|\ud83d\udd02|\ud83d\udd01|\ud83d\udd00|\ud83d\udcf5|\ud83d\udcef|\ud83d\udced|\ud83d\udcec|\ud83d\udcb7|\ud83d\udcb6|\ud83d\udcad|\ud83d\udc6d|\ud83d\udc6c|\ud83d\udc65|\ud83d\udc2a|\ud83d\udc16|\ud83d\udc15|\ud83d\udc13|\ud83d\udc10|\ud83d\udc0f|\ud83d\udc0b|\ud83d\udc0a|\ud83d\udc09|\ud83d\udc08|\ud83d\udc07|\ud83d\udc06|\ud83d\udc05|\ud83d\udc04|\ud83d\udc03|\ud83d\udc02|\ud83d\udc01|\ud83d\udc00|\ud83c\udfe4|\ud83c\udfc9|\ud83c\udfc7|\ud83c\udf7c|\ud83c\udf50|\ud83c\udf4b|\ud83c\udf33|\ud83c\udf32|\ud83c\udf1e|\ud83c\udf1d|\ud83c\udf1c|\ud83c\udf1a|\ud83c\udf18|\ud83c\udccf|\ud83c\udd70|\ud83c\udd71|\ud83c\udd7e|\ud83c\udd8e|\ud83c\udd91|\ud83c\udd92|\ud83c\udd93|\ud83c\udd94|\ud83c\udd95|\ud83c\udd96|\ud83c\udd97|\ud83c\udd98|\ud83c\udd99|\ud83c\udd9a|\ud83d\udc77|\ud83d\udec5|\ud83d\udec4|\ud83d\udec3|\ud83d\udec2|\ud83d\udec1|\ud83d\udebf|\ud83d\udeb8|\ud83d\udeb7|\ud83d\udeb5|\ud83c\ude01|\ud83c\ude02|\ud83c\ude32|\ud83c\ude33|\ud83c\ude34|\ud83c\ude35|\ud83c\ude36|\ud83c\ude37|\ud83c\ude38|\ud83c\ude39|\ud83c\ude3a|\ud83c\ude50|\ud83c\ude51|\ud83c\udf00|\ud83c\udf01|\ud83c\udf02|\ud83c\udf03|\ud83c\udf04|\ud83c\udf05|\ud83c\udf06|\ud83c\udf07|\ud83c\udf08|\ud83c\udf09|\ud83c\udf0a|\ud83c\udf0b|\ud83c\udf0c|\ud83c\udf0f|\ud83c\udf11|\ud83c\udf13|\ud83c\udf14|\ud83c\udf15|\ud83c\udf19|\ud83c\udf1b|\ud83c\udf1f|\ud83c\udf20|\ud83c\udf30|\ud83c\udf31|\ud83c\udf34|\ud83c\udf35|\ud83c\udf37|\ud83c\udf38|\ud83c\udf39|\ud83c\udf3a|\ud83c\udf3b|\ud83c\udf3c|\ud83c\udf3d|\ud83c\udf3e|\ud83c\udf3f|\ud83c\udf40|\ud83c\udf41|\ud83c\udf42|\ud83c\udf43|\ud83c\udf44|\ud83c\udf45|\ud83c\udf46|\ud83c\udf47|\ud83c\udf48|\ud83c\udf49|\ud83c\udf4a|\ud83c\udf4c|\ud83c\udf4d|\ud83c\udf4e|\ud83c\udf4f|\ud83c\udf51|\ud83c\udf52|\ud83c\udf53|\ud83c\udf54|\ud83c\udf55|\ud83c\udf56|\ud83c\udf57|\ud83c\udf58|\ud83c\udf59|\ud83c\udf5a|\ud83c\udf5b|\ud83c\udf5c|\ud83c\udf5d|\ud83c\udf5e|\ud83c\udf5f|\ud83c\udf60|\ud83c\udf61|\ud83c\udf62|\ud83c\udf63|\ud83c\udf64|\ud83c\udf65|\ud83c\udf66|\ud83c\udf67|\ud83c\udf68|\ud83c\udf69|\ud83c\udf6a|\ud83c\udf6b|\ud83c\udf6c|\ud83c\udf6d|\ud83c\udf6e|\ud83c\udf6f|\ud83c\udf70|\ud83c\udf71|\ud83c\udf72|\ud83c\udf73|\ud83c\udf74|\ud83c\udf75|\ud83c\udf76|\ud83c\udf77|\ud83c\udf78|\ud83c\udf79|\ud83c\udf7a|\ud83c\udf7b|\ud83c\udf80|\ud83c\udf81|\ud83c\udf82|\ud83c\udf83|\ud83c\udf84|\ud83c\udf85|\ud83c\udf86|\ud83c\udf87|\ud83c\udf88|\ud83c\udf89|\ud83c\udf8a|\ud83c\udf8b|\ud83c\udf8c|\ud83c\udf8d|\ud83c\udf8e|\ud83c\udf8f|\ud83c\udf90|\ud83c\udf91|\ud83c\udf92|\ud83c\udf93|\ud83c\udfa0|\ud83c\udfa1|\ud83c\udfa2|\ud83c\udfa3|\ud83c\udfa4|\ud83c\udfa5|\ud83c\udfa6|\ud83c\udfa7|\ud83c\udfa8|\ud83c\udfa9|\ud83c\udfaa|\ud83c\udfab|\ud83c\udfac|\ud83c\udfad|\ud83c\udfae|\ud83c\udfaf|\ud83c\udfb0|\ud83c\udfb1|\ud83c\udfb2|\ud83c\udfb3|\ud83c\udfb4|\ud83c\udfb5|\ud83c\udfb6|\ud83c\udfb7|\ud83c\udfb8|\ud83c\udfb9|\ud83c\udfba|\ud83c\udfbb|\ud83c\udfbc|\ud83c\udfbd|\ud83c\udfbe|\ud83c\udfbf|\ud83c\udfc0|\ud83c\udfc1|\ud83c\udfc2|\ud83c\udfc3|\ud83c\udfc4|\ud83c\udfc6|\ud83c\udfc8|\ud83c\udfca|\ud83c\udfe0|\ud83c\udfe1|\ud83c\udfe2|\ud83c\udfe3|\ud83c\udfe5|\ud83c\udfe6|\ud83c\udfe7|\ud83c\udfe8|\ud83c\udfe9|\ud83c\udfea|\ud83c\udfeb|\ud83c\udfec|\ud83c\udfed|\ud83c\udfee|\ud83c\udfef|\ud83c\udff0|\ud83d\udc0c|\ud83d\udc0d|\ud83d\udc0e|\ud83d\udc11|\ud83d\udc12|\ud83d\udc14|\ud83d\udc17|\ud83d\udc18|\ud83d\udc19|\ud83d\udc1a|\ud83d\udc1b|\ud83d\udc1c|\ud83d\udc1d|\ud83d\udc1e|\ud83d\udc1f|\ud83d\udc20|\ud83d\udc21|\ud83d\udc22|\ud83d\udc23|\ud83d\udc24|\ud83d\udc25|\ud83d\udc26|\ud83d\udc27|\ud83d\udc28|\ud83d\udc29|\ud83d\udc2b|\ud83d\udc2c|\ud83d\udc2d|\ud83d\udc2e|\ud83d\udc2f|\ud83d\udc30|\ud83d\udc31|\ud83d\udc32|\ud83d\udc33|\ud83d\udc34|\ud83d\udc35|\ud83d\udc36|\ud83d\udc37|\ud83d\udc38|\ud83d\udc39|\ud83d\udc3a|\ud83d\udc3b|\ud83d\udc3c|\ud83d\udc3d|\ud83d\udc3e|\ud83d\udc40|\ud83d\udc42|\ud83d\udc43|\ud83d\udc44|\ud83d\udc45|\ud83d\udc46|\ud83d\udc47|\ud83d\udc48|\ud83d\udc49|\ud83d\udc4a|\ud83d\udc4b|\ud83d\udc4c|\ud83d\udc4d|\ud83d\udc4e|\ud83d\udc4f|\ud83d\udc50|\ud83d\udc51|\ud83d\udc52|\ud83d\udc53|\ud83d\udc54|\ud83d\udc55|\ud83d\udc56|\ud83d\udc57|\ud83d\udc58|\ud83d\udc59|\ud83d\udc5a|\ud83d\udc5b|\ud83d\udc5c|\ud83d\udc5d|\ud83d\udc5e|\ud83d\udc5f|\ud83d\udc60|\ud83d\udc61|\ud83d\udc62|\ud83d\udc63|\ud83d\udc64|\ud83d\udc66|\ud83d\udc67|\ud83d\udc68|\ud83d\udc69|\ud83d\udc6a|\ud83d\udc6b|\ud83d\udc6e|\ud83d\udc6f|\ud83d\udc70|\ud83d\udc71|\ud83d\udc72|\ud83d\udc73|\ud83d\udc74|\ud83d\udc75|\ud83d\udc76|\ud83d\udeb4|\ud83d\udc78|\ud83d\udc79|\ud83d\udc7a|\ud83d\udc7b|\ud83d\udc7c|\ud83d\udc7d|\ud83d\udc7e|\ud83d\udc7f|\ud83d\udc80|\ud83d\udc81|\ud83d\udc82|\ud83d\udc83|\ud83d\udc84|\ud83d\udc85|\ud83d\udc86|\ud83d\udc87|\ud83d\udc88|\ud83d\udc89|\ud83d\udc8a|\ud83d\udc8b|\ud83d\udc8c|\ud83d\udc8d|\ud83d\udc8e|\ud83d\udc8f|\ud83d\udc90|\ud83d\udc91|\ud83d\udc92|\ud83d\udc93|\ud83d\udc94|\ud83d\udc95|\ud83d\udc96|\ud83d\udc97|\ud83d\udc98|\ud83d\udc99|\ud83d\udc9a|\ud83d\udc9b|\ud83d\udc9c|\ud83d\udc9d|\ud83d\udc9e|\ud83d\udc9f|\ud83d\udca0|\ud83d\udca1|\ud83d\udca2|\ud83d\udca3|\ud83d\udca4|\ud83d\udca5|\ud83d\udca6|\ud83d\udca7|\ud83d\udca8|\ud83d\udca9|\ud83d\udcaa|\ud83d\udcab|\ud83d\udcac|\ud83d\udcae|\ud83d\udcaf|\ud83d\udcb0|\ud83d\udcb1|\ud83d\udcb2|\ud83d\udcb3|\ud83d\udcb4|\ud83d\udcb5|\ud83d\udcb8|\ud83d\udcb9|\ud83d\udcba|\ud83d\udcbb|\ud83d\udcbc|\ud83d\udcbd|\ud83d\udcbe|\ud83d\udcbf|\ud83d\udcc0|\ud83d\udcc1|\ud83d\udcc2|\ud83d\udcc3|\ud83d\udcc4|\ud83d\udcc5|\ud83d\udcc6|\ud83d\udcc7|\ud83d\udcc8|\ud83d\udcc9|\ud83d\udcca|\ud83d\udccb|\ud83d\udccc|\ud83d\udccd|\ud83d\udcce|\ud83d\udccf|\ud83d\udcd0|\ud83d\udcd1|\ud83d\udcd2|\ud83d\udcd3|\ud83d\udcd4|\ud83d\udcd5|\ud83d\udcd6|\ud83d\udcd7|\ud83d\udcd8|\ud83d\udcd9|\ud83d\udcda|\ud83d\udcdb|\ud83d\udcdc|\ud83d\udcdd|\ud83d\udcde|\ud83d\udcdf|\ud83d\udce0|\ud83d\udce1|\ud83d\udce2|\ud83d\udce3|\ud83d\udce4|\ud83d\udce5|\ud83d\udce6|\ud83d\udce7|\ud83d\udce8|\ud83d\udce9|\ud83d\udcea|\ud83d\udceb|\ud83d\udcee|\ud83d\udcf0|\ud83d\udcf1|\ud83d\udcf2|\ud83d\udcf3|\ud83d\udcf4|\ud83d\udcf6|\ud83d\udcf7|\ud83d\udcf9|\ud83d\udcfa|\ud83d\udcfb|\ud83d\udcfc|\ud83d\udd03|\ud83d\udd0a|\ud83d\udd0b|\ud83d\udd0c|\ud83d\udd0d|\ud83d\udd0e|\ud83d\udd0f|\ud83d\udd10|\ud83d\udd11|\ud83d\udd12|\ud83d\udd13|\ud83d\udd14|\ud83d\udd16|\ud83d\udd17|\ud83d\udd18|\ud83d\udd19|\ud83d\udd1a|\ud83d\udd1b|\ud83d\udd1c|\ud83d\udd1d|\ud83d\udd1e|\ud83d\udd1f|\ud83d\udd20|\ud83d\udd21|\ud83d\udd22|\ud83d\udd23|\ud83d\udd24|\ud83d\udd25|\ud83d\udd26|\ud83d\udd27|\ud83d\udd28|\ud83d\udd29|\ud83d\udd2a|\ud83d\udd2b|\ud83d\udd2e|\ud83d\udd2f|\ud83d\udd30|\ud83d\udd31|\ud83d\udd32|\ud83d\udd33|\ud83d\udd34|\ud83d\udd35|\ud83d\udd36|\ud83d\udd37|\ud83d\udd38|\ud83d\udd39|\ud83d\udd3a|\ud83d\udd3b|\ud83d\udd3c|\ud83d\udd3d|\ud83d\udd50|\ud83d\udd51|\ud83d\udd52|\ud83d\udd53|\ud83d\udd54|\ud83d\udd55|\ud83d\udd56|\ud83d\udd57|\ud83d\udd58|\ud83d\udd59|\ud83d\udd5a|\ud83d\udd5b|\ud83d\uddfb|\ud83d\uddfc|\ud83d\uddfd|\ud83d\uddfe|\ud83d\uddff|\ud83d\ude01|\ud83d\ude02|\ud83d\ude03|\ud83d\ude04|\ud83d\ude05|\ud83d\ude06|\ud83d\ude09|\ud83d\ude0a|\ud83d\ude0b|\ud83d\ude0c|\ud83d\ude0d|\ud83d\ude0f|\ud83d\ude12|\ud83d\ude13|\ud83d\ude14|\ud83d\ude16|\ud83d\ude18|\ud83d\ude1a|\ud83d\ude1c|\ud83d\ude1d|\ud83d\ude1e|\ud83d\ude20|\ud83d\ude21|\ud83d\ude22|\ud83d\ude23|\ud83d\ude24|\ud83d\ude25|\ud83d\ude28|\ud83d\ude29|\ud83d\ude2a|\ud83d\ude2b|\ud83d\ude2d|\ud83d\ude30|\ud83d\ude31|\ud83d\ude32|\ud83d\ude33|\ud83d\ude35|\ud83d\ude37|\ud83d\ude38|\ud83d\ude39|\ud83d\ude3a|\ud83d\ude3b|\ud83d\ude3c|\ud83d\ude3d|\ud83d\ude3e|\ud83d\ude3f|\ud83d\ude40|\ud83d\ude45|\ud83d\ude46|\ud83d\ude47|\ud83d\ude48|\ud83d\ude49|\ud83d\ude4a|\ud83d\ude4b|\ud83d\ude4c|\ud83d\ude4d|\ud83d\ude4e|\ud83d\ude4f|\ud83d\ude80|\ud83d\ude83|\ud83d\ude84|\ud83d\ude85|\ud83d\ude87|\ud83d\ude89|\ud83d\ude8c|\ud83d\ude8f|\ud83d\ude91|\ud83d\ude92|\ud83d\ude93|\ud83d\ude95|\ud83d\ude97|\ud83d\ude99|\ud83d\ude9a|\ud83d\udea2|\ud83d\udea4|\ud83d\udea5|\ud83d\udea7|\ud83d\udea8|\ud83d\udea9|\ud83d\udeaa|\ud83d\udeab|\ud83d\udeac|\ud83d\udead|\ud83d\udeb2|\ud83d\udeb6|\ud83d\udeb9|\ud83d\udeba|\ud83d\udebb|\ud83d\udebc|\ud83d\udebd|\ud83d\udebe|\ud83d\udec0|\ud83c\udde6|\ud83c\udde7|\ud83c\udde8|\ud83c\udde9|\ud83c\uddea|\ud83c\uddeb|\ud83c\uddec|\ud83c\udded|\ud83c\uddee|\ud83c\uddef|\ud83c\uddf0|\ud83c\uddf1|\ud83c\uddf2|\ud83c\uddf3|\ud83c\uddf4|\ud83c\uddf5|\ud83c\uddf6|\ud83c\uddf7|\ud83c\uddf8|\ud83c\uddf9|\ud83c\uddfa|\ud83c\uddfb|\ud83c\uddfc|\ud83c\uddfd|\ud83c\uddfe|\ud83c\uddff|\ud83c\udf0d|\ud83c\udf0e|\ud83c\udf10|\ud83c\udf12|\ud83c\udf16|\ud83c\udf17|\ue50a|\u3030|\u27b0|\u2797|\u2796|\u2795|\u2755|\u2754|\u2753|\u274e|\u274c|\u2728|\u270b|\u270a|\u2705|\u26ce|\u23f3|\u23f0|\u23ec|\u23eb|\u23ea|\u23e9|\u2122|\u27bf|\u00a9|\u00ae)|(?:(?:\ud83c\udc04|\ud83c\udd7f|\ud83c\ude1a|\ud83c\ude2f|\u3299|\u303d|\u2b55|\u2b50|\u2b1c|\u2b1b|\u2b07|\u2b06|\u2b05|\u2935|\u2934|\u27a1|\u2764|\u2757|\u2747|\u2744|\u2734|\u2733|\u2716|\u2714|\u2712|\u270f|\u270c|\u2709|\u2708|\u2702|\u26fd|\u26fa|\u26f5|\u26f3|\u26f2|\u26ea|\u26d4|\u26c5|\u26c4|\u26be|\u26bd|\u26ab|\u26aa|\u26a1|\u26a0|\u2693|\u267f|\u267b|\u3297|\u2666|\u2665|\u2663|\u2660|\u2653|\u2652|\u2651|\u2650|\u264f|\u264e|\u264d|\u264c|\u264b|\u264a|\u2649|\u2648|\u263a|\u261d|\u2615|\u2614|\u2611|\u260e|\u2601|\u2600|\u25fe|\u25fd|\u25fc|\u25fb|\u25c0|\u25b6|\u25ab|\u25aa|\u24c2|\u231b|\u231a|\u21aa|\u21a9|\u2199|\u2198|\u2197|\u2196|\u2195|\u2194|\u2139|\u2049|\u203c|\u2668)([\uFE0E\uFE0F]?)))/g,f=/IFRAME|NOFRAMES|NOSCRIPT|SCRIPT|SELECT|STYLE|TEXTAREA/,m=String.fromCharCode;return h}();!function(t,e){"use strict";"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.DeepDiff=e()}(this,function(t){"use strict";function e(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}function n(t,e){Object.defineProperty(this,"kind",{value:t,enumerable:!0}),e&&e.length&&Object.defineProperty(this,"path",{value:e,enumerable:!0})}function i(t,e,n){i.super_.call(this,"E",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function o(t,e){o.super_.call(this,"N",t),Object.defineProperty(this,"rhs",{value:e,enumerable:!0})}function r(t,e){r.super_.call(this,"D",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0})}function s(t,e,n){s.super_.call(this,"A",t),Object.defineProperty(this,"index",{value:e,enumerable:!0}),Object.defineProperty(this,"item",{value:n,enumerable:!0})}function a(t,e,n){var i=t.slice((n||e)+1||t.length);return t.length=0>e?t.length+e:e,t.push.apply(t,i),t}function u(t){var e=typeof t;return"object"!==e?e:t===Math?"math":null===t?"null":Array.isArray(t)?"array":t instanceof Date?"date":/^\/.*\//.test(t.toString())?"regexp":"object"}function l(e,n,c,d,h,p,f){h=h||[];var m=h.slice(0);if("undefined"!=typeof p){if(d&&d(m,p,{lhs:e,rhs:n}))return;m.push(p)}var g=typeof e,b=typeof n;if("undefined"===g)"undefined"!==b&&c(new o(m,n));else if("undefined"===b)c(new r(m,e));else if(u(e)!==u(n))c(new i(m,e,n));else if(e instanceof Date&&n instanceof Date&&e-n!==0)c(new i(m,e,n));else if("object"===g&&null!==e&&null!==n){if(f=f||[],f.indexOf(e)<0){if(f.push(e),Array.isArray(e)){var _;e.length;for(_=0;_<e.length;_++)_>=n.length?c(new s(m,_,new r(t,e[_]))):l(e[_],n[_],c,d,m,_,f);for(;_<n.length;)c(new s(m,_,new o(t,n[_++])))}else{var y=Object.keys(e),v=Object.keys(n);y.forEach(function(i,o){var r=v.indexOf(i);r>=0?(l(e[i],n[i],c,d,m,i,f),v=a(v,r)):l(e[i],t,c,d,m,i,f)}),v.forEach(function(e){l(t,n[e],c,d,m,e,f)})}f.length=f.length-1}}else e!==n&&("number"===g&&isNaN(e)&&isNaN(n)||c(new i(m,e,n)))}function c(e,n,i,o){return o=o||[],l(e,n,function(t){t&&o.push(t)},i),o.length?o:t}function d(t,e,n){if(n.path&&n.path.length){var i,o=t[e],r=n.path.length-1;for(i=0;r>i;i++)o=o[n.path[i]];switch(n.kind){case"A":d(o[n.path[i]],n.index,n.item);break;case"D":delete o[n.path[i]];break;case"E":case"N":o[n.path[i]]=n.rhs}}else switch(n.kind){case"A":d(t[e],n.index,n.item);break;case"D":t=a(t,e);break;case"E":case"N":t[e]=n.rhs}return t}function h(t,e,n){if(t&&e&&n&&n.kind){for(var i=t,o=-1,r=n.path.length-1;++o<r;)"undefined"==typeof i[n.path[o]]&&(i[n.path[o]]="number"==typeof n.path[o]?[]:{}),i=i[n.path[o]];switch(n.kind){case"A":d(i[n.path[o]],n.index,n.item);break;case"D":delete i[n.path[o]];break;case"E":case"N":i[n.path[o]]=n.rhs}}}function p(t,e,n){if(n.path&&n.path.length){var i,o=t[e],r=n.path.length-1;for(i=0;r>i;i++)o=o[n.path[i]];switch(n.kind){case"A":p(o[n.path[i]],n.index,n.item);break;case"D":o[n.path[i]]=n.lhs;break;case"E":o[n.path[i]]=n.lhs;break;case"N":delete o[n.path[i]]}}else switch(n.kind){case"A":p(t[e],n.index,n.item);break;case"D":t[e]=n.lhs;break;case"E":t[e]=n.lhs;break;case"N":t=a(t,e)}return t}function f(t,e,n){if(t&&e&&n&&n.kind){
var i,o,r=t;for(o=n.path.length-1,i=0;o>i;i++)"undefined"==typeof r[n.path[i]]&&(r[n.path[i]]={}),r=r[n.path[i]];switch(n.kind){case"A":p(r[n.path[i]],n.index,n.item);break;case"D":r[n.path[i]]=n.lhs;break;case"E":r[n.path[i]]=n.lhs;break;case"N":delete r[n.path[i]]}}}function m(t,e,n){if(t&&e){var i=function(i){n&&!n(t,e,i)||h(t,e,i)};l(t,e,i)}}var g,b,_=[];return g="object"==typeof global&&global?global:"undefined"!=typeof window?window:{},b=g.DeepDiff,b&&_.push(function(){"undefined"!=typeof b&&g.DeepDiff===c&&(g.DeepDiff=b,b=t)}),e(i,n),e(o,n),e(r,n),e(s,n),Object.defineProperties(c,{diff:{value:c,enumerable:!0},observableDiff:{value:l,enumerable:!0},applyDiff:{value:m,enumerable:!0},applyChange:{value:h,enumerable:!0},revertChange:{value:f,enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof b},enumerable:!0},noConflict:{value:function(){return _&&(_.forEach(function(t){t()}),_=null),c},enumerable:!0}}),c}),function(t,e,n,i){var o=function(e){t.BM=t.BM||{};var n,i,o=e.split("."),r=t.BM;for("BM"===o[0]&&(o=o.slice(1)),n=o.length,i=0;n>i;i++)"undefined"==typeof r[o[i]]&&(r[o[i]]={}),r=r[o[i]];return r},r=function(t){var e=o("BM");t(e)},s=o("BM.config"),a=function(t){t(s)},u=o("BM.features"),l=function(t){t(u)},c=o("BM.modules"),d=function(t){t(c)},h=o("BM.tools"),p=function(t){t(h)};h.extendApp=o,n.define("BM",[],r),n.define("tools",[],p),n.define("features",[],l),n.define("modules",[],d),n.define("config",[],a)}(this,this.document,this.modules),function(t,e,n,i,o){"use strict";var r=function(t,e,n){var i=function(){var t=function(){var t=n.mainConfig||{},e=t.abTests||[];return e},e=function(e){t();return o.hasItem(e)},i=function(t){return e(t)?o.getItem(t):!1};return{getTestValue:i}}();e.abTestDetect=i,t(i)};i.define("abTestDetect",["modules","config"],r)}(this,this.document,this.jQuery,this.modules,this.docCookies),function(t,e,n){n.ajaxSetup({timeout:3e4,statusCode:{404:function(){this.url},401:function(){},500:function(){this.url},503:function(){this.url},504:function(){this.url}},error:function(t,e,n){this.url;if("error"===t.statusText);else if("timeout"===e)return}})}(this,this.document,this.jQuery),function(t,e,n,i){var o=n.config=n.config||{},r=e.body.getAttribute("data-config"),s=i.parse(r)||{},a=function(t){var r=n.tools.isFunction(t)?t:function(){};$.ajax({url:"/frontend_config",dataType:"json",success:function(t){try{e.body.setAttribute("data-config",i.strigify(t))}catch(n){}o.mainConfig=t,r(t)},error:function(){r(!1)}})};o.updateMainConfig=a,o.mainConfig=s,o.isDevelopment=function(){return"development"===o.mainConfig.environment},o.isProduction=function(){return"production"===o.mainConfig.environment},o.isStaging=function(){return"staging"===o.mainConfig.environment}}(this,this.document,this.BM||{},this.JSON),function(t,e,n,i){var o=n.config=n.config||{},r=e.body.getAttribute("data-config"),s=i.parse(r)||{},a=s.debug||!1,u=!1;(a||e.location.search.match(/jsdbg/))&&(u=!0),o.debug=u}(this,this.document,this.BM||{},this.JSON),function(t,e,n,i,o){var r={TABLET:1023,MOBILE:639},s=i.tools=i.tools||{},a=function(){t.location.reload()},u=i.tools.client=i.tools.client||{},l="click",c=function(){return u.width?u.width:u.width=$(t).width()},d=function(){return-1!==n.appVersion.indexOf("Win")},h=function(){return-1!==n.appVersion.indexOf("Mac")},p=function(){return-1!==n.appVersion.indexOf("X11")},f=function(){return-1!==n.appVersion.indexOf("Linux")},m=function(){return"ontouchstart"in t||n.msMaxTouchPoints!==o},g=function(){return!v()&&/(iPad|iPhone|iPod)/g.test(t.navigator.userAgent)},b=function(e){return!v()&&-1!==t.navigator.userAgent.toLowerCase().indexOf("android")},y=function(){if(!b())return null;var e=t.navigator.userAgent.match(/android\s([0-9\.]*)/i);return e?parseFloat(e[1]):null},v=function(){return t.navigator.userAgent.match(/Windows Phone/i)},w=function(){return g()||b()||v()},k=function(){return n.userAgent.match(/Opera Mini/i)},C=function(){return n.userAgent.match(/googlebot/i)},S=function(){return c()<=r.TABLET},x=function(){return c()<=r.MOBILE};$(function(){FastClick.attach(e.body)}),$(t).on("resize",_.throttle(function(){u.width=$(t).width()},200)),s.reload=a,u.touchEvent=l,u.isWindows=d,u.isMacOS=h,u.isUnix=p,u.isLinux=f,u.isTouch=m,u.isiOS=g,u.isAndroid=b,u.getAndroidVersion=y,u.isWindowsPhone=v,u.isMobile=w,u.isOperaMini=k,u.isGoogleBot=C,u.isBreakpointTablet=S,u.isBreakpointMobile=x}(this,this.document,this.navigator,this.BM=this.BM||{}),function(t,e,n){var i=n.tools=n.tools||{},o=function r(t){var e,n,i,o;if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return e=new Date,e.setTime(t.getTime()),e;if(t instanceof Array){for(e=[],i=0,o=t.length;o>i;i++)e[i]=r(t[i]);return e}if(t instanceof Object){e={};for(n in t)t.hasOwnProperty(n)&&(e[n]=r(t[n]));return e}};i.clone=o}(this,this.document,this.BM=this.BM||{}),function(t,e){t.BM=t.BM||{},t.BM.tools=t.BM.tools||{},t.BM.tools.cloneExtend=function(t,n){if(e.tools.isPresent(t)&&e.tools.isPresent(n)){var i=e.tools.clone(t);return e.tools.mixin(i,n),i}}}(this,this.BM),function(t,e,n){var i=n.tools=n.tools||{},o=Array.prototype.slice,r=function(t,e){var n=o.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},s=function(t){return r.apply(_,[t,1].concat(o.call(arguments,1)))};i.defer=s}(this,this.document,this.BM=this.BM||{}),function(t,e){t.BM=t.BM||{},e.tools=e.tools||{},e.tools.diff=t.DeepDiff;try{delete t.DeepDiff}catch(n){}}(this,this.BM),function(t,e,n,i){n.tools=n.tools||{},n.tools.domHelper={tojQueryObject:function(e){return"string"==typeof e?i(e):e instanceof t.HTMLElement?i(e):e instanceof i?e:null}}}(this,this.document,this.BM=this.BM||{},this.jQuery),function(t,e,n){var i=function(t){var e=function(t){var e=function(){},n=function(){return this.initialize.apply(this,arguments)};return e.prototype=t.prototype,n.prototype=new e,n.prototype.constructor=n,n.superclass=e.prototype,n};t(e)};n.define("extend",[],i)}(this,this.document,this.modules),function(t){var e=BM.tools=BM.tools||{};e.debounce=function(t,e,n){var i;return function(){var o=this,r=arguments,s=function(){i=null,n||t.apply(o,r)},a=n&&!i;clearTimeout(i),i=setTimeout(s,e),a&&t.apply(o,r)}}}(this),function(t,e,n,i){var o=n.tools=n.tools||{},r=function(t){return"undefined"==typeof t},s=function(t){return null===t},a=function(t){return!o.isUndefined(t)&&!o.isNull(t)},u=function(t){return"number"==typeof t},l=function(t){return o.isNumber(t)?0!==t&&0===(t&t-1):!1},c=function(t){return null===t?!1:"object"==typeof t},d=function(t){return n.tools.isObject(t)&&!n.tools.isArray(t)&&!n.tools.isFunction(t)},h=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},p=function(t){return"[object Array]"===Object.prototype.toString.call(t)},f=function(t){return"string"==typeof t},m=function(t){return!!(t&&t.constructor&&t.call&&t.apply)},g=function(t){return!(!o.isFunction(t)||!t.superclass)},b=function(t){return o.isNull(t)?!1:o.isConstructor(t)?!1:!!o.isObject(t)},_=function(t,e){return t instanceof e},y=function(t){return t!==t},v=function(t){return!(!t||1!==t.nodeType)},w=function(t){return!!(t&&t.getTimezoneOffset&&t.setUTCFullYear)},k=function(t){return"boolean"==typeof t},C=function(t,e){var n,i,r,s,a;if(t===e)return!0;if(n=typeof t,i=typeof e,n!==i)return!1;if(t===e)return!0;if(!t&&e||t&&!e)return!1;if(o.isDate(t)&&o.isDate(e))return t.getTime()===e.getTime();if(o.isNaN(t)&&o.isNaN(e))return!1;if("object"!==n)return!1;if(t.length&&t.length!==e.length)return!1;if(o.isElement(t)||o.isElement(e))return!1;if(r=o.keys(t),s=o.keys(e),r.length!==s.length)return!1;for(a in t)if(!(a in e&&o.isEqual(t[a],e[a])))return!1;return!0},S=function(t){if(c(t)){if(p(t))return t.length>0;var e,n=Object.prototype.hasOwnProperty;for(e in t)if(n.call(t,e))return!1;return!0}},x=function(t){return n.tools.isPresent(t)?Object.getPrototypeOf(t)===Object.prototype:!1},E=function(t){return n.tools.isNull(t)||n.tools.isUndefined(t)||n.tools.isString(t)||n.tools.isBoolean(t)||n.tools.isNull(t)},P=function(t,e){return-1!==Object.getPrototypeOf(t).constructor.toString().indexOf(e)},T=function(t){return I(t)||A(t)||O(t)||B(t)},I=function(t){return n.tools.isFunction(t)?"model"===t.prototype.objectKind:!1},A=function(t){return n.tools.isFunction(t)?"collection"===t.prototype.objectKind:!1},B=function(t){return n.tools.isFunction(t)?"component"===t.prototype.objectKind:!1},O=function(t){return n.tools.isFunction(t)?"view"===t.prototype.objectKind:!1},M=function(t){return t?!(!t.objectKind||"collection"!==t.objectKind):!1},$=function(t){return t?!(!t.objectKind||"model"!==t.objectKind):!1},D=function(t){return t?!(!t.objectKind||"component"!==t.objectKind):!1},R=function(t){return t?!(!t.objectKind||"view"!==t.objectKind):!1},L=function(t){return $(t)||M(t)||R(t)||D(t)},F=function(t){return B(t)&&"item"===t.prototype.config.type},N=function(t){return B(t)&&"group"===t.prototype.config.type};o.isUndefined=r,o.isNull=s,o.isPresent=a,o.isNumber=u,o.isPowerOfTwo=l,o.isObject=c,o.isHash=d,o.isRegExp=h,o.isArray=Array.isArray||p,o.isString=f,o.isFunction=m,o.isConstructor=g,o.isInstance=b,o.isInstanceOf=_,o.isNaN=y,o.isElement=v,o.isDate=w,o.isBoolean=k,o.isEqual=C,o.isEmpty=S,o.isPlainObject=x,o.isPrimitive=E,o.isInstanceOfViaString=P,o.isMVCClass=T,o.isModelClass=I,o.isCollectionClass=A,o.isComponentClass=B,o.isViewClass=O,o.isMVCObject=L,o.isModel=$,o.isCollection=M,o.isComponent=D,o.isView=R,o.isComponentClassTypeItem=F,o.isComponentClassTypeGroup=N}(this,this.document,this.BM=this.BM||{}),function(t,e,n){var i=n.tools=n.tools||{},o=function(t){var e,n=[],i=Object.prototype.hasOwnProperty;for(e in t)i.call(t,e)&&(n[n.length]=e);return n};i.keys=Object.keys||o}(this,this.document,this.BM=this.BM||{}),function(t,e,n){var i=n.tools=n.tools||{},o=n.config=n.config||{},r=function(t){var e=o.loadScriptsConfig;e.hasOwnProperty(t)?e[t]():e["default"]()};i.loadScripts=r}(this,this.document,this.BM=this.BM||{}),function(t,e,n){var i=n.tools=n.tools||{},o=function(t){var n,i=e.createElement("script"),o=e.getElementsByTagName("script")[0];i.type="text/javascript",i.async=!0,i.src="/log-json";for(n in t)t.hasOwnProperty(n)&&(i.src+=-1!==i.src.indexOf("?")?"&":"?",i.src+=n+"="+t[n]);o.parentNode.insertBefore(i,o)};i.logToServer=o}(this,this.document,this.BM=this.BM||{}),function(t,e,n){var i=n.tools=n.tools||{},o=function(t,e){var n,o,r,s,a,u;for(n in e)e.hasOwnProperty(n)&&(Object.defineProperty&&(r=Object.getOwnPropertyDescriptor(e,n),r?(s=r.get,a=r.set):(s=void 0,a=void 0),s||a)?Object.defineProperty(t,n,{get:s,set:a}):(o=e[n],i.isFunction(o)?t[n]=o:i.isElement(o)?t[n]=o:i.isObject(o)?i.isRegExp(o)?t[n]=o:i.isConstructor()?t[n]=o:i.isArray(o)?t[n]=o:i.isInstance(o)?t[n]=o:o instanceof i.$?t[n]=o:(i.isUndefined(t[n])?t[n]={}:i.isObject(t[n])?t.hasOwnProperty(n)||(u=t[n],t[n]={},i.mixin(t[n],u)):t[n]={},i.mixin(t[n],o)):t[n]=o));return t};i.mixin=o}(this,this.document,this.BM=this.BM||{}),function(t,e,n){var i=n.tools=n.tools||{};i.rubyHashString2JSON=function(t){return JSON.parse(t.replace(/=>/g,":;").replace(/:/g,'"').replace(/;/g,":"))}}(this,this.modules,this.BM=this.BM||{}),function(t,e,n,i,o,r){"use strict";n.define("storage",["tools"],function(e,n){var r=function(){var e=function(){try{return"localStorage"in t&&null!==t.localStorage}catch(e){return!1}}(),n=function(t){var n;if(e)try{n=u.getItem(t)}catch(i){n=l.getItem(t)}else n=l.getItem(t);try{return JSON.parse(n)}catch(i){return n}},r=function(t,n){if("object"==typeof n&&(n=JSON.stringify(n)),!e)return l.setItem(t,n);try{return u.setItem(t,n)}catch(i){return l.setItem(t,n)}return!0},s=function(t){if(!e)return l.removeItem(t);try{return u.removeItem(t)}catch(n){return l.removeItem(t)}},a=function(){if(e)try{u.clearStorage()}catch(t){l.clearStorage()}else l.clearStorage()},u={getItem:function(t){return o.getItem(t)},setItem:function(t,e){try{return o.setItem(t,e),!0}catch(n){return!1}},removeItem:function(t){try{return o.removeItem(t),!0}catch(e){return!1}},clearStorage:function(){o.clear()}},l={_defaultPrefix:"bm_storage_",getItem:function(t){var e=l._defaultPrefix+t;return i.getItem(e)},setItem:function(t,e){var n=l._defaultPrefix+t;return i.setItem(n,e,2419200,"/")},removeItem:function(t){var e=l._defaultPrefix+t;return i.setItem(e,0,0,"/")},clearStorage:function(){}};return{getItem:n,setItem:r,removeItem:s,clearStorage:a}}();n.storage=r,e(r)})}(this,this.document,this.modules,this.docCookies,this.localStorage||null),function(t){t.BM=t.BM||{},BM.tools=BM.tools||{},BM.tools.support={},BM.tools.mixin(BM.tools.support,{cssAnimations:function(){if(BM.tools.support._cssAnimations)return BM.tools.support._cssAnimations;var t=!1,e=document.createElement("div"),n="animation",i="",o="Webkit Moz O ms Khtml".split(" "),r="";if(void 0!==e.style.animationName&&(t=!0),t===!1)for(var s=0;s<o.length;s++)if(void 0!==e.style[o[s]+"AnimationName"]){r=o[s],n=r+"Animation",i="-"+r.toLowerCase()+"-",t=!0;break}return BM.tools.support._cssAnimations=t,t}})}(this),function(t,e,n){var i=n.tools=n.tools||{},o=function(t){return t instanceof o?t:this instanceof o?void(this._wrapped=t):new o(t)},r=(Array.isArray,Object.keys);o.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},o.keys=function(t){if(!o.isObject(t))return[];if(r)return r(t);var e=[];for(var n in t)o.has(t,n)&&e.push(n);return e},o.invert=function(t){for(var e={},n=o.keys(t),i=0,r=n.length;r>i;i++)e[t[n[i]]]=n[i];return e};var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},a=o.invert(s),u=/\\|'|\r|\n|\u2028|\u2029/g,l=function(t){return"\\"+escapes[t]},c=function(t){var e=function(e){return t[e]},n="(?:"+o.keys(t).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,e):t}};o.escape=c(s),o.unescape=c(a),o.defaults=function(t){if(!o.isObject(t))return t;for(var e=1,n=arguments.length;n>e;e++){var i=arguments[e];for(var r in i)void 0===t[r]&&(t[r]=i[r])}return t},o.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var d=function(t,e,n){!e&&n&&(e=n),e=o.defaults({},e,o.templateSettings);var i=RegExp([(e.escape||noMatch).source,(e.interpolate||noMatch).source,(e.evaluate||noMatch).source].join("|")+"|$","g"),r=0,s="__p+='";t.replace(i,function(e,n,i,o,a){return s+=t.slice(r,a).replace(u,l),r=a+e.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?s+="'+\n((__t=("+i+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),e}),s+="';\n",e.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var a=new Function(e.variable||"obj","_",s)}catch(c){throw c.source=s,c}var d=function(t){return a.call(this,t,o)},h=e.variable||"obj";return d.source="function("+h+"){\n"+s+"}",d};i.template=d}(this,this.document,this.BM=this.BM||{}),function(t,e,n){var i=n.features=n.features||{},o=function(){var e=navigator.userAgent,n=/Gecko\//.test(e)?e.match(/; rv:1\.(\d+?)\.(\d)/):0,i=/AppleWebKit/.test(e),o=i&&/Safari\//.test(e),r=0;return{ie:r>=5?r:0,gecko:n?"1."+n.slice(1).join("."):0,firefox:n?9==n[1]?3:8==n[1]&&n[2]>0?2:0:0,opera:t.opera&&opera.version?opera.version()[0]:0,webkit:0,safari:o&&/Version\//.test(e)?e.match(/Version\/(\d{1})/)[1]:0,chrome:o&&/Chrome\//.test(e)?e.match(/Chrome\/(\d+?\.\d)/)[1]:0}}();i.browser={isIE:function(t){return n.tools.isUndefined(t)?0!==o.ie:o.ie===t},isGecko:function(t){return n.tools.isUndefined(t)?0!==o.gecko:o.gecko===t},isFirefox:function(t){return n.tools.isUndefined(t)?0!==o.firefox:o.firefox===t},isOpera:function(t){return n.tools.isUndefined(t)?0!==o.opera:o.opera===t},isWebKit:function(t){return n.tools.isUndefined(t)?0!==o.webkit:o.webkit===t},isSafari:function(t){return n.tools.isUndefined(t)?0!==o.safari:o.safari===t},isChrome:function(t){return n.tools.isUndefined(t)?0!==o.chrome:o.chrome===t},isBlink:function(){return i.browser.isChrome&&o.chrome>=28}}}(this,this.document,this.BM=this.BM||{}),function(t,e,n,i){i.user=i.user||{}}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){"use strict";var o=n.user=n.user||{},r=function(){return n.config.mainConfig.userInfo.hasOwnProperty("login")},s=function(){return r()?n.config.mainConfig.userInfo.login:null},a=function(){return r()?n.config.mainConfig.userInfo.name:null},u=function(){return r()?n.config.mainConfig.userInfo.email:null},l=function(){return r()?n.config.mainConfig.userInfo.phone_number:null},c=function(){return r()?n.config.mainConfig.userInfo.avatar_url:null},d=function(){return r()?n.config.mainConfig.userInfo:null},h=function(){if(n.config&&n.config.mainConfig&&n.config.mainConfig.viewingUser)var e=n.config.mainConfig.viewingUser.login;return e&&t.location.href.toLowerCase().indexOf(e.toLowerCase())>=0?e:i},p=function(t){var e=n.config.mainConfig,i=!1;return e&&e.userInfo&&e.userInfo.subscriptions&&e.userInfo.subscriptions.forEach(function(e){e.kind===t&&1e3*e.expires_at>(new Date).getTime()&&(i=!0)}),i},f=function(t){return t!==i?null!==b(t):!1},m=function(){return f("default")},g=function(){return f("premium")},b=function(t){var e=n.config.mainConfig,i=null;return e&&e.userInfo&&e.userInfo.subscriptions&&e.userInfo.subscriptions.forEach(function(e){e.kind===t&&(i=e)}),i},_=function(){var t=n.config.mainConfig,e=[],i=null;return n.user.isUserPresent()&&t.userInfo&&t.userInfo.subscriptions?(e=$.map(t.userInfo.subscriptions,function(t){return 1e3*t.expires_at>(new Date).getTime()?t.kind:void 0}),i=-1!==e.indexOf("premium")?"premium":-1!==e.indexOf("default")?"standard":"any"):null},y=function(){return p("premium")||p("default")&&p("booster")},v=function(){return p("booster")},w=function(){return p("default")||p("booster")},k=function(){return p("default-ios")},C=function(){return w()||y()},S=function(){return E("default")},x=function(){return E("premium")},E=function(t){var e=n.config.mainConfig,i=!1;return e&&e.userInfo&&e.userInfo.subscriptions&&e.userInfo.subscriptions.forEach(function(e){e.kind===t&&e.active_recurrent===!0&&(i=!0)}),i},P=function(){var t=n.config.mainConfig;return t&&t.userInfo?t.userInfo.subscriptionCountryCode:void 0},T=function(){return n&&n.config&&n.config.mainConfig?n.config.mainConfig.locale:void 0},I=function(){return"ru"===o.getLocale()},A=function(){return"en"===o.getLocale()},B=function(){return"kk"===o.getLocale()},O=function(){try{return-1!==n.config.mainConfig.userInfo.authentication_providers.indexOf("Facebook")}catch(t){return!1}},M=function(){try{return-1!==n.config.mainConfig.userInfo.authentication_providers.indexOf("Twitter")}catch(t){return!1}},D=function(){try{return-1!==n.config.mainConfig.userInfo.authentication_providers.indexOf("Vkontakte")}catch(t){return!1}};o.isUserPresent=r,o.present=r,o.getLogin=s,o.getName=a,o.getEmail=u,o.getPhone=l,o.login=s,o.getViewingUserLogin=h,o.avatarUrl=c,o.api4Attributes=d,o.getSubscription=b,o.isSubscriptionPremium=y,o.isSubscriptionBooster=v,o.isSubscriptionDefault=w,o.isSubscriptionDefaultExisted=m,o.isSubscriptionPremiumExisted=g,o.isSubscriptionDefaultIOS=k,o.isRecurrentDefaultActive=S,o.isRecurrentPremiumActive=x,o.getHighestSubscription=_,o.anySubscriptionPresent=C,o.getSubscriptionCoutryCode=P,o.getLocale=T,o.isLocaleRu=I,o.isLocaleEn=A,o.isLocaleKk=B,o.isFacebookConnected=O,o.isTwitterConnected=M,o.isVkontakteConnected=D}(this,this.document,this.BM=this.BM||{}),function(t,e,n){var i=function(t){var e=0,i=function(){function t(){return this instanceof t?void this.initialize.apply(this,arguments):new t(arguments)}return n.tools.mixin(t.prototype,{initialize:function(){this._instanceId=++e,this._registeredEvents=[]},destroy:function(){},getInstanceId:function(){return this._instanceId},_registerEvent:function(e){!n.tools.isUndefined(e)&&n.tools.isInstanceOf(e,t)&&this._pushRegisteredEvent(e)},_isEventRegistered:function(t){return-1!==this._registeredEvents.indexOf(t.getInstanceId())},_pushRegisteredEvent:function(t){this._isEventRegistered(t)||this._registeredEvents.push(t.getInstanceId())}}),t}();t(i)};e.define("baseClass",[],i)}(this,this.modules,this.BM),function(t,e,n,i,o){"use strict";e.define("Collection",["extend","MVC","Model","Component"],function(t,e,o,r,s){var a=e(o),u=a,l=u.superclass;i.tools.mixin(a.prototype,{objectKind:o.ObjectKind.COLLECTION,config:{url:"",model:null,component:null,pagination:{p:1,pp:20},allItemsFetched:!1,data:{},itemData:{view:{},model:{}}},initialize:function(t){l.initialize.apply(this,arguments),this._items=[],this._allPagesFetched=!1,this.setConfig(t)},setConfig:function(t){t&&(i.tools.isArray(t)?this.push(t,{silent:!1}):i.tools.isArray(t.items)||i.tools.isObject(t.data)||i.tools.isObject(t.pagination)?(i.tools.isObject(t.data)&&this.setData(t.data),i.tools.isObject(t.pagination)&&(this.config.pagination=i.tools.mixin(this.config.pagination,t.pagination)),i.tools.isArray(t.items)&&this.push(t.items),i.tools.isObject(t.itemData)&&(this.config.itemData=t.itemData),this.push(t.models,{silent:!1})):i.tools.isObject(t)&&this.setData(t))},fetch:function(){this._getUrl()&&this._request()},fetchNextPage:function(){this.areAllItemsFetched()||(this.config.pagination.p+=1,this._notify("next-page-fetch-start"),this.fetch())},setData:function(t){i.tools.isObject(t)&&(this.config.data=i.tools.mixin(this.config.data,t))},each:function(t){this._items.forEach(function(e){t.call(null,e)})},unshift:function(t,e){var e=i.tools.isObject(e)?i.tools.mixin(e,{method:"unshift"}):{method:"unshift"};return this.push(t,e)},push:function(t,e){var n;if(t){if(i.tools.isArray(t))return void t.forEach(function(t){this.push(t,e)}.bind(this));var r,s=!1,a="push";if(e&&(e.silent&&(s=e.silent),i.tools.isPresent(e.method)&&(a="unshift")),i.tools.isInstanceOf(t,o)&&!this.hasItem(t))this.hasItem(t)||(i.tools.isComponent(t)&&t.isTypeItem()?n=t.model:i.tools.isModel(t)&&(n=t),n&&n.on("destroy-success",function(){this.eject(t),n=null,t=null,this._triggerChange()}.bind(this)),this._items[a](t),s||this._triggerChange());else if(i.tools.isObject(t)){if(this._modelConstrDefined())return r=new this.config.model(t),r.parent=this,this.push(r,e);if(this._componentConstrDefined()){if(i.tools.isComponentClassTypeItem(this.config.component)){var u=i.tools.mixin({itemData:{view:{},model:{}}},this.config);return r=new this.config.component({data:{model:t,view:u.itemData.view}}),r.parent=this,this.push(r)}if(i.tools.isComponentClassTypeGroup(this.config.component))return r=new this.config.component({data:{collection:t}}),r.parent=this,this.push(r)}s||this._triggerChange()}}},add:function(){return this.push.apply(this,arguments)},hasItem:function(t){return i.tools.isPresent(t)&&(t instanceof r||t instanceof s)?-1!==this._items.indexOf(t):!1},getItem:function(t){return t=t||0,this._items[t]},getItems:function(t,e){return i.tools.isNumber(t)||i.tools.isNumber(e)?i.tools.isNumber(t)&&!i.tools.isNumber(e)?this._items.slice(0,t):i.tools.isNumber(t)&&i.tools.isNumber(e)?this._items.slice(t,e):void 0:this._items},destroyAll:function(){this.each(function(t){t.destroy()}.bind(this)),this._items.length=0,this._items=[]},getUrl:function(){return this._getUrl.apply(this,arguments)},json:function(){var t=[];return this._items.forEach(function(e){t.push(e.json())}),t},find:function(t){if(0!==this._items.length){var e,n=this._items.length;for(e=0;n>e;++e)if(t.call(this,this._items[e]))return this._items[e]}},eject:function(t,e){var n,r=!1;return e&&e.silent&&(r=e.silent),t?i.tools.isInstanceOf(t,o)&&this.hasItem(t)?(n=this._items.splice(this._items.indexOf(t),1),r||this._triggerChange(),n):i.tools.isFunction(t)?this.eject(this.find(t)):i.tools.isNumber(t)?(n=this._items.splice(t,1),r||this._triggerChange(),n):void 0:void 0},isEmpty:function(){return 0===this._items.length},_triggerChange:function(){var t={};this._notifyChange(t)},_getUrl:function(t){var e;return i.tools.isString(this.config.url)?e=this.config.url:i.tools.isFunction(this.config.url)&&(e=this.config.url()),this._fillUrlWithParams(e)},_fillUrlWithParams:function(t){var e;return i.tools.isString(t)&&(e=t.match(/(:[a-z909_]+)/gi),i.tools.isNull(e)||e.forEach(function(e){var n=e.slice(1);this.config.data.hasOwnProperty(n)&&(t=t.replace(e,this.config.data[n]))}.bind(this)),this.config.pagination&&(t=i.helper.link.appendParam(t,{p:this.config.pagination.p,pp:this.config.pagination.pp}))),t},_request:function(){var t=this._getUrl(),e=this._getFetchData();n.ajax({url:t,data:e,type:"get",dataType:"json",success:function(t){this._checkIfAllPagesFetched(t),this._createItemsFromFetchResponse(t),this._onFetchSuccess.apply(this,arguments),this._notifyNextPageFetchFinish(),this._notify("fetch-success")}.bind(this),error:function(){this._onFetchError.apply(this,arguments),this._notifyNextPageFetchFinish(),this._notify("fetch-success")}.bind(this)})},_notifyNextPageFetchFinish:function(){this.config.pagination&&this.config.pagination.p>1&&this._notify("next-page-fetch-finish")},_checkIfAllPagesFetched:function(t){this.config.pagination&&t.meta&&this._items.length+this._getItemsFromFetchResponseData(t).length>=t.meta.count&&(this.config.allItemsFetched=!0,this._notify("all-items-fetched"))},areAllItemsFetched:function(){return this.config.allItemsFetched===!0},_createItemsFromFetchResponse:function(t){var e=this._getItemsFromFetchResponseData(t);e.forEach(function(t){this.push(t,{silent:!1})}.bind(this)),this._triggerChange()},_getItemsFromFetchResponseData:function(t){return t.objects},_getFetchData:function(){return{}},_itemConstrDefined:function(){return this._modelConstrDefined()||this._componentConstrDefined()},_modelConstrDefined:function(){return i.tools.isFunction(this.config.model)},_componentConstrDefined:function(){return i.tools.isFunction(this.config.component)},getItemConstr:function(){return this._modelConstrDefined()?this.getModelConstr():this._componentConstrDefined()?this.getComponentConstr():void 0},getModelConstr:function(){return this.config.model},getComponentConstr:function(){return this.config.component},_instanceOfItem:function(t){return i.tools.isPresent(t)?i.tools.isPresent(this.config.model)&&i.tools.isInstanceOf(t,this.config.model)?!0:i.tools.isPresent(this.config.component)&&i.tools.isInstanceOf(t,this.config.component)?!0:void 0:!1},_defineFastProps:function(){l._defineFastProps.apply(this,arguments),Object.defineProperty(this,"items",{get:function(){return this.getItems()}})},_onFetchSuccess:function(t){},_onFetchError:function(){},empty:function(){return 0===this._items.length},first:function(){return this._items[0]||null},last:function(){return this._items[Math.max(0,this._items.length-1)]||null},destroy:function(){this._items.forEach(function(t){t&&t.destroy&&(t.destroy(),t=null)}),this._items.length=0,this._items=[],l.destroy.apply(this,arguments)}}),t(a)})}(this,this.modules,this.jQuery,this.BM,this._),function(t,e,n,i){e.define("Component",["extend","MVC"],function(t,e,o){var r=e(o),s=r,a=s.superclass;i.tools.mixin(s,{Type:{ITEM:"item",GROUP:"group"}}),i.tools.mixin(s.prototype,{objectKind:o.ObjectKind.COMPONENT,config:{type:r.Type.ITEM,auto:{view:!0,model:!0,collection:!0},bundle:{view:null,model:null,collection:null},data:{view:{$elem:null},model:{},collection:{}},options:{silentInitialize:!1}},initialize:function(t){a.initialize.apply(this,arguments),this.setConfig(t),this._init(),this._bundle(),this._setupDataEvents()},setConfig:function(t){i.tools.isObject(t)&&(t.bundle&&i.tools.mixin(this.config.bundle,t.bundle),t.data&&i.tools.mixin(this.config.data,t.data),t.auto&&i.tools.mixin(this.config.auto,t.auto),t.type&&(this.config.type=t.type))},json:function(){return this.isTypeItem()&&this.model?this.model.json():this.isTypeGroup()&&this.coll?this.coll.json():void 0},fetch:function(){this.isTypeItem()&&this.model?this.model.fetch():this.isTypeGroup()&&this.coll&&this.coll.fetch()},_init:function(){this.isTypeItem()?(this._initView(),this._initModel()):this.isTypeGroup()&&(this._initView(),this._initCollection())},_initView:function(){this._hasView()||i.tools.isFunction(this.config.bundle.view)&&(this._views.push(new this.config.bundle.view(this.config.data.view)),i.tools.isPresent(this.config.data.view)&&i.tools.isPresent(this.config.data.view.$elem)&&i.tools.isInstanceOf(this.config.data.view.$elem,n)&&(!i.tools.isPresent(this.config.data.model)||i.tools.isEmpty(this.config.data.model))&&(this.config.data.model=this.getView().parseDataForModel(),this.config.options.silentInitialize=!0),this.getView().on("model-added",function(){this.renderViewWithModelData()}.bind(this)),this.getView().on("collection-added",function(){this.renderViewWithCollectionData(this.coll.items)}.bind(this)))},_initModel:function(){this._hasModel()||i.tools.isFunction(this.config.bundle.model)&&this._models.push(new this.config.bundle.model(this.config.data.model,{silent:this.config.options.silentInitialize}))},_initCollection:function(){this._hasCollection()||i.tools.isFunction(this.config.bundle.collection)&&this._collections.push(new this.config.bundle.collection(this.config.data.collection))},_bundle:function(){this.isTypeItem()?(this.getModel().addView(this.getView()),this.getModel().addComponent(this),this.getView().addModel(this.getModel()),this.getView().addComponent(this),this._onBundle()):this.isTypeGroup()&&(this.getCollection().addView(this.getView()),this.getCollection().addComponent(this),this.getView().addCollection(this.getCollection()),this.getView().addComponent(this),this._onBundle())},_setupDataEvents:function(){},_onModelChange:function(t){if(i.tools.isObject(t)&&this.getView()){var e=this.getView();Object.keys(t).forEach(function(n){e.renderHookData(n,t[n])}.bind(this))}},renderViewWithModelData:function(){var t=this.getView(),e=this.getModel();t&&e&&Object.keys(t.getBindings()).forEach(function(n){var i,o=n.split("."),r=e.getData();o.forEach(function(t,e){e+1<o.length?r=r[t]:i=r[t]}),t.renderHookData(n,i)}.bind(this))},renderViewWithCollectionData:function(t){var e=this.getView();if(e&&t&&0!==t.length){var n=e.getBindings();n.collection_items&&e.renderHookData("collection_items",t)}},_onCollectionChange:function(t,e){var n=e.target;this.isComponent()&&(this.isTypeItem()?this.view&&this.model&&this.model.hasNestedComponent(n)&&this.view.renderHookData(this.model.getPathByData(n),n.items):this.isTypeGroup()&&this.view&&this.coll&&n===this.coll&&this.renderViewWithCollectionData(n.items))},hasNestedComponent:function(t){return this.model&&this.model.hasNestedComponent(t)},_onBundle:function(){},isTypeItem:function(){return this.config.type===s.Type.ITEM},isTypeGroup:function(){return this.config.type===s.Type.GROUP},destroy:function(){var t=function(t){i.tools.isArray(t)&&(t.forEach(function(t){t&&t.destroy&&(t.destroy(),t=null)}),t.length=0,t=[])};t(this._views),t(this._models),t(this._collections),this._unbind(),a.destroy.apply(this,arguments)},_unbind:function(){this.model&&this.model.off("change"),this.coll&&this.coll.off("change"),this.view&&(this.view.off("model-added"),this.view.off("collection-added"))}}),t(r)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("EventMVC",["extend","baseClass"],function(t,e,n){var o=e(n),r=o,s=r.superclass;i.tools.mixin(r.prototype,{initialize:function(t){s.initialize.apply(this,arguments),this._defineProperties(),i.tools.isObject(t)&&this.setConfig(t)},setConfig:function(t){i.tools.isObject(t)&&(i.tools.isPresent(t.data)&&this.setData(t.data),i.tools.isPresent(t.target)&&this.setTarget(t.target))},setData:function(t){i.tools.isObject(t)&&i.tools.mixin(this._data,t)},getData:function(){return this._data()},setTarget:function(t){this.target=t},_defineProperties:function(){var t=null,e=null;Object.defineProperty(this,"target",{get:function(){return t},set:function(e){i.tools.isPresent(e)&&i.tools.isMVCObject(e)&&(t=e)}}),Object.defineProperty(this,"data",{get:function(){return e},set:function(t){i.tools.isPresent(t)&&(e=t)}})}}),t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){
e.define("Event",["extend","baseClass"],function(t,e,n){var o=e(n),r=o,s=r.superclass;i.tools.mixin(r.prototype,{initialize:function(t){s.initialize.apply(this,arguments),this._data={},i.tools.isObject(t)&&this.setConfig(t)},setConfig:function(t){i.tools.isObject(t)&&i.tools.isPresent(t.data)&&this.setData(t.data)},setData:function(t){i.tools.isObject(t)&&i.tools.mixin(this._data,t)},getData:function(){return this._data()}}),t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o,r){"use strict";e.define("Model",["extend","MVC","Event"],function(t,e,o,s){var a={GET:"get",CREATE:"post",UPDATE:"put",DELETE:"delete"},u="aa653f1ea8864c743a67ec57b4036f8e9d8153cb",l="c47fe32f9594c311197e9c2cbcb5c371444586ad",c=e(o),d=c,h=d.superclass,p=[],f=function(t){-1===p.indexOf(t)&&p.push(t)},m=function(t){-1===p.indexOf(t)&&p.splice(p.indexOf(t),1)},g=function(t,e){if(i.tools.isPresent(t)&&i.tools.isModel(t)){var n=!1,o=!1,r=p.filter(function(e){return i.tools.isInstanceOf(e,Object.getPrototypeOf(t).constructor)&&e!==t}),s=t.sync.dataToCompare();i.tools.isPresent(e)&&(i.tools.isPresent(e.ignoreFlag)&&(n=e.ignoreFlag),i.tools.isPresent(e.ownData)&&(o=e.ownData)),r.forEach(function(e){if(e.sync&&(e.sync.enabled||n)){var a=e.sync.dataToCompare();typeof s==typeof a&&0!==r.length&&i.tools.isEqual(s,a)&&e.setData(o?t.jsonOwn():t.json(),{sync:!1})}})}},b=function(t,e){if(i.tools.isPresent(e)||(e={}),i.tools.isPresent(e.event)||(e.event=new s),!t._isEventRegistered(e.event)){t._registerEvent(e.event);var n=p.filter(function(e){return i.tools.isInstanceOf(e,Object.getPrototypeOf(t).constructor)&&e!==t}),o=t.sync.dataToCompare();n.forEach(function(t){if(t.sync){var n=t.sync.dataToCompare();i.tools.isEqual(o,n)&&t.destroy(e)}})}};i.tools.mixin(c.prototype,{initialize:function(t,e){f(this),this._defineDataProperty(),h.initialize.apply(this,arguments),i.tools.isPresent(t)&&this.setData(t,{silent:i.tools.isPresent(e)&&e.silent===!0})},fetch:function(){this._getUrl(a.GET)&&this._request(a.GET)},remove:function(){this._getUrl(a.DELETE)&&this._request(a.DELETE)},save:function(){this.data.uuid?this._getUrl(a.UPDATE)&&this._update():this._getUrl(a.CREATE)&&this._create()},setData:function(t,e){var n,o,r=!1,s=!0;e&&(i.tools.isPresent(e.silent)&&(r=e.silent),i.tools.isPresent(e.sync)&&(s=e.sync)),i.tools.isObject(t)&&(n=this.jsonOwn(),i.tools.mixin(this.data,t),o=this._parseDiffs(i.tools.diff(n,this.json())),r||this._notifyChange(o),s&&g(this))},getData:function(){return this.data},json:function(t){var e=Object.getPrototypeOf(this).data,n=this.getData(),r=!1,s={},a=function(t,e,n){var s,u;for(s in t)Object.prototype.hasOwnProperty.call(t,s)&&(u=e[s],i.tools.isInstanceOf(u,o)?r||(n[s]=e[s].json()):i.tools.isObject(t[s])&&!i.tools.isArray(t[s])?(n[s]={},a(t[s],e[s],n[s])):n[s]=e[s])};return t&&t.own&&(r=t.own),a(e,n,s),s},jsonOwn:function(){return this.json({own:!0})},lock:function(t){var e=this.data;i.tools.isString(t)&&(t=t.split(".")),i.tools.isArray(t)&&(t.forEach(function(n,i){i+1<t.length&&(e[n]={})}),e[t[t.length-1]]=u)},unlock:function(t){var e=this.data;i.tools.isString(t)&&(t=t.split(".")),i.tools.isArray(t)&&(t.forEach(function(n,i){i+1<t.length&&(e[n]={})}),e[t[t.length-1]]=l)},syncGlobal:function(){g(this,{ignoreFlag:!0})},_defineDataProperty:function(){var t=this,e=this.data,n=function(e,s,a){var c,d=e[a],h=null,p=!1;i.tools.isFunction(e[a])?(c=e[a],Object.defineProperty(s,a,{get:function(){return i.tools.isNull(h)&&(h=new c,h.setParent(t)),h},set:function(e){return e===u?void(p=!0):e===l?void(p=!1):void(i.tools.isPresent(e)&&!p&&(i.tools.isNull(h)?i.tools.isModelClass(c)||i.tools.isCollectionClass(c)?(h=new c(e),h.setParent(t)):i.tools.isComponentClass(c)&&("item"===c.prototype.config.type?(h=new c({data:{model:e}}),h.setParent(t)):"group"===c.prototype.config.type&&(h=new c({data:{collection:e}}),h.setParent(t))):i.tools.isInstanceOf(h,c)&&(h.objectKind===o.ObjectKind.MODEL?h.setData(e):h.objectKind===o.ObjectKind.COLLECTION?(h.destroyAll(),h.push(e)):h.objectKind===o.ObjectKind.COMPONENT&&(h.isTypeItem()&&h.model?h.model.setData(e):h.isTypeGroup()&&h.coll&&(h.coll.destroyAll(),h.coll.push(e))))))}})):i.tools.isObject(e[a])&&!i.tools.isArray(e[a])?(h={},r(e[a],h,n),Object.defineProperty(s,a,{get:function(){return h},set:function(t){if(t===u)return void(p=!0);if(t===l)return void(p=!1);if(!p)return i.tools.isObject(t)?i.tools.mixin(h,t):void 0}})):(i.tools.isArray(d)&&(d="array",h=[]),Object.defineProperty(s,a,{get:function(){return h},set:function(t){return t===u?void(p=!0):t===l?void(p=!1):void(p||-1!==Object.prototype.toString.call(t).toLowerCase().indexOf(d)&&(h=t))}}))},r=function(t,e,n){var o,s;for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&(s=t[o],!i.tools.isHash(s)||i.tools.isArray(s)||i.tools.isFunction(s)?n(t,e,o):!function(){var s={},a=!1;Object.defineProperty(e,o,{get:function(){return s},set:function(t){if(t===u)return void(a=!0);if(t===l)return void(a=!1);if(!a)return i.tools.mixin(s,t)}}),r(t[o],s,n)}())}.bind(this);this.data={},r(e,this.data,n)},hasNestedComponent:function(t){if(i.tools.isPresent(t)&&i.tools.isMVCObject(t)){var e=function(t){if(!i.tools.isPresent(t))return!1;i.tools.isMVCObject(t)&&(t=Object.getPrototypeOf(t));var n,o;for(n in t)if(t.hasOwnProperty(n)&&!i.tools.isPrimitive(t[n])){if(o=t[n],i.tools.isMVCClass(o))return!0;if(i.tools.isPlainObject(o))return e(o)}return!1};return e(Object.getPrototypeOf(this).data)}},_parseDiffs:function(t){var e,n={};return i.tools.isArray(t)?(t.forEach(function(t){"E"!==t.kind&&"A"!==t.kind||(e="",t.path.forEach(function(t){i.tools.isString(t)&&(e+=t+".")}),e=e.slice(0,-1),n[e]=this.getDataByPath(e))}.bind(this)),n):t},getDataByPath:function(t){var e,n=[],o=this.getData();return i.tools.isString(t)&&(n=t.split("."),n.forEach(function(t,r){i.tools.isNull(e)||(r+1===n.length?i.tools.isPresent(o[t])&&(e=o[t]):i.tools.isPresent(o[t])?o=o[t]:e=null)}.bind(this))),e},getPathByData:function(t){if(!i.tools.isMVCClass(t)&&!i.tools.isMVCObject(t))return null;i.tools.isMVCObject(t)&&(t=Object.getPrototypeOf(t).constructor);var e=[],n=function(t,o){var r;for(r in t)if(t.hasOwnProperty(r)){if(i.tools.isPrimitive(t[r]))continue;t[r]===o?e.push(r):i.tools.isPlainObject(t[r])&&(e.push(r),n(t[r],o))}};return n(Object.getPrototypeOf(this).data,t),0===e.length?null:e.join(".")},_getUrl:function(t){var e;return i.tools.isString(this.url)?e=this.url:i.tools.isObject(this.url)?(e=Object.keys(a).filter(function(e){return a[e]===t}),e=e.length>0?this.url[e[0]]:this.url.BASE||""):i.tools.isFunction(this.url)&&(e=this.url()),this._fillUrlWithParams(e)},_fillUrlWithParams:function(t){var e;return i.tools.isString(t)&&(e=t.match(/(:[a-z909_]+)/gi),i.tools.isNull(e)||e.forEach(function(e){var n=e.slice(1);this.data.hasOwnProperty(n)&&(t=t.replace(e,this.data[n]))}.bind(this))),t},_request:function(t,e){var o=this._getUrl(t),s=t,u=this._getData(t);i.tools.isPresent(e)&&(i.tools.isObject(e.data)&&(u=e.data),i.tools.isPresent(e.url)&&(i.tools.isString(e.url)?o=e.url:i.tools.isFunction(e.url)&&(o=e.url()))),t===a.GET?this._notify("before-fetch"):t===a.CREATE||t===a.UPDATE?this._notify("before-save"):t===a.DELETE&&this._notify("before-delete"),n.ajax({url:o,type:s,data:u,dataType:"json",success:function(e){t===a.GET?(this.setData(e,{silent:!0}),this._onFetchSuccess.apply(this,arguments),this._notify("fetch-success",e)):t===a.CREATE||t===a.UPDATE?(this._onSaveSuccess.apply(this,arguments),t===a.CREATE?this._notify("create-success",e):t===a.UPDATE&&this._notify("update-success",e),this._notify("save-success",e)):t===a.DELETE&&(this._onDestroySuccess.apply(this,arguments),this._notify("remove-success",e),r("bm-model-remove-success").broadcast(this.json()))}.bind(this),error:function(){t===a.GET?(this._onFetchError.apply(this,arguments),this._notify("fetch-error")):t===a.CREATE||t===a.UPDATE?(this._onSaveError.apply(this,arguments),this._notify("save-error")):t===a.DELETE&&(this._onDestroyError.apply(this,arguments),this._notify("remove-error"))}.bind(this)})},_create:function(){this._request(a.CREATE)},_update:function(){this._request(a.UPDATE)},_getData:function(t){var e={};return t===a.GET?e=i.tools.mixin(e,this._getFetchData()):t===a.CREATE?e=i.tools.mixin(e,this._getCreateData()):t===a.UPDATE?e=i.tools.mixin(e,this._getUpdateData()):t===a.DELETE&&(e=i.tools.mixin(e,this._getDeleteData())),e},_getFetchData:function(){return{}},_getCreateData:function(){var t=this._getSaveData();return i.tools.mixin(t,{})},_getUpdateData:function(){var t=this._getSaveData();return i.tools.mixin(t,{})},_getSaveData:function(){return{}},_getDeleteData:function(){return{uuid:this.data.uuid}},_onFetchSuccess:function(){},_onFetchError:function(){},_onSaveSuccess:function(){},_onSaveError:function(){},_onDestroySuccess:function(){},_onDestroyError:function(){},destroy:function(t){m(this),b(this,t);try{delete this.data,this._notify("destroy-success")}catch(e){}h.destroy.apply(this,arguments)}}),i.tools.mixin(c.prototype,{objectKind:o.ObjectKind.MODEL,url:{BASE:"",GET:"",CREATE:"",UPDATE:"",DELETE:""},data:{},sync:{enabled:!1,dataToCompare:function(){return this&&this.data&&this.data.uuid?{uuid:this.data.uuid}:void 0}}}),t(c)})}(this,this.modules,this.jQuery,this.BM,this._,this.radio),function(t,e,n,i){e.define("MVC",["extend","PubSub","EventMVC"],function(t,e,n,o){var r=e(n),s=r,a=s.superclass;i.tools.mixin(s,{ObjectKind:{MODEL:"model",COLLECTION:"collection",VIEW:"view",COMPONENT:"component"}}),i.tools.mixin(s.prototype,{initialize:function(t){a.initialize.apply(this,arguments),this._views=[],this._models=[],this._components=[],this._collections=[],this._parent=null,this._defineFastProps()},getView:function(t){return t=t||0,this.isView()?null:this._getView(t)},getModel:function(t){return t=t||0,this.isComponent()||this.isView()?this._getModel(t):null},getCollection:function(t){return t=t||0,this.isCollection()?null:this._getCollection(t)},getComponent:function(t){return t=t||0,this.isComponent()?void 0:this._getComponent(t)},getParent:function(){return this._parent},addView:function(t){this._views.push(t),this._onViewAdded(),this._notify("view-added")},addModel:function(t){this._models.push(t),this._onModelAdded(),this._notify("model-added")},addCollection:function(t){this._collections.push(t),this._onCollectionAdded(),this._notify("collection-added")},addComponent:function(t){this._components.push(t),this._onComponentAdded(),this._notify("component-added")},setParent:function(t){i.tools.isPresent(t)&&i.tools.isInstanceOf(t,r)&&(this._parent=t)},_getView:function(t){return this._views[t]},_getModel:function(t){return this._models[t]},_getCollection:function(t){return this._collections[t]},_getComponent:function(t){return this._components[t]},isModel:function(){return this.objectKind===s.ObjectKind.MODEL},isView:function(){return this.objectKind===s.ObjectKind.VIEW},isCollection:function(){return this.objectKind===s.ObjectKind.COLLECTION},isComponent:function(){return this.objectKind===s.ObjectKind.COMPONENT},_hasModel:function(){return this._models.length>0},_hasView:function(){return this._views.length>0},_hasComponent:function(){return this._components.length>0},_hasCollection:function(){return this._collections.length>0},_onViewAdded:function(){},_onCollectionAdded:function(){},_onComponentAdded:function(){},_onModelAdded:function(){},_onChange:function(){var t=Array.prototype.slice.call(arguments),e=t[t.length-1];i.tools.isPresent(e)&&i.tools.isInstanceOf(e,o)&&e.target&&(i.tools.isModel(e.target)?this._onModelChange.apply(this,arguments):i.tools.isCollection(e.target)&&this._onCollectionChange.apply(this,arguments),this._notify("change"))},_onModelChange:function(){this._notify("model-change")},_onCollectionChange:function(){this._notify("collection-change")},_notifyChange:function(){var t=Array.prototype.slice.call(arguments),e=t,n=new o,s=function(t,e){if(i.tools.isInstanceOf(t,r)){var n=e[e.length-1];if(t.isModel()){if(t.comp)return t.comp._onChange.apply(t.comp,e),t.comp._registerEvent(n),s(t.comp,e);if(t.parent&&i.tools.isCollection(t.parent))return t.parent._onChange.apply(t.parent,e),t.parent._registerEvent(n),s(t.parent,e);if(t.parent&&i.tools.isModel(t.parent))return t.parent._onChange.apply(t.parent,e),t.parent._registerEvent(n),s(t.parent,e)}if(t.isComponent()&&t.parent&&i.tools.isCollection(t.parent))return t.parent._onChange.apply(t.parent,e),t.parent._registerEvent(n),s(t.parent,e);if(t.isCollection()){if(t.comp)return t.comp._onChange.apply(t.comp,e),t.comp._registerEvent(n),s(t.comp,e);if(t.parent&&i.tools.isModel(t.parent))return t.parent._registerEvent(n),s(t.parent,e)}}};n.target=this,e.push(n),s(this,t),this._notify("change",t[0],t[1])},_defineFastProps:function(){var t=this;Object.defineProperty(this,"model",{get:function(){return t.getModel()}}),Object.defineProperty(this,"view",{get:function(){return t.getView()}.bind(this)}),Object.defineProperty(this,"coll",{get:function(){return t.getCollection()}.bind(this)}),Object.defineProperty(this,"comp",{get:function(){return t.getComponent()}.bind(this)}),Object.defineProperty(this,"parent",{get:function(){return t.getParent()}.bind(this),set:function(e){i.tools.isPresent(e)&&i.tools.isInstanceOf(e,r)&&(t._parent=e)}})},destroy:function(){a.destroy.apply(this,arguments),this._notify("destroy")}}),t(r)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o,r,s){"use strict";n.define("PopupBase",["PubSub","extend","tools"],function(e,n,a,u){var l=i(t),c=0,d=[],h=a(n),p=h,f=p.superclass,m='<div class="bookmate-popup bm-popup" hidden="hidden" visible="false"><div class="bookmate-popup-overlay bm-popup-overlay"></div><div class="bookmate-popup-content-wrapper bm-popup-content-wrapper" role="overlay"><div class="bookmate-popup-content bm-popup-content" role="content"></div></div></div>',g='<div class="bookmate-popup-button-close bm-popup-button-close"></div>',b=!1,_=function(t){var e,n=d.length;for(e=0;n>e;++e)if(d[e]===t)return e;return!1},y=function(t){_(t)===!1&&d.push(t)},v=function(t){var e;(e=_(t))!==!1&&d.splice(e,1)},w=function(t,e){var n,i=d.length,o=!1,s=!1;for(r.tools.isUndefined(e)||(r.tools.isBoolean(e.silent)&&(o=e.silent),r.tools.isBoolean(e.force)&&(s=!0)),n=0;i>n;++n)d[n]===t||d[n].hasDependentPopups()||s||d[n]instanceof h&&d[n].isVisible()&&d[n].hide(o)},k=function(){var t,e=d.length;for(t=0;e>t;++t)d[t]instanceof h&&d[t].isVisible()&&d[t].update()};p.dispatcher=new n,l.on("resize",function(){k()}),l.on("keyup",function(t){t&&t.keyCode&&27==t.keyCode&&w()}),r.tools.mixin(p,{hideAll:function(t){w(null,{silent:t})},destroyAll:function(t){w(null,{silent:t}),d.forEach(function(t){t.destroy()})},anyVisible:function(){var t=!1;return d.forEach(function(e){e.isVisible()&&(t=!0)}),t},getVisible:function(){var t=null;return d.forEach(function(e){e.isVisible()&&(t=e)}),t},setHistoryControlsVisible:function(t){d.forEach(function(e){e.setHistoryControlsVisible(t)})},enableHistoryControls:function(){b=!0,d.forEach(function(t){t.enableHistoryControls()})},disableHistoryControls:function(){b=!1,d.forEach(function(t){t.disableHistoryControls()})}}),r.tools.mixin(p.prototype,{initialize:function(t){f.initialize.apply(this,arguments),this._content="",this._backgroundClickHide=!0,this._blockMouseMove=!0,this._isVisible=!1,this._useTemplate=!0,this._showButtonClose=!0,this._animationsEnabled=!0,this._historyControls=b,this._stopHistoryOnClose=!1,this._hasDependentPopups=!1,this._initialBodyOverflowValue=null,this._initialHtmlOverflowValue=null,this._historyControlsVisible=!0,this._element=this._createPopupElement(),this.$elem=this._element,this._elementBody=i("body"),this._elementHtml=i("html"),this._elementRoot=this._element,this._elementOverlay=this._element.find("[role=overlay]"),this._elementContent=this._element.find("[role=content]"),this._elementButtonClose=this._element.find("[role=button-close]"),this._contentClassName=null,c+=1,this._uniqueToken="bookmate-popup-"+c+(new Date).getTime(),this.setConfig(t),this._useTemplate&&(this._content=this._getTemplateContent(),this._appendContent()),this._setupEvents(),y(this),this._defineFastProps()},setConfig:function(t){u.isUndefined(t)||(u.isUndefined(t.useTemplate)||(this._useTemplate=t.useTemplate),u.isUndefined(t.content)||(this._content=t.content,this._appendContent()),u.isBoolean(t.backgroundClickHide)&&this.setOnBackgroundClickHide(t.backgroundClickHide),u.isUndefined(t.contentClassName)||(this._contentClassName=t.contentClassName),u.isUndefined(t.showButtonClose)||(this._showButtonClose=t.showButtonClose),u.isUndefined(t.rootClassName)||("string"==typeof t.rootClassName,this._rootClassName=t.rootClassName,this.addRootClassName(t.rootClassName)),r.tools.isUndefined(t.stopHistoryOnClose)||(this._stopHistoryOnClose=t.stopHistoryOnClose),r.tools.isUndefined(t.hasDependentPopups)||(this._hasDependentPopups=t.hasDependentPopups))},setOnBackgroundClickHide:function(t){"undefined"!=typeof t&&(t?this._backgroundClickHide=!0:this._backgroundClickHide=!1)},addRootClassName:function(t){var e=this;u.isUndefined(t)||(u.isString(t)&&(t=[t]),t.forEach(function(t){e._element.addClass(t)}))},setAnimationsEnabled:function(t){this._animationsEnabled=!!t},getElement:function(){return this._element},_appendContent:function(){this._elementContent.html(""),this._showButtonClose&&(this._elementButtonClose=i(g),this._elementContent.append(this._elementButtonClose)),this._elementContent.append(this._content)},_createPopupElement:function(){return i(this._getBaseTemplate())},_getBaseTemplate:function(){return m},_setupEvents:function(){var t=this,e=r.tools.client.isTouch()?r.tools.client.touchEvent:"click";this._elementOverlay.on(e,function(e){t._onOverlayClick(e)}),this._elementOverlay.on("mousemove",function(e){t._onRootMouseMove(e)}),this._elementRoot.on("mousewheel",function(e){t._onRootMouseWheel(e)}),this._elementRoot.on("keyup keydown keypress",function(e){t._onRootKeyAction(e)}),this._elementContent.on(e,function(e){t._onContentClick(e)}),this._elementButtonClose.on(e,function(e){t._onButtonCloseClick(e)})},_onOverlayClick:function(t){this._backgroundClickHide&&(this.hide(),this._stopHistoryOnClose&&p.dispatcher._notify("stop-history-request"))},_onRootMouseMove:function(t){this._blockMouseMove&&t.stopPropagation()},_onRootMouseWheel:function(t){t.stopPropagation()},_onRootKeyAction:function(t){t.stopPropagation()},_onContentClick:function(t){t.stopPropagation()},_onButtonCloseClick:function(t){this.hide()},_defineFastProps:function(){this.$el||Object.defineProperty(this,"$el",{get:function(){return this.$elem&&this.$elem.length>0?this.$elem:null}})},show:function(){this._isVisible||(this._preparePopup(),this._appendIntoBody(),this.updateLayout(),this._show(),this._blockBodyScrolling(),this._notify("show"),o&&o("bookmate-popup-show").broadcast())},_appendIntoBody:function(){this._elementBody.append(this._elementRoot)},_show:function(){w(this,{silent:!0}),this._elementRoot.attr("visible","true"),this._isVisible=!0,this._elementRoot.focus()},hide:function(t,e){this._isVisible&&(this._hide({callback:function(){t!==!0&&o&&o("bookmate-popup-hide").broadcast()},options:e||{}}),t!==!0&&this._notify("hide"))},_hide:function(t){var e=this,n=t.options&&t.options.animation!==s?!!t.options.animation:!0;this._unblockBodyScrolling(),this._isAnimationEnabled()&&n?(this._elementOverlay.animationEnd(function(){e._elementOverlay.unbindAnimationEnd(),e._elementRoot.removeAttr("visible"),e._elementRoot.attr("hidden","hidden"),t.callback&&t.callback()}),this._elementRoot.attr("visible","false"),this._isVisible=!1):(this._elementRoot.attr("visible","false"),this._elementRoot.removeAttr("visible"),this._elementRoot.attr("hidden","hidden"),t.callback&&t.callback(),this._isVisible=!1)},isVisible:function(){return this._isVisible},_preparePopup:function(){this._elementRoot.removeAttr("visible"),this._elementRoot.removeAttr("hidden")},_blockBodyScrolling:function(){this._elementBody.addClass("m-scroll-block")},_unblockBodyScrolling:function(){this._elementBody.removeClass("m-scroll-block")},updateLayout:function(){this._updateContentClassName(),this._calculateContentPosition(),this._updateHistoryControls()},_updateContentClassName:function(){this._contentClassName&&!this._elementContent.hasClass(this._contentClassName)&&this._elementContent.addClass(this._contentClassName)},update:function(){this._calculateContentPosition()},_calculateContentPosition:function(){var e=t.innerHeight+"px";this._elementOverlay.css({height:e,"line-height":e})},_updateHistoryControls:function(){this._historyControls?this.$elem.addClass("m-history-controls-enabled"):this.$elem.removeClass("m-history-controls-enabled"),this._historyControlsVisible?this.$elem.removeClass("m-history-controls-hidden"):this.$elem.addClass("m-history-controls-hidden")},_isAnimationEnabled:function(){return!(!this._element.hasClass("m-version-2")||r.tools.client.isBreakpointMobile()||this._animationsEnabled!==!0)},_getTemplateName:function(){},_getTemplateContent:function(){return i("#"+this._getTemplateName()).html()},showButtonClose:function(){this._showButtonClose&&this._elementButtonClose.removeAttr("data-visible")},hideButtonClose:function(){this._showButtonClose&&this._elementButtonClose.attr("data-visible","false")},enableHistoryControls:function(){this._historyControls=!0,this.updateLayout()},disableHistoryControls:function(){this._historyControls=!1,this.updateLayout()},setHistoryControlsVisible:function(t){this._historyControlsVisible=!!t,this.updateLayout()},destroy:function(){this.remove(),f.destroy.apply(this,arguments)},remove:function(){v(this),this.$elem.off(),this.$elem.remove(),this.$elem=null},hasDependentPopups:function(){return this._hasDependentPopups}}),h.getVisiblePopups=function(){var t,e=d.length,n=[];for(t=0;e>t;++t)d[t]instanceof h&&d[t].isVisible()&&n.push(d[t]);return n},h.getVisiblePopup=function(){var t=h.getVisiblePopups();return t.length?t[0]:null},h.getLastVisiblePopup=function(){var t=h.getVisiblePopups();return t.length?t[t.length-1]:null},e(h)})}(this,this.document,this.modules,this.jQuery,this.radio,this.BM),function(t,e,n,i){e.define("PubSub",["baseClass","extend"],function(t,e,i){var o=i(e),r=o,s=r.superclass;n.tools.mixin(r.prototype,{initialize:function(){this._events=[],this._sniffers=[],s.initialize.apply(this,arguments)},_notify:function(t){if(!this._eventExists(t))return void(this._sniffers&&this._sniffers.length>0&&this._notifySniffers(t,Array.prototype.slice.call(arguments,1)));var e=this,i=Array.prototype.slice.call(arguments,1),o=this._getEventObject(t),r=!1;o.forEach(function(t){i.length>0?t.callback.apply(t.context,i):t.callback.call(t.context),n.tools.isNumber(t.times)&&(t.times-=1,t.times<=0&&(e.off(t.event,t.callback,t.context),r=!0))}),r||this._notifySniffers(t,i)},_notifySniffers:function(t,e){this._sniffers&&this._sniffers.forEach(function(i){var o=i._getEventObject(t);o.forEach(function(t){n.tools.isNumber(t.times)||(e.length>0?t.callback.apply(null,e):t.callback.call(null))})})},on:function(t,e,i){(n.tools.isPresent(t)||n.tools.isPresent(e))&&(n.tools.isArray(t)?t.forEach(function(t){this._pushEvent(t,e,i)}.bind(this)):n.tools.isString(t)&&(-1!==t.indexOf(" ")?(t=t.split(" "),t.forEach(function(t){this._pushEvent(t,e,i)}.bind(this))):this._pushEvent(t,e,i)))},_pushEvent:function(t,e,n){this._events.push({event:t,callback:e,context:n})},once:function(t,e,n){void 0!==t&&void 0!==e&&this._events.push({event:t,callback:e,context:n,times:1})},off:function(t,e,i){if(0===arguments.length)return this._events.length=0,void(this._events=[]);if(n.tools.isArray(t))return void t.forEach(function(t){this.off(t,e,i)}.bind(this));if(n.tools.isString(t)&&-1!==t.indexOf(" "))return this.off(t.split(" "),e,i);if(this._eventExists(t)){var o,r,s=this._events.length;for(o=0;s>o;++o)if(r=this._events[o],n.tools.isUndefined(e)||n.tools.isUndefined(i)){if(!n.tools.isUndefined(e)&&n.tools.isUndefined(i)){if(r.event===t&&r.callback===e)return void this._events.splice(o,1)}else if(!n.tools.isUndefined(t)&&r.event===t)return void this._events.splice(o,1)}else if(r.event===t&&r.callback===e&&r.context===i)return void this._events.splice(o,1)}},sniff:function(t){!n.tools.isUndefined(t)&&t instanceof o&&t.addSniffer(this)},unsniff:function(t){!n.tools.isUndefined(t)&&t instanceof o&&t.removeSniffer(this)},addSniffer:function(t){this._snifferExists(t)||t===this||this._sniffers.push(t)},removeSniffer:function(t){var e,n=this._sniffers.length;for(e=0;n>e;++e)if(this._sniffers[e]===t){this._sniffers.splice(e,1);break}},_snifferExists:function(t){var e,n=this._sniffers.length;for(e=0;n>e;++e)if(this._sniffers[e]===t)return!0;return!1},destroy:function(){var t=this;n.tools.isNull(this._sniffers)||(this._sniffers.forEach(function(e){t.unsniff(e)}),this._sniffers.length=0,this._sniffers=null),n.tools.isArray(this._events)&&(this._events.length=0,this._events=null),s.destroy.apply(this,arguments)},_getEventObject:function(t){var e,n=this._events.length,i=[];for(e=0;n>e;++e)this._events[e].event===t&&i.push(this._events[e]);return i},_eventExists:function(t){if(!this._events)return!1;var e,n=this._events.length;for(e=0;n>e;++e)if(this._events[e].event===t)return!0;return!1}}),t(o)})}(this,this.modules,this.BM,this.jQuery),function(t,e,n,i){e.define("baseView",["PubSub","extend"],function(t,e,o){var r=o(e),s=r,a=s.superclass;n.tools.mixin(s.prototype,{initialize:function(t){if(a.initialize.apply(this,arguments),this._config={},this.$elem=null,t&&t.element){if(t.element instanceof i&&t.element.length<1)return void this._createElementFromTemplate(t);this.$elem=this._toJQueryObject(t.element)}(!this.$elem||t&&t.useTemplateForced)&&this._createElementFromTemplate(t),this._defineFastProps()},_defineFastProps:function(){this.$el||Object.defineProperty(this,"$el",{get:function(){return this.$elem&&this.$elem.length>0?this.$elem:null}})},_toJQueryObject:function(t){var e=null;return t&&(t instanceof i?e=t:t instanceof HTMLElement?e=i(t):"string"==typeof t&&(e=i(t))),e&&e.length>0?e:null},_createElementFromTemplate:function(t){var e=this._getTemplateName(t);this.$elem=i(i("#"+e).html())},_hasElement:function(){return this.$elem&&this.$elem.length>0},render:function(){var t=this._getTemplateName(),e=i("#"+t).html().replace(/&lt;%=/g,"<%=").replace(/%&gt;/g,"%>"),o=n.tools.template(e);this.$elem=i(o({data:this.config.data}))},_parseConfig:function(){n.tools.isUndefined(this._config)&&(this._config={});var t=this._parseDataConfig();n.tools.isObject(t)&&n.tools.mixin(this._config,t)},_parseDataConfig:function(){var t={};try{t=JSON.parse(this.$elem.attr("data-config")),t.library_card&&(t.libraryCard=t.library_card,delete t.library_card),t.read_button&&(t.readButton=t.read_button,delete t.read_button)}catch(e){}return t},_getTemplateName:function(){return""},getElement:function(){return this.$elem},_createElement:function(){this.$elem=i(i("#"+this._getTemplateName()).html())},destroy:function(){this.$elem.off(),this.$elem.remove(),this.$elem=null,this._config=null,a.destroy.apply(this,arguments)}}),t(r)})}(this,this.modules,this.BM,this.jQuery),function(t,e,n,i){e.define("View",["extend","MVC"],function(e,o,r){var s=o(r),a=s,u=a.superclass,l=n(t);i.tools.mixin(a.prototype,{objectKind:r.ObjectKind.VIEW,config:{events:{},bindings:{}},initialize:function(t){u.initialize.apply(this,arguments),this.$elem=null,this.clone=null,i.tools.isPresent(t)&&t.$elem&&(t.$elem instanceof n?t.$elem.length>0?this.$elem=t.$elem:this._createElementFromTemplate():this.$elem=this._toJQueryObject(t.$elem)),(!this.$elem||this.$elem.length<1)&&this._createElementFromTemplate(),this._applyEventBindings(),this._applyDataBindings(),this._bind(),i.tools.isPresent(t)&&i.tools.isPresent(t.state)&&(i.tools.isPresent(this.hasOwnProperty("state"))?this.state=i.tools.mixin(this.state,t.state):this.state=t.state),this._setupBaseEvents()},_setupBaseEvents:function(){l.on("resize."+this.getInstanceId(),i.tools.debounce(function(t){this._onWindowResize(t)}.bind(this),300)),l.on("scroll."+this.getInstanceId(),i.tools.debounce(function(t){this._onWindowScroll(t),this._notify("window-scroll",t)}.bind(this),300))},_onWindowResize:function(){},_onWindowScroll:function(){},getClone:function(){return i.tools.isNull(this.clone)?(this.clone=n.clone(this.$elem.get(0)),this.getClone()):this.clone},_bind:function(){},renderHookData:function(t,e){var n,o;if(this._hasHook(t)){if(n=this._getHookOptions(t),o=this.$elem.find('[data-hook~="'+n.hook+'"]'),0===o.length&&this.$elem.is('[data-hook~="'+n.hook+'"]')&&(o=this.$elem),0===o.length)return;"text"===n.type?(i.tools.isPresent(n.nl2br)&&n.nl2br===!0&&(e=i.helper.text.nl2br(e)),i.tools.isPresent(n.trim)&&n.trim===!0&&i.tools.isString(e)&&(e=e.trim()),i.tools.isPresent(n.escape)&&n.escape===!1?o.html(e):o.html(i.helper.text.escapeSpecialChars(e))):"attr"===n.type?o.attr(n.name,e):"function"===n.type?n.callback.call(this,o,e):"collection_items"===n.type?this._renderCollectionItems(o,e):"component"===n.type&&this._renderComponent(o,e)}},_renderCollectionItems:function(t,e){if(i.tools.isCollection(e)&&(e=e.getItems()),i.tools.isArray(e)){var o=t.children(),r=function(t){var e=!1;return o.each(function(){n(this).get(0)===t.el.get(0)&&(e=!0)}),e};e.forEach(function(n,i){n.view&&(r(n.view)||(0>i-1?t.prepend(n.view.el):n.view.el.insertAfter(e[i-1].view.el)))}.bind(this)),o.each(function(){var t=n(this),i=!1;e.forEach(function(e){t.get(0)===e.view.el.get(0)&&(i=!0)}),i||t.detach()}),o.sort(function(t,e){var n=o.index(t),i=o.index(e);return i>n?1:-1})}},_renderComponent:function(t,e){e&&e.isComponent()&&(e.view.el.on("remove",function(){}),t.append(e.view.el))},_hasHook:function(t){return i.tools.isPresent(this.config.bindings[t])},_getHookOptions:function(t){var e=this.config.bindings[t];return i.tools.isObject(e)&&(e.hook||(e.hook=t)),e},_applyEventBindings:function(){var t,e;if(this.config.events)for(t in this.config.events)Object.prototype.hasOwnProperty.call(this.config.events,t)&&(e=t.split(" "),2===e.length?this._bindEvent(e[0],e[1],this.config.events[t]):1==e.length&&this._bindEvent(e[0],this.$elem,this.config.events[t]))},_bindEvent:function(t,e,n){n&&("press"===t&&(t=i.helper.event.clickName()),i.tools.isString(e)?this.$elem.find(e).on(t,function(){this[n].apply(this,arguments)}.bind(this)):e.on(t,function(t){t.target===e.get(0)&&this[n].apply(this,arguments)}.bind(this)))},_applyDataBindings:function(){},_defineFastProps:function(){u._defineFastProps.apply(this,arguments);var t=this,e=i.tools.isObject(this.state)?this.state:{};Object.defineProperty(this,"el",{get:function(){return t.getElement()}}),Object.defineProperty(this,"state",{get:function(){return e},set:function(t){i.tools.isObject(t)&&(e=i.tools.mixin(e,t),this._onStateChange(),i.tools.isFunction(this._update)&&this._update())}})},_onStateChange:function(){this._update()},_update:function(){},_toJQueryObject:function(t){var e=null;return t&&(t instanceof n?e=t:t instanceof HTMLElement?e=n(t):"string"==typeof t&&(e=n(t))),e&&e.length>0?e:null},_createElementFromTemplate:function(){var t=this._getTemplateName();this.$elem=n(n("#"+t).html())},_hasElement:function(){return this.$elem&&this.$elem.length>0},render:function(){!this._hasModel()},_parseConfig:function(){i.tools.isUndefined(this._config)&&(this._config={});var t=this._parseDataConfig();i.tools.isObject(t)&&i.tools.mixin(this._config,t)},_parseDataConfig:function(){var t={};try{t=JSON.parse(this.$elem.attr("data-config")),t.library_card&&(t.libraryCard=t.library_card,delete t.library_card),t.read_button&&(t.readButton=t.read_button,delete t.read_button)}catch(e){}return t},parseDataForModel:function(){var t=this._parseDataConfig();return i.tools.isObject(t)?t:void 0},_getTemplateName:function(){return""},getElement:function(){return this.$elem},_createElement:function(){this.$elem=n(n("#"+this._getTemplateName()).html())},getBindings:function(){return this.config.bindings},_destroyBaseEvents:function(){n(t).off("resize."+this.getInstanceId()),
n(t).off("scroll."+this.getInstanceId())},offset:function(){return this.el?this.el.offset():null},destroy:function(){this._destroyBaseEvents(),this.$elem.off(),this.$elem.remove(),this.$elem=null,this._config=null,u.destroy.apply(this,arguments)}}),s.extendConfig=function(t,e,n){_.extend(t.prototype.config,e.prototype.config,n)},e(s)})}(this,this.modules,this.jQuery,this.BM),function(t){BM=t.BM||{},BM.helper=BM.helper||{},BM.helper.asset=BM.helper.asset||{},BM.tools.mixin(BM.helper.asset,{path:function(t){return t?t:""}})}(this),function(t,e,n,i){i.helper=i.helper||{},i.helper.auth=i.helper.auth||{};var o;i.tools.mixin(i.helper.auth,{doAfterUserLogin:function(t,n){i.tools.isFunction(t)&&(i.user.present()?t():i.tools.isPresent(o)?(o.off("authenticationSuccessful"),o.on("authenticationSuccessful",function(){t()}),o.showWindow()):e.require(["loginWindow"],function(e){o=new e,o.off("authenticationSuccessful"),o.on("authenticationSuccessful",function(){t()}),o.showWindow()}))},getAuthToken:function(){return document.querySelector("[name=authenticity_token]").getAttribute("value")}})}(this,this.modules,this.jQuery,this.BM),function(t,e){e=t.BM||{},e.helper=e.helper||{},e.helper.braintree=e.helper.braintree||{};var n={PRODUCTION:"MIIBCgKCAQEA6h1fodQ/743wqurzVIt7KxVwFaghXYnXcN9Bi6EuWPXarAHFBd+zeedzz1GkbunOJ512lhjwCxJronh0CPw/WyOO0XKe68tqCcEdw1+CwQpRlQM8/EwGi5AgIzU0+NYDNHFfoaxnjvVZvCxfDGUVG0/ngV0NaMDCjhE0cyYNQ8Ftyd+lk0j1xDyrnf0XEI7FB7xDBz6vw5p92YVcweObM5S6MXyWuIhsgQqjWACBGI0agFPBdjjrHPaYj8VY7/lhpEXG0Mn7nHV/8L3oj6xvZc9Aapp8LUJkMBWqXfywQspT4++XV5b8kG+AlGQ6Ug6/AwdsFYVoWQ+fzr+3K4vgVQIDAQAB",SANDBOX:"MIIBCgKCAQEArfzZR2ED5oTYxiRfVwbO9/X5DfGPwCY1YJwXtKtPQik/NZT3Q1x8Y3tKHLsa4/bh/5eNDqxEWhb+8kPIjm0jpzXUQbR/Mg1RF70x46KcYBFZX/UMOxauLi/Bre/FytWo5/RSZYw2bJVSiHhiISZXqjkVE1WR/ellP/WRNcU9LxCecDhvPhHyePVWLl7uwH8k/Y6s4DyWJJXsckPQ96CdA2nMS3byDhc/Cgtr0Wig0ca/3chOg+Awb4VmS//7iw60sRt+D5BkhX6flD7keDd/7tKfOgHdleIOn43zD6/odd9Rh32D5qDK3YpPeK/lxOivbk3+TvWEdYDqwo1AOjfvNQIDAQAB"},i=null;e.tools.mixin(e.helper.braintree,{getBraintreeKey:function(){return e.helper.env.isProduction()?n.PRODUCTION:n.SANDBOX},getClientToken:function(t){var n=t&&t.success?t.success:function(){},o=t&&t.error?t.error:function(){};e.tools.isNull(i)?$.ajax({url:"/payments/braintree/client_token",type:"post",success:function(t){i=t.client_token,n(i)},error:function(){o.apply(null,arguments)}}):n(i)},getCreditCardNonce:function(t){var n=t&&t.success?t.success:function(){},i=t&&t.error?t.error:function(){},o=t&&t.data?t.data:null;e.tools.isNull(o)||e.helper.braintree.getClientToken({success:function(t){var r=new braintree.api.Client({clientToken:t});r.tokenizeCard(o,function(t,o){e.tools.isNull(t)?n(o):i()})},error:i})},merchantId:function(){return e.helper.env.isProduction()?"d8h943sx2q7g29mm":"8tz37b4jh2tfr9vf"},braintreeDataEnvironment:function(){return e.tools.isUndefined(t.BraintreeData)?null:e.helper.env.isProduction()?BraintreeData.environments.production:BraintreeData.environments.sandbox},deviceData:function(){var n,i,o;if(!e.tools.isUndefined(t.BraintreeData)){n=document.createElement("form"),i="braintree-devide-data-form-dummy-"+parseInt(1e6*Math.random(),10),n.id=i,document.body.appendChild(n),BraintreeData.setup(e.helper.braintree.merchantId(),i,e.helper.braintree.braintreeDataEnvironment()),o=n.querySelector("#device_data").getAttribute("value");try{return JSON.parse(o)}catch(r){return o}}return null}})}(this,this.BM),function(t,e){e=t.BM||{},e.helper=e.helper||{},e.helper.client=e.helper.client||{},e.tools.mixin(e.helper.client,{triggerRerender:function(){t.document.body.offsetHeight=t.document.body.offsetHeight}})}(this,this.BM),function(t,e){e=t.BM||{},e.helper=e.helper||{},e.helper.country=e.helper.country||{},e.tools.mixin(e.helper.country,{isSingapore:function(){return!e.tools.isNull(e.config.mainConfig.country)&&"sg"===e.config.mainConfig.country},isEstonia:function(){return!e.tools.isNull(e.config.mainConfig.country)&&"ee"===e.config.mainConfig.country}})}(this,this.BM),function(t,e){e=t.BM||{},e.helper=e.helper||{},e.helper.data=e.helper.data||{},e.tools.mixin(e.helper.data,{isValidUUID:function(t){return e.tools.isString(t)?t.length<6||t.length>10?!1:-1===["recent","all","finished","not_finished","uploads","quotes"].indexOf(t):!1}})}(this,this.BM),function(t,e){e=t.BM||{},e.helper=e.helper||{},e.helper.deeplink=e.helper.deeplink||{};var n={APP_STORE:"https://app.adjust.com/sjljfb?campaign=redirect",GOOGLE_PLAY:"https://app.adjust.com/6svwku?campaign=redirect"},i={APP_STORE:"https://app.adjust.com/sjljfb?campaign=app_banner",GOOGLE_PLAY:"https://app.adjust.com/6svwku?campaign=app_banner"},o=function(){try{if(e.tools.isPresent(e.config.mainConfig.deeplink))return JSON.parse(e.config.mainConfig.deeplink)}catch(t){return null}return null},r=function(){var t=o();return t.enabled===!0},s=function(e,n){var i="https://ddl.bookmate.com",o=t.screen.width+"x"+t.screen.height;$.ajax({url:i,type:"post",data:{screen_resolution:o,link:e},success:function(){n&&n()},error:function(){n&&n()}})},a=function(n){var i=o();e.tools.isEmpty(i.data)||e.tools.isNull(i.data)?e.tools.client.isiOS()&&(t.location=n.APP_STORE):s(i.data.link,function(){e.tools.client.isiOS()&&(setTimeout(function(){document.webkitHidden||(t.location=n.APP_STORE)},25),t.location=i.data.link)})};e.tools.mixin(e.helper.deeplink,{exec:function(e){e=e||i,"complete"===t.document.readyState?a(e):t.addEventListener&&(t.removeEventListener("load",function(){a(e)}),t.addEventListener("load",function(){a(e)}))},execAuto:function(){return e.helper.deeplink.exec(n)},enabled:function(){return r()},sendFingerprint:function(t,e){return s(t,e)}})}(this,this.BM),function(t,e,n){n=t.BM||{},n.helper=n.helper||{},n.helper.emotions=n.helper.emotions||{};var i=null,o=function(t){var e={},n=[];return t.forEach(function(t){e[t.name]=t}),e.thumbsup&&n.push(e.thumbsup),e.thumbsdown&&n.push(e.thumbsdown),e.rocket&&n.push(e.rocket),e.smile&&n.push(e.smile),e.dart&&n.push(e.dart),e.bulb&&n.push(e.bulb),e.shit&&n.push(e.shit),e.skull&&n.push(e.skull),e.crystal_ball&&n.push(e.crystal_ball),e.see_no_evil&&n.push(e.see_no_evil),e.revolving_hearts&&n.push(e.revolving_hearts),e.palm_tree&&n.push(e.palm_tree),n};modules.require(["extend","PubSub"],function(t,r){var s=t(r),a=s,u=a.superclass;n.tools.mixin(a.prototype,{initialize:function(){u.initialize.apply(this,arguments),this._emotions=null},fetch:function(t){e.ajax({url:"/a/4/d/impressions/emotions",type:"get",dataType:"json",success:function(e){e.objects&&e.objects.length>0&&(i=e.objects,i=o(i),this._notify("fetched",i),n.tools.isFunction(t)&&t(i))}.bind(this),error:function(){}.bind(this)})},getAll:function(t){n.tools.isNull(i)?this.fetch(t):t(i)}}),n.helper.emotions=new s})}(this,this.jQuery,this.BM),function(t,e){e=t.BM||{},e.helper=e.helper||{},e.helper.env=e.helper.env||{},e.tools.mixin(e.helper.env,{isStaging:function(){return"staging"===e.config.mainConfig.environment},isDevelopment:function(){return"development"===e.config.mainConfig.environment},isProduction:function(){return"production"===e.config.mainConfig.environment},getEnvironment:function(){return e.config.mainConfig.environment}})}(this,this.BM),function(t,e,n){n=t.BM||{},n.helper=n.helper||{},n.helper.event=n.helper.event||{};var i=n.tools.client.isTouch()?n.tools.client.touchEvent:"click";n.tools.mixin(n.helper.event,{clickName:function(){return i},isMouseLeftClick:function(t){return!n.tools.isUndefined(t)&&n.tools.isNumber(t.which)?1===t.which:void 0},isMouseMiddleClick:function(t){return!n.tools.isUndefined(t)&&n.tools.isNumber(t.which)?2===t.which:void 0},isMouseRightClick:function(t){return!n.tools.isUndefined(t)&&n.tools.isNumber(t.which)?3===t.which:void 0},isClickWithCtrl:function(t){return!n.tools.isUndefined(t)&&(!n.tools.isUndefined(t.ctrlKey)&&t.ctrlKey===!0||!n.tools.isUndefined(t.metaKey)&&t.metaKey===!0)},isSimpleMouseLeftClick:function(t){return n.helper.event.isMouseLeftClick(t)&&!n.helper.event.isClickWithCtrl(t)}})}(this,this.jQuery,this.BM),function(t,e,n){n=t.BM||{},n.helper=n.helper||{},n.helper.experiments=n.helper.experiments||{},n.tools.mixin(n.helper.experiments,{getExperiment:function(t){return e.findWhere(this.getExperiments(),{experiment:t})},getExperiments:function(){return n.config.mainConfig.experiments||[]}})}(this,this._,this.BM),function(t){t.BM=t.BM||{},BM.helper=BM.helper||{},BM.helper.hash={},BM.tools.mixin(BM.helper.hash,{isParamPresent:function(e){if(t.location.hash&&"string"==typeof e){var n=location.hash.slice(1).split("&");return-1!==n.indexOf(e)}}})}(this),function(t,e){e=t.BM||{},e.helper=e.helper||{},e.helper.history=e.helper.history||{},e.tools.mixin(e.helper.history,{getPopupQuoteState:function(t,e){return{type:"popupQuote",uuid:e,login:t}}})}(this,this.BM),function(t,e){e=t.BM||{},e.helper=e.helper||{},e.helper.link=e.helper.link||{},e.tools.mixin(e.helper.link,{full:function(n){return e.tools.isString(n)?-1!==n.indexOf("http")?n:t.location.origin+n:null},book:function(t){return"/books/"+t},reader:function(t){return"/reader/"+t},quote:function(t,n){return e.tools.isUndefined(n)&&(n=e.user.getLogin()),"/"+n+"/quotes/"+t},impression:function(t){return"/books/impressions/"+t},user:function(t){return"/"+t},userQuotes:function(t){return"/"+t+"/quotes"},libraryCard:function(t,e){return"/"+t+"/"+e},library:function(){return"/library"},referral:function(e){return t.location.origin+"/join/"+e},toAbsolute:function(n){return e.tools.isString(n)?("http"!==n.slice(0,4)&&("/"===n[0]&&"\\"===n[0]||(n="/"+n),n=t.location.origin+n),n):null},profileEdit:function(t){return e.tools.isPresent(t)||(t=e.user.login()),"/"+t+"/profile/edit"},appendParam:function(n,i){return e.tools.isString(n)||e.tools.isPresent(i)?(e.tools.isString(i)&&("&"!==i[0]&&"?"!==i[0]||(i=i.slice(1))),e.tools.isObject(i)&&(i=t.jQuery.param(i)),n+=-1!==n.indexOf("?")?"&"+i:"?"+i):n}})}(this,this.BM),function(t){t.BM=t.BM||{},BM.helper=BM.helper||{},BM.helper.misc={};var e=function(t){var e=t&&"function"==typeof t.callback?t.callback:function(){},n=t&&"number"==typeof t.timeout?t.timeout:5e3,i=null,o=!1,r=function(){null!==i&&(clearTimeout(i),i=null)},s=function(){r(),i=setTimeout(function(){o||(e(),s())},n)};this.start=function(){o=!1,s()},this.stop=function(){o=!0,r()},this.destroy=function(){r(),o=!0,r=null,s=null,e=null,i=null,this.stop=null,this.start=null}};BM.tools.mixin(BM.helper.misc,{repeater:function(t){return new e(t)}})}(this),function(t,e){e=t.BM||{},e.helper=e.helper||{},e.helper.page=e.helper.page||{},e.tools.mixin(e.helper.page,{isMyRecentPage:function(){return t.location.pathname==="/"+e.user.getLogin()+"/recent"},isOthersRecentPage:function(){return t.location.pathname==="/"+e.user.getViewingUserLogin()+"/recent"&&e.user.getLogin()!==e.user.getViewingUserLogin()},isSearchPage:function(){return"/search"===t.location.pathname},isPageImpression:function(){return-1!==t.location.pathname.indexOf("/books/impressions/")},isBookPage:function(){return/^\/books\/[a-zA-Z0-9]{4,12}$/.test(t.location.pathname)}})}(this,this.BM),function(t,e){e=t.BM||{},e.helper=e.helper||{},e.helper.pageTitle=e.helper.pageTitle||{};var n=document.title,i=[n],o=e.helper.pageTitle,r=null,s=function(){e.tools.isNull(r)&&(r=$($("#bm-page-titles-container").html()))};e.tools.mixin(o,{push:function(t){e.tools.isString(t)&&(i.push(t),document.title=t)},pop:function(){if(i.length<=1)return i[0];var t=i.pop();return document.title=i[i.length-1],t},reset:function(){i.length>0&&(document.title=i[0],i.length=0,i=[n])},getQuotePageTitle:function(n){return s(),t.t=r,r.find("@bm-quote-page-title").data("content").replace("%{quote_source}",e.helper.text.sliceBookTitle(n,150))},pushQuotePageTitle:function(t){o.push(o.getQuotePageTitle(t))},getBookPageTitle:function(t){return s(),r.find("@bm-book-page-title").data("content").replace("%{book_title}",e.helper.text.sliceBookTitle(t,150))},pushBookPageTitle:function(t){o.push(o.getBookPageTitle(t))}})}(this,this.BM),function(t,e,n,i,o){e=t.BM||{},e.helper=e.helper||{},e.helper.scroll={},o.require(["PubSub","extend"],function(t,i){e.helper.scroll=new t;var o=n("body"),r="m-scroll-block";e.tools.mixin(e.helper.scroll,{disable:function(t){t=t||o,t.addClass(r)},enable:function(t){t=t||o,t.removeClass(r)}})})}(this,this.BM,this.jQuery,this.radio,this.modules),function(t,e,n,i){e=t.BM||{},e.helper=e.helper||{},e.helper.session=e.helper.session||{};var o=e.tools.isPresent(i)&&e.tools.isPresent(i.setItem);e.tools.mixin(e.helper.session,{setItem:function(t,n){return e.tools.isString(t)&&e.tools.isString(n)?o?e.helper.session._setItemStorageMethod(t,n):e.helper.session._setItemCookiesMethod():void 0},_setItemStorageMethod:function(t,e){try{i.setItem(t,e)}catch(n){this._setItemCookiesMethod(t,e)}},_setItemCookiesMethod:function(t,e){n.setItem(t,e,void 0,"/")},getItem:function(t){return e.tools.isString(t)?o?e.helper.session._getItemStorageMethod(t):e.helper.session._getItemCookiesMethod(t):void 0},_getItemStorageMethod:function(t){try{return i.getItem(t)}catch(e){return this._getItemCookiesMethod(t)}},_getItemCookiesMethod:function(t){return n.getItem(t)}})}(this,this.BM,this.docCookies,this.sessionStorage),function(t,e,n,i,o,r){e=t.BM||{},e.helper=e.helper||{},e.helper.subscription={},o.require(["PubSub","extend"],function(o,s){e.helper.subscription=new o;var a=null,u=function(t){return""+t},l=function(t){return"$"+t},c=function(t){return e.user.isLocaleRu()?t+" .":t+" rub."},d=function(t){return t+" SGD"},h=function(t){return""+t},p=function(t){return"Rp"+t},f=function(t){return""+t},m=function(t){return t+" AZN"},g=function(t,n){return e.tools.isNull(t)?void 0:y(t)?c(k(t,!1,n)):v(t)?l(k(t,!0,n)):w(t)?d(k(t,!0,n)):C(t)?u(k(t,!0,n)):S(t)?h(k(t,!0,n)):x(t)?p(k(t,!0,n)):E(t)?f(k(t,!0,n)):P(t)?m(k(t,!0,n)):t},b=function(t){return e.tools.isUndefined(t)||e.tools.isNull(t)?void 0:y(t)?"RUB":v(t)?"USD":w(t)?"SGD":C(t)?"EUR":S(t)?"GBP":x(t)?"IDR":E(t)?"KZT":P(t)?"AZN":void 0},_=function(t,n){return e.tools.isNull(t)?void 0:"RUB"===n?c(t):"USD"===n?l(t):"SGD"===n?d(t):"EUR"===n?u(t):"GBP"===n?h(t):"IDR"===n?p(t):"KZT"===n?f(t):"AZN"===n?m(t):void 0},y=function(t){return e.tools.isNull(t)?void 0:-1!==t.indexOf("RUB")||-1!==t.indexOf(".")||-1!==t.indexOf("rub.")},v=function(t){return e.tools.isNull(t)?void 0:-1!==t.indexOf("$")||-1!==t.indexOf("USD")},w=function(t){return e.tools.isNull(t)?void 0:-1!==t.indexOf("SGD")},k=function(t,n,i){return e.tools.isNull(t)?void 0:(t=parseFloat(t.replace(/[a-z $]/gi,"")),i&&(t-=t/100*i),n?Math.ceil(100*t)/100:Math.ceil(t))},C=function(t){return e.tools.isNull(t)?void 0:-1!==t.indexOf("")||-1!==t.indexOf("EUR")},S=function(t){return e.tools.isNull(t)?void 0:-1!==t.indexOf("")||-1!==t.indexOf("GBP")},x=function(t){return e.tools.isNull(t)?void 0:-1!==t.indexOf("IDR")},E=function(t){return e.tools.isNull(t)?void 0:-1!==t.indexOf("KZT")},P=function(t){return e.tools.isNull(t)?void 0:-1!==t.indexOf("AZN")};e.tools.mixin(e.helper.subscription,{Type:{APP_STORE:"inapp",GOOGLE_PLAY:"googleplay",PAYPAL:"paypal",PROMO_CODE:"promo",CARD:"card",YANDEX_MONEY:"yandex_money",QIWI:"qiwi",WEBMONEY:"webmoney"},fetchPrices:function(){var t,i,o;if(e.tools.isFunction(arguments[0])){if(t=arguments[0],e.tools.isFunction(arguments[1])?i=arguments[1]:o=arguments[1],!e.tools.isNull(a)&&o!==!0)return void t(a);var r="/a/4/billing/web/product_levels.json";e.user.getSubscriptionCoutryCode()&&(r+="?subscription_country="+e.user.getSubscriptionCoutryCode()),n.ajax({url:r,type:"get",dataType:"json",success:function(n){a=n,e.helper.subscription._notify("prices-fetched",n),e.tools.isFunction(t)&&t(n)},error:function(){i&&i()}})}},getPrice:function(t,n,i){var o="visa",r=!0,s=null,u=!1,l=0;return t&&n?(e.tools.isUndefined(i)||(e.tools.isUndefined(i.paymentMethod)||(o=i.paymentMethod),e.tools.isUndefined(i.withCurrency)||(r=i.withCurrency),e.tools.isUndefined(i.keepFloats)||(u=i.keepFloats),!e.tools.isUndefined(i.discount)&&e.tools.isNumber(i.discount)&&(l=i.discount)),a.forEach(function(e){e.levels.forEach(function(i){i.products.forEach(function(a){e.payment_system===o&&i.kind===t&&a.duration===n&&(s=r?g(a.price,l):k(a.price,u,l))})})}),s):null},toCurrency:function(t,e){return _(t,e)},getCurrency:function(t){return b(t)},getPriceAsInt:function(t,n,i){return i=i||{},i.withCurrency=!1,e.helper.subscription.getPrice(t,n,i)}}),e.tools.mixin(e.helper.subscription,{recurrent:{stop:function(t){var i,o,s;if(e.tools.isPresent(t)&&(e.tools.isString(t.type)&&(i=t.type),e.tools.isFunction(t.success)&&(o=t.success),e.tools.isFunction(t.error)&&(s=t.error)),!e.tools.isPresent(i))return void(e.tools.isFunction(s)&&s());var a;return"card"===i||"braintree_card"===i||"braintree_paypal"===i?a="/payments/braintree":"sms"===i?a="/payments/inplat":"ruru"===i||"rururecurrent"===i?a="/payments/ruru":"tele2ee"===i||"tele2cbgrecurrent"===i?a="/payments/tele2_cbg.json":"tele2"===i||"tele2recurrent"===i||"tele2rurecurrent"===i?a="/payments/tele2.json":"mts_by"===i||"mtsbyrecurrent"===i?a="/payments/mts_by":"azercell"===i||"azercellrecurrent"===i?a="/payments/azercell":"kcell"===i||"kcellrecurrent"===i?a="/payments/kcell":"indosat"!==i&&"indosatrecurrent"!==i||(a="/payments/indosat"),e.tools.isPresent(a)?void n.ajax({url:a,type:"DELETE",success:function(t){r.track("Recurrent Subscription Stopped",{method:i}),e.tools.isFunction(o)&&o.apply(void 0,arguments)},error:function(){e.tools.isFunction(s)&&s.apply(void 0,arguments)}}):void(e.tools.isFunction(s)&&s())}}});var T=null;e.tools.mixin(e.helper.subscription,{currentUser:{getSubscriptionInfo:function(t){if(e.tools.isPresent(t)){var n=t.success;e.user.present()&&n&&(e.tools.isNull(T)?e.helper.subscription.currentUser.fetchSubscriptionInfo(t):n(T))}},fetchSubscriptionInfo:function(t){var i=t?t.success:function(){},o=t?t.error:function(){};e.user.present()&&n.ajax({url:"/a/4/user.json",type:"get",dataType:"json",success:function(t){t.subscription_info&&(T=t.subscription_info),e.tools.isFunction(i)&&!e.tools.isNull(T)&&i(T)},error:function(){e.tools.isFunction(o)&&o()}})},recurrentExists:function(){return e.tools.isArray(T)?T.filter(function(t){return!e.tools.isNull(t.recurrent)}).length>0:void 0},getSubscriptionLevel:function(){if(e.config.mainConfig.userInfo&&e.config.mainConfig.userInfo.subscription_info){var t=e.config.mainConfig.userInfo.subscription_info,n=t[t.length-1],i=1e3*n.expires_at>Date.now();return i?n.kind:!1}return!1}}}),e.tools.mixin(e.helper.subscription,{promo:{getLinkFromCode:function(e){return t.location.origin+"/code?promo="+e}}}),i("bm-product-levels-update").subscribe(function(t){a=t,e.helper.subscription._notify("prices-fetched",t)})})}(this,this.BM,this.jQuery,this.radio,this.modules,this.DIMixpanel),function(t,e){e=t.BM||{},e.helper=e.helper||{},e.helper.text=e.helper.text||{},e.tools.mixin(e.helper.text,{camelToHyphens:function(t){if(!e.tools.isString(t))return null;var n=t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()});return"-"===n[0]&&(n=n.slice(1)),n},slice:function(t,n,i){var o,r=!1;if(e.tools.isUndefined(i)||e.tools.isUndefined(i.dots)||(r=i.dots),e.tools.isString(t)&&e.tools.isNumber(n)){if(t=t.trim(),t.length<=n)return t;t=t.slice(0,n),-1!==t.lastIndexOf(" ")?(t=t.slice(0,t.lastIndexOf(" ")),o=t.split(" "),o[o.length-1].length<3&&o.splice(o.length-1,1),o[o.length-1]="...",t=o.join(" ")):r&&(t=t.slice(0,t.length-3)+"...")}return t},sliceBookTitle:function(t,n){return e.tools.isString(t)&&!e.tools.isNull(n)&&t.length>n?("("===t[0]&&")"===t[t.length-1]&&(t=t.slice(1,t.length-1)),t=t.replace(/ ?\([^)]+\) ?/gi," "),t.length<=n?t:(t=t.trim().slice(0,n),"("===t[0]&&(t=t.slice(1,t.length)),-1!==t.indexOf(".")?(t.lastIndexOf("."),t=t.slice(0,t.lastIndexOf("."))):-1!==t.indexOf(":")?t=t.slice(0,t.lastIndexOf(":")):(t=t.split(" "),t[t.length-1].length>=3?t[t.length-1]="...":(t.splice(t.length-1,1),t[t.length-1]="..."),t=t.join(" "),t=t.slice(0,-4)+"...",","===t[t.length-4]&&(t=t.slice(0,-4)+"...")),t)):t},sliceQuote:function(t,n){return e.helper.text.sliceBookTitle(t,n)},wrapInLocaleDependentQuotes:function(t){return e.tools.isString(t)?"ru"===e.user.getLocale()?""+t+"":""+t+"":void 0},escapeSpecialChars:function(t){return e.tools.isString(t)?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):null},nl2br:function(t){return(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br/>$2")}})}(this,this.BM),function(t){t.BM=t.BM||{},BM.helper=BM.helper||{},BM.helper.url={};var e={},n=function(){if(t.location.search){var n=location.search.slice(1).split("&");n.forEach(function(t){var n=t.split("=");e[n[0]]=n[1]})}};n();var i=function(t){return e.hasOwnProperty(t)?void 0===e[t]?null:e[t]:void 0};Object.defineProperty(BM.helper.url,"param",{get:function(){return i},set:function(){}}),BM.tools.mixin(BM.helper.url,{getFullRelativePath:function(){return t.location.pathname+t.location.search+t.location.hash}})}(this,this.BM),function(t,e,n){e=t.BM||{},e.lib=e.lib||{},e.lib.emoji={};var i=function(){var t=document.createElement("canvas");if(!t.getContext||!t.getContext("2d")||"function"!=typeof t.getContext("2d").fillText)return!1;var e=t.getContext("2d");return e.textBaseline="top",e.font="32px Arial",e.fillText("",0,0),0!==e.getImageData(16,16,1,1).data[0]}();e.tools.mixin(e.lib.emoji,{supported:function(){return e.tools.client.isLinux()?!1:e.tools.client.isAndroid()&&e.tools.client.getAndroidVersion()<=4.2?!1:e.tools.client.isWindows()&&!e.tools.client.isWindowsPhone()?!1:i},replace:function(i,o){return!e.tools.isPresent(i)||e.lib.emoji.supported()&&o!==!0?void 0:e.tools.isString(i)?n.parse(i):void(e.tools.isPresent(t.jQuery)&&e.tools.isInstanceOf(i,t.jQuery)?i.html(n.parse(i.html())):e.tools.isInstanceOf(i,t.HTMLElement)&&(i.innerHTML=n.parse(i.innerHTML)))}})}(this,this.BM,this.twemoji),function(t,e){e=t.BM||{},e.lib=e.lib||{},e.lib.topics={},e.tools.mixin(e.lib.topics,{fetch:function(t){var e=this;$.ajax({method:"GET",url:"/a/4/topics.json",success:function(n){e.data=n,t&&t()}})}})}(this,this.BM),void 0===jQuery.migrateMute&&(jQuery.migrateMute=!0),function(t,e,n){function i(n){var i=e.console;r[n]||(r[n]=!0,t.migrateWarnings.push(n),i&&i.warn&&!t.migrateMute&&(i.warn("JQMIGRATE: "+n),t.migrateTrace&&i.trace&&i.trace()))}function o(e,o,r,s){if(Object.defineProperty)try{return Object.defineProperty(e,o,{configurable:!0,enumerable:!0,get:function(){return i(s),r},set:function(t){i(s),r=t}}),n}catch(a){}t._definePropertyBroken=!0,e[o]=r}var r={};t.migrateWarnings=[],!t.migrateMute&&e.console&&e.console.log&&e.console.log("JQMIGRATE: Logging is active"),t.migrateTrace===n&&(t.migrateTrace=!0),t.migrateReset=function(){r={},t.migrateWarnings.length=0},"BackCompat"===document.compatMode&&i("jQuery is not compatible with Quirks Mode");var s=t("<input/>",{size:1}).attr("size")&&t.attrFn,a=t.attr,u=t.attrHooks.value&&t.attrHooks.value.get||function(){return null},l=t.attrHooks.value&&t.attrHooks.value.set||function(){return n},c=/^(?:input|button)$/i,d=/^[238]$/,h=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,p=/^(?:checked|selected)$/i;o(t,"attrFn",s||{},"jQuery.attrFn is deprecated"),t.attr=function(e,o,r,u){var l=o.toLowerCase(),f=e&&e.nodeType;return u&&(4>a.length&&i("jQuery.fn.attr( props, pass ) is deprecated"),e&&!d.test(f)&&(s?o in s:t.isFunction(t.fn[o])))?t(e)[o](r):("type"===o&&r!==n&&c.test(e.nodeName)&&e.parentNode&&i("Can't change the 'type' of an input or button in IE 6/7/8"),!t.attrHooks[l]&&h.test(l)&&(t.attrHooks[l]={get:function(e,i){var o,r=t.prop(e,i);return r===!0||"boolean"!=typeof r&&(o=e.getAttributeNode(i))&&o.nodeValue!==!1?i.toLowerCase():n},set:function(e,n,i){var o;return n===!1?t.removeAttr(e,i):(o=t.propFix[i]||i,o in e&&(e[o]=!0),e.setAttribute(i,i.toLowerCase())),i}},p.test(l)&&i("jQuery.fn.attr('"+l+"') may use property instead of attribute")),a.call(t,e,o,r))},t.attrHooks.value={get:function(t,e){var n=(t.nodeName||"").toLowerCase();return"button"===n?u.apply(this,arguments):("input"!==n&&"option"!==n&&i("jQuery.fn.attr('value') no longer gets properties"),e in t?t.value:null)},set:function(t,e){var o=(t.nodeName||"").toLowerCase();return"button"===o?l.apply(this,arguments):("input"!==o&&"option"!==o&&i("jQuery.fn.attr('value', val) no longer sets properties"),t.value=e,n)}};var f,m,g=t.fn.init,b=t.parseJSON,_=/^([^<]*)(<[\w\W]+>)([^>]*)$/;t.fn.init=function(e,n,o){var r;return e&&"string"==typeof e&&!t.isPlainObject(n)&&(r=_.exec(t.trim(e)))&&r[0]&&("<"!==e.charAt(0)&&i("$(html) HTML strings must start with '<' character"),r[3]&&i("$(html) HTML text after last tag is ignored"),"#"===r[0].charAt(0)&&(i("HTML string cannot start with a '#' character"),t.error("JQMIGRATE: Invalid selector string (XSS)")),n&&n.context&&(n=n.context),t.parseHTML)?g.call(this,t.parseHTML(r[2],n,!0),n,o):g.apply(this,arguments)},t.fn.init.prototype=t.fn,t.parseJSON=function(t){return t||null===t?b.apply(this,arguments):(i("jQuery.parseJSON requires a valid JSON string"),null)},t.uaMatch=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||0>t.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}},t.browser||(f=t.uaMatch(navigator.userAgent),m={},f.browser&&(m[f.browser]=!0,m.version=f.version),m.chrome?m.webkit=!0:m.webkit&&(m.safari=!0),t.browser=m),o(t,"browser",t.browser,"jQuery.browser is deprecated"),t.sub=function(){function e(t,n){return new e.fn.init(t,n)}t.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(i,o){return o&&o instanceof t&&!(o instanceof e)&&(o=e(o)),t.fn.init.call(this,i,o,n)},e.fn.init.prototype=e.fn;var n=e(document);return i("jQuery.sub() is deprecated"),e},t.ajaxSetup({converters:{"text json":t.parseJSON}});var y=t.fn.data;t.fn.data=function(e){var o,r,s=this[0];return!s||"events"!==e||1!==arguments.length||(o=t.data(s,e),r=t._data(s,e),o!==n&&o!==r||r===n)?y.apply(this,arguments):(i("Use of jQuery.fn.data('events') is deprecated"),r)};var v=/\/(java|ecma)script/i,w=t.fn.andSelf||t.fn.addBack;t.fn.andSelf=function(){return i("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),w.apply(this,arguments)},t.clean||(t.clean=function(e,o,r,s){o=o||document,o=!o.nodeType&&o[0]||o,o=o.ownerDocument||o,i("jQuery.clean() is deprecated");var a,u,l,c,d=[];if(t.merge(d,t.buildFragment(e,o).childNodes),r)for(l=function(t){return!t.type||v.test(t.type)?s?s.push(t.parentNode?t.parentNode.removeChild(t):t):r.appendChild(t):n},a=0;null!=(u=d[a]);a++)t.nodeName(u,"script")&&l(u)||(r.appendChild(u),u.getElementsByTagName!==n&&(c=t.grep(t.merge([],u.getElementsByTagName("script")),l),d.splice.apply(d,[a+1,0].concat(c)),a+=c.length));return d});var k=t.event.add,C=t.event.remove,S=t.event.trigger,x=t.fn.toggle,E=t.fn.live,P=t.fn.die,T="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",I=RegExp("\\b(?:"+T+")\\b"),A=/(?:^|\s)hover(\.\S+|)\b/,B=function(e){return"string"!=typeof e||t.event.special.hover?e:(A.test(e)&&i("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'"),e&&e.replace(A,"mouseenter$1 mouseleave$1"))};t.event.props&&"attrChange"!==t.event.props[0]&&t.event.props.unshift("attrChange","attrName","relatedNode","srcElement"),t.event.dispatch&&o(t.event,"handle",t.event.dispatch,"jQuery.event.handle is undocumented and deprecated"),t.event.add=function(t,e,n,o,r){t!==document&&I.test(e)&&i("AJAX events should be attached to document: "+e),k.call(this,t,B(e||""),n,o,r)},t.event.remove=function(t,e,n,i,o){C.call(this,t,B(e)||"",n,i,o)},t.fn.error=function(){var t=Array.prototype.slice.call(arguments,0);return i("jQuery.fn.error() is deprecated"),t.splice(0,0,"error"),arguments.length?this.bind.apply(this,t):(this.triggerHandler.apply(this,t),this)},t.fn.toggle=function(e,n){if(!t.isFunction(e)||!t.isFunction(n))return x.apply(this,arguments);i("jQuery.fn.toggle(handler, handler...) is deprecated");var o=arguments,r=e.guid||t.guid++,s=0,a=function(n){var i=(t._data(this,"lastToggle"+e.guid)||0)%s;return t._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),o[i].apply(this,arguments)||!1};for(a.guid=r;o.length>s;)o[s++].guid=r;return this.click(a)},t.fn.live=function(e,n,o){return i("jQuery.fn.live() is deprecated"),E?E.apply(this,arguments):(t(this.context).on(e,this.selector,n,o),this)},t.fn.die=function(e,n){return i("jQuery.fn.die() is deprecated"),P?P.apply(this,arguments):(t(this.context).off(e,this.selector||"**",n),this)},t.event.trigger=function(t,e,n,o){return n||I.test(t)||i("Global events are undocumented and deprecated"),S.call(this,t,e,n||document,o)},t.each(T.split("|"),function(e,n){t.event.special[n]={setup:function(){var e=this;return e!==document&&(t.event.add(document,n+"."+t.guid,function(){t.event.trigger(n,null,e,!0)}),t._data(this,n,t.guid++)),!1},teardown:function(){return this!==document&&t.event.remove(document,n+"."+t._data(this,n)),!1}}})}(jQuery,window),function(t,e){function n(e,n){var o,r,s,a=e.nodeName.toLowerCase();return"area"===a?(o=e.parentNode,r=o.name,e.href&&r&&"map"===o.nodeName.toLowerCase()?(s=t("img[usemap=#"+r+"]")[0],!!s&&i(s)):!1):(/input|select|textarea|button|object/.test(a)?!e.disabled:"a"===a?e.href||n:n)&&i(e)}function i(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}var o=0,r=/^ui-id-\d+$/;t.ui=t.ui||{},t.extend(t.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({focus:function(e){return function(n,i){return"number"==typeof n?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),i&&i.call(e)},n)}):e.apply(this,arguments)}}(t.fn.focus),scrollParent:function(){var e;return e=t.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.css(this,"position"))&&/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(n){if(n!==e)return this.css("zIndex",n);if(this.length)for(var i,o,r=t(this[0]);r.length&&r[0]!==document;){if(i=r.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(o=parseInt(r.css("zIndex"),10),!isNaN(o)&&0!==o))return o;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++o)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(n){return!!t.data(n,e)}}):function(e,n,i){return!!t.data(e,i[3])},focusable:function(e){return n(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var i=t.attr(e,"tabindex"),o=isNaN(i);return(o||i>=0)&&n(e,!o)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(n,i){function o(e,n,i,o){return t.each(r,function(){n-=parseFloat(t.css(e,"padding"+this))||0,i&&(n-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(n-=parseFloat(t.css(e,"margin"+this))||0)}),n}var r="Width"===i?["Left","Right"]:["Top","Bottom"],s=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(n){return n===e?a["inner"+i].call(this):this.each(function(){t(this).css(s,o(this,n)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){
t(this).css(s,o(this,e,!0,n)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(n){return arguments.length?e.call(this,t.camelCase(n)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.support.selectstart="onselectstart"in document.createElement("div"),t.fn.extend({disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.extend(t.ui,{plugin:{add:function(e,n,i){var o,r=t.ui[e].prototype;for(o in i)r.plugins[o]=r.plugins[o]||[],r.plugins[o].push([n,i[o]])},call:function(t,e,n){var i,o=t.plugins[e];if(o&&t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType)for(i=0;i<o.length;i++)t.options[o[i][0]]&&o[i][1].apply(t.element,n)}},hasScroll:function(e,n){if("hidden"===t(e).css("overflow"))return!1;var i=n&&"left"===n?"scrollLeft":"scrollTop",o=!1;return e[i]>0?!0:(e[i]=1,o=e[i]>0,e[i]=0,o)}})}(jQuery),function(t,e){var n=0,i=Array.prototype.slice,o=t.cleanData;t.cleanData=function(e){for(var n,i=0;null!=(n=e[i]);i++)try{t(n).triggerHandler("remove")}catch(r){}o(e)},t.widget=function(e,n,i){var o,r,s,a,u={},l=e.split(".")[0];e=e.split(".")[1],o=l+"-"+e,i||(i=n,n=t.Widget),t.expr[":"][o.toLowerCase()]=function(e){return!!t.data(e,o)},t[l]=t[l]||{},r=t[l][e],s=t[l][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new s(t,e)},t.extend(s,r,{version:i.version,_proto:t.extend({},i),_childConstructors:[]}),a=new n,a.options=t.widget.extend({},a.options),t.each(i,function(e,i){return t.isFunction(i)?void(u[e]=function(){var t=function(){return n.prototype[e].apply(this,arguments)},o=function(t){return n.prototype[e].apply(this,t)};return function(){var e,n=this._super,r=this._superApply;return this._super=t,this._superApply=o,e=i.apply(this,arguments),this._super=n,this._superApply=r,e}}()):void(u[e]=i)}),s.prototype=t.widget.extend(a,{widgetEventPrefix:r?a.widgetEventPrefix||e:e},u,{constructor:s,namespace:l,widgetName:e,widgetFullName:o}),r?(t.each(r._childConstructors,function(e,n){var i=n.prototype;t.widget(i.namespace+"."+i.widgetName,s,n._proto)}),delete r._childConstructors):n._childConstructors.push(s),t.widget.bridge(e,s)},t.widget.extend=function(n){for(var o,r,s=i.call(arguments,1),a=0,u=s.length;u>a;a++)for(o in s[a])r=s[a][o],s[a].hasOwnProperty(o)&&r!==e&&(t.isPlainObject(r)?n[o]=t.isPlainObject(n[o])?t.widget.extend({},n[o],r):t.widget.extend({},r):n[o]=r);return n},t.widget.bridge=function(n,o){var r=o.prototype.widgetFullName||n;t.fn[n]=function(s){var a="string"==typeof s,u=i.call(arguments,1),l=this;return s=!a&&u.length?t.widget.extend.apply(null,[s].concat(u)):s,a?this.each(function(){var i,o=t.data(this,r);return o?t.isFunction(o[s])&&"_"!==s.charAt(0)?(i=o[s].apply(o,u),i!==o&&i!==e?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+s+"' for "+n+" widget instance"):t.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+s+"'")}):this.each(function(){var e=t.data(this,r);e?e.option(s||{})._init():t.data(this,r,new o(s,this))}),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(n,i){var o,r,s,a=n;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof n)if(a={},o=n.split("."),n=o.shift(),o.length){for(r=a[n]=t.widget.extend({},this.options[n]),s=0;s<o.length-1;s++)r[o[s]]=r[o[s]]||{},r=r[o[s]];if(n=o.pop(),1===arguments.length)return r[n]===e?null:r[n];r[n]=i}else{if(1===arguments.length)return this.options[n]===e?null:this.options[n];a[n]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(e,n,i){var o,r=this;"boolean"!=typeof e&&(i=n,n=e,e=!1),i?(n=o=t(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,o=this.widget()),t.each(i,function(i,s){function a(){return e||r.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof s?r[s]:s).apply(r,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||t.guid++);var u=i.match(/^(\w+)\s*(.*)$/),l=u[1]+r.eventNamespace,c=u[2];c?o.delegate(c,l,a):n.bind(l,a)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function n(){return("string"==typeof t?i[t]:t).apply(i,arguments)}var i=this;return setTimeout(n,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,n,i){var o,r,s=this.options[e];if(i=i||{},n=t.Event(n),n.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),n.target=this.element[0],r=n.originalEvent)for(o in r)o in n||(n[o]=r[o]);return this.element.trigger(n,i),!(t.isFunction(s)&&s.apply(this.element[0],[n].concat(i))===!1||n.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,n){t.Widget.prototype["_"+e]=function(i,o,r){"string"==typeof o&&(o={effect:o});var s,a=o?o===!0||"number"==typeof o?n:o.effect||n:e;o=o||{},"number"==typeof o&&(o={duration:o}),s=!t.isEmptyObject(o),o.complete=r,o.delay&&i.delay(o.delay),s&&t.effects&&t.effects.effect[a]?i[e](o):a!==e&&i[a]?i[a](o.duration,o.easing,r):i.queue(function(n){t(this)[e](),r&&r.call(i[0]),n()})}})}(jQuery),function(t,e){"use strict";var n="animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd";e.fn.animationEnd=function(t){return this.each(function(){var i=e(this);i.off(n),i.on(n,function(){"function"==typeof t&&t.call(this)})})},e.fn.unbindAnimationEnd=function(){this.off(n)}}(this,jQuery),function(t){function e(e,i){if(t.trim(e.text()).length<=i.condensedLength+i.minTrail)return u("element too short: skipping."),!1;var o=t.trim(e.html()),r=t.trim(e.text()),s=(i.delim,e.clone()),a=0;do{var l=n(o,i.delim,i.condensedLength+a);s.html(t.trim(o.substring(0,l+1)));var c=s.text().length,d=s.html().length;a=s.html().length-c,u("condensing... [html-length:"+d+" text-length:"+c+" delta: "+a+" break-point: "+l+"]")}while(s.text().length<i.condensedLength);return r.length-c<i.minTrail?(u("not enough trailing text: skipping."),!1):(u("clone condensed. [text-length:"+c+"]"),s)}function n(t,e,n){var o=!1,r=n;do{var r=t.indexOf(e,r);if(0>r)return u("No delimiter found."),t.length;for(o=!0;i(t,r);)r++,o=!1}while(!o);return u("Delimiter found in html at: "+r),r}function i(t,e){return t.indexOf(">",e)<t.indexOf("<",e)}function o(t,e){u("Condense Trigger: "+t.html());var n=t.parent(),i=n.next();i.show();var o=i.width(),r=i.height();i.hide();var s=n.width(),a=n.height();n.animate({height:r,width:o,opacity:1},e.lessSpeed,e.easing,function(){n.height(a).width(s).hide(),i.show()})}function r(t,e){u("Expand Trigger: "+t.html());var n=t.parent(),i=n.prev();i.show();var o=i.width(),r=i.height();if(i.width(n.width()+"px").height(n.height()+"px"),n.hide(),i.animate({height:r,width:o,opacity:1},e.moreSpeed,e.easing),n.attr("id")){var s=n.attr("id");n.attr("id","condensed_"+s),i.attr("id",s)}}function s(t,e){var n=t.closest(".bm-bookshelf-book-item-desc"),i=n.find(".bm-bookshelf-book-item-tools-annotation-more"),o=n.find(".original"),r=n.find(".condensed");r.show();var s=r.width(),a=r.height();i.removeClass("hidden"),t.addClass("hidden"),r.hide();var u=o.width(),l=o.height();o.animate({height:a,width:s,opacity:1},e.lessSpeed,e.easing,function(){o.height(l).width(u).hide(),r.show()})}function a(t,e){var n=t.closest(".bm-bookshelf-book-item-desc"),i=n.find(".bm-bookshelf-book-item-tools-annotation-less"),o=n.find(".original"),r=n.find(".condensed");o.show();var s=o.width(),a=o.height();if(t.addClass("hidden"),i.removeClass("hidden"),o.width(r.width()+"px").height(r.height()+"px"),r.hide(),o.animate({height:a,width:s,opacity:1},e.moreSpeed,e.easing),r.attr("id")){var u=r.attr("id");r.attr("id","condensed_"+u),o.attr("id",u)}}function u(t){}t.fn.condense=function(n){u(t.metadata?"metadata plugin detected":"metadata plugin not present");var i=t.extend({},t.fn.condense.defaults,n);return this.each(function(){$this=t(this);var n=t.metadata?t.extend({},i,$this.metadata()):i;u("Condensing ["+$this.text().length+"]: "+$this.text());var l=e($this,n);if(l){var c,d;$this.attr("id")?$this.attr("id","condensed_"+$this.attr("id")):!1,i.controls?(c=i.controls.more,d=i.controls.less,l.removeClass("original").addClass("condensed").append(n.ellipsis),$this.after(l).hide(),c.removeClass("hidden"),c.click(function(e){e.preventDefault(),u("moreControl clicked."),a(t(this),n)}),d.click(function(e){e.preventDefault(),u("lessControl clicked."),s(t(this),n)})):(c=" <div class='condense_control condense_control_more' style='cursor:pointer;'>"+n.moreText+"</div>",d=" <div class='condense_control condense_control_less' style='cursor:pointer;'>"+n.lessText+"</div>",l.append(n.ellipsis+c),$this.after(l).hide().append(d),t(".condense_control_more",l).click(function(){u("moreControl clicked."),r(t(this),n)}),t(".condense_control_less",$this).click(function(){u("lessControl clicked."),o(t(this),n)}))}})},t.fn.condense.defaults={condensedLength:200,minTrail:20,delim:" ",moreText:"[more]",lessText:"[less]",ellipsis:" ( ... )",moreSpeed:"normal",lessSpeed:"normal",easing:"linear"}}(jQuery),function(t,e,n,i){var o=t(e);t.fn.lazyload=function(r){function s(){var e=0;u.each(function(){var n=t(this);if(!l.skip_invisible||n.is(":visible"))if(t.abovethetop(this,l)||t.leftofbegin(this,l));else if(t.belowthefold(this,l)||t.rightoffold(this,l)){if(++e>l.failure_limit)return!1}else n.trigger("appear"),e=0})}var a,u=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:e,data_attribute:"original",skip_invisible:!0,appear:null,load:null,error:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return r&&(i!==r.failurelimit&&(r.failure_limit=r.failurelimit,delete r.failurelimit),i!==r.effectspeed&&(r.effect_speed=r.effectspeed,delete r.effectspeed),t.extend(l,r)),a=l.container===i||l.container===e?o:t(l.container),0===l.event.indexOf("scroll")&&a.bind(l.event,function(){return s()}),this.each(function(){var e=this,n=t(e);e.loaded=!1,n.attr("src")!==i&&n.attr("src")!==!1||n.is("img")&&n.attr("src",l.placeholder),n.one("appear",function(){if(!this.loaded){if(l.appear){var i=u.length;l.appear.call(e,i,l)}t("<img />").bind("load",function(){var i=n.attr("data-"+l.data_attribute);n.hide(),n.is("img")?n.attr("src",i):n.css("background-image","url('"+i+"')"),n[l.effect](l.effect_speed),e.loaded=!0;var o=t.grep(u,function(t){return!t.loaded});if(u=t(o),l.load){var r=u.length;l.load.call(e,r,l)}}).bind("error",function(){if(l.error){var t=u.length;l.error.call(e,t,l)}}).attr("src",n.attr("data-"+l.data_attribute))}}),0!==l.event.indexOf("scroll")&&n.bind(l.event,function(){e.loaded||n.trigger("appear")})}),o.bind("resize",function(){s()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&o.bind("pageshow",function(e){e.originalEvent&&e.originalEvent.persisted&&u.each(function(){t(this).trigger("appear")})}),t(n).ready(function(){s()}),this},t.belowthefold=function(n,r){var s;return s=r.container===i||r.container===e?(e.innerHeight?e.innerHeight:o.height())+o.scrollTop():t(r.container).offset().top+t(r.container).height(),s<=t(n).offset().top-r.threshold},t.rightoffold=function(n,r){var s;return s=r.container===i||r.container===e?o.width()+o.scrollLeft():t(r.container).offset().left+t(r.container).width(),s<=t(n).offset().left-r.threshold},t.abovethetop=function(n,r){var s;return s=r.container===i||r.container===e?o.scrollTop():t(r.container).offset().top,s>=t(n).offset().top+r.threshold+t(n).height()},t.leftofbegin=function(n,r){var s;return s=r.container===i||r.container===e?o.scrollLeft():t(r.container).offset().left,s>=t(n).offset().left+r.threshold+t(n).width()},t.inviewport=function(e,n){return!(t.rightoffold(e,n)||t.leftofbegin(e,n)||t.belowthefold(e,n)||t.abovethetop(e,n))},t.extend(t.expr[":"],{"below-the-fold":function(e){return t.belowthefold(e,{threshold:0})},"above-the-top":function(e){return!t.belowthefold(e,{threshold:0})},"right-of-screen":function(e){return t.rightoffold(e,{threshold:0})},"left-of-screen":function(e){return!t.rightoffold(e,{threshold:0})},"in-viewport":function(e){return t.inviewport(e,{threshold:0})},"above-the-fold":function(e){return!t.belowthefold(e,{threshold:0})},"right-of-fold":function(e){return t.rightoffold(e,{threshold:0})},"left-of-fold":function(e){return!t.rightoffold(e,{threshold:0})}})}(jQuery,window,document),function(t){function e(){var t=document.createElement("input"),e="onpaste";return t.setAttribute(e,""),"function"==typeof t[e]?"paste":"input"}var n,i=e()+".mask",o=navigator.userAgent,r=/iphone/i.test(o),s=/android/i.test(o);t.mask={definitions:{a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},t.fn.extend({caret:function(t,e){var n;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof t?(e="number"==typeof e?e:t,this.each(function(){this.setSelectionRange?this.setSelectionRange(t,e):this.createTextRange&&(n=this.createTextRange(),n.collapse(!0),n.moveEnd("character",e),n.moveStart("character",t),n.select())})):(this[0].setSelectionRange?(t=this[0].selectionStart,e=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),t=0-n.duplicate().moveStart("character",-1e5),e=t+n.text.length),{begin:t,end:e})},unmask:function(){return this.trigger("unmask")},mask:function(e,o){var a,u,l,c,d,h;return!e&&this.length>0?(a=t(this[0]),a.data(t.mask.dataName)()):(o=t.extend({placeholder:t.mask.placeholder,completed:null},o),u=t.mask.definitions,l=[],c=h=e.length,d=null,t.each(e.split(""),function(t,e){"?"==e?(h--,c=t):u[e]?(l.push(new RegExp(u[e])),null===d&&(d=l.length-1)):l.push(null)}),this.trigger("unmask").each(function(){function a(t){for(;++t<h&&!l[t];);return t}function p(t){for(;--t>=0&&!l[t];);return t}function f(t,e){var n,i;if(!(0>t)){for(n=t,i=a(e);h>n;n++)if(l[n]){if(!(h>i&&l[n].test(k[i])))break;k[n]=k[i],k[i]=o.placeholder,i=a(i)}y(),w.caret(Math.max(d,t))}}function m(t){var e,n,i,r;for(e=t,n=o.placeholder;h>e;e++)if(l[e]){if(i=a(e),r=k[e],k[e]=n,!(h>i&&l[i].test(r)))break;n=r}}function g(t){var e,n,i,o=t.which;8===o||46===o||r&&127===o?(e=w.caret(),n=e.begin,i=e.end,i-n===0&&(n=46!==o?p(n):i=a(n-1),i=46===o?a(i):i),_(n,i),f(n,i-1),t.preventDefault()):27==o&&(w.val(C),w.caret(0,v()),t.preventDefault())}function b(e){var n,i,r,u=e.which,c=w.caret();e.ctrlKey||e.altKey||e.metaKey||32>u||u&&(c.end-c.begin!==0&&(_(c.begin,c.end),f(c.begin,c.end-1)),n=a(c.begin-1),h>n&&(i=String.fromCharCode(u),l[n].test(i)&&(m(n),k[n]=i,y(),r=a(n),s?setTimeout(t.proxy(t.fn.caret,w,r),0):w.caret(r),o.completed&&r>=h&&o.completed.call(w))),e.preventDefault())}function _(t,e){var n;for(n=t;e>n&&h>n;n++)l[n]&&(k[n]=o.placeholder)}function y(){w.val(k.join(""))}function v(t){var e,n,i=w.val(),r=-1;for(e=0,pos=0;h>e;e++)if(l[e]){for(k[e]=o.placeholder;pos++<i.length;)if(n=i.charAt(pos-1),l[e].test(n)){k[e]=n,r=e;break}if(pos>i.length)break}else k[e]===i.charAt(pos)&&e!==c&&(pos++,r=e);return t?y():c>r+1?(w.val(""),_(0,h)):(y(),w.val(w.val().substring(0,r+1))),c?e:d}var w=t(this),k=t.map(e.split(""),function(t,e){return"?"!=t?u[t]?o.placeholder:t:void 0}),C=w.val();w.data(t.mask.dataName,function(){return t.map(k,function(t,e){return l[e]&&t!=o.placeholder?t:null}).join("")}),w.attr("readonly")||w.one("unmask",function(){w.unbind(".mask").removeData(t.mask.dataName)}).bind("focus.mask",function(){clearTimeout(n);var t;C=w.val(),t=v(),n=setTimeout(function(){y(),t==e.length?w.caret(0,t):w.caret(t)},10)}).bind("blur.mask",function(){v(),w.val()!=C&&w.change()}).bind("keydown.mask",g).bind("keypress.mask",b).bind(i,function(){setTimeout(function(){var t=v(!0);w.caret(t),o.completed&&t==w.val().length&&o.completed.call(w)},0)}),v()}))}})}(jQuery),!function(t){function e(e,n,i){var o=e[n];o&&(e[n]=function(){return arguments[i]=arguments[i].replace(/@([\w\u00c0-\uFFFF\-]+)/g,'[role~="$1"]'),o.apply(e,arguments)},t.extend(e[n],o))}function n(e,n){for(var i,o=[],r=t.trim(e).split(/\s+/),s=0;s<r.length;s++)i=r[s],!~t.inArray(i,o)&&(!n||!~t.inArray(i,n))&&o.push(i);return o}e(t,"find",0),e(t,"multiFilter",0),e(t.find,"matchesSelector",1),e(t.find,"matches",0),t.extend(t.fn,{roles:function(){return n(this.attr("role"))},hasRole:function(t){for(var e=n(t),i=0;i<e.length;i++)if(!this.is("@"+e[i]))return!1;return!0},addRole:function(e){return this.hasRole(e)?this:this.each(function(i,o){var r=t(o);r.attr("role",n(r.attr("role")+" "+e).join(" "))})},removeRole:function(e){return this.hasRole(e)?this.each(function(i,o){var r=t(o);r.attr("role",n(r.attr("role"),n(e)).join(" "))}):this},toggleRole:function(t){for(var e=n(t),i=0;i<e.length;i++)this[this.hasRole(e[i])?"removeRole":"addRole"].call(this,e[i]);return this}})}(jQuery),function(t){function e(t){return"object"==typeof t?t:{top:t,left:t}}var n=t.scrollTo=function(e,n,i){t(window).scrollTo(e,n,i)};n.defaults={axis:"xy",duration:parseFloat(t.fn.jquery)>=1.3?0:1,limit:!0},n.window=function(e){return t(window)._scrollable()},t.fn._scrollable=function(){return this.map(function(){var e=this,n=!e.nodeName||-1!=t.inArray(e.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!n)return e;var i=(e.contentWindow||e).document||e.ownerDocument||e;return/webkit/i.test(navigator.userAgent)||"BackCompat"==i.compatMode?i.body:i.documentElement})},t.fn.scrollTo=function(i,o,r){return"object"==typeof o&&(r=o,o=0),"function"==typeof r&&(r={onAfter:r}),"max"==i&&(i=9e9),r=t.extend({},n.defaults,r),o=o||r.duration,r.queue=r.queue&&r.axis.length>1,r.queue&&(o/=2),r.offset=e(r.offset),r.over=e(r.over),this._scrollable().each(function(){function s(t){l.animate(d,o,r.easing,t&&function(){t.call(this,i,r)})}if(null!=i){var a,u=this,l=t(u),c=i,d={},h=l.is("html,body");switch(typeof c){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(c)){c=e(c);break}if(c=t(c,this),!c.length)return;case"object":(c.is||c.style)&&(a=(c=t(c)).offset())}t.each(r.axis.split(""),function(t,e){var i="x"==e?"Left":"Top",o=i.toLowerCase(),p="scroll"+i,f=u[p],m=n.max(u,e);if(a)d[p]=a[o]+(h?0:f-l.offset()[o]),r.margin&&(d[p]-=parseInt(c.css("margin"+i))||0,d[p]-=parseInt(c.css("border"+i+"Width"))||0),d[p]+=r.offset[o]||0,r.over[o]&&(d[p]+=c["x"==e?"width":"height"]()*r.over[o]);else{var g=c[o];d[p]=g.slice&&"%"==g.slice(-1)?parseFloat(g)/100*m:g}r.limit&&/^\d+$/.test(d[p])&&(d[p]=d[p]<=0?0:Math.min(d[p],m)),!t&&r.queue&&(f!=d[p]&&s(r.onAfterFirst),delete d[p])}),s(r.onAfter)}}).end()},n.max=function(e,n){var i="x"==n?"Width":"Height",o="scroll"+i;if(!t(e).is("html,body"))return e[o]-t(e)[i.toLowerCase()]();var r="client"+i,s=e.ownerDocument.documentElement,a=e.ownerDocument.body;return Math.max(s[o],a[o])-Math.min(s[r],a[r])}}(jQuery),function(t,e){"use strict";var n="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd";e.fn.transitionEnd=function(t){return this.each(function(){var i=e(this);i.off(n),i.on(n,function(){"function"==typeof t&&t.call(this)})})},e.fn.unbindTransitionEnd=function(){this.off(n)}}(this,jQuery),function(t,e){"use strict";e.fn.transitionFadeOut=function(t,n){var i,o={transitionProps:"opacity",delay:"0.3s",animationType:"ease"},r=Object.prototype.hasOwnProperty,s="";"function"==typeof t?n=t:"object"==typeof t&&e.extend(o,t);for(i in o)r.call(o,i)&&(s+=o[i]+" ");return this.each(function(){var t=e(this);t.css("opacity","1"),t.transitionEnd(function(){t.unbindTransitionEnd(),t.css("display","none"),"function"==typeof n&&n()}),t.css({transition:s,opacity:"0"})})},e.fn.transitionFadeIn=function(){return this.each(function(){var t=e(this);t.css("display","block"),t.css("opacity","0"),t.offsetHeight,t.transitionEnd(function(){t.unbindTransitionEnd(),t.css("display","block")}),t.css({opacity:"1"})})}}(this,jQuery),function(t){if(!t.browser){var e=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return e[2]||"0"};t.browser={mozilla:/mozilla/.test(navigator.userAgent.toLowerCase())&&!/webkit/.test(navigator.userAgent.toLowerCase()),webkit:/webkit/.test(navigator.userAgent.toLowerCase()),opera:/opera/.test(navigator.userAgent.toLowerCase()),msie:/msie/.test(navigator.userAgent.toLowerCase()),android:navigator.userAgent.toLowerCase().indexOf("mozilla/5.0")>-1&&navigator.userAgent.toLowerCase().indexOf("android ")>-1&&navigator.userAgent.toLowerCase().indexOf("applewebkit")>-1,version:e(navigator.userAgent)}}var n=(null!=window.orientation,t.browser.opera||t.browser.mozilla&&parseFloat(t.browser.version.substr(0,3))<1.9?"input":"paste"),i=function(e){e=t.event.fix(e||window.event),e.type="paste";var n=e.target;setTimeout(function(){t.event.dispatch.call(n,e)},1)};t.event.special.paste={setup:function(){this.addEventListener?this.addEventListener(n,i,!1):this.attachEvent&&this.attachEvent("on"+n,i)},teardown:function(){this.removeEventListener?this.removeEventListener(n,i,!1):this.detachEvent&&this.detachEvent("on"+n,i)}},t.extend({mask:{rules:{z:/[a-z]/,Z:/[A-Z]/,a:/[a-zA-Z]/,"*":/[0-9a-zA-Z]/,"@":/[0-9a-zA-Z]/},keyRepresentation:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"alt",27:"esc",33:"page up",34:"page down",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",116:"f5",123:"f12",224:"command"},signals:{"+":"","-":"-"},options:{attr:"alt",mask:null,type:"fixed",maxLength:-1,defaultValue:"",signal:!1,textAlign:!0,selectCharsOnFocus:!0,autoTab:!0,setSize:!1,fixedChars:"[(),.:/ -]",onInvalid:function(){},onValid:function(){},onOverflow:function(){},onFocus:function(t,e){},onBlur:function(t,e){},onBefore:function(){},onAfter:function(){}},masks:{phone:{mask:"(99) 9999-9999"},"phone-us":{mask:"(999) 999-9999"},cpf:{mask:"999.999.999-99"},cnpj:{mask:"99.999.999/9999-99"},date:{mask:"39/19/9999"},"date-us":{mask:"19/39/9999"},cep:{mask:"99999-999"},time:{mask:"29:59"},cc:{mask:"9999 9999 9999 9999"},integer:{mask:"999.999.999.999",type:"reverse"},decimal:{mask:"99,999.999.999.999",type:"reverse",defaultValue:"000"},"decimal-us":{mask:"99.999,999,999,999",type:"reverse",defaultValue:"000"},"signed-decimal":{mask:"99,999.999.999.999",type:"reverse",defaultValue:"+000"},"signed-decimal-us":{mask:"99,999.999.999.999",type:"reverse",defaultValue:"+000"}},init:function(){if(!this.hasInit){var e,n=this,i=this.keyRepresentation;for(this.ignore=!1,e=0;9>=e;e++)this.rules[e]=new RegExp("[0-"+e+"]");this.keyRep=i,this.ignoreKeys=[],t.each(i,function(t){n.ignoreKeys.push(parseInt(t,10))}),this.hasInit=!0}},set:function(e,n){var i=this,o=t(e),r="maxLength";return n=n||{},this.init(),o.each(function(){n.attr&&(i.options.attr=n.attr);var e=t(this),o=t.extend({},i.options),s=e.attr(o.attr),a="";if(a="string"==typeof n?n:""!==s?s:null,a&&(o.mask=a),i.masks[a]&&(o=t.extend(o,i.masks[a])),"object"==typeof n&&n.constructor!=Array&&(o=t.extend(o,n)),t.metadata&&(o=t.extend(o,e.metadata())),null!=o.mask){o.mask+="",e.data("mask")&&i.unset(e);var u=o.defaultValue,l="reverse"===o.type,c=new RegExp(o.fixedChars,"g");if(-1===o.maxLength&&(o.maxLength=e.attr(r)),o=t.extend({},o,{fixedCharsReg:new RegExp(o.fixedChars),fixedCharsRegG:c,maskArray:o.mask.split(""),maskNonFixedCharsArray:o.mask.replace(c,"").split("")}),"fixed"!=o.type&&!l||!o.setSize||e.attr("size")||e.attr("size",o.mask.length),l&&o.textAlign&&e.css("text-align","right"),""!==this.value||""!==u){var d=i.string(""!==this.value?this.value:u,o);this.defaultValue=d,e.val(d)}"infinite"==o.type&&(o.type="repeat"),e.data("mask",o),e.removeAttr(r),e.bind("keydown.mask",{func:i._onKeyDown,thisObj:i},i._onMask).bind("keypress.mask",{func:i._onKeyPress,thisObj:i},i._onMask).bind("keyup.mask",{func:i._onKeyUp,thisObj:i},i._onMask).bind("paste.mask",{func:i._onPaste,thisObj:i},i._onMask).bind("drop.mask",{func:i._onPaste,thisObj:i},i._onMask).bind("focus.mask",i._onFocus).bind("blur.mask",i._onBlur).bind("change.mask",i._onChange)}})},unset:function(e){var n=t(e);return n.each(function(){var e=t(this);if(e.data("mask")){var n=e.data("mask").maxLength;-1!=n&&e.attr("maxLength",n),e.unbind(".mask").removeData("mask")}})},string:function(e,n){this.init();var i={};switch("string"!=typeof e&&(e=String(e)),typeof n){case"string":this.masks[n]?i=t.extend(i,this.masks[n]):i.mask=n;break;case"object":i=n}i.fixedChars||(i.fixedChars=this.options.fixedChars);var o=new RegExp(i.fixedChars),r=new RegExp(i.fixedChars,"g");if("reverse"===i.type&&i.defaultValue&&"undefined"!=typeof this.signals[i.defaultValue.charAt(0)]){var s=e.charAt(0);i.signal="undefined"!=typeof this.signals[s]?this.signals[s]:this.signals[i.defaultValue.charAt(0)],i.defaultValue=i.defaultValue.substring(1)}return this.__maskArray(e.split(""),i.mask.replace(r,"").split(""),i.mask.split(""),i.type,i.maxLength,i.defaultValue,o,i.signal)},_onFocus:function(e){var n=t(this),i=n.data("mask");i.inputFocusValue=n.val(),i.changed=!1,i.selectCharsOnFocus&&n.select(),i.onFocus(this,e)},_onBlur:function(e){var n=t(this),i=n.data("mask");i.inputFocusValue==n.val()||i.changed||n.trigger("change"),i.onBlur(this,e)},_onChange:function(e){t(this).data("mask").changed=!0},_onMask:function(e){var n=e.data.thisObj,i={};return i._this=e.target,i.$this=t(i._this),i.data=i.$this.data("mask"),i.$this.attr("readonly")||!i.data?!0:(i[i.data.type]=!0,i.value=i.$this.val(),i.nKey=n.__getKeyNumber(e),i.range=n.__getRange(i._this),i.valueArray=i.value.split(""),e.data.func.call(n,e,i))},_onKeyDown:function(e,n){if(n.data.onBefore.call(n._this,i||"",n.nKey),this.ignore=t.inArray(n.nKey,this.ignoreKeys)>-1||(e.ctrlKey||e.metaKey||e.altKey)&&e.key,this.ignore){var i=this.keyRep[n.nKey];n.data.onValid.call(n._this,i||"",n.nKey)}return!0},_onKeyUp:function(t,e){return 9===e.nKey||16===e.nKey||e.nKey>=37&&e.nKey<=40?!0:e.repeat?(this.__autoTab(e),!0):this._onPaste(t,e)},_onPaste:function(e,n){n.reverse&&this.__changeSignal(e.type,n);var i=this.__maskArray(n.valueArray,n.data.maskNonFixedCharsArray,n.data.maskArray,n.data.type,n.data.maxLength,n.data.defaultValue,n.data.fixedCharsReg,n.data.signal);return n.$this.val(i),!n.reverse&&n.data.defaultValue.length&&n.range.start===n.range.end&&this.__setRange(n._this,n.range.start,n.range.end),!t.browser.msie&&!t.browser.safari||n.reverse||this.__setRange(n._this,n.range.start,n.range.end),this.ignore?!0:(this.__autoTab(n),n.data.onBefore.call(n._this),!0)},_onKeyPress:function(t,e){if(this.ignore)return!0;e.reverse&&this.__changeSignal(t.type,e);var n=String.fromCharCode(e.nKey),i=e.range.start,o=e.value,r=e.data.maskArray;if(e.reverse){var s=o.substr(0,i),a=o.substr(e.range.end,o.length);o=s+n+a,e.data.signal&&i-e.data.signal.length>0&&(i-=e.data.signal.length)}var u=o.replace(e.data.fixedCharsRegG,"").split(""),l=this.__extraPositionsTill(i,r,e.data.fixedCharsReg);if(e.rsEp=i+l,e.repeat&&(e.rsEp=0),!this.rules[r[e.rsEp]]||-1!=e.data.maxLength&&u.length>=e.data.maxLength&&e.repeat)return e.data.onOverflow.call(e._this,n,e.nKey),!1;if(!this.rules[r[e.rsEp]].test(n))return e.data.onInvalid.call(e._this,n,e.nKey),!1;e.data.onValid.call(e._this,n,e.nKey);var c=this.__maskArray(u,e.data.maskNonFixedCharsArray,r,e.data.type,e.data.maxLength,e.data.defaultValue,e.data.fixedCharsReg,e.data.signal,l);return e.repeat||e.$this.val(c),e.reverse?this._keyPressReverse(t,e):e.fixed?this._keyPressFixed(t,e):!0},_keyPressFixed:function(t,e){return e.range.start==e.range.end?(0===e.rsEp&&0===e.value.length||e.rsEp<e.value.length)&&this.__setRange(e._this,e.rsEp,e.rsEp+1):this.__setRange(e._this,e.range.start,e.range.end),!0},_keyPressReverse:function(e,n){return t.browser.msie&&(0===n.range.start&&0===n.range.end||n.range.start!=n.range.end)&&this.__setRange(n._this,n.value.length),!1},__autoTab:function(t){if(t.data.autoTab&&(t.$this.val().length>=t.data.maskArray.length&&!t.repeat||-1!=t.data.maxLength&&t.valueArray.length>=t.data.maxLength&&t.repeat)){var e=this.__getNextInput(t._this,t.data.autoTab);e&&(t.$this.trigger("blur"),e.focus().select())}},__changeSignal:function(t,e){if(e.data.signal!==!1){var n="paste"===t?e.value.charAt(0):String.fromCharCode(e.nKey);this.signals&&"undefined"!=typeof this.signals[n]&&(e.data.signal=this.signals[n])}},__getKeyNumber:function(t){return t.charCode||t.keyCode||t.which},__maskArray:function(t,e,n,i,o,r,s,a,u){switch("reverse"===i&&t.reverse(),t=this.__removeInvalidChars(t,e,"repeat"===i||"infinite"===i),r&&(t=this.__applyDefaultValue.call(t,r)),t=this.__applyMask(t,n,u,s),i){case"reverse":return t.reverse(),(a||"")+t.join("").substring(t.length-n.length);case"infinite":case"repeat":var l=t.join("");return-1!==o&&t.length>=o?l.substring(0,o):l;default:return t.join("").substring(0,n.length)}return""},__applyDefaultValue:function(t){var e,n=t.length,i=this.length;for(e=i-1;e>=0&&this[e]==t.charAt(0);e--)this.pop();for(e=0;n>e;e++)this[e]||(this[e]=t.charAt(e));return this},__removeInvalidChars:function(t,e,n){for(var i=0,o=0;i<t.length;i++)e[o]&&this.rules[e[o]]&&!this.rules[e[o]].test(t[i])&&(t.splice(i,1),n||o--,i--),n||o++;return t},__applyMask:function(t,e,n,i){"undefined"==typeof n&&(n=0);for(var o=0;o<t.length+n;o++)e[o]&&i.test(e[o])&&t.splice(o,0,e[o]);return t},__extraPositionsTill:function(t,e,n){for(var i=0;n.test(e[t++]);)i++;return i},__getNextInput:function(e,n){var i=e.form;if(null==i)return null;var o,r=i.elements,s=t.inArray(e,r)+1,a=r.length,u=null;for(o=s;a>o;o++)if(u=t(r[o]),this.__isNextInput(u,n))return u;
var l,c,d=document.forms,h=t.inArray(e.form,d)+1,p=d.length;for(l=h;p>l;l++)for(c=d[l].elements,a=c.length,o=0;a>o;o++)if(u=t(c[o]),this.__isNextInput(u,n))return u;return null},__isNextInput:function(t,e){var n=t.get(0);return n&&(n.offsetWidth>0||n.offsetHeight>0)&&"FIELDSET"!=n.nodeName&&(e===!0||"string"==typeof e&&t.is(e))},__setRange:function(t,e,n){if("undefined"==typeof n&&(n=e),t.setSelectionRange)t.setSelectionRange(e,n);else{var i=t.createTextRange();i.collapse(),i.moveStart("character",e),i.moveEnd("character",n-e),i.select()}},__getRange:function(e){if(!t.browser.msie&&!t.browser.android)return{start:e.selectionStart,end:e.selectionEnd};var n={start:0,end:0},i=document.selection.createRange();return n.start=0-i.duplicate().moveStart("character",-1e5),n.end=n.start+i.text.length,n},unmaskedVal:function(e){return t(e).val().replace(t.mask.fixedCharsRegG,"")}}}),t.fn.extend({setMask:function(e){return t.mask.set(this,e)},unsetMask:function(){return t.mask.unset(this)},unmaskedVal:function(){return t.mask.unmaskedVal(this[0])}})}(jQuery),function(t,e){t.rails!==e&&t.error("jquery-ujs has already been loaded!");var n,i=t(document);t.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote], button[data-confirm]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",CSRFProtection:function(e){var n=t('meta[name="csrf-token"]').attr("content");n&&e.setRequestHeader("X-CSRF-Token",n)},refreshCSRFTokens:function(){var e=t("meta[name=csrf-token]").attr("content"),n=t("meta[name=csrf-param]").attr("content");t('form input[name="'+n+'"]').val(e)},fire:function(e,n,i){var o=t.Event(n);return e.trigger(o,i),o.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t.attr("href")},handleRemote:function(i){var o,r,s,a,u,l,c,d;if(n.fire(i,"ajax:before")){if(a=i.data("cross-domain"),u=a===e?null:a,l=i.data("with-credentials")||null,c=i.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,i.is("form")){o=i.attr("method"),r=i.attr("action"),s=i.serializeArray();var h=i.data("ujs:submit-button");h&&(s.push(h),i.data("ujs:submit-button",null))}else i.is(n.inputChangeSelector)?(o=i.data("method"),r=i.data("url"),s=i.serialize(),i.data("params")&&(s=s+"&"+i.data("params"))):i.is(n.buttonClickSelector)?(o=i.data("method")||"get",r=i.data("url"),s=i.serialize(),i.data("params")&&(s=s+"&"+i.data("params"))):(o=i.data("method"),r=n.href(i),s=i.data("params")||null);return d={type:o||"GET",data:s,dataType:c,beforeSend:function(t,o){return o.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+o.accepts.script),n.fire(i,"ajax:beforeSend",[t,o])?void i.trigger("ajax:send",t):!1},success:function(t,e,n){i.trigger("ajax:success",[t,e,n])},complete:function(t,e){i.trigger("ajax:complete",[t,e])},error:function(t,e,n){i.trigger("ajax:error",[t,e,n])},crossDomain:u},l&&(d.xhrFields={withCredentials:l}),r&&(d.url=r),n.ajax(d)}return!1},handleMethod:function(i){var o=n.href(i),r=i.data("method"),s=i.attr("target"),a=t("meta[name=csrf-token]").attr("content"),u=t("meta[name=csrf-param]").attr("content"),l=t('<form method="post" action="'+o+'"></form>'),c='<input name="_method" value="'+r+'" type="hidden" />';u!==e&&a!==e&&(c+='<input name="'+u+'" value="'+a+'" type="hidden" />'),s&&l.attr("target",s),l.hide().append(c).appendTo("body"),l.submit()},formElements:function(e,n){return e.is("form")?t(e[0].elements).filter(n):e.find(n)},disableFormElements:function(e){n.formElements(e,n.disableSelector).each(function(){n.disableFormElement(t(this))})},disableFormElement:function(t){var n,i;n=t.is("button")?"html":"val",i=t.data("disable-with"),t.data("ujs:enable-with",t[n]()),i!==e&&t[n](i),t.prop("disabled",!0)},enableFormElements:function(e){n.formElements(e,n.enableSelector).each(function(){n.enableFormElement(t(this))})},enableFormElement:function(t){var e=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[e](t.data("ujs:enable-with")),t.prop("disabled",!1)},allowAction:function(t){var e,i=t.data("confirm"),o=!1;return i?(n.fire(t,"confirm")&&(o=n.confirm(i),e=n.fire(t,"confirm:complete",[o])),o&&e):!0},blankInputs:function(e,n,i){var o,r,s=t(),a=n||"input,textarea",u=e.find(a);return u.each(function(){if(o=t(this),r=o.is("input[type=checkbox],input[type=radio]")?o.is(":checked"):o.val(),!r==!i){if(o.is("input[type=radio]")&&u.filter('input[type=radio]:checked[name="'+o.attr("name")+'"]').length)return!0;s=s.add(o)}}),s.length?s:!1},nonBlankInputs:function(t,e){return n.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){var i=t.data("disable-with");t.data("ujs:enable-with",t.html()),i!==e&&t.html(i),t.bind("click.railsDisable",function(t){return n.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable")}},n.fire(i,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,i){t.crossDomain||n.CSRFProtection(i)}),i.delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(t(this))}),i.delegate(n.buttonDisableSelector,"ajax:complete",function(){n.enableFormElement(t(this))}),i.delegate(n.linkClickSelector,"click.rails",function(i){var o=t(this),r=o.data("method"),s=o.data("params"),a=i.metaKey||i.ctrlKey;if(!n.allowAction(o))return n.stopEverything(i);if(!a&&o.is(n.linkDisableSelector)&&n.disableElement(o),o.data("remote")!==e){if(a&&(!r||"GET"===r)&&!s)return!0;var u=n.handleRemote(o);return u===!1?n.enableElement(o):u.error(function(){n.enableElement(o)}),!1}return o.data("method")?(n.handleMethod(o),!1):void 0}),i.delegate(n.buttonClickSelector,"click.rails",function(e){var i=t(this);if(!n.allowAction(i))return n.stopEverything(e);i.is(n.buttonDisableSelector)&&n.disableFormElement(i);var o=n.handleRemote(i);return o===!1?n.enableFormElement(i):o.error(function(){n.enableFormElement(i)}),!1}),i.delegate(n.inputChangeSelector,"change.rails",function(e){var i=t(this);return n.allowAction(i)?(n.handleRemote(i),!1):n.stopEverything(e)}),i.delegate(n.formSubmitSelector,"submit.rails",function(i){var o,r,s=t(this),a=s.data("remote")!==e;if(!n.allowAction(s))return n.stopEverything(i);if(s.attr("novalidate")==e&&(o=n.blankInputs(s,n.requiredInputSelector),o&&n.fire(s,"ajax:aborted:required",[o])))return n.stopEverything(i);if(a){if(r=n.nonBlankInputs(s,n.fileInputSelector)){setTimeout(function(){n.disableFormElements(s)},13);var u=n.fire(s,"ajax:aborted:file",[r]);return u||setTimeout(function(){n.enableFormElements(s)},13),u}return n.handleRemote(s),!1}setTimeout(function(){n.disableFormElements(s)},13)}),i.delegate(n.formInputClickSelector,"click.rails",function(e){var i=t(this);if(!n.allowAction(i))return n.stopEverything(e);var o=i.attr("name"),r=o?{name:o,value:i.val()}:null;i.closest("form").data("ujs:submit-button",r)}),i.delegate(n.formSubmitSelector,"ajax:send.rails",function(e){this==e.target&&n.disableFormElements(t(this))}),i.delegate(n.formSubmitSelector,"ajax:complete.rails",function(e){this==e.target&&n.enableFormElements(t(this))}),t(function(){n.refreshCSRFTokens()}))}(jQuery),function(t){"use strict";jQuery.fn.extend({elastic:function(){var e=["paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","lineHeight","fontFamily","width","fontWeight","border-top-width","border-right-width","border-bottom-width","border-left-width","borderTopStyle","borderTopColor","borderRightStyle","borderRightColor","borderBottomStyle","borderBottomColor","borderLeftStyle","borderLeftColor"];return this.each(function(){function n(){var t=Math.floor(parseInt(r.width(),10));s.width()!==t&&(s.css({width:t+"px"}),o(!0))}function i(t,e){var n=Math.floor(parseInt(t,10));r.height()!==n&&r.css({height:n+"px",overflow:e})}function o(t){var e=r.val().replace(/&/g,"&amp;").replace(/ {2}/g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />"),n=s.html().replace(/<br>/gi,"<br />");if((t||e+"&nbsp;"!==n)&&(s.html(e+"&nbsp;"),Math.abs(s.height()-r.height())>3)){var o=s.height();o>=l?i(l+6,"auto"):u>=o?i(u+6,"hidden"):i(o+6,"hidden")}}if("textarea"!==this.type)return!1;var r=jQuery(this),s=jQuery("<div />").css({position:"absolute",display:"none","word-wrap":"break-word","white-space":"pre-wrap"}),a=parseInt(r.css("line-height"),10)||parseInt(r.css("font-size"),"10"),u=a,l=parseInt(r.css("max-height"),10)||Number.MAX_VALUE;0>l&&(l=Number.MAX_VALUE),s.appendTo(r.parent());for(var c=e.length;c--;)s.css(e[c].toString(),r.css(e[c].toString()));r.css({overflow:"hidden"}),r.bind("keyup change cut paste",function(){o()}),t(window).bind("resize",n),r.bind("resize",n),r.bind("update",o),r.bind("input paste",function(t){setTimeout(o,250)}),o()})}})}(jQuery),function(t,e){Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n;for(n=0,len=this.length;n<len;++n)n in this&&t.call(e,this[n],n,this)})}(this,this.document),[].includes||(Array.prototype.includes=function(t){"use strict";var e=Object(this),n=parseInt(e.length)||0;if(0===n)return!1;var i,o=parseInt(arguments[1])||0;o>=0?i=o:(i=n+o,0>i&&(i=0));for(var r;n>i;){if(r=e[i],t===r||t!==t&&r!==r)return!0;i++}return!1}),!function(t){function e(t,e){return function(){t.apply(e,arguments)}}function n(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],u(t,e(o,this),e(r,this))}function i(t){var e=this;return null===this._state?void this._deferreds.push(t):void l(function(){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return void(e._state?t.resolve:t.reject)(e._value);var i;try{i=n(e._value)}catch(o){return void t.reject(o)}t.resolve(i)})}function o(t){try{if(t===this)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void u(e(n,t),e(o,this),e(r,this))}this._state=!0,this._value=t,s.call(this)}catch(i){r.call(this,i)}}function r(t){this._state=!1,this._value=t,s.call(this)}function s(){for(var t=0,e=this._deferreds.length;e>t;t++)i.call(this,this._deferreds[t]);this._deferreds=null}function a(t,e,n,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=i}function u(t,e,n){var i=!1;try{t(function(t){i||(i=!0,e(t))},function(t){i||(i=!0,n(t))})}catch(o){if(i)return;i=!0,n(o)}}var l="function"==typeof setImmediate&&setImmediate||function(t){setTimeout(t,1)},c=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};n.prototype["catch"]=function(t){return this.then(null,t)},n.prototype.then=function(t,e){var o=this;return new n(function(n,r){i.call(o,new a(t,e,n,r))})},n.all=function(){var t=Array.prototype.slice.call(1===arguments.length&&c(arguments[0])?arguments[0]:arguments);return new n(function(e,n){function i(r,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(t){i(r,t)},n)}t[r]=s,0===--o&&e(t)}catch(u){n(u)}}if(0===t.length)return e([]);for(var o=t.length,r=0;r<t.length;r++)i(r,t[r])})},n.resolve=function(t){return t&&"object"==typeof t&&t.constructor===n?t:new n(function(e){e(t)})},n.reject=function(t){return new n(function(e,n){n(t)})},n.race=function(t){return new n(function(e,n){for(var i=0,o=t.length;o>i;i++)t[i].then(e,n)})},n._setImmediateFn=function(t){l=t},"undefined"!=typeof module&&module.exports?module.exports=n:t.Promise||(t.Promise=n)}(this),function(t,e,n,i,o){e.define("RouterWeb",["extend","storage","PubSub","PopupBase","ampersandRouter","ampersandState"],function(o,r,s,a,u,l,c){var d=r(a),h=d,p=h.superclass,f=n(t);i.tools.mixin(h.prototype,{initialize:function(e){p.initialize.apply(this,arguments),this._router=null,this._state=null,this._lastData=null,this._initialLocation=t.location.pathname,this._initialTitle=t.document.title,this._popupQuoteClass=null,this._popupQuoteHandler=null,this._popupImpressionClass=null,this._popupImpressionHandler=null,this._popupDocumentClass=null,this._popupDocumentHandler=null,this._initRouter(),this._initState(),this._setupEvents(),this._init()},_initRouter:function(){var t=this;this._router=new(l.extend({routes:{":login/quotes/:uuid":"quote","books/impressions/:uuid":"impressions","books/:uuid":"books","*other":"other"},quote:function(e,n){t._onQuoteRoute.apply(t,arguments)},impressions:function(e){t._onImpressionsRoute.apply(t,arguments)},books:function(e){t._onBooksRoute.apply(t,arguments)},other:function(){t._onOtherRoute.apply(t,arguments)}}))},_beforeRoute:function(){u.anyVisible()&&(u.enableHistoryControls(),u.hideAll(!0))},_onQuoteRoute:function(t,e){this._beforeRoute(),this._isInitialUrl()||this._showPopupQuote({uuid:e})},_onImpressionsRoute:function(t){this._beforeRoute(),this._isInitialUrl()||this._showPopupImpression({data:{uuid:t}})},_onBooksRoute:function(t){this._beforeRoute(),this._isInitialUrl()||this._showPopupDocument({book:{uuid:t}})},_onOtherRoute:function(){this._clear()},_registerLibraryCardLogin:function(t){var e=this._getRegisteredLCLogins();-1===e.indexOf(t)&&e.push(t),this._setRegisteredLCLogins(e)},_isLCLoginRegistered:function(t){var e=this._getRegisteredLCLogins();return-1!==e.indexOf(t)},_getRegisteredLCLogins:function(){return s.getItem("registredLCLogins")||this._setRegisteredLCLogins([]),JSON.parse(s.getItem("registredLCLogins"))},_setRegisteredLCLogins:function(t){s.setItem("registredLCLogins",JSON.stringify(t))},_isInitialUrl:function(){return t.location.pathname===this._initialLocation},getInitialLocation:function(){return this._initialLocation},_showPopupDocument:function(t){var n=this;i.tools.isNull(this._popupDocumentClass)?e.require("DocumentPopup",function(e){n._popupDocumentClass=e,n._initPopupDocument(t),n._popupDocumentHandler.openModal(t)}):(this._initPopupDocument(t),this._popupDocumentHandler.openModal(t))},_initPopupDocument:function(t){this._destroyPopupDocument(),this._popupDocumentHandler=new this._popupDocumentClass(t),this._popupDocumentHandler.on("fetch-success",function(t){this._onPopupDocumentFetched(t)}.bind(this)),this._popupDocumentHandler.on("hide",function(){this._onPopupHide()}.bind(this)),this._popupDocumentHandler.on("history-back-click",function(){this._onPopupHistoryBackClick()}.bind(this))},_onPopupDocumentFetched:function(t){try{i.helper.pageTitle.pushBookPageTitle(t.title)}catch(e){}},_destroyPopupDocument:function(){!i.tools.isNull(this._popupDocumentHandler)&&i.tools.isInstanceOf(this._popupDocumentHandler,this._popupDocumentClass)&&(this._popupDocumentHandler.destroy(),this._popupDocumentHandler=null)},_showPopupQuote:function(t){var n=this;i.tools.isNull(this._popupQuoteClass)?e.require("modulePopupQuote",function(e){n._popupQuoteClass=e,n._initPopupQuote(t),n._popupQuoteHandler.show()}):(this._initPopupQuote(t),this._popupQuoteHandler.show())},_initPopupQuote:function(t){this._destroyPopupQuote(),this._popupQuoteHandler=new this._popupQuoteClass(t),this._popupQuoteHandler.on("fetched",function(t){this._onPopupQuoteFetched(t)}.bind(this)),this._popupQuoteHandler.on("hide",function(){this._onPopupHide()}.bind(this)),this._popupQuoteHandler.on("button-back-click",function(){this._onPopupHistoryBackClick()}.bind(this))},_destroyPopupQuote:function(){!i.tools.isNull(this._popupQuoteHandler)&&i.tools.isInstanceOf(this._popupQuoteHandler,this._popupQuoteClass)&&(this._popupQuoteHandler.destroy(),this._popupQuoteHandler=null)},_onPopupQuoteFetched:function(t){try{i.helper.pageTitle.pushQuotePageTitle(t.document.title)}catch(e){}},_showPopupImpression:function(t){var n=this;i.tools.isNull(this._popupImpressionClass)?e.require(["PopupImpression"],function(e){n._popupImpressionClass=e,n._initPopupImpression(t),n._popupImpressionHandler.show()}):(this._initPopupImpression(t),this._popupImpressionHandler.show())},_initPopupImpression:function(t){this._destroyPopupImpression(),this._popupImpressionHandler=new this._popupImpressionClass(t),this._popupImpressionHandler.on("fetched",function(t){this._onPopupImpressionFetched(t)}.bind(this)),this._popupImpressionHandler.on("hide",function(){this._onPopupHide()}.bind(this)),this._popupImpressionHandler.on("button-back-click",function(){this._onPopupHistoryBackClick()}.bind(this))},_onPopupImpressionFetched:function(t){try{}catch(e){}},_destroyPopupImpression:function(){!i.tools.isNull(this._popupImpressionHandler)&&i.tools.isInstanceOf(this._popupImpressionHandler,this._popupImpressionClass)&&(this._popupImpressionHandler.destroy(),this._popupImpressionHandler=null)},_onPopupHide:function(){this._clearStateObject(),i.helper.pageTitle.reset(),this.navigate(this._initialLocation,{trigger:!0,state:null}),u.hideAll(!0)},_onPopupHistoryBackClick:function(){this.back()},_unbindAll:function(){i.tools.isNull(this._popupQuoteHandler)||this._popupQuoteHandler.off("hide"),i.tools.isNull(this._popupDocumentHandler)||this._popupDocumentHandler.off("hide")},_initState:function(){var t=this,e=c.extend({props:{config:"object",configHistory:"array"}});this._state=new e({config:{},configHistory:[]}),this._state.on("change",function(){t._onStateChange()})},_setupEvents:function(){var t=this;u.dispatcher.on("stop-history-request",function(){t._onStopHistoryRequest()})},_onStopHistoryRequest:function(){this.back(),this.stop()},_onStateChange:function(){switch(this._state.configHistory.push(this._state.config),this._state.config.type){case"popup-quote":this._onPopupQuoteStateChange();break;case"popup-document":this._onPopupDocumentStateChange()}},_clear:function(){i.routerState="",this._unbindAll(),this._clearStateObject(),u.hideAll(!0),u.disableHistoryControls(),this._isInitialUrl()&&i.helper.pageTitle.reset()},_clearStateObject:function(){i.tools.isPresent(this._state)&&this._state.set("config",{},{silent:!0})},_onPopupQuoteStateChange:function(){this._state.config.data.uuid&&this._state.config.data.login&&this.navigateToQuotePage(this._state.config.data.uuid,this._state.config.data.login)},_onPopupDocumentStateChange:function(){i.tools.isUndefined(this._state.config.data.bookUuid)||i.tools.isUndefined(this._state.config.data.documentUuid)||this.navigateToBookPage(this._state.config.data.bookUuid)},_init:function(){try{this._router.history.start({pushState:!0,silent:!0})}catch(t){}},queryParams:function(e){var n=e||t.location.search.substring(1),i={};return n.split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1]}),i},validateURL:function(t){var e=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:/\\S*)?$","i");return e.test(t)},stop:function(){if(!i.tools.isNull(this._router))try{this._router.history.stop()}catch(t){}},back:function(){this._isInitialUrl()?i.helper.pageTitle.reset():i.helper.pageTitle.pop(),t.history.back()},navigateToQuotePage:function(t,e){return this.navigate(i.helper.link.quote(t,e))},navigateToImpressionPage:function(t){return this.navigate(i.helper.link.impression(t.uuid))},navigateToBookPage:function(t){return this.navigate(i.helper.link.book(t))},navigate:function(t,e){var n=!0,o=void 0,r={};i.tools.isUndefined(e)||(i.tools.isUndefined(e.trigger)||(n=e.trigger),i.tools.isUndefined(e.data)||(r=e.data,!i.tools.isNull(this._lastData)&&i.tools.isObject(this._lastData.modal)&&(this._lastData.modal.off("hide"),this._lastData=null),this._lastData=r),i.tools.isUndefined(e.state)||(o=e.state)),i.tools.isNull(this._router)||this._router.navigate(t,{trigger:n,state:o})},getState:function(){return this._state},setState:function(t){i.tools.isNull(this._state)||this._state.set("config",t)},getRouter:function(){return this._router},pushStatePopupQuote:function(t,e){i.tools.isUndefined(t)||this._state.set("config",{type:"popup-quote",data:t})},pushStatePopupDocument:function(t,e){i.tools.isUndefined(e)||i.tools.isUndefined(e.context)||(this._lastMixpanelContext=e.context),i.tools.isUndefined(t)||this._state.set("config",{type:"popup-document",data:t})},_pushConfigHistory:function(){},getInitialLocation:function(){return this._initialLocation}});var m=new d;f.on("popstate",function(e){i.tools.isNull(e.originalEvent.state)?t.location.pathname!==m.getInitialLocation()&&t.location.reload():i.helper.pageTitle.pop()}),o(m)})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),!function(t,e){"use strict";function n(t,e){for(var n,i=[],r=0;r<t.length;++r){if(n=s[t[r]]||o(t[r]),!n)throw"module definition dependecy not found: "+t[r];i.push(n)}e.apply(null,i)}function i(t,i,o){if("string"!=typeof t)throw"invalid module definition, module id must be defined and be a string";if(i===e)throw"invalid module definition, dependencies must be specified";if(o===e)throw"invalid module definition, definition function must be specified";n(i,function(){s[t]=o.apply(null,arguments)})}function o(e){for(var n=t,i=e.split(/[.\/]/),o=0;o<i.length;++o){if(!n[i[o]])return;n=n[i[o]]}return n}function r(n){for(var i=0;i<n.length;i++){for(var o=t,r=n[i],a=r.split(/[.\/]/),u=0;u<a.length-1;++u)o[a[u]]===e&&(o[a[u]]={}),o=o[a[u]];o[a[a.length-1]]=s[r]}}var s={},a="moxie/core/utils/Basic",u="moxie/core/I18n",l="moxie/core/utils/Mime",c="moxie/core/utils/Env",d="moxie/core/utils/Dom",h="moxie/core/Exceptions",p="moxie/core/EventTarget",f="moxie/core/utils/Encode",m="moxie/runtime/Runtime",g="moxie/runtime/RuntimeClient",b="moxie/file/Blob",_="moxie/file/File",y="moxie/file/FileInput",v="moxie/file/FileDrop",w="moxie/runtime/RuntimeTarget",k="moxie/file/FileReader",C="moxie/core/utils/Url",S="moxie/file/FileReaderSync",x="moxie/xhr/FormData",E="moxie/xhr/XMLHttpRequest",P="moxie/runtime/Transporter",T="moxie/image/Image",I="moxie/runtime/html5/Runtime",A="moxie/runtime/html5/file/Blob",B="moxie/core/utils/Events",O="moxie/runtime/html5/file/FileInput",M="moxie/runtime/html5/file/FileDrop",$="moxie/runtime/html5/file/FileReader",D="moxie/runtime/html5/xhr/XMLHttpRequest",R="moxie/runtime/html5/utils/BinaryReader",L="moxie/runtime/html5/image/JPEGHeaders",F="moxie/runtime/html5/image/ExifParser",N="moxie/runtime/html5/image/JPEG",j="moxie/runtime/html5/image/PNG",U="moxie/runtime/html5/image/ImageInfo",V="moxie/runtime/html5/image/MegaPixel",H="moxie/runtime/html5/image/Image",z="moxie/runtime/flash/Runtime",q="moxie/runtime/flash/file/Blob",W="moxie/runtime/flash/file/FileInput",Q="moxie/runtime/flash/file/FileReader",Y="moxie/runtime/flash/file/FileReaderSync",G="moxie/runtime/flash/xhr/XMLHttpRequest",K="moxie/runtime/flash/runtime/Transporter",J="moxie/runtime/flash/image/Image",X="moxie/runtime/silverlight/Runtime",Z="moxie/runtime/silverlight/file/Blob",tt="moxie/runtime/silverlight/file/FileInput",et="moxie/runtime/silverlight/file/FileDrop",nt="moxie/runtime/silverlight/file/FileReader",it="moxie/runtime/silverlight/file/FileReaderSync",ot="moxie/runtime/silverlight/xhr/XMLHttpRequest",rt="moxie/runtime/silverlight/runtime/Transporter",st="moxie/runtime/silverlight/image/Image",at="moxie/runtime/html4/Runtime",ut="moxie/runtime/html4/file/FileInput",lt="moxie/runtime/html4/file/FileReader",ct="moxie/runtime/html4/xhr/XMLHttpRequest",dt="moxie/runtime/html4/image/Image";i(a,[],function(){var t=function(t){var e;return t===e?"undefined":null===t?"null":t.nodeType?"node":{}.toString.call(t).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},e=function(i){var o;return n(arguments,function(r,a){a>0&&n(r,function(n,r){n!==o&&(t(i[r])===t(n)&&~s(t(n),["array","object"])?e(i[r],n):i[r]=n)})}),i},n=function(t,e){var n,i,o,r;if(t){try{n=t.length}catch(s){n=r}if(n===r){for(i in t)if(t.hasOwnProperty(i)&&e(t[i],i)===!1)return}else for(o=0;n>o;o++)if(e(t[o],o)===!1)return}},i=function(e){var n;if(!e||"object"!==t(e))return!0;for(n in e)return!1;return!0},o=function(e,n){function i(o){"function"===t(e[o])&&e[o](function(t){++o<r&&!t?i(o):n(t)})}var o=0,r=e.length;"function"!==t(n)&&(n=function(){}),e&&e.length||n(),i(o)},r=function(t,e){var i=0,o=t.length,r=new Array(o);n(t,function(t,n){t(function(t){if(t)return e(t);var s=[].slice.call(arguments);s.shift(),r[n]=s,i++,i===o&&(r.unshift(null),e.apply(this,r))})})},s=function(t,e){if(e){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n}return-1},a=function(e,n){var i=[];"array"!==t(e)&&(e=[e]),"array"!==t(n)&&(n=[n]);for(var o in e)-1===s(e[o],n)&&i.push(e[o]);return i.length?i:!1},u=function(t,e){var i=[];return n(t,function(t){-1!==s(t,e)&&i.push(t)}),i.length?i:null},l=function(t){var e,n=[];for(e=0;e<t.length;e++)n[e]=t[e];return n},c=function(){var t=0;return function(e){var n,i=(new Date).getTime().toString(32);for(n=0;5>n;n++)i+=Math.floor(65535*Math.random()).toString(32);return(e||"o_")+i+(t++).toString(32)}}(),d=function(t){return t?String.prototype.trim?String.prototype.trim.call(t):t.toString().replace(/^\s*/,"").replace(/\s*$/,""):t},h=function(t){if("string"!=typeof t)return t;var e,n={t:1099511627776,g:1073741824,m:1048576,k:1024};return t=/^([0-9]+)([mgk]?)$/.exec(t.toLowerCase().replace(/[^0-9mkg]/g,"")),e=t[2],t=+t[1],n.hasOwnProperty(e)&&(t*=n[e]),t};return{guid:c,typeOf:t,extend:e,each:n,isEmptyObj:i,inSeries:o,inParallel:r,inArray:s,arrayDiff:a,arrayIntersect:u,toArray:l,trim:d,parseSizeStr:h}}),i(u,[a],function(t){var e={};return{addI18n:function(n){return t.extend(e,n)},translate:function(t){return e[t]||t},_:function(t){return this.translate(t)},sprintf:function(e){var n=[].slice.call(arguments,1);return e.replace(/%[a-z]/g,function(){var e=n.shift();return"undefined"!==t.typeOf(e)?e:""})}}}),i(l,[a,u],function(t,e){var n="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",i={mimes:{},extensions:{},addMimeType:function(t){var e,n,i,o=t.split(/,/);for(e=0;e<o.length;e+=2){for(i=o[e+1].split(/ /),n=0;n<i.length;n++)this.mimes[i[n]]=o[e];this.extensions[o[e]]=i}},extList2mimes:function(e,n){var i,o,r,s,a=this,u=[];for(o=0;o<e.length;o++)for(i=e[o].extensions.split(/\s*,\s*/),r=0;r<i.length;r++){if("*"===i[r])return[];if(s=a.mimes[i[r]])-1===t.inArray(s,u)&&u.push(s);else{if(!n||!/^\w+$/.test(i[r]))return[];u.push("."+i[r])}}return u},mimes2exts:function(e){var n=this,i=[];return t.each(e,function(e){if("*"===e)return i=[],!1;var o=e.match(/^(\w+)\/(\*|\w+)$/);o&&("*"===o[2]?t.each(n.extensions,function(t,e){new RegExp("^"+o[1]+"/").test(e)&&[].push.apply(i,n.extensions[e])}):n.extensions[e]&&[].push.apply(i,n.extensions[e]))}),i},mimes2extList:function(n){var i=[],o=[];return"string"===t.typeOf(n)&&(n=t.trim(n).split(/\s*,\s*/)),o=this.mimes2exts(n),i.push({title:e.translate("Files"),extensions:o.length?o.join(","):"*"}),i.mimes=n,i},getFileExtension:function(t){var e=t&&t.match(/\.([^.]+)$/);return e?e[1].toLowerCase():""},getFileMime:function(t){return this.mimes[this.getFileExtension(t)]||""}};return i.addMimeType(n),i}),i(c,[a],function(t){function e(t,e,n){var i=0,o=0,r=0,s={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},a=function(t){return t=(""+t).replace(/[_\-+]/g,"."),t=t.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),t.length?t.split("."):[-8]},u=function(t){return t?isNaN(t)?s[t]||-7:parseInt(t,10):0};for(t=a(t),e=a(e),o=Math.max(t.length,e.length),i=0;o>i;i++)if(t[i]!=e[i]){if(t[i]=u(t[i]),e[i]=u(e[i]),t[i]<e[i]){r=-1;break}if(t[i]>e[i]){r=1;break}}if(!n)return r;switch(n){case">":case"gt":return r>0;case">=":case"ge":return r>=0;case"<=":case"le":return 0>=r;case"==":case"=":case"eq":return 0===r;case"<>":case"!=":case"ne":return 0!==r;case"":case"<":case"lt":return 0>r;default:return null}}var n=function(t){var e="",n="?",i="function",o="undefined",r="object",s="major",a="name",u="version",l={has:function(t,e){return-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()}},c={rgx:function(){for(var e,n,s,a,u,l,c,d=0,h=arguments;d<h.length;d+=2){var p=h[d],f=h[d+1];if(typeof e===o){e={};for(a in f)u=f[a],typeof u===r?e[u[0]]=t:e[u]=t}for(n=s=0;n<p.length;n++)if(l=p[n].exec(this.getUA())){for(a=0;a<f.length;a++)c=l[++s],u=f[a],typeof u===r&&u.length>0?2==u.length?e[u[0]]=typeof u[1]==i?u[1].call(this,c):u[1]:3==u.length?e[u[0]]=typeof u[1]!==i||u[1].exec&&u[1].test?c?c.replace(u[1],u[2]):t:c?u[1].call(this,c,u[2]):t:4==u.length&&(e[u[0]]=c?u[3].call(this,c.replace(u[1],u[2])):t):e[u]=c?c:t;break}if(l)break}return e},str:function(e,i){for(var o in i)if(typeof i[o]===r&&i[o].length>0){for(var s=0;s<i[o].length;s++)if(l.has(i[o][s],e))return o===n?t:o}else if(l.has(i[o],e))return o===n?t:o;return e}},d={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},h={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[a,u,s],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[a,"Opera"],u,s],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[a,u,s],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[a,"IE"],u,s],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[a,"Yandex"],u,s],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[a,/_/g," "],u,s],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[a,u,s],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[a,"Dolphin"],u,s],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[a,"Chrome"],u,s],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[a,"Android Browser"],u,s],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[u,s,[a,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[u,s,a],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[a,[s,c.str,d.browser.oldsafari.major],[u,c.str,d.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[a,u,s],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[a,"Netscape"],u,s],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[a,u,s]],
engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[a,u],[/rv\:([\w\.]+).*(gecko)/i],[u,a]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[a,[u,c.str,d.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[a,"Windows"],[u,c.str,d.os.windows.version]],[/\((bb)(10);/i],[[a,"BlackBerry"],u],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[a,u],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[a,"Symbian"],u],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[a,"Firefox OS"],u],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[a,u],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[a,"Chromium OS"],u],[/(sunos)\s?([\w\.]+\d)*/i],[[a,"Solaris"],u],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[a,u],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[a,"iOS"],[u,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[a,[u,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[a,u]]},p=function(t){var n=t||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:e);this.getBrowser=function(){return c.rgx.apply(this,h.browser)},this.getEngine=function(){return c.rgx.apply(this,h.engine)},this.getOS=function(){return c.rgx.apply(this,h.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return n},this.setUA=function(t){return n=t,this},this.setUA(n)};return(new p).getResult()}(),i=function(){var e={define_property:function(){return!1}(),create_canvas:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}(),return_response_type:function(e){try{if(-1!==t.inArray(e,["","text","document"]))return!0;if(window.XMLHttpRequest){var n=new XMLHttpRequest;if(n.open("get","/"),"responseType"in n)return n.responseType=e,n.responseType===e}}catch(i){}return!1},use_data_uri:function(){var t=new Image;return t.onload=function(){e.use_data_uri=1===t.width&&1===t.height},setTimeout(function(){t.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return e.use_data_uri&&("IE"!==o.browser||o.version>=9)},use_data_uri_of:function(t){return e.use_data_uri&&33e3>t||e.use_data_uri_over32kb()},use_fileinput:function(){var t=document.createElement("input");return t.setAttribute("type","file"),!t.disabled}};return function(n){var i=[].slice.call(arguments);return i.shift(),"function"===t.typeOf(e[n])?e[n].apply(this,i):!!e[n]}}(),o={can:i,browser:n.browser.name,version:parseFloat(n.browser.major),os:n.os.name,osVersion:n.os.version,verComp:e,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return o.OS=o.os,o}),i(d,[c],function(t){var e=function(t){return"string"!=typeof t?t:document.getElementById(t)},n=function(t,e){if(!t.className)return!1;var n=new RegExp("(^|\\s+)"+e+"(\\s+|$)");return n.test(t.className)},i=function(t,e){n(t,e)||(t.className=t.className?t.className.replace(/\s+$/,"")+" "+e:e)},o=function(t,e){if(t.className){var n=new RegExp("(^|\\s+)"+e+"(\\s+|$)");t.className=t.className.replace(n,function(t,e,n){return" "===e&&" "===n?" ":""})}},r=function(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(t,null)[e]:void 0},s=function(e,n){function i(t){var e,n,i=0,o=0;return t&&(n=t.getBoundingClientRect(),e="CSS1Compat"===l.compatMode?l.documentElement:l.body,i=n.left+e.scrollLeft,o=n.top+e.scrollTop),{x:i,y:o}}var o,r,s,a=0,u=0,l=document;if(e=e,n=n||l.body,e&&e.getBoundingClientRect&&"IE"===t.browser&&(!l.documentMode||l.documentMode<8))return r=i(e),s=i(n),{x:r.x-s.x,y:r.y-s.y};for(o=e;o&&o!=n&&o.nodeType;)a+=o.offsetLeft||0,u+=o.offsetTop||0,o=o.offsetParent;for(o=e.parentNode;o&&o!=n&&o.nodeType;)a-=o.scrollLeft||0,u-=o.scrollTop||0,o=o.parentNode;return{x:a,y:u}},a=function(t){return{w:t.offsetWidth||t.clientWidth,h:t.offsetHeight||t.clientHeight}};return{get:e,hasClass:n,addClass:i,removeClass:o,getStyle:r,getPos:s,getSize:a}}),i(h,[a],function(t){function e(t,e){var n;for(n in t)if(t[n]===e)return n;return null}return{RuntimeError:function(){function n(t){this.code=t,this.name=e(i,t),this.message=this.name+": RuntimeError "+this.code}var i={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return t.extend(n,i),n.prototype=Error.prototype,n}(),OperationNotAllowedException:function(){function e(t){this.code=t,this.name="OperationNotAllowedException"}return t.extend(e,{NOT_ALLOWED_ERR:1}),e.prototype=Error.prototype,e}(),ImageError:function(){function n(t){this.code=t,this.name=e(i,t),this.message=this.name+": ImageError "+this.code}var i={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return t.extend(n,i),n.prototype=Error.prototype,n}(),FileException:function(){function n(t){this.code=t,this.name=e(i,t),this.message=this.name+": FileException "+this.code}var i={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return t.extend(n,i),n.prototype=Error.prototype,n}(),DOMException:function(){function n(t){this.code=t,this.name=e(i,t),this.message=this.name+": DOMException "+this.code}var i={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return t.extend(n,i),n.prototype=Error.prototype,n}(),EventException:function(){function e(t){this.code=t,this.name="EventException"}return t.extend(e,{UNSPECIFIED_EVENT_TYPE_ERR:0}),e.prototype=Error.prototype,e}()}}),i(p,[h,a],function(t,e){function n(){var n={};e.extend(this,{uid:null,init:function(){this.uid||(this.uid=e.guid("uid_"))},addEventListener:function(t,i,o,r){var s,a=this;return t=e.trim(t),/\s/.test(t)?void e.each(t.split(/\s+/),function(t){a.addEventListener(t,i,o,r)}):(t=t.toLowerCase(),o=parseInt(o,10)||0,s=n[this.uid]&&n[this.uid][t]||[],s.push({fn:i,priority:o,scope:r||this}),n[this.uid]||(n[this.uid]={}),void(n[this.uid][t]=s))},hasEventListener:function(t){return t?!(!n[this.uid]||!n[this.uid][t]):!!n[this.uid]},removeEventListener:function(t,i){t=t.toLowerCase();var o,r=n[this.uid]&&n[this.uid][t];if(r){if(i){for(o=r.length-1;o>=0;o--)if(r[o].fn===i){r.splice(o,1);break}}else r=[];r.length||(delete n[this.uid][t],e.isEmptyObj(n[this.uid])&&delete n[this.uid])}},removeAllEventListeners:function(){n[this.uid]&&delete n[this.uid]},dispatchEvent:function(i){var o,r,s,a,u,l={},c=!0;if("string"!==e.typeOf(i)){if(a=i,"string"!==e.typeOf(a.type))throw new t.EventException(t.EventException.UNSPECIFIED_EVENT_TYPE_ERR);i=a.type,a.total!==u&&a.loaded!==u&&(l.total=a.total,l.loaded=a.loaded),l.async=a.async||!1}if(-1!==i.indexOf("::")?!function(t){o=t[0],i=t[1]}(i.split("::")):o=this.uid,i=i.toLowerCase(),r=n[o]&&n[o][i]){r.sort(function(t,e){return e.priority-t.priority}),s=[].slice.call(arguments),s.shift(),l.type=i,s.unshift(l);var d=[];e.each(r,function(t){s[0].target=t.scope,d.push(l.async?function(e){setTimeout(function(){e(t.fn.apply(t.scope,s)===!1)},1)}:function(e){e(t.fn.apply(t.scope,s)===!1)})}),d.length&&e.inSeries(d,function(t){c=!t})}return c},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(t){var n;"array"!==e.typeOf(t)&&(t=[t]);for(var i=0;i<t.length;i++)n="on"+t[i],"function"===e.typeOf(this[n])?this.addEventListener(t[i],this[n]):"undefined"===e.typeOf(this[n])&&(this[n]=null)}})}return n.instance=new n,n}),i(f,[],function(){var t=function(t){return unescape(encodeURIComponent(t))},e=function(t){return decodeURIComponent(escape(t))},n=function(t,n){if("function"==typeof window.atob)return n?e(window.atob(t)):window.atob(t);var i,o,r,s,a,u,l,c,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=0,p=0,f="",m=[];if(!t)return t;t+="";do s=d.indexOf(t.charAt(h++)),a=d.indexOf(t.charAt(h++)),u=d.indexOf(t.charAt(h++)),l=d.indexOf(t.charAt(h++)),c=s<<18|a<<12|u<<6|l,i=c>>16&255,o=c>>8&255,r=255&c,m[p++]=64==u?String.fromCharCode(i):64==l?String.fromCharCode(i,o):String.fromCharCode(i,o,r);while(h<t.length);return f=m.join(""),n?e(f):f},i=function(e,n){if(n&&t(e),"function"==typeof window.btoa)return window.btoa(e);var i,o,r,s,a,u,l,c,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=0,p=0,f="",m=[];if(!e)return e;do i=e.charCodeAt(h++),o=e.charCodeAt(h++),r=e.charCodeAt(h++),c=i<<16|o<<8|r,s=c>>18&63,a=c>>12&63,u=c>>6&63,l=63&c,m[p++]=d.charAt(s)+d.charAt(a)+d.charAt(u)+d.charAt(l);while(h<e.length);f=m.join("");var g=e.length%3;return(g?f.slice(0,g-3):f)+"===".slice(g||3)};return{utf8_encode:t,utf8_decode:e,atob:n,btoa:i}}),i(m,[a,d,p],function(t,e,n){function i(n,o,s,a,u){var l,c=this,d=t.guid(o+"_"),h=u||"browser";n=n||{},r[d]=this,s=t.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},s),n.preferred_caps&&(h=i.getMode(a,n.preferred_caps,h)),l=function(){var e={};return{exec:function(t,n,i,o){return l[n]&&(e[t]||(e[t]={context:this,instance:new l[n]}),e[t].instance[i])?e[t].instance[i].apply(this,o):void 0},removeInstance:function(t){delete e[t]},removeAllInstances:function(){var n=this;t.each(e,function(e,i){"function"===t.typeOf(e.instance.destroy)&&e.instance.destroy.call(e.context),n.removeInstance(i)})}}}(),t.extend(this,{initialized:!1,uid:d,type:o,mode:i.getMode(a,n.required_caps,h),shimid:d+"_container",clients:0,options:n,can:function(e,n){var o=arguments[2]||s;if("string"===t.typeOf(e)&&"undefined"===t.typeOf(n)&&(e=i.parseCaps(e)),"object"===t.typeOf(e)){for(var r in e)if(!this.can(r,e[r],o))return!1;return!0}return"function"===t.typeOf(o[e])?o[e].call(this,n):n===o[e]},getShimContainer:function(){var n,i=e.get(this.shimid);return i||(n=this.options.container?e.get(this.options.container):document.body,i=document.createElement("div"),i.id=this.shimid,i.className="moxie-shim moxie-shim-"+this.type,t.extend(i.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),n.appendChild(i),n=null),i},getShim:function(){return l},shimExec:function(t,e){var n=[].slice.call(arguments,2);return c.getShim().exec.call(this,this.uid,t,e,n)},exec:function(t,e){var n=[].slice.call(arguments,2);return c[t]&&c[t][e]?c[t][e].apply(this,n):c.shimExec.apply(this,arguments)},destroy:function(){if(c){var t=e.get(this.shimid);t&&t.parentNode.removeChild(t),l&&l.removeAllInstances(),this.unbindAll(),delete r[this.uid],this.uid=null,d=c=l=t=null}}}),this.mode&&n.required_caps&&!this.can(n.required_caps)&&(this.mode=!1)}var o={},r={};return i.order="html5,flash,silverlight,html4",i.getRuntime=function(t){return r[t]?r[t]:!1},i.addConstructor=function(t,e){e.prototype=n.instance,o[t]=e},i.getConstructor=function(t){return o[t]||null},i.getInfo=function(t){var e=i.getRuntime(t);return e?{uid:e.uid,type:e.type,mode:e.mode,can:function(){return e.can.apply(e,arguments)}}:null},i.parseCaps=function(e){var n={};return"string"!==t.typeOf(e)?e||{}:(t.each(e.split(","),function(t){n[t]=!0}),n)},i.can=function(t,e){var n,o,r=i.getConstructor(t);return r?(n=new r({required_caps:e}),o=n.mode,n.destroy(),!!o):!1},i.thatCan=function(t,e){var n=(e||i.order).split(/\s*,\s*/);for(var o in n)if(i.can(n[o],t))return n[o];return null},i.getMode=function(e,n,i){var o=null;if("undefined"===t.typeOf(i)&&(i="browser"),n&&!t.isEmptyObj(e)){if(t.each(n,function(n,i){if(e.hasOwnProperty(i)){var r=e[i](n);if("string"==typeof r&&(r=[r]),o){if(!(o=t.arrayIntersect(o,r)))return o=!1}else o=r}}),o)return-1!==t.inArray(i,o)?i:o[0];if(o===!1)return!1}return i},i.capTrue=function(){return!0},i.capFalse=function(){return!1},i.capTest=function(t){return function(){return!!t}},i}),i(g,[h,a,m],function(t,e,n){return function i(){var i;e.extend(this,{connectRuntime:function(o){function r(e){var s,u;return e.length?(s=e.shift(),(u=n.getConstructor(s))?(i=new u(o),i.bind("Init",function(){i.initialized=!0,setTimeout(function(){i.clients++,a.trigger("RuntimeInit",i)},1)}),i.bind("Error",function(){i.destroy(),r(e)}),i.mode?void i.init():void i.trigger("Error")):void r(e)):(a.trigger("RuntimeError",new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR)),void(i=null))}var s,a=this;if("string"===e.typeOf(o)?s=o:"string"===e.typeOf(o.ruid)&&(s=o.ruid),s){if(i=n.getRuntime(s))return i.clients++,i;throw new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR)}r((o.runtime_order||n.order).split(/\s*,\s*/))},getRuntime:function(){return i&&i.uid?i:(i=null,null)},disconnectRuntime:function(){i&&--i.clients<=0&&(i.destroy(),i=null)}})}}),i(b,[a,f,g],function(t,e,n){function i(r,s){function a(e,n,r){var s,a=o[this.uid];return"string"===t.typeOf(a)&&a.length?(s=new i(null,{type:r,size:n-e}),s.detach(a.substr(e,s.size)),s):null}n.call(this),r&&this.connectRuntime(r),s?"string"===t.typeOf(s)&&(s={data:s}):s={},t.extend(this,{uid:s.uid||t.guid("uid_"),ruid:r,size:s.size||0,type:s.type||"",slice:function(t,e,n){return this.isDetached()?a.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),t,e,n)},getSource:function(){return o[this.uid]?o[this.uid]:null},detach:function(t){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null),t=t||"";var n=t.match(/^data:([^;]*);base64,/);n&&(this.type=n[1],t=e.atob(t.substring(t.indexOf("base64,")+7))),this.size=t.length,o[this.uid]=t},isDetached:function(){return!this.ruid&&"string"===t.typeOf(o[this.uid])},destroy:function(){this.detach(),delete o[this.uid]}}),s.data?this.detach(s.data):o[this.uid]=s}var o={};return i}),i(_,[a,l,b],function(t,e,n){function i(i,o){var r,s;if(o||(o={}),s=o.type&&""!==o.type?o.type:e.getFileMime(o.name),o.name)r=o.name.replace(/\\/g,"/"),r=r.substr(r.lastIndexOf("/")+1);else{var a=s.split("/")[0];r=t.guid((""!==a?a:"file")+"_"),e.extensions[s]&&(r+="."+e.extensions[s][0])}n.apply(this,arguments),t.extend(this,{type:s||"",name:r||t.guid("file_"),lastModifiedDate:o.lastModifiedDate||(new Date).toLocaleString()})}return i.prototype=n.prototype,i}),i(y,[a,l,d,h,p,u,_,m,g],function(t,e,n,i,o,r,s,a,u){function l(o){var l,d,h,p=this;if(-1!==t.inArray(t.typeOf(o),["string","node"])&&(o={browse_button:o}),d=n.get(o.browse_button),!d)throw new i.DOMException(i.DOMException.NOT_FOUND_ERR);h={accept:[{title:r.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:d.parentNode||document.body},o=t.extend({},h,o),"string"==typeof o.required_caps&&(o.required_caps=a.parseCaps(o.required_caps)),"string"==typeof o.accept&&(o.accept=e.mimes2extList(o.accept)),l=n.get(o.container),l||(l=document.body),"static"===n.getStyle(l,"position")&&(l.style.position="relative"),l=d=null,u.call(p),t.extend(p,{uid:t.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){p.convertEventPropsToHandlers(c),p.bind("RuntimeInit",function(e,i){p.ruid=i.uid,p.shimid=i.shimid,p.bind("Ready",function(){p.trigger("Refresh")},999),p.bind("Change",function(){var e=i.exec.call(p,"FileInput","getFiles");p.files=[],t.each(e,function(t){return 0===t.size?!0:void p.files.push(new s(p.ruid,t))})},999),p.bind("Refresh",function(){var e,r,s,a;s=n.get(o.browse_button),a=n.get(i.shimid),s&&(e=n.getPos(s,n.get(o.container)),r=n.getSize(s),a&&t.extend(a.style,{top:e.y+"px",left:e.x+"px",width:r.w+"px",height:r.h+"px"})),a=s=null}),i.exec.call(p,"FileInput","init",o)}),p.connectRuntime(t.extend({},o,{required_caps:{select_file:!0}}))},disable:function(e){var n=this.getRuntime();n&&n.exec.call(this,"FileInput","disable","undefined"===t.typeOf(e)?!0:e)},refresh:function(){p.trigger("Refresh")},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===t.typeOf(this.files)&&t.each(this.files,function(t){t.destroy()}),this.files=null}})}var c=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return l.prototype=o.instance,l}),i(v,[u,d,h,a,_,g,p,l],function(t,e,n,i,o,r,s,a){function u(n){var s,u=this;"string"==typeof n&&(n={drop_zone:n}),s={accept:[{title:t.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},n="object"==typeof n?i.extend({},s,n):s,n.container=e.get(n.drop_zone)||document.body,"static"===e.getStyle(n.container,"position")&&(n.container.style.position="relative"),"string"==typeof n.accept&&(n.accept=a.mimes2extList(n.accept)),r.call(u),i.extend(u,{uid:i.guid("uid_"),ruid:null,files:null,init:function(){u.convertEventPropsToHandlers(l),u.bind("RuntimeInit",function(t,e){u.ruid=e.uid,u.bind("Drop",function(){var t=e.exec.call(u,"FileDrop","getFiles");u.files=[],i.each(t,function(t){u.files.push(new o(u.ruid,t))})},999),e.exec.call(u,"FileDrop","init",n),u.dispatchEvent("ready")}),u.connectRuntime(n)},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null}})}var l=["ready","dragenter","dragleave","drop","error"];return u.prototype=s.instance,u}),i(w,[a,g,p],function(t,e,n){function i(){this.uid=t.guid("uid_"),e.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return i.prototype=n.instance,i}),i(k,[a,f,h,p,b,_,w],function(t,e,n,i,o,r,s){function a(){function i(t,i){function c(t){l.readyState=a.DONE,l.error=t,l.trigger("error"),d()}function d(){r.destroy(),r=null,l.trigger("loadend")}function h(e){r.bind("Error",function(t,e){c(e)}),r.bind("Progress",function(t){l.result=e.exec.call(r,"FileReader","getResult"),l.trigger(t)}),r.bind("Load",function(t){l.readyState=a.DONE,l.result=e.exec.call(r,"FileReader","getResult"),l.trigger(t),d()}),e.exec.call(r,"FileReader","read",t,i)}if(r=new s,this.convertEventPropsToHandlers(u),this.readyState===a.LOADING)return c(new n.DOMException(n.DOMException.INVALID_STATE_ERR));if(this.readyState=a.LOADING,this.trigger("loadstart"),i instanceof o)if(i.isDetached()){var p=i.getSource();switch(t){case"readAsText":case"readAsBinaryString":this.result=p;break;case"readAsDataURL":this.result="data:"+i.type+";base64,"+e.btoa(p)}this.readyState=a.DONE,this.trigger("load"),d()}else h(r.connectRuntime(i.ruid));else c(new n.DOMException(n.DOMException.NOT_FOUND_ERR))}var r,l=this;t.extend(this,{uid:t.guid("uid_"),readyState:a.EMPTY,result:null,error:null,readAsBinaryString:function(t){i.call(this,"readAsBinaryString",t)},readAsDataURL:function(t){i.call(this,"readAsDataURL",t)},readAsText:function(t){i.call(this,"readAsText",t)},abort:function(){this.result=null,-1===t.inArray(this.readyState,[a.EMPTY,a.DONE])&&(this.readyState===a.LOADING&&(this.readyState=a.DONE),r&&r.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort(),r&&(r.getRuntime().exec.call(this,"FileReader","destroy"),r.disconnectRuntime()),l=r=null}})}var u=["loadstart","progress","load","abort","error","loadend"];return a.EMPTY=0,a.LOADING=1,a.DONE=2,a.prototype=i.instance,a}),i(C,[],function(){var t=function(e,n){for(var i=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],o=i.length,r={http:80,https:443},s={},a=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,u=a.exec(e||"");o--;)u[o]&&(s[i[o]]=u[o]);if(!s.scheme){n&&"string"!=typeof n||(n=t(n||document.location.href)),s.scheme=n.scheme,s.host=n.host,s.port=n.port;var l="";/^[^\/]/.test(s.path)&&(l=n.path,/(\/|\/[^\.]+)$/.test(l)?l+="/":l=l.replace(/\/[^\/]+$/,"/")),s.path=l+(s.path||"")}return s.port||(s.port=r[s.scheme]||80),s.port=parseInt(s.port,10),s.path||(s.path="/"),delete s.source,s},e=function(e){var n={http:80,https:443},i=t(e);return i.scheme+"://"+i.host+(i.port!==n[i.scheme]?":"+i.port:"")+i.path+(i.query?i.query:"")},n=function(e){function n(t){return[t.scheme,t.host,t.port].join("/")}return"string"==typeof e&&(e=t(e)),n(t())===n(e)};return{parseUrl:t,resolveUrl:e,hasSameOrigin:n}}),i(S,[a,g,f],function(t,e,n){return function(){function i(t,e){if(!e.isDetached()){var i=this.connectRuntime(e.ruid).exec.call(this,"FileReaderSync","read",t,e);return this.disconnectRuntime(),i}var o=e.getSource();switch(t){case"readAsBinaryString":return o;case"readAsDataURL":return"data:"+e.type+";base64,"+n.btoa(o);case"readAsText":for(var r="",s=0,a=o.length;a>s;s++)r+=String.fromCharCode(o[s]);return r}}e.call(this),t.extend(this,{uid:t.guid("uid_"),readAsBinaryString:function(t){return i.call(this,"readAsBinaryString",t)},readAsDataURL:function(t){return i.call(this,"readAsDataURL",t)},readAsText:function(t){return i.call(this,"readAsText",t)}})}}),i(x,[h,a,b],function(t,e,n){function i(){var t,i=[];e.extend(this,{append:function(o,r){var s=this,a=e.typeOf(r);r instanceof n?t={name:o,value:r}:"array"===a?(o+="[]",e.each(r,function(t){s.append(o,t)})):"object"===a?e.each(r,function(t,e){s.append(o+"["+e+"]",t)}):"null"===a||"undefined"===a||"number"===a&&isNaN(r)?s.append(o,"false"):i.push({name:o,value:r.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return t&&t.value||null},getBlobName:function(){return t&&t.name||null},each:function(n){e.each(i,function(t){n(t.value,t.name)}),t&&n(t.value,t.name)},destroy:function(){t=null,i=[]}})}return i}),i(E,[a,h,p,f,C,m,w,b,S,x,c,l],function(t,e,n,i,o,r,s,a,u,l,c,d){function h(){this.uid=t.guid("uid_")}function p(){function n(t,e){return E.hasOwnProperty(t)?1===arguments.length?c.can("define_property")?E[t]:x[t]:void(c.can("define_property")?E[t]=e:x[t]=e):void 0}function u(e){function i(){C&&(C.destroy(),C=null),a.dispatchEvent("loadend"),a=null}function o(o){C.bind("LoadStart",function(t){n("readyState",p.LOADING),a.dispatchEvent("readystatechange"),a.dispatchEvent(t),M&&a.upload.dispatchEvent(t)}),C.bind("Progress",function(t){n("readyState")!==p.LOADING&&(n("readyState",p.LOADING),a.dispatchEvent("readystatechange")),a.dispatchEvent(t)}),C.bind("UploadProgress",function(t){M&&a.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:t.total,loaded:t.loaded})}),C.bind("Load",function(e){n("readyState",p.DONE),n("status",Number(o.exec.call(C,"XMLHttpRequest","getStatus")||0)),n("statusText",f[n("status")]||""),n("response",o.exec.call(C,"XMLHttpRequest","getResponse",n("responseType"))),~t.inArray(n("responseType"),["text",""])?n("responseText",n("response")):"document"===n("responseType")&&n("responseXML",n("response")),j=o.exec.call(C,"XMLHttpRequest","getAllResponseHeaders"),a.dispatchEvent("readystatechange"),n("status")>0?(M&&a.upload.dispatchEvent(e),a.dispatchEvent(e)):(D=!0,a.dispatchEvent("error")),i()}),C.bind("Abort",function(t){a.dispatchEvent(t),i()}),C.bind("Error",function(t){D=!0,n("readyState",p.DONE),a.dispatchEvent("readystatechange"),$=!0,a.dispatchEvent(t),i()}),o.exec.call(C,"XMLHttpRequest","send",{url:b,method:_,async:P,user:y,password:v,headers:T,mimeType:A,encoding:I,responseType:a.responseType,withCredentials:a.withCredentials,options:N},e)}var a=this;w=(new Date).getTime(),C=new s,"string"==typeof N.required_caps&&(N.required_caps=r.parseCaps(N.required_caps)),N.required_caps=t.extend({},N.required_caps,{return_response_type:a.responseType}),e instanceof l&&(N.required_caps.send_multipart=!0),R||(N.required_caps.do_cors=!0),N.ruid?o(C.connectRuntime(N)):(C.bind("RuntimeInit",function(t,e){o(e)}),C.bind("RuntimeError",function(t,e){a.dispatchEvent("RuntimeError",e)}),C.connectRuntime(N))}function g(){n("responseText",""),n("responseXML",null),n("response",null),n("status",0),n("statusText",""),w=k=null}var b,_,y,v,w,k,C,S,x=this,E={timeout:0,readyState:p.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},P=!0,T={},I=null,A=null,B=!1,O=!1,M=!1,$=!1,D=!1,R=!1,L=null,F=null,N={},j="";t.extend(this,E,{uid:t.guid("uid_"),upload:new h,open:function(r,s,a,u,l){var c;if(!r||!s)throw new e.DOMException(e.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(r)||i.utf8_encode(r)!==r)throw new e.DOMException(e.DOMException.SYNTAX_ERR);if(~t.inArray(r.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(_=r.toUpperCase()),~t.inArray(_,["CONNECT","TRACE","TRACK"]))throw new e.DOMException(e.DOMException.SECURITY_ERR);if(s=i.utf8_encode(s),c=o.parseUrl(s),R=o.hasSameOrigin(c),b=o.resolveUrl(s),(u||l)&&!R)throw new e.DOMException(e.DOMException.INVALID_ACCESS_ERR);if(y=u||c.user,v=l||c.pass,P=a||!0,P===!1&&(n("timeout")||n("withCredentials")||""!==n("responseType")))throw new e.DOMException(e.DOMException.INVALID_ACCESS_ERR);B=!P,O=!1,T={},g.call(this),n("readyState",p.OPENED),this.convertEventPropsToHandlers(["readystatechange"]),this.dispatchEvent("readystatechange")},setRequestHeader:function(o,r){var s=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(n("readyState")!==p.OPENED||O)throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(o)||i.utf8_encode(o)!==o)throw new e.DOMException(e.DOMException.SYNTAX_ERR);return o=t.trim(o).toLowerCase(),~t.inArray(o,s)||/^(proxy\-|sec\-)/.test(o)?!1:(T[o]?T[o]+=", "+r:T[o]=r,!0)},getAllResponseHeaders:function(){return j||""},getResponseHeader:function(e){return e=e.toLowerCase(),D||~t.inArray(e,["set-cookie","set-cookie2"])?null:j&&""!==j&&(S||(S={},t.each(j.split(/\r\n/),function(e){var n=e.split(/:\s+/);2===n.length&&(n[0]=t.trim(n[0]),S[n[0].toLowerCase()]={header:n[0],value:t.trim(n[1])})})),S.hasOwnProperty(e))?S[e].header+": "+S[e].value:null},overrideMimeType:function(i){var o,r;if(~t.inArray(n("readyState"),[p.LOADING,p.DONE]))throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);if(i=t.trim(i.toLowerCase()),/;/.test(i)&&(o=i.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(i=o[1],o[2]&&(r=o[2])),!d.mimes[i])throw new e.DOMException(e.DOMException.SYNTAX_ERR);L=i,F=r},send:function(n,o){if(N="string"===t.typeOf(o)?{ruid:o}:o?o:{},this.convertEventPropsToHandlers(m),this.upload.convertEventPropsToHandlers(m),this.readyState!==p.OPENED||O)throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);if(n instanceof a)N.ruid=n.ruid,A=n.type||"application/octet-stream";else if(n instanceof l){if(n.hasBlob()){var r=n.getBlob();N.ruid=r.ruid,A=r.type||"application/octet-stream"}}else"string"==typeof n&&(I="UTF-8",A="text/plain;charset=UTF-8",n=i.utf8_encode(n));this.withCredentials||(this.withCredentials=N.required_caps&&N.required_caps.send_browser_cookies&&!R),M=!B&&this.upload.hasEventListener(),D=!1,$=!n,B||(O=!0),u.call(this,n)},abort:function(){if(D=!0,B=!1,~t.inArray(n("readyState"),[p.UNSENT,p.OPENED,p.DONE]))n("readyState",p.UNSENT);else{if(n("readyState",p.DONE),O=!1,!C)throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);C.getRuntime().exec.call(C,"XMLHttpRequest","abort",$),$=!0}},destroy:function(){C&&("function"===t.typeOf(C.destroy)&&C.destroy(),C=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var f={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};h.prototype=n.instance;var m=["loadstart","progress","abort","error","load","timeout","loadend"];return p.UNSENT=0,p.OPENED=1,p.HEADERS_RECEIVED=2,p.LOADING=3,p.DONE=4,p.prototype=n.instance,p}),i(P,[a,f,g,p],function(t,e,n,i){function o(){function i(){c=d=0,l=this.result=null}function r(e,n){var i=this;u=n,i.bind("TransportingProgress",function(e){d=e.loaded,c>d&&-1===t.inArray(i.state,[o.IDLE,o.DONE])&&s.call(i)},999),i.bind("TransportingComplete",function(){d=c,i.state=o.DONE,l=null,i.result=u.exec.call(i,"Transporter","getAsBlob",e||"")},999),i.state=o.BUSY,i.trigger("TransportingStarted"),s.call(i)}function s(){var t,n=this,i=c-d;h>i&&(h=i),t=e.btoa(l.substr(d,h)),u.exec.call(n,"Transporter","receive",t,c)}var a,u,l,c,d,h;n.call(this),t.extend(this,{uid:t.guid("uid_"),state:o.IDLE,result:null,transport:function(e,n,o){var s=this;if(o=t.extend({chunk_size:204798},o),(a=o.chunk_size%3)&&(o.chunk_size+=3-a),h=o.chunk_size,i.call(this),l=e,c=e.length,"string"===t.typeOf(o)||o.ruid)r.call(s,n,this.connectRuntime(o));else{var u=function(t,e){s.unbind("RuntimeInit",u),r.call(s,n,e)};this.bind("RuntimeInit",u),this.connectRuntime(o)}},abort:function(){var t=this;t.state=o.IDLE,u&&(u.exec.call(t,"Transporter","clear"),t.trigger("TransportingAborted")),i.call(t)},destroy:function(){this.unbindAll(),u=null,this.disconnectRuntime(),i.call(this)}})}return o.IDLE=0,o.BUSY=1,o.DONE=2,o.prototype=i.instance,o}),i(T,[a,d,h,S,E,m,g,P,c,p,b,_,f],function(t,e,n,i,o,r,s,a,u,l,c,d,h){function p(){function i(t){t||(t=this.getRuntime().exec.call(this,"Image","getInfo")),this.size=t.size,this.width=t.width,this.height=t.height,this.type=t.type,this.meta=t.meta,""===this.name&&(this.name=t.name)}function l(e){var i=t.typeOf(e);try{if(e instanceof p){if(!e.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);m.apply(this,arguments)}else if(e instanceof c){if(!~t.inArray(e.type,["image/jpeg","image/png"]))throw new n.ImageError(n.ImageError.WRONG_FORMAT);g.apply(this,arguments)}else if(-1!==t.inArray(i,["blob","file"]))l.call(this,new d(null,e),arguments[1]);else if("string"===i)/^data:[^;]*;base64,/.test(e)?l.call(this,new c(null,{data:e}),arguments[1]):b.apply(this,arguments);else{
if("node"!==i||"img"!==e.nodeName.toLowerCase())throw new n.DOMException(n.DOMException.TYPE_MISMATCH_ERR);l.call(this,e.src,arguments[1])}}catch(o){this.trigger("error",o.code)}}function m(e,n){var i=this.connectRuntime(e.ruid);this.ruid=i.uid,i.exec.call(this,"Image","loadFromImage",e,"undefined"===t.typeOf(n)?!0:n)}function g(e,n){function i(t){o.ruid=t.uid,t.exec.call(o,"Image","loadFromBlob",e)}var o=this;o.name=e.name||"",e.isDetached()?(this.bind("RuntimeInit",function(t,e){i(e)}),n&&"string"==typeof n.required_caps&&(n.required_caps=r.parseCaps(n.required_caps)),this.connectRuntime(t.extend({required_caps:{access_image_binary:!0,resize_image:!0}},n))):i(this.connectRuntime(e.ruid))}function b(t,e){var n,i=this;n=new o,n.open("get",t),n.responseType="blob",n.onprogress=function(t){i.trigger(t)},n.onload=function(){g.call(i,n.response,!0)},n.onerror=function(t){i.trigger(t)},n.onloadend=function(){n.destroy()},n.bind("RuntimeError",function(t,e){i.trigger("RuntimeError",e)}),n.send(null,e)}s.call(this),t.extend(this,{uid:t.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){i.call(this)},999),this.convertEventPropsToHandlers(f),l.apply(this,arguments)},downsize:function(e){var i={width:this.width,height:this.height,crop:!1,preserveHeaders:!0};e="object"==typeof e?t.extend(i,e):t.extend(i,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]});try{if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>p.MAX_RESIZE_WIDTH||this.height>p.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);this.getRuntime().exec.call(this,"Image","downsize",e.width,e.height,e.crop,e.preserveHeaders)}catch(o){this.trigger("error",o.code)}},crop:function(t,e,n){this.downsize(t,e,!0,n)},getAsCanvas:function(){if(!u.can("create_canvas"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);var t=this.connectRuntime(this.ruid);return t.exec.call(this,"Image","getAsCanvas")},getAsBlob:function(t,e){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return t||(t="image/jpeg"),"image/jpeg"!==t||e||(e=90),this.getRuntime().exec.call(this,"Image","getAsBlob",t,e)},getAsDataURL:function(t,e){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",t,e)},getAsBinaryString:function(t,e){var n=this.getAsDataURL(t,e);return h.atob(n.substring(n.indexOf("base64,")+7))},embed:function(i){function o(){if(u.can("create_canvas")){var e=r.getAsCanvas();if(e)return i.appendChild(e),e=null,r.destroy(),void f.trigger("embedded")}var o=r.getAsDataURL(s,l);if(!o)throw new n.ImageError(n.ImageError.WRONG_FORMAT);if(u.can("use_data_uri_of",o.length))i.innerHTML='<img src="'+o+'" width="'+r.width+'" height="'+r.height+'" />',r.destroy(),f.trigger("embedded");else{var c=new a;c.bind("TransportingComplete",function(){d=f.connectRuntime(this.result.ruid),f.bind("Embedded",function(){t.extend(d.getShimContainer().style,{top:"0px",left:"0px",width:r.width+"px",height:r.height+"px"}),d=null},999),d.exec.call(f,"ImageView","display",this.result.uid,g,b),r.destroy()}),c.transport(h.atob(o.substring(o.indexOf("base64,")+7)),s,t.extend({},m,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:i}))}}var r,s,l,c,d,f=this,m=arguments[1]||{},g=this.width,b=this.height;try{if(!(i=e.get(i)))throw new n.DOMException(n.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>p.MAX_RESIZE_WIDTH||this.height>p.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);if(s=m.type||this.type||"image/jpeg",l=m.quality||90,c="undefined"!==t.typeOf(m.crop)?m.crop:!1,m.width)g=m.width,b=m.height||g;else{var _=e.getSize(i);_.w&&_.h&&(g=_.w,b=_.h)}return r=new p,r.bind("Resize",function(){o.call(f)}),r.bind("Load",function(){r.downsize(g,b,c,!1)}),r.clone(this,!1),r}catch(y){this.trigger("error",y.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll()}})}var f=["progress","load","error","resize","embedded"];return p.MAX_RESIZE_WIDTH=6500,p.MAX_RESIZE_HEIGHT=6500,p.prototype=l.instance,p}),i(I,[a,h,m,c],function(t,e,n,i){function o(e){var o=this,a=n.capTest,u=n.capTrue,l=t.extend({access_binary:a(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return o.can("access_binary")&&!!s.Image},display_media:a(i.can("create_canvas")||i.can("use_data_uri_over32kb")),do_cors:a(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:a(function(){var t=document.createElement("div");return("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&("IE"!==i.browser||i.version>9)}()),filter_by_extension:a(function(){return"Chrome"===i.browser&&i.version>=28||"IE"===i.browser&&i.version>=10}()),return_response_headers:u,return_response_type:function(t){return"json"===t&&window.JSON?!0:i.can("return_response_type",t)},return_status_code:u,report_upload_progress:a(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return o.can("access_binary")&&i.can("create_canvas")},select_file:function(){return i.can("use_fileinput")&&window.File},select_folder:function(){return o.can("select_file")&&"Chrome"===i.browser&&i.version>=21},select_multiple:function(){return!(!o.can("select_file")||"Safari"===i.browser&&"Windows"===i.os||"iOS"===i.os&&i.verComp(i.osVersion,"7.0.4","<"))},send_binary_string:a(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:a(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||o.can("send_binary_string")},slice_blob:a(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return o.can("slice_blob")&&o.can("send_multipart")},summon_file_dialog:a(function(){return"Firefox"===i.browser&&i.version>=4||"Opera"===i.browser&&i.version>=12||"IE"===i.browser&&i.version>=10||!!~t.inArray(i.browser,["Chrome","Safari"])}()),upload_filesize:u},arguments[2]);n.call(this,e,arguments[1]||r,l),t.extend(this,{init:function(){this.trigger("Init")},destroy:function(t){return function(){t.call(o),t=o=null}}(this.destroy)}),t.extend(this.getShim(),s)}var r="html5",s={};return n.addConstructor(r,o),s}),i(A,[I,b],function(t,e){function n(){function t(t,e,n){var i;if(!window.File.prototype.slice)return(i=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?i.call(t,e,n):null;try{return t.slice(),t.slice(e,n)}catch(o){return t.slice(e,n-e)}}this.slice=function(){return new e(this.getRuntime().uid,t.apply(this,arguments))}}return t.Blob=n}),i(B,[a],function(t){function e(){this.returnValue=!1}function n(){this.cancelBubble=!0}var i={},o="moxie_"+t.guid(),r=function(r,s,a,u){var l,c;s=s.toLowerCase(),r.addEventListener?(l=a,r.addEventListener(s,l,!1)):r.attachEvent&&(l=function(){var t=window.event;t.target||(t.target=t.srcElement),t.preventDefault=e,t.stopPropagation=n,a(t)},r.attachEvent("on"+s,l)),r[o]||(r[o]=t.guid()),i.hasOwnProperty(r[o])||(i[r[o]]={}),c=i[r[o]],c.hasOwnProperty(s)||(c[s]=[]),c[s].push({func:l,orig:a,key:u})},s=function(e,n,r){var s,a;if(n=n.toLowerCase(),e[o]&&i[e[o]]&&i[e[o]][n]){s=i[e[o]][n];for(var u=s.length-1;u>=0&&(s[u].orig!==r&&s[u].key!==r||(e.removeEventListener?e.removeEventListener(n,s[u].func,!1):e.detachEvent&&e.detachEvent("on"+n,s[u].func),s[u].orig=null,s[u].func=null,s.splice(u,1),r===a));u--);if(s.length||delete i[e[o]][n],t.isEmptyObj(i[e[o]])){delete i[e[o]];try{delete e[o]}catch(l){e[o]=a}}}},a=function(e,n){e&&e[o]&&t.each(i[e[o]],function(t,i){s(e,i,n)})};return{addEvent:r,removeEvent:s,removeAllEvents:a}}),i(O,[I,a,d,B,l,c],function(t,e,n,i,o,r){function s(){var t,s=[];e.extend(this,{init:function(a){var u,l,c,d,h,p,f=this,m=f.getRuntime();t=a,s=[],c=t.accept.mimes||o.extList2mimes(t.accept,m.can("filter_by_extension")),l=m.getShimContainer(),l.innerHTML='<input id="'+m.uid+'" type="file" style="font-size:999px;opacity:0;"'+(t.multiple&&m.can("select_multiple")?"multiple":"")+(t.directory&&m.can("select_folder")?"webkitdirectory directory":"")+(c?' accept="'+c.join(",")+'"':"")+" />",u=n.get(m.uid),e.extend(u.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),d=n.get(t.browse_button),m.can("summon_file_dialog")&&("static"===n.getStyle(d,"position")&&(d.style.position="relative"),h=parseInt(n.getStyle(d,"z-index"),10)||1,d.style.zIndex=h,l.style.zIndex=h-1,i.addEvent(d,"click",function(t){var e=n.get(m.uid);e&&!e.disabled&&e.click(),t.preventDefault()},f.uid)),p=m.can("summon_file_dialog")?d:l,i.addEvent(p,"mouseover",function(){f.trigger("mouseenter")},f.uid),i.addEvent(p,"mouseout",function(){f.trigger("mouseleave")},f.uid),i.addEvent(p,"mousedown",function(){f.trigger("mousedown")},f.uid),i.addEvent(n.get(t.container),"mouseup",function(){f.trigger("mouseup")},f.uid),u.onchange=function g(){if(s=[],t.directory?e.each(this.files,function(t){"."!==t.name&&s.push(t)}):s=[].slice.call(this.files),"IE"!==r.browser&&"IEMobile"!==r.browser)this.value="";else{var n=this.cloneNode(!0);this.parentNode.replaceChild(n,this),n.onchange=g}f.trigger("change")},f.trigger({type:"ready",async:!0}),l=null},getFiles:function(){return s},disable:function(t){var e,i=this.getRuntime();(e=n.get(i.uid))&&(e.disabled=!!t)},destroy:function(){var e=this.getRuntime(),o=e.getShim(),r=e.getShimContainer();i.removeAllEvents(r,this.uid),i.removeAllEvents(t&&n.get(t.container),this.uid),i.removeAllEvents(t&&n.get(t.browse_button),this.uid),r&&(r.innerHTML=""),o.removeInstance(this.uid),s=t=r=o=null}})}return t.FileInput=s}),i(M,[I,a,d,B,l],function(t,e,n,i,o){function r(){function t(t){if(!t.dataTransfer||!t.dataTransfer.types)return!1;var n=e.toArray(t.dataTransfer.types||[]);return-1!==e.inArray("Files",n)||-1!==e.inArray("public.file-url",n)||-1!==e.inArray("application/x-moz-file",n)}function r(t){for(var n=[],i=0;i<t.length;i++)[].push.apply(n,t[i].extensions.split(/\s*,\s*/));return-1===e.inArray("*",n)?n:[]}function s(t){if(!p.length)return!0;var n=o.getFileExtension(t.name);return!n||-1!==e.inArray(n,p)}function a(t,n){var i=[];e.each(t,function(t){var e=t.webkitGetAsEntry();if(e)if(e.isFile){var n=t.getAsFile();s(n)&&h.push(n)}else i.push(e)}),i.length?u(i,n):n()}function u(t,n){var i=[];e.each(t,function(t){i.push(function(e){l(t,e)})}),e.inSeries(i,function(){n()})}function l(t,e){t.isFile?t.file(function(t){s(t)&&h.push(t),e()},function(){e()}):t.isDirectory?c(t,e):e()}function c(t,e){function n(t){o.readEntries(function(e){e.length?([].push.apply(i,e),n(t)):t()},t)}var i=[],o=t.createReader();n(function(){u(i,e)})}var d,h=[],p=[];e.extend(this,{init:function(n){var o,u=this;d=n,p=r(d.accept),o=d.container,i.addEvent(o,"dragover",function(e){t(e)&&(e.preventDefault(),e.dataTransfer.dropEffect="copy")},u.uid),i.addEvent(o,"drop",function(n){t(n)&&(n.preventDefault(),h=[],n.dataTransfer.items&&n.dataTransfer.items[0].webkitGetAsEntry?a(n.dataTransfer.items,function(){u.trigger("drop")}):(e.each(n.dataTransfer.files,function(t){s(t)&&h.push(t)}),u.trigger("drop")))},u.uid),i.addEvent(o,"dragenter",function(t){u.trigger("dragenter")},u.uid),i.addEvent(o,"dragleave",function(t){u.trigger("dragleave")},u.uid)},getFiles:function(){return h},destroy:function(){i.removeAllEvents(d&&n.get(d.container),this.uid),h=p=d=null}})}return t.FileDrop=r}),i($,[I,f,a],function(t,e,n){function i(){function t(t){return e.atob(t.substring(t.indexOf("base64,")+7))}var i,o=!1;n.extend(this,{read:function(t,e){var r=this;i=new window.FileReader,i.addEventListener("progress",function(t){r.trigger(t)}),i.addEventListener("load",function(t){r.trigger(t)}),i.addEventListener("error",function(t){r.trigger(t,i.error)}),i.addEventListener("loadend",function(){i=null}),"function"===n.typeOf(i[t])?(o=!1,i[t](e.getSource())):"readAsBinaryString"===t&&(o=!0,i.readAsDataURL(e.getSource()))},getResult:function(){return i&&i.result?o?t(i.result):i.result:null},abort:function(){i&&i.abort()},destroy:function(){i=null}})}return t.FileReader=i}),i(D,[I,a,l,C,_,b,x,h,c],function(t,e,n,i,o,r,s,a,u){function l(){function t(t,e){var n,i,o=this;n=e.getBlob().getSource(),i=new window.FileReader,i.onload=function(){e.append(e.getBlobName(),new r(null,{type:n.type,data:i.result})),f.send.call(o,t,e)},i.readAsBinaryString(n)}function l(){return!window.XMLHttpRequest||"IE"===u.browser&&u.version<8?function(){for(var t=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],e=0;e<t.length;e++)try{return new ActiveXObject(t[e])}catch(n){}}():new window.XMLHttpRequest}function c(t){var e=t.responseXML,n=t.responseText;return"IE"===u.browser&&n&&e&&!e.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(t.getResponseHeader("Content-Type"))&&(e=new window.ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.validateOnParse=!1,e.loadXML(n)),e&&("IE"===u.browser&&0!==e.parseError||!e.documentElement||"parsererror"===e.documentElement.tagName)?null:e}function d(t){var e="----moxieboundary"+(new Date).getTime(),n="--",i="\r\n",o="",s=this.getRuntime();if(!s.can("send_binary_string"))throw new a.RuntimeError(a.RuntimeError.NOT_SUPPORTED_ERR);return h.setRequestHeader("Content-Type","multipart/form-data; boundary="+e),t.each(function(t,s){o+=t instanceof r?n+e+i+'Content-Disposition: form-data; name="'+s+'"; filename="'+unescape(encodeURIComponent(t.name||"blob"))+'"'+i+"Content-Type: "+(t.type||"application/octet-stream")+i+i+t.getSource()+i:n+e+i+'Content-Disposition: form-data; name="'+s+'"'+i+i+unescape(encodeURIComponent(t))+i}),o+=n+e+n+i}var h,p,f=this;e.extend(this,{send:function(n,o){var a=this,c="Mozilla"===u.browser&&u.version>=4&&u.version<7,f="Android Browser"===u.browser,m=!1;if(p=n.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),h=l(),h.open(n.method,n.url,n.async,n.user,n.password),o instanceof r)o.isDetached()&&(m=!0),o=o.getSource();else if(o instanceof s){if(o.hasBlob())if(o.getBlob().isDetached())o=d.call(a,o),m=!0;else if((c||f)&&"blob"===e.typeOf(o.getBlob().getSource())&&window.FileReader)return void t.call(a,n,o);if(o instanceof s){var g=new window.FormData;o.each(function(t,e){t instanceof r?g.append(e,t.getSource()):g.append(e,t)}),o=g}}h.upload?(n.withCredentials&&(h.withCredentials=!0),h.addEventListener("load",function(t){a.trigger(t)}),h.addEventListener("error",function(t){a.trigger(t)}),h.addEventListener("progress",function(t){a.trigger(t)}),h.upload.addEventListener("progress",function(t){a.trigger({type:"UploadProgress",loaded:t.loaded,total:t.total})})):h.onreadystatechange=function(){switch(h.readyState){case 1:break;case 2:break;case 3:var t,e;try{i.hasSameOrigin(n.url)&&(t=h.getResponseHeader("Content-Length")||0),h.responseText&&(e=h.responseText.length)}catch(o){t=e=0}a.trigger({type:"progress",lengthComputable:!!t,total:parseInt(t,10),loaded:e});break;case 4:h.onreadystatechange=function(){},a.trigger(0===h.status?"error":"load")}},e.isEmptyObj(n.headers)||e.each(n.headers,function(t,e){h.setRequestHeader(e,t)}),""!==n.responseType&&"responseType"in h&&(h.responseType="json"!==n.responseType||u.can("return_response_type","json")?n.responseType:"text"),m?h.sendAsBinary?h.sendAsBinary(o):!function(){for(var t=new Uint8Array(o.length),e=0;e<o.length;e++)t[e]=255&o.charCodeAt(e);h.send(t.buffer)}():h.send(o),a.trigger("loadstart")},getStatus:function(){try{if(h)return h.status}catch(t){}return 0},getResponse:function(t){var e=this.getRuntime();try{switch(t){case"blob":var i=new o(e.uid,h.response),r=h.getResponseHeader("Content-Disposition");if(r){var s=r.match(/filename=([\'\"'])([^\1]+)\1/);s&&(p=s[2])}return i.name=p,i.type||(i.type=n.getFileMime(p)),i;case"json":return u.can("return_response_type","json")?h.response:200===h.status&&window.JSON?JSON.parse(h.responseText):null;case"document":return c(h);default:return""!==h.responseText?h.responseText:null}}catch(a){return null}},getAllResponseHeaders:function(){try{return h.getAllResponseHeaders()}catch(t){}return""},abort:function(){h&&h.abort()},destroy:function(){f=p=null}})}return t.XMLHttpRequest=l}),i(R,[],function(){return function(){function t(t,e){var n,i=r?0:-8*(e-1),s=0;for(n=0;e>n;n++)s|=o.charCodeAt(t+n)<<Math.abs(i+8*n);return s}function n(t,e,n){n=3===arguments.length?n:o.length-e-1,o=o.substr(0,e)+t+o.substr(n+e)}function i(t,e,i){var o,s="",a=r?0:-8*(i-1);for(o=0;i>o;o++)s+=String.fromCharCode(e>>Math.abs(a+8*o)&255);n(s,t,i)}var o,r=!1;return{II:function(t){return t===e?r:void(r=t)},init:function(t){r=!1,o=t},SEGMENT:function(t,e,i){switch(arguments.length){case 1:return o.substr(t,o.length-t-1);case 2:return o.substr(t,e);case 3:n(i,t,e);break;default:return o}},BYTE:function(e){return t(e,1)},SHORT:function(e){return t(e,2)},LONG:function(n,o){return o===e?t(n,4):void i(n,o,4)},SLONG:function(e){var n=t(e,4);return n>2147483647?n-4294967296:n},STRING:function(e,n){var i="";for(n+=e;n>e;e++)i+=String.fromCharCode(t(e,1));return i}}}}),i(L,[R],function(t){return function e(n){var i,o,r,s=[],a=0;if(i=new t,i.init(n),65496===i.SHORT(0)){for(o=2;o<=n.length;)if(r=i.SHORT(o),r>=65488&&65495>=r)o+=2;else{if(65498===r||65497===r)break;a=i.SHORT(o+2)+2,r>=65505&&65519>=r&&s.push({hex:r,name:"APP"+(15&r),start:o,length:a,segment:i.SEGMENT(o,a)}),o+=a}return i.init(null),{headers:s,restore:function(t){var e,n;for(i.init(t),o=65504==i.SHORT(2)?4+i.SHORT(4):2,n=0,e=s.length;e>n;n++)i.SEGMENT(o,0,s[n].segment),o+=s[n].length;return t=i.SEGMENT(),i.init(null),t},strip:function(t){var n,o,r;for(o=new e(t),n=o.headers,o.purge(),i.init(t),r=n.length;r--;)i.SEGMENT(n[r].start,n[r].length,"");return t=i.SEGMENT(),i.init(null),t},get:function(t){for(var e=[],n=0,i=s.length;i>n;n++)s[n].name===t.toUpperCase()&&e.push(s[n].segment);return e},set:function(t,e){var n,i,o,r=[];for("string"==typeof e?r.push(e):r=e,n=i=0,o=s.length;o>n&&(s[n].name===t.toUpperCase()&&(s[n].segment=r[i],s[n].length=r[i].length,i++),!(i>=r.length));n++);},purge:function(){s=[],i.init(null),i=null}}}}}),i(F,[a,R],function(t,n){return function i(){function i(t,n){var i,o,r,a,u,d,h,p,f=s.SHORT(t),m=[],g={};for(i=0;f>i;i++)if(h=d=t+12*i+2,r=n[s.SHORT(h)],r!==e){switch(a=s.SHORT(h+=2),u=s.LONG(h+=2),h+=4,m=[],a){case 1:case 7:for(u>4&&(h=s.LONG(h)+c.tiffHeader),o=0;u>o;o++)m[o]=s.BYTE(h+o);break;case 2:u>4&&(h=s.LONG(h)+c.tiffHeader),g[r]=s.STRING(h,u-1);continue;case 3:for(u>2&&(h=s.LONG(h)+c.tiffHeader),o=0;u>o;o++)m[o]=s.SHORT(h+2*o);break;case 4:for(u>1&&(h=s.LONG(h)+c.tiffHeader),o=0;u>o;o++)m[o]=s.LONG(h+4*o);break;case 5:for(h=s.LONG(h)+c.tiffHeader,o=0;u>o;o++)m[o]=s.LONG(h+4*o)/s.LONG(h+4*o+4);break;case 9:for(h=s.LONG(h)+c.tiffHeader,o=0;u>o;o++)m[o]=s.SLONG(h+4*o);break;case 10:for(h=s.LONG(h)+c.tiffHeader,o=0;u>o;o++)m[o]=s.SLONG(h+4*o)/s.SLONG(h+4*o+4);break;default:continue}p=1==u?m[0]:m,g[r]=l.hasOwnProperty(r)&&"object"!=typeof p?l[r][p]:p}return g}function o(){var t=c.tiffHeader;return s.II(18761==s.SHORT(t)),42!==s.SHORT(t+=2)?!1:(c.IFD0=c.tiffHeader+s.LONG(t+=2),u=i(c.IFD0,a.tiff),"ExifIFDPointer"in u&&(c.exifIFD=c.tiffHeader+u.ExifIFDPointer,delete u.ExifIFDPointer),"GPSInfoIFDPointer"in u&&(c.gpsIFD=c.tiffHeader+u.GPSInfoIFDPointer,delete u.GPSInfoIFDPointer),!0)}function r(t,e,n){var i,o,r,u=0;if("string"==typeof e){var l=a[t.toLowerCase()];for(var d in l)if(l[d]===e){e=d;break}}i=c[t.toLowerCase()+"IFD"],o=s.SHORT(i);for(var h=0;o>h;h++)if(r=i+12*h+2,s.SHORT(r)==e){u=r+8;break}return u?(s.LONG(u,n),!0):!1}var s,a,u,l,c={};return s=new n,a={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},l={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(t){return c={tiffHeader:10},t!==e&&t.length?(s.init(t),65505===s.SHORT(0)&&"EXIF\x00"===s.STRING(4,5).toUpperCase()?o():!1):!1},TIFF:function(){return u},EXIF:function(){var e;if(e=i(c.exifIFD,a.exif),e.ExifVersion&&"array"===t.typeOf(e.ExifVersion)){for(var n=0,o="";n<e.ExifVersion.length;n++)o+=String.fromCharCode(e.ExifVersion[n]);e.ExifVersion=o}return e},GPS:function(){var e;return e=i(c.gpsIFD,a.gps),e.GPSVersionID&&"array"===t.typeOf(e.GPSVersionID)&&(e.GPSVersionID=e.GPSVersionID.join(".")),e},setExif:function(t,e){return"PixelXDimension"!==t&&"PixelYDimension"!==t?!1:r("exif",t,e)},getBinary:function(){return s.SEGMENT()},purge:function(){s.init(null),s=u=null,c={}}}}}),i(N,[a,h,L,R,F],function(t,e,n,i,o){function r(r){function s(){for(var t,e,n=0;n<=u.length;){if(t=l.SHORT(n+=2),t>=65472&&65475>=t)return n+=5,{height:l.SHORT(n),width:l.SHORT(n+=2)};e=l.SHORT(n+=2),n+=e-2}return null}function a(){d&&c&&l&&(d.purge(),c.purge(),l.init(null),u=h=c=d=l=null)}var u,l,c,d,h,p;if(u=r,l=new i,l.init(u),65496!==l.SHORT(0))throw new e.ImageError(e.ImageError.WRONG_FORMAT);c=new n(r),d=new o,p=!!d.init(c.get("app1")[0]),h=s.call(this),t.extend(this,{type:"image/jpeg",size:u.length,width:h&&h.width||0,height:h&&h.height||0,setExif:function(e,n){return p?("object"===t.typeOf(e)?t.each(e,function(t,e){d.setExif(e,t)}):d.setExif(e,n),void c.set("app1",d.getBinary())):!1},writeHeaders:function(){return arguments.length?c.restore(arguments[0]):u=c.restore(u)},stripHeaders:function(t){return c.strip(t)},purge:function(){a.call(this)}}),p&&(this.meta={tiff:d.TIFF(),exif:d.EXIF(),gps:d.GPS()})}return r}),i(j,[h,a,R],function(t,e,n){function i(i){function o(){var t,e;return t=s.call(this,8),"IHDR"==t.type?(e=t.start,{width:u.LONG(e),height:u.LONG(e+=4)}):null}function r(){u&&(u.init(null),a=d=l=c=u=null)}function s(t){var e,n,i,o;return e=u.LONG(t),n=u.STRING(t+=4,4),i=t+=4,o=u.LONG(t+e),{length:e,type:n,start:i,CRC:o}}var a,u,l,c,d;a=i,u=new n,u.init(a),function(){var e=0,n=0,i=[35152,20039,3338,6666];for(n=0;n<i.length;n++,e+=2)if(i[n]!=u.SHORT(e))throw new t.ImageError(t.ImageError.WRONG_FORMAT)}(),d=o.call(this),e.extend(this,{type:"image/png",size:a.length,width:d.width,height:d.height,purge:function(){r.call(this)}}),r.call(this)}return i}),i(U,[a,h,N,j],function(t,e,n,i){return function(o){var r,s=[n,i];r=function(){for(var t=0;t<s.length;t++)try{return new s[t](o)}catch(n){}throw new e.ImageError(e.ImageError.WRONG_FORMAT)}(),t.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(t){return t},stripHeaders:function(t){return t},purge:function(){}}),t.extend(this,r),this.purge=function(){r.purge(),r=null}}}),i(V,[],function(){function t(t,i,o){var r=t.naturalWidth,s=t.naturalHeight,a=o.width,u=o.height,l=o.x||0,c=o.y||0,d=i.getContext("2d");e(t)&&(r/=2,s/=2);var h=1024,p=document.createElement("canvas");p.width=p.height=h;for(var f=p.getContext("2d"),m=n(t,r,s),g=0;s>g;){for(var b=g+h>s?s-g:h,_=0;r>_;){var y=_+h>r?r-_:h;f.clearRect(0,0,h,h),f.drawImage(t,-_,-g);var v=_*a/r+l<<0,w=Math.ceil(y*a/r),k=g*u/s/m+c<<0,C=Math.ceil(b*u/s/m);d.drawImage(p,0,0,y,b,v,k,w,C),_+=h}g+=h}p=f=null}function e(t){var e=t.naturalWidth,n=t.naturalHeight;if(e*n>1048576){var i=document.createElement("canvas");i.width=i.height=1;var o=i.getContext("2d");return o.drawImage(t,-e+1,0),0===o.getImageData(0,0,1,1).data[3]}return!1}function n(t,e,n){var i=document.createElement("canvas");i.width=1,i.height=n;var o=i.getContext("2d");o.drawImage(t,0,0);for(var r=o.getImageData(0,0,1,n).data,s=0,a=n,u=n;u>s;){var l=r[4*(u-1)+3];0===l?a=u:s=u,u=a+s>>1}i=null;var c=u/n;return 0===c?1:c}return{isSubsampled:e,renderTo:t}}),i(H,[I,a,h,f,_,U,V,l,c],function(t,e,n,i,o,r,s,a,u){function l(){function t(){if(!y&&!b)throw new n.ImageError(n.DOMException.INVALID_STATE_ERR);return y||b}function l(t){return i.atob(t.substring(t.indexOf("base64,")+7))}function c(t,e){return"data:"+(e||"")+";base64,"+i.btoa(t)}function d(t){var e=this;b=new Image,b.onerror=function(){g.call(this),e.trigger("error",n.ImageError.WRONG_FORMAT)},b.onload=function(){e.trigger("load")},b.src=/^data:[^;]*;base64,/.test(t)?t:c(t,w.type)}function h(t,e){var i,o=this;return window.FileReader?(i=new FileReader,i.onload=function(){e(this.result)},i.onerror=function(){o.trigger("error",n.ImageError.WRONG_FORMAT)},void i.readAsDataURL(t)):e(t.getAsDataURL())}function p(n,i,o,r){var s,a,u,l,c,d=this,h=0,p=0;if(S=r,c=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==e.inArray(c,[5,6,7,8])){var g=n;n=i,i=g}return a=t(),o?(n=Math.min(n,a.width),i=Math.min(i,a.height),s=Math.max(n/a.width,i/a.height)):s=Math.min(n/a.width,i/a.height),s>1&&!o&&r?void this.trigger("Resize"):(y||(y=document.createElement("canvas")),u=Math.round(a.width*s),l=Math.round(a.height*s),o?(y.width=n,y.height=i,u>n&&(h=Math.round((u-n)/2)),l>i&&(p=Math.round((l-i)/2))):(y.width=u,y.height=l),S||m(y.width,y.height,c),f.call(this,a,y,-h,-p,u,l),this.width=y.width,this.height=y.height,C=!0,void d.trigger("Resize"))}function f(t,e,n,i,o,r){if("iOS"===u.OS)s.renderTo(t,e,{width:o,height:r,x:n,y:i});else{var a=e.getContext("2d");a.drawImage(t,n,i,o,r)}}function m(t,e,n){switch(n){case 5:case 6:case 7:case 8:y.width=e,y.height=t;break;default:y.width=t,y.height=e}var i=y.getContext("2d");switch(n){case 2:i.translate(t,0),i.scale(-1,1);break;case 3:i.translate(t,e),i.rotate(Math.PI);break;case 4:i.translate(0,e),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-e);break;case 7:i.rotate(.5*Math.PI),i.translate(t,-e),i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI),i.translate(-t,0)}}function g(){_&&(_.purge(),_=null),v=b=y=w=null,C=!1}var b,_,y,v,w,k=this,C=!1,S=!0;e.extend(this,{loadFromBlob:function(t){var e=this,i=e.getRuntime(),o=arguments.length>1?arguments[1]:!0;if(!i.can("access_binary"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);return w=t,t.isDetached()?(v=t.getSource(),void d.call(this,v)):void h.call(this,t.getSource(),function(t){o&&(v=l(t)),d.call(e,t)})},loadFromImage:function(t,e){this.meta=t.meta,w=new o(null,{name:t.name,size:t.size,type:t.type}),d.call(this,e?v=t.getAsBinaryString():t.getAsDataURL())},getInfo:function(){var e,n=this.getRuntime();return!_&&v&&n.can("access_image_binary")&&(_=new r(v)),e={width:t().width||0,height:t().height||0,type:w.type||a.getFileMime(w.name),size:v&&v.length||w.size||0,name:w.name||"",meta:_&&_.meta||this.meta||{}}},downsize:function(){p.apply(this,arguments)},getAsCanvas:function(){return y&&(y.id=this.uid+"_canvas"),y},getAsBlob:function(t,e){return t!==this.type&&p.call(this,this.width,this.height,!1),new o(null,{name:w.name||"",type:t,data:k.getAsBinaryString.call(this,t,e)})},getAsDataURL:function(t){var e=arguments[1]||90;if(!C)return b.src;if("image/jpeg"!==t)return y.toDataURL("image/png");try{return y.toDataURL("image/jpeg",e/100)}catch(n){return y.toDataURL("image/jpeg")}},getAsBinaryString:function(t,e){if(!C)return v||(v=l(k.getAsDataURL(t,e))),v;if("image/jpeg"!==t)v=l(k.getAsDataURL(t,e));else{var n;e||(e=90);try{n=y.toDataURL("image/jpeg",e/100)}catch(i){n=y.toDataURL("image/jpeg")}v=l(n),_&&(v=_.stripHeaders(v),S&&(_.meta&&_.meta.exif&&_.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),v=_.writeHeaders(v)),_.purge(),_=null)}return C=!1,v},destroy:function(){k=null,g.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}return t.Image=l}),i(z,[a,c,d,h,m],function(t,e,n,i,o){function r(){var t;try{t=navigator.plugins["Shockwave Flash"],t=t.description}catch(e){try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(n){t="0.0"}}return t=t.match(/\d+/g),parseFloat(t[0]+"."+t[1])}function s(s){var l,c=this;s=t.extend({swf_url:e.swf_url},s),o.call(this,s,a,{access_binary:function(t){return t&&"browser"===c.mode},access_image_binary:function(t){return t&&"browser"===c.mode},display_media:o.capTrue,do_cors:o.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===c.mode},resize_image:o.capTrue,return_response_headers:!1,return_response_type:function(e){return"json"===e&&window.JSON?!0:!t.arrayDiff(e,["","text","document"])||"browser"===c.mode},return_status_code:function(e){return"browser"===c.mode||!t.arrayDiff(e,[200,404])},select_file:o.capTrue,select_multiple:o.capTrue,send_binary_string:function(t){return t&&"browser"===c.mode},send_browser_cookies:function(t){return t&&"browser"===c.mode},send_custom_headers:function(t){return t&&"browser"===c.mode},send_multipart:o.capTrue,slice_blob:function(t){return t&&"browser"===c.mode},stream_upload:function(t){return t&&"browser"===c.mode},summon_file_dialog:!1,upload_filesize:function(e){return t.parseSizeStr(e)<=2097152||"client"===c.mode},use_http_method:function(e){return!t.arrayDiff(e,["GET","POST"])}},{access_binary:function(t){return t?"browser":"client"},access_image_binary:function(t){return t?"browser":"client"},report_upload_progress:function(t){return t?"browser":"client"},return_response_type:function(e){return t.arrayDiff(e,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(e){return t.arrayDiff(e,[200,404])?"browser":["client","browser"]},send_binary_string:function(t){return t?"browser":"client"},send_browser_cookies:function(t){return t?"browser":"client";
},send_custom_headers:function(t){return t?"browser":"client"},stream_upload:function(t){return t?"client":"browser"},upload_filesize:function(e){return t.parseSizeStr(e)>=2097152?"client":"browser"}},"client"),r()<10&&(this.mode=!1),t.extend(this,{getShim:function(){return n.get(this.uid)},shimExec:function(t,e){var n=[].slice.call(arguments,2);return c.getShim().exec(this.uid,t,e,n)},init:function(){var n,o,r;r=this.getShimContainer(),t.extend(r.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),n='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+s.swf_url+'" ',"IE"===e.browser&&(n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),n+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+s.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+e.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',"IE"===e.browser?(o=document.createElement("div"),r.appendChild(o),o.outerHTML=n,o=r=null):r.innerHTML=n,l=setTimeout(function(){c&&!c.initialized&&c.trigger("Error",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:function(t){return function(){t.call(c),clearTimeout(l),s=l=t=c=null}}(this.destroy)},u)}var a="flash",u={};return o.addConstructor(a,s),u}),i(q,[z,b],function(t,e){var n={slice:function(t,n,i,o){var r=this.getRuntime();return 0>n?n=Math.max(t.size+n,0):n>0&&(n=Math.min(n,t.size)),0>i?i=Math.max(t.size+i,0):i>0&&(i=Math.min(i,t.size)),t=r.shimExec.call(this,"Blob","slice",n,i,o||""),t&&(t=new e(r.uid,t)),t}};return t.Blob=n}),i(W,[z],function(t){var e={init:function(t){this.getRuntime().shimExec.call(this,"FileInput","init",{name:t.name,accept:t.accept,multiple:t.multiple}),this.trigger("ready")}};return t.FileInput=e}),i(Q,[z,f],function(t,e){function n(t,n){switch(n){case"readAsText":return e.atob(t,"utf8");case"readAsBinaryString":return e.atob(t);case"readAsDataURL":return t}return null}var i="",o={read:function(t,e){var o=this,r=o.getRuntime();return"readAsDataURL"===t&&(i="data:"+(e.type||"")+";base64,"),o.bind("Progress",function(e,o){o&&(i+=n(o,t))}),r.shimExec.call(this,"FileReader","readAsBase64",e.uid)},getResult:function(){return i},destroy:function(){i=null}};return t.FileReader=o}),i(Y,[z,f],function(t,e){function n(t,n){switch(n){case"readAsText":return e.atob(t,"utf8");case"readAsBinaryString":return e.atob(t);case"readAsDataURL":return t}return null}var i={read:function(t,e){var i,o=this.getRuntime();return(i=o.shimExec.call(this,"FileReaderSync","readAsBase64",e.uid))?("readAsDataURL"===t&&(i="data:"+(e.type||"")+";base64,"+i),n(i,t,e.type)):null}};return t.FileReaderSync=i}),i(G,[z,a,b,_,S,x,P],function(t,e,n,i,o,r,s){var a={send:function(t,i){function o(){t.transport=c.mode,c.shimExec.call(l,"XMLHttpRequest","send",t,i)}function a(t,e){c.shimExec.call(l,"XMLHttpRequest","appendBlob",t,e.uid),i=null,o()}function u(t,e){var n=new s;n.bind("TransportingComplete",function(){e(this.result)}),n.transport(t.getSource(),t.type,{ruid:c.uid})}var l=this,c=l.getRuntime();if(e.isEmptyObj(t.headers)||e.each(t.headers,function(t,e){c.shimExec.call(l,"XMLHttpRequest","setRequestHeader",e,t.toString())}),i instanceof r){var d;if(i.each(function(t,e){t instanceof n?d=e:c.shimExec.call(l,"XMLHttpRequest","append",e,t)}),i.hasBlob()){var h=i.getBlob();h.isDetached()?u(h,function(t){h.destroy(),a(d,t)}):a(d,h)}else i=null,o()}else i instanceof n?i.isDetached()?u(i,function(t){i.destroy(),i=t.uid,o()}):(i=i.uid,o()):o()},getResponse:function(t){var n,r,s=this.getRuntime();if(r=s.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(r=new i(s.uid,r),"blob"===t)return r;try{if(n=new o,~e.inArray(t,["","text"]))return n.readAsText(r);if("json"===t&&window.JSON)return JSON.parse(n.readAsText(r))}finally{r.destroy()}}return null},abort:function(t){var e=this.getRuntime();e.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return t.XMLHttpRequest=a}),i(K,[z,b],function(t,e){var n={getAsBlob:function(t){var n=this.getRuntime(),i=n.shimExec.call(this,"Transporter","getAsBlob",t);return i?new e(n.uid,i):null}};return t.Transporter=n}),i(J,[z,a,P,b,S],function(t,e,n,i,o){var r={loadFromBlob:function(t){function e(t){o.shimExec.call(i,"Image","loadFromBlob",t.uid),i=o=null}var i=this,o=i.getRuntime();if(t.isDetached()){var r=new n;r.bind("TransportingComplete",function(){e(r.result.getSource())}),r.transport(t.getSource(),t.type,{ruid:o.uid})}else e(t.getSource())},loadFromImage:function(t){var e=this.getRuntime();return e.shimExec.call(this,"Image","loadFromImage",t.uid)},getAsBlob:function(t,e){var n=this.getRuntime(),o=n.shimExec.call(this,"Image","getAsBlob",t,e);return o?new i(n.uid,o):null},getAsDataURL:function(){var t,e=this.getRuntime(),n=e.Image.getAsBlob.apply(this,arguments);return n?(t=new o,t.readAsDataURL(n)):null}};return t.Image=r}),i(X,[a,c,d,h,m],function(t,e,n,i,o){function r(t){var e,n,i,o,r,s=!1,a=null,u=0;try{try{a=new ActiveXObject("AgControl.AgControl"),a.IsVersionSupported(t)&&(s=!0),a=null}catch(l){var c=navigator.plugins["Silverlight Plug-In"];if(c){for(e=c.description,"1.0.30226.2"===e&&(e="2.0.30226.2"),n=e.split(".");n.length>3;)n.pop();for(;n.length<4;)n.push(0);for(i=t.split(".");i.length>4;)i.pop();do o=parseInt(i[u],10),r=parseInt(n[u],10),u++;while(u<i.length&&o===r);r>=o&&!isNaN(o)&&(s=!0)}}}catch(d){s=!1}return s}function s(s){var l,c=this;s=t.extend({xap_url:e.xap_url},s),o.call(this,s,a,{access_binary:o.capTrue,access_image_binary:o.capTrue,display_media:o.capTrue,do_cors:o.capTrue,drag_and_drop:!1,report_upload_progress:o.capTrue,resize_image:o.capTrue,return_response_headers:function(t){return t&&"client"===c.mode},return_response_type:function(t){return"json"!==t?!0:!!window.JSON},return_status_code:function(e){return"client"===c.mode||!t.arrayDiff(e,[200,404])},select_file:o.capTrue,select_multiple:o.capTrue,send_binary_string:o.capTrue,send_browser_cookies:function(t){return t&&"browser"===c.mode},send_custom_headers:function(t){return t&&"client"===c.mode},send_multipart:o.capTrue,slice_blob:o.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:o.capTrue,use_http_method:function(e){return"client"===c.mode||!t.arrayDiff(e,["GET","POST"])}},{return_response_headers:function(t){return t?"client":"browser"},return_status_code:function(e){return t.arrayDiff(e,[200,404])?"client":["client","browser"]},send_browser_cookies:function(t){return t?"browser":"client"},send_custom_headers:function(t){return t?"client":"browser"},use_http_method:function(e){return t.arrayDiff(e,["GET","POST"])?"client":["client","browser"]}}),r("2.0.31005.0")&&"Opera"!==e.browser||(this.mode=!1),t.extend(this,{getShim:function(){return n.get(this.uid).content.Moxie},shimExec:function(t,e){var n=[].slice.call(arguments,2);return c.getShim().exec(this.uid,t,e,n)},init:function(){var t;t=this.getShimContainer(),t.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+s.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+e.global_event_dispatcher+'"/></object>',l=setTimeout(function(){c&&!c.initialized&&c.trigger("Error",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR))},"Windows"!==e.OS?1e4:5e3)},destroy:function(t){return function(){t.call(c),clearTimeout(l),s=l=t=c=null}}(this.destroy)},u)}var a="silverlight",u={};return o.addConstructor(a,s),u}),i(Z,[X,a,q],function(t,e,n){return t.Blob=e.extend({},n)}),i(tt,[X],function(t){var e={init:function(t){function e(t){for(var e="",n=0;n<t.length;n++)e+=(""!==e?"|":"")+t[n].title+" | *."+t[n].extensions.replace(/,/g,";*.");return e}this.getRuntime().shimExec.call(this,"FileInput","init",e(t.accept),t.name,t.multiple),this.trigger("ready")}};return t.FileInput=e}),i(et,[X,d,B],function(t,e,n){var i={init:function(){var t,i=this,o=i.getRuntime();return t=o.getShimContainer(),n.addEvent(t,"dragover",function(t){t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect="copy"},i.uid),n.addEvent(t,"dragenter",function(t){t.preventDefault();var n=e.get(o.uid).dragEnter(t);n&&t.stopPropagation()},i.uid),n.addEvent(t,"drop",function(t){t.preventDefault();var n=e.get(o.uid).dragDrop(t);n&&t.stopPropagation()},i.uid),o.shimExec.call(this,"FileDrop","init")}};return t.FileDrop=i}),i(nt,[X,a,Q],function(t,e,n){return t.FileReader=e.extend({},n)}),i(it,[X,a,Y],function(t,e,n){return t.FileReaderSync=e.extend({},n)}),i(ot,[X,a,G],function(t,e,n){return t.XMLHttpRequest=e.extend({},n)}),i(rt,[X,a,K],function(t,e,n){return t.Transporter=e.extend({},n)}),i(st,[X,a,J],function(t,e,n){return t.Image=e.extend({},n,{getInfo:function(){var t=this.getRuntime(),n=["tiff","exif","gps"],i={meta:{}},o=t.shimExec.call(this,"Image","getInfo");return o.meta&&e.each(n,function(t){var e,n,r,s,a=o.meta[t];if(a&&a.keys)for(i.meta[t]={},n=0,r=a.keys.length;r>n;n++)e=a.keys[n],s=a[e],s&&(/^(\d|[1-9]\d+)$/.test(s)?s=parseInt(s,10):/^\d*\.\d+$/.test(s)&&(s=parseFloat(s)),i.meta[t][e]=s)}),i.width=parseInt(o.width,10),i.height=parseInt(o.height,10),i.size=parseInt(o.size,10),i.type=o.type,i.name=o.name,i}})}),i(at,[a,h,m,c],function(t,e,n,i){function o(e){var o=this,a=n.capTest,u=n.capTrue;n.call(this,e,r,{access_binary:a(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:a(s.Image&&(i.can("create_canvas")||i.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:a(function(){return"Chrome"===i.browser&&i.version>=28||"IE"===i.browser&&i.version>=10}()),resize_image:function(){return s.Image&&o.can("access_binary")&&i.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(e){return"json"===e&&window.JSON?!0:!!~t.inArray(e,["text","document",""])},return_status_code:function(e){return!t.arrayDiff(e,[200,404])},select_file:function(){return i.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return o.can("select_file")},summon_file_dialog:a(function(){return"Firefox"===i.browser&&i.version>=4||"Opera"===i.browser&&i.version>=12||!!~t.inArray(i.browser,["Chrome","Safari"])}()),upload_filesize:u,use_http_method:function(e){return!t.arrayDiff(e,["GET","POST"])}}),t.extend(this,{init:function(){this.trigger("Init")},destroy:function(t){return function(){t.call(o),t=o=null}}(this.destroy)}),t.extend(this.getShim(),s)}var r="html4",s={};return n.addConstructor(r,o),s}),i(ut,[at,a,d,B,l,c],function(t,e,n,i,o,r){function s(){function t(){var o,c,d,h,p,f,m=this,g=m.getRuntime();f=e.guid("uid_"),o=g.getShimContainer(),s&&(d=n.get(s+"_form"),d&&e.extend(d.style,{top:"100%"})),h=document.createElement("form"),h.setAttribute("id",f+"_form"),h.setAttribute("method","post"),h.setAttribute("enctype","multipart/form-data"),h.setAttribute("encoding","multipart/form-data"),e.extend(h.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),p=document.createElement("input"),p.setAttribute("id",f),p.setAttribute("type","file"),p.setAttribute("name",a.name||"Filedata"),p.setAttribute("accept",l.join(",")),e.extend(p.style,{fontSize:"999px",opacity:0}),h.appendChild(p),o.appendChild(h),e.extend(p.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===r.browser&&r.version<10&&e.extend(p.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),p.onchange=function(){var e;this.value&&(e=this.files?this.files[0]:{name:this.value},u=[e],this.onchange=function(){},t.call(m),m.bind("change",function i(){var t,e=n.get(f),o=n.get(f+"_form");m.unbind("change",i),m.files.length&&e&&o&&(t=m.files[0],e.setAttribute("id",t.uid),o.setAttribute("id",t.uid+"_form"),o.setAttribute("target",t.uid+"_iframe")),e=o=null},998),p=h=null,m.trigger("change"))},g.can("summon_file_dialog")&&(c=n.get(a.browse_button),i.removeEvent(c,"click",m.uid),i.addEvent(c,"click",function(t){p&&!p.disabled&&p.click(),t.preventDefault()},m.uid)),s=f,o=d=c=null}var s,a,u=[],l=[];e.extend(this,{init:function(e){var r,s=this,u=s.getRuntime();a=e,l=e.accept.mimes||o.extList2mimes(e.accept,u.can("filter_by_extension")),r=u.getShimContainer(),function(){var t,o,a;t=n.get(e.browse_button),u.can("summon_file_dialog")&&("static"===n.getStyle(t,"position")&&(t.style.position="relative"),o=parseInt(n.getStyle(t,"z-index"),10)||1,t.style.zIndex=o,r.style.zIndex=o-1),a=u.can("summon_file_dialog")?t:r,i.addEvent(a,"mouseover",function(){s.trigger("mouseenter")},s.uid),i.addEvent(a,"mouseout",function(){s.trigger("mouseleave")},s.uid),i.addEvent(a,"mousedown",function(){s.trigger("mousedown")},s.uid),i.addEvent(n.get(e.container),"mouseup",function(){s.trigger("mouseup")},s.uid),t=null}(),t.call(this),r=null,s.trigger({type:"ready",async:!0})},getFiles:function(){return u},disable:function(t){var e;(e=n.get(s))&&(e.disabled=!!t)},destroy:function(){var t=this.getRuntime(),e=t.getShim(),o=t.getShimContainer();i.removeAllEvents(o,this.uid),i.removeAllEvents(a&&n.get(a.container),this.uid),i.removeAllEvents(a&&n.get(a.browse_button),this.uid),o&&(o.innerHTML=""),e.removeInstance(this.uid),s=u=l=a=o=e=null}})}return t.FileInput=s}),i(lt,[at,$],function(t,e){return t.FileReader=e}),i(ct,[at,a,d,C,h,B,b,x],function(t,e,n,i,o,r,s,a){function u(){function t(t){var e,i,o,s,a=this,u=!1;if(c){if(e=c.id.replace(/_iframe$/,""),i=n.get(e+"_form")){for(o=i.getElementsByTagName("input"),s=o.length;s--;)switch(o[s].getAttribute("type")){case"hidden":o[s].parentNode.removeChild(o[s]);break;case"file":u=!0}o=[],u||i.parentNode.removeChild(i),i=null}setTimeout(function(){r.removeEvent(c,"load",a.uid),c.parentNode&&c.parentNode.removeChild(c);var e=a.getRuntime().getShimContainer();e.children.length||e.parentNode.removeChild(e),e=c=null,t()},1)}}var u,l,c;e.extend(this,{send:function(d,h){function p(){var n=y.getShimContainer()||document.body,o=document.createElement("div");o.innerHTML='<iframe id="'+f+'_iframe" name="'+f+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',c=o.firstChild,n.appendChild(c),r.addEvent(c,"load",function(){var n;try{n=c.contentWindow.document||c.contentDocument||window.frames[c.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(n.title)?u=n.title.replace(/^(\d+).*$/,"$1"):(u=200,l=e.trim(n.body.innerHTML),_.trigger({type:"progress",loaded:l.length,total:l.length}),b&&_.trigger({type:"uploadprogress",loaded:b.size||1025,total:b.size||1025}))}catch(o){if(!i.hasSameOrigin(d.url))return void t.call(_,function(){_.trigger("error")});u=404}t.call(_,function(){_.trigger("load")})},_.uid)}var f,m,g,b,_=this,y=_.getRuntime();if(u=l=null,h instanceof a&&h.hasBlob()){if(b=h.getBlob(),f=b.uid,g=n.get(f),m=n.get(f+"_form"),!m)throw new o.DOMException(o.DOMException.NOT_FOUND_ERR)}else f=e.guid("uid_"),m=document.createElement("form"),m.setAttribute("id",f+"_form"),m.setAttribute("method",d.method),m.setAttribute("enctype","multipart/form-data"),m.setAttribute("encoding","multipart/form-data"),m.setAttribute("target",f+"_iframe"),y.getShimContainer().appendChild(m);h instanceof a&&h.each(function(t,n){if(t instanceof s)g&&g.setAttribute("name",n);else{var i=document.createElement("input");e.extend(i,{type:"hidden",name:n,value:t}),g?m.insertBefore(i,g):m.appendChild(i)}}),m.setAttribute("action",d.url),p(),m.submit(),_.trigger("loadstart")},getStatus:function(){return u},getResponse:function(t){if("json"===t&&"string"===e.typeOf(l)&&window.JSON)try{return JSON.parse(l.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(n){return null}return l},abort:function(){var e=this;c&&c.contentWindow&&(c.contentWindow.stop?c.contentWindow.stop():c.contentWindow.document.execCommand?c.contentWindow.document.execCommand("Stop"):c.src="about:blank"),t.call(this,function(){e.dispatchEvent("abort")})}})}return t.XMLHttpRequest=u}),i(dt,[at,H],function(t,e){return t.Image=e}),r([a,u,l,c,d,h,p,f,m,g,b,_,y,v,w,k,C,S,x,E,P,T,B])}(this),function(t){"use strict";var e={},n=t.moxie.core.utils.Basic.inArray;return function i(t){var o,r;for(o in t)r=typeof t[o],"object"!==r||~n(o,["Exceptions","Env","Mime"])?"function"===r&&(e[o]=t[o]):i(t[o])}(t.moxie),e.Env=t.moxie.core.utils.Env,e.Mime=t.moxie.core.utils.Mime,e.Exceptions=t.moxie.core.Exceptions,t.mOxie=e,t.o||(t.o=e),e}(this),function(t,e,n){function i(t){function e(t,e,n){var o={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};o[t]?i[o[t]]=e:n||(i[t]=e)}var n=t.required_features,i={};return"string"==typeof n?s.each(n.split(/\s*,\s*/),function(t){e(t,!0)}):"object"==typeof n?s.each(n,function(t,n){e(n,t)}):n===!0&&(t.chunk_size>0&&(i.slice_blob=!0),!t.resize.enabled&&t.multipart||(i.send_binary_string=!0),s.each(t,function(t,n){e(n,!!t,!0)})),i}var o=t.setTimeout,r={},s={VERSION:"2.1.2",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:e.mimes,ua:e.ua,typeOf:e.typeOf,extend:e.extend,guid:e.guid,get:function(t){var n,i=[];"array"!==e.typeOf(t)&&(t=[t]);for(var o=t.length;o--;)n=e.get(t[o]),n&&i.push(n);return i.length?i:null},each:e.each,getPos:e.getPos,getSize:e.getSize,xmlEncode:function(t){var e={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},n=/[<>&\"\']/g;return t?(""+t).replace(n,function(t){return e[t]?"&"+e[t]+";":t}):t},toArray:e.toArray,inArray:e.inArray,addI18n:e.addI18n,translate:e.translate,isEmptyObj:e.isEmptyObj,hasClass:e.hasClass,addClass:e.addClass,removeClass:e.removeClass,getStyle:e.getStyle,addEvent:e.addEvent,removeEvent:e.removeEvent,removeAllEvents:e.removeAllEvents,cleanName:function(t){var e,n;for(n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],e=0;e<n.length;e+=2)t=t.replace(n[e],n[e+1]);return t=t.replace(/\s+/g,"_"),t=t.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(t,e){var n="";return s.each(e,function(t,e){n+=(n?"&":"")+encodeURIComponent(e)+"="+encodeURIComponent(t)}),n&&(t+=(t.indexOf("?")>0?"&":"?")+n),t},formatSize:function(t){function e(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}if(t===n||/\D/.test(t))return s.translate("N/A");var i=Math.pow(1024,4);return t>i?e(t/i,1)+" "+s.translate("tb"):t>(i/=1024)?e(t/i,1)+" "+s.translate("gb"):t>(i/=1024)?e(t/i,1)+" "+s.translate("mb"):t>1024?Math.round(t/1024)+" "+s.translate("kb"):t+" "+s.translate("b")},parseSize:e.parseSizeStr,predictRuntime:function(t,n){var i,o;return i=new s.Uploader(t),o=e.Runtime.thatCan(i.getOption().required_features,n||t.runtimes),i.destroy(),o},addFileFilter:function(t,e){r[t]=e}};s.addFileFilter("mime_types",function(t,e,n){t.length&&!t.regexp.test(e.name)?(this.trigger("Error",{code:s.FILE_EXTENSION_ERROR,message:s.translate("File extension error."),file:e}),n(!1)):n(!0)}),s.addFileFilter("max_file_size",function(t,e,n){var i;t=s.parseSize(t),e.size!==i&&t&&e.size>t?(this.trigger("Error",{code:s.FILE_SIZE_ERROR,message:s.translate("File size error."),file:e}),n(!1)):n(!0)}),s.addFileFilter("prevent_duplicates",function(t,e,n){if(t)for(var i=this.files.length;i--;)if(e.name===this.files[i].name&&e.size===this.files[i].size)return this.trigger("Error",{code:s.FILE_DUPLICATE_ERROR,message:s.translate("Duplicate file error."),file:e}),void n(!1);n(!0)}),s.Uploader=function(t){function a(){var t,e,n=0;if(this.state==s.STARTED){for(e=0;e<I.length;e++)t||I[e].status!=s.QUEUED?n++:(t=I[e],this.trigger("BeforeUpload",t)&&(t.status=s.UPLOADING,this.trigger("UploadFile",t)));n==I.length&&(this.state!==s.STOPPED&&(this.state=s.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",I))}}function u(t){t.percent=t.size>0?Math.ceil(t.loaded/t.size*100):100,l()}function l(){var t,e;for(E.reset(),t=0;t<I.length;t++)e=I[t],e.size!==n?(E.size+=e.origSize,E.loaded+=e.loaded*e.origSize/e.size):E.size=n,e.status==s.DONE?E.uploaded++:e.status==s.FAILED?E.failed++:E.queued++;E.size===n?E.percent=I.length>0?Math.ceil(E.uploaded/I.length*100):0:(E.bytesPerSec=Math.ceil(E.loaded/((+new Date-x||1)/1e3)),E.percent=E.size>0?Math.ceil(E.loaded/E.size*100):0)}function c(){var t=B[0]||O[0];return t?t.getRuntime().uid:!1}function d(t,n){if(t.ruid){var i=e.Runtime.getInfo(t.ruid);if(i)return i.can(n)}return!1}function h(){this.bind("FilesAdded FilesRemoved",function(t){t.trigger("QueueChanged"),t.refresh()}),this.bind("CancelUpload",v),this.bind("BeforeUpload",g),this.bind("UploadFile",b),this.bind("UploadProgress",_),this.bind("StateChanged",y),this.bind("QueueChanged",l),this.bind("Error",k),this.bind("FileUploaded",w),this.bind("Destroy",C)}function p(t,n){var i=this,o=0,r=[],a={runtime_order:t.runtimes,required_caps:t.required_features,preferred_caps:A,swf_url:t.flash_swf_url,xap_url:t.silverlight_xap_url};s.each(t.runtimes.split(/\s*,\s*/),function(e){t[e]&&(a[e]=t[e])}),t.browse_button&&s.each(t.browse_button,function(n){r.push(function(r){var u=new e.FileInput(s.extend({},a,{accept:t.filters.mime_types,name:t.file_data_name,multiple:t.multi_selection,container:t.container,browse_button:n}));u.onready=function(){var t=e.Runtime.getInfo(this.ruid);e.extend(i.features,{chunks:t.can("slice_blob"),multipart:t.can("send_multipart"),multi_selection:t.can("select_multiple")}),o++,B.push(this),r()},u.onchange=function(){i.addFile(this.files)},u.bind("mouseenter mouseleave mousedown mouseup",function(i){M||(t.browse_button_hover&&("mouseenter"===i.type?e.addClass(n,t.browse_button_hover):"mouseleave"===i.type&&e.removeClass(n,t.browse_button_hover)),t.browse_button_active&&("mousedown"===i.type?e.addClass(n,t.browse_button_active):"mouseup"===i.type&&e.removeClass(n,t.browse_button_active)))}),u.bind("mousedown",function(){i.trigger("Browse")}),u.bind("error runtimeerror",function(){u=null,r()}),u.init()})}),t.drop_element&&s.each(t.drop_element,function(t){r.push(function(n){var r=new e.FileDrop(s.extend({},a,{drop_zone:t}));r.onready=function(){var t=e.Runtime.getInfo(this.ruid);i.features.dragdrop=t.can("drag_and_drop"),o++,O.push(this),n()},r.ondrop=function(){i.addFile(this.files)},r.bind("error runtimeerror",function(){r=null,n()}),r.init()})}),e.inSeries(r,function(){"function"==typeof n&&n(o)})}function f(t,i,o){var r=new e.Image;try{r.onload=function(){return i.width>this.width&&i.height>this.height&&i.quality===n&&i.preserve_headers&&!i.crop?(this.destroy(),o(t)):void r.downsize(i.width,i.height,i.crop,i.preserve_headers)},r.onresize=function(){o(this.getAsBlob(t.type,i.quality)),this.destroy()},r.onerror=function(){o(t)},r.load(t)}catch(s){o(t)}}function m(t,n,o){function r(t,e,n){var i=S[t];switch(t){case"max_file_size":"max_file_size"===t&&(S.max_file_size=S.filters.max_file_size=e);break;case"chunk_size":(e=s.parseSize(e))&&(S[t]=e,S.send_file_name=!0);break;case"multipart":S[t]=e,e||(S.send_file_name=!0);break;case"unique_names":S[t]=e,e&&(S.send_file_name=!0);break;case"filters":"array"===s.typeOf(e)&&(e={mime_types:e}),n?s.extend(S.filters,e):S.filters=e,e.mime_types&&(S.filters.mime_types.regexp=function(t){var e=[];return s.each(t,function(t){s.each(t.extensions.split(/,/),function(t){/^\s*\*\s*$/.test(t)?e.push("\\.*"):e.push("\\."+t.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+e.join("|")+")$","i")}(S.filters.mime_types));break;case"resize":n?s.extend(S.resize,e,{enabled:!0}):S.resize=e;break;case"prevent_duplicates":S.prevent_duplicates=S.filters.prevent_duplicates=!!e;break;case"browse_button":case"drop_element":e=s.get(e);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":S[t]=e,n||(u=!0);break;default:S[t]=e}n||a.trigger("OptionChanged",t,e,i)}var a=this,u=!1;"object"==typeof t?s.each(t,function(t,e){r(e,t,o)}):r(t,n,o),o?(S.required_features=i(s.extend({},S)),A=i(s.extend({},S,{required_features:!0}))):u&&(a.trigger("Destroy"),p.call(a,S,function(t){t?(a.runtime=e.Runtime.getInfo(c()).type,a.trigger("Init",{runtime:a.runtime}),a.trigger("PostInit")):a.trigger("Error",{code:s.INIT_ERROR,message:s.translate("Init error.")})}))}function g(t,e){if(t.settings.unique_names){var n=e.name.match(/\.([^.]+)$/),i="part";n&&(i=n[1]),e.target_name=e.id+"."+i}}function b(t,n){function i(){c-- >0?o(r,1e3):(n.loaded=p,t.trigger("Error",{code:s.HTTP_ERROR,message:s.translate("HTTP Error."),file:n,response:P.responseText,status:P.status,responseHeaders:P.getAllResponseHeaders()}))}function r(){var d,f,m,g={};n.status===s.UPLOADING&&t.state!==s.STOPPED&&(t.settings.send_file_name&&(g.name=n.target_name||n.name),l&&h.chunks&&a.size>l?(m=Math.min(l,a.size-p),d=a.slice(p,p+m)):(m=a.size,d=a),l&&h.chunks&&(t.settings.send_chunk_number?(g.chunk=Math.ceil(p/l),g.chunks=Math.ceil(a.size/l)):(g.offset=p,g.total=a.size)),P=new e.XMLHttpRequest,P.upload&&(P.upload.onprogress=function(e){n.loaded=Math.min(n.size,p+e.loaded),t.trigger("UploadProgress",n)}),P.onload=function(){return P.status>=400?void i():(c=t.settings.max_retries,m<a.size?(d.destroy(),p+=m,n.loaded=Math.min(p,a.size),t.trigger("ChunkUploaded",n,{offset:n.loaded,total:a.size,response:P.responseText,status:P.status,responseHeaders:P.getAllResponseHeaders()}),"Android Browser"===e.Env.browser&&t.trigger("UploadProgress",n)):n.loaded=n.size,d=f=null,!p||p>=a.size?(n.size!=n.origSize&&(a.destroy(),a=null),t.trigger("UploadProgress",n),n.status=s.DONE,t.trigger("FileUploaded",n,{response:P.responseText,status:P.status,responseHeaders:P.getAllResponseHeaders()})):o(r,1),void 0)},P.onerror=function(){i()},P.onloadend=function(){this.destroy(),P=null},t.settings.multipart&&h.multipart?(P.open("post",u,!0),s.each(t.settings.headers,function(t,e){P.setRequestHeader(e,t)}),f=new e.FormData,s.each(s.extend(g,t.settings.multipart_params),function(t,e){f.append(e,t)}),f.append(t.settings.file_data_name,d),P.send(f,{runtime_order:t.settings.runtimes,required_caps:t.settings.required_features,preferred_caps:A,swf_url:t.settings.flash_swf_url,xap_url:t.settings.silverlight_xap_url})):(u=s.buildUrl(t.settings.url,s.extend(g,t.settings.multipart_params)),P.open("post",u,!0),P.setRequestHeader("Content-Type","application/octet-stream"),s.each(t.settings.headers,function(t,e){P.setRequestHeader(e,t)}),P.send(d,{runtime_order:t.settings.runtimes,required_caps:t.settings.required_features,preferred_caps:A,swf_url:t.settings.flash_swf_url,xap_url:t.settings.silverlight_xap_url})))}var a,u=t.settings.url,l=t.settings.chunk_size,c=t.settings.max_retries,h=t.features,p=0;n.loaded&&(p=n.loaded=l?l*Math.floor(n.loaded/l):0),a=n.getSource(),t.settings.resize.enabled&&d(a,"send_binary_string")&&~e.inArray(a.type,["image/jpeg","image/png"])?f.call(this,a,t.settings.resize,function(t){a=t,n.size=t.size,r()}):r()}function _(t,e){u(e)}function y(t){if(t.state==s.STARTED)x=+new Date;else if(t.state==s.STOPPED)for(var e=t.files.length-1;e>=0;e--)t.files[e].status==s.UPLOADING&&(t.files[e].status=s.QUEUED,l())}function v(){P&&P.abort()}function w(t){l(),o(function(){a.call(t)},1)}function k(t,e){e.code===s.INIT_ERROR?t.destroy():e.file&&(e.file.status=s.FAILED,u(e.file),t.state==s.STARTED&&(t.trigger("CancelUpload"),o(function(){a.call(t)},1)))}function C(t){t.stop(),s.each(I,function(t){t.destroy()}),I=[],B.length&&(s.each(B,function(t){t.destroy()}),B=[]),O.length&&(s.each(O,function(t){t.destroy()}),O=[]),A={},M=!1,x=P=null,E.reset()}var S,x,E,P,T=s.guid(),I=[],A={},B=[],O=[],M=!1;S={runtimes:e.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0},m.call(this,t,null,!0),E=new s.QueueProgress,s.extend(this,{id:T,uid:T,state:s.STOPPED,features:{},runtime:null,files:I,settings:S,total:E,init:function(){var t=this;return"function"==typeof S.preinit?S.preinit(t):s.each(S.preinit,function(e,n){t.bind(n,e)}),h.call(this),S.browse_button&&S.url?void p.call(this,S,function(n){"function"==typeof S.init?S.init(t):s.each(S.init,function(e,n){t.bind(n,e)}),n?(t.runtime=e.Runtime.getInfo(c()).type,t.trigger("Init",{runtime:t.runtime}),t.trigger("PostInit")):t.trigger("Error",{code:s.INIT_ERROR,message:s.translate("Init error.")})}):void this.trigger("Error",{code:s.INIT_ERROR,message:s.translate("Init error.")})},setOption:function(t,e){m.call(this,t,e,!this.runtime)},getOption:function(t){return t?S[t]:S},refresh:function(){B.length&&s.each(B,function(t){t.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=s.STARTED&&(this.state=s.STARTED,this.trigger("StateChanged"),a.call(this))},stop:function(){this.state!=s.STOPPED&&(this.state=s.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){M=arguments[0]!==n?arguments[0]:!0,B.length&&s.each(B,function(t){t.disable(M)}),this.trigger("DisableBrowse",M)},getFile:function(t){var e;for(e=I.length-1;e>=0;e--)if(I[e].id===t)return I[e]},addFile:function(t,n){function i(t,n){var i=[];e.each(l.settings.filters,function(e,n){r[n]&&i.push(function(i){r[n].call(l,e,t,function(t){i(!t)})})}),e.inSeries(i,n)}function a(t){var r=e.typeOf(t);if(t instanceof e.File){if(!t.ruid&&!t.isDetached()){if(!u)return!1;t.ruid=u,t.connectRuntime(u)}a(new s.File(t))}else t instanceof e.Blob?(a(t.getSource()),t.destroy()):t instanceof s.File?(n&&(t.name=n),d.push(function(e){i(t,function(n){n||(I.push(t),h.push(t),l.trigger("FileFiltered",t)),o(e,1)})})):-1!==e.inArray(r,["file","blob"])?a(new e.File(null,t)):"node"===r&&"filelist"===e.typeOf(t.files)?e.each(t.files,a):"array"===r&&(n=null,e.each(t,a))}var u,l=this,d=[],h=[];u=c(),a(t),d.length&&e.inSeries(d,function(){h.length&&l.trigger("FilesAdded",h)})},removeFile:function(t){for(var e="string"==typeof t?t:t.id,n=I.length-1;n>=0;n--)if(I[n].id===e)return this.splice(n,1)[0]},splice:function(t,e){var i=I.splice(t===n?0:t,e===n?I.length:e),o=!1;return this.state==s.STARTED&&(s.each(i,function(t){return t.status===s.UPLOADING?(o=!0,!1):void 0}),o&&this.stop()),this.trigger("FilesRemoved",i),s.each(i,function(t){t.destroy()}),o&&this.start(),i},bind:function(t,e,n){var i=this;s.Uploader.prototype.bind.call(this,t,function(){var t=[].slice.call(arguments);return t.splice(0,1,i),e.apply(this,t)},0,n)},destroy:function(){this.trigger("Destroy"),S=E=null,this.unbindAll()}})},s.Uploader.prototype=e.EventTarget.instance,s.File=function(){function t(t){s.extend(this,{id:s.guid(),name:t.name||t.fileName,type:t.type||"",size:t.size||t.fileSize,origSize:t.size||t.fileSize,loaded:0,percent:0,status:s.QUEUED,lastModifiedDate:t.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var t=this.getSource().getSource();return-1!==e.inArray(e.typeOf(t),["blob","file"])?t:null},getSource:function(){return n[this.id]?n[this.id]:null},destroy:function(){var t=this.getSource();t&&(t.destroy(),delete n[this.id])}}),n[this.id]=t}var n={};return t}(),s.QueueProgress=function(){var t=this;t.size=0,t.loaded=0,t.uploaded=0,t.failed=0,t.queued=0,t.percent=0,t.bytesPerSec=0,
t.reset=function(){t.size=t.loaded=t.uploaded=t.failed=t.queued=t.percent=t.bytesPerSec=0}},t.plupload=s}(window,mOxie),!function(t,e){"function"==typeof define&&define.amd?define("sifter",e):"object"==typeof exports?module.exports=e():t.Sifter=e()}(this,function(){var t=function(t,e){this.items=t,this.settings=e||{diacritics:!0}};t.prototype.tokenize=function(t){if(t=i(String(t||"").toLowerCase()),!t||!t.length)return[];var e,n,r,a,u=[],l=t.split(/ +/);for(e=0,n=l.length;n>e;e++){if(r=o(l[e]),this.settings.diacritics)for(a in s)s.hasOwnProperty(a)&&(r=r.replace(new RegExp(a,"g"),s[a]));u.push({string:l[e],regex:new RegExp(r,"i")})}return u},t.prototype.iterator=function(t,e){var n;n=r(t)?Array.prototype.forEach||function(t){for(var e=0,n=this.length;n>e;e++)t(this[e],e,this)}:function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e,this)},n.apply(t,[e])},t.prototype.getScoreFunction=function(t,e){var n,i,o,r;n=this,t=n.prepareSearch(t,e),o=t.tokens,i=t.options.fields,r=o.length;var s=function(t,e){var n,i;return t?(t=String(t||""),i=t.search(e.regex),-1===i?0:(n=e.string.length/t.length,0===i&&(n+=.5),n)):0},a=function(){var t=i.length;return t?1===t?function(t,e){return s(e[i[0]],t)}:function(e,n){for(var o=0,r=0;t>o;o++)r+=s(n[i[o]],e);return r/t}:function(){return 0}}();return r?1===r?function(t){return a(o[0],t)}:"and"===t.options.conjunction?function(t){for(var e,n=0,i=0;r>n;n++){if(e=a(o[n],t),0>=e)return 0;i+=e}return i/r}:function(t){for(var e=0,n=0;r>e;e++)n+=a(o[e],t);return n/r}:function(){return 0}},t.prototype.getSortFunction=function(t,n){var i,o,r,s,a,u,l,c,d,h,p;if(r=this,t=r.prepareSearch(t,n),p=!t.query&&n.sort_empty||n.sort,d=function(t,e){return"$score"===t?e.score:r.items[e.id][t]},a=[],p)for(i=0,o=p.length;o>i;i++)(t.query||"$score"!==p[i].field)&&a.push(p[i]);if(t.query){for(h=!0,i=0,o=a.length;o>i;i++)if("$score"===a[i].field){h=!1;break}h&&a.unshift({field:"$score",direction:"desc"})}else for(i=0,o=a.length;o>i;i++)if("$score"===a[i].field){a.splice(i,1);break}for(c=[],i=0,o=a.length;o>i;i++)c.push("desc"===a[i].direction?-1:1);return u=a.length,u?1===u?(s=a[0].field,l=c[0],function(t,n){return l*e(d(s,t),d(s,n))}):function(t,n){var i,o,r;for(i=0;u>i;i++)if(r=a[i].field,o=c[i]*e(d(r,t),d(r,n)))return o;return 0}:null},t.prototype.prepareSearch=function(t,e){if("object"==typeof t)return t;e=n({},e);var i=e.fields,o=e.sort,s=e.sort_empty;return i&&!r(i)&&(e.fields=[i]),o&&!r(o)&&(e.sort=[o]),s&&!r(s)&&(e.sort_empty=[s]),{options:e,query:String(t||"").toLowerCase(),tokens:this.tokenize(t),total:0,items:[]}},t.prototype.search=function(t,e){var n,i,o,r,s=this;return i=this.prepareSearch(t,e),e=i.options,t=i.query,r=e.score||s.getScoreFunction(i),t.length?s.iterator(s.items,function(t,o){n=r(t),(e.filter===!1||n>0)&&i.items.push({score:n,id:o})}):s.iterator(s.items,function(t,e){i.items.push({score:1,id:e})}),o=s.getSortFunction(i,e),o&&i.items.sort(o),i.total=i.items.length,"number"==typeof e.limit&&(i.items=i.items.slice(0,e.limit)),i};var e=function(t,e){return"number"==typeof t&&"number"==typeof e?t>e?1:e>t?-1:0:(t=String(t||"").toLowerCase(),e=String(e||"").toLowerCase(),t>e?1:e>t?-1:0)},n=function(t){var e,n,i,o;for(e=1,n=arguments.length;n>e;e++)if(o=arguments[e])for(i in o)o.hasOwnProperty(i)&&(t[i]=o[i]);return t},i=function(t){return(t+"").replace(/^\s+|\s+$|/g,"")},o=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},r=Array.isArray||$&&$.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},s={a:"[a]",c:"[c]",d:"[d]",e:"[e]",i:"[i]",n:"[n]",o:"[o]",r:"[r]",s:"[s]",t:"[t]",u:"[u]",y:"[y]",z:"[z]"};return t}),function(t,e){"function"==typeof define&&define.amd?define("microplugin",e):"object"==typeof exports?module.exports=e():t.MicroPlugin=e()}(this,function(){var t={};t.mixin=function(t){t.plugins={},t.prototype.initializePlugins=function(t){var n,i,o,r=this,s=[];if(r.plugins={names:[],settings:{},requested:{},loaded:{}},e.isArray(t))for(n=0,i=t.length;i>n;n++)"string"==typeof t[n]?s.push(t[n]):(r.plugins.settings[t[n].name]=t[n].options,s.push(t[n].name));else if(t)for(o in t)t.hasOwnProperty(o)&&(r.plugins.settings[o]=t[o],s.push(o));for(;s.length;)r.require(s.shift())},t.prototype.loadPlugin=function(e){var n=this,i=n.plugins,o=t.plugins[e];if(!t.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');i.requested[e]=!0,i.loaded[e]=o.fn.apply(n,[n.plugins.settings[e]||{}]),i.names.push(e)},t.prototype.require=function(t){var e=this,n=e.plugins;if(!e.plugins.loaded.hasOwnProperty(t)){if(n.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');e.loadPlugin(t)}return n.loaded[t]},t.define=function(e,n){t.plugins[e]={name:e,fn:n}}};var e={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}};return t}),function(t,e){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("sifter"),require("microplugin")):t.Selectize=e(t.jQuery,t.Sifter,t.MicroPlugin)}(this,function(t,e,n){"use strict";var i=function(t,e){if("string"!=typeof e||e.length){var n="string"==typeof e?new RegExp(e,"i"):e,i=function(t){var e=0;if(3===t.nodeType){var o=t.data.search(n);if(o>=0&&t.data.length>0){var r=t.data.match(n),s=document.createElement("span");s.className="highlight";var a=t.splitText(o),u=(a.splitText(r[0].length),a.cloneNode(!0));s.appendChild(u),a.parentNode.replaceChild(s,a),e=1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName))for(var l=0;l<t.childNodes.length;++l)l+=i(t.childNodes[l]);return e};return t.each(function(){i(this)})}},o=function(){};o.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){var n=arguments.length;return 0===n?delete this._events:1===n?delete this._events[t]:(this._events=this._events||{},void(t in this._events!=0&&this._events[t].splice(this._events[t].indexOf(e),1)))},trigger:function(t){if(this._events=this._events||{},t in this._events!=0)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},o.mixin=function(t){for(var e=["on","off","trigger"],n=0;n<e.length;n++)t.prototype[e[n]]=o.prototype[e[n]]};var r=/Mac/.test(navigator.userAgent),s=65,a=13,u=27,l=37,c=38,d=80,h=39,p=40,f=78,m=8,g=46,b=16,_=r?91:17,y=r?18:17,v=9,w=1,k=2,C=function(t){return"undefined"!=typeof t},S=function(t){return"undefined"==typeof t||null===t?null:"boolean"==typeof t?t?"1":"0":t+""},x=function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},E=function(t){return(t+"").replace(/\$/g,"$$$$")},P={};P.before=function(t,e,n){var i=t[e];t[e]=function(){return n.apply(t,arguments),i.apply(t,arguments)}},P.after=function(t,e,n){var i=t[e];t[e]=function(){var e=i.apply(t,arguments);return n.apply(t,arguments),e}};var T=function(e,n){if(!t.isArray(n))return n;var i,o,r={};for(i=0,o=n.length;o>i;i++)n[i].hasOwnProperty(e)&&(r[n[i][e]]=n[i]);return r},I=function(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}},A=function(t,e){var n;return function(){var i=this,o=arguments;window.clearTimeout(n),n=window.setTimeout(function(){t.apply(i,o)},e)}},B=function(t,e,n){var i,o=t.trigger,r={};t.trigger=function(){var n=arguments[0];return-1===e.indexOf(n)?o.apply(t,arguments):void(r[n]=arguments)},n.apply(t,[]),t.trigger=o;for(i in r)r.hasOwnProperty(i)&&o.apply(t,r[i])},O=function(t,e,n,i){t.on(e,n,function(e){for(var n=e.target;n&&n.parentNode!==t[0];)n=n.parentNode;return e.currentTarget=n,i.apply(this,[e])})},M=function(t){var e={};if("selectionStart"in t)e.start=t.selectionStart,e.length=t.selectionEnd-e.start;else if(document.selection){t.focus();var n=document.selection.createRange(),i=document.selection.createRange().text.length;n.moveStart("character",-t.value.length),e.start=n.text.length-i,e.length=i}return e},$=function(t,e,n){var i,o,r={};if(n)for(i=0,o=n.length;o>i;i++)r[n[i]]=t.css(n[i]);else r=t.css();e.css(r)},D=function(e,n){if(!e)return 0;var i=t("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(e).appendTo("body");$(n,i,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var o=i.width();return i.remove(),o},R=function(t){var e=null,n=function(n,i){var o,r,s,a,u,l,c,d;n=n||window.event||{},i=i||{},n.metaKey||n.altKey||(i.force||t.data("grow")!==!1)&&(o=t.val(),n.type&&"keydown"===n.type.toLowerCase()&&(r=n.keyCode,s=r>=97&&122>=r||r>=65&&90>=r||r>=48&&57>=r||32===r,r===g||r===m?(d=M(t[0]),d.length?o=o.substring(0,d.start)+o.substring(d.start+d.length):r===m&&d.start?o=o.substring(0,d.start-1)+o.substring(d.start+1):r===g&&"undefined"!=typeof d.start&&(o=o.substring(0,d.start)+o.substring(d.start+1))):s&&(l=n.shiftKey,c=String.fromCharCode(n.keyCode),c=l?c.toUpperCase():c.toLowerCase(),o+=c)),a=t.attr("placeholder"),!o&&a&&(o=a),u=D(o,t)+4,u!==e&&(e=u,t.width(u),t.triggerHandler("resize")))};t.on("keydown keyup update blur",n),n()},L=function(n,i){var o,r,s=this;r=n[0],r.selectize=s;var a=window.getComputedStyle&&window.getComputedStyle(r,null);o=a?a.getPropertyValue("direction"):r.currentStyle&&r.currentStyle.direction,o=o||n.parents("[dir]:first").attr("dir")||"",t.extend(s,{settings:i,$input:n,tagType:"select"===r.tagName.toLowerCase()?w:k,rtl:/rtl/i.test(o),eventNS:".selectize"+ ++L.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:n.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===i.loadThrottle?s.onSearchChange:A(s.onSearchChange,i.loadThrottle)}),s.sifter=new e(this.options,{diacritics:i.diacritics}),t.extend(s.options,T(i.valueField,i.options)),delete s.settings.options,t.extend(s.optgroups,T(i.optgroupValueField,i.optgroups)),delete s.settings.optgroups,s.settings.mode=s.settings.mode||(1===s.settings.maxItems?"single":"multi"),"boolean"!=typeof s.settings.hideSelected&&(s.settings.hideSelected="multi"===s.settings.mode),s.initializePlugins(s.settings.plugins),s.setupCallbacks(),s.setupTemplates(),s.setup()};return o.mixin(L),n.mixin(L),t.extend(L.prototype,{setup:function(){var e,n,i,o,s,a,u,l,c,d,h=this,p=h.settings,f=h.eventNS,m=t(window),g=t(document),v=h.$input;u=h.settings.mode,l=v.attr("tabindex")||"",c=v.attr("class")||"",e=t("<div>").addClass(p.wrapperClass).addClass(c).addClass(u),n=t("<div>").addClass(p.inputClass).addClass("items").appendTo(e),i=t('<input type="text" autocomplete="off" />').appendTo(n).attr("tabindex",l),a=t(p.dropdownParent||e),o=t("<div>").addClass(p.dropdownClass).addClass(u).hide().appendTo(a),s=t("<div>").addClass(p.dropdownContentClass).appendTo(o),h.settings.copyClassesToDropdown&&o.addClass(c),e.css({width:v[0].style.width}),h.plugins.names.length&&(d="plugin-"+h.plugins.names.join(" plugin-"),e.addClass(d),o.addClass(d)),(null===p.maxItems||p.maxItems>1)&&h.tagType===w&&v.attr("multiple","multiple"),h.settings.placeholder&&i.attr("placeholder",p.placeholder),v.attr("autocorrect")&&i.attr("autocorrect",v.attr("autocorrect")),v.attr("autocapitalize")&&i.attr("autocapitalize",v.attr("autocapitalize")),h.$wrapper=e,h.$control=n,h.$control_input=i,h.$dropdown=o,h.$dropdown_content=s,o.on("mouseenter","[data-selectable]",function(){return h.onOptionHover.apply(h,arguments)}),o.on("mousedown","[data-selectable]",function(){return h.onOptionSelect.apply(h,arguments)}),O(n,"mousedown","*:not(input)",function(){return h.onItemSelect.apply(h,arguments)}),R(i),n.on({mousedown:function(){return h.onMouseDown.apply(h,arguments)},click:function(){return h.onClick.apply(h,arguments)}}),i.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return h.onKeyDown.apply(h,arguments)},keyup:function(){return h.onKeyUp.apply(h,arguments)},keypress:function(){return h.onKeyPress.apply(h,arguments)},resize:function(){h.positionDropdown.apply(h,[])},blur:function(){return h.onBlur.apply(h,arguments)},focus:function(){return h.ignoreBlur=!1,h.onFocus.apply(h,arguments)},paste:function(){return h.onPaste.apply(h,arguments)}}),g.on("keydown"+f,function(t){h.isCmdDown=t[r?"metaKey":"ctrlKey"],h.isCtrlDown=t[r?"altKey":"ctrlKey"],h.isShiftDown=t.shiftKey}),g.on("keyup"+f,function(t){t.keyCode===y&&(h.isCtrlDown=!1),t.keyCode===b&&(h.isShiftDown=!1),t.keyCode===_&&(h.isCmdDown=!1)}),g.on("mousedown"+f,function(t){if(h.isFocused){if(t.target===h.$dropdown[0]||t.target.parentNode===h.$dropdown[0])return!1;h.$control.has(t.target).length||t.target===h.$control[0]||h.blur()}}),m.on(["scroll"+f,"resize"+f].join(" "),function(){h.isOpen&&h.positionDropdown.apply(h,arguments)}),m.on("mousemove"+f,function(){h.ignoreHover=!1}),this.revertSettings={$children:v.children().detach(),tabindex:v.attr("tabindex")},v.attr("tabindex",-1).hide().after(h.$wrapper),t.isArray(p.items)&&(h.setValue(p.items),delete p.items),v[0].validity&&v.on("invalid"+f,function(t){t.preventDefault(),h.isInvalid=!0,h.refreshState()}),h.updateOriginalInput(),h.refreshItems(),h.refreshState(),h.updatePlaceholder(),h.isSetup=!0,v.is(":disabled")&&h.disable(),h.on("change",this.onChange),v.data("selectize",h),v.addClass("selectized"),h.trigger("initialize"),p.preload===!0&&h.onSearchChange("")},setupTemplates:function(){var e=this,n=e.settings.labelField,i=e.settings.optgroupLabelField,o={optgroup:function(t){return'<div class="optgroup">'+t.html+"</div>"},optgroup_header:function(t,e){return'<div class="optgroup-header">'+e(t[i])+"</div>"},option:function(t,e){return'<div class="option">'+e(t[n])+"</div>"},item:function(t,e){return'<div class="item">'+e(t[n])+"</div>"},option_create:function(t,e){return'<div class="create">Add <strong>'+e(t.input)+"</strong>&hellip;</div>"}};e.settings.render=t.extend({},o,e.settings.render)},setupCallbacks:function(){var t,e,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad"};for(t in n)n.hasOwnProperty(t)&&(e=this.settings[n[t]],e&&this.on(t,e))},onClick:function(t){var e=this;e.isFocused||(e.focus(),t.preventDefault())},onMouseDown:function(e){var n=this,i=e.isDefaultPrevented();if(t(e.target),n.isFocused){if(e.target!==n.$control_input[0])return"single"===n.settings.mode?n.isOpen?n.close():n.open():i||n.setActiveItem(null),!1}else i||window.setTimeout(function(){n.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(t){var e=this;(e.isFull()||e.isInputHidden||e.isLocked)&&t.preventDefault()},onKeyPress:function(t){if(this.isLocked)return t&&t.preventDefault();var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&e===this.settings.delimiter?(this.createItem(),t.preventDefault(),!1):void 0},onKeyDown:function(t){var e=(t.target===this.$control_input[0],this);if(e.isLocked)return void(t.keyCode!==v&&t.preventDefault());switch(t.keyCode){case s:if(e.isCmdDown)return void e.selectAll();break;case u:return void e.close();case f:if(!t.ctrlKey||t.altKey)break;case p:if(!e.isOpen&&e.hasOptions)e.open();else if(e.$activeOption){e.ignoreHover=!0;var n=e.getAdjacentOption(e.$activeOption,1);n.length&&e.setActiveOption(n,!0,!0)}return void t.preventDefault();case d:if(!t.ctrlKey||t.altKey)break;case c:if(e.$activeOption){e.ignoreHover=!0;var i=e.getAdjacentOption(e.$activeOption,-1);i.length&&e.setActiveOption(i,!0,!0)}return void t.preventDefault();case a:return e.isOpen&&e.$activeOption&&e.onOptionSelect({currentTarget:e.$activeOption}),void t.preventDefault();case l:return void e.advanceSelection(-1,t);case h:return void e.advanceSelection(1,t);case v:return e.settings.selectOnTab&&e.isOpen&&e.$activeOption&&(e.onOptionSelect({currentTarget:e.$activeOption}),t.preventDefault()),void(e.settings.create&&e.createItem()&&t.preventDefault());case m:case g:return void e.deleteSelection(t)}return!e.isFull()&&!e.isInputHidden||(r?t.metaKey:t.ctrlKey)?void 0:void t.preventDefault()},onKeyUp:function(t){var e=this;if(e.isLocked)return t&&t.preventDefault();var n=e.$control_input.val()||"";e.lastValue!==n&&(e.lastValue=n,e.onSearchChange(n),e.refreshOptions(),e.trigger("type",n))},onSearchChange:function(t){var e=this,n=e.settings.load;n&&(e.loadedSearches.hasOwnProperty(t)||(e.loadedSearches[t]=!0,e.load(function(i){n.apply(e,[t,i])})))},onFocus:function(t){var e=this;return e.isFocused=!0,e.isDisabled?(e.blur(),t&&t.preventDefault(),!1):void(e.ignoreFocus||("focus"===e.settings.preload&&e.onSearchChange(""),e.$activeItems.length||(e.showInput(),e.setActiveItem(null),e.refreshOptions(!!e.settings.openOnFocus)),e.refreshState()))},onBlur:function(t){var e=this;if(e.isFocused=!1,!e.ignoreFocus){if(!e.ignoreBlur&&document.activeElement===e.$dropdown_content[0])return e.ignoreBlur=!0,void e.onFocus(t);e.settings.create&&e.settings.createOnBlur&&e.createItem(!1),e.close(),e.setTextboxValue(""),e.setActiveItem(null),e.setActiveOption(null),e.setCaret(e.items.length),e.refreshState()}},onOptionHover:function(t){this.ignoreHover||this.setActiveOption(t.currentTarget,!1)},onOptionSelect:function(e){var n,i,o=this;e.preventDefault&&(e.preventDefault(),e.stopPropagation()),i=t(e.currentTarget),i.hasClass("create")?o.createItem():(n=i.attr("data-value"),"undefined"!=typeof n&&(o.lastQuery=null,o.setTextboxValue(""),o.addItem(n),!o.settings.hideSelected&&e.type&&/mouse/.test(e.type)&&o.setActiveOption(o.getOption(n))))},onItemSelect:function(t){var e=this;e.isLocked||"multi"===e.settings.mode&&(t.preventDefault(),e.setActiveItem(t.currentTarget,t))},load:function(t){var e=this,n=e.$wrapper.addClass("loading");e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(e.isFocused&&!e.isInputHidden)),e.loading||n.removeClass("loading"),e.trigger("load",t)}])},setTextboxValue:function(t){var e=this.$control_input,n=e.val()!==t;n&&(e.val(t).triggerHandler("update"),this.lastValue=t)},getValue:function(){return this.tagType===w&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(t){B(this,["change"],function(){this.clear(),this.addItems(t)})},setActiveItem:function(e,n){var i,o,r,s,a,u,l,c,d=this;if("single"!==d.settings.mode){if(e=t(e),!e.length)return t(d.$activeItems).removeClass("active"),d.$activeItems=[],void(d.isFocused&&d.showInput());if(i=n&&n.type.toLowerCase(),"mousedown"===i&&d.isShiftDown&&d.$activeItems.length){for(c=d.$control.children(".active:last"),s=Array.prototype.indexOf.apply(d.$control[0].childNodes,[c[0]]),a=Array.prototype.indexOf.apply(d.$control[0].childNodes,[e[0]]),s>a&&(l=s,s=a,a=l),o=s;a>=o;o++)u=d.$control[0].childNodes[o],-1===d.$activeItems.indexOf(u)&&(t(u).addClass("active"),d.$activeItems.push(u));n.preventDefault()}else"mousedown"===i&&d.isCtrlDown||"keydown"===i&&this.isShiftDown?e.hasClass("active")?(r=d.$activeItems.indexOf(e[0]),d.$activeItems.splice(r,1),e.removeClass("active")):d.$activeItems.push(e.addClass("active")[0]):(t(d.$activeItems).removeClass("active"),d.$activeItems=[e.addClass("active")[0]]);d.hideInput(),this.isFocused||d.focus()}},setActiveOption:function(e,n,i){var o,r,s,a,u,l=this;l.$activeOption&&l.$activeOption.removeClass("active"),l.$activeOption=null,e=t(e),e.length&&(l.$activeOption=e.addClass("active"),(n||!C(n))&&(o=l.$dropdown_content.height(),r=l.$activeOption.outerHeight(!0),n=l.$dropdown_content.scrollTop()||0,s=l.$activeOption.offset().top-l.$dropdown_content.offset().top+n,a=s,u=s-o+r,s+r>o+n?l.$dropdown_content.stop().animate({scrollTop:u},i?l.settings.scrollDuration:0):n>s&&l.$dropdown_content.stop().animate({scrollTop:a},i?l.settings.scrollDuration:0)))},selectAll:function(){var t=this;"single"!==t.settings.mode&&(t.$activeItems=Array.prototype.slice.apply(t.$control.children(":not(input)").addClass("active")),t.$activeItems.length&&(t.hideInput(),t.close()),t.focus())},hideInput:function(){var t=this;t.setTextboxValue(""),t.$control_input.css({opacity:0,position:"absolute",left:t.rtl?1e4:-1e4}),t.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var t=this;t.isDisabled||(t.ignoreFocus=!0,t.$control_input[0].focus(),window.setTimeout(function(){t.ignoreFocus=!1,t.onFocus()},0))},blur:function(){this.$control_input.trigger("blur")},getScoreFunction:function(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())},getSearchOptions:function(){var t=this.settings,e=t.sortField;return"string"==typeof e&&(e={field:e}),{fields:t.searchField,conjunction:t.searchConjunction,sort:e}},search:function(e){var n,i,o,r=this,s=r.settings,a=this.getSearchOptions();if(s.score&&(o=r.settings.score.apply(this,[e]),"function"!=typeof o))throw new Error('Selectize "score" setting must be a function that returns a function');if(e!==r.lastQuery?(r.lastQuery=e,i=r.sifter.search(e,t.extend(a,{score:o})),r.currentResults=i):i=t.extend(!0,{},r.currentResults),s.hideSelected)for(n=i.items.length-1;n>=0;n--)-1!==r.items.indexOf(S(i.items[n].id))&&i.items.splice(n,1);return i},refreshOptions:function(e){var n,o,r,s,a,u,l,c,d,h,p,f,m,g,b,_;"undefined"==typeof e&&(e=!0);var y=this,v=t.trim(y.$control_input.val()),w=y.search(v),k=y.$dropdown_content,C=y.$activeOption&&S(y.$activeOption.attr("data-value"));if(s=w.items.length,"number"==typeof y.settings.maxOptions&&(s=Math.min(s,y.settings.maxOptions)),a={},y.settings.optgroupOrder)for(u=y.settings.optgroupOrder,n=0;n<u.length;n++)a[u[n]]=[];else u=[];for(n=0;s>n;n++)for(l=y.options[w.items[n].id],c=y.render("option",l),d=l[y.settings.optgroupField]||"",h=t.isArray(d)?d:[d],o=0,r=h&&h.length;r>o;o++)d=h[o],y.optgroups.hasOwnProperty(d)||(d=""),a.hasOwnProperty(d)||(a[d]=[],u.push(d)),a[d].push(c);for(p=[],n=0,s=u.length;s>n;n++)d=u[n],y.optgroups.hasOwnProperty(d)&&a[d].length?(f=y.render("optgroup_header",y.optgroups[d])||"",f+=a[d].join(""),p.push(y.render("optgroup",t.extend({},y.optgroups[d],{html:f})))):p.push(a[d].join(""));if(k.html(p.join("")),y.settings.highlight&&w.query.length&&w.tokens.length)for(n=0,s=w.tokens.length;s>n;n++)i(k,w.tokens[n].regex);if(!y.settings.hideSelected)for(n=0,s=y.items.length;s>n;n++)y.getOption(y.items[n]).addClass("selected");m=y.canCreate(v),m&&(k.prepend(y.render("option_create",{input:v})),_=t(k[0].childNodes[0])),y.hasOptions=w.items.length>0||m,y.hasOptions?(w.items.length>0?(b=C&&y.getOption(C),b&&b.length?g=b:"single"===y.settings.mode&&y.items.length&&(g=y.getOption(y.items[0])),g&&g.length||(g=_&&!y.settings.addPrecedence?y.getAdjacentOption(_,1):k.find("[data-selectable]:first"))):g=_,y.setActiveOption(g),e&&!y.isOpen&&y.open()):(y.setActiveOption(null),e&&y.isOpen&&y.close())},addOption:function(e){var n,i,o,r=this;if(t.isArray(e))for(n=0,i=e.length;i>n;n++)r.addOption(e[n]);else o=S(e[r.settings.valueField]),"string"!=typeof o||r.options.hasOwnProperty(o)||(r.userOptions[o]=!0,r.options[o]=e,r.lastQuery=null,r.trigger("option_add",o,e))},addOptionGroup:function(t,e){this.optgroups[t]=e,this.trigger("optgroup_add",t,e)},updateOption:function(e,n){var i,o,r,s,a,u,l=this;if(e=S(e),r=S(n[l.settings.valueField]),null!==e&&l.options.hasOwnProperty(e)){if("string"!=typeof r)throw new Error("Value must be set in option data");r!==e&&(delete l.options[e],s=l.items.indexOf(e),-1!==s&&l.items.splice(s,1,r)),l.options[r]=n,a=l.renderCache.item,u=l.renderCache.option,a&&(delete a[e],delete a[r]),u&&(delete u[e],delete u[r]),-1!==l.items.indexOf(r)&&(i=l.getItem(e),o=t(l.render("item",n)),i.hasClass("active")&&o.addClass("active"),i.replaceWith(o)),l.lastQuery=null,l.isOpen&&l.refreshOptions(!1)}},removeOption:function(t){var e=this;t=S(t);var n=e.renderCache.item,i=e.renderCache.option;n&&delete n[t],i&&delete i[t],delete e.userOptions[t],delete e.options[t],e.lastQuery=null,e.trigger("option_remove",t),e.removeItem(t)},clearOptions:function(){var t=this;t.loadedSearches={},t.userOptions={},t.renderCache={},t.options=t.sifter.items={},t.lastQuery=null,t.trigger("option_clear"),t.clear()},getOption:function(t){return this.getElementWithValue(t,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(e,n){var i=this.$dropdown.find("[data-selectable]"),o=i.index(e)+n;return o>=0&&o<i.length?i.eq(o):t()},getElementWithValue:function(e,n){if(e=S(e),"undefined"!=typeof e&&null!==e)for(var i=0,o=n.length;o>i;i++)if(n[i].getAttribute("data-value")===e)return t(n[i]);return t()},getItem:function(t){return this.getElementWithValue(t,this.$control.children())},addItems:function(e){for(var n=t.isArray(e)?e:[e],i=0,o=n.length;o>i;i++)this.isPending=o-1>i,this.addItem(n[i])},addItem:function(e){B(this,["change"],function(){var n,i,o,r,s,a=this,u=a.settings.mode;return e=S(e),-1!==a.items.indexOf(e)?void("single"===u&&a.close()):void(a.options.hasOwnProperty(e)&&("single"===u&&a.clear(),"multi"===u&&a.isFull()||(n=t(a.render("item",a.options[e])),s=a.isFull(),a.items.splice(a.caretPos,0,e),a.insertAtCaret(n),(!a.isPending||!s&&a.isFull())&&a.refreshState(),a.isSetup&&(o=a.$dropdown_content.find("[data-selectable]"),a.isPending||(i=a.getOption(e),r=a.getAdjacentOption(i,1).attr("data-value"),a.refreshOptions(a.isFocused&&"single"!==u),r&&a.setActiveOption(a.getOption(r))),!o.length||a.isFull()?a.close():a.positionDropdown(),a.updatePlaceholder(),a.trigger("item_add",e,n),a.updateOriginalInput()))))})},removeItem:function(t){var e,n,i,o=this;e="object"==typeof t?t:o.getItem(t),t=S(e.attr("data-value")),n=o.items.indexOf(t),-1!==n&&(e.remove(),e.hasClass("active")&&(i=o.$activeItems.indexOf(e[0]),o.$activeItems.splice(i,1)),o.items.splice(n,1),o.lastQuery=null,!o.settings.persist&&o.userOptions.hasOwnProperty(t)&&o.removeOption(t),n<o.caretPos&&o.setCaret(o.caretPos-1),o.refreshState(),o.updatePlaceholder(),o.updateOriginalInput(),o.positionDropdown(),o.trigger("item_remove",t))},createItem:function(e){var n=this,i=t.trim(n.$control_input.val()||""),o=n.caretPos;if(!n.canCreate(i))return!1;n.lock(),"undefined"==typeof e&&(e=!0);var r="function"==typeof n.settings.create?this.settings.create:function(t){var e={};return e[n.settings.labelField]=t,e[n.settings.valueField]=t,e},s=I(function(t){if(n.unlock(),t&&"object"==typeof t){var i=S(t[n.settings.valueField]);"string"==typeof i&&(n.setTextboxValue(""),n.addOption(t),n.setCaret(o),n.addItem(i),n.refreshOptions(e&&"single"!==n.settings.mode))}}),a=r.apply(this,[i,s]);return"undefined"!=typeof a&&s(a),!0},refreshItems:function(){if(this.lastQuery=null,this.isSetup)for(var t=0;t<this.items.length;t++)this.addItem(this.items);this.refreshState(),this.updateOriginalInput()},refreshState:function(){var t,e=this;e.isRequired&&(e.items.length&&(e.isInvalid=!1),e.$control_input.prop("required",t)),e.refreshClasses()},refreshClasses:function(){var e=this,n=e.isFull(),i=e.isLocked;e.$wrapper.toggleClass("rtl",e.rtl),e.$control.toggleClass("focus",e.isFocused).toggleClass("disabled",e.isDisabled).toggleClass("required",e.isRequired).toggleClass("invalid",e.isInvalid).toggleClass("locked",i).toggleClass("full",n).toggleClass("not-full",!n).toggleClass("input-active",e.isFocused&&!e.isInputHidden).toggleClass("dropdown-active",e.isOpen).toggleClass("has-options",!t.isEmptyObject(e.options)).toggleClass("has-items",e.items.length>0),e.$control_input.data("grow",!n&&!i)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(){var t,e,n,i=this;if(i.tagType===w){for(n=[],t=0,e=i.items.length;e>t;t++)n.push('<option value="'+x(i.items[t])+'" selected="selected"></option>');n.length||this.$input.attr("multiple")||n.push('<option value="" selected="selected"></option>'),i.$input.html(n.join(""))}else i.$input.val(i.getValue()),i.$input.attr("value",i.$input.val());i.isSetup&&i.trigger("change",i.$input.val())},updatePlaceholder:function(){if(this.settings.placeholder){var t=this.$control_input;this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update",{force:!0})}},open:function(){var t=this;t.isLocked||t.isOpen||"multi"===t.settings.mode&&t.isFull()||(t.focus(),t.isOpen=!0,t.refreshState(),t.$dropdown.css({visibility:"hidden",display:"block"}),t.positionDropdown(),t.$dropdown.css({visibility:"visible"}),t.trigger("dropdown_open",t.$dropdown))},close:function(){var t=this,e=t.isOpen;"single"===t.settings.mode&&t.items.length&&t.hideInput(),t.isOpen=!1,t.$dropdown.hide(),t.setActiveOption(null),t.refreshState(),e&&t.trigger("dropdown_close",t.$dropdown)},positionDropdown:function(){var t=this.$control,e="body"===this.settings.dropdownParent?t.offset():t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t.outerWidth(),top:e.top,left:e.left})},clear:function(){var t=this;t.items.length&&(t.$control.children(":not(input)").remove(),t.items=[],t.lastQuery=null,t.setCaret(0),t.setActiveItem(null),t.updatePlaceholder(),t.updateOriginalInput(),t.refreshState(),t.showInput(),t.trigger("clear"))},insertAtCaret:function(e){var n=Math.min(this.caretPos,this.items.length);0===n?this.$control.prepend(e):t(this.$control[0].childNodes[n]).before(e),this.setCaret(n+1)},deleteSelection:function(e){var n,i,o,r,s,a,u,l,c,d=this;if(o=e&&e.keyCode===m?-1:1,r=M(d.$control_input[0]),d.$activeOption&&!d.settings.hideSelected&&(u=d.getAdjacentOption(d.$activeOption,-1).attr("data-value")),s=[],d.$activeItems.length){for(c=d.$control.children(".active:"+(o>0?"last":"first")),a=d.$control.children(":not(input)").index(c),o>0&&a++,n=0,i=d.$activeItems.length;i>n;n++)s.push(t(d.$activeItems[n]).attr("data-value"));e&&(e.preventDefault(),e.stopPropagation())}else(d.isFocused||"single"===d.settings.mode)&&d.items.length&&(0>o&&0===r.start&&0===r.length?s.push(d.items[d.caretPos-1]):o>0&&r.start===d.$control_input.val().length&&s.push(d.items[d.caretPos]));if(!s.length||"function"==typeof d.settings.onDelete&&d.settings.onDelete.apply(d,[s])===!1)return!1;for("undefined"!=typeof a&&d.setCaret(a);s.length;)d.removeItem(s.pop());return d.showInput(),d.positionDropdown(),d.refreshOptions(!0),u&&(l=d.getOption(u),l.length&&d.setActiveOption(l)),!0},advanceSelection:function(t,e){var n,i,o,r,s,a,u=this;0!==t&&(u.rtl&&(t*=-1),n=t>0?"last":"first",i=M(u.$control_input[0]),u.isFocused&&!u.isInputHidden?(r=u.$control_input.val().length,s=0>t?0===i.start&&0===i.length:i.start===r,s&&!r&&u.advanceCaret(t,e)):(a=u.$control.children(".active:"+n),a.length&&(o=u.$control.children(":not(input)").index(a),u.setActiveItem(null),u.setCaret(t>0?o+1:o))))},advanceCaret:function(t,e){var n,i,o=this;0!==t&&(n=t>0?"next":"prev",o.isShiftDown?(i=o.$control_input[n](),i.length&&(o.hideInput(),o.setActiveItem(i),e&&e.preventDefault())):o.setCaret(o.caretPos+t))},setCaret:function(e){var n=this;if(e="single"===n.settings.mode?n.items.length:Math.max(0,Math.min(n.items.length,e)),!n.isPending){var i,o,r,s;for(r=n.$control.children(":not(input)"),i=0,o=r.length;o>i;i++)s=t(r[i]).detach(),e>i?n.$control_input.before(s):n.$control.append(s)}n.caretPos=e},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var t=this;t.$input.prop("disabled",!0),t.isDisabled=!0,t.lock()},enable:function(){var t=this;t.$input.prop("disabled",!1),t.isDisabled=!1,t.unlock()},destroy:function(){var e=this,n=e.eventNS,i=e.revertSettings;
e.trigger("destroy"),e.off(),e.$wrapper.remove(),e.$dropdown.remove(),e.$input.html("").append(i.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:i.tabindex}).show(),e.$control_input.removeData("grow"),e.$input.removeData("selectize"),t(window).off(n),t(document).off(n),t(document.body).off(n),delete e.$input[0].selectize},render:function(t,e){var n,i,o="",r=!1,s=this,a=/^[\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;return("option"===t||"item"===t)&&(n=S(e[s.settings.valueField]),r=!!n),r&&(C(s.renderCache[t])||(s.renderCache[t]={}),s.renderCache[t].hasOwnProperty(n))?s.renderCache[t][n]:(o=s.settings.render[t].apply(this,[e,x]),("option"===t||"option_create"===t)&&(o=o.replace(a,"<$1 data-selectable")),"optgroup"===t&&(i=e[s.settings.optgroupValueField]||"",o=o.replace(a,'<$1 data-group="'+E(x(i))+'"')),("option"===t||"item"===t)&&(o=o.replace(a,'<$1 data-value="'+E(x(n||""))+'"')),r&&(s.renderCache[t][n]=o),o)},clearCache:function(t){var e=this;"undefined"==typeof t?e.renderCache={}:delete e.renderCache[t]},canCreate:function(t){var e=this;if(!e.settings.create)return!1;var n=e.settings.createFilter;return!(!t.length||"function"==typeof n&&!n.apply(e,[t])||"string"==typeof n&&!new RegExp(n).test(t)||n instanceof RegExp&&!n.test(t))}}),L.count=0,L.defaults={plugins:[],delimiter:",",persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",optgroupOrder:null,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},t.fn.selectize=function(e){var n=t.fn.selectize.defaults,i=t.extend({},n,e),o=i.dataAttr,r=i.labelField,s=i.valueField,a=i.optgroupField,u=i.optgroupLabelField,l=i.optgroupValueField,c=function(e,n){var o,a,u,l,c=t.trim(e.val()||"");if(i.allowEmptyOption||c.length){for(u=c.split(i.delimiter),o=0,a=u.length;a>o;o++)l={},l[r]=u[o],l[s]=u[o],n.options[u[o]]=l;n.items=u}},d=function(e,n){var c,d,h,p,f=0,m=n.options,g=function(t){var e=o&&t.attr(o);return"string"==typeof e&&e.length?JSON.parse(e):null},b=function(e,o){var u,l;if(e=t(e),u=e.attr("value")||"",u.length||i.allowEmptyOption){if(m.hasOwnProperty(u))return void(o&&(m[u].optgroup?t.isArray(m[u].optgroup)?m[u].optgroup.push(o):m[u].optgroup=[m[u].optgroup,o]:m[u].optgroup=o));l=g(e)||{},l[r]=l[r]||e.text(),l[s]=l[s]||u,l[a]=l[a]||o,l.$order=++f,m[u]=l,e.is(":selected")&&n.items.push(u)}},_=function(e){var i,o,r,s,a;for(e=t(e),r=e.attr("label"),r&&(s=g(e)||{},s[u]=r,s[l]=r,n.optgroups[r]=s),a=t("option",e),i=0,o=a.length;o>i;i++)b(a[i],r)};for(n.maxItems=e.attr("multiple")?null:1,p=e.children(),c=0,d=p.length;d>c;c++)h=p[c].tagName.toLowerCase(),"optgroup"===h?_(p[c]):"option"===h&&b(p[c])};return this.each(function(){if(!this.selectize){var o,r=t(this),s=this.tagName.toLowerCase(),a=r.attr("placeholder")||r.attr("data-placeholder");a||i.allowEmptyOption||(a=r.children('option[value=""]').text());var u={placeholder:a,options:{},optgroups:{},items:[]};"select"===s?d(r,u):c(r,u),o=new L(r,t.extend(!0,{},n,u,e))}})},t.fn.selectize.defaults=L.defaults,L.define("drag_drop",function(){if(!t.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var e=this;e.lock=function(){var t=e.lock;return function(){var n=e.$control.data("sortable");return n&&n.disable(),t.apply(e,arguments)}}(),e.unlock=function(){var t=e.unlock;return function(){var n=e.$control.data("sortable");return n&&n.enable(),t.apply(e,arguments)}}(),e.setup=function(){var n=e.setup;return function(){n.apply(this,arguments);var i=e.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:e.isLocked,start:function(t,e){e.placeholder.css("width",e.helper.css("width")),i.css({overflow:"visible"})},stop:function(){i.css({overflow:"hidden"});var n=e.$activeItems?e.$activeItems.slice():null,o=[];i.children("[data-value]").each(function(){o.push(t(this).attr("data-value"))}),e.setValue(o),e.setActiveItem(n)}})}}()}}),L.define("dropdown_header",function(e){var n=this;e=t.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(t){return'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a href="javascript:void(0)" class="'+t.closeClass+'">&times;</a></div></div>'}},e),n.setup=function(){var i=n.setup;return function(){i.apply(n,arguments),n.$dropdown_header=t(e.html(e)),n.$dropdown.prepend(n.$dropdown_header)}}()}),L.define("optgroup_columns",function(e){var n=this;e=t.extend({equalizeWidth:!0,equalizeHeight:!0},e),this.getAdjacentOption=function(e,n){var i=e.closest("[data-group]").find("[data-selectable]"),o=i.index(e)+n;return o>=0&&o<i.length?i.eq(o):t()},this.onKeyDown=function(){var t=n.onKeyDown;return function(e){var i,o,r,s;return!this.isOpen||e.keyCode!==l&&e.keyCode!==h?t.apply(this,arguments):(n.ignoreHover=!0,s=this.$activeOption.closest("[data-group]"),i=s.find("[data-selectable]").index(this.$activeOption),s=e.keyCode===l?s.prev("[data-group]"):s.next("[data-group]"),r=s.find("[data-selectable]"),o=r.eq(Math.min(r.length-1,i)),void(o.length&&this.setActiveOption(o)))}}();var i=function(){var t,e=i.width,n=document;return"undefined"==typeof e&&(t=n.createElement("div"),t.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',t=t.firstChild,n.body.appendChild(t),e=i.width=t.offsetWidth-t.clientWidth,n.body.removeChild(t)),e},o=function(){var o,r,s,a,u,l,c;if(c=t("[data-group]",n.$dropdown_content),r=c.length,r&&n.$dropdown_content.width()){if(e.equalizeHeight){for(s=0,o=0;r>o;o++)s=Math.max(s,c.eq(o).height());c.css({height:s})}e.equalizeWidth&&(l=n.$dropdown_content.innerWidth()-i(),a=Math.round(l/r),c.css({width:a}),r>1&&(u=l-a*(r-1),c.eq(r-1).css({width:u})))}};(e.equalizeHeight||e.equalizeWidth)&&(P.after(this,"positionDropdown",o),P.after(this,"refreshOptions",o))}),L.define("remove_button",function(e){if("single"!==this.settings.mode){e=t.extend({label:"&times;",title:"Remove",className:"remove",append:!0},e);var n=this,i='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+x(e.title)+'">'+e.label+"</a>",o=function(t,e){var n=t.search(/(<\/[^>]+>\s*)$/);return t.substring(0,n)+e+t.substring(n)};this.setup=function(){var r=n.setup;return function(){if(e.append){var s=n.settings.render.item;n.settings.render.item=function(){return o(s.apply(this,arguments),i)}}r.apply(this,arguments),this.$control.on("click","."+e.className,function(e){if(e.preventDefault(),!n.isLocked){var i=t(e.currentTarget).parent();n.setActiveItem(i),n.deleteSelection()&&n.setCaret(n.items.length)}})}}()}}),L.define("restore_on_backspace",function(t){var e=this;t.text=t.text||function(t){return t[this.settings.labelField]},this.onKeyDown=function(){var n=e.onKeyDown;return function(e){var i,o;return e.keyCode===m&&""===this.$control_input.val()&&!this.$activeItems.length&&(i=this.caretPos-1,i>=0&&i<this.items.length)?(o=this.options[this.items[i]],this.deleteSelection(e)&&(this.setTextboxValue(t.text.apply(this,[o])),this.refreshOptions(!0)),void e.preventDefault()):n.apply(this,arguments)}}()}),L}),function(t,e,n){"use strict";function i(n){if(o=e.documentElement,r=e.body,z(),st=this,n=n||{},dt=n.constants||{},n.easing)for(var i in n.easing)Q[i]=n.easing[i];_t=n.edgeStrategy||"set",lt={beforerender:n.beforerender,render:n.render,keyframe:n.keyframe},ct=n.forceHeight!==!1,ct&&(Dt=n.scale||1),ht=n.mobileDeceleration||S,ft=n.smoothScrolling!==!1,mt=n.smoothScrollingDuration||x,gt={targetTop:st.getScrollTop()},Ht=(n.mobileCheck||function(){return/Android|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent||navigator.vendor||t.opera)})(),Ht?(ut=e.getElementById("skrollr-body"),ut&&rt(),Y(),It(o,[_,w],[y])):It(o,[_,v],[y]),st.refresh(),wt(t,"resize orientationchange",function(){var t=o.clientWidth,e=o.clientHeight;(e!==jt||t!==Nt)&&(jt=e,Nt=t,Ut=!0)});var s=q();return function a(){J(),vt=s(a)}(),st}var o,r,s={get:function(){return st},init:function(t){return st||new i(t)},VERSION:"0.6.26"},a=Object.prototype.hasOwnProperty,u=t.Math,l=t.getComputedStyle,c="touchstart",d="touchmove",h="touchcancel",p="touchend",f="skrollable",m=f+"-before",g=f+"-between",b=f+"-after",_="skrollr",y="no-"+_,v=_+"-desktop",w=_+"-mobile",k="linear",C=1e3,S=.004,x=200,E="start",P="end",T="center",I="bottom",A="___skrollable_id",B=/^(?:input|textarea|button|select)$/i,O=/^\s+|\s+$/g,M=/^data(?:-(_\w+))?(?:-?(-?\d*\.?\d+p?))?(?:-?(start|end|top|center|bottom))?(?:-?(top|center|bottom))?$/,$=/\s*(@?[\w\-\[\]]+)\s*:\s*(.+?)\s*(?:;|$)/gi,D=/^(@?[a-z\-]+)\[(\w+)\]$/,R=/-([a-z0-9_])/g,L=function(t,e){return e.toUpperCase()},F=/[\-+]?[\d]*\.?[\d]+/g,N=/\{\?\}/g,j=/rgba?\(\s*-?\d+\s*,\s*-?\d+\s*,\s*-?\d+/g,U=/[a-z\-]+-gradient/g,V="",H="",z=function(){var t=/^(?:O|Moz|webkit|ms)|(?:-(?:o|moz|webkit|ms)-)/;if(l){var e=l(r,null);for(var i in e)if(V=i.match(t)||+i==i&&e[i].match(t))break;if(!V)return V=H="",n;V=V[0],"-"===V.slice(0,1)?(H=V,V={"-webkit-":"webkit","-moz-":"Moz","-ms-":"ms","-o-":"O"}[V]):H="-"+V.toLowerCase()+"-"}},q=function(){var e=t.requestAnimationFrame||t[V.toLowerCase()+"RequestAnimationFrame"],n=Ot();return(Ht||!e)&&(e=function(e){var i=Ot()-n,o=u.max(0,1e3/60-i);return t.setTimeout(function(){n=Ot(),e()},o)}),e},W=function(){var e=t.cancelAnimationFrame||t[V.toLowerCase()+"CancelAnimationFrame"];return(Ht||!e)&&(e=function(e){return t.clearTimeout(e)}),e},Q={begin:function(){return 0},end:function(){return 1},linear:function(t){return t},quadratic:function(t){return t*t},cubic:function(t){return t*t*t},swing:function(t){return-u.cos(t*u.PI)/2+.5},sqrt:function(t){return u.sqrt(t)},outCubic:function(t){return u.pow(t-1,3)+1},bounce:function(t){var e;if(.5083>=t)e=3;else if(.8489>=t)e=9;else if(.96208>=t)e=27;else{if(!(.99981>=t))return 1;e=91}return 1-u.abs(3*u.cos(1.028*t*e)/e)}};i.prototype.refresh=function(t){var i,o,r=!1;for(t===n?(r=!0,at=[],Vt=0,t=e.getElementsByTagName("*")):t.length===n&&(t=[t]),i=0,o=t.length;o>i;i++){var s=t[i],a=s,u=[],l=ft,c=_t,d=!1;if(r&&A in s&&delete s[A],s.attributes){for(var h=0,p=s.attributes.length;p>h;h++){var m=s.attributes[h];if("data-anchor-target"!==m.name)if("data-smooth-scrolling"!==m.name)if("data-edge-strategy"!==m.name)if("data-emit-events"!==m.name){var g=m.name.match(M);if(null!==g){var b={props:m.value,element:s,eventType:m.name.replace(R,L)};u.push(b);var _=g[1];_&&(b.constant=_.substr(1));var y=g[2];/p$/.test(y)?(b.isPercentage=!0,b.offset=(0|y.slice(0,-1))/100):b.offset=0|y;var v=g[3],w=g[4]||v;v&&v!==E&&v!==P?(b.mode="relative",b.anchors=[v,w]):(b.mode="absolute",v===P?b.isEnd=!0:b.isPercentage||(b.offset=b.offset*Dt))}}else d=!0;else c=m.value;else l="off"!==m.value;else if(a=e.querySelector(m.value),null===a)throw'Unable to find anchor target "'+m.value+'"'}if(u.length){var k,C,S;!r&&A in s?(S=s[A],k=at[S].styleAttr,C=at[S].classAttr):(S=s[A]=Vt++,k=s.style.cssText,C=Tt(s)),at[S]={element:s,styleAttr:k,classAttr:C,anchorTarget:a,keyFrames:u,smoothScrolling:l,edgeStrategy:c,emitEvents:d,lastFrameIndex:-1},It(s,[f],[])}}}for(xt(),i=0,o=t.length;o>i;i++){var x=at[t[i][A]];x!==n&&(X(x),tt(x))}return st},i.prototype.relativeToAbsolute=function(t,e,n){var i=o.clientHeight,r=t.getBoundingClientRect(),s=r.top,a=r.bottom-r.top;return e===I?s-=i:e===T&&(s-=i/2),n===I?s+=a:n===T&&(s+=a/2),s+=st.getScrollTop(),0|s+.5},i.prototype.animateTo=function(t,e){e=e||{};var i=Ot(),o=st.getScrollTop();return pt={startTop:o,topDiff:t-o,targetTop:t,duration:e.duration||C,startTime:i,endTime:i+(e.duration||C),easing:Q[e.easing||k],done:e.done},pt.topDiff||(pt.done&&pt.done.call(st,!1),pt=n),st},i.prototype.stopAnimateTo=function(){pt&&pt.done&&pt.done.call(st,!0),pt=n},i.prototype.isAnimatingTo=function(){return!!pt},i.prototype.isMobile=function(){return Ht},i.prototype.setScrollTop=function(e,n){return bt=n===!0,Ht?zt=u.min(u.max(e,0),$t):t.scrollTo(0,e),st},i.prototype.getScrollTop=function(){return Ht?zt:t.pageYOffset||o.scrollTop||r.scrollTop||0},i.prototype.getMaxScrollTop=function(){return $t},i.prototype.on=function(t,e){return lt[t]=e,st},i.prototype.off=function(t){return delete lt[t],st},i.prototype.destroy=function(){var t=W();t(vt),Ct(),It(o,[y],[_,v,w]);for(var e=0,i=at.length;i>e;e++)ot(at[e].element);o.style.overflow=r.style.overflow="",o.style.height=r.style.height="",ut&&s.setStyle(ut,"transform","none"),st=n,ut=n,lt=n,ct=n,$t=0,Dt=1,dt=n,ht=n,Rt="down",Lt=-1,Nt=0,jt=0,Ut=!1,pt=n,ft=n,mt=n,gt=n,bt=n,Vt=0,_t=n,Ht=!1,zt=0,yt=n};var Y=function(){var i,s,a,l,f,m,g,b,_,y,v,w;wt(o,[c,d,h,p].join(" "),function(t){var o=t.changedTouches[0];for(l=t.target;3===l.nodeType;)l=l.parentNode;switch(f=o.clientY,m=o.clientX,y=t.timeStamp,B.test(l.tagName)||t.preventDefault(),t.type){case c:i&&i.blur(),st.stopAnimateTo(),i=l,s=g=f,a=m,_=y;break;case d:B.test(l.tagName)&&e.activeElement!==l&&t.preventDefault(),b=f-g,w=y-v,st.setScrollTop(zt-b,!0),g=f,v=y;break;default:case h:case p:var r=s-f,k=a-m,C=k*k+r*r;if(49>C){if(!B.test(i.tagName)){i.focus();var S=e.createEvent("MouseEvents");S.initMouseEvent("click",!0,!0,t.view,1,o.screenX,o.screenY,o.clientX,o.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null),i.dispatchEvent(S)}return}i=n;var x=b/w;x=u.max(u.min(x,3),-3);var E=u.abs(x/ht),P=x*E+.5*ht*E*E,T=st.getScrollTop()-P,I=0;T>$t?(I=($t-T)/P,T=$t):0>T&&(I=-T/P,T=0),E*=1-I,st.animateTo(0|T+.5,{easing:"outCubic",duration:E})}}),t.scrollTo(0,0),o.style.overflow=r.style.overflow="hidden"},G=function(){var t,e,n,i,r,s,a,l,c,d,h,p=o.clientHeight,f=Et();for(l=0,c=at.length;c>l;l++)for(t=at[l],e=t.element,n=t.anchorTarget,i=t.keyFrames,r=0,s=i.length;s>r;r++)a=i[r],d=a.offset,h=f[a.constant]||0,a.frame=d,a.isPercentage&&(d*=p,a.frame=d),"relative"===a.mode&&(ot(e),a.frame=st.relativeToAbsolute(n,a.anchors[0],a.anchors[1])-d,ot(e,!0)),a.frame+=h,ct&&!a.isEnd&&a.frame>$t&&($t=a.frame);for($t=u.max($t,Pt()),l=0,c=at.length;c>l;l++){for(t=at[l],i=t.keyFrames,r=0,s=i.length;s>r;r++)a=i[r],h=f[a.constant]||0,a.isEnd&&(a.frame=$t-a.offset+h);t.keyFrames.sort(Mt)}},K=function(t,e){for(var n=0,i=at.length;i>n;n++){var o,r,u=at[n],l=u.element,c=u.smoothScrolling?t:e,d=u.keyFrames,h=d.length,p=d[0],_=d[d.length-1],y=p.frame>c,v=c>_.frame,w=y?p:_,k=u.emitEvents,C=u.lastFrameIndex;if(y||v){if(y&&-1===u.edge||v&&1===u.edge)continue;switch(y?(It(l,[m],[b,g]),k&&C>-1&&(St(l,p.eventType,Rt),u.lastFrameIndex=-1)):(It(l,[b],[m,g]),k&&h>C&&(St(l,_.eventType,Rt),u.lastFrameIndex=h)),u.edge=y?-1:1,u.edgeStrategy){case"reset":ot(l);continue;case"ease":c=w.frame;break;default:case"set":var S=w.props;for(o in S)a.call(S,o)&&(r=it(S[o].value),0===o.indexOf("@")?l.setAttribute(o.substr(1),r):s.setStyle(l,o,r));continue}}else 0!==u.edge&&(It(l,[f,g],[m,b]),u.edge=0);for(var x=0;h-1>x;x++)if(c>=d[x].frame&&d[x+1].frame>=c){var E=d[x],P=d[x+1];for(o in E.props)if(a.call(E.props,o)){var T=(c-E.frame)/(P.frame-E.frame);T=E.props[o].easing(T),r=nt(E.props[o].value,P.props[o].value,T),r=it(r),0===o.indexOf("@")?l.setAttribute(o.substr(1),r):s.setStyle(l,o,r)}k&&C!==x&&("down"===Rt?St(l,E.eventType,Rt):St(l,P.eventType,Rt),u.lastFrameIndex=x);break}}},J=function(){Ut&&(Ut=!1,xt());var t,e,i=st.getScrollTop(),o=Ot();if(pt)o>=pt.endTime?(i=pt.targetTop,t=pt.done,pt=n):(e=pt.easing((o-pt.startTime)/pt.duration),i=0|pt.startTop+e*pt.topDiff),st.setScrollTop(i,!0);else if(!bt){var r=gt.targetTop-i;r&&(gt={startTop:Lt,topDiff:i-Lt,targetTop:i,startTime:Ft,endTime:Ft+mt}),gt.endTime>=o&&(e=Q.sqrt((o-gt.startTime)/mt),i=0|gt.startTop+e*gt.topDiff)}if(Ht&&ut&&s.setStyle(ut,"transform","translate(0, "+-zt+"px) "+yt),bt||Lt!==i){Rt=i>Lt?"down":Lt>i?"up":Rt,bt=!1;var a={curTop:i,lastTop:Lt,maxTop:$t,direction:Rt},u=lt.beforerender&&lt.beforerender.call(st,a);u!==!1&&(K(i,st.getScrollTop()),Lt=i,lt.render&&lt.render.call(st,a)),t&&t.call(st,!1)}Ft=o},X=function(t){for(var e=0,n=t.keyFrames.length;n>e;e++){for(var i,o,r,s,a=t.keyFrames[e],u={};null!==(s=$.exec(a.props));)r=s[1],o=s[2],i=r.match(D),null!==i?(r=i[1],i=i[2]):i=k,o=o.indexOf("!")?Z(o):[o.slice(1)],u[r]={value:o,easing:Q[i]};a.props=u}},Z=function(t){var e=[];return j.lastIndex=0,t=t.replace(j,function(t){return t.replace(F,function(t){return 100*(t/255)+"%"})}),H&&(U.lastIndex=0,t=t.replace(U,function(t){return H+t})),t=t.replace(F,function(t){return e.push(+t),"{?}"}),e.unshift(t),e},tt=function(t){var e,n,i={};for(e=0,n=t.keyFrames.length;n>e;e++)et(t.keyFrames[e],i);for(i={},e=t.keyFrames.length-1;e>=0;e--)et(t.keyFrames[e],i)},et=function(t,e){var n;for(n in e)a.call(t.props,n)||(t.props[n]=e[n]);for(n in t.props)e[n]=t.props[n]},nt=function(t,e,n){var i,o=t.length;if(o!==e.length)throw"Can't interpolate between \""+t[0]+'" and "'+e[0]+'"';var r=[t[0]];for(i=1;o>i;i++)r[i]=t[i]+(e[i]-t[i])*n;return r},it=function(t){var e=1;return N.lastIndex=0,t[0].replace(N,function(){return t[e++]})},ot=function(t,e){t=[].concat(t);for(var n,i,o=0,r=t.length;r>o;o++)i=t[o],n=at[i[A]],n&&(e?(i.style.cssText=n.dirtyStyleAttr,It(i,n.dirtyClassAttr)):(n.dirtyStyleAttr=i.style.cssText,n.dirtyClassAttr=Tt(i),i.style.cssText=n.styleAttr,It(i,n.classAttr)))},rt=function(){yt="translateZ(0)",s.setStyle(ut,"transform",yt);var t=l(ut),e=t.getPropertyValue("transform"),n=t.getPropertyValue(H+"transform"),i=e&&"none"!==e||n&&"none"!==n;i||(yt="")};s.setStyle=function(t,e,n){var i=t.style;if(e=e.replace(R,L).replace("-",""),"zIndex"===e)i[e]=isNaN(n)?n:""+(0|n);else if("float"===e)i.styleFloat=i.cssFloat=n;else try{V&&(i[V+e.slice(0,1).toUpperCase()+e.slice(1)]=n),i[e]=n}catch(o){}};var st,at,ut,lt,ct,dt,ht,pt,ft,mt,gt,bt,_t,yt,vt,wt=s.addEvent=function(e,n,i){var o=function(e){return e=e||t.event,e.target||(e.target=e.srcElement),e.preventDefault||(e.preventDefault=function(){e.returnValue=!1,e.defaultPrevented=!0}),i.call(this,e)};n=n.split(" ");for(var r,s=0,a=n.length;a>s;s++)r=n[s],e.addEventListener?e.addEventListener(r,i,!1):e.attachEvent("on"+r,o),qt.push({element:e,name:r,listener:i})},kt=s.removeEvent=function(t,e,n){e=e.split(" ");for(var i=0,o=e.length;o>i;i++)t.removeEventListener?t.removeEventListener(e[i],n,!1):t.detachEvent("on"+e[i],n)},Ct=function(){for(var t,e=0,n=qt.length;n>e;e++)t=qt[e],kt(t.element,t.name,t.listener);qt=[]},St=function(t,e,n){lt.keyframe&&lt.keyframe.call(st,t,e,n)},xt=function(){var t=st.getScrollTop();$t=0,ct&&!Ht&&(r.style.height=""),G(),ct&&!Ht&&(r.style.height=$t+o.clientHeight+"px"),Ht?st.setScrollTop(u.min(st.getScrollTop(),$t)):st.setScrollTop(t,!0),bt=!0},Et=function(){var t,e,n=o.clientHeight,i={};for(t in dt)e=dt[t],"function"==typeof e?e=e.call(st):/p$/.test(e)&&(e=e.slice(0,-1)/100*n),i[t]=e;return i},Pt=function(){var t=ut&&ut.offsetHeight||0,e=u.max(t,r.scrollHeight,r.offsetHeight,o.scrollHeight,o.offsetHeight,o.clientHeight);return e-o.clientHeight},Tt=function(e){var n="className";return t.SVGElement&&e instanceof t.SVGElement&&(e=e[n],n="baseVal"),e[n]},It=function(e,i,o){var r="className";if(t.SVGElement&&e instanceof t.SVGElement&&(e=e[r],r="baseVal"),o===n)return e[r]=i,n;for(var s=e[r],a=0,u=o.length;u>a;a++)s=Bt(s).replace(Bt(o[a])," ");s=At(s);for(var l=0,c=i.length;c>l;l++)-1===Bt(s).indexOf(Bt(i[l]))&&(s+=" "+i[l]);e[r]=At(s)},At=function(t){return t.replace(O,"")},Bt=function(t){return" "+t+" "},Ot=Date.now||function(){return+new Date},Mt=function(t,e){return t.frame-e.frame},$t=0,Dt=1,Rt="down",Lt=-1,Ft=Ot(),Nt=0,jt=0,Ut=!1,Vt=0,Ht=!1,zt=0,qt=[];"function"==typeof define&&define.amd?define("skrollr",function(){return s}):"undefined"!=typeof module&&module.exports?module.exports=s:t.skrollr=s}(window,document),!function(t){function e(t){var e=t.length,i=n.type(t);return"function"===i||n.isWindow(t)?!1:1===t.nodeType&&e?!0:"array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t}if(!t.jQuery){var n=function(t,e){return new n.fn.init(t,e)};n.isWindow=function(t){return null!=t&&t==t.window},n.type=function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?o[s.call(t)]||"object":typeof t},n.isArray=Array.isArray||function(t){return"array"===n.type(t)},n.isPlainObject=function(t){var e;if(!t||"object"!==n.type(t)||t.nodeType||n.isWindow(t))return!1;try{if(t.constructor&&!r.call(t,"constructor")&&!r.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}for(e in t);return void 0===e||r.call(t,e)},n.each=function(t,n,i){var o,r=0,s=t.length,a=e(t);if(i){if(a)for(;s>r&&(o=n.apply(t[r],i),o!==!1);r++);else for(r in t)if(o=n.apply(t[r],i),o===!1)break}else if(a)for(;s>r&&(o=n.call(t[r],r,t[r]),o!==!1);r++);else for(r in t)if(o=n.call(t[r],r,t[r]),o===!1)break;return t},n.data=function(t,e,o){if(void 0===o){var r=t[n.expando],s=r&&i[r];if(void 0===e)return s;if(s&&e in s)return s[e]}else if(void 0!==e){var r=t[n.expando]||(t[n.expando]=++n.uuid);return i[r]=i[r]||{},i[r][e]=o,o}},n.removeData=function(t,e){var o=t[n.expando],r=o&&i[o];r&&n.each(e,function(t,e){delete r[e]})},n.extend=function(){var t,e,i,o,r,s,a=arguments[0]||{},u=1,l=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[u]||{},u++),"object"!=typeof a&&"function"!==n.type(a)&&(a={}),u===l&&(a=this,u--);l>u;u++)if(null!=(r=arguments[u]))for(o in r)t=a[o],i=r[o],a!==i&&(c&&i&&(n.isPlainObject(i)||(e=n.isArray(i)))?(e?(e=!1,s=t&&n.isArray(t)?t:[]):s=t&&n.isPlainObject(t)?t:{},a[o]=n.extend(c,s,i)):void 0!==i&&(a[o]=i));return a},n.queue=function(t,i,o){function r(t,n){var i=n||[];return null!=t&&(e(Object(t))?!function(t,e){for(var n=+e.length,i=0,o=t.length;n>i;)t[o++]=e[i++];if(n!==n)for(;void 0!==e[i];)t[o++]=e[i++];return t.length=o,t}(i,"string"==typeof t?[t]:t):[].push.call(i,t)),i}if(t){i=(i||"fx")+"queue";var s=n.data(t,i);return o?(!s||n.isArray(o)?s=n.data(t,i,r(o)):s.push(o),s):s||[]}},n.dequeue=function(t,e){n.each(t.nodeType?[t]:t,function(t,i){e=e||"fx";var o=n.queue(i,e),r=o.shift();"inprogress"===r&&(r=o.shift()),r&&("fx"===e&&o.unshift("inprogress"),r.call(i,function(){n.dequeue(i,e)}))})},n.fn=n.prototype={init:function(t){if(t.nodeType)return this[0]=t,this;throw new Error("Not a DOM node.")},offset:function(){var e=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:e.top+(t.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:e.left+(t.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function t(){for(var t=this.offsetParent||document;t&&"html"===!t.nodeType.toLowerCase&&"static"===t.style.position;)t=t.offsetParent;return t||document}var e=this[0],t=t.apply(e),i=this.offset(),o=/^(?:body|html)$/i.test(t.nodeName)?{top:0,left:0}:n(t).offset();return i.top-=parseFloat(e.style.marginTop)||0,i.left-=parseFloat(e.style.marginLeft)||0,t.style&&(o.top+=parseFloat(t.style.borderTopWidth)||0,o.left+=parseFloat(t.style.borderLeftWidth)||0),{top:i.top-o.top,left:i.left-o.left}}};var i={};n.expando="velocity"+(new Date).getTime(),n.uuid=0;for(var o={},r=o.hasOwnProperty,s=o.toString,a="Boolean Number String Function Array Date RegExp Object Error".split(" "),u=0;u<a.length;u++)o["[object "+a[u]+"]"]=a[u].toLowerCase();n.fn.init.prototype=n.fn,t.Velocity={Utilities:n}}}(window),function(t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):t()}(function(){return function(t,e,n,i){function o(t){for(var e=-1,n=t?t.length:0,i=[];++e<n;){var o=t[e];o&&i.push(o)}return i}function r(t){return m.isWrapped(t)?t=[].slice.call(t):m.isNode(t)&&(t=[t]),t}function s(t){var e=h.data(t,"velocity");return null===e?i:e}function a(t){return function(e){return Math.round(e*t)*(1/t)}}function u(t,n,i,o){function r(t,e){return 1-3*e+3*t}function s(t,e){return 3*e-6*t}function a(t){return 3*t}function u(t,e,n){return((r(e,n)*t+s(e,n))*t+a(e))*t}function l(t,e,n){return 3*r(e,n)*t*t+2*s(e,n)*t+a(e)}function c(e,n){for(var o=0;m>o;++o){var r=l(n,t,i);if(0===r)return n;var s=u(n,t,i)-e;n-=s/r}return n}function d(){for(var e=0;y>e;++e)C[e]=u(e*v,t,i)}function h(e,n,o){var r,s,a=0;do s=n+(o-n)/2,r=u(s,t,i)-e,r>0?o=s:n=s;while(Math.abs(r)>b&&++a<_);return s}function p(e){for(var n=0,o=1,r=y-1;o!=r&&C[o]<=e;++o)n+=v;--o;var s=(e-C[o])/(C[o+1]-C[o]),a=n+s*v,u=l(a,t,i);return u>=g?c(e,a):0==u?a:h(e,n,n+v)}function f(){S=!0,(t!=n||i!=o)&&d()}var m=4,g=.001,b=1e-7,_=10,y=11,v=1/(y-1),w="Float32Array"in e;if(4!==arguments.length)return!1;for(var k=0;4>k;++k)if("number"!=typeof arguments[k]||isNaN(arguments[k])||!isFinite(arguments[k]))return!1;t=Math.min(t,1),i=Math.min(i,1),t=Math.max(t,0),i=Math.max(i,0);var C=w?new Float32Array(y):new Array(y),S=!1,x=function(e){return S||f(),t===n&&i===o?e:0===e?0:1===e?1:u(p(e),n,o)};x.getControlPoints=function(){return[{x:t,y:n},{x:i,y:o}]};var E="generateBezier("+[t,n,i,o]+")";return x.toString=function(){return E},x}function l(t,e){var n=t;return m.isString(t)?y.Easings[t]||(n=!1):n=m.isArray(t)&&1===t.length?a.apply(null,t):m.isArray(t)&&2===t.length?v.apply(null,t.concat([e])):m.isArray(t)&&4===t.length?u.apply(null,t):!1,n===!1&&(n=y.Easings[y.defaults.easing]?y.defaults.easing:_),n}function c(t){if(t){var e=(new Date).getTime(),n=y.State.calls.length;n>1e4&&(y.State.calls=o(y.State.calls));for(var r=0;n>r;r++)if(y.State.calls[r]){var a=y.State.calls[r],u=a[0],l=a[2],p=a[3],f=!!p,g=null;p||(p=y.State.calls[r][3]=e-16);for(var b=Math.min((e-p)/l.duration,1),_=0,v=u.length;v>_;_++){var k=u[_],S=k.element;if(s(S)){var x=!1;if(l.display!==i&&null!==l.display&&"none"!==l.display){if("flex"===l.display){var E=["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"];h.each(E,function(t,e){w.setPropertyValue(S,"display",e)})}w.setPropertyValue(S,"display",l.display)}l.visibility!==i&&"hidden"!==l.visibility&&w.setPropertyValue(S,"visibility",l.visibility);for(var P in k)if("element"!==P){var T,I=k[P],A=m.isString(I.easing)?y.Easings[I.easing]:I.easing;if(1===b)T=I.endValue;else{var B=I.endValue-I.startValue;if(T=I.startValue+B*A(b,l,B),!f&&T===I.currentValue)continue}if(I.currentValue=T,"tween"===P)g=T;else{if(w.Hooks.registered[P]){var O=w.Hooks.getRoot(P),M=s(S).rootPropertyValueCache[O];M&&(I.rootPropertyValue=M)}var $=w.setPropertyValue(S,P,I.currentValue+(0===parseFloat(T)?"":I.unitType),I.rootPropertyValue,I.scrollData);w.Hooks.registered[P]&&(s(S).rootPropertyValueCache[O]=w.Normalizations.registered[O]?w.Normalizations.registered[O]("extract",null,$[1]):$[1]),"transform"===$[0]&&(x=!0)}}l.mobileHA&&s(S).transformCache.translate3d===i&&(s(S).transformCache.translate3d="(0px, 0px, 0px)",x=!0),x&&w.flushTransformCache(S)}}l.display!==i&&"none"!==l.display&&(y.State.calls[r][2].display=!1),l.visibility!==i&&"hidden"!==l.visibility&&(y.State.calls[r][2].visibility=!1),l.progress&&l.progress.call(a[1],a[1],b,Math.max(0,p+l.duration-e),p,g),1===b&&d(r)}}y.State.isTicking&&C(c)}function d(t,e){if(!y.State.calls[t])return!1;for(var n=y.State.calls[t][0],o=y.State.calls[t][1],r=y.State.calls[t][2],a=y.State.calls[t][4],u=!1,l=0,c=n.length;c>l;l++){var d=n[l].element;if(e||r.loop||("none"===r.display&&w.setPropertyValue(d,"display",r.display),"hidden"===r.visibility&&w.setPropertyValue(d,"visibility",r.visibility)),r.loop!==!0&&(h.queue(d)[1]===i||!/\.velocityQueueEntryFlag/i.test(h.queue(d)[1]))&&s(d)){s(d).isAnimating=!1,s(d).rootPropertyValueCache={};var p=!1;h.each(w.Lists.transforms3D,function(t,e){var n=/^scale/.test(e)?1:0,o=s(d).transformCache[e];s(d).transformCache[e]!==i&&new RegExp("^\\("+n+"[^.]").test(o)&&(p=!0,delete s(d).transformCache[e])}),r.mobileHA&&(p=!0,delete s(d).transformCache.translate3d),p&&w.flushTransformCache(d),w.Values.removeClass(d,"velocity-animating")}if(!e&&r.complete&&!r.loop&&l===c-1)try{r.complete.call(o,o)}catch(f){setTimeout(function(){throw f},1)}a&&r.loop!==!0&&a(o),s(d)&&r.loop===!0&&!e&&(h.each(s(d).tweensContainer,function(t,e){/^rotate/.test(t)&&360===parseFloat(e.endValue)&&(e.endValue=0,e.startValue=360),/^backgroundPosition/.test(t)&&100===parseFloat(e.endValue)&&"%"===e.unitType&&(e.endValue=0,e.startValue=100)}),y(d,"reverse",{loop:!0,delay:r.delay})),r.queue!==!1&&h.dequeue(d,r.queue)}y.State.calls[t]=!1;for(var m=0,g=y.State.calls.length;g>m;m++)if(y.State.calls[m]!==!1){u=!0;break}u===!1&&(y.State.isTicking=!1,delete y.State.calls,y.State.calls=[])}var h,p=function(){if(n.documentMode)return n.documentMode;for(var t=7;t>4;t--){var e=n.createElement("div");if(e.innerHTML="<!--[if IE "+t+"]><span></span><![endif]-->",e.getElementsByTagName("span").length)return e=null,t}return i}(),f=function(){var t=0;return e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(e){var n,i=(new Date).getTime();return n=Math.max(0,16-(i-t)),t=i+n,setTimeout(function(){e(i+n)},n)}}(),m={isString:function(t){return"string"==typeof t},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)},isNode:function(t){return t&&t.nodeType},isNodeList:function(t){return"object"==typeof t&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(t))&&t.length!==i&&(0===t.length||"object"==typeof t[0]&&t[0].nodeType>0)},isWrapped:function(t){return t&&(t.jquery||e.Zepto&&e.Zepto.zepto.isZ(t))},isSVG:function(t){return e.SVGElement&&t instanceof e.SVGElement},isEmptyObject:function(t){for(var e in t)return!1;return!0}},g=!1;if(t.fn&&t.fn.jquery?(h=t,g=!0):h=e.Velocity.Utilities,8>=p&&!g)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if(7>=p)return void(jQuery.fn.velocity=jQuery.fn.animate);var b=400,_="swing",y={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:e.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:n.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[]},CSS:{},Utilities:h,Redirects:{},Easings:{},Promise:e.Promise,defaults:{queue:"",duration:b,easing:_,begin:i,complete:i,progress:i,display:i,visibility:i,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0},init:function(t){h.data(t,"velocity",{isSVG:m.isSVG(t),isAnimating:!1,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,minor:2,patch:2},debug:!1};e.pageYOffset!==i?(y.State.scrollAnchor=e,y.State.scrollPropertyLeft="pageXOffset",y.State.scrollPropertyTop="pageYOffset"):(y.State.scrollAnchor=n.documentElement||n.body.parentNode||n.body,y.State.scrollPropertyLeft="scrollLeft",y.State.scrollPropertyTop="scrollTop");var v=function(){function t(t){return-t.tension*t.x-t.friction*t.v}function e(e,n,i){var o={x:e.x+i.dx*n,v:e.v+i.dv*n,tension:e.tension,friction:e.friction};return{dx:o.v,dv:t(o)}}function n(n,i){var o={dx:n.v,dv:t(n)},r=e(n,.5*i,o),s=e(n,.5*i,r),a=e(n,i,s),u=1/6*(o.dx+2*(r.dx+s.dx)+a.dx),l=1/6*(o.dv+2*(r.dv+s.dv)+a.dv);return n.x=n.x+u*i,n.v=n.v+l*i,n}return function i(t,e,o){var r,s,a,u={x:-1,v:0,tension:null,friction:null},l=[0],c=0,d=1e-4,h=.016;for(t=parseFloat(t)||500,e=parseFloat(e)||20,o=o||null,u.tension=t,u.friction=e,r=null!==o,r?(c=i(t,e),s=c/o*h):s=h;a=n(a||u,s),l.push(1+a.x),c+=16,Math.abs(a.x)>d&&Math.abs(a.v)>d;);return r?function(t){return l[t*(l.length-1)|0];
}:c}}();y.Easings={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},spring:function(t){return 1-Math.cos(4.5*t*Math.PI)*Math.exp(6*-t)}},h.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(t,e){y.Easings[e[0]]=u.apply(null,e[1])});var w=y.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"]},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var t=0;t<w.Lists.colors.length;t++){var e="color"===w.Lists.colors[t]?"0 0 0 1":"255 255 255 1";w.Hooks.templates[w.Lists.colors[t]]=["Red Green Blue Alpha",e]}var n,i,o;if(p)for(n in w.Hooks.templates){i=w.Hooks.templates[n],o=i[0].split(" ");var r=i[1].match(w.RegEx.valueSplit);"Color"===o[0]&&(o.push(o.shift()),r.push(r.shift()),w.Hooks.templates[n]=[o.join(" "),r.join(" ")])}for(n in w.Hooks.templates){i=w.Hooks.templates[n],o=i[0].split(" ");for(var t in o){var s=n+o[t],a=t;w.Hooks.registered[s]=[n,a]}}},getRoot:function(t){var e=w.Hooks.registered[t];return e?e[0]:t},cleanRootPropertyValue:function(t,e){return w.RegEx.valueUnwrap.test(e)&&(e=e.match(w.RegEx.valueUnwrap)[1]),w.Values.isCSSNullValue(e)&&(e=w.Hooks.templates[t][1]),e},extractValue:function(t,e){var n=w.Hooks.registered[t];if(n){var i=n[0],o=n[1];return e=w.Hooks.cleanRootPropertyValue(i,e),e.toString().match(w.RegEx.valueSplit)[o]}return e},injectValue:function(t,e,n){var i=w.Hooks.registered[t];if(i){var o,r,s=i[0],a=i[1];return n=w.Hooks.cleanRootPropertyValue(s,n),o=n.toString().match(w.RegEx.valueSplit),o[a]=e,r=o.join(" ")}return n}},Normalizations:{registered:{clip:function(t,e,n){switch(t){case"name":return"clip";case"extract":var i;return w.RegEx.wrappedValueAlreadyExtracted.test(n)?i=n:(i=n.toString().match(w.RegEx.valueUnwrap),i=i?i[1].replace(/,(\s+)?/g," "):n),i;case"inject":return"rect("+n+")"}},blur:function(t,e,n){switch(t){case"name":return y.State.isFirefox?"filter":"-webkit-filter";case"extract":var i=parseFloat(n);if(!i&&0!==i){var o=n.toString().match(/blur\(([0-9]+[A-z]+)\)/i);i=o?o[1]:0}return i;case"inject":return parseFloat(n)?"blur("+n+")":"none"}},opacity:function(t,e,n){if(8>=p)switch(t){case"name":return"filter";case"extract":var i=n.toString().match(/alpha\(opacity=(.*)\)/i);return n=i?i[1]/100:1;case"inject":return e.style.zoom=1,parseFloat(n)>=1?"":"alpha(opacity="+parseInt(100*parseFloat(n),10)+")"}else switch(t){case"name":return"opacity";case"extract":return n;case"inject":return n}}},register:function(){9>=p||y.State.isGingerbread||(w.Lists.transformsBase=w.Lists.transformsBase.concat(w.Lists.transforms3D));for(var t=0;t<w.Lists.transformsBase.length;t++)!function(){var e=w.Lists.transformsBase[t];w.Normalizations.registered[e]=function(t,n,o){switch(t){case"name":return"transform";case"extract":return s(n)===i||s(n).transformCache[e]===i?/^scale/i.test(e)?1:0:s(n).transformCache[e].replace(/[()]/g,"");case"inject":var r=!1;switch(e.substr(0,e.length-1)){case"translate":r=!/(%|px|em|rem|vw|vh|\d)$/i.test(o);break;case"scal":case"scale":y.State.isAndroid&&s(n).transformCache[e]===i&&1>o&&(o=1),r=!/(\d)$/i.test(o);break;case"skew":r=!/(deg|\d)$/i.test(o);break;case"rotate":r=!/(deg|\d)$/i.test(o)}return r||(s(n).transformCache[e]="("+o+")"),s(n).transformCache[e]}}}();for(var t=0;t<w.Lists.colors.length;t++)!function(){var e=w.Lists.colors[t];w.Normalizations.registered[e]=function(t,n,o){switch(t){case"name":return e;case"extract":var r;if(w.RegEx.wrappedValueAlreadyExtracted.test(o))r=o;else{var s,a={black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",red:"rgb(255, 0, 0)",white:"rgb(255, 255, 255)"};/^[A-z]+$/i.test(o)?s=a[o]!==i?a[o]:a.black:w.RegEx.isHex.test(o)?s="rgb("+w.Values.hexToRgb(o).join(" ")+")":/^rgba?\(/i.test(o)||(s=a.black),r=(s||o).toString().match(w.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g," ")}return 8>=p||3!==r.split(" ").length||(r+=" 1"),r;case"inject":return 8>=p?4===o.split(" ").length&&(o=o.split(/\s+/).slice(0,3).join(" ")):3===o.split(" ").length&&(o+=" 1"),(8>=p?"rgb":"rgba")+"("+o.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")"}}}()}},Names:{camelCase:function(t){return t.replace(/-(\w)/g,function(t,e){return e.toUpperCase()})},SVGAttribute:function(t){var e="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";return(p||y.State.isAndroid&&!y.State.isChrome)&&(e+="|transform"),new RegExp("^("+e+")$","i").test(t)},prefixCheck:function(t){if(y.State.prefixMatches[t])return[y.State.prefixMatches[t],!0];for(var e=["","Webkit","Moz","ms","O"],n=0,i=e.length;i>n;n++){var o;if(o=0===n?t:e[n]+t.replace(/^\w/,function(t){return t.toUpperCase()}),m.isString(y.State.prefixElement.style[o]))return y.State.prefixMatches[t]=o,[o,!0]}return[t,!1]}},Values:{hexToRgb:function(t){var e,n=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;return t=t.replace(n,function(t,e,n,i){return e+e+n+n+i+i}),e=i.exec(t),e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:[0,0,0]},isCSSNullValue:function(t){return 0==t||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(t)},getUnitType:function(t){return/^(rotate|skew)/i.test(t)?"deg":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(t)?"":"px"},getDisplayType:function(t){var e=t&&t.tagName.toString().toLowerCase();return/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(e)?"inline":/^(li)$/i.test(e)?"list-item":/^(tr)$/i.test(e)?"table-row":/^(table)$/i.test(e)?"table":/^(tbody)$/i.test(e)?"table-row-group":"block"},addClass:function(t,e){t.classList?t.classList.add(e):t.className+=(t.className.length?" ":"")+e},removeClass:function(t,e){t.classList?t.classList.remove(e):t.className=t.className.toString().replace(new RegExp("(^|\\s)"+e.split(" ").join("|")+"(\\s|$)","gi")," ")}},getPropertyValue:function(t,n,o,r){function a(t,n){function o(){l&&w.setPropertyValue(t,"display","none")}var u=0;if(8>=p)u=h.css(t,n);else{var l=!1;if(/^(width|height)$/.test(n)&&0===w.getPropertyValue(t,"display")&&(l=!0,w.setPropertyValue(t,"display",w.Values.getDisplayType(t))),!r){if("height"===n&&"border-box"!==w.getPropertyValue(t,"boxSizing").toString().toLowerCase()){var c=t.offsetHeight-(parseFloat(w.getPropertyValue(t,"borderTopWidth"))||0)-(parseFloat(w.getPropertyValue(t,"borderBottomWidth"))||0)-(parseFloat(w.getPropertyValue(t,"paddingTop"))||0)-(parseFloat(w.getPropertyValue(t,"paddingBottom"))||0);return o(),c}if("width"===n&&"border-box"!==w.getPropertyValue(t,"boxSizing").toString().toLowerCase()){var d=t.offsetWidth-(parseFloat(w.getPropertyValue(t,"borderLeftWidth"))||0)-(parseFloat(w.getPropertyValue(t,"borderRightWidth"))||0)-(parseFloat(w.getPropertyValue(t,"paddingLeft"))||0)-(parseFloat(w.getPropertyValue(t,"paddingRight"))||0);return o(),d}}var f;f=s(t)===i?e.getComputedStyle(t,null):s(t).computedStyle?s(t).computedStyle:s(t).computedStyle=e.getComputedStyle(t,null),"borderColor"===n&&(n="borderTopColor"),u=9===p&&"filter"===n?f.getPropertyValue(n):f[n],(""===u||null===u)&&(u=t.style[n]),o()}if("auto"===u&&/^(top|right|bottom|left)$/i.test(n)){var m=a(t,"position");("fixed"===m||"absolute"===m&&/top|left/i.test(n))&&(u=h(t).position()[n]+"px")}return u}var u;if(w.Hooks.registered[n]){var l=n,c=w.Hooks.getRoot(l);o===i&&(o=w.getPropertyValue(t,w.Names.prefixCheck(c)[0])),w.Normalizations.registered[c]&&(o=w.Normalizations.registered[c]("extract",t,o)),u=w.Hooks.extractValue(l,o)}else if(w.Normalizations.registered[n]){var d,f;d=w.Normalizations.registered[n]("name",t),"transform"!==d&&(f=a(t,w.Names.prefixCheck(d)[0]),w.Values.isCSSNullValue(f)&&w.Hooks.templates[n]&&(f=w.Hooks.templates[n][1])),u=w.Normalizations.registered[n]("extract",t,f)}if(!/^[\d-]/.test(u))if(s(t)&&s(t).isSVG&&w.Names.SVGAttribute(n))if(/^(height|width)$/i.test(n))try{u=t.getBBox()[n]}catch(m){u=0}else u=t.getAttribute(n);else u=a(t,w.Names.prefixCheck(n)[0]);return w.Values.isCSSNullValue(u)&&(u=0),y.debug>=2&&console.log("Get "+n+": "+u),u},setPropertyValue:function(t,n,i,o,r){var a=n;if("scroll"===n)r.container?r.container["scroll"+r.direction]=i:"Left"===r.direction?e.scrollTo(i,r.alternateValue):e.scrollTo(r.alternateValue,i);else if(w.Normalizations.registered[n]&&"transform"===w.Normalizations.registered[n]("name",t))w.Normalizations.registered[n]("inject",t,i),a="transform",i=s(t).transformCache[n];else{if(w.Hooks.registered[n]){var u=n,l=w.Hooks.getRoot(n);o=o||w.getPropertyValue(t,l),i=w.Hooks.injectValue(u,i,o),n=l}if(w.Normalizations.registered[n]&&(i=w.Normalizations.registered[n]("inject",t,i),n=w.Normalizations.registered[n]("name",t)),a=w.Names.prefixCheck(n)[0],8>=p)try{t.style[a]=i}catch(c){y.debug&&console.log("Browser does not support ["+i+"] for ["+a+"]")}else s(t)&&s(t).isSVG&&w.Names.SVGAttribute(n)?t.setAttribute(n,i):t.style[a]=i;y.debug>=2&&console.log("Set "+n+" ("+a+"): "+i)}return[a,i]},flushTransformCache:function(t){function e(e){return parseFloat(w.getPropertyValue(t,e))}var n="";if((p||y.State.isAndroid&&!y.State.isChrome)&&s(t).isSVG){var i={translate:[e("translateX"),e("translateY")],skewX:[e("skewX")],skewY:[e("skewY")],scale:1!==e("scale")?[e("scale"),e("scale")]:[e("scaleX"),e("scaleY")],rotate:[e("rotateZ"),0,0]};h.each(s(t).transformCache,function(t){/^translate/i.test(t)?t="translate":/^scale/i.test(t)?t="scale":/^rotate/i.test(t)&&(t="rotate"),i[t]&&(n+=t+"("+i[t].join(" ")+") ",delete i[t])})}else{var o,r;h.each(s(t).transformCache,function(e){return o=s(t).transformCache[e],"transformPerspective"===e?(r=o,!0):(9===p&&"rotateZ"===e&&(e="rotate"),void(n+=e+o+" "))}),r&&(n="perspective"+r+" "+n)}w.setPropertyValue(t,"transform",n)}};w.Hooks.register(),w.Normalizations.register(),y.hook=function(t,e,n){var o=i;return t=r(t),h.each(t,function(t,r){if(s(r)===i&&y.init(r),n===i)o===i&&(o=y.CSS.getPropertyValue(r,e));else{var a=y.CSS.setPropertyValue(r,e,n);"transform"===a[0]&&y.CSS.flushTransformCache(r),o=a}}),o};var k=function(){function t(){return a?P.promise||null:u}function o(){function t(t){function d(t,e){var n=i,o=i,s=i;return m.isArray(t)?(n=t[0],!m.isArray(t[1])&&/^[\d-]/.test(t[1])||m.isFunction(t[1])||w.RegEx.isHex.test(t[1])?s=t[1]:(m.isString(t[1])&&!w.RegEx.isHex.test(t[1])||m.isArray(t[1]))&&(o=e?t[1]:l(t[1],a.duration),t[2]!==i&&(s=t[2]))):n=t,e||(o=o||a.easing),m.isFunction(n)&&(n=n.call(r,S,C)),m.isFunction(s)&&(s=s.call(r,S,C)),[n||0,o,s]}function p(t,e){var n,i;return i=(e||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(t){return n=t,""}),n||(n=w.Values.getUnitType(t)),[i,n]}function b(){var t={myParent:r.parentNode||n.body,position:w.getPropertyValue(r,"position"),fontSize:w.getPropertyValue(r,"fontSize")},i=t.position===$.lastPosition&&t.myParent===$.lastParent,o=t.fontSize===$.lastFontSize;$.lastParent=t.myParent,$.lastPosition=t.position,$.lastFontSize=t.fontSize;var a=100,u={};if(o&&i)u.emToPx=$.lastEmToPx,u.percentToPxWidth=$.lastPercentToPxWidth,u.percentToPxHeight=$.lastPercentToPxHeight;else{var l=s(r).isSVG?n.createElementNS("http://www.w3.org/2000/svg","rect"):n.createElement("div");y.init(l),t.myParent.appendChild(l),h.each(["overflow","overflowX","overflowY"],function(t,e){y.CSS.setPropertyValue(l,e,"hidden")}),y.CSS.setPropertyValue(l,"position",t.position),y.CSS.setPropertyValue(l,"fontSize",t.fontSize),y.CSS.setPropertyValue(l,"boxSizing","content-box"),h.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(t,e){y.CSS.setPropertyValue(l,e,a+"%")}),y.CSS.setPropertyValue(l,"paddingLeft",a+"em"),u.percentToPxWidth=$.lastPercentToPxWidth=(parseFloat(w.getPropertyValue(l,"width",null,!0))||1)/a,u.percentToPxHeight=$.lastPercentToPxHeight=(parseFloat(w.getPropertyValue(l,"height",null,!0))||1)/a,u.emToPx=$.lastEmToPx=(parseFloat(w.getPropertyValue(l,"paddingLeft"))||1)/a,t.myParent.removeChild(l)}return null===$.remToPx&&($.remToPx=parseFloat(w.getPropertyValue(n.body,"fontSize"))||16),null===$.vwToPx&&($.vwToPx=parseFloat(e.innerWidth)/100,$.vhToPx=parseFloat(e.innerHeight)/100),u.remToPx=$.remToPx,u.vwToPx=$.vwToPx,u.vhToPx=$.vhToPx,y.debug>=1&&console.log("Unit ratios: "+JSON.stringify(u),r),u}if(a.begin&&0===S)try{a.begin.call(f,f)}catch(v){setTimeout(function(){throw v},1)}if("scroll"===T){var k,x,E,I=/^x$/i.test(a.axis)?"Left":"Top",A=parseFloat(a.offset)||0;a.container?m.isWrapped(a.container)||m.isNode(a.container)?(a.container=a.container[0]||a.container,k=a.container["scroll"+I],E=k+h(r).position()[I.toLowerCase()]+A):a.container=null:(k=y.State.scrollAnchor[y.State["scrollProperty"+I]],x=y.State.scrollAnchor[y.State["scrollProperty"+("Left"===I?"Top":"Left")]],E=h(r).offset()[I.toLowerCase()]+A),u={scroll:{rootPropertyValue:!1,startValue:k,currentValue:k,endValue:E,unitType:"",easing:a.easing,scrollData:{container:a.container,direction:I,alternateValue:x}},element:r},y.debug&&console.log("tweensContainer (scroll): ",u.scroll,r)}else if("reverse"===T){if(!s(r).tweensContainer)return void h.dequeue(r,a.queue);"none"===s(r).opts.display&&(s(r).opts.display="auto"),"hidden"===s(r).opts.visibility&&(s(r).opts.visibility="visible"),s(r).opts.loop=!1,s(r).opts.begin=null,s(r).opts.complete=null,_.easing||delete a.easing,_.duration||delete a.duration,a=h.extend({},s(r).opts,a);var B=h.extend(!0,{},s(r).tweensContainer);for(var O in B)if("element"!==O){var M=B[O].startValue;B[O].startValue=B[O].currentValue=B[O].endValue,B[O].endValue=M,m.isEmptyObject(_)||(B[O].easing=a.easing),y.debug&&console.log("reverse tweensContainer ("+O+"): "+JSON.stringify(B[O]),r)}u=B}else if("start"===T){var B;s(r).tweensContainer&&s(r).isAnimating===!0&&(B=s(r).tweensContainer),h.each(g,function(t,e){if(RegExp("^"+w.Lists.colors.join("$|^")+"$").test(t)){var n=d(e,!0),o=n[0],r=n[1],s=n[2];if(w.RegEx.isHex.test(o)){for(var a=["Red","Green","Blue"],u=w.Values.hexToRgb(o),l=s?w.Values.hexToRgb(s):i,c=0;c<a.length;c++){var h=[u[c]];r&&h.push(r),l!==i&&h.push(l[c]),g[t+a[c]]=h}delete g[t]}}});for(var R in g){var L=d(g[R]),F=L[0],N=L[1],j=L[2];R=w.Names.camelCase(R);var U=w.Hooks.getRoot(R),V=!1;if(s(r).isSVG||"tween"===U||w.Names.prefixCheck(U)[1]!==!1||w.Normalizations.registered[U]!==i){(a.display!==i&&null!==a.display&&"none"!==a.display||a.visibility!==i&&"hidden"!==a.visibility)&&/opacity|filter/.test(R)&&!j&&0!==F&&(j=0),a._cacheValues&&B&&B[R]?(j===i&&(j=B[R].endValue+B[R].unitType),V=s(r).rootPropertyValueCache[U]):w.Hooks.registered[R]?j===i?(V=w.getPropertyValue(r,U),j=w.getPropertyValue(r,R,V)):V=w.Hooks.templates[U][1]:j===i&&(j=w.getPropertyValue(r,R));var H,z,q,W=!1;if(H=p(R,j),j=H[0],q=H[1],H=p(R,F),F=H[0].replace(/^([+-\/*])=/,function(t,e){return W=e,""}),z=H[1],j=parseFloat(j)||0,F=parseFloat(F)||0,"%"===z&&(/^(fontSize|lineHeight)$/.test(R)?(F/=100,z="em"):/^scale/.test(R)?(F/=100,z=""):/(Red|Green|Blue)$/i.test(R)&&(F=F/100*255,z="")),/[\/*]/.test(W))z=q;else if(q!==z&&0!==j)if(0===F)z=q;else{o=o||b();var Q=/margin|padding|left|right|width|text|word|letter/i.test(R)||/X$/.test(R)||"x"===R?"x":"y";switch(q){case"%":j*="x"===Q?o.percentToPxWidth:o.percentToPxHeight;break;case"px":break;default:j*=o[q+"ToPx"]}switch(z){case"%":j*=1/("x"===Q?o.percentToPxWidth:o.percentToPxHeight);break;case"px":break;default:j*=1/o[z+"ToPx"]}}switch(W){case"+":F=j+F;break;case"-":F=j-F;break;case"*":F=j*F;break;case"/":F=j/F}u[R]={rootPropertyValue:V,startValue:j,currentValue:j,endValue:F,unitType:z,easing:N},y.debug&&console.log("tweensContainer ("+R+"): "+JSON.stringify(u[R]),r)}else y.debug&&console.log("Skipping ["+U+"] due to a lack of browser support.")}u.element=r}u.element&&(w.Values.addClass(r,"velocity-animating"),D.push(u),""===a.queue&&(s(r).tweensContainer=u,s(r).opts=a),s(r).isAnimating=!0,S===C-1?(y.State.calls.push([D,f,a,null,P.resolver]),y.State.isTicking===!1&&(y.State.isTicking=!0,c())):S++)}var o,r=this,a=h.extend({},y.defaults,_),u={};switch(s(r)===i&&y.init(r),parseFloat(a.delay)&&a.queue!==!1&&h.queue(r,a.queue,function(t){y.velocityQueueEntryFlag=!0,s(r).delayTimer={setTimeout:setTimeout(t,parseFloat(a.delay)),next:t}}),a.duration.toString().toLowerCase()){case"fast":a.duration=200;break;case"normal":a.duration=b;break;case"slow":a.duration=600;break;default:a.duration=parseFloat(a.duration)||1}y.mock!==!1&&(y.mock===!0?a.duration=a.delay=1:(a.duration*=parseFloat(y.mock)||1,a.delay*=parseFloat(y.mock)||1)),a.easing=l(a.easing,a.duration),a.begin&&!m.isFunction(a.begin)&&(a.begin=null),a.progress&&!m.isFunction(a.progress)&&(a.progress=null),a.complete&&!m.isFunction(a.complete)&&(a.complete=null),a.display!==i&&null!==a.display&&(a.display=a.display.toString().toLowerCase(),"auto"===a.display&&(a.display=y.CSS.Values.getDisplayType(r))),a.visibility!==i&&null!==a.visibility&&(a.visibility=a.visibility.toString().toLowerCase()),a.mobileHA=a.mobileHA&&y.State.isMobile&&!y.State.isGingerbread,a.queue===!1?a.delay?setTimeout(t,a.delay):t():h.queue(r,a.queue,function(e,n){return n===!0?(P.promise&&P.resolver(f),!0):(y.velocityQueueEntryFlag=!0,void t(e))}),""!==a.queue&&"fx"!==a.queue||"inprogress"===h.queue(r)[0]||h.dequeue(r)}var a,u,p,f,g,_,v=arguments[0]&&(arguments[0].p||h.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||m.isString(arguments[0].properties));if(m.isWrapped(this)?(a=!1,p=0,f=this,u=this):(a=!0,p=1,f=v?arguments[0].elements||arguments[0].e:arguments[0]),f=r(f)){v?(g=arguments[0].properties||arguments[0].p,_=arguments[0].options||arguments[0].o):(g=arguments[p],_=arguments[p+1]);var C=f.length,S=0;if(!/^(stop|finish)$/i.test(g)&&!h.isPlainObject(_)){var x=p+1;_={};for(var E=x;E<arguments.length;E++)m.isArray(arguments[E])||!/^(fast|normal|slow)$/i.test(arguments[E])&&!/^\d/.test(arguments[E])?m.isString(arguments[E])||m.isArray(arguments[E])?_.easing=arguments[E]:m.isFunction(arguments[E])&&(_.complete=arguments[E]):_.duration=arguments[E]}var P={promise:null,resolver:null,rejecter:null};a&&y.Promise&&(P.promise=new y.Promise(function(t,e){P.resolver=t,P.rejecter=e}));var T;switch(g){case"scroll":T="scroll";break;case"reverse":T="reverse";break;case"finish":case"stop":h.each(f,function(t,e){s(e)&&s(e).delayTimer&&(clearTimeout(s(e).delayTimer.setTimeout),s(e).delayTimer.next&&s(e).delayTimer.next(),delete s(e).delayTimer)});var I=[];return h.each(y.State.calls,function(t,e){e&&h.each(e[1],function(n,o){var r=_===i?"":_;return r===!0||e[2].queue===r||_===i&&e[2].queue===!1?void h.each(f,function(n,i){i===o&&((_===!0||m.isString(_))&&(h.each(h.queue(i,m.isString(_)?_:""),function(t,e){m.isFunction(e)&&e(null,!0)}),h.queue(i,m.isString(_)?_:"",[])),"stop"===g?(s(i)&&s(i).tweensContainer&&r!==!1&&h.each(s(i).tweensContainer,function(t,e){e.endValue=e.currentValue}),I.push(t)):"finish"===g&&(e[2].duration=1))}):!0})}),"stop"===g&&(h.each(I,function(t,e){d(e,!0)}),P.promise&&P.resolver(f)),t();default:if(!h.isPlainObject(g)||m.isEmptyObject(g)){if(m.isString(g)&&y.Redirects[g]){var A=h.extend({},_),B=A.duration,O=A.delay||0;return A.backwards===!0&&(f=h.extend(!0,[],f).reverse()),h.each(f,function(t,e){parseFloat(A.stagger)?A.delay=O+parseFloat(A.stagger)*t:m.isFunction(A.stagger)&&(A.delay=O+A.stagger.call(e,t,C)),A.drag&&(A.duration=parseFloat(B)||(/^(callout|transition)/.test(g)?1e3:b),A.duration=Math.max(A.duration*(A.backwards?1-t/C:(t+1)/C),.75*A.duration,200)),y.Redirects[g].call(e,e,A||{},t,C,f,P.promise?P:i)}),t()}var M="Velocity: First argument ("+g+") was not a property map, a known action, or a registered redirect. Aborting.";return P.promise?P.rejecter(new Error(M)):console.log(M),t()}T="start"}var $={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null},D=[];h.each(f,function(t,e){m.isNode(e)&&o.call(e)});var R,A=h.extend({},y.defaults,_);if(A.loop=parseInt(A.loop),R=2*A.loop-1,A.loop)for(var L=0;R>L;L++){var F={delay:A.delay,progress:A.progress};L===R-1&&(F.display=A.display,F.visibility=A.visibility,F.complete=A.complete),k(f,"reverse",F)}return t()}};y=h.extend(k,y),y.animate=k;var C=e.requestAnimationFrame||f;return y.State.isMobile||n.hidden===i||n.addEventListener("visibilitychange",function(){n.hidden?(C=function(t){return setTimeout(function(){t(!0)},16)},c()):C=e.requestAnimationFrame||f}),t.Velocity=y,t!==e&&(t.fn.velocity=k,t.fn.velocity.defaults=y.defaults),h.each(["Down","Up"],function(t,e){y.Redirects["slide"+e]=function(t,n,o,r,s,a){var u=h.extend({},n),l=u.begin,c=u.complete,d={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""},p={};u.display===i&&(u.display="Down"===e?"inline"===y.CSS.Values.getDisplayType(t)?"inline-block":"block":"none"),u.begin=function(){l&&l.call(s,s);for(var n in d){p[n]=t.style[n];var i=y.CSS.getPropertyValue(t,n);d[n]="Down"===e?[i,0]:[0,i]}p.overflow=t.style.overflow,t.style.overflow="hidden"},u.complete=function(){for(var e in p)t.style[e]=p[e];c&&c.call(s,s),a&&a.resolver(s)},y(t,d,u)}}),h.each(["In","Out"],function(t,e){y.Redirects["fade"+e]=function(t,n,o,r,s,a){var u=h.extend({},n),l={opacity:"In"===e?1:0},c=u.complete;u.complete=o!==r-1?u.begin=null:function(){c&&c.call(s,s),a&&a.resolver(s)},u.display===i&&(u.display="In"===e?"auto":"none"),y(this,l,u)}}),y}(window.jQuery||window.Zepto||window,window,document)}),function(t,e){var n=function(t,e){var n=function(t){var n,i=this,o=[].slice.call(arguments);n=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return i.apply(this,arguments)},e(n,i);var r=function(){this.constructor=n};return r.prototype=i.prototype,n.prototype=new r,t&&(o.unshift(n.prototype),e.apply(null,o)),n.__super__=i.prototype,n};t(n)};e.define("ampersandClassExtend",["extendObject"],n)}(this,this.modules),function(t,e){var n=function(t,e,n){var i=function(t,e){var n=e.error;e.error=function(i){n&&n(t,i,e),t.trigger("error",t,i,e)}},o={fetch:function(t){t=t?n({},t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,o=this;return t.success=function(n){var i=t.reset?"reset":"set";o[i](n,t),e&&e(o,n,t),o.trigger("sync",o,n,t)},i(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?n({},e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var i=this,o=e.success;return e.success=function(t,n){e.wait&&i.add(t,e),o&&o(t,n,e)},t.save(null,e),t},sync:function(){return e.apply(this,arguments)},getOrFetch:function(t,e,n){function i(){var e=o.get(t);e?n&&n(null,e):n(new Error("not found"))}3!==arguments.length&&(n=e,e={});var o=this,r=this.get(t);return r?n(null,r):void(e.all?this.fetch({success:i,error:i}):this.fetchById(t,n))},fetchById:function(t,e){var n=this,i={};i[this.model.prototype.idAttribute]=t;var o=new this.model(i,{collection:this});o.fetch({success:function(){n.add(o),e&&e(null,o)},error:function(){delete o.collection,e&&e(Error("not found"))}})}};t(o)};e.define("ampersandCollectionRestMixin",["ampersandSync","extendObject"],n)}(this,this.modules),function(t,e){var n=function(t){var e=[].slice,n={},i=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample","partition"];_.each(i,function(t){_[t]&&(n[t]=function(){var n=e.call(arguments);return n.unshift(this.models),_[t].apply(_,n)})});var o=["groupBy","countBy","sortBy","indexBy"];_.each(o,function(t){_[t]&&(n[t]=function(e,n){var i=_.isFunction(e)?e:function(t){return t.get?t.get(e):t[e]};return _[t](this.models,i,n)})}),n.where=function(t,e){return _.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){var n;for(var i in t)if(n=e.get?e.get(i):e[i],t[i]!==n)return!1;return!0})},n.findWhere=function(t){return this.where(t,!0)},n.pluck=function(t){return _.invoke(this.models,"get",t)},t(n)};e.define("ampersandCollectionUnderscoreMixin",[],n)}(this,this.modules),function(t,e){var n=function(t,e,n){function i(t){if(!t)throw new ReferenceError("Collection view missing required parameters: collection, el");if(!t.collection)throw new ReferenceError("Collection view requires a collection");if(!t.el&&!this.insertSelf)throw new ReferenceError("Collection view requires an el");_.extend(this,_.pick(t,o)),this.views=[],this.listenTo(this.collection,"add",this._addViewForModel),this.listenTo(this.collection,"remove",this._removeViewForModel),this.listenTo(this.collection,"sort",this._rerenderAll),this.listenTo(this.collection,"refresh reset",this._reset)}var o=["collection","el","viewOptions","view","filter","reverse","parent"];_.extend(i.prototype,e,{render:function(){return this._renderAll(),this},remove:function(){_.invoke(this.views,"remove"),this.stopListening()},_getViewByModel:function(t){return _.find(this.views,function(e){return t===e.model})},_createViewForModel:function(t){var e=new this.view(_({model:t,collection:this.collection}).extend(this.viewOptions));return this.views.push(e),e.parent=this,e.renderedByParentView=!0,e.render(),e},_getOrCreateByModel:function(t){return this._getViewByModel(t)||this._createViewForModel(t)},_addViewForModel:function(t,e,n){var i=this._getViewByModel(t),o=this.filter?this.filter(t):!0;o&&(i||(i=new this.view(_({model:t,collection:this.collection}).extend(this.viewOptions)),this.views.push(i),i.parent=this,i.renderedByParentView=!0,i.render({containerEl:this.el})),n&&n.rerender?this._insertView(i):this._insertViewAtIndex(i))},_insertViewAtIndex:function(t){if(!t.insertSelf){var e,n,i=this.collection.indexOf(t.model);e=this.reverse?this.collection.at(i-1):this.collection.at(i+1),n=this._getViewByModel(e),n?this.el.insertBefore(t.el,n&&n.el):this.el.appendChild(t.el)}},_insertView:function(t){t.insertSelf||(this.reverse&&this.el.firstChild?this.el.insertBefore(t.el,this.el.firstChild):this.el.appendChild(t.el))},_removeViewForModel:function(t){var e=this._getViewByModel(t);if(e){var n=this.views.indexOf(e);-1!==n&&(e=this.views.splice(n,1)[0],this._removeView(e))}},_removeView:function(t){t.animateRemove?t.animateRemove():t.remove()},_renderAll:function(){this.collection.each(this._addViewForModel,this)},_rerenderAll:function(t,e){e=e||{},this.collection.each(function(t){this._addViewForModel(t,this,_.extend(e,{rerender:!0}))},this)},_reset:function(){var t=this.collection.map(this._getOrCreateByModel,this),e=_.difference(this.views,t);e.forEach(this._removeView,this),this.views=t,this._rerenderAll()}}),i.extend=n,t(i)};e.define("ampersandCollectionView",["backboneEvents","ampersandClassExtend"],n)}(this,this.modules),function(t,e){var n=function(t,e,n,i,o){function r(t,e){if(e||(e={}),e.model&&(this.model=e.model),e.comparator&&(this.comparator=e.comparator),e.parent&&(this.parent=e.parent),!this.mainIndex){var n=this.model&&this.model.prototype&&this.model.prototype.idAttribute;this.mainIndex=n||"id"}this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i({silent:!0},e))}var s=[].slice;i(r.prototype,e,{initialize:function(){},indexes:[],isModel:function(t){return this.model&&t instanceof this.model},add:function(t,e){return this.set(t,i({merge:!1,add:!0,remove:!1},e))},parse:function(t,e){return t},serialize:function(){return this.map(function(t){if(t.serialize)return t.serialize();var e={};return i(e,t),delete e.collection,e})},toJSON:function(){return this.serialize()},set:function(t,e){e=i({add:!0,remove:!0,merge:!0},e),e.parse&&(t=this.parse(t,e));var n=!o(t);t=n?t?[t]:[]:t.slice();var r,s,a,u,l,c,d,h=e.at,p=this.comparator&&null==h&&e.sort!==!1,f="string"==typeof this.comparator?this.comparator:null,m=[],g=[],b={},_=e.add,y=e.merge,v=e.remove,w=!p&&_&&v?[]:!1,k=this.model&&this.model.prototype||Object.prototype;for(c=0,d=t.length;d>c;c++){if(a=t[c]||{},r=this.isModel(a)?s=a:k.generateId?k.generateId(a):a[k.idAttribute||this.mainIndex],u=this.get(r))v&&(b[u.cid||u[this.mainIndex]]=!0),y&&(a=a===s?s.attributes:a,e.parse&&(a=u.parse(a,e)),u.set?(u.set(a,e),p&&!l&&u.hasChanged(f)&&(l=!0)):i(u,a)),t[c]=u;else if(_){if(s=t[c]=this._prepareModel(a,e),!s)continue;m.push(s),this._addReference(s,e)}s=u||s,s&&(w&&(s.isNew&&s.isNew()||!s[this.mainIndex]||!b[s.cid||s[this.mainIndex]])&&w.push(s),b[s[this.mainIndex]]=!0)}if(v){for(c=0,d=this.length;d>c;c++)s=this.models[c],b[s.cid||s[this.mainIndex]]||g.push(s);g.length&&this.remove(g,e)}if(m.length||w&&w.length)if(p&&(l=!0),null!=h)for(c=0,d=m.length;d>c;c++)this.models.splice(h+c,0,m[c]);else{var C=w||m;for(c=0,d=C.length;d>c;c++)this.models.push(C[c])}if(l&&this.sort({silent:!0}),!e.silent){for(c=0,d=m.length;d>c;c++)s=m[c],s.trigger?s.trigger("add",s,this,e):this.trigger("add",s,this,e);(l||w&&w.length)&&this.trigger("sort",this,e)}return n?t[0]:t},get:function(t,e){if(t){var n=this._indexes[e||this.mainIndex];return n[t]||n[t[this.mainIndex]]||this._indexes.cid[t.cid]}},at:function(t){return this.models[t]},remove:function(t,e){var n,i,r,a,u=!o(t);for(t=u?[t]:s.call(t),e||(e={}),n=0,i=t.length;i>n;n++)r=t[n]=this.get(t[n]),r&&(this._deIndex(r),a=this.models.indexOf(r),this.models.splice(a,1),e.silent||(e.index=a,r.trigger?r.trigger("remove",r,this,e):this.trigger("remove",r,this,e)),this._removeReference(r,e));return u?t[0]:t},reset:function(t,e){e||(e={});for(var n=0,o=this.models.length;o>n;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},sort:function(t){var e=this;if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),"string"==typeof this.comparator?this.models.sort(function(t,n){return t.get?(t=t.get(e.comparator),n=n.get(e.comparator)):(t=t[e.comparator],n=n[e.comparator]),t>n||void 0===t?1:n>t||void 0===n?-1:0}):1===this.comparator.length?this.models.sort(function(t,n){return t=e.comparator(t),n=e.comparator(n),t>n||void 0===t?1:n>t||void 0===n?-1:0}):this.models.sort(this.comparator.bind(this)),t.silent||this.trigger("sort",this,t),this},_reset:function(){var t=this.indexes||[],e=0;t.push(this.mainIndex),t.push("cid");var n=t.length;for(this.models=[],this._indexes={};n>e;e++)this._indexes[t[e]]={}},_prepareModel:function(t,e){if(!this.model)return t;if(this.isModel(t))return t.collection||(t.collection=this),t;e=e?i({},e):{},e.collection=this;var n=new this.model(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),
!1):n},_deIndex:function(t){for(var e in this._indexes)delete this._indexes[e][t[e]||t.get&&t.get(e)]},_index:function(t){for(var e in this._indexes){var n=t[e]||t.get&&t.get(e);n&&(this._indexes[e][n]=t)}},_addReference:function(t,e){this._index(t),t.collection||(t.collection=this),t.on&&t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){this===t.collection&&delete t.collection,this._deIndex(t),t.off&&t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,i),e&&t==="change:"+this.mainIndex&&(this._deIndex(e),this._index(e)),this.trigger.apply(this,arguments))}}),Object.defineProperties(r.prototype,{length:{get:function(){return this.models.length}},isCollection:{value:!0}});var a=["indexOf","lastIndexOf","every","some","forEach","map","filter","reduce","reduceRight"];a.forEach(function(t){r.prototype[t]=function(){return this.models[t].apply(this.models,arguments)}}),r.prototype.each=r.prototype.forEach,r.extend=n,t(r)};e.define("ampersandCollection",["backboneEvents","ampersandClassExtend","extendObject","isArray"],n)}(this,this.modules),function(t,e,n){var i=function(t,n,i,o){function r(t,e){var i,o,r=new n;for(i in t)o=t[i],"string"==typeof o?r.add(i,u({type:"text",selector:o})):o.forEach?o.forEach(function(t){r.add(i,u(t,e))}):r.add(i,u(o,e));return r}function s(t,e){if(""===e)return[t];var n=[];return i(t,e)&&n.push(t),n.concat(l.call(t.querySelectorAll(e)))}function a(t){return Array.isArray(t)?t:[t]}function u(t,n){var i,r=t.type||"text",u="function"==typeof r,l=function(){return"string"==typeof t.selector?t.selector:t.hook?'[data-hook~="'+t.hook+'"]':""}(),c=t.yes,d=t.no,h=!(!c&&!d);if(u)return function(t,e){s(t,l).forEach(function(t){r.call(n,t,e,i)}),i=e};if("text"===r)return function(t,e){s(t,l).forEach(function(t){o.text(t,e)})};if("class"===r)return function(t,e){s(t,l).forEach(function(t){o.switchClass(t,i,e)}),i=e};if("attribute"===r){if(!t.name)throw Error('attribute bindings must have a "name"');return function(e,n){var r=a(t.name);s(e,l).forEach(function(t){r.forEach(function(e){o.setAttribute(t,e,n)})}),i=n}}if("value"===r)return function(t,n){s(t,l).forEach(function(t){n||0===n||(n=""),e.activeElement!==t&&(t.value=n)}),i=n};if("booleanClass"===r)return h?(c=a(c||""),d=a(d||""),function(t,e){var n=e?d:c,i=e?c:d;s(t,l).forEach(function(t){n.forEach(function(e){o.removeClass(t,e)}),i.forEach(function(e){o.addClass(t,e)})})}):function(e,n,i){var r=a(t.name||i);s(e,l).forEach(function(t){r.forEach(function(e){o[n?"addClass":"removeClass"](t,e)})})};if("booleanAttribute"===r)return function(e,n,i){var r=a(t.name||i);s(e,l).forEach(function(t){r.forEach(function(e){o[n?"addAttribute":"removeAttribute"](t,e)})})};if("toggle"===r)return h?function(t,e){s(t,c).forEach(function(t){o[e?"show":"hide"](t)}),s(t,d).forEach(function(t){o[e?"hide":"show"](t)})}:function(t,e){s(t,l).forEach(function(t){o[e?"show":"hide"](t)})};if("switch"===r){if(!t.cases)throw Error('switch bindings must have "cases"');return function(e,n){for(var i in t.cases)s(e,t.cases[i]).forEach(function(t){o[n===i?"show":"hide"](t)})}}if("innerHTML"===r)return function(t,e){s(t,l).forEach(function(t){o.html(t,e)})};if("switchClass"===r){if(!t.cases)throw Error('switchClass bindings must have "cases"');return function(e,n,i){var r=a(t.name||i);for(var u in t.cases)s(e,t.cases[u]).forEach(function(t){r.forEach(function(e){o[n===u?"addClass":"removeClass"](t,e)})})}}throw new Error("no such binding type: "+r)}var l=Array.prototype.slice;t(r)};n.define("ampersandDomBinding",["keyTreeStore","matchesSelector","ampersandDom"],i)}(this,this.document,this.modules),function(t,e,n){var i=function(t){function e(t){return t||0===t?t:""}function n(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}function i(t,e){var n=t[e];return e in t&&(n===!0||n===!1)}function o(t){return"true"===u.getAttribute(t,"data-anddom-hidden")}function r(t){u.setAttribute(t,"data-anddom-display",t.style.display)}function s(t){t.style.display=u.getAttribute(t,"data-anddom-display")||"",u.removeAttribute(t,"data-anddom-hidden")}function a(t){u.setAttribute(t,"data-anddom-hidden","true"),t.style.display="none"}var u={text:function(t,n){t.textContent=e(n)},addClass:function(t,i){i=e(i),i&&(Array.isArray(i)?i.forEach(function(e){u.addClass(t,e)}):t.classList?t.classList.add(i):n(t,i)||(t.classList?t.classList.add(i):t.className+=" "+i))},removeClass:function(t,n){Array.isArray(n)?n.forEach(function(e){u.removeClass(t,e)}):t.classList?(n=e(n),n&&t.classList.remove(n)):t.className=t.className.replace(new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi")," ")},hasClass:n,switchClass:function(t,e,n){e&&this.removeClass(t,e),this.addClass(t,n)},addAttribute:function(t,e){t.setAttribute(e,""),i(t,e)&&(t[e]=!0)},removeAttribute:function(t,e){t.removeAttribute(e),i(t,e)&&(t[e]=!1)},setAttribute:function(t,n,i){t.setAttribute(n,e(i))},getAttribute:function(t,e){return t.getAttribute(e)},hide:function(t){o(t)||(r(t),a(t))},show:function(t){s(t)},html:function(t,e){t.innerHTML=e}};t(u)};n.define("ampersandDom",[],i)}(this,this.document,this.modules),function(t,e){var n=function(e,n){var i=function(){this.handlers=[],this.checkUrl=_.bind(this.checkUrl,this),"undefined"!=typeof t&&(this.location=t.location,this.history=t.history)},o=/^[#\/]|\s+$/g,r=/^\/+|\/+$/g,s=/#.*$/;i.started=!1,_.extend(i.prototype,n,{interval:50,atRoot:function(){var t=this.location.pathname.replace(/[^\/]$/,"$&/");return t===this.root&&!this.location.search},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=decodeURI(this.location.pathname+this.location.search),e=this.root.slice(0,-1);return t.indexOf(e)||(t=t.slice(e.length)),t.slice(1)},getFragment:function(t){return null==t&&(t=this._hasPushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(o,"")},start:function(e){if(i.started)throw new Error("Backbone.history has already been started");i.started=!0,this.options=_.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in t,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState),this.fragment=this.getFragment();var n=t.addEventListener;if(this.root=("/"+this.root+"/").replace(r,"/"),this._hasPushState?n("popstate",this.checkUrl,!1):this._wantsHashChange&&this._hasHashChange?n("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.location.replace(this.root+"#"+this.getPath()),!0;this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}return this.options.silent?void 0:this.loadUrl()},stop:function(){var e=t.removeEventListener;this._hasPushState?e("popstate",this.checkUrl,!1):this._wantsHashChange&&this._hasHashChange&&e("hashchange",this.checkUrl,!1),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),i.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();return e===this.fragment?!1:void this.loadUrl()},loadUrl:function(t){return t=this.fragment=this.getFragment(t),this.handlers.some(function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(t,e){if(!i.started)return!1;e&&e!==!0||(e={trigger:!!e});var n=this.root+(t=this.getFragment(t||""));if(t=decodeURI(t.replace(s,"")),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"](void 0!==e.state?e.state:{},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace)}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),e(new i)};e.define("ampersandHistory",["backboneEvents"],n)}(this,this.modules),function(t,e,n){var i=function(t,e,n){var i=n.extend({save:function(t,e,n){var i,o,s;this.attributes;if(null==t||"object"==typeof t?(i=t,n=e):(i={})[t]=e,n=_.extend({validate:!0},n),i&&!n.wait){if(!this.set(i,n))return!1}else if(!this._validate(i,n))return!1;void 0===n.parse&&(n.parse=!0);var a=this,u=n.success;return n.success=function(t){var e=a.parse(t,n);return n.wait&&(e=_.extend(i||{},e)),_.isObject(e)&&!a.set(e,n)?!1:(u&&u(a,t,n),void a.trigger("sync",a,t,n))},r(this,n),o=this.isNew()?"create":n.patch?"patch":"update","patch"===o&&(n.attrs=i),n.wait&&(n.attrs=_.extend(a.serialize(),i)),s=this.sync(o,this,n)},fetch:function(t){t=t?_.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,n=t.success;return t.success=function(i){return e.set(e.parse(i,t),t)?(n&&n(e,i,t),void e.trigger("sync",e,i,t)):!1},r(this,t),this.sync("read",this,t)},destroy:function(t){t=t?_.clone(t):{};var e=this,n=t.success,i=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(o){(t.wait||e.isNew())&&i(),n&&n(e,o,t),e.isNew()||e.trigger("sync",e,o,t)},this.isNew())return t.success(),!1;r(this,t);var o=this.sync("delete",this,t);return t.wait||i(),o},sync:function(){return e.apply(this,arguments)},url:function(){var t=_.result(this,"urlRoot")||_.result(this.collection,"url")||o();return this.isNew()?t:t+("/"===t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.getId())}}),o=function(){throw new Error('A "url" property or function must be specified')},r=function(t,e){var n=e.error;e.error=function(i){n&&n(t,i,e),t.trigger("error",t,i,e)}};t(i)};n.define("ampersandModel",["ampersandSync","ampersandState"],i)}(this,this.document,this.modules),function(t,e){var n=function(t,e,n,i){var o=e.extend(n,i);t(o)};e.define("ampersandRestCollection",["ampersandCollection","ampersandCollectionUnderscoreMixin","ampersandCollectionRestMixin"],n)}(this,this.modules),function(t,e){var n=function(t,e,n,i){var o=function(t){t||(t={}),this.history=t.history||i,t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},r=/\((.*?)\)/g,s=/(\(\?)?:\w+/g,a=/\*\w+/g,u=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(o.prototype,n,{initialize:function(){},route:function(t,e,n){_.isRegExp(t)||(t=this._routeToRegExp(t)),_.isFunction(e)&&(n=e,e=""),n||(n=this[e]);var i=this;return this.history.route(t,function(o){var r=i._extractParameters(t,o);i.execute(n,r,e)!==!1&&(i.trigger.apply(i,["route:"+e].concat(r)),i.trigger("route",e,r),i.history.trigger("route",i,e,r))}),this},execute:function(t,e,n){t&&t.apply(this,e)},navigate:function(t,e){return this.history.navigate(t,e),this},redirectTo:function(t){this.navigate(t,{replace:!0,trigger:!0})},_bindRoutes:function(){if(this.routes){this.routes=_.result(this,"routes");for(var t,e=Object.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(u,"\\$&").replace(r,"(?:$1)?").replace(s,function(t,e){return e?t:"([^/?]+)"}).replace(a,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return n.map(function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null})}}),o.extend=e,t(o)};e.define("ampersandRouter",["ampersandClassExtend","backboneEvents","ampersandHistory"],n)}(this,this.modules),function(t,e,n){var i=function(t,e,n){function i(t,e){var n=t.length,i=t.indexOf(e)+1;return i>n-1&&(i=0),t[i]}function o(t,e){e||(e={}),this.cid||(this.cid=_.uniqueId("state")),this._events={},this._values={},this._definition=Object.create(this._definition),e.parse&&(t=this.parse(t,e)),this.parent=e.parent,this.collection=e.collection,this._keyTree=new n,this._initCollections(),this._initChildren(),this._cache={},this._previousAttributes={},t&&this.set(t,_.extend({silent:!0,initial:!0},e)),this._changed={},this._derived&&this._initDerived(),e.init!==!1&&this.initialize.apply(this,arguments)}function r(t,e,n,i){var o,r,s=t._definition[e]={};if(_.isString(n))o=t._ensureValidType(n),o&&(s.type=o);else{if(_.isArray(n)&&(r=n,n={type:r[0],required:r[1],"default":r[2]}),o=t._ensureValidType(n.type),o&&(s.type=o),n.required&&(s.required=!0),n["default"]&&"object"==typeof n["default"])throw new TypeError("The default value for "+e+" cannot be an object/array, must be a value or a function which returns a value/object/array");s["default"]=n["default"],s.allowNull=n.allowNull?n.allowNull:!1,n.setOnce&&(s.setOnce=!0),s.required&&_.isUndefined(s["default"])&&(s["default"]=t._getDefaultForType(o)),s.test=n.test,s.values=n.values}return i&&(s.session=!0),Object.defineProperty(t,e,{set:function(t){this.set(e,t)},get:function(){var t=this._values[e],n=this._dataTypes[s.type];return"undefined"!=typeof t?(n&&n.get&&(t=n.get(t)),t):_.result(s,"default")}}),s}function s(t,e,n){var i=t._derived[e]={fn:_.isFunction(n)?n:n.fn,cache:n.cache!==!1,depList:n.deps||[]};_.each(i.depList,function(n){t._deps[n]=_(t._deps[n]||[]).union([e])}),Object.defineProperty(t,e,{get:function(){return this._getDerivedProperty(e)},set:function(){throw new TypeError('"'+e+"\" is a derived property, it can't be set directly.")}})}function a(t){var e,n=this,i=[].slice.call(arguments);e=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return n.apply(this,arguments)},_.extend(e,n);var o=function(){this.constructor=e};o.prototype=n.prototype,e.prototype=new o,e.prototype._derived=_.extend({},n.prototype._derived),e.prototype._deps=_.extend({},n.prototype._deps),e.prototype._definition=_.extend({},n.prototype._definition),e.prototype._collections=_.extend({},n.prototype._collections),e.prototype._children=_.extend({},n.prototype._children),e.prototype._dataTypes=_.extend({},n.prototype._dataTypes||l),t&&i.forEach(function(t){var n=["dataTypes","props","session","derived","collections","children"];t.dataTypes&&_.each(t.dataTypes,function(t,n){e.prototype._dataTypes[n]=t}),t.props&&_.each(t.props,function(t,n){r(e.prototype,n,t)}),t.session&&_.each(t.session,function(t,n){r(e.prototype,n,t,!0)}),t.derived&&_.each(t.derived,function(t,n){s(e.prototype,n,t)}),t.collections&&_.each(t.collections,function(t,n){e.prototype._collections[n]=t}),t.children&&_.each(t.children,function(t,n){e.prototype._children[n]=t}),_.extend(e.prototype,_.omit(t,n))});Object.prototype.toString;return e.__super__=n.prototype,e}var u=/^change:/;_.extend(o.prototype,e,{extraProperties:"ignore",idAttribute:"id",namespaceAttribute:"namespace",typeAttribute:"modelType",initialize:function(){return this},getId:function(){return this[this.idAttribute]},getNamespace:function(){return this[this.namespaceAttribute]},getType:function(){return this[this.typeAttribute]},isNew:function(){return null==this.getId()},escape:function(t){return _.escape(this.get(t))},isValid:function(t){return this._validate({},_.extend(t||{},{validate:!0}))},parse:function(t,e){return t},serialize:function(){var t=this.getAttributes({props:!0},!0);return _.each(this._children,function(e,n){t[n]=this[n].serialize()},this),_.each(this._collections,function(e,n){t[n]=this[n].serialize()},this),t},set:function(t,e,n){var i,o,r,s,a,u,l,c,d,h,p,f,m,g,b,y,v=this,w=this.extraProperties;if(_.isObject(t)||null===t?(d=t,n=e):(d={},d[t]=e),n=n||{},!this._validate(d,n))return!1;f=n.unset,p=n.silent,g=n.initial,o=[],i=this._changing,this._changing=!0,i||(this._previousAttributes=this.attributes,this._changed={});for(c in d){if(s=d[c],r=typeof s,m=this._values[c],a=this._definition[c],!a){if(this._children[c]||this._collections[c]){this[c].set(s,n);continue}if("ignore"===w)continue;if("reject"===w)throw new TypeError('No "'+c+'" property defined on '+(this.type||"this")+' model and extraProperties not set to "ignore" or "allow"');if("allow"===w)a=this._createPropertyDefinition(c,"any");else if(w)throw new TypeError('Invalid value for extraProperties: "'+w+'"')}if(y=this._getCompareForType(a.type),h=this._dataTypes[a.type],h&&h.set&&(u=h.set(s),s=u.val,r=u.type),a.test&&(l=a.test.call(this,s,r)))throw new TypeError("Property '"+c+"' failed validation with error: "+l);if(_.isUndefined(s)&&a.required)throw new TypeError("Required property '"+c+"' must be of type "+a.type+". Tried to set "+s);if(_.isNull(s)&&a.required&&!a.allowNull)throw new TypeError("Property '"+c+"' must be of type "+a.type+" (cannot be null). Tried to set "+s);if(a.type&&"any"!==a.type&&a.type!==r&&!_.isNull(s)&&!_.isUndefined(s))throw new TypeError("Property '"+c+"' must be of type "+a.type+". Tried to set "+s);if(a.values&&!_.contains(a.values,s))throw new TypeError("Property '"+c+"' must be one of values: "+a.values.join(", ")+". Tried to set "+s);if(b=!y(m,s,c),a.setOnce&&void 0!==m&&b)throw new TypeError("Property '"+t+"' can only be set once.");b?(o.push({prev:m,val:s,key:c}),v._changed[c]=s):delete v._changed[c]}if(_.each(o,function(t){v._previousAttributes[t.key]=t.prev,f?delete v._values[t.key]:v._values[t.key]=t.val}),!p&&o.length&&(v._pending=!0),p||_.each(o,function(t){v.trigger("change:"+t.key,v,t.val,n)}),i)return this;if(!p)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},get:function(t){return this[t]},toggle:function(t){var e=this._definition[t];if("boolean"===e.type)this[t]=!this[t];else{if(!e||!e.values)throw new TypeError("Can only toggle properties that are type `boolean` or have `values` array.");this[t]=i(e.values,this[t])}return this},previousAttributes:function(){return _.clone(this._previousAttributes)},hasChanged:function(t){return null==t?!_.isEmpty(this._changed):_.has(this._changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?_.clone(this._changed):!1;var e,n,i,o=!1,r=this._changing?this._previousAttributes:this.attributes;for(var s in t)n=this._definition[s],n&&(i=this._getCompareForType(n.type),i(r[s],e=t[s])||((o||(o={}))[s]=e));return o},toJSON:function(){return this.serialize()},unset:function(t,e){var n,i=this._definition[t];i.type;return i.required?(n=_.result(i,"default"),this.set(t,n,e)):this.set(t,n,_.extend({},e,{unset:!0}))},clear:function(t){var e=this;return _.each(_.keys(this.attributes),function(n){e.unset(n,t)}),this},previous:function(t){return null!=t&&Object.keys(this._previousAttributes).length?this._previousAttributes[t]:null},_getDefaultForType:function(t){var e=this._dataTypes[t];return e&&e["default"]},_getCompareForType:function(t){var e=this._dataTypes[t];return e&&e.compare?_.bind(e.compare,this):_.isEqual},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=_.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return n?(this.trigger("invalid",this,n,_.extend(e||{},{validationError:n})),!1):!0},_createPropertyDefinition:function(t,e,n){return r(this,t,e,n)},_ensureValidType:function(t){return _.contains(["string","number","boolean","array","object","date","any"].concat(_.keys(this._dataTypes)),t)?t:void 0},getAttributes:function(t,e){t||(t={}),_.defaults(t,{session:!1,props:!1,derived:!1});var n,i,o,r={};for(i in this._definition)o=this._definition[i],(t.session&&o.session||t.props&&!o.session)&&(n=e?this._values[i]:this[i],"undefined"==typeof n&&(n=_.result(o,"default")),"undefined"!=typeof n&&(r[i]=n));if(t.derived)for(i in this._derived)r[i]=this[i];return r},_initDerived:function(){var t=this;_.each(this._derived,function(e,n){var i=t._derived[n];i.deps=i.depList;var o=function(e){e=e||{};var o=i.fn.call(t);t._cache[n]===o&&i.cache||(i.cache&&(t._previousAttributes[n]=t._cache[n]),t._cache[n]=o,t.trigger("change:"+n,t,t._cache[n]))};i.deps.forEach(function(e){t._keyTree.add(e,o)})}),this.on("all",function(e){u.test(e)&&t._keyTree.get(e.split(":")[1]).forEach(function(t){t()})},this)},_getDerivedProperty:function(t,e){return this._derived[t].cache?(!e&&this._cache.hasOwnProperty(t)||(this._cache[t]=this._derived[t].fn.apply(this)),this._cache[t]):this._derived[t].fn.apply(this)},_initCollections:function(){var t;if(this._collections)for(t in this._collections)this[t]=new this._collections[t](null,{parent:this})},_initChildren:function(){var t;if(this._children)for(t in this._children)this[t]=new this._children[t]({},{parent:this}),this.listenTo(this[t],"all",this._getEventBubblingHandler(t))},_getEventBubblingHandler:function(t){return _.bind(function(e,n,i){u.test(e)?this.trigger("change:"+t+"."+e.split(":")[1],n,i):"change"===e&&this.trigger("change",this)},this)},_verifyRequired:function(){var t=this.attributes;for(var e in this._definition)if(this._definition[e].required&&"undefined"==typeof t[e])return!1;return!0}}),Object.defineProperties(o.prototype,{attributes:{get:function(){return this.getAttributes({props:!0,session:!0})}},all:{get:function(){return this.getAttributes({session:!0,props:!0,derived:!0})}},isState:{get:function(){return!0},set:function(){}}});var l={string:{"default":function(){return""}},date:{set:function(t){var e;if(_.isDate(t))e="date",t=t.valueOf();else try{var n=new Date(t).valueOf();if(isNaN(n)&&(n=new Date(parseInt(t,10)).valueOf(),isNaN(n)))throw TypeError;t=n,e="date"}catch(i){e=typeof t}return{val:t,type:e}},get:function(t){return new Date(t)},"default":function(){return new Date}},array:{set:function(t){return{val:t,type:_.isArray(t)?"array":typeof t}},"default":function(){return[]}},object:{set:function(t){var e=typeof t;return"object"!==e&&_.isUndefined(t)&&(t=null,e="object"),{val:t,type:e}},"default":function(){return{}}},state:{set:function(t){var e=t instanceof o||t&&t.isState;return e?{val:t,type:"state"}:{val:t,type:typeof t}},compare:function(t,e,n){var i=t===e;return i||(t&&this.stopListening(t),null!=e&&this.listenTo(e,"all",this._getEventBubblingHandler(n))),i}}};o.extend=a,t(o)};n.define("ampersandState",["backboneEvents","keyTreeStore"],i)}(this,this.document,this.modules),function(t,e,n){var i=function(t,e,n){var i=function(){throw new Error('A "url" property or function must be specified')},o=function(t,o,s){var a=r[t],u={};_.defaults(s||(s={}),{emulateHTTP:!1,emulateJSON:!1,xhrImplementation:n});var l={type:a};s.url||(s.url=_.result(o,"url")||i()),null!=s.data||!o||"create"!==t&&"update"!==t&&"patch"!==t||(l.json=s.attrs||o.toJSON(s)),s.data&&"GET"===a&&(s.url+=_.contains(s.url,"?")?"&":"?",s.url+=e.stringify(s.data)),s.emulateJSON&&(u["Content-Type"]="application/x-www-form-urlencoded",l.body=l.json?{model:l.json}:{},delete l.json),!s.emulateHTTP||"PUT"!==a&&"DELETE"!==a&&"PATCH"!==a||(l.type="POST",s.emulateJSON&&(l.body._method=a),u["X-HTTP-Method-Override"]=a),s.emulateJSON&&(l.body=e.stringify(l.body));var c=_.result(o,"ajaxConfig")||{};if(c.headers&&_.extend(u,c.headers),l.headers=u,c.useXDR&&(l.useXDR=!0),c.xhrFields){var d=c.beforeSend;l.beforeSend=function(t){for(var e in c.xhrFields)t[e]=c.xhrFields[e];return d?d.apply(this,arguments):void 0},l.xhrFields=c.xhrFields}else l.beforeSend=c.beforeSend;l.method=l.type;var h=_.extend(l,s),p=s.xhr=s.xhrImplementation(h,function(t,e,n){if(t&&s.error)return s.error(e,"error",t.message);if(n&&"string"==typeof n)try{n=JSON.parse(n)}catch(t){if(s.error)return s.error(e,"error",t.message)}return s.success?s.success(n,"success",e):void 0});return o.trigger("request",o,p,s,h),p.ajaxSettings=h,p},r={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t(o)};n.define("ampersandSync",["qs","xhr"],i)}(this,this.document,this.modules),function(t,e,n){var i=function(t,e,n,i,o,r,s){function a(t,e){if(-1==e.indexOf(".")&&-1==e.indexOf("["))return t[e];for(var n,i=e.split(/\.|\[|\]/g),o=-1,r=i.length;++o<r;)if(0==o&&(n=t),i[o]){if(void 0==n)break;n=n[i[o]]}return n}function u(t){this.cid=_.uniqueId("view"),t||(t={});var e=t.parent;delete t.parent,l.call(this,t,{init:!1,parent:e}),this.on("change:el",this._handleElementChange,this),this._parsedBindings=n(this.bindings,this),this._initializeBindings(),t.el&&!this.autoRender&&this._handleElementChange(),this._initializeSubviews(),this.template=t.template||this.template,this.initialize.apply(this,arguments),this.set(_.pick(t,c)),this.autoRender&&this.template&&this.render()}var l=e.extend({dataTypes:{element:{set:function(t){return{val:t,type:t instanceof Element?"element":typeof t}},compare:function(t,e){return t===e}},collection:{set:function(t){return{val:t,type:t&&t.isCollection?"collection":typeof t}},compare:function(t,e){return t===e}}},props:{model:"state",el:"element",collection:"collection"},derived:{rendered:{deps:["el"],fn:function(){return!!this.el}},hasData:{deps:["model"],fn:function(){return!!this.model}}}}),c=["model","collection","el"];u.prototype=Object.create(l.prototype),_.extend(u.prototype,{query:function(t){return t?"string"==typeof t?o(this.el,t)?this.el:this.el.querySelector(t)||void 0:t:this.el},queryAll:function(t){var e=[];return this.el?""===t?[this.el]:(o(this.el,t)&&e.push(this.el),e.concat(Array.prototype.slice.call(this.el.querySelectorAll(t)))):e},queryByHook:function(t){return this.query('[data-hook~="'+t+'"]')},initialize:function(){},render:function(){return this.renderWithTemplate(this),this},remove:function(){var t=this._parsedBindings;return this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el),this._subviews&&_.chain(this._subviews).flatten().invoke("remove"),this.stopListening(),_.each(t,function(e,n){_.each(e,function(e,i){delete t[n][i]}),delete t[n]}),this.trigger("remove",this),this},_handleElementChange:function(t,e){return this.eventManager&&this.eventManager.unbind(),this.eventManager=i(this.el,this),this.delegateEvents(),this._applyBindingsForKey(),this},delegateEvents:function(t){if(!t&&!(t=_.result(this,"events")))return this;this.undelegateEvents();for(var e in t)this.eventManager.bind(e,t[e]);return this},undelegateEvents:function(){return this.eventManager.unbind(),this},registerSubview:function(t){return this._subviews||(this._subviews=[]),this._subviews.push(t),t.el&&(t.parent=this),t},renderSubview:function(t,e){return"string"==typeof e&&(e=this.query(e)),this.registerSubview(t),t.render(),(e||this.el).appendChild(t.el),t},_applyBindingsForKey:function(t){if(this.el){var e,n=this._parsedBindings.getGrouped(t);for(e in n)n[e].forEach(function(t){t(this.el,a(this,e),_.last(e.split(".")))},this)}},_initializeBindings:function(){this.bindings&&this.on("all",function(t){"change:"===t.slice(0,7)&&this._applyBindingsForKey(t.split(":")[1])},this)},_initializeSubviews:function(){if(this.subviews)for(var t in this.subviews)this._parseSubview(this.subviews[t],t)},_parseSubview:function(t,e){function n(){var t,i;this.el&&(t=this.query(o.selector))&&(o.waitFor&&!a(this,o.waitFor)||(i=this[e]=o.prepareView.call(this,t),i.render(),this.registerSubview(i),this.off("change",n)))}var i=this,o={selector:t.container||'[data-hook="'+t.hook+'"]',waitFor:t.waitFor||"",prepareView:t.prepareView||function(e){return new t.constructor({el:e,parent:i})}};this.on("change",n,this)},renderWithTemplate:function(t,e){var n=e||this.template;if(!n)throw new Error("Template string or function needed.");var i=_.isString(n)?n:n.call(this,t||this);_.isString(i)&&(i=r(i));var o=this.el&&this.el.parentNode;if(o&&o.replaceChild(i,this.el),"#document-fragment"===i.nodeName)throw new Error("Views can only have one root element.");return this.el=i,this},cacheElements:function(t){for(var e in t)this[e]=this.query(t[e])},listenToAndRun:function(t,e,n){var i=_.bind(n,this);this.listenTo(t,e,i),i()},animateRemove:function(){this.remove()},renderCollection:function(t,e,n,i){var o="string"==typeof n?this.query(n):n,r=_.extend({collection:t,el:o||this.el,view:e,parent:this,viewOptions:{parent:this}},i),a=new s(r);return a.render(),this.registerSubview(a)}}),u.extend=l.extend,t(u)};n.define("ampersandView",["ampersandState","ampersandDomBinding","eventsMixin","matchesSelector","domify","ampersandCollectionView"],i)}(this,this.document,this.modules),function(t,e,n){var i={},o=Array.prototype.forEach,r=Object.prototype.hasOwnProperty,s=Array.prototype.slice,a=0,u=function(t){function e(){return{keys:Object.keys||function(t){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError("keys() called on a non-object");var e,n=[];for(e in t)t.hasOwnProperty(e)&&(n[n.length]=e);return n},uniqueId:function(t){var e=++a+"";return t?t+e:e},has:function(t,e){return r.call(t,e)},each:function(t,e,n){if(null!=t)if(o&&t.forEach===o)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,s=t.length;s>r;r++)if(e.call(n,t[r],r,t)===i)return}else for(var a in t)if(this.has(t,a)&&e.call(n,t[a],a,t)===i)return},once:function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}}}}var n,u=e();n={on:function(t,e,n){if(!c(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var i=this._events[t]||(this._events[t]=[]);return i.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!c(this,"once",t,[e,n])||!e)return this;var i=this,o=u.once(function(){i.off(t,o),e.apply(this,arguments)});return o._callback=e,this.on(t,o,n)},off:function(t,e,n){var i,o,r,s,a,l,d,h;if(!this._events||!c(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(s=t?[t]:u.keys(this._events),a=0,l=s.length;l>a;a++)if(t=s[a],r=this._events[t]){if(this._events[t]=i=[],e||n)for(d=0,h=r.length;h>d;d++)o=r[d],(e&&e!==o.callback&&e!==o.callback._callback||n&&n!==o.context)&&i.push(o);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!c(this,"trigger",t,e))return this;var n=this._events[t],i=this._events.all;return n&&d(n,e),i&&d(i,arguments),this},stopListening:function(t,e,n){var i=this._listeners;if(!i)return this;var o=!e&&!n;"object"==typeof e&&(n=this),t&&((i={})[t._listenerId]=t);for(var r in i)i[r].off(e,n,this),o&&delete this._listeners[r];return this}};var l=/\s+/,c=function(t,e,n,i){if(!n)return!0;if("object"==typeof n){for(var o in n)t[e].apply(t,[o,n[o]].concat(i));return!1}if(l.test(n)){for(var r=n.split(l),s=0,a=r.length;a>s;s++)t[e].apply(t,[r[s]].concat(i));return!1}return!0},d=function(t,e){var n,i=-1,o=t.length,r=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++i<o;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r);return;case 2:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r,s);return;case 3:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r,s,a);return;default:for(;++i<o;)(n=t[i]).callback.apply(n.ctx,e)}},h={listenTo:"on",listenToOnce:"once"};u.each(h,function(t,e){n[e]=function(e,n,i){var o=this._listeners||(this._listeners={}),r=e._listenerId||(e._listenerId=u.uniqueId("l"));return o[r]=e,"object"==typeof n&&(i=this),e[t](n,i,this),this}}),n.bind=n.on,n.unbind=n.off,n.mixin=function(t){var e=["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"];return u.each(e,function(e){t[e]=this[e]},this),t},t(n)};n.define("backboneEvents",[],u)}(this,this.document,this.modules),function(t,e,n){var i=function(t,n){var i=function(t,i,o){for(var r=o?t:t.parentNode;r&&r!==e;){if(n(r,i))return r;r=r.parentNode}};t(i)};n.define("closest",["matchesSelector"],i)}(this,this.document,this.modules),function(t,e,n){var i=function(e){var n={},i=t.addEventListener?"addEventListener":"attachEvent",o=t.removeEventListener?"removeEventListener":"detachEvent",r="addEventListener"!==i?"on":"";n.bind=function(t,e,n,o){return t[i](r+e,n,o||!1),n},n.unbind=function(t,e,n,i){return t[o](r+e,n,i||!1),n},e(n)};n.define("ampersandEvent",[],i)}(this,this.document,this.modules),function(t,e,n){var i=function(t,e,n){var i={},o=["focus","blur"];i.bind=function(t,i,r,s,a){return-1!==o.indexOf(r)&&(a=!0),e.bind(t,r,function(e){var o=e.target||e.srcElement;e.delegateTarget=n(o,i,!0,t),e.delegateTarget&&s.call(t,e)},a)},i.unbind=function(t,n,i,r){-1!==o.indexOf(n)&&(r=!0),e.unbind(t,n,i,r)},t(i)};n.define("delegateEvents",["ampersandEvent","closest"],i);
}(this,this.document,this.modules),function(t,e,n){var i=function(t){function n(t,n){if("string"!=typeof t)throw new TypeError("String expected");n||(n=e);var i=/<([\w:]+)/.exec(t);if(!i)return n.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var o=i[1];if("body"==o){var s=n.createElement("html");return s.innerHTML=t,s.removeChild(s.lastChild)}var a=r[o]||r._default,u=a[0],l=a[1],c=a[2],s=n.createElement("div");for(s.innerHTML=l+t+c;u--;)s=s.lastChild;if(s.firstChild==s.lastChild)return s.removeChild(s.firstChild);for(var d=n.createDocumentFragment();s.firstChild;)d.appendChild(s.removeChild(s.firstChild));return d}var i=e.createElement("div");i.innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>';var o=!i.getElementsByTagName("link").length;i=void 0;var r={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:o?[1,"X<div>","</div>"]:[0,"",""]};r.td=r.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],r.option=r.optgroup=[1,'<select multiple="multiple">',"</select>"],r.thead=r.tbody=r.colgroup=r.caption=r.tfoot=[1,"<table>","</table>"],r.text=r.circle=r.ellipse=r.line=r.path=r.polygon=r.polyline=r.rect=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"],t(n)};n.define("domify",[],i)}(this,this.document,this.modules),function(t,e,n){var i=function(t,e,n){function i(t,e){if(!(this instanceof i))return new i(t,e);if(!t)throw new Error("element required");if(!e)throw new Error("object required");this.el=t,this.obj=e,this._events={}}function o(t){var e=t.split(/ +/);return{name:e.shift(),selector:e.join(" ")}}var r=["focus","blur"];i.prototype.sub=function(t,e,n){this._events[t]=this._events[t]||{},this._events[t][e]=n},i.prototype.bind=function(t,i){function r(){var t=[].slice.call(arguments).concat(c);u[i].apply(u,t)}var s=o(t),a=this.el,u=this.obj,l=s.name,i=i||"on"+l,c=[].slice.call(arguments,2);return s.selector?r=n.bind(a,s.selector,l,r):e.bind(a,l,r),this.sub(l,i,r),r},i.prototype.unbind=function(t,n){if(0==arguments.length)return this.unbindAll();if(1==arguments.length)return this.unbindAllOf(t);var i=this._events[t],o=-1!==r.indexOf(t);if(i){var s=i[n];s&&e.unbind(this.el,t,s,o)}},i.prototype.unbindAll=function(){for(var t in this._events)this.unbindAllOf(t)},i.prototype.unbindAllOf=function(t){var e=this._events[t];if(e)for(var n in e)this.unbind(t,n)},t(i)};n.define("eventsMixin",["ampersandEvent","delegateEvents"],i)}(this,this.document,this.modules),function(t,e){var n=function(t){var e=[],n=e.forEach,i=e.slice,o=function(t){return n.call(i.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t};t(o)};e.define("extendObject",[],n)}(this,this.modules),function(t,e){var n=function(e){function n(e){var n=a.call(e);return"[object Function]"===n||"function"==typeof e&&"[object RegExp]"!==n||"undefined"!=typeof t&&(e===t.setTimeout||e===t.alert||e===t.confirm||e===t.prompt)}function i(t,e,i){if(!n(e))throw new TypeError("iterator must be a function");arguments.length<3&&(i=this),"[object Array]"===a.call(t)?o(t,e,i):"string"==typeof t?r(t,e,i):s(t,e,i)}function o(t,e,n){for(var i=0,o=t.length;o>i;i++)u.call(t,i)&&e.call(n,t[i],i,t)}function r(t,e,n){for(var i=0,o=t.length;o>i;i++)e.call(n,t.charAt(i),i,t)}function s(t,e,n){for(var i in t)u.call(t,i)&&e.call(n,t[i],i,t)}var a=Object.prototype.toString,u=Object.prototype.hasOwnProperty,a=Object.prototype.toString;e(i)};e.define("forEach",[],n)}(this,this.modules),function(t,e){var n=function(t){var e=Array.isArray,n=Object.prototype.toString,i=e||function(t){return!!t&&"[object Array]"==n.call(t)};t(i)};e.define("isArray",[],n)}(this,this.modules),function(t,e,n){var i=function(t){function e(){this.storage={}}var n=Array.prototype.slice;e.prototype.add=function(t,e){var n=this.storage[t]||(this.storage[t]=[]);n.push(e)},e.prototype.remove=function(t){var e,n;for(e in this.storage)n=this.storage[e],n.some(function(e,i){return e===t?(n.splice(i,1),!0):void 0})},e.prototype.get=function(t){var e,n=[];for(e in this.storage)t&&t!==e&&0!==e.indexOf(t+".")||(n=n.concat(this.storage[e]));return n},e.prototype.getGrouped=function(t){var e,i={};for(e in this.storage)t&&t!==e&&0!==e.indexOf(t+".")||(i[e]=n.call(this.storage[e]));return i},e.prototype.getAll=function(t){var e,i={};for(e in this.storage)t!==e&&0!==e.indexOf(t+".")||(i[e]=n.call(this.storage[e]));return i},e.prototype.run=function(t,e){var i=n.call(arguments,2);this.get(t).forEach(function(t){t.apply(e||this,i)})},t(e)};n.define("keyTreeStore",[],i)}(this,this.document,this.modules),function(t,e,n){var i=function(t){"use strict";function e(t,e){if(e="@"===e[0]?'[role="'+e.split("@")[1]+'"]':e,i)return i.call(t,e);for(var n=t.parentNode.querySelectorAll(e),o=0;o<n.length;o++)if(n[o]==t)return!0;return!1}var n=Element.prototype,i=n.matches||n.matchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector;t(e)};n.define("matchesSelector",[],i)}(this,this.document,this.modules),function(t,e){var n=function(t){function e(t){var e=!1;return function(){return e?void 0:(e=!0,t.apply(this,arguments))}}e.proto=e(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return e(this)},configurable:!0})}),t(e)};e.define("once",[],n)}(this,this.modules),function(t,e){var n=function(t,e,n){var i=function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=function(t){if(!t)return{};var o={};return n(e(t).split("\n"),function(t){var n=t.indexOf(":"),r=e(t.slice(0,n)).toLowerCase(),s=e(t.slice(n+1));"undefined"==typeof o[r]?o[r]=s:i(o[r])?o[r].push(s):o[r]=[o[r],s]}),o};t(o)};e.define("parseHeaders",["trim","forEach"],n)}(this,this.modules),function(t,e){var n=function(t,e){var n={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1e3};n.parseValues=function(t,n){for(var i={},o=t.split(n.delimiter,n.parameterLimit===1/0?void 0:n.parameterLimit),r=0,s=o.length;s>r;++r){var a=o[r],u=-1===a.indexOf("]=")?a.indexOf("="):a.indexOf("]=")+1;if(-1===u)i[e.decode(a)]="";else{var l=e.decode(a.slice(0,u)),c=e.decode(a.slice(u+1));i.hasOwnProperty(l)?i[l]=[].concat(i[l]).concat(c):i[l]=c}}return i},n.parseObject=function(t,e,i){if(!t.length)return e;var o=t.shift(),r={};if("[]"===o)r=[],r=r.concat(n.parseObject(t,e,i));else{var s="["===o[0]&&"]"===o[o.length-1]?o.slice(1,o.length-1):o,a=parseInt(s,10),u=""+a;!isNaN(a)&&o!==s&&u===s&&a>=0&&a<=i.arrayLimit?(r=[],r[a]=n.parseObject(t,e,i)):r[s]=n.parseObject(t,e,i)}return r},n.parseKeys=function(t,e,i){if(t){var o=/^([^\[\]]*)/,r=/(\[[^\[\]]*\])/g,s=o.exec(t);if(!Object.prototype.hasOwnProperty(s[1])){var a=[];s[1]&&a.push(s[1]);for(var u=0;null!==(s=r.exec(t))&&u<i.depth;)++u,Object.prototype.hasOwnProperty(s[1].replace(/\[|\]/g,""))||a.push(s[1]);return s&&a.push("["+t.slice(s.index)+"]"),n.parseObject(a,e,i)}}};var i=function(t,i){if(""===t||null===t||"undefined"==typeof t)return{};i=i||{},i.delimiter="string"==typeof i.delimiter||e.isRegExp(i.delimiter)?i.delimiter:n.delimiter,i.depth="number"==typeof i.depth?i.depth:n.depth,i.arrayLimit="number"==typeof i.arrayLimit?i.arrayLimit:n.arrayLimit,i.parameterLimit="number"==typeof i.parameterLimit?i.parameterLimit:n.parameterLimit;for(var o="string"==typeof t?n.parseValues(t,i):t,r={},s=Object.keys(o),a=0,u=s.length;u>a;++a){var l=s[a],c=n.parseKeys(l,o[l],i);r=e.merge(r,c)}return e.compact(r)};t(i)};e.define("parse",["utils"],n)}(this,this.modules),function(t,e){var n=function(t,e,n){var i={stringify:e,parse:n};t(i)};e.define("qs",["stringify","parse"],n)}(this,this.modules),function(t,e){var n=function(t,e){var n={delimiter:"&",indices:!0};n.stringify=function(t,i,o){if(e.isBuffer(t)?t=t.toString():t instanceof Date?t=t.toISOString():null===t&&(t=""),"string"==typeof t||"number"==typeof t||"boolean"==typeof t)return[encodeURIComponent(i)+"="+encodeURIComponent(t)];var r=[];if("undefined"==typeof t)return r;for(var s=Object.keys(t),a=0,u=s.length;u>a;++a){var l=s[a];r=!o.indices&&Array.isArray(t)?r.concat(n.stringify(t[l],i,o)):r.concat(n.stringify(t[l],i+"["+l+"]",o))}return r};var i=function(t,e){e=e||{};var i="undefined"==typeof e.delimiter?n.delimiter:e.delimiter;e.indices="boolean"==typeof e.indices?e.indices:n.indices;var o=[];if("object"!=typeof t||null===t)return"";for(var r=Object.keys(t),s=0,a=r.length;a>s;++s){var u=r[s];o=o.concat(n.stringify(t[u],u,e))}return o.join(i)};t(i)};e.define("stringify",["utils"],n)}(this,this.modules),function(t,e){var n=function(t){function e(t){return t.replace(/^\s*|\s*$/g,"")}var n=e;n.left=function(t){return t.replace(/^\s*/,"")},n.right=function(t){return t.replace(/\s*$/,"")},t(n)};e.define("trim",[],n)}(this,this.modules),function(t,e){var n=function(t){var e={};e.arrayToObject=function(t){for(var e={},n=0,i=t.length;i>n;++n)"undefined"!=typeof t[n]&&(e[n]=t[n]);return e},e.merge=function(t,n){if(!n)return t;if("object"!=typeof n)return Array.isArray(t)?t.push(n):t[n]=!0,t;if("object"!=typeof t)return t=[t].concat(n);Array.isArray(t)&&!Array.isArray(n)&&(t=e.arrayToObject(t));for(var i=Object.keys(n),o=0,r=i.length;r>o;++o){var s=i[o],a=n[s];t[s]?t[s]=e.merge(t[s],a):t[s]=a}return t},e.decode=function(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}},e.compact=function(t,n){if("object"!=typeof t||null===t)return t;n=n||[];var i=n.indexOf(t);if(-1!==i)return n[i];if(n.push(t),Array.isArray(t)){for(var o=[],r=0,s=t.length;s>r;++r)"undefined"!=typeof t[r]&&o.push(t[r]);return o}var a=Object.keys(t);for(r=0,s=a.length;s>r;++r){var u=a[r];t[u]=e.compact(t[u],n)}return t},e.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},e.isBuffer=function(t){return null===t||"undefined"==typeof t?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},t(e)};e.define("utils",[],n)}(this,this.modules),function(t,e){var n=function(e,n,i){function o(t,e){function o(){4===m.readyState&&C()}function l(){var t=null;if(m.response?t=m.response:"text"!==m.responseType&&m.responseType||(t=m.responseText||m.responseXML),k)try{t=JSON.parse(t)}catch(e){}return t}function c(){return 1223===m.status?204:m.status}function d(t){var e=null;if(0===t||t>=400&&600>t){var n=("string"==typeof y?y:!1)||s[String(t).charAt(0)];e=new Error(n),e.statusCode=t}return e}function h(){var t=c(),n=d(t),o={body:l(),statusCode:t,statusText:m.statusText,raw:m};m.getAllResponseHeaders?o.headers=i(m.getAllResponseHeaders()):o.headers={},e(n,o,o.body)}function p(){var t=c(),n=d(t);m.status=m.statusCode=t,m.body=l(),m.headers=i(m.getAllResponseHeaders()),e(n,m,m.body)}function f(t){e(t,m)}"string"==typeof t&&(t={uri:t}),t=t||{},e=n(e);var m=t.xhr||null;m||(m=t.cors||t.useXDR?new u:new a);var g,b=m.url=t.uri||t.url,_=m.method=t.method||"GET",y=t.body||t.data,v=m.headers=t.headers||{},w=!!t.sync,k=!1,C=t.response?h:p;if("json"in t&&(k=!0,v.Accept="application/json","GET"!==_&&"HEAD"!==_&&(v["Content-Type"]="application/json",y=JSON.stringify(t.json))),m.onreadystatechange=o,m.onload=C,m.onerror=f,m.onprogress=function(){},m.ontimeout=r,m.open(_,b,!w),(t.withCredentials||t.cors&&t.withCredentials!==!1)&&(m.withCredentials=!0),w||(m.timeout="timeout"in t?t.timeout:5e3),m.setRequestHeader)for(g in v)v.hasOwnProperty(g)&&m.setRequestHeader(g,v[g]);else if(t.headers)throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in t&&(m.responseType=t.responseType),"beforeSend"in t&&"function"==typeof t.beforeSend&&t.beforeSend(m),m.send(y),m}function r(){}var s={0:"Internal XMLHttpRequest Error",4:"4xx Client Error",5:"5xx Server Error"},a=t.XMLHttpRequest||r,u="withCredentials"in new a?a:t.XDomainRequest;e(o)};e.define("xhr",["once","parseHeaders"],n)}(this,this.modules),function(t,e,n,i){e.define("initAboutPage",[],function(t){var e=n("@bm-page-about-image-team"),o=0,r=null,s=function(){r&&(clearTimeout(r),r=null),r=setTimeout(function(){o=0},1500),o+=1,o>=5&&(o=0,e.hasClass("m-wow-so-team-such-collaboration-very-together")?e.removeClass("m-wow-so-team-such-collaboration-very-together"):e.addClass("m-wow-so-team-such-collaboration-very-together"))};i.tools.client.isTouch()?e.on(i.tools.client.touchEvent,s):e.on("click",s),t()})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("initAboutLegal",[],function(e){var o=i.tools.client.isTouch()?"tap":"click",r=n(t),s=n(".bm-page-about-content-legal-header"),a=s.offset().top+s.outerHeight(),u=n(".bm-page-about-content-legal-nav"),l=!1,c=n(".bm-page-about-content-legal-part"),d=null;n.fn.dataFilter=function(t,e){return this.map(function(){var i=n(this).data(t);return i===e?this:void 0})};var h=function(){var t=l?u.outerHeight():0;s.css({"margin-bottom":t})},p=function(){l=r.scrollTop()>=a,u.toggleClass("fixed",l),h()},f=function(t){t.preventDefault();var e=n(this).data("rel");d=c.dataFilter("rel",e),r.scrollTop(d.offset().top-u.outerHeight())};r.on("scroll",p).on("resize",h),u.on(o,"a",f),p(),setTimeout(function(){l&&n.scrollTo({top:"-="+u.outerHeight()+"px",left:"+=0px"})},500),e()})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("initAboutPress",[],function(e){var o=i.tools.client.isTouch()?"tap":"click";n("._five-item-step-wrapper").each(function(){var t=n(this),e=t.find("._five-item-step-item"),i=t.find(".m-link-more"),r=0,s=5*r,a=e.length,u=function(){if(a>s){r++,s=5*r;for(var t=0;s>t;t++)e.eq(t)&&e.eq(t).css({display:"block"})}s>a&&i.css({display:"none"})};u(),i.on(o,function(t){t.preventDefault(),u()})}),function(){function e(t){var e=i.filter(function(e){return e.name===t})[0];return e.index>=e.photos_count?e.index=1:e.index+=1,"/files/about_press/persons/"+e.name+(1===e.index?"":e.index)+".jpg"}if(t.location.hash&&-1!==t.location.hash.indexOf("super-secret")){var i=[{name:"chugunov",index:1,photos_count:12},{name:"landazabal",index:1,photos_count:7},{name:"rakova",index:1,photos_count:9},{name:"voronina",index:1,photos_count:5},{name:"yurinova",index:1,photos_count:9}];try{i.map(function(t){return t.name}).forEach(function(t){var i=n("[data-person-last-name="+t+"]"),o=i.find(".person-photo"),r=i.find(".person-bio");r.on("click",function(){try{o.attr("src",e(t))}catch(n){}})})}catch(o){}}}(),e()})}(this,this.modules,this.jQuery,this.BM),function(t,e,n){"use strict";e.define("activityInit",["ActivityLoader","UpLink","FriendSuggestion","blockSocialConnect"],function(t,e,i,o,r){var s,a,u=n(".bm-activity-wrapper");if(u.length>0){s=new e(u),a=new i(u);var l=new o;s.makeReplaceable(l.$b)}var c=n("@block-social-connect");c.length>0&&r.init(c,"friends")})}(this,this.modules,this.jQuery),function(t,e,n,i){"use strict";var o=function(){e(".bm-pirates-library .bookmate-button").on("click",function(){i("send","event","anti-piracy","button-read")})};n.require([],o)}(this,this.jQuery,this.modules,this.ga),function(t,e,n,i){"use strict";var o=function(t){var e=n(".bookpage-annotation");e.condense({moreText:e.data("more"),lessText:e.data("less"),delim:".",ellipsis:"",moreSpeed:"fast",lessSpeed:"fast",condensedLength:600}),t()};i.define("bookpageAnnotation",[],o)}(this,this.document,this.jQuery,this.modules),function(t,e,n,i){e.define("bookPage",["documentMain"],function(t,e){var o=i(".bm-document-popup"),r=n.user.getLogin(),s=n.user.getViewingUserLogin(),a=o.data("book-uuid"),u=o.data("document-uuid"),l=o.data("document-lc-uuid"),c=o.data("lc-uuid"),d={currentUserLogin:r,viewingUserLogin:s,book_uuid:a,document_uuid:u||l,document_lc_uuid:l,lc_uuid:c},h=new e;h.init(d),t({})})}(this,this.modules,this.BM,this.jQuery),function(t){"use strict";var e=function(t){t({})};t.define("bookpageInit",["bookPage"],e)}(this.modules),function(t,e,n,i,o){"use strict";o.define("bookshelvesInit",["loginWindow","BookshelvesListInitializer"],function(e,i,o){var r=function(){function e(){_classCallCheck(this,e),this._checkAccess(),this._setElements(),this._setEventListeners(),this._initList()}return e.prototype._setElements=function(){this.$listContainer=n("@bookshelves-list-container"),this.$createBookshelfButton=n("@bookshelves-create-button")},e.prototype._setEventListeners=function(){var t=this;this.$createBookshelfButton.on("click",function(e){return t._onNewBookshelfButtonClick(e)})},e.prototype._initList=function(){this.list=new o(this.$listContainer,{pagingAllowed:!0,pagingUrl:this._getUrl(),pageCount:1,autoFetch:!0,context:"library"})},e.prototype._onNewBookshelfButtonClick=function(e){var n=this;BM.user.isUserPresent()||(e.preventDefault(),this.btnLoginWindow||(this.btnLoginWindow=new i({context:"bookshelf_create",preventDefaultLoginBehavior:!0}),this.btnLoginWindow.showWindow("inital"),this.btnLoginWindow.on("authenticationSuccessful",function(){t.location.href=n.$createBookshelfButton.attr("href")})))},e.prototype._getUrl=function(){return"/bookshelves/editorial"==t.location.pathname?"/a/4/bs/editorial.json":"/bookshelves/mine"==t.location.pathname?"/a/4/u/bs.json":"/bookshelves"==t.location.pathname?"/a/4/bs/hot.json":void 0},e.prototype._checkAccess=function(){this.isMine()&&!BM.user.isUserPresent()&&(t.location.search="")},e.prototype.isMine=function(){return t.location.search.indexOf("mine=true")>-1},e}(),s=new r;e(s)})}(this,this.document,this.jQuery,this.radio,this.modules),function(t,e,n,i){"use strict";n.define("AttachmentBookItemProcessor",["modules","TemplateFactory"],function(t,e,n){var i=function(){var t=function(){var t=this;t.bookItemTemplateFactory=new n("#bm-bookshelf-attachment-book-template"),t.bookItemTemplateFactoryCoverless=new n("#bm-bookshelf-attachment-book-template-coverless")};return t.prototype={getItem:function(t){var e,n=this;return t.cover&&t.cover.url?(e=n.bookItemTemplateFactory.getInstance(),e.find("img").attr("src",t.cover.url)):(e=n.bookItemTemplateFactoryCoverless.getInstance(),e.find(".bm-bookmate-book-generated-cover-title-content").html(t.title),e.find(".bm-bookmate-book-generated-cover-authors").html(t.authors)),e.data("uuid",t.uuid),e}},t}();e.ItemProcessor=i,t(i)})}(this,this.jQuery,this.modules,this.BM),function(t,e,n,i){"use strict";n.define("BookSearchItemProcessor",["modules","TemplateFactory"],function(t,e,n){var i=function(){var t=function(){var t=this;t.bookItemTemplateFactory=new n("#bookmate-book-search-item-template"),t.bookItemTemplateFactoryCoverless=new n("#bookmate-book-search-item-template-coverless")};return t.prototype={getItem:function(t){var e,n=this;if(t.cover&&t.cover.url?(e=n.bookItemTemplateFactory.getInstance(),e.find("img").attr("src",t.cover.url)):(e=n.bookItemTemplateFactoryCoverless.getInstance(),e.find(".bm-bookmate-book-generated-cover-title-content").html(t.title),e.find(".bm-bookmate-book-generated-cover-authors").html(t.authors)),e.attr("data-uuid",t.uuid),e.attr("data-book-uuid",t.book_uuid),t.labels){var i=_.pluck(t.labels,"kind"),o=e.find(".bookcard-label"),r=o.find("> a"),s=i[0],a=r.data("free"),u=r.data("subscription");"free"===s?(r.attr("href","/search?query=#"+a),r.addClass("free"),r.html(a)):"subscription"===s?(r.removeAttr("href"),r.removeClass("free"),r.html(u)):o.remove()}else e.find(".bookcard-label").remove();return e.find(">a").attr("href","/documents/"+t.uuid+"/book"),e.find("h5").html(t.title),e.find("h6").html(t.authors),e}},t}();e.ItemProcessor=i,t(i)})}(this,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";n.define("BookSearchPopup",["extend","PopupBase","BookSearchItemProcessor","bookshelfDocumentsList","tools"],function(t,n,r,s,a,u){var l=n(r),c=l,d=c.superclass,h="bookmate-book-search-template";c.Context={READER:1},e.extend(c.prototype,{initialize:function(){this._stopPropagation=!1,this._context=null,this.itemProcessor=new s,d.initialize.apply(this,arguments),this.$backButton=this._element.find(".back-to-library-icon"),this.$searchInput=this._element.find("input"),this.$searchButton=this._element.find(".search-icon"),this.$body=this._element.find(".bm-book-search-popup-body"),this.$library=this._element.find(".bm-book-search-popup-body-user-library"),this.$libraryResultsContainer=this.$library.find(".bm-book-search-popup-books-list"),this.$searchResults=this._element.find(".bm-book-search-popup-body-search-result"),this.$searchResultsHeader=this.$searchResults.find("h4"),this.$searchResultsContainer=this.$searchResults.find(".bm-book-search-popup-body-search-result-container"),this.login=o.user.getLogin(),this.libraryPage=1,this.searchPage=1,this.pagingLibraryAllowed=!0,this.pagingSearchAllowed=!0,this.fl,this.resultsMessage=this.$searchResultsHeader.data("result"),this.emptyMessage=this.$searchResultsHeader.data("empty"),this._initListeners()},setConfig:function(t){d.setConfig.apply(this,arguments),t&&(t.stopPropagation&&(this._stopPropagation=t.stopPropagation),t.context&&(this._context=t.context))},hide:function(t){d.hide.apply(this,arguments),this.$library.removeClass("hidden"),this.$backButton.addClass("hidden"),this.$searchResults.addClass("hidden"),this.$searchInput.val(""),t||i("bm-book-search-popup-terminate").broadcast()},_initListeners:function(){var t=this;this.on("show",function(){t.markAsAdded()}),this.$searchInput.on("keyup",function(e){t.searchPage=1,13===e.which&&t._searchBooks(t.$searchInput.val(),!1)}),this.$searchButton.on("click",function(){t.searchPage=1,t._searchBooks(t.$searchInput.val(),!1)}),this.$backButton.on("click",function(){t.$searchResults.addClass("hidden"),t.$library.removeClass("hidden"),t.$backButton.addClass("hidden")}),this.$library.on("click","button",function(n){n.preventDefault(),n.stopPropagation(),t._onAddButtonClick(e(this).closest(".bm-bookmate-book-search-item"))}),this.$searchResultsContainer.on("click","button",function(n){n.preventDefault(),n.stopPropagation(),t._onAddButtonClick(e(this).closest(".bm-bookmate-book-search-item"))}),this.$library.on("scroll",function(e){t.pagingLibraryAllowed&&t.$library.scrollTop()>t.$library.height()*t.libraryPage-250&&(++t.libraryPage,t._loadLibraryPage())}),this.$searchResults.on("scroll",function(e){t.pagingSearchAllowed&&t.$searchResults.scrollTop()>t.$searchResults.height()*t.searchPage-250&&(++t.searchPage,t._searchBooks(void 0,!0))})},_loadLibraryPage:function(){var t=this;e.ajax({url:"/a/4/u/"+t.login+"/d/all.json",data:{page:t.libraryPage,per_page:20},success:function(e){0===e.length&&(t.pagingLibraryAllowed=!1),t._renderLibraryResult(e)}})},_searchBooks:function(t,n){var i=this,o=n?i.nextPageUrl:"/a/4/d/search.json?page=1&pp=15&query="+t;e.ajax({url:o,timeout:15e3,success:function(e){0===e.objects.length&&(i.pagingSearchAllowed=!1),i.nextPageUrl=e.meta.next_page,i._renderSearchResult(t,e.objects,n)}})},_onAddButtonClick:function(t){var e=t.find("img"),n={book_uuid:t.data("book-uuid"),uuid:t.data("uuid"),cover:{url:e.length>0?e.attr("src"):null},title:t.find("h5").html(),authors:t.find("h6").html()};this.hide(!0),i("bm-bookshelf-attachment-add").broadcast(n)},_renderLibraryResult:function(t){for(var e=0;e<t.length;e++)this.$libraryResultsContainer.append(this.itemProcessor.getItem(t[e]));this.markAsAdded()},_renderSearchResult:function(t,e,n){this.$library.addClass("hidden"),this.$backButton.removeClass("hidden"),this.$searchResults.removeClass("hidden"),this.$searchResultsHeader.text(t+" - "+this.resultsMessage),n||(this.$searchResultsContainer.html(""),0===e.length&&this.$searchResultsHeader.text('  "'+t+'"   '));for(var i=0;i<e.length;i++)this.$searchResultsContainer.append(this.itemProcessor.getItem(e[i]));this.markAsAdded()},_getTemplateName:function(){return h},markAsAdded:function(){var t=a.getDocuments(),n=e(".bm-bookmate-book-search-item");n.removeClass("m-added"),_.each(t,function(t){var e=n.filter('[data-uuid="'+t+'"]');e.length&&e.addClass("m-added")}.bind(this))}}),t(l)})}(this,this.jQuery,this.modules,this.radio,this.BM),function(t,e,n){"use strict";n.define("indexBookshelfCanvasProgress",["tools","canvasProgress"],function(t,n,i){var o=e("[role=canvas-progress-wrapper]"),r=null,s=function(){r||(r=new i({element:o,strokeWidth:2}))},a=function(t){n.isNumber(t)&&(s(),r.setProgress(t))},u=function(){s(),o.removeAttr("hidden")},l=function(){s(),o.attr("hidden","hidden")};t({show:u,hide:l,setProgress:a})})}(this,this.jQuery,this.modules),function(t,e,n,i,o){"use strict";n.define("coverGenerator",[],function(n){var i=this,r=["#4FB5F0","#a1de45","#f25091","#fc8053","#8d4ff0"],s=5,a="/images/bookshelf-patterns/",u="pattern-",l=".png",c=function(t){var n=e.createElement("canvas"),i=new Image;i.addEventListener("load",function(){var e=n.getContext("2d");n.width=this.width,n.height=this.height,e.rect(0,0,this.width,this.height),e.fillStyle=h(),e.fill(),e.drawImage(i,0,0,this.width,this.height,0,0,this.width,this.height);var r=n.toDataURL("image/png"),s=dataURItoBlob(r);t&&o.tools.isFunction(t)&&t({dataURL:r,blob:s})}),i.setAttribute("crossOrigin","anonymous"),i.src=d()},d=function(){var t=p(s);return f(t)},h=function(){var t=p(r.length);if(i.lastColorNumber&&i.lastColorNumber===t)for(;i.lastColorNumber===t;)t=p(r.length);return i.lastColorNumber=t,r[t]},p=function(t){return Math.floor(Math.random()*t)},f=function(e){var n=t.location.origin;return n+a+u+e+l};n({createCover:c})})}(this,this.document,this.modules,this.jQuery,this.BM),function(t,e,n,i,o,r){"use strict";n.define("bookshelfCoverUpload",["coverGenerator"],function(n,s){var a=this,u=e(".bm-bookshelf"),l=e(".bm-bookshelf-info-cover"),c=e(".bm-bookshelf-info-cover-generator-button-upload"),d=e(".bm-bookshelf-info-cover-generator-button-generate"),h=(d.find(".icon"),e("#cover-upload"),e("#cover-file")),p=l.find("img"),f=e("@progress-spinner"),m=e('meta[property="og:image"]'),g=u.attr("id"),b=void 0,_=void 0,y=function(t){f.removeClass("hidden")},v=function(t){f.addClass("hidden")},w=function(t){var e=t.responseJSON||JSON.parse(t.responseText);r("bm-bookshelf-error").broadcast(e.error.messages.bookshelf),f.addClass("hidden")},k=function(t){p.fadeOut(200,function(){p.attr("src",t)}),m.attr("content",t)},C=function(t){if(t.toString().indexOf("Blob")>0&&u.hasClass("m-new")&&k(b.dataURL),t.toString().indexOf("FileList")>0&&(_=t,u.hasClass("m-new")&&S(_)),g){var e=new i,n=new o;n.append("bs[cover]",t[0]),e.upload.onprogress=y,e.addEventListener("load",v,!1),e.addEventListener("error",w,!1),e.addEventListener("readystatechange",function(){4==e.readyState&&(200==e.status?k(JSON.parse(e.response).cover):w(e))},!1),e.open("PUT","/a/4/bs/"+g+".json"),e.send(n),f.removeClass("hidden")}},S=function(t){var e=new FileReader;e.onload=function(t){var e=t.target.result;k(e)},e.readAsDataURL(t[0])},x=function(){a.inProgress||(a.inProgress=!0,s.createCover(function(t){b=t,C([b.blob])}),a.generateTimer&&t.clearTimeout(a.generateTimer),a.generateTimer=setTimeout(function(){a.inProgress=!1},400))},E=function(){0===p.length&&(l.find(".bm-bookshelf-info-cover-dummy").remove(),p=e("<img/>"),l.prepend(p)),p.on("load",function(){p.fadeIn(200)})},P=function(){d.on("click",x)},T=function(){E(),P(),l.on({dragover:function(){return l.addClass("bm-bookshelf-cover-drop"),!1},drop:function(t){t.preventDefault(),l.removeClass("bm-bookshelf-cover-drop");var e=t.originalEvent.dataTransfer.files;e.length&&C(e)},mouseout:function(){l.removeClass("bm-bookshelf-cover-drop")}}),c.on("click",function(){e("#cover-file").click()}),h.on("change",function(){C(this.files)})},I=function(){x()};u.hasClass("editable")&&T(),u.hasClass("m-new")&&I(),r("bm-bookshelf-created").subscribe(function(t){g=t&&t.bookshelf_uuid?t.bookshelf_uuid:void 0,_&&C(_),b&&C([b.blob])}),n()})}(this,this.jQuery,this.modules,this.XMLHttpRequest,this.FormData,this.radio),function(t,e,n,i,o){"use strict";i.define("bookshelfDataSavingIcon",[],function(i){var o,r=e(".bm-bookshelf-info-save"),s=r.find(".bm-bookshelf-info-save-text"),a=(e(t),r.data("saving"),r.data("saved"));n("bm-bookshelf-saving").subscribe(function(){clearTimeout(o)}),n("bm-bookshelf-saved").subscribe(function(){s.html(a),r.addClass("show success"),o=setTimeout(function(){r.removeClass("show"),setTimeout(function(){r.removeClass("success")},300)},1500)}),n("bm-bookshelf-error").subscribe(function(t){for(var e in t){s.html(t[e][0]);break}r.addClass("show error"),o=setTimeout(function(){r.removeClass("show"),setTimeout(function(){r.removeClass("error")},1e3)},1500)}),i()})}(this,this.jQuery,this.radio,this.modules,this.BM),function(t,e,n,i){"use strict";n.define("bookshelfDelete",[],function(n){var o=i.user.getLogin(),r=e(".bm-bookshelf-delete"),s=r.data("confirm");r.on("click",function(){var n=confirm(s);if(n){r.attr("disabled","disabled");var i=e(".bm-bookshelf").attr("id");e.ajax({url:"/a/4/bs/"+i+".json",method:"delete",success:function(){t.location.href="/"+o+"/bookshelves"}})}}),n()})}(this,this.jQuery,this.modules,this.BM),function(t,e,n,i){"use strict";n.define("BookshelfDocumentItemProcessor",["BookBlockListItem"],function(t,n){var o=function(){function t(e){_classCallCheck(this,t),this.data=e,this.render()}return t.prototype.render=function(){this.$documentItem=e(this.getDocumentItemTemplate());var t=new n(i.tools.mixin(this.data.document,{components:{owner:!1,readers:this.data.readers,readers_count:this.data.readers_count},discovery_id:this.data.bookshelf_uuid,mixpanel_ctx:"shelf",openDocumentPopup:!0})),o=t.getElement();this.$documentItem.attr("data-uuid",this.data.document.uuid),this.$documentItem.find("@bookshelf-document-replace").replaceWith(o),this.$documentItem.find("@bm-bookshelf-post-book").attr("data-bsd_uuid",this.data.uuid),this.$documentItem.find("@bookshelf-document-creator-link").attr("href",i.helper.link.user(this.data.creator.login)),this.$documentItem.find("@bookshelf-document-creator-img").attr("src",this.data.creator.avatar_url),this.$documentItem.find("@bookshelf-document-creator-name").text(this.data.creator.name||this.data.creator.login),this.$documentItem.find("@bookshelf-document-time").html(moment(1e3*this.data.created_at-9e4).fromNow(!0)),this.data.annotation&&this.$documentItem.find("@bookshelf-document-annotation").removeClass("hidden").text(this.data.annotation)},t.prototype.getDocumentItemTemplate=function(){return e("#bookshelf-document-template").html()},t.prototype.getDocumentItem=function(){return this.$documentItem},t}();t(o)})}(this,this.jQuery,this.modules,this.BM),function(t,e,n,i){"use strict";e.define("bookshelfDocumentsList",[],function(t){var e=[],i=function(){o()},o=function(){e=_.map(n(".bm-bookshelf").data("documents"),function(t){return t.document_id||t.document.uuid})},r=function(t){e.push(t)},s=function(t){e=_.without(e,t)},a=function(){return e};i(),t({addDocument:r,removeDocument:s,getDocuments:a})})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){"use strict";n.define("bookshelfFollowing",["loginWindow"],function(n,r){var s=e(".bm-bookshelf-follow"),a=e(".bm-bookshelf-footer-subscribers > span"),u=!!s.data("following"),l=s.data("followmsg"),c=s.data("unfollowmsg"),d=e(".bm-bookshelf").attr("id"),h=parseInt(a.html(),10),p=new r({context:"bookshelf_subscribe",preventDefaultLoginBehavior:!0}),f=function(){a.html(++h)},m=function(){a.html(--h)},g=function(){e.ajax({url:"/a/4/bs/"+d,method:"get",success:function(t){u=t.following,b(!0)}})},b=function(n){var r=u?"/a/4/bs/"+d+"/unfollow.json":"/a/4/bs/"+d+"/follow.json";s.attr("wait",!0),s.attr("disabled","disabled"),e.ajax({url:r,method:"post",success:function(){u=!u,s.removeAttr("wait"),s.removeAttr("disabled"),u?(f(),s.removeClass("bookmate-button bookmate-button-green-flat"),s.addClass("bm-button-black m-transparent"),s.html(c),o.track("Shelf Follow",{shelf_name:d,discovered:o.discovered.context.get("shelf"),discovered_id:o.discovered.uuid.get("shelf")})):(m(),s.removeClass("bm-button-black m-transparent"),s.addClass("bookmate-button bookmate-button-green-flat"),s.html(l)),n&&t.setTimeout(function(){i.tools.reload()},500)}})};s.on("click",function(){i.user.isUserPresent()?b():(p.showWindow("inital"),p.on("authenticationSuccessful",function(){g()}))}),n()})}(this,this.jQuery,this.modules,this.BM,this.DIMixpanel),function(t){"use strict";t.define("bookshelfInit",["moduleIndexBookshelf","moduleIndexBookshelfSharing","BookSearchPopup","bookshelfCoverUpload","bookshelfDelete","bookshelfFollowing","bookshelfReadButton","bookshelfEdit","bookshelfDataSavingIcon","bookshelfPostCreate","bookshelfPublishing","bookshelfSubscribedUsers","bookshelfUpLink"],function(t){
t({})})}(this.modules),function(t,e,n,i,o){"use strict";i.define("bookshelfPostCreate",["BookSearchPopup","AttachmentBookItemProcessor","bookshelfDocumentsList"],function(t,i,o,r){var s=e(".bm-bookshelf-post-create-button"),a=e(".bm-bookshelf-post-create-form"),u=a.find("textarea"),l=a.find(".bm-bookshelf-post-create-form-attach-book"),c=a.find(".bm-bookshelf-post-create-form-attachment"),d=a.find(".bm-bookshelf-post-create-form-cancel"),h=a.find(".bm-bookshelf-post-create-form-publish-button"),p=(e(".bm-bookshelf").attr("id"),new o),f=new i({useTemplate:!0,contentClassName:"bm-book-search-popup-content"}),m=function(){u.val(""),c.html(""),l.removeClass("hidden")},g=function(){s.addClass("hidden"),a.removeClass("hidden"),u.trigger("autosize.resize"),u.focus(),f.show()},b=function(){s.removeClass("hidden"),a.addClass("hidden")},_=function(t){var i=e(".bm-bookshelf").attr("id");e.ajax({url:"/a/4/bs/"+i+"/d.json",method:"post",data:{id:t.id,d:{annotation:t.annotation}}}).done(function(e){m(),b(),r.addDocument(t.id),n("bookshelf-book-post-created").broadcast(e)}).fail(function(t){t&&t.responseJSON.error.message?alert(t.responseJSON.error.message):""}).always(function(){h.removeAttr("wait"),h.removeAttr("disabled")})};u.autosize(),s.on("click",function(){g()}),l.on("click",function(){f.show()}),d.on("click",function(){m(),b()}),n("bm-bookshelf-attachment-add").subscribe(function(t){c.append(p.getItem(t)),l.addClass("hidden"),u.focus()}),n("bm-book-search-popup-terminate").subscribe(function(){m(),b()}),h.on("click",function(){var t={};t.id=c.find(".bm-bookshelf-post-attachment-book").data("uuid"),t.annotation=u.val(),h.attr("wait",!0),h.attr("disabled","disabled"),_(t)}),t()})}(this,this.jQuery,this.radio,this.modules,this.BM),function(t,e,n,i,o,r){"use strict";i.define("moduleIndexBookshelf",["PostProcessor","BookshelfDocumentItemProcessor","moduleBookBadge","bookshelfDocumentsList","RouterWeb"],function(i,s,a,u,l,c){var d=e(".bm-bookshelf"),h=e(t),p=e("@bookshelf-spinner"),f=e(".bm-bookshelf-posts"),m=new s,g={},b=d.attr("id"),y=2,v=!0,w=1e3,k={},C=function(t,e){var i=e.val();clearTimeout(k[t]),k[t]=setTimeout(function(){n("bm-bookshelf-saving").broadcast(),S(t,i)},w)},S=function(t,i){var o=d.attr("id");e.ajax({url:"/a/4/bs/"+o+"/d/"+t+".json",method:"patch",data:{d:{annotation:i}},success:function(){n("bm-bookshelf-saved").broadcast()}})},x=function(t,e){var n=g[t];e.html(n),C(t,e)},E=function(t){var i=t.data("uuid");e.ajax({url:"/a/4/bs/"+b+"/d/"+i+".json",method:"delete",success:function(){t.remove(),l.removeDocument(i),n("bm-bookshelf-post-deleted").broadcast()}})};r.locale(o.config.mainConfig.locale),d.hasClass("editable")?(n("bookshelf-book-post-created").subscribe(function(n){g[n.document.uuid]=n.annotation;var i=m.getItem(n);i.find(".bm-bookshelf-post-annotation");f.prepend(i),e(t).trigger("resize")}),f.find(".bm-bookshelf-post").each(function(t,n){var i=e(n),o=i.find(".bm-bookshelf-post-attachment-book-meta-title"),s=i.find(".bm-bookshelf-post-annotation"),a=i.find(".update-time"),u=i.find(".update-timestamp");g[i.data("uuid")]=s.val(),s.autosize(),o.dotdotdot({fallbackToLetter:!0}),u.html(r(1e3*parseInt(u.html(),10)-9e4).fromNow(!0)),a.removeClass("hidden")}),f.on("paste.bm-edit",".bm-bookshelf-post-annotation",function(t){var n=e(this);C(n.closest(".bm-bookshelf-post").data("uuid"),e(this))}).on("keydown.bm-edit",".bm-bookshelf-post-annotation",function(t){if(27===t.which){var n=e(this);x(n.closest(".bm-bookshelf-post").data("uuid"),n)}}).on("keyup.bm-edit",".bm-bookshelf-post-annotation",function(t){var n=e(this);C(n.closest(".bm-bookshelf-post").data("uuid"),e(this))}).on("focus.bm-edit",".bm-bookshelf-post-annotation",function(t){e(this).parent().find(".bm-bookshelf-post-annotation-edit-icon").addClass("focus")}).on("blur.bm-edit",".bm-bookshelf-post-annotation",function(t){e(this).parent().find(".bm-bookshelf-post-annotation-edit-icon").removeClass("focus")}).on("click.bm-edit",".delete",function(t){t.preventDefault(),t.stopPropagation();var n=e(this);confirm(n.data("confirm"))&&E(n.closest(".bm-bookshelf-post"))})):f.find(".bm-bookshelf-post").each(function(t,n){var i=e(n),o=i.find(".update-time"),s=i.find(".update-timestamp"),a=i.find(".bm-bookshelf-post-attachment-book-meta-title");a.dotdotdot({fallbackToLetter:!0}),s.html(r(1e3*parseInt(s.html(),10)-9e4).fromNow(!0)),o.removeClass("hidden"),d.hasClass("editable")||i.find(".bm-bookshelf-post-attachment-book-meta").on("click",function(t){try{t.preventDefault(),t.stopPropagation();var e=i.data("document-config"),n=i.find(".bm-bookshelf-post-attachment-book-cover");DIMixpanel.discovered.set({channel:"book",ctx:n.data("mixpanel-ctx"),uuid:n.data("discovery-id")}),c.navigateToBookPage(e.book_uuid)}catch(o){}})}),f.find(".bm-bookshelf-post").each(function(t,n){var i=e(this),o=e(n),r=i.find(".bm-ui-badge");new u({element:r,document:o.data("document-config")})});var P=function(){v&&(p.show(),v=!1,e.ajax({url:"/a/4/bs/"+b+"/d?embed_readers=7",data:{p:y,pp:20},success:function(t){if(!t.objects.length)return void p.hide();var n=[];t.objects.forEach(function(t){var e=new a(o.tools.mixin(t,{}));d.hasClass("editable")&&(g[t.document.uuid]=t.annotation),n.push(e.getDocumentItem())}),p.hide(),f.append(n),n.forEach(function(t){e(t).find("@bookshelf-document-annotation").autosize()}),y+=1,v=!0},error:function(t){p.hide(),v=!0}}))},T=function(){h.on("scroll",_.throttle(function(){h.scrollTop()+h.height()>d.offset().top+d.height()&&P()},500))};T(),i()})}(this,this.jQuery,this.radio,this.modules,this.BM,this.moment),function(t,e,n,i,o){"use strict";n.define("PostProcessor",["modules","TemplateFactory","moduleBookBadge"],function(t,e,n,r){var s=function(){var t=function(){var t=this;t.bookItemTemplateFactory=new n("#bookmate-post-edit-template"),t.bookItemTemplateFactoryCoverless=new n("#bookmate-post-edit-template-coverless")};return t.prototype={getItem:function(t){var e,n=this;if(t.document.cover&&t.document.cover.url?(e=n.bookItemTemplateFactory.getInstance(),e.find(".bm-bookshelf-post-attachment-book-cover img").attr("src",t.document.cover.url)):(e=n.bookItemTemplateFactoryCoverless.getInstance(),e.find(".bm-bookmate-book-generated-cover-title-content").html(t.document.title),e.find(".bm-bookmate-book-generated-cover-authors").html(t.document.authors)),e.data("uuid",t.document.uuid),t.document.labels){var i=_.pluck(t.document.labels,"kind"),s=e.find(".bookcard-label"),a=s.find("> a"),u=this._getLabelKey(i),l=i[0],c=a.data("free");a.data("subscription");"free"===u?(a.attr("href","/search?query=#"+c),a.addClass("free"),a.html(c)):"premium"===l?(a.removeAttr("href"),a.removeClass("free"),a.addClass("m-premium"),a.html(a.data("premium"))):"default"===l?(a.removeAttr("href"),a.removeClass("free"),a.addClass("m-premium"),a.html(a.data("default"))):"user_upload"===l?(a.removeAttr("href"),a.removeClass("free"),a.addClass("m-user-upload"),a.html(a.data("user-upload"))):(a.removeAttr("href"),a.removeClass("free"),a.addClass("m-private"),a.html(a.data("private"))),new r({element:s,document:t.document})}else e.find(".bookcard-label").remove();return e.find(".update-timestamp").html(o(1e3*t.created_at-9e4).fromNow(!0)),e.find(".bm-bookshelf-post-annotation").autosize(),e.find(".update-time").removeClass("hidden"),e.find(".bm-bookshelf-post-meta-creator a").attr("href","/"+t.creator.login),e.find(".bm-bookshelf-post-meta-creator img").attr("src",t.creator.avatar_url),e.find(".bm-bookshelf-post-meta-creator span").html(t.creator.name||t.creator.login),e.find(".bm-bookshelf-post-attachment-book-cover").attr("href","/documents/"+t.document.uuid+"/book"),e.find(".bm-bookshelf-post-attachment-book-meta-authors").attr("href","/search?author="+t.document.authors).html(t.document.authors),e.find(".bm-bookshelf-post-attachment-book-meta-title").attr("href","/documents/"+t.document.uuid+"/book").html(t.document.title).dotdotdot({fallbackToLetter:!0}),e.find(".bm-bookshelf-post-annotation").html(t.annotation),e.find(".bm-bookshelf-post-attachment-book-meta-add-stats .counter").html(t.readers_count),e},_getLabelKey:function(t){return i.tools.isArray(t)?-1!==t.indexOf("free")?"free":-1!==t.indexOf("premium")?"premium":-1!==t.indexOf("default")?"default":-1!==t.indexOf("subscription")?"subscription":"private":t}},t}();e.ItemProcessor=s,t(s)})}(this,this.jQuery,this.modules,this.BM,this.moment),function(t,e,n,i,o){"use strict";i.define("bookshelfPublishing",["DropDown"],function(t,i){var o=e(".bm-bookshelf-publish"),r=e(".bm-bookshelf-hidden"),s="unpublished",a=(new i({$button:e(".bm-bookshelf-footer-controls-action-button"),$container:e(".bm-bookshelf-footer-controls-action").eq(0)}),function(){if(!e(".bm-bookshelf").hasClass("m-new")){var t=e(".bm-bookshelf").attr("id");e.ajax({url:"/a/4/bs/"+t+".json",method:"patch",data:{"bs[state]":s},success:function(){},error:function(t){n("bm-bookshelf-error").broadcast(t.responseJSON.error.messages.bookshelf)}})}}),u=function(){e(".bm-bookshelf-footer-controls-action-item").removeClass("m-selected"),"unpublished"===s?o.addClass("m-selected"):r.addClass("m-selected"),a()};o.on("click",_.throttle(function(){s="unpublished",u()},300)),r.on("click",_.throttle(function(){s="hidden",u()},300)),n("bm-bookshelf-created").subscribe(a),t()})}(this,this.jQuery,this.radio,this.modules,this.BM),function(t,e,n,i){"use strict";n.define("bookshelfReadButton",["moduleButtonRead","loginWindow"],function(n,i,o){var r=null,s=!1,a=new o({context:"library_add",preventDefaultLoginBehavior:!0});e("@bm-button-read").each(function(){var n=new i({element:e(this)});n.on("user-auth-request",function(){a.showWindow("inital"),r=n,s=!0,a.on("authenticationSuccessful",function(t,e,i){r===n&&(a.preventDefaultLoginBehavior!==!1?n.sendRequestAddBookToLibrary():s=!1)})}),n.on("book-adding-success",function(){s&&setTimeout(function(){t.location.reload()},350)})}),n()})}(this,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";i.define("moduleIndexBookshelfSharing",["BookSearchPopup","DropDown"],function(t,n,i){var o=e(".bm-bookshelf-footer-controls-sharing-button"),r=e(".bm-bookshelf-footer-controls-sharing").eq(0);r.socialCounters({entity:"shelf"});new i({$button:o,$container:r});t()})}(this,this.jQuery,this.radio,this.modules,this.BM),function(t,e,n,i){"use strict";n.define("bookshelfSubscribedUsers",["followSuggestPopup"],function(t,n){var i=e(".bm-bookshelf"),o=i.attr("id");new n({useTemplate:!0,contentClassName:"bm-popup-follow-suggest",fetchURL:"/a/4/bs/"+o+"/followers.json"});t()})}(this,this.jQuery,this.modules,this.BM),function(t,e,n,i,o,r){"use strict";o.define("bookshelfEdit",["CharCounter","ampersandState","RouterWeb"],function(t,e,o,r){var s=o.extend({props:{is_editable:"boolean",is_new:"boolean",bookshelf_uuid:"string"}}),a=n(".bm-bookshelf-create"),u=(n(".bm-bookshelf-delete"),n(".bm-bookshelf")),l=n(".bm-bookshelf-info-desc .bm-bookshelf-info-desc-title"),c=n(".bm-bookshelf-info-desc .bm-bookshelf-info-desc-annotation"),d={"bm-bookshelf-info-desc-title":"title","bm-bookshelf-info-desc-annotation":"annotation"},h={"bm-bookshelf-info-desc-title":l.val(),"bm-bookshelf-info-desc-annotation":c.val()},p={},f=u.attr("id"),m=1e3,g=new s({is_editable:u.hasClass("editable"),is_new:u.hasClass("m-new"),bookshelf_uuid:f}),b=(function(){var t=c.text().replace("\r","").split("\n"),e=[],n=[],i=new RegExp(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/i);t.forEach(function(t){e.push(t.split(" "))}),e=e.map(function(t){var e=[];return t.forEach(function(t){null!=t.match(i)?e.push("<a href='"+t+"'>"+t+"</a>"):0==t.indexOf("www.")?e.push("<a href='http://"+t.substr(4)+"'>"+t+"</a>"):e.push(t)}),e}).forEach(function(t){n.push(t.join(" "))}),"P"==c.prop("tagName")?c.add(".bm-bookshelf-info-desc-annotation.m-mobile").html(n.join("\n")):""}(),function(){l.val().length>0?a.removeAttr("disabled"):a.attr("disabled","disabled")}),_=function(t){var e=d[t[0].className],n=t.val();b(),clearTimeout(p[e]),p[e]=setTimeout(function(){i("bm-bookshelf-saving").broadcast(),y(e,n)},m)},y=function(t,e){var o={},r=e;o["bs["+t+"]"]=r,g.is_new||n.ajax({url:"/a/4/bs/"+g.bookshelf_uuid+".json",method:"patch",data:o,success:function(){i("bm-bookshelf-saved").broadcast()}})},v=function(t){var e=t[0].className;t.val(h[e]),_(t)},w=function(){l.autosize(),c.autosize();new e(l),new e(c);n(".bm-bookshelf-info-desc-title, .bm-bookshelf-info-desc-annotation").on("paste.bm-edit",function(t){_(n(this))}).on("keyup.bm-edit",function(t){_(n(this))}).on("keydown.bm-edit",function(t){var e=27;t.which===e&&v(n(this))}),l.on("keydown.bm-edit",function(t){13===t.which&&t.preventDefault()})},k=function(){};g.is_editable&&w(),g.is_new&&k();var C=function(t){g.bookshelf_uuid=t.uuid,u.attr("id",g.bookshelf_uuid),r.navigate("bookshelves/"+g.bookshelf_uuid,{trigger:!1}),g.is_new=!1,u.removeClass("m-new"),i("bm-bookshelf-created").broadcast({bookshelf_uuid:g.bookshelf_uuid})},S=function(){var t=new FormData;t.append("bs[title]",l.val()),t.append("bs[annotation]",c.val()),a.addClass("m-wait"),n.ajax({url:"/a/4/bs.json",method:"post",data:t,processData:!1,contentType:!1,success:function(t){setTimeout(function(){C(t)},600)},error:function(){}})};a.on("click",S),t()})}(this,this.document,this.jQuery,this.radio,this.modules,this.BM),function(t,e,n,i){"use strict";n.define("bookshelfUpLink",["UpLink"],function(t,n){new n(e(".bm-bookshelf"),e(".bm-bookshelf-content-container"));t()})}(this,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){e.define("discountPageAnalytics",[],function(t){t()})}(this,this.modules,this.jQuery,this.DIMixpanel,this.docCookies),function(t,e,n,i,o){e.define("discountPageButtonSwitch",["PubSub","extend"],function(t,e,n){var o=n(e),r=o,s=r.superclass;i.tools.mixin(r.prototype,{initialize:function(t){s.initialize.apply(this,arguments),this.$elem=t.element,this.$elemOptionFirst=this.$elem.find("@bm-button-switch-option-first"),this.$elemOptionSecond=this.$elem.find("@bm-button-switch-option-second"),this._setupEvents()},_setupEvents:function(){var t=this;t.$elemOptionFirst.on("click",function(){t._onOptionFirstClick()}),t.$elemOptionSecond.on("click",function(){t._onOptionSecondClick()})},_onOptionFirstClick:function(){this._setSelectedOption("first"),this._notify("change","first")},_onOptionSecondClick:function(){this._setSelectedOption("second"),this._notify("change","second")},_setSelectedOption:function(t){this.$elem.attr("data-option",t)},destroy:function(){s.destroy.apply(this,arguments)}}),t(o)})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i,o){e.define("discountFormVisa",["paymentPopup/visa"],function(e){var o=i.custom.popupPaymentFormVisa;i.widget("custom.discountFormVisa",o,{_sendRequestSubscribe:function(){this._setFormWait(!0),this._sendGAEventPaymentButtonPress();var t=this;i.ajax({type:"post",url:"/payments/braintree",data:this._getPostData(),dataType:"json",success:function(e){t._onSubscribeSuccess(e),t.element.trigger("subscription_success")},error:function(e){t._handleSubscribeError(e.responseJSON),t.element.trigger("subscription_failed")}})},_onSubscribeSuccess:function(e){e.redirect_to?t.location.href=e.redirect_to:t.location.href="/library"},getElement:function(){return this.element},_getPostData:function(){var t=o._getPostData.call(this);n.tools.mixin(t,{braintree:{cvv:this._braintreeHandler.encrypt("123"),device_data:n.helper.braintree.deviceData()}})}}),e(function(t){return t.discountFormVisa(),t.data("custom-discountFormVisa")})})}(this,this.modules,this.BM,this.jQuery,this.DIMixpanel),function(t,e,n,i){e.define("initDiscountPage",["discountFormVisa","discountPageButtonSwitch","discountPageAnalytics"],function(t,e,o){var r=e(n("@bm-form-visa-standalone")),s=r.getElement(),a=new o({element:n("@bm-button-switch")});s.on("subscription_failed",function(){i.track("Subscription Failed")}),s.on("subscription_success",function(){i.track("Subscription Successful")}),r.setCurrentPlan("1month"),a.on("change",function(t){"first"===t?r.setCurrentPlan("1month"):"second"===t&&r.setCurrentPlan("1year")}),t()})}(this,this.modules,this.jQuery,this.DIMixpanel),function(t,e,n){"use strict";var i=function(t,n,i,o,r){var s,a,u=e(".bm-activity-wrapper");u.length>0&&(s=new n(u,{feedSourceUrl:"/a/4/u/"+BM.user.getLogin()+"/a/explore.json",useLocale:!1}),a=new i(u));var l=(new o,e("@block-social-connect"));l.length>0&&r.init(l,"friends")};n.define("exploreInit",["ActivityLoader","UpLink","FriendSuggestion","blockSocialConnect"],i)}(this,this.jQuery,this.modules),function(t,e,n,i){e.define("giftCards",["ampersandModel","ampersandView","BookSearchPopup"],function(e,o,r,s){var a=o.extend({urlRoot:function(){return"/a/4/gift_cards"},props:{id:"string",background:"string",book_id:"string",content:"string",promo_code:"string"}}),u=new a,l=new s({useTemplate:!0,contentClassName:"bm-book-search-popup-content"});$(".gift-cards-card-footer-block-right").on("click",function(){l.show()});var c=r.extend({events:{"click @gift-cards-card-toolbar-item":"changeCardBg","keydown @gift-cards-card-title":"changeContent"},bindings:{"model.background":{type:function(t,e,n){$(this.el).find(".gift-cards-card").removeClass("m-gc-"+n),$(this.el).find(".gift-cards-card").addClass("m-gc-"+e),$("@gift-cards-card-toolbar-item[data-name="+n+"]").removeClass("active"),$("@gift-cards-card-toolbar-item[data-name="+e+"]").addClass("active")}},"model.id":{type:function(e,n){var i=t.location.origin+"/code?gift="+this.model.id;$(this.el).find("@gift-cards-footer-link").val(i)}}},initialize:function(){var t=$(".gift-cards-card-title").css("line-height"),e=$(".gift-cards-card").css("padding-top"),n=$(".gift-cards-card").css("padding-left");this.$cursor=$("@gc-input-cursor"),this.$cursor.css({top:e,left:n,height:t}),this.$html=$("html, body"),this.$input=$("@gift-cards-card-title"),this.$input.on("click",this.handleClickInput.bind(this)),this.inputFocused=!1},handleClickInput:function(){this.$cursor.hide(),n.tools.client.isBreakpointTablet()&&n.tools.client.isMobile()&&!this.inputFocused&&(this.inputFocused=!0,this.focusStart()),n.tools.client.isBreakpointTablet()&&this.$html.animate({scrollTop:this.$input.offset().top},10)},focusStart:function(e){this.$input.focus();var n=$("<span>").prependTo(this.$input),i=n.get(0),o=null,r=null;document.selection?(o=document.body.createTextRange(),o.moveToElementText(i),o.select()):t.getSelection&&(o=document.createRange(),o.selectNode(i),r=t.getSelection(),r.removeAllRanges(),r.addRange(o)),n.remove()},changeCardBg:function(t){var e=$(t.target).data("name");this.model.save({background:e})},changeContent:function(t){this.limitContent(t.target,t);var e=$(t.target).html();this.model.save({content:e})},limitContent:function(t,e){var n=$(t)[0].offsetHeight,i=parseInt($(t).css("font-size").split("px")[0],10),o=2*parseInt(1.2*i,10),r=3*parseInt(1.2*i,10),s=[8,37,38,39,40];n>=o&&13==e.keyCode&&e.preventDefault(),n>r&&-1===s.indexOf(parseInt(e.keyCode))&&e.preventDefault()}});i("bm-bookshelf-attachment-add").subscribe(function(t){$(".gift-cards-card-add-book").addClass("hidden"),$(".gift-cards-card-book").removeClass("hidden"),t.cover.url?($(".gift-cards-card-book-cover").css({"background-image":"url("+t.cover.url+")"}),$(".gift-cards-card-book-cover").empty()):($(".gift-cards-card-book-cover").removeAttr("style"),$(".gift-cards-card-book-cover").html('<div class="bookcard thumb no-blur m-mobile-block blank" role="bookcard"><div class="bookcard-content"><div class="bookcard-shadow"><a class="bookcard-link"><div class="linkToBook"><span class="title"><span class="title-content">'+t.title+'</span></span><hr><span class="authors">'+t.authors+"</span></div></a></div></div></div>")),$(".gift-cards-card-book-title").html(t.title),$(".gift-cards-card-book-authors").html(t.authors),u.save({book_id:t.book_uuid})}),e({initWithData:function(t){new c({el:$("@gift-cards-body")[0],model:u});u.save({promo_code:t.code,content:$("@gift-cards-card-title").html(),background:"03"}),$(".gift-card-duration."+t.duration).addClass("active")}})})}(this,this.modules,this.BM,this.radio),function(t,e,n,i,o,r){"use strict";var s=function(t){var e=n(".bm-carousel");e.carousel(),t({})};o.define("giftsCarousel",[],s)}(this,this.document,this.jQuery,this.radio,this.modules,this.docCookies),function(t,e){e.define("giftsEmail",[],function(t){var e=$(".gifts-email"),n=$(".gifts-promocode"),i=$("@email-value"),o=$("@email-submit"),r=$("@email-toggle"),s=function(){a()},a=function(){o.on(BM.tools.client.touchEvent,u),r.on(BM.tools.client.touchEvent,l)},u=function(){var t=i.val().trim(),o=n.data("value"),r=n.data("duration");return t&&-1!==t.indexOf("@")&&-1!==t.indexOf(".")?(i.removeClass("error"),void $.ajax({url:"/gifts/send_email",type:"post",data:{email:t,code:o,duration:r},success:function(){e.addClass("success")},error:function(){e.addClass("error")}})):void i.addClass("error")},l=function(){e.removeClass("success error")};s(),t()})}(this,this.modules),function(t,e,n,i,o,r){e.define("giftsPopupPaywall",["PopupBase","extend","dynamicContent","giftsPaymentFormLoader","giftsPaymentForm","moduleAuthRequest"],function(e,s,a,u,l,c,d){var h=a(s),p=h,f=p.superclass,m="bm-popup-paywall-template";i.tools.mixin(p,{Step:{PREMIUM:"premium",PREMIUM_PREVIEW:"premium-preview",DEFAULT:"default",DEFAULT_PREVIEW:"default-preview",BOOSTER:"booster",BOOSTER_PREVIEW:"booster-preview",ABOUT_DEFAULT:"about-default",ABOUT_BOOSTER:"about-booster",ABOUT_PREMIUM:"about-premium",PAYMENT_FORM:"payment-form",SUCCESS:"success",LOADING:"loading",SELECT_DURATION:"select-duration"},Operators:["kcell"],Type:{ABOUT_BOOK:"about-book",PREVIEW_FINISH:"preview-finish"},Context:{READER:"reader"}}),i.tools.mixin(p.prototype,{initialize:function(t){f.initialize.call(this,{useTemplate:!0,rootClassName:["m-version-2","bm-popup-paywall"]}),this.$elemDynamicContent=this._element.find("@bm-dynamic-content"),this.$elemLinkBack=this._element.find("@bm-popup-paywall-link-back"),this.$elemLinkToAboutDefault=this._element.find("@bm-popup-paywall-link-to-about-default"),this.$elemLinkToAboutBooster=this._element.find("@bm-popup-paywall-link-to-about-booster"),this.$elemsHeaderItems=this._element.find("@bm-popup-paywall-header-item"),this.$elemPaymentFormWrapper=this._element.find("@bm-popup-paywall-payment-form-wrapper"),this.$elemButtonBuyPremium=this._element.find("@bm-popup-paywall-button-buy-premium, @bm-popup-block-about-button-buy-premium"),this.$elemButtonBuyBooster=this._element.find("@bm-popup-paywall-button-buy-booster, @bm-popup-block-about-button-buy-booster"),this.$elemButtonBuyDefault=this._element.find("@bm-popup-paywall-button-buy-default, @bm-popup-block-about-button-buy-default"),this.$elemButtonBuyMonth=this._element.find("@bm-popup-paywall-button-buy-month"),this.$elemButtonBuySixMonths=this._element.find("@bm-popup-paywall-button-buy-six-months"),this.$elemButtonBuyThreeMonths=this._element.find("@bm-popup-paywall-button-buy-three-months"),this.$elemButtonBuyYear=this._element.find("@bm-popup-paywall-button-buy-year"),this.$elemButtonBuyOperator=this._element.find("@bm-popup-paywall-button-buy-operator"),this.$elemSubscriptionExpirationDate=this._element.find("@subscription-expiration-date"),this.$elemSubscriptionExpirationDatePremium=this._element.find("@subscription-expiration-date-premium"),this.$elemStateSuccessContent=this._element.find("@bm-popup-payment-light-state-success-content"),this.$elemNextChargeDate=this._element.find("@bm-popup-payment-light-next-charge-date"),this.$elemStateSuccessButtonOkWrapper=this._element.find("@bm-popup-payment-light-state-success-button-ok-wrapper"),this.$elemStateSuccessButtonOk=this._element.find("@bm-popup-payment-light-state-success-button-ok"),this.$elemStateSuccessIOSWarning=this._element.find("@bm-popup-payment-light-state-success-ios-warning"),this.$elemButtonExtendSubscription=this._element.find("@bm-popup-payment-light-button-extend-subscription"),this.$elemsPriceElements=this._element.find("@bm-popup-paywall-price"),this.$elemsKindElements=this._element.find("@bm-popup-paywall-kind"),this.$elemsSubscriptionDurationButtons=this._element.find("@bm-popup-paywall-duration-button"),this.$elemPaymentMethod=this._element.find("@payment-method"),this._paymentFormLoader=null,this._paymentForm=null,this._dynamicContent=null,this._context=t&&t.context||null,this._lastRequiredSubscriptionLevel=null,this._subscriptionDuration=null,this._initDynamicContent(),this._appendPaymentFormLoader(),this._bindEvents()},_initDynamicContent:function(){this._dynamicContent=new u({element:this.$elemDynamicContent})},_appendPaymentFormLoader:function(){this._paymentFormLoader=new l,this._paymentForm=this._paymentFormLoader.getPaymentForm(),this.$elemPaymentFormWrapper.append(this._paymentFormLoader.getElement()),this._paymentForm.setDiscount(this.isPaypal()?10:0)},_bindEvents:function(){var t=this,e=i.tools.client.isTouch()?i.tools.client.touchEvent:"click";this.$elemLinkToAboutDefault.on(e,function(){var e=n(this);t._showAboutDefaultSubscription({context:e.attr("data-context")})}),this.$elemLinkToAboutBooster.on(e,function(){var e=n(this);t._showAboutBoosterSubscription({context:e.attr("data-context")})}),this.$elemLinkBack.on(e,function(){t._navigateBack()}),this.$elemButtonBuyDefault.on(e,function(){t._showSelectDuration(c.SubscriptionType.DEFAULT)}),this.$elemButtonBuyBooster.on(e,function(){t._showSelectDuration(c.SubscriptionType.BOOSTER)}),this.$elemButtonBuyPremium.on(e,function(){t._showSelectDuration(c.SubscriptionType.PREMIUM)}),this.$elemButtonBuyMonth.on(e,function(){t._operatorName=null,t._showPaymentForm(c.SubscriptionDuration.MONTH)}),this.$elemButtonBuySixMonths.on(e,function(){t._operatorName=null,t._showPaymentForm(c.SubscriptionDuration.SIX_MONTHS)}),this.$elemButtonBuyThreeMonths.on(e,function(){t._operatorName=null,t._showPaymentForm(c.SubscriptionDuration.THREE_MONTHS)}),this.$elemButtonBuyYear.on(e,function(){t._operatorName=null,t._showPaymentForm(c.SubscriptionDuration.YEAR)}),this.$elemButtonBuyOperator.on(e,function(){t._operatorName=n(this).attr("data-method"),t._showPaymentForm(c.SubscriptionDuration.MONTH)}),this._dynamicContent.on("fade-out-start",function(e,n){t._onDynamicContentFadeOutStart(e,n)}),this._dynamicContent.on("resize-end",function(e,n){t._onDynamicContentResizeEnd(e,n)}),this._dynamicContent.on("fade-in-start",function(e,n){t._onDynamicContentFadeInStart(e,n)}),this._paymentForm.on("subscription-success",function(e){t._onPaymentFormPaymentSuccess(e)}),this.$elemStateSuccessButtonOk.on("click",function(){t._onStateSuccessButtonOkClick()}),i.helper.subscription.on("prices-fetched",function(){t._updatePaywallPrices()}),this.on("paywall-kind-updated",function(){t._updatePaywallPrices()})},_onDynamicContentFadeOutStart:function(t,e){this._hideHeader()},_onDynamicContentResizeEnd:function(t,e){this._elementOverlay.scrollTop(0)},_onDynamicContentFadeInStart:function(t,e){this._dynamicContent.isStepsStackEmpty()||this._showLinkBack(),this._showHeader(e)},_onPaymentFormPaymentSuccess:function(t){var e=null;switch(this._subscriptionDuration){case"month":e=1;break;case"3_months":e=3;break;case"6_months":e=6;break;case"year":e=12}r.track("Gift Purchased",{duration:e}),this._showStateSuccess(t)},_onStateSuccessButtonOkClick:function(){t.location.pathname="/"},_updatePaywallPrices:function(){var t=this;this.$elemsPriceElements.each(function(){var e=n(this),o=e.attr("data-text").replace("%{price}",i.helper.subscription.getPrice(e.attr("data-kind"),e.attr("data-duration"),{paymentMethod:e.attr("data-method")||t.getPaymentMethod(),discount:t.isPaypal()?10:0}));e.html(o)})},_updatePaywallKind:function(t){"booster"===t&&(t="premium"),this.$elemsKindElements.each(function(){var e=n(this);e.attr("data-kind",t)}),this._notify("paywall-kind-updated")},_showStateSuccess:function(t){radio("subscription-success").broadcast(t),this._notify("subscription-success",t),this._dynamicContent.clearStepsStack(),this.hide()},_timestampToDate:function(t){var e=new Date(t);return[e.getDate(),e.getMonth()+1,e.getFullYear()].join("/")},_getTemplateName:function(){return m},show:function(t){var e=this,n=null,o=p.Type.ABOUT_BOOK,r=function(){};i.tools.isUndefined(t)||(n=i.tools.isUndefined(t.step)?"auto":t.step,i.tools.isUndefined(t.type)||(o=t.type),i.tools.isUndefined(t.callback)||(r=t.callback)),o===p.Type.PREVIEW_FINISH&&t&&t.subscriptionLevel&&(this._lastRequiredSubscriptionLevel=t.subscriptionLevel,n=this._getStepToShowBySubscriptionLevel(t.subscriptionLevel)),"auto"===n&&(n=this._getStepByUserSubscription()),this._dynamicContent.reset(),this._dynamicContent.clearStepsStack(),this._hideLinkBack(),this._paymentFormLoader.arePaymentMethodsLoaded()?(n&&this._showStep(n),this._updateHeader(),f.show.apply(this,arguments),this._sendEventPopupShown({step:n,context:t&&t.context}),this._dynamicContent.update()):(this._dynamicContent.setStep(p.Step.LOADING),this._updateHeader(),f.show.apply(this,arguments),this._dynamicContent.update(),e._paymentFormLoader.loadPaymentMethods(function(){n&&(n!==p.Step.ABOUT_BOOSTER&&n!==p.Step.ABOUT_PREMIUM||(e.updateSubscriptionExpirationDate(),e.resolveButtonExtendSubscription()),e._dynamicContent.showStep(n,void 0,!1,!0),r()),e._sendEventPopupShown({step:n,context:t&&t.context})}))},_showStep:function(t){t!==p.Step.ABOUT_BOOSTER&&t!==p.Step.ABOUT_PREMIUM||(this.updateSubscriptionExpirationDate(),this.resolveButtonExtendSubscription()),this._dynamicContent.setStep(t)},hide:function(t){t=t||{};var e=void 0!==t.animation?!!t.animation:!0,n=void 0!==t.silent?!!t.silent:!1;this._paymentFormLoader.stop(),f.hide.call(this,n,{animation:e})},_sendEventPopupShown:function(t){-1!==[p.Step.ABOUT_DEFAULT,p.Step.ABOUT_BOOSTER].indexOf(t.step)?r.track("All Subscriptions Popup Shown",{context:t.context}):-1!==[p.Step.PREMIUM,p.Step.PREMIUM_PREVIEW,p.Step.BOOSTER,p.Step.BOOSTER_PREVIEW].indexOf(t.step)?r.track("Subscription Popup Shown",{sub_type:"premium",context:t.context}):-1!==[p.Step.DEFAULT,p.Step.DEFAULT_PREVIEW].indexOf(t.step)&&r.track("Subscription Popup Shown",{sub_type:"standard",context:t.context})},_sendEventSubscriptionInitiated:function(t){t&&("default"===t&&(t="standard"),r.track("Subscription Initiated",{sub_type:t,method:this._lastPaymentMethod}))},updateSubscriptionExpirationDate:function(){i.user.isUserPresent()&&(i.user.isSubscriptionDefault()&&this.$elemSubscriptionExpirationDate.html(o(1e3*i.user.getSubscription("default").expires_at).format("D MMMM YYYY")),i.user.isSubscriptionPremium()&&this.$elemSubscriptionExpirationDatePremium.html(o(1e3*i.user.getSubscription("premium").expires_at).format("D MMMM YYYY")))},resolveButtonExtendSubscription:function(){!i.user.isSubscriptionDefault()||i.user.isRecurrentDefaultActive()||i.user.isSubscriptionPremium()?this.$elemButtonExtendSubscription.attr("hidden","hidden"):this.$elemButtonExtendSubscription.removeAttr("hidden")},_getStepByUserSubscription:function(){return i.user.isSubscriptionPremium()&&i.user.isRecurrentPremiumActive()?p.Step.PAYMENT_FORM:i.user.isSubscriptionPremium()?p.Step.ABOUT_PREMIUM:i.user.isSubscriptionDefault()?p.Step.ABOUT_BOOSTER:p.Step.ABOUT_DEFAULT},_getStepToShowBySubscriptionLevel:function(t){return t===c.SubscriptionType.DEFAULT?p.Step.DEFAULT_PREVIEW:t===c.SubscriptionType.PREMIUM?p.Step.PREMIUM_PREVIEW:t===c.SubscriptionType.BOOSTER?p.Step.BOOSTER_PREVIEW:null},_updateHeader:function(){var t=this._dynamicContent.getCurrentStepName();this._showHeader(t)},_showHeader:function(t){this.$elemsHeaderItems.each(function(){var e=n(this);e.attr("data-step")===t?e.attr("data-visible","true"):e.attr("data-visible","false");
})},_hideHeader:function(){this.$elemsHeaderItems.each(function(){var t=n(this);t.attr("data-visible","false")})},_showAboutDefaultSubscription:function(t){this._dynamicContent.showStep(p.Step.ABOUT_DEFAULT),t=i.tools.mixin(t,{step:p.Step.ABOUT_DEFAULT}),this._sendEventPopupShown(t)},_showAboutBoosterSubscription:function(t){this.updateSubscriptionExpirationDate(),this.resolveButtonExtendSubscription(),this._dynamicContent.showStep(p.Step.ABOUT_BOOSTER),t=i.tools.mixin(t,{step:p.Step.ABOUT_BOOSTER}),this._sendEventPopupShown(t)},_showSelectDuration:function(t){this._updatePaywallKind(t),this._paymentForm.reset(),this._paymentForm.setSubscriptionKind(t),this._paymentFormLoader.show(),this._dynamicContent.showStep(p.Step.SELECT_DURATION),this._trackSubscriptionInitiated(t)},_showPaymentForm:function(t){this._subscriptionDuration=t,this._toggleSubscriptionDurationButtons(t),this._paymentForm.setSubscriptionDuration(t),this._paymentForm._toggleSubscriptionDuration(t),this.isPaypal()?this._paymentForm._selectMethodPaypal():this.isOperator()?this._paymentForm._selectMethodOperator(this._operatorName):this._paymentForm._selectMethodVisa(),this._dynamicContent.showStep(p.Step.PAYMENT_FORM)},_toggleSubscriptionDurationButtons:function(t){var e=this.$elemsSubscriptionDurationButtons.filter('[data-duration="'+t+'"]');this.$elemsSubscriptionDurationButtons.removeClass("active"),e.addClass("active")},_trackSubscriptionInitiated:function(t){var e=t;e===c.SubscriptionType.BOOSTER&&(e=c.SubscriptionType.PREMIUM),r.track("Subscription Initiated",{sub_type:e})},_navigateBack:function(){this._dynamicContent.showPreviousStep(),this._dynamicContent.isStepsStackEmpty()&&this._hideLinkBack()},_showLinkBack:function(){this.$elemLinkBack.attr("data-visible","true")},_hideLinkBack:function(){this.$elemLinkBack.attr("data-visible","false")},setStep:function(t){},destroy:function(){},_isContextReader:function(){return this._context===p.Context.READER},getPaymentMethod:function(){return this._operatorName||this.$elemPaymentMethod.data("payment-method")},isPaypal:function(){return"braintreepaypal"===this.getPaymentMethod()},isOperator:function(){return _.include(p.Operators,this.getPaymentMethod())}}),e(h)})}(this,this.modules,this.jQuery,this.BM,this.moment,this.DIMixpanel),function(t,e,n,i,o){e.define("giftsInit",["giftsPopupPaywall","giftsEmail","giftsCarousel","giftCards","ampersandModel"],function(e,n,r,s,a,u){var l=$(t),c=$(".bm-layout-gifts"),d=$(".gifts-promocode"),h=$("@promocode-value"),p=$("@promocode-duration"),f=$("@create-subscription"),m=$("@image-slide"),g=$(".gifts-book-slider-desktop .bm-carousel-wrapper"),b=new n,_=function(){y(),w(),k(),i.track("Gift Page Shown")},y=function(){o.tools.client.isTouch()||l.on("resize",w),f.on(o.tools.client.touchEvent,C),b.on("subscription-success",x)},v=function(){o.tools.client.isTouch()||t.skrollr.init({forceHeight:!1})},w=function(){o.tools.client.isBreakpointMobile()||m.css("height",.7*t.innerHeight),setTimeout(v,100)},k=function(){if(!o.tools.client.isTouch()){var t=g[0];if(t){var e=(t.scrollWidth-t.offsetWidth)/2;g.animate({scrollLeft:e},10)}}},C=function(t){t.preventDefault(),t.stopPropagation(),S()},S=function(){b.show({context:"gift",step:"select-duration",callback:function(){b._showSelectDuration("premium")}})},x=function(t){l.off("resize",w),d.data("value",t.code),d.data("duration",t.duration),h.html(t.code),p.html(t.duration),c.addClass("success"),c.addClass("gift-cards"),c.find(".gift-cards-header").removeClass("hidden"),c.find(".gift-cards-body").removeClass("hidden"),a.initWithData({code:t.code,duration:t.subscription_duration}),m.css("height","auto")};_()})}(this,this.modules,this.radio,this.DIMixpanel,this.BM),function(t,e,n){e.define("netologyInit",["PopupPaywall"],function(e,i){var o=$("@netology-layout"),r=$("@netology-button"),s=$("@netology-error"),a=new i;if(t.history&&t.location.search){var u=t.location.search.slice(1).split("&").filter(function(t){return!t.startsWith("access_token")}).join("&");t.history.pushState("",document.title,t.location.pathname+"?"+u)}a.on("subscription-success",function(){a.hide(),c()});var l=function(){a.show({context:"giftsfromnetology"})},c=function(){s.hide(),r.addClass("m-wait"),$.ajax({url:"/partners/netology",type:"put",data:{},dataType:"json",success:function(){o.addClass("success"),r.removeClass("m-wait"),$(t).scrollTop(0)},error:function(t){var e=t.responseJSON;return r.removeClass("m-wait"),e?"gifts_run_out"===e.action?void o.addClass("empty"):"paywall"===e.action?void l():void(e.message&&(s.text(e.message),s.show())):void 0}})};r.on("click",function(){n.user.anySubscriptionPresent()?c():l()}),e()})}(this,this.modules,this.BM),function(t,e){"use strict";var n=function(t){$("@appld-install").on("click",function(){var t=$(this).data("platform")||"none";e.track("Install App Button Pressed",{app:t,context:"main"})}),$("@appld-get-app-button").on("click",function(){e.track("Get the App Button Pressed",{context:"main"})}),t()};t.define("indexAnalytics",[],n)}(this.modules,this.DIMixpanel),function(t,e,n,i,o){"use strict";var r=function(t,e){new e(n(".bm-bookshelves-index-list"),{context:"main"});t()};o.define("moduleIndexPageBookshelves",["BookshelvesListInitializer"],r)}(this,this.document,this.jQuery,this.radio,this.modules),function(t,e,n){"use strict";n.define("moduleIndexCarousel",[],function(t){var n=e(".bm-carousel");n.carousel(),t({})})}(this,this.jQuery,this.modules),function(t,e,n,i,o,r){"use strict";o.define("moduleIndexPageEmailLink",["formSendLink"],function(t,e){e("@form-send-link"),t()})}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel),function(t){"use strict";var e=function(t,e){t({})};t.define("indexInit",["loginWindowWithUlmartAddon","moduleIndexPageBookshelves","moduleIndexCarousel","moduleIndexPageEmailLink","moduleLibraryShelvesResponsive","modulePlatform","moduleSlideshowInit","moduleIndexPageSubscription","appLandingModals"],e)}(this.modules),function(t,e,n,i,o){"use strict";o.define("moduleLibraryShelvesResponsive",[],function(t){var e=260,o=14,r=3,s=n(".library-shelves-wrapper"),a=n(".library-shelves-content"),u=n(".library-shelves-show-more"),l=function(){u.attr("hidden","hidden")},c=function(){var t=a.height(),n=s.height(),i=(e+o)*r,u=n+i;u>t-100&&(u=t,l()),s.css({"max-height":u})};u.bind("click",function(){c()}),n("@bookCarousel").each(function(t,e){var o=n(e).find("@bookCarouselWrapper");o.on("scroll",function(){i("close-dropdowns").broadcast()}),n(e).find("@lazyImage").lazyload({effect:"fadeIn",threshold:200,placeholder:"",container:o,load:function(){n(this).removeClass("lazyloading")}})}),n("@libraryShelves @lazyImage").lazyload({effect:"fadeIn",threshold:300,placeholder:""}),t()})}(this,this.document,this.jQuery,this.radio,this.modules),function(t,e,n,i,o,r){"use strict";var s=function(e,o){var s=(n(".bookmate-popup-auth-overlay"),n("<div>")),a=n("#authpopup-ulmart-addon").html(),u=r.to_html(a),l=new o({preventDefaultLoginBehavior:!0});l.on("authenticationSuccessful",function(e,n,i){console.log(i),i&&i.redirect_to&&(t.location.href=i.redirect_to)});var c=function(){var t=l.getElement().find(".authpopup"),e=l.getElement().find(".authpopup-inital .authpopup-content");s.append(u),e.prepend(s),t.addClass("m-with-ulmart-addon"),l.showWindow(),i("bookmate-popup-show").broadcast(),i("bookmate-popup-register-show").broadcast()};e({init:function(){},show:c})};o.define("loginWindowWithUlmartAddon",["loginWindow"],s)}(this,this.document,this.jQuery,this.radio,this.modules,this.Mustache),function(t,e,n,i,o,r){"use strict";var s=function(e){n(".mobileapp-site-app-link, .link-appstore").on("click",function(e){e.preventDefault();var i=n(this).data("app"),o=this.href;r.track("Install App Button Pressed",{app:i}),setTimeout(function(){t.location.href=o},100)}),e()};o.define("modulePlatform",[],s)}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel),function(t){"use strict";var e=function(t,e,n,i,o,r){t()};t.define("indexSetup",["appLandingSetup","indexAnalytics","appLandingIpad","appLandingModals","appLandingSlider"],e)}(this.modules),function(t,e,n,i){"use strict";n.define("moduleSlideshowInit",["Slideshow"],function(n,o){var r=e(".bm-slideshow");r.each(function(t,n){new o(e(n))}),r.find(".bm-slideshow-slide a").on("click",function(n){n.preventDefault();var o=this.href;i.discovered.set({channel:"book",ctx:e(this).data("mixpanel-ctx")}),i.track("Featured Book Selected"),setTimeout(function(){t.location.href=o},300)}),n()})}(this,this.jQuery,this.modules,this.DIMixpanel),function(t,e,n,i,o){"use strict";n.define("moduleIndexPageSubscription",["loginWindow","PopupPaywall"],function(t,n,o){var r=e("@index-subscription-button"),s=new n({preventDefaultLoginBehavior:!0,context:"subscription"}),a=new o({useTemplate:!0});r.on("click",function(){i.user.isUserPresent()?a.show({step:"auto",context:"main_green"}):(s.showWindow("inital"),s.on("authenticationSuccessful",function(){s.closeWindow(),a.show({step:"auto",context:"main_green"})}))}),t()})}(this,this.jQuery,this.modules,this.BM=this.BM||{},this.DIMixpanel),function(t,e,n){n.define("libraryBigbook2015Init",["moduleButtonRead","SocialCounters"],function(t,e,n){var i=$(".bm-bigbook-page-layout"),o=i.find("@bm-social-counters"),r=function(){var t=new n({context:"bigbook",element:o});t.setConfig()},s=function(){$("@bm-button-read").each(function(){new e({element:$(this)})})};r(),s(),t()})}(this,this.DIMixpanel,this.modules),function(t){"use strict";var e=function(t){t({})};t.define("libraryInit",["lazyloadImages"],e)}(this.modules),function(t,e,n,i,o){"use strict";var r=function(t,e){n("@lazyloadedShelf @lazyImage").lazyload({effect:"fadeIn",placeholder:""})};o.define("lazyloadImages",["config"],r)}(this,this.document,this.jQuery,this.radio,this.modules),function(t,e,n){e.define("skyengInit",["PopupPaywall"],function(e,i){var o=$("@skyeng-layout"),r=$("@skyeng-button"),s=$("@skyeng-error"),a=new i;if(t.history&&t.location.search){var u=t.location.search.slice(1).split("&").filter(function(t){return!t.startsWith("access_token")}).join("&");t.history.pushState("",document.title,t.location.pathname+"?"+u)}a.on("subscription-success",function(){a.hide(),c()});var l=function(){a.show({context:"giftsfromskyeng"})},c=function(){s.hide(),r.addClass("m-wait"),$.ajax({url:"/giftsfromskyeng",type:"post",data:{},dataType:"json",success:function(){o.addClass("success"),r.removeClass("m-wait"),$(t).scrollTop(0)},error:function(t){var e=t.responseJSON;return r.removeClass("m-wait"),e?"gifts_run_out"===e.action?void o.addClass("empty"):"paywall"===e.action?void l():void(e.message&&(s.text(e.message),s.show())):void 0}})};r.on("click",function(){n.user.anySubscriptionPresent()?c():l()}),e()})}(this,this.modules,this.BM),function(t,e,n,i,o){e.define("initLibraryCards",["moduleButtonReadDropdown"],function(e,r){var s=n("@lc-counter-reading"),a=n("@lc-counter-pending"),u=n("@lc-counter-finished"),l=n("@lc-counter-all-books"),c=function(){return t.location.pathname==="/"+i.user.getLogin()+"/all"},d=function(){return"0"===s.html()||"0"===a.html()||"0"===u.html()||"0"===l.html()},h=function(t,e){var n,i;t.length>0&&(n=parseInt(t.html(),10),i=n+e,0>=i&&t.attr("hidden","hidden"),t.html(i))},p=function(t){return h(s,t)},f=function(t){return h(a,t)},m=function(t){return h(l,t)},g=function(t){return h(u,t)},b=function(t){t.previous===r.LCState.READING?p(-1):t.previous===r.LCState.PENDING?f(-1):t.previous===r.LCState.FINISHED&&g(-1),t.current===r.LCState.READING?p(1):t.current===r.LCState.PENDING?f(1):t.current===r.LCState.FINISHED&&g(1)},_=function(t){return n(".book[data-uuid="+t+"]")};i.user.isUserPresent()&&i.user.getViewingUserLogin()!==i.user.getLogin()||(o("user-library-card-removed").subscribe(function(e){var i=_(e.libraryCard.uuid);n(".book").length<=1?t.location.reload():(b(e.libraryCard.state),m(-1),d()?t.location.reload():i.remove()),i.length>0}),o("user-library-card-state-update").subscribe(function(e){var i=_(e.libraryCard.uuid);n(".book").length<=1?t.location.reload():(c()||i.remove(),b(e.libraryCard.state))}),e({}))})}(this,this.modules,this.jQuery,this.BM,this.radio),function(t,e,n){"use strict";e.define("initLibrarySchool",["LibrarySchool"],function(t,e){new e;t()})}(this,this.modules,this.jQuery),function(t,e,n){"use strict";e.define("LibrarySchool",[],function(t){var e=function(){function t(e){_classCallCheck(this,t),this._setElements(),this._setEventListeners(),this._setBackground(),this._setLazyLoad()}return t.getRandomNumber=function(t){return Math.floor(Math.random()*t)},t.prototype._setElements=function(){this.$lazyLoadImages=n("@lazyImage"),this.$backgroundLayer=n("@school-background"),this.$expandButtons=n("@school-expand"),this.$shelves=n("@school-shelf")},t.prototype._setEventListeners=function(){var t=this,e=BM.tools.client.isTouch()?"tap":"click";this.$expandButtons.on(e,function(e){return t._onExpandButtonTap(e)})},t.prototype._setLazyLoad=function(){this.$lazyLoadImages.lazyload({effect:"fadeIn",threshold:300,placeholder:""})},t.prototype._setBackground=function(){this.$backgroundLayer.attr("data-background",t.getRandomNumber(12))},t.prototype._onExpandButtonTap=function(t){var e=n(t.currentTarget).data("grade");this.expandShelf(e)},t.prototype.expandShelf=function(t){var e=this.$shelves.filter("[data-grade="+t+"]");e.addClass("expanded")},t.prototype.collapseShelves=function(){this.$shelves.removeClass("expanded")},t}();t(e)})}(this,this.modules,this.jQuery),function(t,e,n,i){"use strict";var o=function(t,o,r){e("@stats-2014-social-counter").socialCounters(),new r({element:"@2014-quotes-slider"}),new r({element:"@2014-covers-slider"}),e(function(){e(".bm-stats-2014").addClass("visible"),e("@stats-2014-curl").addClass("animated")}),e("@bm-book-card").each(function(t){new o({element:this})}),null===i.getItem("2014-stats-page-shown")&&(i.setItem("2014-stats-page-shown","1",18e5,"/"),n.track("NY 2014 Page Shown")),t()};t.define("stats2014Init",["moduleBookCard","moduleReviewSlider"],o)}(this.modules,this.jQuery,this.DIMixpanel,this.docCookies),function(t,e,n,i){e.define("impressionPageInit",["extend","baseView","dynamicContent","ImpressionItem"],function(t,e,o,r,s){var a=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments),this.$elem&&0!==this.$elem.length&&(this._parseConfig(),this.$dc=this.$elem.find("@bm-dynamic-content"),this.$itemWrapper=this.$elem.find("@bm-impression-page-item-wrapper"),this._item=null,this._dc=null,this._initDynamicContent(),this._initItem())},e.prototype._initDynamicContent=function(){i.tools.isNull(this._dc)&&(this._dc=new r({element:this.$dc}))},e.prototype._initItem=function(){var t=this;i.tools.isNull(this._item)&&(this._item=new s({data:{model:{uuid:this._config.uuid},view:{state:{likesSimple:!1,popup:!1}}}}),this._item.model.on("fetch-success",function(e){t._onFetchSuccess()}),setTimeout(function(){t._item.model.fetch()},300))},e.prototype._onFetchSuccess=function(){var t=this;this._item.renderViewWithModelData(),this._item.update(),this._item.model.isCurrentUserOwner()&&(this._item.view.state={edit:!0,remove:!0}),this._item.view.state={topControls:!0},this._dc.showStep("content",function(){t.$elem.append(t._item.view.el)})},e}(o);new a({element:n("@bm-impression-page")}),t(a)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){"use strict";var o=function(t,o,r,s,a,u){function l(t){var i=u.tools.client.isTouch()?u.tools.client.touchEvent:"click";t.on(i,function(t){e(this).hasClass("selectable")||u.tools.client.isTouch()||(t.preventDefault(),t.stopPropagation(),n.discovered.set({channel:"book",ctx:"results2015",uuid:e(this).parent().find(".bookcard-link").data("discovered-id")}),a.navigateToBookPage(e(this).parent().find(".bookcard-link").data("book-uuid")))}),c()}function c(){var t=this;radio("authenticationSuccessful").subscribe(function(e,n,i,o){authPopupOpener===t&&(t._loginWindow.preventDefaultLoginBehavior!==!1?null!==t._readButtonHandler&&t._readButtonHandler.sendRequestAddBookToLibrary():t._reloadAfterBookAdding=!1)})}function d(){var t,n=function(){var t=e(".stats-2015__map"),n=e(".stats-2015__section--map");setInterval(function(){var i=e(window).width(),o=e(window).height();t.add(n).css("width",i+"px"),t.css("height",.67*o+"px"),t.css("margin","0"),n.css("margin","0").css("margin-left","-"+n.offset().left+"px")},500)},i=function(){var n,i=u.config.mainConfig.locale,o="https://bookmate.com/images/library/2015/pin.png",r=[];n="ru"==i?[{country:"Russia",coords:{lat:61.52401,lng:105.318756}},{country:"Ukraine",coords:{lat:48.379433,lng:31.16558}},{country:"Belarus",coords:{lat:48.379433,lng:31.16558}},{country:"Kazakhstan",coords:{lat:48.019573,lng:66.923684}},{country:"Kazakhstan",coords:{lat:48.019573,lng:66.923684}},{country:"United States",coords:{lat:37.09024,lng:-95.712891}},{country:"Israel",coords:{lat:31.046051,lng:34.851612}},{country:"Germany",coords:{lat:51.165691,lng:10.451526}},{country:"Turkey",coords:{lat:38.963745,lng:35.243322}},{country:"Indonesia",coords:{lat:-.789275,lng:113.921327}},{country:"United Kingdom",coords:{lat:55.378051,lng:-3.435973}},{country:"Italy",coords:{lat:41.87194,lng:12.56738}},{country:"France",coords:{lat:46.227638,lng:2.213749}},{country:"Greece",coords:{lat:39.074208,lng:21.824312}},{country:"Kyrgyzstan",coords:{lat:41.20438,lng:74.766098}},{country:"Azerbaijan",coords:{lat:40.143105,lng:47.576927}},{country:"China",coords:{lat:35.86166,lng:104.195397}},{country:"Singapore",coords:{lat:1.352083,lng:103.819836}},{country:"India",coords:{lat:20.593684,lng:78.96288}},{country:"Canada",coords:{lat:56.130366,lng:-106.346771}},{country:"Mexico",coords:{lat:23.634501,lng:-102.552784}},{country:"Malaysia",coords:{lat:4.210484,lng:101.975766}},{country:"Belgium",coords:{lat:50.503887,lng:4.469936}},{country:"Guatemala",coords:{lat:15.783471,lng:-90.23075899999999}},{country:"Colombia",coords:{lat:4.570868,lng:-74.297333}},{country:"Japan",coords:{lat:36.204824,lng:138.252924}},{country:"Australia",coords:{lat:-25.274398,lng:133.775136}},{country:"Sweden",coords:{lat:60.12816100000001,lng:18.643501}},{country:"Serbia",coords:{lat:44.016521,lng:21.005859}},{country:"South Africa",coords:{lat:-30.559482,lng:22.937506}},{country:"Bolivia",coords:{lat:-16.290154,lng:-63.58865299999999}},{country:"Portugal",coords:{lat:39.39987199999999,lng:-8.224454}},{country:"Philippines",coords:{lat:12.879721,lng:121.774017}},{country:"Nigeria",coords:{lat:9.081999,lng:8.675277}},{country:"Republic of Ireland",coords:{lat:53.41291,lng:-8.24389}},{country:"Hungary",coords:{lat:47.162494,lng:19.503304}},{country:"Chile",coords:{lat:-35.675147,lng:-71.542969}},{country:"Tajikistan",coords:{lat:38.861034,lng:71.276093}},{country:"Malta",coords:{lat:35.937496,lng:14.375416}},{country:"Dominican Republic",coords:{lat:18.735693,lng:-70.162651}},{country:"Brazil",coords:{lat:-14.235004,lng:-51.92528}},{country:"Paraguay",coords:{lat:-23.442503,lng:-58.443832}},{country:"Slovenia",coords:{lat:46.151241,lng:14.995463}},{country:"Cambodia",coords:{lat:12.565679,lng:104.990963}},{country:"Romania",coords:{lat:45.943161,lng:24.96676}},{country:"Saudi Arabia",coords:{lat:23.885942,lng:45.079162}},{country:"Taiwan",coords:{lat:23.69781,lng:120.960515}},{country:"Luxembourg",coords:{lat:49.815273,lng:6.129582999999999}},{country:"Monaco",coords:{lat:43.73841760000001,lng:7.424615799999999}},{country:"Peru",coords:{lat:-9.189967,lng:-75.015152}},{country:"Iceland",coords:{lat:64.963051,lng:-19.020835}},{country:"Angola",coords:{lat:-11.202692,lng:17.873887}},{country:"Zimbabwe",coords:{lat:-19.015438,lng:29.154857}},{country:"Iran",coords:{lat:32.427908,lng:53.688046}},{country:"Mongolia",coords:{lat:46.862496,lng:103.846656}},{country:"Jamaica",coords:{lat:18.109581,lng:-77.297508}},{country:"Iraq",coords:{lat:33.223191,lng:43.679291}},{country:"South Sudan",coords:{lat:6.876991899999999,lng:31.3069788}},{country:"Ghana",coords:{lat:7.946527,lng:-1.023194}},{country:"The Bahamas",coords:{lat:25.03428,lng:-77.39627999999999}},{country:"Cuba",coords:{lat:21.521757,lng:-77.781167}},{country:"Andorra",coords:{lat:42.506285,lng:1.521801}},{country:"Syria",coords:{lat:34.80207499999999,lng:38.996815}},{country:"Senegal",coords:{lat:14.497401,lng:-14.452362}},{country:"Mozambique",coords:{lat:-18.665695,lng:35.529562}}]:[{country:"Russia",coords:{lat:61.52401,lng:105.318756}},{country:"United States",coords:{lat:37.09024,lng:-95.712891}},{country:"Germany",coords:{lat:51.165691,lng:10.451526}},{country:"Turkey",coords:{lat:38.963745,lng:35.243322}},{country:"Indonesia",coords:{lat:-.789275,lng:113.921327}},{country:"United Kingdom",coords:{lat:55.378051,lng:-3.435973}},{country:"Italy",coords:{lat:41.87194,lng:12.56738}},{country:"France",coords:{lat:46.227638,lng:2.213749}},{country:"Singapore",coords:{lat:1.352083,lng:103.819836}},{country:"India",coords:{lat:20.593684,lng:78.96288}},{country:"Canada",coords:{lat:56.130366,lng:-106.346771}},{country:"Mexico",coords:{lat:23.634501,lng:-102.552784}},{country:"Malaysia",coords:{lat:4.210484,lng:101.975766}},{country:"Belgium",coords:{lat:50.503887,lng:4.469936}},{country:"Guatemala",coords:{lat:15.783471,lng:-90.23075899999999}},{country:"Colombia",coords:{lat:4.570868,lng:-74.297333}},{country:"Japan",coords:{lat:36.204824,lng:138.252924}},{country:"Australia",coords:{lat:-25.274398,lng:133.775136}},{country:"Sweden",coords:{lat:60.12816100000001,lng:18.643501}},{country:"South Africa",coords:{lat:-30.559482,lng:22.937506}},{country:"Bolivia",coords:{lat:-16.290154,lng:-63.58865299999999}},{country:"Portugal",coords:{lat:39.39987199999999,lng:-8.224454}},{country:"Philippines",coords:{lat:12.879721,lng:121.774017}},{country:"Nigeria",coords:{lat:9.081999,lng:8.675277}},{country:"Republic of Ireland",coords:{lat:53.41291,lng:-8.24389}},{country:"Hungary",coords:{lat:47.162494,lng:19.503304}},{country:"Chile",coords:{lat:-35.675147,lng:-71.542969}},{country:"Dominican Republic",coords:{lat:18.735693,lng:-70.162651}},{country:"Brazil",coords:{lat:-14.235004,lng:-51.92528}},{country:"Paraguay",coords:{lat:-23.442503,lng:-58.443832}},{country:"Romania",coords:{lat:45.943161,lng:24.96676}},{country:"Saudi Arabia",coords:{lat:23.885942,lng:45.079162}},{country:"Taiwan",coords:{lat:23.69781,lng:120.960515}},{country:"Peru",coords:{lat:-9.189967,lng:-75.015152}},{country:"Iceland",coords:{lat:64.963051,lng:-19.020835}},{country:"Zimbabwe",coords:{lat:-19.015438,lng:29.154857}},{country:"Iran",coords:{lat:32.427908,lng:53.688046}},{country:"Jamaica",coords:{lat:18.109581,lng:-77.297508}},{country:"Iraq",coords:{lat:33.223191,lng:43.679291}},{country:"Ghana",coords:{lat:7.946527,lng:-1.023194}},{country:"The Bahamas",coords:{lat:25.03428,lng:-77.39627999999999}},{country:"Mozambique",coords:{lat:-18.665695,lng:35.529562}}],e(".book-info").each(function(){var t={};t.title=e(this).data("title"),t.author=e(this).data("author"),t.cover=e(this).data("cover"),t.id=e(this).data("id"),r.push(t)});var s,a,l=e.extend(!0,n,r);l.forEach(function(e){var n,i=new google.maps.Marker({position:e.coords,title:e.country,map:t,icon:o});n=e.cover?'<img class="info-cover" src="'+e.cover+'" /><br>':"";var r="https://bookmate.com/books/"+e.id,u=new google.maps.InfoWindow({content:'<div class="info-window"><a href="'+r+'" >'+n+'<div class="info-title">'+e.title+'</div><div class="info-author">'+e.author+"</div></a></div>"});i.addListener("click",function(){s&&a.close(t,s),u.open(t,i),s=i,a=u})})},o=function(){n();var o=setInterval(function(){e(".stats-2015__section--map").hasClass("initiated")&&(t=new google.maps.Map(document.getElementById("stats-2015__map"),{center:{lat:45.3269,lng:.0075},zoom:3,scrollwheel:!1,styles:[{featureType:"administrative.locality",elementType:"all",stylers:[{hue:"#2c2e33"},{saturation:7},{lightness:19},{visibility:"on"}]},{featureType:"landscape",elementType:"all",stylers:[{hue:"#ffffff"},{saturation:-100},{lightness:100},{visibility:"simplified"}]},{featureType:"poi",elementType:"all",stylers:[{hue:"#ffffff"},{saturation:-100},{lightness:100},{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{hue:"#bbc0c4"},{saturation:-93},{lightness:31},{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{hue:"#bbc0c4"},{saturation:-93},{lightness:31},{visibility:"on"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{hue:"#bbc0c4"},{saturation:-93},{lightness:-2},{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry",stylers:[{hue:"#e9ebed"},{saturation:-90},{lightness:-8},{visibility:"simplified"}]},{featureType:"transit",elementType:"all",stylers:[{hue:"#e9ebed"},{saturation:10},{lightness:69},{visibility:"on"}]},{featureType:"water",elementType:"all",stylers:[{hue:"#e9ebed"},{saturation:-78},{lightness:67},{visibility:"simplified"}]},{featureType:"administrative.province",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"labels",stylers:[{visibility:"off"}]}]}),clearInterval(o),i())},500)};o()}function h(){var t=u.config.mainConfig.locale,n=e(".stats-2015__section--most-impressed .bookcard"),i=[" ","","","",""," ","","","","  "],o=["Unputdownable","Loved up","Hidden Depths","Learnt A Lot","Worthwhile","Beach Bag Book","Utter Crap","Spooky","LOLZ","Lost on me"],r=["Adictivo","Romntico","Profundidades","He aprendido mucho","Vale la pena","Libro de playa","Una porquera","Espeluznante","Juas","Ni fu ni fa"],s=["Sangat menarik","Romantis","Kearifan Tersembunyi","Banyak pelajaran","Bermanfaat","Buku Bekal Liburan","Omong kosong","Mengerikan","Lucu","Tidak Mengerti"],a=["","","","","","","","","",""],l={en:o,ru:i,es:r,id:s};l[t]||(l[t]=o),n.each(function(n){e(this).prepend(e("<div />",{"class":"bookcard-layer",html:a[n]+'<div class="bookcard-layer-note">'+l[t][n]+"</div>"})).find(".bookcard-label").text(a[n]+l[t][n])}),e(window).width()>1023&&e(".bookcard-layer").eq(7).slideToggle(),e(".bookcard-layer").click(function(t){var n=parseInt(e(".bookcard-layer").first().css("height"));t.preventDefault(),e(this).animate({"margin-top":-n+"px"},500)})}function p(){var t=u.config.mainConfig.locale;if("ru"==t||"en"==t||"id"==t){var n=e(".bm-page-about-content-reviews-item"),i=[{author:"tetvladimir",id:"P8COrQct"},{author:"blackbiblee",id:"CMDXkwmM"},{author:"mrsgalt",id:"EdmFT44C"},{author:"ksenialog",id:"Mml817J6"},{author:"rubomari",id:"ag09JE9E"},{author:"JKB",id:"V7bCuWDb"},{author:"administrator",id:"bfbH8s8L"},{author:"SeTeM",id:"TcW3GbCJ"},{author:"ignatgrob",id:"OOUsxU68"},{author:"nadyayurinova",id:"ZBRLh4Lb"}],o=[{author:"roginikandayah",id:"tiKT8cez"},{author:"romalapin",id:"sWdJVMFe"},{author:"b1784340806",id:"vGWsJm0E"},{author:"b9332057693",id:"gjhwe9qC"},{author:"yooooyana",id:"e6PjIeii"},{author:"antonagorodetsky",id:"iZFfV4VA"},{author:"kseniakriukova",id:"nszDehRW"},{author:"SamiraGuliyeva91",id:"JkDmud34"},{author:"b4746233619",id:"Jhtdi3rc"},{author:"asanisimasalait",id:"jNs4yO7z"}],r=[{author:"shafiraartiza",id:"LcCeyiDD"},{author:"annatigina",id:"DxYAnBbr"},{author:"faridisalman",id:"Lrja4cTN"},{author:"lailiaja2",id:"LvqleTgH"},{author:"AyuriscaPL",id:"CsjMZDaW"},{author:"aimeeetha",id:"DNywf39o"}],a={ru:i,en:o,id:r};n.each(function(t){e(this).attr("id","quote-"+t)}),n.each(function(n){var i=e(e(this)[0]).find("@bm-button-social-share"),r=new s({element:i});if(a[t]||(a[t]=o),e("#quote-"+n).find(".bm-quote-social").append(r.getElement()),a[t][n]){var u="https://bookmate.com/"+a[t][n].author+"/quotes/"+a[t][n].id;r.setConfig({dropdown:!0,url:u,twitter:{url:u},vkontakte:{url:u,description:"auto",title:"auto"}})}}),"ru"==t?e(".bm-button-social-share").append(""):"id"==t?e(".bm-button-social-share").append("Bagikan"):"en"==t&&e(".bm-button-social-share").append("Share")}}function f(t,e){return u.tools.isString(t)&&!u.tools.isNull(e)&&t.length>e?("("===t[0]&&")"===t[t.length-1]&&(t=t.slice(1,t.length-1)),t=t.replace(/ ?\([^)]+\) ?/gi," "),t.length<=e?t:(t=t.trim().slice(0,e),"("===t[0]&&(t=t.slice(1,t.length)),-1!==t.indexOf(".")?(t.lastIndexOf("."),t=t.slice(0,t.lastIndexOf("."))):-1!==t.indexOf(":")?t=t.slice(0,t.lastIndexOf(":")):(t=t.split(" "),t[t.length-1].length>=3?t[t.length-1]="...":(t.splice(t.length-1,1),t[t.length-1]="..."),t=t.join(" "),t=t.slice(0,-4)+"...",","===t[t.length-4]&&(t=t.slice(0,-4)+"...")),t)):t}function m(){e(".bookcard-title").find(".bookcard-meta-link").each(function(t){e(this).text(f(e(this).text(),40))})}function g(){function t(t,e){var n=[2,0,1,1,1,2];return e[t%100>4&&20>t%100?2:n[5>t%10?t%10:5]]}function n(t,e){return Math.floor(Math.random()*(e-t))+t}var i=[{min:0,max:0,color:"#4FB5F0",data:["    <br>  ","   <br>     "]},{min:1,max:2,color:"#E3CA4B",data:[" ,   <br>    "," ,  <br>   ","   3D- <br>   "," ,   <br>    ","      <br>    "]},{min:3,max:5,color:"#FC8053",data:["   "," ,   <br>    "]},{min:6,max:14,color:"#36CF6E",data:["    <br>      "]},{min:15,max:17,color:"#36CF6E",data:["C      <br>    "]},{min:18,max:28,color:"#4F95F0",data:["    <br>    ","     <br> 1    ","     <br>   "]},{min:29,max:45,color:"#FC8053",data:["   <br>    ","   ","   - <br>   -","     <br>     "]},{min:46,max:79,color:"#4FB5F0",data:["    <br>    ","     <br> c  "]},{min:80,max:147,color:"#47DB9C",data:["  -","    <br>  ","     <br>  ,   "]},{min:148,max:200,color:"#E3CA4B",data:["   <br> "]},{min:201,max:400,color:"#53B5F3",data:["     <br>  ","     <br>  ","   <br>  "]},{min:401,max:450,color:"#F9814F",data:["     <br>    Subterranea"]},{min:451,max:1e4,color:"#F3614C",data:["     <br>     ","   - <br>   "]}],o=[{min:0,max:0,color:"#4FB5F0",data:["The number of daylight hours Svalbard <br> gets during winter","The number of hours David Bowie spent <br> on stage during his only USSR concert","The average length of time a bald man <br> spends styling his hair","Time taken to eat an entire <br> square of chocolate"]},{min:1,max:2,color:"#E3CA4B",data:["How long it takes to get to the bottom <br> of your Facebook feed","The amount of time needed <br> to digitize a book","The amount of time it takes <br> to 3D print a human ear","The maximum length of time a sperm <br> whale can stay underwater for","The amount of time given to eat the <br> worlds biggest steak (and get it free)"]},{min:3,max:3,color:"#FC8053",data:["How long the euphoria from booze lasts","The amount of time needed to set up <br> the sails on a three-mast bark"]},{min:4,max:5,color:"#36CF6E",
data:["The longest ever speech given to the UN <br> General Assembly (by Fidel Castro in 1960)"]},{min:6,max:8,color:"#36CF6E",data:["The time taken to reach the worlds most remote <br> school  in Gulu, China  via a narrow mountain path"]},{min:9,max:14,color:"#E3CA4B",data:["The time it takes to watch <br> The Lord of The Rings trilogy in one sitting"]},{min:15,max:17,color:"#36CF6E",data:["The duration of all four acts of Wagners Der Ring <br> des Nibelungen (intermissions excluded)"]},{min:18,max:29,color:"#4F95F0",data:["How long a flu virus can live outside <br> the body","How long it takes a radio signal to reach <br> Voyager 1 at the edge of our solar system","How long it takes a cat to completely <br> forget what happened to it yesterday","A smart watchs battery life"]},{min:30,max:45,color:"#FC8053",data:["The duration of an ultramarathon <br> in Death Valley, California","The amount of time it takes <br> for dry ice to melt","How long it takes to cook Peking Duck <br> or Beef Bourguignon to perfection","The average amount of time Cambridge University <br> students actually spend studying each week"]},{min:46,max:79,color:"#4FB5F0",data:["How long geese take to fly from Sweden <br> to Catalonia for the winter","The amount of time it takes <br> a beaver fell a single tree"]},{min:80,max:147,color:"#47DB9C",data:["The lifespan of a swallowtail butterfly","How long oil paint takes to dry <br> on canvas completely","The duration of the longest ever game <br> of Monopoly played in a bathtub"]},{min:148,max:200,color:"#E3CA4B",data:["The time it takes to travel from Moscow <br> to Vladivostok by train","The duration of the longest continuous <br> cricket match"]},{min:201,max:250,color:"#53B5F3",data:["How long it takes a glass of water to turn <br> into rain.","The average length time it takes for THC to pass <br> through your body after recreational consumption"]},{min:251,max:300,color:"#F3614C",data:["The amount of study time needed for each Chartered <br> Financial Analyst exam (there are three in total)"]},{min:301,max:400,color:"#53B5F3",data:["A hamsters gestation period"]},{min:401,max:450,color:"#F9814F",data:["The duration of the longest song ever <br> recorded (Subterranea by Thom Yorke)"]},{min:451,max:1e4,color:"#F3614C",data:["The amount of time it takes for spruce <br> bark beetles to destroy a pine grove","How long a day lasts on the Moon","How long Japanese kids spend learning <br> in school each year"]}],r=(e(".stats-2015__personal .viewport"),u.config.mainConfig.locale),s={ru:i,en:o};s[r]||(s[r]=o);var a=function(i){s[r].forEach(function(o,s){if(i<=o.max&&i>=o.min){var a=n(0,o.data.length);e(".text-custom").html(o.data[a]),e(".emoji-img").css({"background-image":"url(/personal-stats-2015-img-generator/emoji_"+r+"/"+s+"_"+a+".png)"}),e(".viewport").css({"background-color":o.color}),e(".hours").toggleClass("dense",10>i),"en"===r&&e(".count .text").text(1===i?"hour":"hours"),"ru"===r&&e(".count .text").text(t(i,["","",""])),e(".count .number").text(i)}})};!gon.readHours||"ru"!=r&&"en"!=r||(e(".stats-2015__section--personal").removeClass("hidden"),a(gon.readHours))}function b(){var t=e(".stats-2015__section--our-choice"),n=t.find(".stats-2015__header__curl");n.addClass("hidden"),n.removeClass("animated");var i=setInterval(function(){e(document).scrollTop()>t.offset().top-500&&(n.removeClass("hidden"),n.addClass("animated"),clearInterval(i))},250)}function _(){window.history&&window.history.pushState("",document.title,window.location.pathname)}function y(){setTimeout(function(){var t=e(".item-vk"),n=e(".item-counter"),i=t.last().find(n).text();t.first().find(n).text(i)},4e3)}function v(){var t=e(".bm-personal-social"),n=t.find("@bm-button-social-share"),i=new s({element:n});t.append(i.getElement());var o,r,a=e(".stats-2015__section--personal").find(".number").text(),l=u.config.mainConfig.locale,c="https://bookmate.com/library/2015?hr="+a+"&lang="+l,d="https://assets.bookmate.com/assets/read_hours_2015/"+l+"/"+a+".png";"ru"==e("html").attr("lang")?(t.find(".bm-button-social-share").append(""),r="   ",o=",      2015 "):(t.find(".bm-button-social-share").append("Share"),r="Bookmates Yearbook",o="What, where, and how people read in 2015"),i.setConfig({dropdown:!0,title:r,description:o,url:c,twitter:{title:r,description:o,url:c,image:d},vkontakte:{title:r,description:o,url:c,image:d}})}e("@stats-2015-social-counter").socialCounters({url:"https://bookmate.com/library/2015?lang="+u.user.getLocale()}),new r({element:"@2015-quotes-slider"}),new r({element:"@2015-covers-slider"}),e(function(){e(".bm-stats-2015").addClass("visible"),e("@stats-2015-curl").addClass("animated")}),e("@bm-book-card").each(function(t){new o({element:this})}),null===i.getItem("2015-stats-page-shown")&&(i.setItem("2015-stats-page-shown","1",18e5,"/"),n.track("NY 2015 Page Shown")),e(document).ready(function(){_(),d(),p(),m(),h(),b(),g(),v(),y(),l(e(".bookcard-content").add(".bookcard-bottom-credits"))}),t()};t.define("stats2015Init",["moduleBookCard","moduleReviewSlider","ButtonSocialShare","RouterWeb","BM"],o)}(this.modules,this.jQuery,this.DIMixpanel,this.docCookies),function(t,e,n){n.define("libraryYap2015Init",["moduleButtonRead","SocialCounters"],function(t,e,n){var i=$(".bm-yap-page-layout"),o=i.find("@bm-social-counters"),r=function(){var t=new n({context:"yasnaya_polyana",element:o});t.setConfig()},s=function(){$("@bm-button-read").each(function(){new e({element:$(this)})})};r(),s(),t()})}(this,this.DIMixpanel,this.modules),function(t,e,n,i,o){e.define("mailingInit",["PopupBase","PopupMailing","AccountSettingsPopup","ConfirmInput","loginWindow"],function(e,n,r,s,a,u){var l=function(){function e(){_classCallCheck(this,e),this.setElements(),this.setEventListeners(),this.setCurrentLink(),this.fixSidebar(),this.ifUserHasJustRegistered()}return e.prototype.setElements=function(){this.$mailingContainer=$(".mailing-container"),this.$subscribeForm=$("#subscribe-form"),this.$subscribeFormAnonymous=$("#subscribe-form-anonymous"),this.$subscribeFormHeader=$(".form-header"),this.$submitButton=$(".bm-mailing").find(".subscribe-form-submit"),this.$subscribeInput=$("#subscribers_email"),this.$note=$(".note"),this.$digestInfo=$(".digest-info"),this.$digestContent=$(".digest-content"),this.$digestArchive=$(".digest-archive"),this.$emailSaved=$(".email-saved"),this.lastDigestId=this.$mailingContainer.data("last-digest"),this.$header=this.$digestArchive.find(".header"),this.clickEvent=i.tools.client.isTouch()?i.tools.client.touchEvent:"click",this.popup=new r},e.prototype.setEventListeners=function(){var e=this;this.$header.on(this.clickEvent,function(e){$(t).width()>640||(this.$header.toggleClass("opened"),this.$digestArchive.find("a").add("br").toggle())}.bind(this)),this.$subscribeForm.submit(function(t){t.preventDefault(),e.checkIfAlreadySubscribed()}),this.$subscribeFormAnonymous.submit(function(t){t.preventDefault(),e.onSubmitAnonymous()}),this.$digestArchive.find("a").on(this.clickEvent,function(){var t=$(this).data("digest");e.$digestContent.removeClass("current"),$(".digest-content[data-digest="+t+"]").addClass("current"),e.setCurrentLink(t)})},e.prototype._onLetterContentClick=function(){this.popup.show()},e.prototype.setCurrentLink=function(){var t=arguments.length<=0||void 0===arguments[0]?this.lastDigestId:arguments[0];this.$digestArchive.find("a").removeClass("current"),$('a[data-digest="'+t+'"]').addClass("current")},e.prototype.fixSidebar=function(){var e,n=this,o=n.$digestInfo.offset().top,r=20,s=$(".bm-layout-header");setInterval(function(){e=i.tools.client.isBreakpointTablet()||i.tools.client.isMobile()?s.height():0,$(t).scrollTop()>o-r-e&&$(t).width()>=1024?(n.$digestInfo.css({position:"fixed",top:"0","margin-top":r+e+"px"}),n.$digestContent.css("margin-left","343px")):$(t).width()>=1024?(n.$digestInfo.css({position:"static","margin-top":"70px"}),n.$digestContent.css("margin-left","0")):(n.$digestInfo.css({position:"static","margin-top":"0"}),n.$digestContent.css("margin-left","0")),!i.tools.client.isBreakpointTablet()&&!i.tools.client.isMobile()&&n.$digestInfo.height()+n.$digestInfo.offset().top>$(".bm-layout-footer").offset().top&&(n.$digestInfo.css({position:"static","margin-top":$(".bm-layout-footer").offset().top-n.$digestInfo.height()-o+s.height()-30+"px"}),n.$digestContent.css("margin-left","0"))},100)},e.prototype.ifUserHasJustRegistered=function(){o.hasItem("newUser")&&i.config.mainConfig.userInfo.email?this.subscribeSuccess():""},e.prototype.subscribeSuccess=function(){this.$subscribeFormHeader.toggleClass("hidden"),this.$subscribeInput.attr("disabled",!0),this.$submitButton.addClass("success"),this.$subscribeForm.find(".error").addClass("hidden"),this.$note.removeClass("hidden")},e.prototype.subscribeError=function(t){this.$subscribeForm.find(".error").text(t).removeClass("hidden")},e.prototype.subscribeOnDigest=function(){var t=this;$.ajax({url:"/a/4/user.json",type:"put",dataType:"json",data:{"user[subscription_news]":!0,"user[service_notifications]":!0}}).done(function(){t.subscribeSuccess()}).fail(function(){t.subscribeError("")})},e.prototype.checkIfAlreadySubscribed=function(){var t=this;$.ajax({url:"/a/4/user.json",type:"put",dataType:"json"}).done(function(e){e.email&&e.subscription_news&&e.service_notifications?t.subscribeError("  "):t.onSubmit()}).fail(function(){t.onSubmit()})},e.prototype.onSubmit=function(){var t=this,e=!i.config.mainConfig.userInfo.password_autogenerated,n=i.config.mainConfig.userInfo.email;if(n)this.subscribeOnDigest();else{var o=new s,r=this.$subscribeInput.val(),u=function(e){if(t.$subscribeForm.find(".error").addClass("hidden"),t.$subscribeForm.data("email")){if(t.$subscribeForm.data("email")==e)return void t.subscribeError("  ")}else t.$subscribeForm.data("email",e);c.popup.show(e)},l=function(e,n){e?u(r):t.subscribeError(n)},c=new a(this.$subscribeInput,{presaveCheck:function(t,e){$.ajax({url:"/a/4/u/check_email.json",method:"post",data:{email:t},success:function(t){e(!t.used," ")}})},popup:{show:function(t){e?o.show({scenario:o.Scenarios.EMAIL_CHANGE,form:{name:"email-change",data:{"user[email]":t}}},t):o.show({scenario:o.Scenarios.EMAIL_CHANGE_NO_PASSWORD,form:{name:"email-change-no-password",data:{"user[email]":t}}},t)}}});c.presaveCheck(r,l)}},e.prototype.onAuthenticationSuccessful=function(){o.setItem("newUser","true")},e.prototype.onSubmitAnonymous=function(){var t=new u,e=this.$subscribeInput.val();t.on("authenticationSuccessful",this.onAuthenticationSuccessful),t.showWindow("login"),$("#bm-login-window-input-login-1").val(e),$("#bm-login-window-input-password-1").focus()},e}();new l})}(this,this.modules,this.DIMixpanel,this.BM,this.docCookies),function(t,e,n,i){e.define("lonelyUsersInit",["extend","baseView","dynamicContent","moduleQuote"],function(e,o,r,s,a){var u=o(r),l=u,c=l.superclass;i.tools.mixin(l.prototype,{initialize:function(e){c.initialize.apply(this,arguments),this._dynamicContent=null,this._timeoutUpdate=null,this._newQuotesQueue=[],this.$elemDynamicContent=this.$elem.find("@bm-dynamic-content"),this.$elemItemsWrapper=this.$elem.find("@bm-lonely-guys-items-wrapper"),this.$elemLoadMore=this.$elem.find("@bm-lonely-guys-load-more"),this.$elemLoadMoreObjectsCount=this.$elem.find("@bm-lonely-guys-load-more-objects-count"),this._timeCorrectingNumber=0,this._fromTimestamp=(new Date).getTime()-1728e5+this._timeCorrectingNumber,this._maxCount=30,t.setTimeCorrectingNumber=function(t){i.tools.isNull(t)&&(this._timeCorrectingNumber=t)},this._initDynamicContent(),this._bindEvents(),this._loadQuotes(),this._initUpdatingTimeout()},_initDynamicContent:function(){this._dynamicContent=new s({element:this.$elemDynamicContent})},_bindEvents:function(){this.$elemLoadMore.on(i.helper.event.clickName(),function(t){this._onLoadMoreClick(t)}.bind(this))},_onLoadMoreClick:function(t){this._renderQuotes(),this._update()},_loadQuotes:function(){this._sendRequestLoadQuotes(function(){setTimeout(function(){this._renderQuotes(),this._dynamicContent.showStep("content")}.bind(this),300)}.bind(this))},_sendRequestLoadQuotes:function(t){var e=this._fromTimestamp;this._fromTimestamp=(new Date).getTime()+this._timeCorrectingNumber,n.ajax({url:"/a/4/m/lonely_users_quotes.json",type:"get",dataType:"json",data:{from:parseInt(e/1e3,10),max_count:this._maxCount},success:function(e){i.tools.isPresent(e)&&i.tools.isArray(e.objects)&&e.objects.forEach(function(t){this._newQuotesQueue.push(t)}.bind(this)),t()}.bind(this)})},_renderQuotes:function(){this._newQuotesQueue.forEach(function(t){var e=new a(i.tools.mixin(t,{openDocumentPopup:!0,components:{bookBlock:!0,likers:!0,lieSimple:!0,link:!0,sharing:!1},listItem:{refetch:!0,uuid:t.document_uuid}}));this.$elemItemsWrapper.prepend(e.getElement())}.bind(this)),this._newQuotesQueue.length=0,this._newQuotesQueue=[]},_initUpdatingTimeout:function(){this._timeoutUpdate=setTimeout(function(){this._loadNewQuotes()}.bind(this),5e3)},_loadNewQuotes:function(){this._sendRequestLoadQuotes(function(){this._update(),this._initUpdatingTimeout()}.bind(this))},_update:function(){this._newQuotesQueue.length>0?(this._newQuotesQueue.length>999?this.$elemLoadMoreObjectsCount.html("999+"):this.$elemLoadMoreObjectsCount.html(this._newQuotesQueue.length),this.$elem.addClass("m-load-more-visible")):this.$elem.removeClass("m-load-more-visible")}}),new u({element:n("@bm-lonely-guys")}),e(u)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n){DIMixpanel=DIMixpanel||{};var i={book:["Adding to Library","Reader Shown","All Subscriptions Popup Shown","Subscription Popup Shown","Subscription Initiated","Subscription Successful"],shelf:["Shelf Selected","Shelf Follow"],user:["Friend Follow"]},o=function(t,e){var n,o=!1,r=Object.keys(i);r.forEach(function(t){var r=i[t];r.indexOf(e)>=0&&(o=!0,n=t)}),n=t.channel?t.channel:n,t.discovered=t.discovered?t.discovered:DIMixpanel.discovered.context.get(n),t.discovered_id=t.discovered_id?t.discovered_id:DIMixpanel.discovered.uuid.get(n),t.discovered="best"===t.discovered?"bestsellers":t.discovered,t.discovered&&"undefined"!==t.discovered&&void 0!==t.discovered&&null!==t.discovered&&"null"!==t.discovered||delete t.discovered,t.discovered_id&&"undefined"!=t.discovered_id&&void 0!=t.discovered_id&&null!==t.discovered_id&&"null"!==t.discovered_id||delete t.discovered_id,o||(delete t.discovered,delete t.discovered_id),!t.discovered&&document.referrer.indexOf("bookmate.com/auth")>0&&(t.discovered="referral")},r=function(){var e,i=t.location.pathname,o=["library","book","quote","gifts"];return o.forEach(function(t){i.indexOf(t)>=0&&(e=t)}),i.indexOf("bookshel")>=0&&(e="shelf"),i.indexOf("lists")>=0&&(e="editors"),"/"===i&&(e="main"),n.user.getLogin()&&n.user.getViewingUserLogin()&&n.user.getLogin()===n.user.getViewingUserLogin()&&(e="my_books"),e},s=function c(){var c,e=t.location.pathname;return e.indexOf("mts_by")>=0&&(c="mts_belarus"),e.indexOf("kievstar")>=0&&(c="kievstar"),e.indexOf("yap2015")>=0&&(c="yasnaya_polyana"),e.indexOf("bigbook")>=0&&(c="bigbook"),e.indexOf("paypal")>=0&&(c="paypal"),e.indexOf("tele2ee")>=0?c="tele2_ee":e.indexOf("tele2")>=0&&(c="tele2"),e.indexOf("azercell")>=0&&(c="azercell"),e.indexOf("megafon")>=0&&(c="megafon_volga"),e.indexOf("beeline")>=0&&(c="beeline_siberia"),e.indexOf("vdnh")>=0&&(c="vdnh"),e.indexOf("bibirevo")>=0&&(c="bibirevo"),e.indexOf("muzeon")>=0&&(c="muzeon"),e.indexOf("discount")>=0&&(c="discount"),e.indexOf("specialios")>=0&&(c="specialios"),e.indexOf("activ")>=0&&(c="kcell"),e.indexOf("cipika")>=0&&(c="cipika"),e.indexOf("t-mobile")>=0&&(c="t-mobile"),c};DIMixpanel.track=function(){var e=function(t,e){return Object.prototype.toString.call(t).slice(8,-1)===e},i=arguments[0],r=arguments[1],s=arguments[2],a=arguments[3],u=e(i,"String")?i:void 0,l=e(r,"Object")?r:{},c=e(s,"Function")?s:a,d=r,h=d?d:{};if(t.localStorage&&"User Landed"===u){var p="bm-mx : "+u+": "+JSON.stringify(l);try{var f=localStorage.getItem(p)}catch(m){}if(f&&Date.now()-f<18e5)return;try{localStorage.setItem(p,Date.now())}catch(m){}}o(h,u),h.subscribed=n.user.getHighestSubscription(),h.context=h.context?h.context:DIMixpanel.context.get(u),DIMixpanel.modifyProps(u,h),mixpanel.track(u,h,c)},DIMixpanel.modifyProps=function(t,e){"User Landed"===t&&(e.page=r(),s()&&(e.special=s())),DIMixpanel.modifySubcriptionProps(t,e),"Gift Page Shown"!==t&&"Gift Purchased"!==t||delete e.context,"Reader Shown"!==t&&"Adding to Library"!==t||delete e.context,"Adding to Library"===t&&(e.auto=e.auto?e.auto:"false")},DIMixpanel.modifySubcriptionProps=function(t,e){var n=["All Subscriptions Popup Shown","Subscription Popup Shown","Subscription Initiated","Subscription Successful","Subscription Failed","Payment Type Selected","Duration Type Selected"];n.indexOf(t)>=0&&(e.context=DIMixpanel.subscriptionContext.get()),"Subscription Successful"===t&&DIMixpanel.subscriptionContext.remove()},DIMixpanel.subscriptionContext=function(){return{set:function(t){docCookies.setItem("-mp-sub-ctx-",t,0,"/")},get:function(){return docCookies.getItem("-mp-sub-ctx-")||"other"},remove:function(){docCookies.removeItem("-mp-sub-ctx-")}}}(),DIMixpanel.context=function(){var e=t.location.href;return{get:function(t){var n="other";return"/"===e&&(n="main"),e.indexOf("/search?query=")>=0&&(n="search"),e.indexOf("/books/")>=0&&(n="book"),e.indexOf("/search?author=")>=0&&(n="author"),e.indexOf("/bookshelves/")>=0&&(n="public_shelf"),n}}}(),DIMixpanel.discovered=function(){var t=function(){return function(t){docCookies.setItem(t.channel+"-discovered-context",t.ctx,0,"/"),docCookies.setItem(t.channel+"-discovered-id",t.uuid,0,"/")}}(),e=function(){return{get:function(t){return docCookies.getItem(t+"-discovered-id")}}}(),n=function(){return{get:function(t){return docCookies.getItem(t+"-discovered-context")}}}(),i=function(t){var i=n.get("book"),o=e.get("book"),r={discovery_type:i,discovery_id:o,discovery_auto:t};return"editors"!==i&&"featured"!==i&&"shelf"!==i&&"feed_shelf"!==i||(r.bookshelf_id=o),r.discovery_id&&"undefined"!=r.discovery_id||delete r.discovery_id,r};return{set:t,uuid:e,context:n,backend_data:i}}();var a=function(){var t={"Logged In":!1};n&&n.user&&n.user.isUserPresent()&&(t["Logged In"]=!0),docCookies.setItem("mixpanel-logged-user-entered-cookie",1,1800,"/"),DIMixpanel.track("User Landed",t)},u=function(){var t=mixpanel.cookie,e=t.props||{},i=n.helper.experiments.getExperiments();for(var o in e)if(e.hasOwnProperty(o)&&0===o.indexOf("[Experiment]")){var r=o.replace("[Experiment] ",""),s=e[o],a=n.helper.experiments.getExperiment(r);a&&a.group===s?i=_.without(i,a):mixpanel.unregister(o)}i.forEach(function(t){mixpanel.register(_defineProperty({},"[Experiment] "+t.experiment,t.group))})},l=function(t){u(),"1"!==docCookies.getItem("mixpanel-logged-user-entered-cookie")&&a()};mixpanel.__loaded?l():t.addEventListener("mixpanel-loaded",l,!1)}(this,this.modules,this.BM=this.BM||{}),function(t,e,n,i){"use strict";e.define("mobileGenericInit",["paymentPopup","popupRecurrentPresent"],function(t,e,o){var r=new e({useTemplate:!0,redirectToAfterSuccess:"/mobile#success",disable:{inplat:!0}}),s=n("@slide-confirmation"),a=s.find("@button-show-popup-payment"),u=new o({useTemplate:!0});a.on("click",function(){r.setStateInitial(),r.show()}),i("popup-recurrent-present-show-request").subscribe(function(){u.show()})})}(this,this.modules,this.jQuery,this.radio),function(t,e){e.define("iwillreadAnalytics",[],function(t){t()})}(this,this.modules),function(t,e){e.define("NYCard",["PubSub","Pluralizer","NYFonts"],function(e,n,i){var o=function(e){function n(t){_classCallCheck(this,n);var o=_possibleConstructorReturn(this,e.call(this,t));return i.setLocale("ru"===BM.user.getLocale()?"ru":"en"),o.setElements(),o}return _inherits(n,e),n.prototype.setElements=function(){this.$card=$("@ny-card")},n.prototype.getCardImage=function(e){var n,o,r,s="ru"===BM.user.getLocale()?"ru":"en",a=i.pluralize(e);switch(a){case"one":o=3;break;case"few":o=1;break;case"many":o=2}return 0===e?(n="ru"===s?this._random(6):this._random(4),r="0_"+n):1===e?(n="ru"===s?this._random(5):this._random(4),r="1_"+n):e>=2&&5>=e?(n="ru"===s?this._random(9):this._random(6),r="2-5_"+n+"."+o):e>=6&&50>=e?(n="ru"===s?this._random(32):this._random(16),r="6-50_"+n+"."+o):e>=51&&100>=e?(n="ru"===s?this._random(23):this._random(19),r="51-100_"+n+"."+o):(n="ru"===s?this._random(6):this._random(13),r="100+_"+n+"."+o),t.location.origin+"/images/iwillread-src/"+s+"/"+r+".png"},n.prototype.render=function(t,e){var n=this,i=document.createElement("canvas"),o=new Image;o.addEventListener("load",function(t){var r=void 0,s=navigator.userAgent.indexOf("Firefox")>-1?250:200,a=t.target,u=i.getContext("2d");switch(i.width=a.width,i.height=a.height,u.drawImage(o,0,0,a.width,a.height,0,0,a.width,a.height),u.textBaseline="top",e.length){case 3:r=80;break;case 2:r=180;break;case 1:r=265}e.forEach(function(t,e){var n=200,i=n*e+r,o=s+(t.font.canvasOffset||t.font.offset);u.font=t.font.size+" "+t.font.family,u.textBaseline="top",u.fillStyle=t.color,u.fillText(""+t.value,i,o,n)});var l=i.toDataURL("image/png"),c=dataURItoBlob(l);n.$card.html('<img class="ny-img" src="'+l+'">'),n._notify("ready",c)}),o.setAttribute("crossOrigin","anonymous"),o.src=this.getCardImage(t)},n.prototype.save=function(t,e){var n=this,i=new XMLHttpRequest,o=new FormData;o.append("number",t),o.append("image",e),i.addEventListener("readystatechange",function(){4==i.readyState&&(200==i.status?n._saveImageSuccess(JSON.parse(i.response)):n._saveImageError())},!1),i.open("POST","/a/4/iwillread.json"),i.send(o)},n.prototype._saveImageSuccess=function(e){this._notify("saved",{imageUrl:t.location.origin+"/"+e.url,promocode:e.promo_code})},n.prototype._saveImageError=function(){},n.prototype._random=function(t){var e=1;return Math.floor(Math.random()*(t-e+1))+e},n}(n);e(o)})}(this,this.modules),function(t,e){e.define("NYColors",[],function(t){var e=["#fcadc5","#a07861","#b1b2b4","#426bec","#90D1AA"];t(e)})}(this,this.modules),function(t,e){e.define("NYFonts",[],function(t){var e=[{family:"arvo",size:"250px",mobileSize:"110px",offset:0,mobileOffset:0},{family:"josefinsans",size:"270px",mobileSize:"120px",offset:0,mobileOffset:0},{family:"museo100",size:"250px",mobileSize:"110px",offset:10,mobileOffset:0},{family:"parisienne",size:"240px",mobileSize:"100px",offset:20,mobileOffset:20},{family:"playfairdisplay",size:"270px",mobileSize:"120px",offset:-35,mobileOffset:-20,canvasOffset:-55}];t(e)})}(this,this.modules),function(t,e,n){e.define("iwillreadInit",["Pluralizer","iwillreadAnalytics","NYInput","NYCard","NYShare"],function(e,i,o,r,s,a){var u=function(){function e(){_classCallCheck(this,e),this.cleanUrl(),this.initPluralizer(),this.initInput(),this.initCard(),this.initShare(),this.setElements(),this.setEventListeners(),this.promised=!1,this.buttonPromiseDisabled=!0,this.width=this.$window.width(),this.height=this.$window.height(),this.handleAppLinksVisibility(),this.handleBlocksVisibility()}return e.prototype.setElements=function(){this.$window=$(t),this.$html=$("html, body"),this.$body=$("body"),this.$postfix=$("@ny-postfix"),this.$input=$("@ny-input"),this.$cursor=$("@ny-cursor"),this.$appLinks=$(".app-link"),this.$blockIntro=$("@ny-block-intro"),this.$blockAbout=$("@ny-block-about"),this.$blockInput=$("@ny-block-input"),this.$blockCard=$("@ny-block-card"),this.$buttonAbout=$("@ny-button-about"),this.$buttonPromise=$("@ny-button-promise"),this.$buttonBack=$("@ny-button-back")},e.prototype.setEventListeners=function(){this.$window.on("resize",_.throttle(this.handleResize.bind(this),200)),this.$window.on("scroll",_.throttle(this.handleScroll.bind(this),150)),this.$buttonAbout.on("click",this.handleClickButtonAbout.bind(this)),this.$buttonPromise.on("click",this.handleClickButtonPromise.bind(this)),this.$buttonBack.on("click",this.handleClickButtonBack.bind(this)),this.$input.on("click",this.handleClickInput.bind(this)),this.nyInput.on("changed",this.handleChangeInput.bind(this)),this.nyCard.on("ready",this.handleReadyCard.bind(this)),this.nyCard.on("saved",this.handleSavedCard.bind(this))},e.prototype.initPluralizer=function(){i.setLocale("ru")},e.prototype.initInput=function(){this.nyInput=new r},e.prototype.initCard=function(){this.nyCard=new s},e.prototype.initShare=function(){this.nyShare=new a},e.prototype.getInputData=function(){var t=this.nyInput.chars,e=parseInt(t.map(function(t){return t.value}).join(""))||0;return{chars:t,number:e}},e.prototype.handleResize=function(){this.width=this.$window.width(),this.height=this.$window.height(),this.handleBlocksVisibility()},e.prototype.handleScroll=function(){this.$window.scrollTop()>=this.height/2?this.$body.addClass("scroll"):this.$body.removeClass("scroll")},e.prototype.handleClickButtonAbout=function(){this.$html.animate({scrollTop:this.height},400,"easeInOutQuad")},e.prototype.handleClickButtonPromise=function(){this.buttonPromiseDisabled||(this.buttonPromiseDisabled=!0,this.$buttonPromise.addClass("m-wait"),this.renderCard())},e.prototype.handleClickButtonBack=function(){this.promised=!1,this.$body.removeClass("promised"),this.handleBlocksVisibility(!0)},e.prototype.handleClickInput=function(){this.$cursor.hide(),this.nyInput.focusEnd(),n.tools.client.isBreakpointTablet()&&this.$html.animate({scrollTop:this.$input.offset().top},10)},e.prototype.handleChangeInput=function(){var t=this.getInputData();this.$postfix.html(this.$postfix.data(i.pluralize(t.number))),t.chars.length?(this.buttonPromiseDisabled=!1,this.$buttonPromise.removeClass("m-disabled")):(this.buttonPromiseDisabled=!0,this.$buttonPromise.addClass("m-disabled"))},e.prototype.renderCard=function(){var t=this.getInputData();this.nyCard.render(t.number,t.chars)},e.prototype.handleReadyCard=function(t){var e=this.getInputData();this.nyCard.save(e.number,t)},e.prototype.handleSavedCard=function(t){var e=t.imageUrl,i=t.promocode;this.nyShare.setParams({imageUrl:e,promocode:i}),this.promised=!0,this.buttonPromiseDisabled=!1,this.$body.addClass("promised"),this.$buttonPromise.removeClass("m-wait"),this.handleBlocksVisibility(!0),n.tools.client.isBreakpointTablet()&&this.$html.animate({scrollTop:0},10)},e.prototype.handleBlocksVisibility=function(){var t=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],e=t?250:0;this.promised?(n.tools.client.isBreakpointTablet()?(this.hideBlock(this.$blockIntro,e),this.showBlock(this.$blockAbout,e)):(this.showBlock(this.$blockIntro,e),this.showBlock(this.$blockAbout,e)),this.hideBlock(this.$blockInput,e),this.showBlock(this.$blockCard,e)):(n.tools.client.isBreakpointTablet()?(this.hideBlock(this.$blockAbout,e),this.showBlock(this.$blockIntro,e)):(this.showBlock(this.$blockIntro,e),this.showBlock(this.$blockAbout,e)),this.hideBlock(this.$blockCard,e),this.showBlock(this.$blockInput,e))},e.prototype.showBlock=function(t,e){this.isShown(t)||(this[t.selector+"shown"]=!0,t.velocity({opacity:1},{display:"flex",duration:e}))},e.prototype.hideBlock=function(t,e){this.isHidden(t)||(this[t.selector+"shown"]=!1,t.velocity({opacity:0},{display:"none",duration:e}))},e.prototype.handleAppLinksVisibility=function(){n.tools.client.isiOS()&&this.$appLinks.not(".ios").hide(),n.tools.client.isAndroid()&&this.$appLinks.not(".google").hide(),n.tools.client.isWindowsPhone()&&this.$appLinks.not(".wp").hide()},e.prototype.cleanUrl=function(){t.history&&t.history.pushState("",document.title,t.location.pathname)},e.prototype.isShown=function(t){return this[t.selector+"shown"]},e.prototype.isHidden=function(t){return"boolean"==typeof this[t.selector+"shown"]?!this[t.selector+"shown"]:!1},e}();new u})}(this,this.modules,this.BM),function(t,e,n){e.define("NYInput",["PubSub","NYFonts","NYColors"],function(e,i,o,r){var s=function(e){function i(t){_classCallCheck(this,i);var o=_possibleConstructorReturn(this,e.call(this,t));return o.maxStyleCount=5,o.maxInputLength=3,o.fonts=[],o.colors=[],o.chars=[],o.setElements(),o.setEventListeners(),n.tools.client.isBreakpointTablet()||n.tools.client.isMobile()||(o.$cursor.hide(),o.focusEnd()),o}return _inherits(i,e),i.prototype.setElements=function(){this.$cursor=$("@ny-cursor"),this.$input=$("@ny-input")},i.prototype.setEventListeners=function(){var t=this;this.$input.on("input",function(e){return t.handleInput(e)})},i.prototype.getRandomFont=function(){return this.getRandomStyle(this.fonts)},i.prototype.getRandomColor=function(){return this.getRandomStyle(this.colors)},i.prototype.getRandomStyle=function(t){for(var e=Math.floor(Math.random()*this.maxStyleCount);t.indexOf(e)>-1;)e=Math.floor(Math.random()*this.maxStyleCount);return e},i.prototype.handleInput=function(e){var i=this,s=parseInt(this.$input.text()),a=(""+(n.tools.isNumber(s)&&!t.isNaN(s)?s:"")).slice(0,this.maxInputLength)||"";this.chars=[],this.fonts=this.fonts.slice(0,a.length),this.colors=this.colors.slice(0,a.length),[].concat(_toConsumableArray(a)).forEach(function(t,e){var s=n.tools.isNumber(i.fonts[e])?i.fonts[e]:i.fonts[e]=i.getRandomFont(),a=n.tools.isNumber(i.colors[e])?i.colors[e]:i.colors[e]=i.getRandomColor();i.chars.push({value:t,font:o[s],color:r[a]})}),this._notify("changed"),this.render(),this.focusEnd()},i.prototype.focusEnd=function(){this.$input.focus();var e=$("<span>").appendTo(this.$input),n=e.get(0),i=null,o=null;document.selection?(i=document.body.createTextRange(),i.moveToElementText(n),i.select()):t.getSelection&&(i=document.createRange(),i.selectNode(n),o=t.getSelection(),o.removeAllRanges(),o.addRange(i)),e.remove()},i.prototype.render=function(){var t=[];this.chars.forEach(function(e){var i=n.tools.client.isBreakpointTablet()?e.font.mobileSize:e.font.size,o=n.tools.client.isBreakpointTablet()?e.font.mobileOffset:e.font.offset;t.push('<span class="ny-char" style="font-family: '+e.font.family+"; font-size: "+i+"; margin-top: "+o+"px; color: "+e.color+'">'+e.value+"</span>")}),this.$input.html(t.join(""))},i}(i);e(s)})}(this,this.modules,this.BM),function(t,e,n){e.define("NYShare",["PubSub","ButtonSocialShare"],function(e,i,o){var r=function(e){function i(t){_classCallCheck(this,i);var n=_possibleConstructorReturn(this,e.call(this,t));return n.promocode=null,n.imageUrl=null,n.shareType=null,n.buttonsDisabled=!1,n.setElements(),n.setEventListeners(),n}return _inherits(i,e),i.prototype.setElements=function(){this.$buttonsShare=$("@ny-button-share")},i.prototype.setEventListeners=function(){this.$buttonsShare.on("click",this.handleClickButtonShare.bind(this))},i.prototype.setParams=function(t){var e=t.imageUrl,n=t.promocode;this.imageUrl=e,this.promocode=n},i.prototype.handleClickButtonShare=function(t){this.buttonsDisabled||(this.buttonsDisabled=!0,this.$buttonShare=$(t.currentTarget),this.shareType=this.$buttonShare.data("type"),this.$buttonShare.addClass("m-wait"),this.share())},i.prototype.share=function(){switch(this.shareType){case"fb":this._shareFB();break;case"vk":this._shareVK();break;case"tw":this._shareTW()}this.$buttonShare.removeClass("m-wait"),this.buttonsDisabled=!1,this._sendMixpanelEvent()},i.prototype.redirect=function(){t.location="/code?promo="+this.promocode},i.prototype._shareFB=function(){var e=this;if(t.FB){var n=this._getSharingParams();t.FB.ui({method:"share",href:n.url,display:"popup"},function(t){return t&&!t.error_code?void e.redirect():void console.log("Error while posting to facebook:",t)})}},i.prototype._shareVK=function(){var e=this,n=this._getSharingParams(),i="https://vkontakte.ru/share.php?"+$.param({title:n.title,description:n.description,image:n.image,url:n.url}),o=t.open(i,"","toolbar=0,status=0,width=626,height=436"),r=t.setInterval(function(){o.closed&&(t.clearInterval(r),e.redirect())},200)},i.prototype._shareTW=function(){var e=this;if(t.twttr)var n=this._getSharingParams(),i="https://twitter.com/share?"+$.param({text:n.description.split("")[0],url:n.url}),o=t.open(i,"","toolbar=0,status=0,width=626,height=436"),r=t.setInterval(function(){o.closed&&(t.clearInterval(r),
e.redirect())},200)},i.prototype._getSharingParams=function(){var e="ru"===n.user.getLocale()?"ru":"en",i=this.imageUrl.split("/").pop();return{url:t.location.href+"?lang="+e+"&img="+i,title:$('meta[property="og:title"]').attr("content"),description:$('meta[property="og:description"]').attr("content"),image:this.imageUrl}},i.prototype._sendMixpanelEvent=function(){DIMixpanel.track("Share Button Pressed",{entity:"iwillread",source:this.shareType})},i}(i);e(r)})}(this,this.modules,this.BM),function(t,e){e.define("partnerPsychoAnalytics",[],function(e){t.DIMixpanel&&t.DIMixpanel.track("Almost Ready Page Shown"),e()})}(this,this.modules),function(t,e,n,i){e.define("partnerPsychoFormVisa",["paymentPopup/visa"],function(e){var o=n.custom.popupPaymentFormVisa;n.widget("custom.partnerPsychoFormVisa",o,{_sendRequestSubscribe:function(){this._setFormWait(!0),this._sendGAEventPaymentButtonPress();var t=this;n.ajax({type:"post",url:"/payments/braintree",data:this._getPostData(),dataType:"json",success:function(e){t._onSubscribeSuccess(e)},error:function(e){t._handleSubscribeError(e.responseJSON)}})},_onSubscribeSuccess:function(){n.ajax({type:"post",url:"payments/promo/use_v2",dataType:"json",success:function(){i&&i.track("Subscription Successful",{method:"code",payment_type:"code",type:"month",context:""}),setTimeout(function(){t.location.href="/lists/kGZ6kq3z"},150)},error:function(){this._setFormWait(!1)}})}}),e()})}(this,this.modules,this.jQuery,this.DIMixpanel),function(t,e,n){e.define("psychologiesInit",["partnerPsychoLayout","partnerPsychoSlideFirst","partnerPsychoSlideSecond","partnerPsychoAnalytics","partnerPsychoFormVisa"],function(e,i,o,r,s){$(t),$(t.document.body);n("partner-psycho-slide-second-request").subscribe(function(){$.scrollTo(r.getElement(),500)})})}(this,this.modules,this.radio),function(t,e){var n=function(e){var n=$(t),i=$(t.document.body),o=($(".bm-layout-psycho"),$(".bm-layout-header")),r=$(".bm-layout-footer"),s=$(".bm-layout-psycho-slide@partner-psycho-slide-first"),a=$(".bm-layout-psycho-slide@partner-psycho-slide-second"),u="partner-psycho-"+(new Date).getTime(),l=1.5,c=function(){var t=n.height(),e=o.height(),i=r.height(),u=t-e,l=t-i-56;s.height(u),s.css("line-height",u+"px"),a.css("min-height",l+"px")},d=function(){var t=s.width(),e=s.height();t/e>=l?s.removeAttr("data-bg-pos"):s.attr("data-bg-pos","ver")},h=function(){i.addClass("visible")},p=function(){n.on("resize."+u,function(){c(),d()})};$(function(){p(),c(),d(),h()}),e()};e.define("partnerPsychoLayout",[],n)}(this,this.modules),function(t,e,n){e.define("partnerPsychoSlideFirst",[],function(e){var i=($(t),$("@partner-psycho-slide-first")),o=i.find("@slide-content"),r=function(){o.on("click",s)},s=function(){n("partner-psycho-slide-second-request").broadcast()};r(),e()})}(this,this.modules,this.radio),function(t,e,n){e.define("partnerPsychoSlideSecond",["partnerPsychoFormVisa"],function(t,e){var n=$("@partner-psycho-slide-second"),i=$("@partner-psycho-form-visa"),o=function(){return n};i.partnerPsychoFormVisa();var r=i.data("custom-partnerPsychoFormVisa");r.setCurrentPlan("psychologies"),r.setAuthToken($("[name=authenticity_token]").val()),t({getElement:o})})}(this,this.modules,this.radio),function(t,e,n,i,o){"use strict";e.define("newUserLandingInit",["formSendLink","blockSocialConnect","blockCollectEmail","blockAboutSubscription","blockStoreLinks"],function(e,r,s,a,u,l){var c=n("@button-read-reader-open"),d=n("@is-econtenta-suggestion"),h=n("@form-send-link"),p=n("@block-social-connect"),f=n("@block-about-subscription"),m=n("@block-store-links"),g=function(e){var i=n(this);e.preventDefault(),e.stopPropagation(),o&&(o.setItem("bm-new-user-landing-recommended-book-click",JSON.stringify({isEcontenta:d.val()}),3e5,"/"),t.open(i.attr("href"),"Bookmate Embedded Reader","toolbar=no,location=0,status=no,titlebar=no,menubar=no,width="+t.screen.width+",height="+t.screen.height))};h.length>0&&r(h),p.length>0&&s.init(p),f.length>0&&u.init(f),m.length>0&&l.init(m),c.on("click",g),o.getItem("mx_econtenta_test")||(o.setItem("mx_econtenta_test",d.val(),6e5,"/"),i.track("New User Landing Shown",{recommendations:"true"===d.val()?"econtenta":"featured"}))})}(this,this.modules,this.jQuery,this.DIMixpanel,this.docCookies),function(t,e){e.define("paywallAnalytics",[],function(e){t.DIMixpanel&&t.DIMixpanel.track("Almost Ready Page Shown"),e()})}(this,this.modules),function(t,e,n,i,o){e.define("paywallFormVisa",["loginWindow","paymentPopup/visa"],function(e,r){var s=n.custom.popupPaymentFormVisa,a=new r({preventDefaultLoginBehavior:!0});n.widget("custom.paywallFormVisa",s,{_sendRequestSubscribe:function(){var e=this;this._setFormWait(!0),this._sendGAEventPaymentButtonPress(),this._getPostDataWithNonce({success:function(r){n.ajax({type:"post",url:"/payments/braintree",data:r,dataType:"json",success:function(e){var n,r,s=o.helper.link.library();e&&(e.plan&&(r=-1!==e.plan.indexOf("premium")?"premium":"default"),o.tools.isNumber(e.trial_duration)&&(n=Math.round(e.trial_duration/30))),n&&r&&(s=o.helper.link.appendParam(s,{duration:n,kind:r,paid_promo_activated:!0}),docCookies.setItem("paid_promo_activated",!0,86400,"/")),i&&i.track("Subscription Successful",{method:"code",payment_type:"code",type:"month",context:""}),setTimeout(function(){t.location.href=s},150)},error:function(t){e._handleSubscribeError(t.responseJSON),e._setFormWait(!1)}})},error:function(){e._handleSubscribeError(""),e.element.trigger("subscription_failed","")}})},_onSubscribeSuccess:function(){},_onFormSubmit:function(){o.user.isUserPresent()?this.__onFormSubmit():(a.showWindow(),a.on("authenticationSuccessful",function(){a.closeWindow({silent:!0}),this.__onFormSubmit()}.bind(this)))},__onFormSubmit:function(){this._clearFormErrors(),this._validateForm()?this._sendRequestSubscribe():this._displayFormErrors()},setFormWait:function(t){this._setFormWait(t)}}),e()})}(this,this.modules,this.jQuery,this.DIMixpanel,this.BM),function(t,e,n){e.define("paywallInit",["paywallLayout","paywallSlideFirst","paywallSlideSecond","paywallAnalytics"],function(e,i,o,r,s){var a=($(t),$(t.document.body),$(".bm-layout"));n("paywall-slide-second-request").subscribe(function(){a.scrollTo(r.getElement(),500)})})}(this,this.modules,this.radio),function(t,e){var n=function(e){var n=$(t),i=$(t.document.body),o=($(".bm-layout-paywall"),$(".bm-layout-header")),r=$(".bm-layout-footer"),s=$(".bm-layout-paywall-slide@paywall-slide-first"),a=$(".bm-layout-paywall-slide@paywall-slide-second"),u=i.find(".layout-window-fullscreen"),l=i.find(".link-qa"),c=i.find(".fullscreen-button-close"),d="paywall-"+(new Date).getTime(),h=1.5,p=function(){var t=n.height(),e=o.height(),i=r.height(),u=t-e,l=t-i-56;s.height(u),s.css("line-height",u+"px"),a.css("min-height",l+"px")},f=function(){var t=s.width(),e=s.height();t/e>=h?s.removeAttr("data-bg-pos"):s.attr("data-bg-pos","ver")},m=function(){i.addClass("visible")},g=function(){u.addClass("active")},b=function(){u.removeClass("active")},_=function(){n.on("resize."+d,function(){p(),f()}),l.on("click",function(t){t.stopPropagation(),g()}),c.on("click",function(t){t.stopPropagation(),b()})};$(function(){_(),p(),f(),m()}),e()};e.define("paywallLayout",[],n)}(this,this.modules),function(t,e,n){e.define("paywallSlideFirst",[],function(e){var i=($(t),$("@paywall-slide-first")),o=i.find("@slide-content"),r=function(){o.on("click",s)},s=function(){n("paywall-slide-second-request").broadcast()};r(),e()})}(this,this.modules,this.radio),function(t,e,n,i){n.define("paywallSlideSecond",["paywallFormVisa"],function(t,n){var o=$("@paywall-slide-second"),r=$("@paywall-form-visa"),s=$("@bm-page-paywall-text-about-subscription"),a=function(){return o},u=function(){return $("body").hasClass("plan-premium")};r.paywallFormVisa();var l=r.data("custom-paywallFormVisa");l.setFormWait(!0),l.setAuthToken($("[name=authenticity_token]").val()),i.helper.subscription.on("prices-fetched",function(t){var n=e.findWhere(t,{payment_system:"visa"}),i=n?n.levels:[],o=e.findWhere(i,{kind:u()?"premium":"default"}),r=o?o.products:[],s=e.findWhere(r,{duration:"month"});s&&(console.log(s.product_id),l.setCurrentPlan(s.product_id),l.setFormWait(!1))}),i.helper.subscription.fetchPrices(function(){s.find("@price").html(i.helper.subscription.getPrice(u()?"premium":"default","month"))}),t({getElement:a})})}(this,this._,this.modules,this.BM),function(t,e,n,i){"use strict";n.define("promoCodeAnalytics",[],function(t){var e={trackSubscriptionSuccess:function(){i.track("Subscription Successful",{method:"code",payment_type:"code",type:"month"})},trackSubscriptionError:function(t){i.track("Subscription Failed",{method:"code",payment_type:"code",type:"month",reason:t})},trackPageShown:function(){i.track("Promocode Page Shown")}};t(e)})}(this,this.jQuery,this.modules,this.DIMixpanel),function(t,e,n,i){"use strict";n.define("giftCardActivation",["loginWindow","promoCodeAnalytics"],function(n,o,r){var s=function(){function n(){_classCallCheck(this,n),this.userExist=!1,this.submitAvailable=!0,this._initElements(),this._initLoginWindow(),this._setEventListeners(),this._handleUrlPromo()}return n.prototype._setEventListeners=function(){var t=this;this.$form.on("submit",function(e){return t.submitForm(e)}),this.$activateButton.on("click",function(e){return t.activateGiftCard()})},n.prototype._initElements=function(){this.$layout=e("@promocode-layout"),this.$token=e("[name=authenticity_token]"),this.$form=e("@promocode-form"),this.$formInputCode=e("@promocode-code"),this.$formErrorEmpty=e("@promocode-error-empty"),this.$formErrorServer=e("@promocode-error-server"),this.$activateButton=e("@activate-subscription"),this.$date=e("@promocode-date"),this.$type=e("@promocode-subscription-type")},n.prototype._initLoginWindow=function(){i.user.isUserPresent()?this.userExist=!0:this.loginWindow=new o({context:"promo_code",preventDefaultLoginBehavior:!0})},n.prototype._handleUrlPromo=function(){this._isUrlContainPromo()&&(this.urlPromo=t.location.search.split("promo=")[1].split("&")[0],this.$formInputCode.val(this.urlPromo),this.submitForm())},n.prototype._isUrlContainPromo=function(){return t.location.search.indexOf("promo=")>0},n.prototype._handleForm=function(e){var n=this;return e&&e.preventDefault(),this.isSubmitAvailable()?this.getCode().length?this.userExist?!0:(this.loginWindow.showWindow(this.isUrlPromo()?"promocode":"inital"),void this.loginWindow.on("authenticationSuccessful",function(){return n._isUrlContainPromo()?void t.location.reload():(n.loginWindow.closeWindow(),n.userExist=!0,void n.submitForm())})):void this._showError():void 0},n.prototype._showError=function(t){this._hideError(),t?this.$formErrorServer.html(t).addClass("visible"):this.$formErrorEmpty.addClass("visible")},n.prototype._hideError=function(){this.$formErrorServer.removeClass("visible"),this.$formErrorEmpty.removeClass("visible")},n.prototype._onActivationSuccess=function(n){if(this.submitAvailable=!0,n&&"redirect"===n.action)return void(t.location.href=n.link);var i=t.location.href.replace(t.location.search,"");t.history.pushState({},"",i+"?success"),this.$layout.addClass("success"),e("body").addClass("gift-card-success"),this.$date.html(n.expires_at_date),this.$type.html(this.$type.data("text-"+(n.kind||"default"))),r.trackSubscriptionSuccess(),docCookies.setItem("activated_promo_code_till_date",n.expires_at_date,15e3,"/")},n.prototype._onActivationError=function(e){this.submitAvailable=!0;var n=e.responseJSON;if(r.trackSubscriptionError(n.error),n&&n.action&&"need-braintree-subscription"===n.action&&"undefined"!==n.link){var i=t.location.search?t.location.href=""+n.link+t.location.search+"?duration="+n.duration:t.location.href=n.link+"?duration="+n.duration;return void(t.location.href=i)}n.error&&this._showError(n.error.message)},n.prototype._getToken=function(){return this.$token.val()},n.prototype.getCode=function(){return e(".bm-page-promocode").data("code")},n.prototype.submitForm=function(t){var n=this;this._handleForm(t)&&(this.submitAvailable=!1,e.ajax({type:"post",url:"/a/4/billing/promos/"+this.getCode()+"/activation",dataType:"json",data:{authenticity_token:this._getToken(),promo_id:this.getCode()},success:function(t){return n._onActivationSuccess(t)},error:function(t){return n._onActivationError(t)}}))},n.prototype._activationPossible=function(){var t=this;return this.userExist?!0:(this.loginWindow.showWindow("inital"),void this.loginWindow.on("authenticationSuccessful",function(){t.loginWindow.closeWindow(),t.userExist=!0,t.activateGiftCard()}))},n.prototype.activateGiftCard=function(){var t=this;this._activationPossible()&&e.ajax({type:"post",url:"/a/4/billing/promos/"+this.getCode()+"/activation",dataType:"json",data:{authenticity_token:this._getToken(),promo_id:this.getCode()},success:function(e){return t._onActivationSuccess(e)},error:function(e){return t._onActivationError(e)}})},n.prototype.isSubmitAvailable=function(){return this.submitAvailable},n.prototype.isUrlPromo=function(){return this.urlPromo},n}();n(s)})}(this,this.jQuery,this.modules,this.BM),function(t,e){"use strict";t.define("promoCodeInit",["PromoCode","promoCodeAnalytics","giftCardActivation"],function(t,n,i,o){if(e.helper.url.param("gift")){new o}else{new n}i.trackPageShown(),t()})}(this.modules,this.BM),function(t,e,n,i){"use strict";n.define("PromoCode",["loginWindow","promoCodeAnalytics"],function(n,o,r){var s=function(){function n(){_classCallCheck(this,n),this.userExist=!1,this.submitAvailable=!0,this._initElements(),this._initLoginWindow(),this._setEventListeners(),this._handleUrlPromo()}return n.prototype._setEventListeners=function(){var t=this;this.$form.on("submit",function(e){return t.submitForm(e)})},n.prototype._initElements=function(){this.$layout=e("@promocode-layout"),this.$token=e("[name=authenticity_token]"),this.$form=e("@promocode-form"),this.$formInputCode=e("@promocode-code"),this.$formErrorEmpty=e("@promocode-error-empty"),this.$formErrorServer=e("@promocode-error-server"),this.$date=e("@promocode-date"),this.$type=e("@promocode-subscription-type")},n.prototype._initLoginWindow=function(){i.user.isUserPresent()?this.userExist=!0:this.loginWindow=new o({context:"promo_code",preventDefaultLoginBehavior:!0})},n.prototype._handleUrlPromo=function(){this._isUrlContainPromo()&&(this.urlPromo=t.location.search.split("promo=")[1].split("&")[0],this.$formInputCode.val(this.urlPromo),this.submitForm())},n.prototype._isUrlContainPromo=function(){return t.location.search.indexOf("promo=")>0},n.prototype._handleForm=function(e){var n=this;return e&&e.preventDefault(),this.isSubmitAvailable()?this.getCode().length?this.userExist?!0:(this.loginWindow.showWindow(this.isUrlPromo()?"promocode":"inital"),void this.loginWindow.on("authenticationSuccessful",function(){return n._isUrlContainPromo()?void t.location.reload():(n.loginWindow.closeWindow(),n.userExist=!0,void n.submitForm())})):void this._showError():void 0},n.prototype._showError=function(t){this._hideError(),t?this.$formErrorServer.html(t).addClass("visible"):this.$formErrorEmpty.addClass("visible")},n.prototype._hideError=function(){this.$formErrorServer.removeClass("visible"),this.$formErrorEmpty.removeClass("visible")},n.prototype._onActivationSuccess=function(e){if(this.submitAvailable=!0,e&&"redirect"===e.action)return void(t.location.href=e.link);var n=t.location.href.replace(t.location.search,"");t.history.pushState({},"",n+"?success"),this.$layout.addClass("success"),this.$date.html(e.expires_at_date),this.$type.html(this.$type.data("text-"+(e.kind||"default"))),r.trackSubscriptionSuccess(),docCookies.setItem("activated_promo_code_till_date",e.expires_at_date,15e3,"/")},n.prototype._onActivationError=function(e){this.submitAvailable=!0;var n=e.responseJSON;if(r.trackSubscriptionError(n.error),n&&n.action&&"need-braintree-subscription"===n.action&&"undefined"!==n.link){var i=t.location.search?t.location.href=""+n.link+t.location.search+"?duration="+n.duration:t.location.href=n.link+"?duration="+n.duration;return void(t.location.href=i)}n.error&&this._showError(n.error.message)},n.prototype._getToken=function(){return this.$token.val()},n.prototype.getCode=function(){return this.$formInputCode.val().trim()},n.prototype.submitForm=function(t){var n=this;this._handleForm(t)&&(this.submitAvailable=!1,e.ajax({type:"post",url:"/a/4/billing/promos/"+this.getCode()+"/activation",dataType:"json",data:{authenticity_token:this._getToken(),promo_id:this.getCode()},success:function(t){return n._onActivationSuccess(t)},error:function(t){return n._onActivationError(t)}}))},n.prototype.isSubmitAvailable=function(){return this.submitAvailable},n.prototype.isUrlPromo=function(){return this.urlPromo},n}();n(s)})}(this,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(o,r,s,a){var u=null,l=null;n(e.body);t.Bookmate=t.Bookmate||{},t.Bookmate.popups=t.Bookmate.popups||{},t.Bookmate.popups.Class=t.Bookmate.popups.Class||{},t.Bookmate.popups.Class.PreviewFinish=s,t.Bookmate.popups.Class.ContentProblem=a;var c=function(){t.Bookmate.Components={},i("components:ready").broadcast()};n.extend(t.Bookmate.popups,{Event:{ADD_TO_LIB_CLICK:"popup_button_read_later_click",SUBSCRIBE_CLICK:"popup_button_subscribe_click",CLOSE:"popup_button_close_click"},lastEvent:null,allowOpenSubscriptionOnReload:!1,redirectType:{NEW_WINDOW:0,SELF:1},currentRedirectType:0,redirectLink:{SUBSCRIPTION:"/subscription",LIBRARY:"/"},currentRedirectLink:"/subscription",forceRedirect:!1});var d=new r({isClosable:!1}),h=function(){return l===!1?!1:null===USER},p=function(t){Bookmate.App.model.addToLibrary().then(function(){d.closeWindow()})},f=function(){t.location.href="/"},m=function(){Bookmate.popups.Instance.PreviewFinish.hide(),Bookmate.popups.Instance.BookFinish.hide(),Bookmate.popups.Instance.BookAddedToLibrary.hide()},g=function(t){u=t,h()?(d.showWindow(),m()):p(u)},b=function(t){u=t,h()&&(d.showWindow(),m())},_=function(){f()},y=function(){m(),t.close()},v=function(){l=!1,"POPUP_ADD_TO_LIB_CLICK"===t.Bookmate.popups.lastEvent?localStorage.setItem("showPopup","BookAddedToLibrary"):"POPUP_SUBSCRIBE_CLICK"===t.Bookmate.popups.lastEvent?localStorage.setItem("showPopup","Subscription"):localStorage.setItem("showPopup",null),d.preventDefaultLoginBehavior!==!0&&t.location.reload()},w=function(){DIMixpanel.track("Please Register Screen Shown")},k=function(){i("POPUP_ADD_TO_LIB_CLICK").subscribe(function(t){Bookmate.popups.previousEvent=Bookmate.popups.lastEvent,Bookmate.popups.lastEvent="POPUP_ADD_TO_LIB_CLICK",g(t)}),i("POPUP_SUBSCRIBE_CLICK").subscribe(function(t){Bookmate.popups.previousEvent=Bookmate.popups.lastEvent,Bookmate.popups.lastEvent="POPUP_SUBSCRIBE_CLICK",b(t)}),i("GO_TO_LIBRARY").subscribe(function(){Bookmate.popups.previousEvent=Bookmate.popups.lastEvent,Bookmate.popups.lastEvent="GO_TO_LIBRARY",_()}),i("POPUP_CLOSE").subscribe(function(){Bookmate.popups.previousEvent=Bookmate.popups.lastEvent,Bookmate.popups.lastEvent="POPUP_CLOSE",y()}),i("reader-authorization-request").subscribe(function(e){Bookmate.popups.previousEvent=Bookmate.popups.lastEvent,t.Bookmate.popups.lastEvent="reader-authorization-request",d.showWindow("inital",e.context)}),i("bookmate-popup-register-show").subscribe(function(){w()})},C=function(){d.on("authenticationSuccessful",v)};k(),C(),c()};o.define("moduleReaderInit",["loginWindow","PopupPaywall","PopupContentProblem"],r)}(this,this.document,this.jQuery,this.radio,this.modules),function(t,e,n,i,o,r){"use strict";var s=function(t,e){var o=n(".bookmate-popup-auth-overlay"),s=n("<div>"),a=n("#authpopup-reader-addon").html(),u=r.to_html(a),l=function(){return e.showForm("inital"),!1},c=function(){s.append(u),e.mainNode.append(s),e.mainNode.addClass("m-with-reader-addon"),e.preventDefaultLoginBehavior=!1,e.showWindow(),o.off(),o.on("click",l),i("bookmate-popup-show").broadcast(),i("bookmate-popup-register-show").broadcast()},d=function(){c()};i("reader-authorization-request-in-progress").subscribe(d),t()};o.define("loginWindowWithNotice",["loginWindow"],s)}(this,this.document,this.jQuery,this.radio,this.modules,this.Mustache),function(t,e,n,i){"use strict";e.define("referralInit",[],function(e){var o=function(){function e(){_classCallCheck(this,e),this.initElements();var n="desktop";this.isAndroid()&&(n="android"),this.isIOS()&&(n="ios"),t.DIMixpanel.track("Referral Redirect Page Loaded",{context:n}),this.isAndroid()||this.isIOS()?this.redirect():this.showMessage()}return e.prototype.initElements=function(){this.$referral=n("@referral"),this.$referralMessage=this.$referral.find("@referral-message"),this.$referralMessageDesktop=this.$referral.find("@referral-message-desktop"),this.$referralMessageBadMobile=this.$referral.find("@referral-message-bad-mobile"),this.$referralMessageAndroid=this.$referral.find("@referral-message-android"),this.$referralButtonAndroid=this.$referral.find("@referral-button-android")},e.prototype.showMessage=function(){this.$referralMessage.show(),this.isDesktop()&&this.$referralMessageDesktop.show(),this.isMobile()&&this.$referralMessageBadMobile.show()},e.prototype.redirect=function(){if(this.isAndroid()){var e=i.features.browser.isChrome()?"https://play.google.com/store/apps/details?id=com.bookmate&referrer=rf%3A"+this.getRefId():"market://details?id=com.bookmate&referrer=rf%3A"+this.getRefId();this.$referralButtonAndroid.attr("href",e),this.$referralMessageAndroid.show()}this.isIOS()&&i.helper.deeplink.sendFingerprint("bookmate://referral?inviter_login="+this.getRefId(),function(){t.location="https://app.adjust.com/sjljfb?campaign=referral_invite"})},e.prototype.getRefId=function(){return t.location.pathname.split("/").slice(-1)[0]},e.prototype.isAndroid=function(){return this.$referral.data("android")},e.prototype.isIOS=function(){return this.$referral.data("ios")},e.prototype.isDesktop=function(){return!this.isMobile()},e.prototype.isMobile=function(){return i.tools.client.isMobile()},e.prototype.isOldAndroid=function(){return i.tools.client.isAndroid()&&i.tools.client.getAndroidVersion()<4.1},e}();new o;e()})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){"use strict";var o=function(t){var n=e(".bm-preload-for-wifi");e(".mobileapp-site"),n.data("ctx");e(".mobileapp-site-app-link").on("click",function(){var t=e(this).data("app");i.track("Install App Button Pressed",{app:t})})};t.define("preloadForWifiInit",[],o)}(this.modules,this.jQuery,this.docCookies,this.DIMixpanel),function(t,e){e.define("initSignupPage",["loginWindow"],function(e,n){var i=$(t),o=$(".bm-page-signup"),r=$(".bookmate-popup-auth-overlay"),s=null,a=new n({isClosable:!1}),u=t.location.search,l=u.indexOf("password_change=true")>-1;-1!==t.location.search.indexOf("utm_source=ulmart")?o.addClass("m-theme-ulmart"):(r.off(),a.showWindow(l?"newpass":"inital"));var c=function(){i.width()/i.height()>=1.5?o.removeClass("m-background-vertical"):o.addClass("m-background-vertical")};i.on("resize",function(){s&&(clearTimeout(s),s=null),s=setTimeout(c,300)}),c(),e()})}(this,this.modules),function(t,e,n,i){e.define("SpecialiosFormVisa",["PubSub","extend","paymentPopup/visa"],function(t,e,o){var r=n.custom.popupPaymentFormVisa;n.widget("custom.formPaymentVisaHandler",r,{_sendRequestSubscribe:function(){var t=this;this._setFormWait(!0),this._getPostDataWithNonce({success:function(e){n.ajax({type:"post",url:"/payments/braintree",data:e,dataType:"json",success:function(e){t._onSubscribeSuccess(e),t.element.trigger("subscription_success")},error:function(e){t._handleSubscribeError(e.responseJSON),t.element.trigger("subscription_failed",e.responseJSON)}})},error:function(){t._handleSubscribeError(""),t.element.trigger("subscription_failed","")}})},_onSubscribeSuccess:function(t){this.element.trigger("subscription-success",t)},_onSubscribeError:function(t){this.element.trigger("subscription-error",t)},_onButtonSubmitClick:function(){this._onFormSubmit(),this.element.trigger("subscription-init")},getElement:function(){return this.element}});var s=o(e),a=s,u=a.superclass;i.tools.mixin(a.prototype,{initialize:function(t){u.initialize.apply(this,arguments),t&&t.element&&(this.$elem=t.element,this._handler=null,this._initForm(),this._setupEvents())},_initForm:function(){this.$elem.formPaymentVisaHandler(),this._handler=this.$elem.data("custom-formPaymentVisaHandler")},_setupEvents:function(){var t=this;this.$elem.on("subscription-init",function(e,n){t._notify("subscription-init",n)}),this.$elem.on("subscription-success",function(e,n){t._notify("subscription-success",n)}),this.$elem.on("subscription_failed",function(e,n){var i={};n.error&&(i.message=n.error),n.errors&&(i.message=n.errors),t._notify("subscription-error",n)})},setCurrentPlan:function(){null!==this._handler&&this._handler.setCurrentPlan.apply(this._handler,arguments)}}),t(s)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("specialiosInit",["loginWindow","SpecialiosFormVisa"],function(t,e,o){if(!i.user.isUserPresent()){var r=new e({context:"specialios",isClosable:!1});return r.showWindow("inital"),void t()}var s=$("@specialios-data"),a=$("@specialios-form-visa"),u=$("@specialios-payment"),l=$("@specialios-success"),c=s.data("plan"),d=s.data("duration").replace("1_",""),h="default"===s.data("kind")?"standard":"premium",p={duration_type:d,payment_type:"card",sub_type:h,context:"specialios"},f=new o({element:a});f.setCurrentPlan(c),f.on("subscription-init",function(){n.subscriptionContext.set("specialios"),n.track("Subscription Initiated",p)}),f.on("subscription-success",function(t){u.addClass("hidden"),l.removeClass("hidden"),n.track("Subscription Successful",p)}),f.on("subscription-error",function(t){p.reason=t.errors,n.track("Subscription Failed",p)}),t()})}(this,this.modules,this.DIMixpanel,this.BM),function(t,e,n,i,o,r,s,a){o.define("ui-modules",["uInitAll","HotSubscription","NotificationInbox","userFollowButton","UserQuickMenu","notificationsModule","modulePopupUploadInit","RouterWeb","uInitMisc"],function(t){t()})}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel,this.docCookies,this.BM),function(t,e,n,i,o){"use strict";i.define("moduleIndexBookshelvesInit",["BookshelvesListInitializer"],function(t,n){var i=o.user.getViewingUserLogin(),r=o.user.getLogin()===i?"/a/4/u/bs.json":"/a/4/u/"+i+"/bs.json",s=(new n(void 0,{pagingAllowed:!0,pagingUrl:r,context:"user"}),o.tools.client.isTouch()?o.tools.client.touchEvent:"click");e("@mb-library-nav-mobile").on(s,function(t){return e(this).toggleClass("is-open"),0})})}(this,this.jQuery,this.radio,this.modules,this.BM),function(t,e,n){"use strict";e.define("profileSettingsCanvasProgress",["tools","canvasProgress"],function(t,e,i){var o=n("[role=canvas-progress-wrapper]"),r=null,s=function(){r||(r=new i({element:o,strokeWidth:2}))},a=function(t){e.isNumber(t)&&(s(),r.setProgress(t))},u=function(){s(),o.removeAttr("hidden")},l=function(){s(),o.attr("hidden","hidden")};t({show:u,hide:l,setProgress:a})})}(this,this.modules,this.jQuery),function(t,e,n,i,o){"use strict";i.define("profileSettingsInit",["Radio","SelectGroup","TextInput","Textarea","SocialConnect","ProfileDeletePopup","Checkbox","ConfirmInput","AccountSettingsPopup","blockSubscription","ProfileSettingsSubscriptionInit","blockReferral","ButtonSocialShare"],function(r,s,a,u,l,c,d,h,p,f,m,g,b,_){function y(){function t(t,e){var n=[2,0,1,1,1,2];return e[t%100>4&&20>t%100?2:n[5>t%10?t%10:5]]}function n(t,e){return Math.floor(Math.random()*(e-t))+t}var i=[{min:0,max:0,color:"#4FB5F0",data:["    <br>  ","   <br>     "]},{min:1,max:2,color:"#E3CA4B",data:[" ,   <br>    "," ,  <br>   ","   3D- <br>   "," ,   <br>    ","      <br>    "]},{min:3,max:5,color:"#FC8053",data:["   "," ,   <br>    "]},{min:6,max:14,color:"#36CF6E",data:["    <br>      "]},{min:15,max:17,color:"#36CF6E",data:["C      <br>    "]},{min:18,max:28,color:"#4F95F0",data:["    <br>    ","     <br> 1    ","     <br>   "]},{min:29,max:45,color:"#FC8053",data:["   <br>    ","   ","   - <br>   -","     <br>     "]},{min:46,max:79,color:"#4FB5F0",data:["    <br>    ","     <br> c  "]},{min:80,max:147,color:"#47DB9C",data:["  -","    <br>  ","     <br>  ,   "]},{min:148,max:200,color:"#E3CA4B",data:["   <br> "]},{min:201,max:400,color:"#53B5F3",data:["     <br>  ","     <br>  ","   <br>  "]},{min:401,max:450,color:"#F9814F",data:["     <br>    Subterranea"]},{min:451,max:1e4,color:"#F3614C",data:["     <br>     ","   - <br>   "]}],r=[{min:0,max:0,color:"#4FB5F0",data:["The number of daylight hours Svalbard <br> gets during winter","The number of hours David Bowie spent <br> on stage during his only USSR concert","The average length of time a bald man <br> spends styling his hair","Time taken to eat an entire <br> square of chocolate"]},{min:1,max:2,color:"#E3CA4B",data:["How long it takes to get to the bottom <br> of your Facebook feed","The amount of time needed <br> to digitize a book","The amount of time it takes <br> to 3D print a human ear","The maximum length of time a sperm <br> whale can stay underwater for","The amount of time given to eat the <br> worlds biggest steak (and get it free)"]},{min:3,max:3,color:"#FC8053",data:["How long the euphoria from booze lasts","The amount of time needed to set up <br> the sails on a three-mast bark"]},{min:4,max:5,color:"#36CF6E",data:["The longest ever speech given to the UN <br> General Assembly (by Fidel Castro in 1960)"]},{min:6,max:8,color:"#36CF6E",data:["The time taken to reach the worlds most remote <br> school  in Gulu, China  via a narrow mountain path"]},{min:9,max:14,color:"#E3CA4B",data:["The time it takes to watch <br> The Lord of The Rings trilogy in one sitting"]},{min:15,max:17,color:"#36CF6E",data:["The duration of all four acts of Wagners Der Ring <br> des Nibelungen (intermissions excluded)"]},{min:18,max:29,color:"#4F95F0",data:["How long a flu virus can live outside <br> the body","How long it takes a radio signal to reach <br> Voyager 1 at the edge of our solar system","How long it takes a cat to completely <br> forget what happened to it yesterday","A smart watchs battery life"]},{min:30,max:45,color:"#FC8053",data:["The duration of an ultramarathon <br> in Death Valley, California","The amount of time it takes <br> for dry ice to melt","How long it takes to cook Peking Duck <br> or Beef Bourguignon to perfection","The average amount of time Cambridge University <br> students actually spend studying each week"]},{min:46,max:79,color:"#4FB5F0",data:["How long geese take to fly from Sweden <br> to Catalonia for the winter","The amount of time it takes <br> a beaver fell a single tree"]},{min:80,max:147,color:"#47DB9C",data:["The lifespan of a swallowtail butterfly","How long oil paint takes to dry <br> on canvas completely","The duration of the longest ever game <br> of Monopoly played in a bathtub"]
},{min:148,max:200,color:"#E3CA4B",data:["The time it takes to travel from Moscow <br> to Vladivostok by train","The duration of the longest continuous <br> cricket match"]},{min:201,max:250,color:"#53B5F3",data:["How long it takes a glass of water to turn <br> into rain.","The average length time it takes for THC to pass <br> through your body after recreational consumption"]},{min:251,max:300,color:"#F3614C",data:["The amount of study time needed for each Chartered <br> Financial Analyst exam (there are three in total)"]},{min:301,max:400,color:"#53B5F3",data:["A hamsters gestation period"]},{min:401,max:450,color:"#F9814F",data:["The duration of the longest song ever <br> recorded (Subterranea by Thom Yorke)"]},{min:451,max:1e4,color:"#F3614C",data:["The amount of time it takes for spruce <br> bark beetles to destroy a pine grove","How long a day lasts on the Moon","How long Japanese kids spend learning <br> in school each year"]}],s=(e(".stats-2015__personal .viewport"),o.config.mainConfig.locale),a={ru:i,en:r};a[s]||(a[s]=r);var u=function(i){a[s].forEach(function(o,r){if(i<=o.max&&i>=o.min){var a=n(0,o.data.length);e(".text-custom").html(o.data[a]),e(".emoji-img").css({"background-image":"url(/personal-stats-2015-img-generator/emoji_"+s+"/"+r+"_"+a+".png)"}),e(".viewport").css({"background-color":o.color}),e(".hours").toggleClass("dense",10>i),"en"===s&&e(".count .text").text(1===i?"hour":"hours"),"ru"===s&&e(".count .text").text(t(i,["","",""])),e(".count .number").text(i)}})};!gon.readHours||"ru"!=s&&"en"!=s||(e(".bm-profile-section-personal").removeClass("hidden"),e(".bm-profile-edit").find(".bm-fieldset").first().css("border-bottom",0),u(gon.readHours))}function v(){var t=e(".bm-personal-social"),n=t.find("@bm-button-social-share"),i=new _({element:n});t.append(i.getElement());var r,s,a=e(".bm-profile-section-personal").find(".number").text(),u=o.config.mainConfig.locale,l="https://bookmate.com/library/2015?hr="+a+"&lang="+u,c="https://assets.bookmate.com/assets/read_hours_2015/"+u+"/"+a+".png";"ru"==e("html").attr("lang")?(t.find(".bm-button-social-share").append(""),s="   ",r=",      2015 "):(t.find(".bm-button-social-share").append("Share"),s="Bookmates Yearbook",r="What, where, and how people read in 2015"),i.setConfig({dropdown:!0,title:s,description:r,url:l,image:c,twitter:{title:s,description:r,url:l,image:c},vkontakte:{title:s,description:r,url:l,image:c}})}var w=(new s(e(".bm-radio")),o.user.getLogin(),new a(e(".bm-input-birthday"),{prepareData:function(t){if(0===t.length)return null;for(var e=0;e<t.length;e++){var n=t[e];parseInt(n,10)<10&&(t[e]="0"+n)}return t.reverse().join("-")},allowBlank:!0}),new d({useTemplate:!0})),k=new f({useTemplate:!0}),C=[],S=[],x=(new c,e(".bm-profile-edit")),E=x.data("phone"),P=x.data("email"),T=x.data("password"),I=e(".bm-input-login"),A=e(".bm-input-username"),B=e(".bm-phone-set-button"),O=e(".bm-input-phone-number-edit"),M=e(".bm-email-set-button"),$=e(".bm-input-email"),D=e(".bm-resend-confirmation"),R=D.find("a"),L=e(".bm-password-set-button"),F=e(".bm-password-change-button"),N=new p(O,{presaveCheck:function(t,n){e.ajax({url:"/a/4/u/send_activation_code.json",data:{"user[credential]":t},method:"post",success:function(t){"number_deleted"===t.action?(E=!1,B.removeClass("hidden"),N.$b.addClass("hidden")):n(!t.error,t.error?t.error.message:void 0)}})},popup:{show:function(t){k.show({scenario:k.Scenarios.PHONE_CHANGE,form:{name:"phone-change",data:{"user[phone_number]":t}}})}}}),j=new p($,{presaveCheck:function(t,n){e.ajax({url:"/a/4/u/check_email.json",method:"post",data:{email:t},success:function(t){n(!t.used," ")}})},popup:{show:function(t){T?k.show({scenario:k.Scenarios.EMAIL_CHANGE,form:{name:"email-change",data:{"user[email]":t}}},t):k.show({scenario:k.Scenarios.EMAIL_CHANGE_NO_PASSWORD,form:{name:"email-change-no-password",data:{"user[email]":t}}},t)}}}),U=(new g({element:e("@bm-page-settings-subscription")}),new u(I));U.on("save-success",function(){var e=U.getValue();try{o.config.mainConfig.userInfo.login=e}catch(n){}t.history.replaceState(null,t.location.pathname,o.helper.link.profileEdit(e))}),new u(A),C.push(new l(e(".bm-input-about"))),C.push(new u(e(".bm-input-site"),{postprocess:function(t){return t.replace(/http(s*):\/\//g,"")}})),e(".bm-account-delete").on("click",function(t){t.preventDefault(),w.show()}),e('.bm-profile-edit input[type="checkbox"]').each(function(t,n){S.push(new h(e(n)))}),B.on("click",function(){T?k.show({scenario:k.Scenarios.PHONE_CREATE}):k.show({scenario:k.Scenarios.PHONE_CREATE_NO_PASSWORD})}),M.on("click",function(){k.show({scenario:k.Scenarios.EMAIL_PASSWORD_CREATE_EMAIL})}),L.on("click",function(){P?k.show({scenario:k.Scenarios.PASSWORD_CREATE}):k.show({scenario:k.Scenarios.EMAIL_PASSWORD_CREATE_PASSWORD})}),F.on("click",function(){k.show({scenario:k.Scenarios.PASSWORD_CHANGE})}),R.on("click",function(t){t.preventDefault(),e.ajax({url:this.href,method:"post",success:function(t){console.log("\\_()_/")}})}),n("email-password-create-email").subscribe(function(t){P=!0,T=!0,M.addClass("hidden"),j.$b.removeClass("hidden"),D.removeClass("hidden"),L.addClass("hidden"),F.removeClass("hidden"),j.setValue(t.new_email)}),n("email-password-create-password").subscribe(function(t){P=!0,T=!0,M.addClass("hidden"),j.$b.removeClass("hidden"),D.removeClass("hidden"),L.addClass("hidden"),F.removeClass("hidden"),j.setValue(t.new_email)}),n("email-change").subscribe(function(){D.removeClass("hidden"),j.setValue(j.getValue()),j.$cancelButton.trigger("click")}),n("email-change-no-password").subscribe(function(){T=!0,j.$b.removeClass("hidden"),D.removeClass("hidden"),L.addClass("hidden"),F.removeClass("hidden"),j.setValue(j.getValue()),j.$cancelButton.trigger("click")}),n("password-create").subscribe(function(){T=!0,L.addClass("hidden"),F.removeClass("hidden")}),n("phone-create").subscribe(function(t){E=!0,B.addClass("hidden"),N.$b.removeClass("hidden"),N.setValue(t.phone_number)}),n("phone-create-no-password").subscribe(function(t){E=!0,T=!0,B.addClass("hidden"),N.$b.removeClass("hidden"),L.addClass("hidden"),F.removeClass("hidden"),N.setValue(t.phone_number)}),n("phone-change").subscribe(function(){N.setValue(N.getValue()),N.$cancelButton.trigger("click")}),E||N.$b.addClass("hidden"),P||j.$b.addClass("hidden"),setTimeout(function(){i.require("UserpicUploadModule")},1e3),e(document).ready(function(){y(),v()})})}(this,this.jQuery,this.radio,this.modules,this.BM),function(t,e,n,i){"use strict";n.define("ProfileDeletePopup",["extend","PopupBase","tools","Form"],function(n,o,r,s,a){var u=o(r),l=u,c=l.superclass,d="bm-profile-delete-template";l.Context={READER:1},e.extend(l.prototype,{initialize:function(){this._stopPropagation=!1,this._context=null,c.initialize.apply(this,arguments),this.$parent=this._elementContent.find(".bm-profile-delete-popup"),this.form=new a(this.$parent.find("form")),this.$passwordInput=this._elementContent.find(".bm-profile-delete-popup-user-password"),this.$reasonInput=this._elementContent.find(".bm-profile-delete-popup-reason"),this.$deleteBtn=this._elementContent.find(".bm-profile-delete-popup-delete-button"),this.$cancelBtn=this._elementContent.find(".bm-profile-delete-popup-cancel-button"),this.isForbidden=this.$parent.data("forbidden"),this._initListeners()},setConfig:function(t){c.setConfig.apply(this,arguments),t&&(t.stopPropagation&&(this._stopPropagation=t.stopPropagation),t.context&&(this._context=t.context))},_initListeners:function(){var e=this;e.$passwordInput.on("keyup",function(){!e.isForbidden&&e.$passwordInput.val()?e.$deleteBtn.removeAttr("disabled"):e.$deleteBtn.attr("disabled","disabled")}),e.$cancelBtn.on("click",function(t){t.preventDefault(),t.stopPropagation(),e._clearInputs(),e.hide()}),i("account-delete").subscribe(function(){t.location.href="http://www.bookmate.com"})},_clearInputs:function(){this.$passwordInput.val(""),this.$reasonInput.val("")},_getTemplateName:function(){return d}}),n(u)})}(this,this.jQuery,this.modules,this.radio),function(t,e,n,i){"use strict";n.define("profileSettingsPromocodes",["PubSub"],function(t,n){var o=function(t){function n(){_classCallCheck(this,n);var o=_possibleConstructorReturn(this,t.call(this));return o.loaded=!1,o.login=i.user.getLogin(),o.itemTemplate=e("#bm-promocode-item-template").html(),o._setElements(),o.fetch(),o}return _inherits(n,t),n.prototype._setElements=function(){this.$el=e("@promocodes-list-wrapper"),this.$container=this.$el.find("@promocodes-container")},n.prototype._renderItem=function(t){var n=e(this.itemTemplate),o=n.find("@promocode-link"),r=n.find("@promocode-kind"),s=n.find("@promocode-duration"),a=n.find("@promocode-user"),u=i.helper.subscription.promo.getLinkFromCode(t.code),l=r.data(t.kind),c=t.duration,d=t.acceptors[0];return o.attr("value",u),r.html(l),s.html("("+c+")"),d&&(n.addClass("m-disabled"),a.css("background-image","url("+d.avatar_url+")").attr("href","/"+d.login)),o.on("click",function(){this.select()}),n},n.prototype._render=function(t){var e=this;this.$items=[];for(var n in t)t.hasOwnProperty(n)&&t[n].forEach(function(t){e.$items.push(e._renderItem(t))});this.isPromocodes()&&this.$container.append(this.$items)},n.prototype.fetch=function(){var t=this;e.ajax({url:"/a/4/u/"+this.login+"/promos.json",success:function(e){return t._onSuccess(e)},error:function(e){return t._onError(e)}})},n.prototype._onSuccess=function(t){this.loaded=!0,this._render(t),this._notify("promocodes:loaded")},n.prototype._onError=function(t){console.log("Error fetch promocodes:",t)},n.prototype.show=function(){var t=this;this.isPromocodes()&&setTimeout(function(){t.$el.show()},100)},n.prototype.isLoaded=function(){return this.loaded},n.prototype.isPromocodes=function(){return this.$items&&this.$items.length},n}(n);t(o)})}(this,this.jQuery,this.modules,this.BM),function(t,e,n,i){"use strict";n.define("blockReferral",["ButtonSocialShare"],function(n,o){var r=function(){function n(){_classCallCheck(this,n),this._setElements(),this._setEventListeners(),this._initButtonSocialShare()}return n.prototype._initButtonSocialShare=function(){this._shareButtons=new o({autoFetch:!1,dropdown:!1}),this._shareButtons.setConfig({url:i.helper.link.referral(i.user.getLogin())+"?lang="+i.user.getLocale(),title:null,description:null,image:null,twitter:{title:this.$el.find("@referral-link-share-buttons").data("title"),description:null,image:null},vkontakte:{title:null,description:null,image:null},utms:{facebook:"utm_campaign=referral_invite&utm_medium=smm&utm_source=facebook",twitter:"utm_campaign=referral_invite&utm_medium=smm&utm_source=twitter",vkontakte:"utm_campaign=referral_invite&utm_medium=smm&utm_source=vkontakte"}}),this.$linkShareButtons.append(this._shareButtons.getElement()),this.$linkShareButtons.find("@bm-button-social-share-button-facebook").on("click",function(){this._sendMixpanelEvent("Facebook")}.bind(this)),this.$linkShareButtons.find("@bm-button-social-share-button-vkontakte").on("click",function(){this._sendMixpanelEvent("VK")}.bind(this)),this.$linkShareButtons.find("@bm-button-social-share-button-twitter").on("click",function(){this._sendMixpanelEvent("Twitter")}.bind(this)),this.$el.find(".bm-block-social-share-button.m-mail").on("click",function(e){e.preventDefault();var n=e.target.href;this._sendMixpanelEvent("Email"),setTimeout(function(){t.location.href=n},300)}.bind(this))},n.prototype._setElements=function(){this.$el=e("@block-referral"),this.$linkInput=this.$el.find("@referral-link"),this.$linkShareButtons=this.$el.find("@referral-link-share-buttons")},n.prototype._setEventListeners=function(){var t=this,e=this;this.$linkInput.on("click",function(){this.select(),e._sendMixpanelEvent("link")}),this.$linkInput.on("copy",function(){return t._addCopyText()})},n.prototype._sendMixpanelEvent=function(t){DIMixpanel.track("Referral Link Shared",{source:t})},n.prototype._addCopyText=function(){var e=t.getSelection(),n=this.$linkInput.data("copy-text")+" "+this.$linkInput.val(),i=document.createElement("div");i.style.position="absolute",i.style.left="-99999px",document.body.appendChild(i),i.innerHTML=n,e.selectAllChildren(i),t.setTimeout(function(){document.body.removeChild(i)},100)},n}();n(new r)})}(this,this.jQuery,this.modules,this.BM),function(t,e,n){"use strict";n.define("SocialConnect",["modules"],function(n,i){var o=function(){this.init()};o.prototype={init:function(t){this.bindEvents()},bindEvents:function(n){var i=function(t){DIMixpanel.track("Find Friend Initiated",{context:"settings",source:t})},o=function(){void 0==this.href?e(this).find("a").attr("href"):this.href,t.open("/auth/facebook","","width=600,height=260");return i("Facebook"),!1},r=function(){void 0==this.href?e(this).find("a").attr("href"):this.href,t.open("/auth/twitter","","width=760,height=380");return i("Twitter"),!1},s=function(){void 0==this.href?e(this).find("a").attr("href"):this.href,t.open("/auth/vkontakte","","width=600,height=260");return i("VK"),!1};e("section.auth").on("click","#facebookLogin",o),e(".b-social-facebook.b-social-link").click(o),e("section.auth").on("click","#twitterLogin",r),e(".b-social-twitter.b-social-link").click(r),e(".b-social-vkontakte.b-social-link").click(s)},redirect:function(e){return""!=e?t.location.href=e:void t.location.reload()}},i.SocialConnect=o,n(o)})}(this,this.jQuery,this.modules),function(t,e,n,i,o){e.define("ProfileSettingsSubscriptionInit",["extend","baseView","dynamicContent","SubscriptionBadge","PopupPaywall","PaymentForm"],function(t,e,n,r,s,a,u){var l=e(n),c=l,d=c.superclass;i.tools.mixin(c.prototype,{initialize:function(t){d.initialize.apply(this,arguments),this.$elem&&(this._dynamicContent=null,this._subscriptionInfo=[],this._popupPaywall=null,this._$badges=[],this.$elemDynamicContent=this.$elem.find("@bm-dynamic-content"),this.$elemContent=this.$elem.find("@bm-page-settings-subscription-content"),this.$elemBadgesWrapper=this.$elem.find("@bm-page-settings-subscription-badges-wrapper"),this.$elemButtonBuy=this.$elem.find("@bm-page-settings-subscription-button-buy"),this.$elemButtonBuyPremium=this.$elem.find("@bm-page-settings-subscription-button-buy-premium"),this.$elemButtonUpgradeToPremium=this.$elem.find("@bm-page-settings-subscription-button-upgrade-to-premium"),this.$elemButtonBuySubscription=this.$elem.find("@bm-page-settings-subscription-button-buy-subscription"),this.$elemLinkPromoCode=this.$elem.find("@bm-page-settings-subscription-link-promo-code"),this._initDynamicContent(),this._initPopupPaywall(),this._bindEvents(),this.fetch())},_initDynamicContent:function(){this._dynamicContent=new r({element:this.$elemDynamicContent})},_initPopupPaywall:function(){i.tools.isNull(this._popupPaywall)&&(this._popupPaywall=new a)},_bindEvents:function(){this.$elemButtonBuy.on(i.helper.event.clickName(),function(t){this._onButtonBuyClick(t)}.bind(this)),this.$elemButtonBuyPremium.on(i.helper.event.clickName(),function(t){this._onButtonBuyPremiumClick()}.bind(this)),this.$elemButtonUpgradeToPremium.on(i.helper.event.clickName(),function(t){this._onButtonUpgradeToPremiumClick()}.bind(this)),this.$elemButtonBuySubscription.on(i.helper.event.clickName(),function(t){this._onButtonBuySubscriptionClick()}.bind(this)),o("recurrent-subscription-canceled").subscribe(function(t){this._onGlobalRecurrentSubscriptionStopped(t)}.bind(this))},_onButtonBuyClick:function(){i.tools.isNull(this._popupPaywall)||this._popupPaywall.show({context:"settings",step:"about-default"})},_onButtonBuyPremiumClick:function(){this._showPopupPaywallPaymentForm()},_onButtonUpgradeToPremiumClick:function(){this._showPopupPaywallPaymentForm()},_onButtonBuySubscriptionClick:function(){var t;i.tools.isNull(this._popupPaywall)||(t=this._isPremiumExist()?a.Step.ABOUT_PREMIUM:this._isDefaultExist()?a.Step.ABOUT_BOOSTER:a.Step.ABOUT_DEFAULT,this._popupPaywall.show({context:"settings",step:t}))},_onGlobalRecurrentSubscriptionStopped:function(t){this._isEventRegistered(t)||(this._registerEvent(t),this._showStepLoading(function(){this._destroyBadges(),this.fetch()}.bind(this)))},_showPopupPaywallPaymentForm:function(){i.tools.isNull(this._popupPaywall)||this._popupPaywall.show({context:"settings",step:a.Step.PAYMENT_FORM,callback:function(){this._popupPaywall.showPaymentForm(u.SubscriptionType.PREMIUM)}.bind(this)})},fetch:function(){var t=this;i.helper.subscription.currentUser.fetchSubscriptionInfo({success:function(e){setTimeout(function(){t._onFetchSuccess(e)},300)},error:function(){t._onFetchError()}})},_onFetchSuccess:function(t){this.setSubscriptionInfo(this._parseSubscriptionInfo(t)),this.update()},_onFetchError:function(){this._showStepNoSubscription()},setSubscriptionInfo:function(t){i.tools.isArray(t)?(this._subscriptionInfo.length=0,this._subscriptionInfo=[],this._subscriptionInfo=t):i.tools.isObject(t)&&(this._subscriptionInfo.length=0,this._subscriptionInfo=[],this._subscriptionInfo.push(t))},update:function(){this._anySubscriptionPresent()?(this._renderSubscriptionBadges(),this._resolveButtonBuy(),this._resolveLinkPromoCode(),this._showStepSubscriptionExists()):this._showStepNoSubscription(),this._updateColorScheme()},_parseSubscriptionInfo:function(t){var e=[];return t.forEach(function(t){"premium"===t.kind?e.push(t):"default"===t.kind&&e.push(t)}),e},_renderSubscriptionBadges:function(){var t=this;this._subscriptionInfo.length>0&&this._subscriptionInfo.forEach(function(e){t._renderSubscriptionBadge(e)})},_renderSubscriptionBadge:function(t){this._isDefaultExist()&&this._isPremiumExist()&&"default"===t.kind&&(t.skipDefaultRenewKindSelect=!0);var e=new s(t);this.$elemBadgesWrapper.append(e.getElement()),this._$badges.push(e)},_recurrentExists:function(){return this._$badges.filter(function(t){return t.recurrentExists()}).length>0},_resolveButtonBuy:function(){this._isiOSRecurrent()&&!this._isPremiumExist()?this.$elemContent.attr("data-button-buy","buy-premium"):!this._isPremiumExist()||this._isPremiumExist()&&!this._isDefaultExist()&&!this._isPremiumRecurrent()?this._isDefaultRecurrent()?this.$elemContent.attr("data-button-buy","upgrade-to-premium"):this.$elemContent.attr("data-button-buy","buy-subscription"):this.$elemContent.removeAttr("data-button-buy")},_resolveLinkPromoCode:function(){this._isDefaultRecurrent()||this._isPremiumRecurrent()?this.$elemLinkPromoCode.addClass("m-visible"):this.$elemLinkPromoCode.removeClass("m-visible")},_updateColorScheme:function(){this._subscriptionInfo.filter(function(t){return"premium"===t.kind}).length>0?this.$elemContent.attr("data-subscription-kind","premium"):this._subscriptionInfo.filter(function(t){return"default"===t.kind}).length>0?this.$elemContent.attr("data-subscription-kind","default"):this.$elemContent.attr("data-subscription-kind","none")},_anySubscriptionPresent:function(){return this._subscriptionInfo.length>0},_showStepLoading:function(t){this._dynamicContent.showStep("loading",function(){i.tools.isFunction(t)&&t()})},_destroyBadges:function(){this._$badges.forEach(function(t){t.destroy()}),this._$badges.length=0,this._$badges=[]},_showStepSubscriptionExists:function(){this._dynamicContent.showStep("subscription-exists")},_showStepNoSubscription:function(){this._dynamicContent.showStep("no-subscription")},_isiOSRecurrent:function(){return!i.tools.isUndefined(this._subscriptionInfo.find(function(t){return"inapp"===t.type&&!i.tools.isNull(t.recurrent)}))},_isPremiumExist:function(){return!i.tools.isUndefined(this._subscriptionInfo.find(function(t){return"premium"===t.kind}))},_isPremiumRecurrent:function(){return!i.tools.isUndefined(this._subscriptionInfo.find(function(t){return"premium"===t.kind&&!i.tools.isNull(t.recurrent)}))},_isDefaultExist:function(){return!i.tools.isUndefined(this._subscriptionInfo.find(function(t){return"default"===t.kind}))},_isDefaultRecurrent:function(){return!i.tools.isUndefined(this._subscriptionInfo.find(function(t){return"default"===t.kind&&!i.tools.isNull(t.recurrent)}))}}),t(l)})}(this,this.modules,this.jQuery,this.BM,this.radio),function(t,e,n,i,o,r){"use strict";n.define("UserpicUploadModule",["profileSettingsCanvasProgress"],function(t,n){var s=(e(".bm-profile-header"),e(".bm-profile-header-avatar")),a=e(".bm-profile-header-avatar-upload-icon"),u=(e("#userpic-upload"),e("#userpic-file")),l=s.find("img"),c=(i.user.getLogin(),function(t){n.setProgress(t.loaded/t.total*100)}),d=function(t){n.setProgress(100),n.hide()},h=function(t){n.hide()},p=function(t){l.attr("src",t)},f=function(t){var e=new o,i=new r;i.append("user[userpic]",t[0]),e.upload.onprogress=c,e.addEventListener("load",d,!1),e.addEventListener("error",h,!1),e.addEventListener("readystatechange",function(){4==e.readyState&&p(JSON.parse(e.response).avatar_url)},!1),e.open("PUT","/a/4/user.json"),e.send(i),n.show()};s.on({dragover:function(){return s.addClass("bm-userpic-drop"),!1},drop:function(t){t.preventDefault(),s.removeClass("bm-userpic-drop");var e=t.originalEvent.dataTransfer.files;e.length&&f(e)},mouseout:function(){s.removeClass("bm-userpic-drop")}}),a.on("click",function(){u.click()}),u.on("change",function(){f(this.files)})})}(this,this.jQuery,this.modules,this.BM,this.XMLHttpRequest,this.FormData);var _slicedToArray=function(){function t(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(u){o=!0,r=u}finally{try{!i&&a["return"]&&a["return"]()}finally{if(o)throw r}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(t,e,n,i,o,r){"use strict";i.define("moduleUserLibraryInit",["moduleShelfBookCard","moduleImportBookCard","RouterWeb"],function(e,i,s,a){var u=this,l=n("@button-upload-book"),c=function(t){n(this);t.preventDefault(),r&&r.track("Upload Book Button Pressed")};l.on("click",c);var d=o.tools.client.isTouch()?o.tools.client.touchEvent:"click";n("@mb-library-nav-mobile").on(d,function(t){return n(this).toggleClass("is-open"),0});var h=n(t),p=t.location.pathname.match(/\/(.*)\/(.*)/),f=_slicedToArray(p,3),m=f[1],g=f[2];switch(g){case"recent":this.path="now_reading";break;case"not_finished":this.path="read_later";break;case"finished":this.path="finished";break;case"all":this.path="all";break;case"uploads":this.path="imports";break;default:return}if(this.$b=n("@user-library-list"),this.$none=n("@user-library-upload-none"),0!==this.$b.length){this.$spinnerWrapper=n(".bm-spinner-wrapper"),this.bt=this.$b.offset().top,this.preventPaging=!1,this.page=0;var b="";b=m===o.user.getLogin()?"":m+"/";var _="d/";"uploads"===g&&(_=""),this.feedSourceUrl="/a/4/u/"+b+_+this.path+".json";var y=function(t){"uploads"===g&&1===u.page&&0===t.length&&(u.$none.removeClass("hidden"),u.preventPaging=!0),t.forEach(function(t){if("import"===t.type){var e=new s(t),n=e.getElement();n.find("@bm-book-card").addClass("m-mobile-block")}else var e=new i(t);u.$b.append(e.getElement())})},v=function(t){var e={};u.page++,u.preventPaging=!0;var i=setTimeout(function(){u.$spinnerWrapper.removeClass("hidden")},300);e.page=u.page,e.p=u.page,e.per_page=30;var o=a.queryParams(),r=o.since;r&&(e.since=r),n.ajax({url:u.feedSourceUrl,data:e,method:"GET",success:function(n){clearTimeout(i);var o=n.objects||n;y(o),u.$spinnerWrapper.addClass("hidden"),o.length>0&&setTimeout(function(){u.preventPaging=o.length<e.per_page},500),t&&t()}})};v(function(){h.on("scroll",function(){!u.preventPaging&&h.scrollTop()>u.bt+u.$b.height()/3&&v()})})}})}(this,this.document,this.jQuery,this.modules,this.BM,this.DIMixpanel),function(t,e,n,i,o){"use strict";n.define("UserFriends",["ampersandView","ampersandCollection","DocumentReaderModel","DocumentReaderFullView"],function(e,n,o,r,s){var a=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,e),this.disabled=!1,this.url=t.url,this.nextPage=1,this._setElements(),this._setEventListeners(),this._initCollection(),this._initView(),this.query()}return e.prototype._setElements=function(){this.$window=i(t),this.$friends=i("@friends"),this.$container=i("@friends-container"),this.$loader=i("@friends-loader")},e.prototype._setEventListeners=function(){var t=this;this.$window.on("scroll.search",_.throttle(function(){t.$window.scrollTop()+t.$window.height()>t.$friends.offset().top+t.$friends.height()&&t.query()},500))},e.prototype._initCollection=function(){var t=o.extend({model:r});this.friendsCollection=new t},e.prototype._initView=function(){var t=this.friendsCollection,e=n.extend({render:function(){return this.isRendered?void 0:(this.isRendered=!0,this.renderCollection(t,s),this)}});this.friendsView=new e({el:this.$container[0]})},e.prototype.enable=function(){this.disabled=!1},e.prototype.disable=function(){this.disabled=!0},e.prototype.query=function(){var t=this;this.disabled||(this.$loader.show(),this.disable(),i.ajax({url:this.url,data:{p:this.nextPage,pp:20},success:function(e){t.$loader.hide(),t.enable(),e.length?t._handleRes(e):t.disable()},error:function(e){t.$loader.hide(),t.enable()}}))},e.prototype._handleRes=function(t){this.nextPage+=1,this.friendsCollection.add(t),this.friendsView.render(t)},e}();e(a)})}(this,this.document,this.modules,this.jQuery,this.DIMixpanel),function(t,e,n,i,o,r){"use strict";n.define("userFollowersInit",["inviteFriend","UserFriends"],function(e,n,r){var s=t.location.pathname.split("/")[1];new r({url:"/a/4/u/"+s+"/followers.json"});s===o.user.getLogin()&&i("@friends-provider").show(),i("@mb-library-nav-mobile").on("click",function(t){return i(this).toggleClass("is-open"),0}),e()})}(this,this.document,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i,o,r){"use strict";n.define("userFollowingInit",["inviteFriend","UserFriends"],function(e,n,r){var s=t.location.pathname.split("/")[1];new r({url:"/a/4/u/"+s+"/following.json"});s===o.user.getLogin()&&i("@friends-provider").show(),i("@mb-library-nav-mobile").on("click",function(t){return i(this).toggleClass("is-open"),0}),e()})}(this,this.document,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i,o){"use strict";n.define("inviteFriend",["blockSocialConnect"],function(t,e){var n=function(){function t(){_classCallCheck(this,t),this._setElements(),this._setEventListeners(),this._initSocialConnect()}return t.prototype._setElements=function(){this.$elemBlockSocialConnect=i("@block-social-connect"),this.$form=i("@form-invite-friend"),this.$formInput=this.$form.find("@form-invite-friend-input"),this.$formButton=this.$form.find("@form-invite-friend-submit"),this.$formMessages=this.$form.find("@form-invite-friend-message"),this.$formError=this.$form.find("@form-invite-friend-message-error"),this.$formSuccess=this.$form.find("@form-invite-friend-message-success")},t.prototype._setEventListeners=function(){var t=this;this.$form.on("submit",function(e){return t.submitForm(e)}),this.$formInput.on("input",function(){return t._checkInput()})},t.prototype._initSocialConnect=function(){e.init(this.$elemBlockSocialConnect)},t.prototype._checkInput=function(){var t=this.$formInput.val().trim(),e=t.length&&t.includes("@");this.$formButton.prop("disabled",!e)},t.prototype._enableFormButton=function(){this.$formButton.prop("disabled",!1),this.$formButton.attr("wait",!1)},t.prototype._disableFormButton=function(){this.$formButton.prop("disabled",!0),this.$formButton.attr("wait",!0)},t.prototype.submitForm=function(t){var e=this;t.preventDefault(),this._disableFormButton(),i.ajax({url:"/invites.js",type:"post",data:{invite:{email:this.$formInput.val()}},success:function(t){e.$formMessages.hide(),e.$formSuccess.show(),e._enableFormButton()},error:function(t){e.$formMessages.hide(),t&&e.$formError.text(t),e.$formError.show(),e._enableFormButton()}})},t}(),o=new n;t(o)})}(this,this.document,this.modules,this.jQuery,this.DIMixpanel),function(t,e,n,i){"use strict";n.define("userBookshelvesFollowingInit",["BookshelvesListInitializer"],function(t,n){var o=(new n(void 0,{pagingAllowed:!0,pagingUrl:"/a/4/u/"+i.user.getViewingUserLogin()+"/bs/following.json",context:"user"}),i.tools.client.isTouch()?i.tools.client.touchEvent:"click");e("@mb-library-nav-mobile").on(o,function(t){return e(this).toggleClass("is-open"),0})})}(this,this.jQuery,this.modules,this.BM),function(t,e,n,i){e.define("subscriptionsInit",["loginWindow","PopupPaywall"],function(t,e,n){var i=new n;i.$elemLinkBack.hide();var o=!1,r=function(t){var e=t||"default";i.show({step:"loading",context:"subscription_page"}),o===!0?i.showPaymentForm(e):i.on("prices-fetched",function(){o=!0,setTimeout(function(){i.showPaymentForm(e)})})},s=function(){r("default")},a=function(){r("premium")};$("@bm-subscription-default").on("click",s),$("@bm-subscription-premium").on("click",a),t()})}(this,this.modules,this.DIMixpanel,this.BM),function(t,e,n,i,o){"use strict";var r=function(t,e,i,o,r,s){var a=e(i),u=a,l=u.superclass,c="bm-zendesk-ask-email-template";n.extend(u.prototype,{initialize:function(){var t=this;this._stopPropagation=!1,this._context=null,l.initialize.apply(this,arguments),this.emailInput=new s(this._elementContent.find(".bm-zendesk-ask-email-popup-content-email")),this.submitButton=this._elementContent.find(".bm-zendesk-ask-email-popup-content-button"),this._elementOverlay.off(),this.emailInput.$b.on("keyup",function(e){t.emailInput.isValid()?t.submitButton.removeAttr("disabled"):t.submitButton.attr("disabled","disabled")})},show:function(t){l.show.apply(this,arguments)},setConfig:function(t){l.setConfig.apply(this,arguments),t&&(t.stopPropagation&&(this._stopPropagation=t.stopPropagation),t.context&&(this._context=t.context))},_getTemplateName:function(){return c}}),t(a)};i.define("AskEmailPopup",["extend","PopupBase","Form","tools","TextInput"],r)}(this,this.document,this.jQuery,this.modules,this.radio),function(t,e){e.define("initZendeskAskEmailPage",["AskEmailPopup"],function(t,e){var n=new e({useTemplate:!0});n.show()})}(this,this.modules),function(t,e,n,i){"use strict";e.define("ZendeskChatButton",[],function(e){var o=function(){function e(t){_classCallCheck(this,e),this.initElements(t),this.setEventListeners(),this.isEnabled()&&this.showButtonBlock()}return e.prototype.initElements=function(e){this.$parent=e&&e.$el||n(t),this.$zendeskWrapper=this.$parent.find("@zendesk-chat-wrapper"),this.$zendeskButtons=this.$parent.find("@zendesk-chat-button")},e.prototype.setEventListeners=function(){var t=this;this.$zendeskButtons.on("click",function(){t.setChat(),t.openChat()})},e.prototype.setChat=function(){if(this.isZopim()){var e=i.user.getLocale()||"en",n=i.user.getName()||"",o=i.user.getLogin()||"",r=i.user.getEmail()||"",s=i.user.getPhone()||"";t.$zopim(function(){t.$zopim.livechat.set({language:e,name:n?n+" | "+o:o,email:r,phone:s})})}},e.prototype.openChat=function(){this.isZopim()&&t.$zopim.livechat.window.openPopout()},e.prototype.showButtonBlock=function(){this.$zendeskWrapper.removeClass("hidden")},e.prototype.isZopim=function(){return t.$zopim&&t.$zopim.livechat},e.prototype.isEnabled=function(){var e=new t.Date,n=e.getUTCHours();return n>=7&&16>n},e}();e(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e){e.define("initZendeskLoginPage",["loginWindow"],function(t,e){var n=$(".bookmate-popup-auth-overlay"),i=new e;n.off(),i.showWindow()})}(this,this.modules),function(t,e,n,i){e.define("giftsPaymentFormBlockOperator",["PubSub","mobileOperatorInputSubmit"],function(t,e){var i=function(t){function e(n){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,t.call(this,n));return i.init(n),i}return _inherits(e,t),e.prototype.init=function(t){var e=t.$element,i=(t.context,t.special,t.operatorName),o=this,r=null,s=null,a="phone",u=e.find("@partners-phone-form"),l=e.find("@partners-phone-input"),c=l.find("input"),d=e.find("@partners-code-input"),h=(d.find("input"),e.find("@step-phone")),p=e.find("@step-code"),f=e.find("@partners-phone-error"),m=e.find("@partners-code-error"),g=e.find("@partners-resend-button"),b=e.find("@partners-resend-text"),_=function(){
return"phone"===a},y=function(){return"code"===a},v=function(){return"success"===a},w=function(){a="phone",C(null),p.addClass("hidden"),h.removeClass("hidden"),b.addClass("hidden")},k=function(){a="code",C(null),h.addClass("hidden"),p.removeClass("hidden"),d.find("input").val("").focus()},C=function(t){t?(_()?f.text(t).removeClass("hidden"):m.text(t).removeClass("hidden"),o._notify("subscription-error",{errors:[t]})):(f.text("").addClass("hidden"),m.text("").addClass("hidden"))},S=function(t,e){if(t||(t=_()?"phone":"code"),C(null),!v()){var a=n(".partners-phone-country-code").text(),u=a.replace("+","");r=u+l.data("custom-inputSubmit")._value,s=d.data("custom-inputSubmit")._value;var c="/a/4/u/send_confirmation_code",h="/gifts",p={user:{credential:r}},f=_defineProperty({},i,{number:r,code:s,plan:o._plan});n.ajax({url:"phone"===t?c:h,type:"POST",data:"phone"===t?p:f,success:function(t){return t.error||t.errors?void C(t.error&&t.error.message||t.errors&&t.errors[0]):e?(b.removeClass("hidden"),void d.find("input").val("").focus()):_()?void k():void(y()&&o._notify("subscription-success",t))},error:function(t){var e=t.responseJSON&&t.responseJSON.error&&t.responseJSON.error.message||t.responseJSON&&t.responseJSON.errors&&t.responseJSON.errors[0]||"error";C(e)}}),_(),y()}};l.inputSubmit(),d.inputSubmit(),u.on("submit",function(t){t.preventDefault(),S()}),g.on("click",function(t){S("phone",!0)}),c.on("focus",function(t){y()&&w(),!l.data("custom-inputSubmit")._value})},e.prototype.setCurrentPlan=function(t){this._plan=t},e}(e);t(i)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){e.define("giftsPaymentFormLoader",["baseView","extend","dynamicContent","giftsPaymentForm"],function(t,e,r,s,a){var u=r(e),l=u,c=l.superclass,d="bm-payment-form-loader-template";i.tools.mixin(l.prototype,{initialize:function(t){c.initialize.apply(this,arguments),this.$elemDynamicContent=this.$elem.find("@bm-payment-form-loader-dynamic-content"),this.$elemPaymentFormWrapper=this.$elem.find("@bm-payment-form-loader-form"),this._dynamicContent=null,this._paymentForm=null,this._timeoutLoadMethods=null,this._requestPaymentMethods=null,this._allowedPaymentMethods=null,this._initDynamicContent(),this._appendPaymentForm()},_initDynamicContent:function(){this._dynamicContent=new s({element:this.$elemDynamicContent})},_appendPaymentForm:function(){this._paymentForm=new a,this.$elemPaymentFormWrapper.append(this._paymentForm.getElement())},show:function(t){var e=this;this.arePaymentMethodsLoaded()?(this._dynamicContent.setStep("form"),"function"==typeof t&&t()):this.loadPaymentMethods(function(n){e.clearTimeoutLoadMethods(),"function"==typeof t&&t(),e._dynamicContent.showStep("form")},function(){e.clearTimeoutLoadMethods()})},arePaymentMethodsLoaded:function(){return!i.tools.isNull(this._allowedPaymentMethods)},loadPaymentMethods:function(t,e){var r=this,s="/a/4/billing/gifts/product_levels.json";this._dynamicContent.showStep("loading"),i.config.mainConfig.kcell&&(s+="?kcell=true"),this._requestPaymentMethods=n.ajax({url:s,type:"get",dataType:"json",success:function(e){o("bm-product-levels-update").broadcast(e),r._allowedPaymentMethods=e,r._applyPaymentMethodsRequestData(r._allowedPaymentMethods),t&&t(e)},error:function(){e&&e()}})},_applyPaymentMethodsRequestData:function(t){var e=!1;t=this._prepareData(t),t.forEach(function(t){t.levels.forEach(function(t){"premium"===t.kind&&(e=!0)})}),this._paymentForm.setAvailableMethods(t)},_prepareData:function(t){return i.helper.country.isSingapore()&&t.forEach(function(t){t.levels.forEach(function(t){t.products.forEach(function(t){"7 USD"===t.price&&"1month_cards_default_sg"===t.product_id||"1month_paypal_default_sg"===t.product_id?t.price="9.98 SGD":"74 USD"===t.price&&"1year_cards_default_sg"===t.product_id||"1year_paypal_default_sg"===t.product_id?t.price="98.98 SGD":"12 USD"===t.price&&"1month_cards_premium_sg"===t.product_id||"1month_paypal_premium_sg"===t.product_id?t.price="15.98 SGD":"120 USD"===t.price&&"1year_cards_premium_sg"===t.product_id||"1year_paypal_premium_sg"===t.product_id?t.price="158.98 SGD":"1month_cards_default_starhub_sg"===t.product_id?t.price="8 SGD":"1year_cards_default_starhub_sg"===t.product_id?t.price="80 SGD":"1month_cards_premium_starhub_sg"===t.product_id?t.price="14 SGD":"1year_cards_premium_starhub_sg"===t.product_id&&(t.price="140 SGD")})})}),t},stop:function(){i.tools.isNull(this._requestPaymentMethods)||"function"!=typeof this._requestPaymentMethods.abort||(this._requestPaymentMethods.abort(),this._requestPaymentMethods=null),this.clearTimeoutLoadMethods()},clearTimeoutLoadMethods:function(){i.tools.isNull(this._timeoutLoadMethods)||(clearTimeout(this._timeoutLoadMethods),this._timeoutLoadMethods=null)},_getTemplateName:function(){return d},getPaymentForm:function(){return this._paymentForm}}),t(u)})}(this,this.modules,this.jQuery,this.BM,this.radio),function(t,e,n,i,o){e.define("giftsPaymentForm",["baseView","extend","dynamicContent","giftsPaymentFormBlockVisa","giftsPaymentFormPaypal","giftsPaymentFormBlockOperator"],function(t,e,r,s,a,u,l){var c=r(e),d=c,h=d.superclass;i.tools.mixin(d,{SubscriptionType:{DEFAULT:"default",BOOSTER:"booster",PREMIUM:"premium"},SubscriptionDuration:{MONTH:"month",THREE_MONTHS:"3_months",SIX_MONTHS:"6_months",YEAR:"year"},PaymentMethod:{VISA:"visa",PAYPAL:"braintreepaypal",OPERATOR:"operator"}}),i.tools.mixin(d.prototype,{initialize:function(){h.initialize.apply(this,arguments),this.$elemDynamicContent=this.$elem.find("@bm-dynamic-content-method-select"),this.$elemDynamicContentVisa=this.$elem.find("@bm-dynamic-content-visa"),this.$elemDynamicContentPaypal=this.$elem.find("@bm-dynamic-content-paypal"),this.$elemDynamicContentOperator=this.$elem.find("@bm-dynamic-content-operator"),this.$elemDYnamicContentSteps=this.$elem.find(".bm-dynamic-content-step-method"),this.$elemButtonVisa=this.$elem.find("@form-payment-method-select-visa"),this.$elemButtonPaypal=this.$elem.find("@form-payment-method-select-paypal"),this.$elemButtonOperator=this.$elem.find("@form-payment-method-select-operator"),this.$elemsMethodButtons=this.$elem.find(".bm-payment-form-methods-item"),this.$elemFormVisa=this.$elem.find("@bm-form-visa-standalone"),this.$elemFormPaypal=this.$elem.find("@bm-payment-form-paypal"),this.$elemFormOperator=this.$elem.find("@bm-form-operator"),this.$elemsSubscriptionPrice=this.$elem.find("@bm-subscription-price"),this.$elemsSavings=this.$elem.find("@bm-subscription-savings"),this.$elemsPriceElements=this.$elem.find("@bm-popup-paywall-price"),this.$elemsSubscriptionDuration=this.$elem.find("@bm-popup-paywall-duration-button"),this._dynamicContent=null,this._dynamicContentVisa=null,this._dynamicContentPaypal=null,this._formVisaHandler=null,this._formPaypalHandler=null,this._formOperatorHandler=null,this._avilableMethods=[],this._currentSubscriptionKind="default",this._lastPaymentMethod=null,this._lastSubscriptionDuration=null,this._discount=0,this._initDynamicContent(),this._initForms(),this._setupEvents()},reset:function(){this._dynamicContent.setStep("empty"),this._selectMethodButton(null),this._clearInnerDynamicContent()},setAvailableMethods:function(t){var e=this;i.tools.isArray(t)&&(this._availableMethods=t,this._availableMethods.forEach(function(t){e.enableMethod(t.payment_system)}))},isPlanPremium:function(){},disableMethod:function(t){this.$elemsMethodButtons.filter("[data-payment-system="+t+"]").attr("disabled","disabled")},enableMethod:function(t){this.$elemsMethodButtons.filter("[data-payment-system="+t+"]").removeAttr("disabled")},setSubscriptionKind:function(t){t===d.SubscriptionType.BOOSTER&&(t=d.SubscriptionType.PREMIUM),this._currentSubscriptionKind=t,this._updatePaymentPrices()},setDiscount:function(t){this._discount=t},setSubscriptionDuration:function(t){this._lastSubscriptionDuration=t},_getPaymentMethodData:function(t){var e=null;return this._availableMethods.forEach(function(n){n.payment_system===t&&(e=n)}),e},_getSubscriptionPlan:function(t,e){var n=this,t=this._getPaymentMethodData(t),i=null;return t.levels.forEach(function(t){t.kind===n._currentSubscriptionKind&&t.products.forEach(function(t){t.duration===e&&(i=t.product_id)})}),i},_initDynamicContent:function(){i.tools.isNull(this._dynamicContent)&&(this._dynamicContent=new s({element:this.$elemDynamicContent})),i.tools.isNull(this._dynamicContentVisa)&&(this._dynamicContentVisa=new s({element:this.$elemDynamicContentVisa})),i.tools.isNull(this._dynamicContentPaypal)&&(this._dynamicContentPaypal=new s({element:this.$elemDynamicContentPaypal}))},_initForms:function(){this._initFormVisa(),this._initFormPaypal(),this._initFormOperator()},_updatePaymentPrices:function(){var t=this;this.$elemsPriceElements.each(function(){var e=n(this);if(e){console.log(">>>>>>>>>>",this._operatorName);var o=e.attr("data-text").replace("%{price}",i.helper.subscription.getPrice(e.attr("data-kind"),e.attr("data-duration"),{paymentMethod:n("@gifts-operator").data("operator")||t._lastPaymentMethod,discount:t._discount}));e.html(o)}})},_toggleSubscriptionDuration:function(t){var e=this.$elemsSubscriptionDuration.filter('[data-duration="'+t+'"]');this.$elemsSubscriptionDuration.hide(),e.show()},_updatePrices:function(){var t=this;null!==this._availableMethods&&this._availableMethods.forEach(function(e){var n=t.$elemsSubscriptionPrice.filter("[data-method="+e.payment_system+"]");e.levels.forEach(function(e){var i;e.kind===t._currentSubscriptionKind&&e.products.forEach(function(t){i=n.filter("[data-duration="+t.duration+"]"),i.html(t.readable_price)})})}),this._updateVisaSavingsValue()},_updateVisaSavingsValue:function(){var t,e,n=this.$elemsSavings.filter("[data-method="+d.PaymentMethod.VISA+"]"),i=this._getPaymentMethodData(d.PaymentMethod.VISA);return i.levels.forEach(function(n){n.products.forEach(function(n){"month"===n.duration?t=n.price:"year"===n.duration&&(e=n.price)})}),t&&e?(this._isPriceInRub(t)?n.attr("data-currency","rub"):this._isPriceInUsd(t)?n.attr("data-currency","usd"):n.removeAttr("data-currency"),t=this._parsePrice(t),e=this._parsePrice(e),void n.html(12*t-e)):null},_isPriceInRub:function(t){return-1!==t.indexOf("RUB")},_isPriceInUsd:function(t){return-1!==t.indexOf("$")||-1!==t.indexOf("USD")},_isPriceInSgd:function(t){return-1!==t.indexOf("SGD")},_parsePrice:function(t){return parseInt(t.replace(/[a-z $]/gi,""),10)},_initFormVisa:function(){this._formVisaHandler=new a({element:this.$elemFormVisa})},_initFormPaypal:function(){this._formPaypalHandler=new u({element:this.$elemFormPaypal})},_initFormOperator:function(){this.isOperator()&&(this._formOperatorHandler=new l({$element:this.$elemFormOperator,context:"",special:"",operatorName:this.isOperator()}))},_setupEvents:function(){var t=this,e=i.tools.client.isTouch()?i.tools.client.touchEvent:"click";this.$elemButtonVisa.on(e,function(){t._onButtonVisaClick()}),this.$elemButtonPaypal.on(e,function(){t._onButtonPaypalClick()}),this._dynamicContent.on("fade-out-end",function(){t._clearInnerDynamicContent()}),this._formVisaHandler.on("subscription-success",function(e){t._onSubscriptionSuccess(e)}),this._formVisaHandler.on("subscription-error",function(e){t._onSubscriptionError(e)}),this._formPaypalHandler.on("payment-success",function(e){t._onSubscriptionSuccess(e)}),this._formPaypalHandler.on("payment-error",function(e){t._onSubscriptionError(e)}),this._formOperatorHandler&&(this._formOperatorHandler.on("subscription-success",function(e){t._onSubscriptionSuccess(e)}),this._formOperatorHandler.on("subscription-error",function(e){t._onSubscriptionError(e)}))},_onButtonVisaClick:function(){this._dynamicContent.isUpdateInProgress()||this._selectMethodVisa()},_onButtonPaypalClick:function(){this._dynamicContent.isUpdateInProgress()||this._selectMethodPaypal()},_selectMethodVisa:function(){this._operatorName=null,this._selectMethod("visa"),this._formVisaHandler.setCurrentPlan(this._getSubscriptionPlan(d.PaymentMethod.VISA,this._lastSubscriptionDuration))},_setCurrentPlan:function(){},_selectMethodPaypal:function(){this._operatorName=null,this._selectMethod("braintreepaypal"),this._formPaypalHandler.setCurrentPlan(this._getSubscriptionPlan(d.PaymentMethod.PAYPAL,this._lastSubscriptionDuration)),this._formPaypalHandler.init()},_selectMethodOperator:function(t){this._operatorName=t,this._selectMethod("operator"),this._formOperatorHandler.setCurrentPlan(this._getSubscriptionPlan(t,this._lastSubscriptionDuration))},_selectMethod:function(t){this._lastPaymentMethod=t,this.$elemDYnamicContentSteps.removeClass("visible"),this.$elemDYnamicContentSteps.filter("[data-step="+t+"]").addClass("visible"),this._selectMethodButton(t),this._updatePaymentPrices(),this._sendEventPaymentMethodSelected()},_sendEventPaymentMethodSelected:function(){o.track("Payment Type Selected",{sub_type:this._toMixpanelSubscriptionKind(this._currentSubscriptionKind),payment_type:this._toMixpanelPaymentType(this._lastPaymentMethod),duration_type:this._toMixpanelSubscriptionDuration(this._lastSubscriptionDuration)})},_sendEventDurationTypeSelected:function(){o.track("Duration Type Selected",{sub_type:this._toMixpanelSubscriptionKind(this._currentSubscriptionKind),duration_type:this._toMixpanelSubscriptionDuration(this._lastSubscriptionDuration),payment_type:this._toMixpanelPaymentType()})},_toMixpanelPaymentType:function(t){var e=null;switch(t){case d.PaymentMethod.VISA:e="card";break;case d.PaymentMethod.PAYPAL:e="paypal";break;case d.PaymentMethod.OPERATOR:e=this._operatorName}return e},_toMixpanelSubscriptionDuration:function(t){var e=null;switch(t){case d.SubscriptionDuration.MONTH:e="month";break;case d.SubscriptionDuration.SIX_MONTHS:e="6_months";break;case d.SubscriptionDuration.THREE_MONTHS:e="3_months";break;case d.SubscriptionDuration.YEAR:e="year"}return e},_toMixpanelSubscriptionKind:function(t){var e=null;switch(t){case d.SubscriptionType.DEFAULT:e="standard";break;case d.SubscriptionType.PREMIUM:case d.SubscriptionType.BOOSTER:e="premium"}return e},_selectMethodButton:function(t){this.$elemsMethodButtons.each(function(){var e=n(this);e.attr("data-step")===t?e.addClass("m-selected"):e.removeClass("m-selected")})},_clearInnerDynamicContent:function(){this._dynamicContentVisa.setStep("initial"),this._dynamicContentPaypal.setStep("initial")},_onSubscriptionSuccess:function(t){this._notify("subscription-success",t)},_onSubscriptionError:function(t){this._trackError(t)},_trackError:function(t){var e={sub_type:this._toMixpanelSubscriptionKind(this._currentSubscriptionKind),duration_type:this._toMixpanelSubscriptionDuration(this._lastSubscriptionDuration),payment_type:this._toMixpanelPaymentType(this._lastPaymentMethod)};t&&t.errors&&(e.reason=t.errors[0]),o.track("Subscription Failed",e)},_getTemplateName:function(){return"bm-payment-form-template"},getKindByPlan:function(t){var e=null;return this._availableMethods&&this._availableMethods.forEach(function(n){n.levels.forEach(function(n){n.products.forEach(function(i){t===i.product_id&&(e=n.kind)})})}),e},isOperator:function(){return n("@gifts-operator").data("operator")}}),t(c)})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i){e.define("giftsPaymentFormPaypal",["PubSub","extend","dynamicContent"],function(e,o,r,s){var a=r(o),u=a,l=u.superclass,c="bm-payment-form-paypal-template",d="bm-form-paypal-button-buy",h="bm-form-paypal-input-nonce",p=0;i.tools.mixin(u.prototype,{initialize:function(t){l.initialize.apply(this,arguments),this._clientToken=null,this._dynamicContent=null,this._currentPlan=null,this._timeoutCheckPaypalButtonPresence=null,this._lastRequestHandler=null,this._paypalControlsUniqueId=null,this.$elem=null,i.tools.isUndefined(t)||i.tools.isUndefined(t.element)?this.$elem=this._createElement():this.$elem=t.element,this.$elemDynamicContentElement=this.$elem.find("@bm-payment-form-paypal-dynamic-content"),this.$elemButtonRetryClientTokenLoad=this.$elem.find("@bm-payment-form-paypal-button-retry-client-token-load"),this.$elemButtonBuyWrapper=this.$elem.find("@bm-payment-form-paypal-button-buy-wrapper"),this.$elemInputNonce=this.$elem.find("@bm-payment-form-paypal-input-nonce"),this.$elemButtonPayHint=this.$elem.find("@bm-payment-form-paypal-button-pay-hint"),this.$elemButtonPaySpinner=this.$elem.find("@bm-payment-form-paypal-button-pay-spinner"),this.$elemErrorTextWrapper=this.$elem.find("@bm-payment-form-paypal-error-text-wrapper"),this.$elemErrorTextDynamic=this.$elem.find("@bm-payment-form-paypal-error-text-dynamic"),this.$elemErrorPossibleReason=this.$elem.find("@bm-payment-form-paypal-error-possible-reason"),this._initDynamicContent(),this._setupEvents()},_initDynamicContent:function(){i.tools.isNull(this._dynamicContent)&&(this._dynamicContent=new s({element:this.$elemDynamicContentElement}))},_setupEvents:function(){var t=this,e=i.tools.client.isTouch()?i.tools.client.touchEvent:"click";this.$elemButtonRetryClientTokenLoad.on(e,function(){t._loadClientToken()}),this.$elem.on("click",function(e){e.target===t.$elem.find("#bt-pp-cancel").get(0)&&t._onPaypalCancelClick()})},_onPaypalCancelClick:function(){this._showButtonPayHint(),this._hideButtonPaySpinner(),this._abort()},init:function(){return i.tools.isNull(this._clientToken)?void this._loadClientToken():void this._showButtonPayHint()},setCurrentPlan:function(t){this._currentPlan=t},_loadClientToken:function(){var t=this;this._dynamicContent.showStep("loading"),this._lastRequestHandler=n.ajax({url:"/payments/braintree/client_token",type:"post",success:function(e){t._clientToken=e.client_token,t._renderButtonBuy()},error:function(){t._showError(),t._notify("subscription-error",{message:"client_token_load_error"})}})},clear:function(){i.tools.isNull(this._clientToken)&&this._dynamicContent.setState("loading")},_renderButtonBuy:function(){if(!i.tools.isNull(this._clientToken)&&t.braintree){var e=this;this._startPaypalButtonCheckingLoop(),this._clearButtonBuy(),this._generateIdsForPaypalControls(),this._hideButtonPaySpinner(),t.braintree.setup(this._clientToken,"paypal",{container:this.$elemButtonBuyWrapper.attr("id"),nonce:this.$elemInputNonce.attr("id"),onSuccess:function(){e._hideButtonPayHint(),e._sendRequestPaypalPayment()},onError:function(){e._showError(),e._notify("subscription-error",{message:"paypal_button_render_error"})}})}},_clearButtonBuy:function(){this.$elemButtonBuyWrapper.html("")},_sendRequestPaypalPayment:function(){var t=this;this._showButtonPaySpinner(),this._lastRequestHandler=n.ajax({url:"/gifts",type:"post",dataType:"json",data:{braintree:{plan:this._currentPlan,payment_method_nonce:this.$elemButtonBuyWrapper.find("[name=payment_method_nonce]").val(),device_data:i.helper.braintree.deviceData()}},success:function(e){t._notify("payment-success",e)},error:function(e){var n;t._notify("payment-error"),e&&e.responseJSON&&e.responseJSON.errors&&(n=e.responseJSON.errors),t._showError(n),t._notify("subscription-error",{message:n})}})},_startPaypalButtonCheckingLoop:function(){this._paypalButtonAlreadyRendered()?this._onPaypalButtonRendered():this._checkIfPaypalButtonRendered()},_checkIfPaypalButtonRendered:function(){var t=this;i.tools.isNull(this._timeoutCheckPaypalButtonPresence)||(clearTimeout(this._timeoutCheckPaypalButtonPresence),this._timeoutCheckPaypalButtonPresence=null),this._timeoutCheckPaypalButtonPresence=setTimeout(function(){t._paypalButtonAlreadyRendered()?t._onPaypalButtonRendered():t._checkIfPaypalButtonRendered()},250)},_paypalButtonAlreadyRendered:function(){return this.$elemButtonBuyWrapper.find("#braintree-paypal-button").length>0},_onPaypalButtonRendered:function(){this._showButtonPay()},_showButtonPay:function(){this._dynamicContent.showStep("button-pay")},_showButtonPayHint:function(){this.$elemButtonPayHint.removeAttr("data-visible")},_hideButtonPayHint:function(){this.$elemButtonPayHint.attr("data-visible","false")},_showButtonPaySpinner:function(){this.$elemButtonPaySpinner.attr("data-spinner","true")},_hideButtonPaySpinner:function(){this.$elemButtonPaySpinner.removeAttr("data-spinner")},_generateIdsForPaypalControls:function(){this._paypalControlsUniqueId=++p,this.$elemButtonBuyWrapper.attr("id",d+this._paypalControlsUniqueId),this.$elemInputNonce.attr("id",h+this._paypalControlsUniqueId)},_showError:function(t){i.tools.isUndefined(t)?(this.$elemErrorTextWrapper.removeAttr("data-error-custom"),this.$elemErrorPossibleReason.removeAttr("hidden")):(this.$elemErrorTextWrapper.attr("data-error-custom","true"),this.$elemErrorTextDynamic.html(t.replace("\n","<br/>")),this.$elemErrorPossibleReason.attr("hidden","hidden")),this._dynamicContent.showStep("error")},_clear:function(){this.$elemButtonBuyWrapper.html("")},_abort:function(){i.tools.isNull(this._lastRequestHandler)||"function"==typeof this._lastRequestHandler.abort&&this._lastRequestHandler.abort()},_createElement:function(){var t=this._getTemplateName();this.$elem=n(n("#"+t).html())},_setState:function(t){this.$elem.attr("data-state","state")},_getTemplateName:function(){return c}}),e(a)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("giftsPaymentFormBlockVisa",["PubSub","extend","paymentPopup/visa"],function(t,e,o){var r=n.custom.popupPaymentFormVisa;n.widget("custom.formPaymentVisaHandler",r,{_sendRequestSubscribe:function(){var t=this;this._setFormWait(!0),this._getPostDataWithNonce({success:function(e){n.ajax({type:"post",url:"/gifts",data:e,dataType:"json",success:function(e){t._onSubscribeSuccess(e),t.element.trigger("subscription_success")},error:function(e){t._handleSubscribeError(e.responseJSON),t.element.trigger("subscription_failed",e.responseJSON)}})},error:function(){t._handleSubscribeError(""),t.element.trigger("subscription_failed","")}})},_onSubscribeSuccess:function(t){this.element.trigger("subscription-success",t)},_onSubscribeError:function(){this.element.trigger("subscription-error")},getElement:function(){return this.element}});var s=o(e),a=s,u=a.superclass;i.tools.mixin(a.prototype,{initialize:function(t){u.initialize.apply(this,arguments),t&&t.element&&(this.$elem=t.element,this._handler=null,this._initForm(),this._setupEvents())},_initForm:function(){this.$elem.formPaymentVisaHandler(),this._handler=this.$elem.data("custom-formPaymentVisaHandler")},_setupEvents:function(){var t=this;this.$elem.on("subscription-success",function(e,n){t._notify("subscription-success",n)}),this.$elem.on("subscription_failed",function(e,n){var i={};n.error&&(i.message=n.error),n.errors&&(i.message=n.errors),t._notify("subscription-error",n)})},setCurrentPlan:function(){null!==this._handler&&this._handler.setCurrentPlan.apply(this._handler,arguments)}}),t(s)})}(this,this.modules,this.jQuery,this.BM),function(t,e){"use strict";var n=function(t){"app_landing"===BM.config.mainConfig.action&&e.track("App Promo Page Shown"),$("@appld-install").on("click",function(){var t=$(this).data("platform")||"none";e.track("Install App Button Pressed",{app:t})}),$("@appld-get-app-button").on("click",function(){var t=$(this).data("context");e.track("Get the App Button Pressed",{context:t})}),t()};t.define("appLandingAnalytics",[],n)}(this.modules,this.DIMixpanel),function(t){"use strict";var e=function(t,e,n,i,o,r,s){$("@bookpage-social-counter").socialCounters(),t()};t.define("appLandingInit",["appLandingSetup","appLandingAnalytics","appLandingIpad","appLandingModals","appLandingSlider"],e)}(this.modules),function(t){"use strict";var e=function(t){"function"==typeof jQuery&&t instanceof jQuery&&(t=t[0]);var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},n=function(t,n){return function(){e(t)&&n()}},i=function(t){var e=[12,14,16,18,22],n=e[t]+"px";$("@appld-ipad-content").css({fontSize:n})},o=function(t){var e=0,o=$("@appld-ipad-content");$("@appld-ipad-lineheight").on("click",function(t){var e=$(this);switch(e.siblings().removeClass("selected"),e.addClass("selected"),e.data("setting")){case"small":o.css({lineHeight:"1.3"});break;case"medium":o.css({lineHeight:"1.4"});break;case"large":o.css({lineHeight:"1.6"})}}),$("@appld-ipad-font").on("click",function(t){var e=$(this);switch(e.siblings().removeClass("selected"),e.addClass("selected"),e.data("setting")){case"georgia":o.css({fontFamily:"Georgia, serif"});break;case"times":o.css({fontFamily:"Times, serif"});break;case"arial":o.css({fontFamily:"Arial, sans-serif"});break;case"verdana":o.css({fontFamily:"Verdana, sans-serif"})}}),$("@appld-ipad-color").on("click",function(t){var e=$(this);switch(e.siblings().removeClass("selected"),e.addClass("selected"),e.data("setting")){case"bw":o.css({backgroundColor:"white",color:"black"});break;case"sr":o.css({backgroundColor:"#F5EFDE",color:"#6d4231"});break;case"wb":o.css({backgroundColor:"black",color:"white"})}}),$("@appld-ipad-smaller").on("click",function(){return $("@appld-ipad-fontsize").removeClass("disabled"),e>0?e--:$(this).addClass("disabled"),i(e),!1}),$("@appld-ipad-larger").on("click",function(){return $("@appld-ipad-fontsize").removeClass("disabled"),4>e?e++:$(this).addClass("disabled"),i(e),!1});var r=$("@appld-ipad-header"),s=$("@appld-controls"),a=!1,u=function(){a||(a=!0,setTimeout(function(){s.addClass("in-viewport")},750))},l=n(r,u);$(window).on("DOMContentLoaded load resize scroll",l),t()};t.define("appLandingIpad",[],o)}(this.modules),function(t){"use strict";var e=function(t,e){var n=$("@appld-button-buy-subscription"),i=new t,o=new e({preventDefaultLoginBehavior:!0,context:"subscription"});n.on("click",function(){BM.user.isUserPresent()?i.show({step:"auto",context:"main_app"}):(o.showWindow("inital"),o.on("authenticationSuccessful",function(){o.closeWindow(),i.show({step:"auto",context:"main_app"})}))})},n=function(){if(0===$(".md-overlay").length)return 0;var t=$(".md-overlay").first();[].slice.call($(".md-trigger")).forEach(function(e,n){function i(t){o.removeClass("md-show"),t&&$(document.documentElement).removeClass("md-perspective")}var o=$("#"+$(e).data("modal")),r=o.find(".md-close"),s=function(){i($(e).hasClass("md-setperspective"))};e.addEventListener("click",function(n){return n.stopPropagation(),n.preventDefault(),o.addClass("md-show"),t.on("click",s),$(e).hasClass("md-setperspective")&&setTimeout(function(){$(document.documentElement).addClass("md-perspective")},25),setTimeout(function(){$("@appld-phone-input").focus()},100),!1}),r.on("click",function(t){t.stopPropagation(),s()})})},i=function(t){if(0===$("@appld-country-select").length)return 0;var e=($("body").hasClass("m-sg"),"7"),n=$("@appld-country-select").selectize({create:!1,sortField:"text",valueField:"data-code",searchField:["text","value","code"],onChange:function(t){var n=this.options[this.items[0]],o=n?n.code:i;e=o,$("@appld-phone-code").html("+"+o)}}),i=null,n=n[0].selectize;setTimeout(function(){var t=n.options[n.items[0]],o=t?t.code:"7";i=o,e=o,$("@appld-phone-code").html("+"+i)},100);var o=$("@appld-phone-input"),r=$("@appld-phone-input-container");o.on("focus",function(){r.removeClass("error")});var s={regionCode:function(){return"+"+e}};t("@form-send-link",s);var a=function(t){return/^\+?([0-9]{4,})$/.test(t.replace(" ",""))},u=$("@form-send-link-input-message"),l=$("@form-send-link-message-success");$("@form-send-link-submit").on("click",function(t){var e=$("@form-send-link-input").val(),n=4,i=$("@appld-phone-input-container");""===e?(u.html(u.data("empty")),i.addClass("error")):e.length<n?(u.html(u.data("not-full")),i.addClass("error")):a(e)?(u.addClass("m-hidden"),i.removeClass("error")):(u.html(u.data("invalid")),i.addClass("error"))}),$("@form-send-link").on("response",function(t,e){e.error&&422===e.error.code&&(l.addClass("m-invisible"),u.removeClass("m-hidden"),u.html(u.data("invalid")),r.addClass("error"))})},o=function(t,o,r,s){e(r,s),n(),i(o),t()};t.define("appLandingModals",["formSendLink","PopupPaywall","loginWindow"],o)}(this.modules),function(t){"use strict";var e=function(t){var e=function(){return/Android|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent||navigator.vendor||window.opera)}();window.mobilecheck=function(){var t=!1;return function(e,n){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t};var n=function(){return navigator.userAgent.match(/Windows Phone/i)?"wp":navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?"ios":navigator.userAgent.match(/android/i)?"android":"other"}();e||skrollr.init({forceHeight:!1}),$("@appld-device-specific").addClass(n),$(function(){$("@appld-loaded-animation").addClass("loaded")}),t()};t.define("appLandingSetup",[],e)}(this.modules),function(t,e){"use strict";var n=function(t){var e=$("@slider__nav__item.selected").data("target"),n=function(t){if(e===t)return 0;var n=$(".appld-slider__slide"),i=$("@appld-slide[data-target='"+t+"']"),o=$("@appld-slide[data-target='"+e+"']");1===t?n.removeClass("selected"):t>e?i.addClass("selected"):(i.addClass("insta-selected"),i.addClass("selected"),o.removeClass("selected"),setTimeout(function(){i.removeClass("insta-selected")},10)),$("@slider__nav__item").removeClass("selected"),$("@slider__nav__item[data-target='"+t+"']").addClass("selected"),e=t};n(e);var i=$("@slider__nav__item").length,o=function(){var t=e+1;n(i>=t?t:1)},r=null;$("@appld-slider");$("@slider__nav__item").on("click",function(t){var e=$(this);window.clearTimeout(r),n(e.data("target"))});var s=function(){window.clearTimeout(r);var t=3e3;r=setInterval(o,t)},a=!1,u=function(){a||(s(),a=!0)};u(),t()};t.define("appLandingSlider",[],n)}(this.modules,this.DIMixpanel),function(t,e,n){n.define("azercellInit",["mobileOperatorInit","azercellSlides"],function(t){var n=e.custom.mobileOperatorInit;e.widget("custom.mobileOperatorInit",n,{}),e(function(){e(".layout").mobileOperatorInit()}),t()})}(this,this.jQuery,this.modules),function(t,e,n){"use strict";n.define("azercellSlideBase",["mobileOperatorSlideBase"],function(t){var n=e.custom.slideBase;e.widget("custom.slideBase",n,{name:"azercell"}),t()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("azercellSlideConfirmation",["azercellSlideBase","mobileOperatorSlideConfirmation"],function(t){
var n=e.custom.slideConfirmation;e.widget("custom.slideConfirmation",n,{}),t()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n){n.define("azercellSlideLanding",["azercellSlideBase","mobileOperatorSlideLanding"],function(t){var n=e.custom.slideLanding;e.widget("custom.slideLanding",n,{}),t()})}(this,this.jQuery,this.modules),function(t,e,n){n.define("azercellSlideSuccess",["azercellSlideBase","mobileOperatorSlideSuccess"],function(t){var n=e.custom.slideSuccess;e.widget("custom.slideSuccess",n,{}),t()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("azercellSlides",["azercellSlideLanding","azercellSlideConfirmation","azercellSlideSuccess","mobileOperatorSlides"],function(t){var n=e.custom.slides;e.widget("custom.slides",n,{special:"azercell"}),e(function(){e(".layout").slides()}),t()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n){n.define("mobileOperatorInit",["loginWindow"],function(n,i){e.widget("custom.mobileOperatorInit",{_init:function(){this.slidesReady=!1,this._initLoginWindow(),this._bindEvents()},_initLoginWindow:function(){this.loginWindow=new i},_bindEvents:function(){var e=this;return t.radio?(t.radio("mobile-operator-slides-ready").subscribe(function(){e._onSlidesReady()}),void t.radio("show-login-window").subscribe(function(){e.loginWindow.showWindow()})):void setTimeout(function(){e._bindEvents()},25)},_onSlidesReady:function(){this.slidesReady=!0,this.element.attr("ready","true")},isSlidesReady:function(){return this.slidesReady}}),n()})}(this,this.jQuery,this.modules),function(t,e,n){"use strict";n.define("mobileOperatorSlideBase",["mobileOperatorInputSubmit"],function(n){e.widget("custom.slideBase",{name:"",phoneNumber:"",_init:function(){this._elementContent=this.element.find(".bookmate-slide-content"),this.setUrls()},setUrls:function(){this.urls={checkNumber:"/"+this.getName()+"/check_number.json",validateCode:"/"+this.getName()+"/validate_code.json",resendPassword:"/a/4/u/reset_password.json"}},setPhoneNumber:function(e){t.phoneNumber=e},getPhoneNumber:function(){return t.phoneNumber},setLogin:function(e){t.login=e},getElement:function(){return this.element},getName:function(){return this.name},show:function(){this.element.show()},hide:function(){this.element.hide()},checkNumberRequest:function(n,i){e.ajax({type:"POST",url:this.urls.checkNumber,data:{number:t.phoneNumber},success:n,error:i}),t.radio("mixpanel:getSubscriptionInitiated").broadcast()},resendPassword:function(){e.ajax({type:"POST",url:this.urls.resendPassword,data:{method:"phone_number",password_autogenerate:!0,login:t.login}})},_isTouch:function(){return t.hasOwnProperty("ontouchstart")===!0}}),n()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("mobileOperatorSlideConfirmation",[],function(n){var i=e.custom.slideBase;e.widget("custom.slideConfirmation",i,{_init:function(){i.prototype._init.apply(this,arguments),this._elementContentWrapper=this.element.find(".bookmate-slide-content-wrapper"),this._elementInputSubmitCode=this.element.find(".bookmate-input-submit.input-submit-code"),this._elementInputSubmitCodeError=this.element.find(".input-submit-error.error-code"),this._elementInputSubmitCodeState=this.element.find(".input-submit-state.state-code"),this._elementInputSubmitPhone=this.element.find(".bookmate-input-submit.input-submit-phone"),this._elementResentCode=this.element.find(".slide-confirmation-resend-code"),this._elementButtonLinkResetPhone=this.element.find(".button-link-reset-phone"),this._initInputSubmit(),this.reset(),this._setupEvents()},_initInputSubmit:function(){this._elementInputSubmitCode.inputSubmit(),this._elementInputSubmitPhone.inputSubmit()},_setupEvents:function(){var e=this,n=this._isTouch()?BM.tools.client.touchEvent:"click";this._elementResentCode.on(n,function(){e._onResentCodeClick()}),this._elementInputSubmitCode.on(n,function(){e._onInputSubmitCodeClick()}),this._elementInputSubmitCode.on("submit",function(){e._onInputSubmitCodeSubmit()}),this._elementButtonLinkResetPhone.on(n,function(){e._onButtonLinkResetPhoneClick()}),t.radio("mobile-operator-slide-landing-phone-checked").subscribe(function(t){e._showCode(t)})},_onResentCodeClick:function(){this.checkNumberRequest()},_actionHandler:function(e){var n=Array.prototype.slice.call(arguments,1),i={show_code_page:function(t){},show_success_page:function(){t.radio("mobile-operator-slide-confirmation-code-success").broadcast(userSubscribed)},redirect_with_informer:function(){t.radio("redirect-to-library").broadcast(!0)},redirect_without_informer:function(){t.radio("redirect-to-library").broadcast()}};i.hasOwnProperty(e)?i[e].apply(this,n):console.warn("unknown action")},_showCode:function(t){if(t){var e=this._getInputSubmitPhone();e._elementInput.val(t),e.disable()}},_onInputSubmitCodeClick:function(){this._hideErrors()},_onInputSubmitCodeSubmit:function(){this._getInputSubmitCode()._elementInput.blur(),this._validateCode(),t.radio("mixpanel:confirmationCodeEntered").broadcast()},_validateCode:function(){var t=this.urls.validateCode,n=this._getInputSubmitCode(),i=this.getPhoneNumber(),o=n._value,r=e.param({number:i,code:o});e.ajax({type:"POST",url:t,data:r,success:this._onCodeActivationSuccess.bind(this),error:this._onCodeActivationError.bind(this)})},_onCodeActivationSuccess:function(e){var n=e.action;this._hideErrors(),this.setLogin(e.login);var i=Array.prototype.slice.call(arguments,1),o={show_code_page:function(){},show_success_page:function(){t.radio("mobile-operator-slide-confirmation-code-success").broadcast(),t.radio("mixpanel:getSubscriptionSuccessful").broadcast(),t.radio("mixpanel:getSubscriptionSuccessful").broadcast()},redirect_with_informer:function(){t.radio("redirect-to-library").broadcast(!0)},redirect_without_informer:function(){t.radio("redirect-to-library").broadcast()}};o.hasOwnProperty(n)?o[n].apply(this,i):console.warn("unknown action")},_onCodeActivationError:function(e){var n=this._getInputSubmitCode(),i="ru"===BM.config.mainConfig.locale?"-   ":"Something went wrong";i=e.responseJSON&&e.responseJSON.error?e.responseJSON.error:i,n.enable(),this._displayErrorCode(i),t.radio("mixpanel:getSubscriptionFailed").broadcast(i)},_onButtonLinkResetPhoneClick:function(){this._resetSlide(),t.radio("mobile-operator-slide-confirmation-phone-reset").broadcast()},_resetSlide:function(){var t=this._getInputSubmitCode();t.reset(),t.enable(),this._hideErrors()},_getInputSubmitPhone:function(){return this._elementInputSubmitPhone.data("custom-inputSubmit")},_getInputSubmitCode:function(){return this._elementInputSubmitCode.data("custom-inputSubmit")},setInputSubmitPhoneValue:function(t){return this._getInputSubmitPhone().setValue(t)},_displayErrorCode:function(t){this._elementInputSubmitCodeError.html(t),this._elementInputSubmitCodeError.removeAttr("hidden")},_hideErrors:function(){this._elementInputSubmitCodeError.attr("hidden","hidden")},reset:function(){this._resetSlide()}}),n()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n){n.define("mobileOperatorSlideLanding",[],function(n){var i=e.custom.slideBase,o=250;e.widget("custom.slideLanding",i,{_init:function(){i.prototype._init.apply(this,arguments),this._elementInputSubmitPhone=this.element.find(".input-submit-phone"),this._elementInputPhoneError=this.element.find(".input-submit-error.error-phone"),this._elementButtonPay=this.element.find(".button-pay"),this._elementButtonRead=this.element.find(".button-read"),this._elementBookSlider=this.element.find(".bookmate-book-slider"),this._elementBookSliderContent=this.element.find(".bookmate-book-slider-content"),this._elementUserAgreementWrapper=this.element.find(".user-agreement-wrapper"),this._elementLinkUserAgreement=this.element.find(".user-agreement-link"),this._elementLinkShowQA=this.element.find(".link-qa"),this._elementArrowLeft=this.element.find(".book-slider-arrow.arrow-left"),this._elementArrowRight=this.element.find(".book-slider-arrow.arrow-right"),this._elementPaymentError=this.element.find(".error-message-payment"),this.allowEnableNumberInput=!0,this._initInputSubmit(),this._setupEvents()},_initInputSubmit:function(){this._elementInputSubmitPhone.inputSubmit(),this._getInputSubmitPhone()._elementButton.removeAttr("disabled")},_setupEvents:function(){var e=this,n=this._isTouch()?BM.tools.client.touchEvent:"click";this._elementButtonPay.on(n,function(t){e._onInputPhoneSubmit()}),this._elementInputSubmitPhone.on("submit",function(){e._onInputPhoneSubmit()}),this._elementArrowLeft.on(n,function(){e._onArrowLeftClick()}),this._elementArrowRight.on(n,function(){e._onArrowRightClick()}),this._elementLinkShowQA.on(n,function(t){e._onLinkShowQAClick(t)}),this._elementLinkUserAgreement.on(n,function(t){e._onLinkUserAgreementClick(t)}),this._elementButtonRead.on(n,function(t){e._onButtonReadClick(t)}),t.radio("mobile-operator-slide-confirmation-phone-reset").subscribe(function(){e._resetPhoneNumber()})},_onButtonReadClick:function(){e(t).width>640?e("body, html").animate({scrollTop:200},300,"easeInOutQuad"):e(".layout-content-wrapper").animate({scrollTop:200},300,"easeInOutQuad")},_onArrowLeftClick:function(){this._moveBookSliderLeft()},_onArrowRightClick:function(){this._moveBookSliderRight()},_onLinkShowQAClick:function(e){e.preventDefault(),t.radio&&t.radio("mobile-operator-qa-show-request").broadcast()},_onLinkUserAgreementClick:function(e){e.stopPropagation(),e.preventDefault(),t.radio("mobile-operator-user-agreement-show-request").broadcast()},_onInputSubmitPhoneClick:function(t){t.stopPropagation()},_onInputPhoneSubmit:function(){this._getInputSubmitPhone().options.disabled||(this._getInputSubmitPhone()._elementInput.blur(),this.setPhoneNumber(this._getInputSubmitPhone()._value),this._checkNumber())},_checkNumber:function(){if(!this.isInProgress){var e=this,n=this._getInputSubmitPhone(),i=function(i){e.isInProgress=!1,e.isAllowEnableNumberInput()&&n.enable();var o="ru"===BM.config.mainConfig.locale?"-   ,  ":"Something went wrong. Please check the number";o=i.responseJSON&&i.responseJSON.error&&"Internal Server Error"!==i.responseJSON.error?i.responseJSON.error:o,e._displayErrorPhone(o),t.radio("mixpanel:getSubscriptionFailed").broadcast(o)},o=function(t){e.isInProgress=!1,void 0!==t.action?e._actionHandler(t.action,e.getPhoneNumber()):i(t),e.isAllowEnableNumberInput()&&n.enable()};e.isInProgress=!0,n.disable(),e.checkNumberRequest(o,i)}},_actionHandler:function(n,i){e(".paste-number-value").html(i);var o=Array.prototype.slice.call(arguments,1),r={show_code_page:function(e){t.radio("mobile-operator-slide-landing-phone-checked").broadcast(e),t.radio("mixpanel:phoneConfirmationScreenShown").broadcast()},show_success_page:function(){t.radio("mobile-operator-slide-confirmation-code-success").broadcast(),t.radio("mixpanel:getSubscriptionSuccessful").broadcast()},redirect_with_informer:function(){t.radio("redirect-to-library").broadcast(!0)},redirect_without_informer:function(){t.radio("redirect-to-library").broadcast()}};r.hasOwnProperty(n)?r[n].apply(this,o):console.warn("unknown action")},_getInputSubmitPhone:function(){return this._elementInputSubmitPhone.data("custom-inputSubmit")},_moveBookSliderLeft:function(){this._moveBookSlider(o,-1)},_moveBookSliderRight:function(){this._moveBookSlider(o,1)},_moveBookSlider:function(t,e){var n=parseInt(this._elementBookSliderContent.css("padding-left"),10)||0,i=this._elementBookSliderContent.width()-this._elementBookSlider.width()+2*n,o=this._elementBookSlider.scrollLeft(),r=Math.max(0,Math.min(i,o+t*e));this._elementBookSlider.animate({scrollLeft:r},200)},_displayErrorPhone:function(t){this._elementInputPhoneError.html(t),this._elementInputSubmitPhone.addClass("error")},_hideErrorPhone:function(){this._elementInputSubmitPhone.removeClass("error")},_resetPhoneNumber:function(){var t=this._getInputSubmitPhone();t.reset(),t.enable(),this._hideErrorPhone(),this.setPhoneNumber("")},setNumberInputValue:function(t){var e=this._getInputSubmitPhone()._elementInput;e.val(t)},disableNumberInput:function(){var t=this._getInputSubmitPhone()._elementInput;t.attr("disabled","disabled")},isAllowEnableNumberInput:function(){return this.allowEnableNumberInput}}),n()})}(this,this.jQuery,this.modules),function(t,e,n){n.define("mobileOperatorSlideSuccess",[],function(n){var i=e.custom.slideBase;e.widget("custom.slideSuccess",i,{_init:function(){i.prototype._init.apply(this,arguments),this._elementInputSubmitPhone=this.element.find(".bookmate-input-submit.input-submit-phone"),this._elementButtonLinkSettings=this.element.find(".link-settings"),this._elementButtonSendSmsWrapper=this.element.find(".button-send-sms-wrapper"),this._elementButtonResendSms=this.element.find(".resend-sms"),this._elementButtonSendSms=this._elementButtonSendSmsWrapper.find(".button-send-sms"),this._elementSmsSendingMessageSuccess=this._elementButtonSendSmsWrapper.find(".message-success"),this._installAppButtons=this.element.find(".app-link"),this._setupEvents()},_setupEvents:function(){var n=this._isTouch()?BM.tools.client.touchEvent:"click";this._installAppButtons.on(n,function(n){n.preventDefault();var i=e(n.currentTarget),o=i.attr("href"),r=i.data("app");t.radio("mixpanel:installAppButtonPressed").broadcast(r),setTimeout(function(){window.location.replace(o)}.bind(this),200)}.bind(this)),this._elementButtonResendSms.on(n,function(){this.resendPassword()}.bind(this))}}),n()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("mobileOperatorSlides",[],function(n){var i=e(window),o=e(t.document.body),r={LANDING:"1",CONFIRMATION:"2",SUCCESS:"3"},s={CONFIRMATION:"confirmation",ROOT:"root",SUCCESS:"success",QA:"qa",UA:"ua"};e.widget("custom.slides",{special:"",_init:function(){this._elementWindow=e(t),this._elementSlidesWrapper=this.element.find(".bookmate-slides-horizontal"),this._elementSlides=this.element.find(".bookmate-slides"),this._elementWindowFullscreen=o.find(".layout-window-fullscreen"),this._elementWindowFullscreenClose=this._elementWindowFullscreen.find(".js-button-close"),this._elementEulaWrapper=this._elementWindowFullscreen.find(".eula-wrapper"),this._elementQAWrapper=this._elementWindowFullscreen.find(".qa-wrapper"),this._mobileOperatorConfig=null,this._slides=[],this._initSlides(),this._parseConfig(),this._bindEvents(),this._applyConfig(),this._checkBrowser(),this._updateLayout(),"#success"===window.location.hash?this._showSlideSuccess():this._showSlideLanding()},_initSlides:function(){this._elementSlides.find(".bookmate-slide[role=slide-landing]").slideLanding(),this._elementSlides.find(".bookmate-slide[role=slide-confirmation]").slideConfirmation(),this._elementSlides.find(".bookmate-slide[role=slide-success]").slideSuccess(),this._slides.push({id:r.LANDING,widget:this._getSlideLanding()}),this._slides.push({id:r.CONFIRMATION,widget:this._getSlideConfirmation()}),this._slides.push({id:r.SUCCESS,widget:this._getSlideSuccess()})},_bindEvents:function(){var e=this,n=this._isTouch()?BM.tools.client.touchEvent:"click";e._initPopstateLanding(),this._elementWindowFullscreenClose.on(n,function(t){t.stopPropagation(),e._setBrowserState({page:window.history.state.source}),e._hideWindowFullscreen()}),t.radio&&(t.radio("mobile-operator-slide-landing-phone-checked").subscribe(function(){e._onSlideLandingButtonPayClick()}),t.radio("mobile-operator-slide-confirmation-code-success").subscribe(function(t){e._onSlideConfirmationCodeSuccess(t)}),t.radio("mobile-operator-user-agreement-show-request").subscribe(function(){e._onUserAgreementShowRequest()}),t.radio("mobile-operator-qa-show-request").subscribe(function(){e._onQAShowRequest()}),t.radio("mobile-operator-slide-confirmation-phone-reset").subscribe(function(){e._onConfirmationPhoneReset()}),t.radio("redirect-to-library").subscribe(function(e){var n="/library";e&&(n+="?subscription_exist=true"),t.location.replace(n)}),t.radio("mixpanel:getSubscriptionInitiated").subscribe(function(){e._sendMixpanelEventGetSubscriptionInitiated()}),t.radio("mixpanel:getSubscriptionFailed").subscribe(function(t){e._sendMixpanelEventGetSubscriptionFailed(t)}),t.radio("mixpanel:phoneConfirmationScreenShown").subscribe(function(){e._sendMixpanelEventPhoneConfirmationScreenShown()}),t.radio("mixpanel:getSubscriptionSuccessful").subscribe(function(){e._sendMixpanelEventGetSubscriptionSuccessful()}),t.radio("mixpanel:installAppButtonPressed").subscribe(function(t){e._sendMixpanelEventInstallAppButtonPressed(t)}),t.radio("mixpanel:confirmationCodeEntered").subscribe(function(){e._sendMixpanelConfirmationCodeEntered()}))},_initPopstateLanding:function(){var t=this;i.on("popstate.landing",function(){var e=history.state;e?e.page===s.CONFIRMATION?(t._hideWindowFullscreen(),t._getSlideConfirmation().reset(),t._showSlideConfirmation()):e.page===s.ROOT?(t._hideWindowFullscreen(),t._showSlideLanding()):e.page===s.QA?t._showQAFrame():e.page===s.UA&&t._showUserAgreementFrame():"#success"===window.location.hash?(t._getSlideSuccess().getElement().attr("data-source","sms"),t._showSlideSuccess()):t._showSlideLanding()})},_disablePopstateLanding:function(){i.off("popstate.landing")},_initPopstateSuccess:function(){var t=this;i.on("popstate",function(){var e=history.state;e&&(e.page===s.SUCCESS?t._showSlideSuccess():e.page===s.SETTINGS?t._showSlideSettings():window.location.href="http://"+window.location.host+"/"+window.location.pathname.split("/")[1]+window.location.search.split("/")[0])})},_checkBrowser:function(){window.document.all&&!window.atob&&e(".old-ie").show()},_onSlideLandingButtonPayClick:function(){this._setBrowserState({page:s.CONFIRMATION}),this._showSlideConfirmation()},_onSlideConfirmationCodeSuccess:function(t){this._showSlideSuccess()},_onUserAgreementShowRequest:function(){var t=1===this._getCurrentSlideNumber()?s.ROOT:s.CONFIRMATION;this._setBrowserState({page:s.UA,source:t}),this._showUserAgreementFrame()},_onQAShowRequest:function(){var t=1===this._getCurrentSlideNumber()?s.ROOT:s.CONFIRMATION;this._setBrowserState({page:s.QA,source:t}),this._showQAFrame()},_showQAFrame:function(){this._elementWindowFullscreen.show(),this._elementEulaWrapper.hide(),this._elementQAWrapper.show(),this._elementWindowFullscreen.scrollTop(0),this._elementWindowFullscreen.attr("tabindex",-1).focus(),o.addClass("fullscreen-window-visible")},_showUserAgreementFrame:function(){this._elementWindowFullscreen.show(),this._elementQAWrapper.hide(),this._elementEulaWrapper.show(),this._elementWindowFullscreen.scrollTop(0),this._elementWindowFullscreen.attr("tabindex",-1).focus(),o.addClass("fullscreen-window-visible")},_hideWindowFullscreen:function(){this._elementWindowFullscreen.hide(),this._elementQAWrapper.hide(),this._elementEulaWrapper.hide(),o.removeClass("fullscreen-window-visible")},_parseConfig:function(){var t=this.element.attr("data-config");try{this._mobileOperatorConfig=JSON.parse(t)}catch(e){this._mobileOperatorConfig={}}this._mobileOperatorConfig.one_click_number=null,this._mobileOperatorConfig.number=this._mobileOperatorConfig.user.phone_number,this._mobileOperatorConfig.subscribed=this._mobileOperatorConfig.user.subscribed,this._mobileOperatorConfig.present=this._mobileOperatorConfig.user.present,this._mobileOperatorConfig.number_from_header=this._mobileOperatorConfig.user.number_from_header,this._mobileOperatorConfig.user.phone_number=null,this._mobileOperatorConfig.user.subscribed=!1,this._mobileOperatorConfig.user.present=!1},_isSubscriptionEnabled:function(){var t=this._getSlideSettings();return t.isButtonEnableSubscriptionHidden()},_showHeader:function(){this.element.removeAttr("header-hidden")},_hideHeader:function(){this.element.attr("header-hidden","true")},_applyConfig:function(){var e=this._mobileOperatorConfig.number,n=(this._mobileOperatorConfig.number_from_header,this._getSlideLanding());t.DIMixpanel.track("Mobile Operator Number Set",{context:window.location.pathname.split("/")[1],phone_number:e}),e&&e.length&&n.setNumberInputValue(e)},_onConfirmationPhoneReset:function(){this._showSlideLanding()},_updateLayout:function(){},_showSlideLanding:function(){this._showSlideFirst()},_showSlideConfirmation:function(){this._showSlideSecond()},_showSlideSuccess:function(){this._showSlideThird()},_showSlide:function(n){var i=this._getCurrentSlideWidget(),o=this._getSlideWidgetByNumber(n);this._elementSlidesWrapper.attr("slide",n),i&&i.hide(),o.show(),e(t).width>640?(e("body, html").animate({scrollTop:0},10,"easeInOutQuad"),e(".layout-content-wrapper").animate({scrollTop:0},10,"easeInOutQuad")):e(".layout-content-wrapper").animate({scrollTop:0},10,"easeInOutQuad")},_getSlideActive:function(){var t=this._elementSlidesWrapper.attr("slide");return t===r.LANDING?this._getSlide("landing"):t===r.CONFIRMATION?this._getSlide("confirmation"):t===r.SUCCESS?this._getSlide("success"):t===r.SETTINGS?this._getSlide("settings"):null},_showSlideFirst:function(){return this._showSlide(r.LANDING)},_showSlideSecond:function(){return this._showSlide(r.CONFIRMATION)},_showSlideThird:function(){return this._showSlide(r.SUCCESS)},_showSlideFourth:function(){return this._showSlide(r.SETTINGS)},_getCurrentSlideNumber:function(){return parseInt(this._elementSlidesWrapper.attr("slide"),10)||0},_getCurrentSlideWidget:function(){var t=this._getCurrentSlideNumber();return t?this._getSlideWidgetByNumber(t):null},_getSlideWidgetByNumber:function(t){var e=null;return this._slides.forEach(function(n){n.id===t.toString()&&(e=n.widget)}),e},_getSlideLanding:function(){var t=this._getSlide("landing");return t.data("custom-slideLanding")},_getSlideConfirmation:function(){var t=this._getSlide("confirmation");return t.data("custom-slideConfirmation")},_getSlideSuccess:function(){var t=this._getSlide("success");return t.data("custom-slideSuccess")},_getSlide:function(t){return this._elementSlidesWrapper.find(".bookmate-slide[role=slide-"+t+"]")},_setBrowserState:function(t){window.history.pushState(t,null,"/"+window.location.pathname.split("/")[1]+(t.page!==s.ROOT?"/"+t.page:"")+window.location.search.split("/")[0])},_replaceBrowserState:function(t){window.history.replaceState(t,null,"/"+window.location.pathname.split("/")[1]+(t.page!==s.ROOT?"/"+t.page:"")+window.location.search.split("/")[0])},_isTouch:function(){return t.hasOwnProperty("ontouchstart")===!0},_sendMixpanelEventGetSubscriptionInitiated:function(){this._trackDIMixpanel("Get Subscription Initiated",{special:this.special})},_sendMixpanelEventGetSubscriptionFailed:function(t){this._trackDIMixpanel("Get Subscription Failed",{special:this.special,reason:t})},_sendMixpanelEventPhoneConfirmationScreenShown:function(){this._trackDIMixpanel("Phone Confirmation Screen Shown",{special:this.special})},_sendMixpanelEventGetSubscriptionSuccessful:function(){this._trackDIMixpanel("Get Subscription Successful",{special:this.special})},_sendMixpanelEventInstallAppButtonPressed:function(t){this._trackDIMixpanel("Install App Button Pressed",{app:t})},_sendMixpanelConfirmationCodeEntered:function(){this._trackDIMixpanel("Confirmation Code Entered",{special:this.special})},_trackDIMixpanel:function(e,n){n=n||{},t.DIMixpanel.track(e,n)}}),n()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n){n.define("mtsbelorusInit",["mobileOperatorInit","mtsbelorusSlides"],function(t){var n=e.custom.mobileOperatorInit;e.widget("custom.mobileOperatorInit",n,{_init:function(){this.slidesReady=!1,this._initLoginWindow(),this._bindEvents(),this._fixOpera()},_fixOpera:function(){BM.tools.client.isAndroid()&&BM.tools.client.isOperaMini()&&e(".layout-header").addClass("m-image")}}),e(function(){e(".layout").mobileOperatorInit()}),t()})}(this,this.jQuery,this.modules),function(t,e,n){"use strict";n.define("mtsbelorusSlideBase",["mobileOperatorSlideBase"],function(t){var n=e.custom.slideBase;e.widget("custom.slideBase",n,{name:"mts_by"}),t()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("mtsbelorusSlideConfirmation",["mtsbelorusSlideBase","mobileOperatorSlideConfirmation"],function(t){var n=e.custom.slideConfirmation;e.widget("custom.slideConfirmation",n,{}),t()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n){n.define("mtsbelorusSlideLanding",["mtsbelorusSlideBase","mobileOperatorSlideLanding"],function(t){var n=e.custom.slideLanding;e.widget("custom.slideLanding",n,{}),t()})}(this,this.jQuery,this.modules),function(t,e,n){n.define("mtsbelorusSlideSuccess",["mtsbelorusSlideBase","mobileOperatorSlideSuccess"],function(t){var n=e.custom.slideSuccess;e.widget("custom.slideSuccess",n,{}),t()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("mtsbelorusSlides",["mtsbelorusSlideLanding","mtsbelorusSlideConfirmation","mtsbelorusSlideSuccess","mobileOperatorSlides"],function(t){var n=e.custom.slides;e.widget("custom.slides",n,{special:"mts_belarus"}),e(function(){e(".layout").slides()}),t()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n){n.define("megafonInit",["mobileOperatorInit","megafonSlides"],function(t){var n=e.custom.mobileOperatorInit;e.widget("custom.mobileOperatorInit",n,{}),e(function(){e(".layout").mobileOperatorInit()}),t()})}(this,this.jQuery,this.modules),function(t,e,n){"use strict";n.define("megafonSlideBase",["mobileOperatorSlideBase"],function(t){var n=e.custom.slideBase;e.widget("custom.slideBase",n,{name:"megafon"}),t()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("megafonSlideConfirmation",["megafonSlideBase","mobileOperatorSlideConfirmation"],function(t){var n=e.custom.slideConfirmation;e.widget("custom.slideConfirmation",n,{}),t()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n){n.define("megafonSlideLanding",["megafonSlideBase","mobileOperatorSlideLanding"],function(t){var n=e.custom.slideLanding;e.widget("custom.slideLanding",n,{}),t()})}(this,this.jQuery,this.modules),function(t,e,n){n.define("megafonSlideSuccess",["megafonSlideBase","mobileOperatorSlideSuccess"],function(t){var n=e.custom.slideSuccess;e.widget("custom.slideSuccess",n,{}),t()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("megafonSlides",["megafonSlideLanding","megafonSlideConfirmation","megafonSlideSuccess","mobileOperatorSlides"],function(t){var n=e.custom.slides;e.widget("custom.slides",n,{special:"megafon_volga"}),e(function(){e(".layout").slides()}),t()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n){n.define("tele2Init",["mobileOperatorInit","tele2Slides"],function(t){var n=e.custom.mobileOperatorInit;e.widget("custom.mobileOperatorInit",n,{_init:function(){this.slidesReady=!1,this._initLoginWindow(),this._bindEvents(),this._fixOpera()},_fixOpera:function(){BM.tools.client.isAndroid()&&BM.tools.client.isOperaMini()&&e(".layout-header").addClass("m-image")}}),e(function(){e(".layout").mobileOperatorInit()}),t()})}(this,this.jQuery,this.modules),function(t,e,n){"use strict";n.define("tele2SlideBase",["mobileOperatorSlideBase"],function(t){var n=e.custom.slideBase;e.widget("custom.slideBase",n,{name:"tele2"}),t()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("tele2SlideConfirmation",["tele2SlideBase","mobileOperatorSlideConfirmation"],function(t){var n=e.custom.slideConfirmation;e.widget("custom.slideConfirmation",n,{}),t()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n){n.define("tele2SlideLanding",["tele2SlideBase","mobileOperatorSlideLanding"],function(t){var n=e.custom.slideLanding;e.widget("custom.slideLanding",n,{}),t()})}(this,this.jQuery,this.modules),function(t,e,n){n.define("tele2SlideSuccess",["tele2SlideBase","mobileOperatorSlideSuccess"],function(t){var n=e.custom.slideSuccess;e.widget("custom.slideSuccess",n,{}),t()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("tele2Slides",["tele2SlideLanding","tele2SlideConfirmation","tele2SlideSuccess","mobileOperatorSlides"],function(t){var n=e.custom.slides;e.widget("custom.slides",n,{special:"tele2"}),e(function(){e(".layout").slides()}),t()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n){n.define("tele2eeInit",["mobileOperatorInit","tele2eeSlides"],function(t){var n=e.custom.mobileOperatorInit;e.widget("custom.mobileOperatorInit",n,{}),e(function(){e(".layout").mobileOperatorInit()}),t()})}(this,this.jQuery,this.modules),function(t,e,n){"use strict";n.define("tele2eeSlideBase",["mobileOperatorSlideBase"],function(n){var i=e.custom.slideBase;e.widget("custom.slideBase",i,{name:"tele2ee",setPhoneNumber:function(e){t.phoneNumber="372"+e}}),n()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("tele2eeSlideConfirmation",["tele2eeSlideBase","mobileOperatorSlideConfirmation"],function(t){var n=e.custom.slideConfirmation;e.widget("custom.slideConfirmation",n,{}),t()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n){n.define("tele2eeSlideLanding",["tele2eeSlideBase","mobileOperatorSlideLanding"],function(t){var n=e.custom.slideLanding;e.widget("custom.slideLanding",n,{}),t()})}(this,this.jQuery,this.modules),function(t,e,n){n.define("tele2eeSlideSuccess",["tele2eeSlideBase","mobileOperatorSlideSuccess"],function(t){var n=e.custom.slideSuccess;e.widget("custom.slideSuccess",n,{}),t()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("tele2eeSlides",["tele2eeSlideLanding","tele2eeSlideConfirmation","tele2eeSlideSuccess","mobileOperatorSlides"],function(t){var n=e.custom.slides;e.widget("custom.slides",n,{special:"tele2_ee"}),e(function(){e(".layout").slides()}),t()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n){"use strict";n.define("mobileOperatorInputSubmit",[],function(t){e.widget("custom.inputSubmit",{_init:function(){this._elementInput=this.element.find(".bookmate-input"),this._elementButton=this.element.find(".bookmate-button"),this._mask=null,this._minValueLength=null,this._allowedChars=null,this._value=null,this._setConfig(),this._bindEvents(),this._initMask()},_initMask:function(){null!==this._mask&&this._elementInput.setMask({mask:this._mask,maxLength:this._maxValueLength||10,autoTab:!1,setSize:this._maxValueLength||10})},_setConfig:function(){null!==this._getAttr("mask")&&(this._mask=this._getAttr("mask")),null!==this._getAttr("allowed-chars")&&(this._allowedChars=parseInt(this._getAttr("allowed-chars"),10)||null),this._getAttr("min-value-length")&&(this._minValueLength=parseInt(this._getAttr("min-value-length"),10)),this._getAttr("max-value-length")&&(this._maxValueLength=parseInt(this._getAttr("max-value-length"),10))},_bindEvents:function(){var t=this;this._elementInput.on("input click blur cut paste keyup change",function(e){e.stopPropagation(),13===e.keyCode?t._submitForm():t._onInputChange()}),this._elementInput.on("touchend",function(){}),this._elementButton.on("click",function(){t._onButtonClick()})},_onButtonClick:function(){this._submitForm()},_onInputChange:function(){this._value=this._getValue(),this._hasValue()&&this._isValueValid()?this._showButton():this._hideButton()},_submitForm:function(){this._isValueValid()&&this.element.trigger("submit")},setValue:function(t,e){null!==t&&void 0!==t&&(-1!==t.indexOf("+")&&(t=t.replace("+","")),this._elementInput.val(t),this._elementInput.trigger("keyup"))},getValue:function(){return this._getValue()},_getValue:function(){var t=this._elementInput.val();return null!==this._mask&&(t=t.replace(/[^0-9a-zA-Z]*/gi,"")),this._isAllowedCharsNumbers()&&(t=parseInt(t,10)),t},_hasValue:function(){return!(0!==this._value&&!this._value)},_isValueValid:function(){return null===this._value?!1:null!==this._minValueLength?this._value.toString(10).length>=this._minValueLength:!!this._value},_isAllowedCharsNumbers:function(){return 1===this._allowedChars},_getAttr:function(t){var e,n=this.element.attr(t);return e=n?n:null},_showButton:function(){this.element.attr("button-visible","true")},_hideButton:function(){this.element.removeAttr("button-visible")},focusInput:function(){this._elementInput.focus()},focusButton:function(){this._elementButton.focus()},enable:function(){this.element.removeAttr("disabled"),this._elementInput.removeAttr("disabled"),
this._elementButton.removeAttr("disabled")},disable:function(){this.element.attr("disabled","disabled"),this._elementInput.attr("disabled","disabled"),this._elementButton.attr("disabled","disabled")},reset:function(){this._elementInput.val(""),this._elementInput.trigger("change")},focus:function(){this._elementInput.focus()},getElement:function(){return this.element},getElementInput:function(){return this._elementInput}}),t()})}(this,this.jQuery,this.modules),function(t,e,n,i){e.define("EmotionCollection",["Collection","EmotionComponent"],function(t,e,n){var o=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e}(e);i.tools.mixin(o.prototype,{config:{component:n}}),t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("ImpressionCollection",["Collection","ImpressionModel","ImpressionItem"],function(t,e,n,o){var r=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e.prototype._onFetchSuccess=function(t){},e.prototype.mapUsers=function(t){var e=[],n=0,o=this._items.length;for(i.tools.isNumber(t)&&(o=t),n;o>n;++n)this._items[n]&&e.push(this._items[n].model.data.user);return e},e.prototype.getCurrentUserImpression=function(){return this._items.filter(function(t){return t.model&&t.model.data.user&&t.model.data.user.model.data.login===i.user.login()})[0]||null},e}(e);i.tools.mixin(r.prototype,{config:{pagination:{p:1,pp:20},component:o,url:"/a/4/d/:document_uuid/impressions?embed_document=true&embed_likes=10&with_likers=true",data:{document_uuid:""},itemData:{view:{state:{book:!1,socialCounters:!1,likes:!1,likesSimple:!0,owner:!0}}}}}),t(r)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("UserCollection",["Collection","UserPublic"],function(t,e,n){var o=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e}(e);i.tools.mixin(o.prototype,{config:{component:n}}),t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n){n.define("beelineInit",["mobileOperatorInit","beelineSlides"],function(t){var n=e.custom.mobileOperatorInit;e.widget("custom.mobileOperatorInit",n,{}),e(function(){e(".layout").mobileOperatorInit()}),t()})}(this,this.jQuery,this.modules),function(t,e,n){"use strict";n.define("beelineSlideBase",["mobileOperatorSlideBase"],function(t){var n=e.custom.slideBase;e.widget("custom.slideBase",n,{name:"beeline"}),t()})}(this,this.jQuery,this.modules),function(t,e,n,i,o){i.define("beelineSlideConfirmation",["beelineSlideBase","mobileOperatorSlideConfirmation"],function(n){var i=e.custom.slideConfirmation;e.widget("custom.slideConfirmation",i,{_onCodeActivationSuccess:function(e){var n=e.action;this._hideErrors(),this.setLogin(e.login);var i=Array.prototype.slice.call(arguments,1),r={show_code_page:function(){},show_success_page:function(){t.radio("mobile-operator-slide-confirmation-code-success").broadcast(),t.radio("mixpanel:getSubscriptionSuccessful").broadcast()},redirect_with_informer:function(){t.radio("redirect-to-library").broadcast(!0)},redirect_without_informer:function(){t.radio("redirect-to-library").broadcast()}};o&&o.push({event:"bookmate_sms_button"}),r.hasOwnProperty(n)?r[n].apply(this,i):console.warn("unknown action")}}),n()})}(this,this.jQuery,this.DIMixpanel,this.modules,this.dataLayer),function(t,e,n,i){n.define("beelineSlideLanding",["beelineSlideBase","mobileOperatorSlideLanding"],function(n){var o=e.custom.slideLanding;e.widget("custom.slideLanding",o,{_checkNumber:function(){if(!this.isInProgress){var e=this,n=this._getInputSubmitPhone(),o=function(i){e.isInProgress=!1,e.isAllowEnableNumberInput()&&n.enable();var o="ru"===BM.config.mainConfig.locale?"-   ,  ":"Something went wrong. Please check the number";o=i.responseJSON&&i.responseJSON.error&&"Internal Server Error"!==i.responseJSON.error?i.responseJSON.error:o,e._displayErrorPhone(o),t.radio("mixpanel:getSubscriptionFailed").broadcast(o)},r=function(t){e.isInProgress=!1,this.setLogin&&t.login&&this.setLogin(t.login),i&&i.push({event:"bookmate_number_button"}),void 0!==t.action?e._actionHandler(t.action,e.getPhoneNumber()):o(t),e.isAllowEnableNumberInput()&&n.enable()};e.isInProgress=!0,n.disable(),e.checkNumberRequest(r,o)}}}),n()})}(this,this.jQuery,this.modules,this.dataLayer),function(t,e,n){n.define("beelineSlideSuccess",["beelineSlideBase","mobileOperatorSlideSuccess"],function(t){var n=e.custom.slideSuccess;e.widget("custom.slideSuccess",n,{}),t()})}(this,this.jQuery,this.modules),function(t,e,n,i){i.define("beelineSlides",["beelineSlideLanding","beelineSlideConfirmation","beelineSlideSuccess","mobileOperatorSlides"],function(t){var n=e.custom.slides;e.widget("custom.slides",n,{special:"beeline_siberia"}),e(function(){e(".layout").slides()}),t()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n,i){i.define("kievstarInit",["kievstarSlideLanding"],function(i){var o=e("@button-tel");o.on("click",function(e){e.preventDefault(),n.track("Kievstar Button Pressed"),t.setTimeout(function(){window.location=o.attr("href")},300)}),i()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n,i){i.define("kievstarSlideLanding",["mobileOperatorSlideBase","mobileOperatorSlideLanding"],function(t){var n=e.custom.slideLanding;e.widget("custom.slideLanding",n,{_initInputSubmit:function(){}}),e(".bookmate-slide[role=slide-landing]").slideLanding(),t()})}(this,this.jQuery,this.DIMixpanel,this.modules),function(t,e,n,i){e.define("EmotionView",["View"],function(t,e){var n=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e.prototype.setSize=function(t){t=t||"normal",this.$elem.attr("data-size",t)},e.prototype.setName=function(t){i.tools.isString(t)&&this.$elem.attr("data-name",t)},e.prototype._getTemplateName=function(){return"bm-emotion-template"},e}(e);i.tools.mixin(n.prototype,{config:{events:{},bindings:{unicode:{type:"function",hook:"unicode",callback:function(t,e){t.html(e),i.lib.emoji.supported()||(this.$elem.addClass("m-as-image"),i.lib.emoji.replace(t))}},label:{type:"text",hook:"label"},color:{type:"function",hook:"color",callback:function(t,e){t.attr("data-color",e.toString(16))}}}}}),t(n)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("ImpressionCollectionView",["View"],function(t,e){var n=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e.prototype.loading=function(t){t?this.el.addClass("m-loading"):this.el.removeClass("m-loading")},e.prototype._getTemplateName=function(){return"bm-impression-group-template"},e}(e);i.tools.mixin(n.prototype,{config:{bindings:{collection_items:{type:"collection_items",hook:"collection_items"}}}}),t(n)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("ImpressionItemView",["extend","View","RouterWeb","EmotionComponent","DropDown","ButtonSocialShare"],function(o,r,s,a,u,l,c){var d=null;e.require(["PopupImpression"],function(t){d=t});var h=function(o){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,o.apply(this,arguments))}return _inherits(r,o),r.prototype.initialize=function(t){this.state={remove:!1,edit:!1,likes:!0,likesSimple:!1,book:!0,socialCounters:!1,owner:!0,popup:!0,topControls:!1,content:!1},o.prototype.initialize.apply(this,arguments),this._bookBlock=null,this._popupImpression=null,this._dropdownControls=null,this._buttonShare=null,this._initDropdownControls(),this._initButtonShare()},r.prototype._bind=function(){o.prototype._bind.apply(this,arguments),this.$elemOwnerLogin=this.$elem.find("@bm-impression-item-owner-login"),this.$elemBookBlockWrapper=this.$elem.find("@bm-impression-item-book-block-wrapper"),this.$elemEdit=this.$elem.find("@bm-impression-item-control-edit"),this.$elemRemove=this.$elem.find("@bm-impression-item-control-remove"),this.$elemDynamicContent=this.$elem.find("@bm-impression-item-dynamic-content"),this.$elemContent=this.$elem.find("@bm-impression-item-content"),this.$elemForm=this.$elem.find("@bm-impression-item-form-wrapper"),this.$elemSpinner=this.$elem.find("@bm-impression-item-loading"),this.$elemControls=this.$elem.find("@bm-impression-item-controls-wrapper"),this.$elemButtonOptions=this.$elem.find("@bm-impression-item-button-options"),this.$elemDropdown=this.$elem.find("@bm-impression-item-controls-dropdown"),this.$elemLikesCounter=this.$elem.find("@bm-impression-item-likes-counter")},r.prototype.updateShareButton=function(t){if(i.tools.isNull(this._buttonShare)&&this._initButtonShare(),i.tools.isObject(t)){var e=t.json(),n=e.document?e.document.title:"",o=e.document?e.document.authors:"",r="%{title} (%{authors})".replace("%{title}",n).replace("%{authors}",o),s=t.emotionsAsString(),a=t.emotionsLablesAsString(),u=e.content?e.content:"",l=e.document&&e.document.cover?i.helper.link.full(e.document.cover.url):"",c=i.helper.link.full(i.helper.link.impression(e.uuid)),d=(i.helper.link.full(i.helper.link.book(e.book_uuid)),i.helper.link.full(i.helper.link.book(e.book_uuid))+"?impression_uuid="+e.uuid,""),h=a?a:u;s&&(d+=s),u&&(d+="\n\n",d+=u),this._buttonShare.setConfig({url:c,description:d,image:l,title:r,twitter:{title:i.helper.text.slice(h,90),url:c},vkontakte:{url:c,description:"auto",title:"auto"}})}},r.prototype.initBookBlock=function(t){var e=this;this._requireBookBlock(function(n){e._initBookBlock(t,n)})},r.prototype.updateBookBlock=function(t){return i.tools.isNull(this._bookBlock)?void this.initBookBlock(t):(this._bookBlock.setConfig(this._getBookBlockConfig(t)),void this._bookBlock.updateAll())},r.prototype.updateLogin=function(t,e){i.tools.isString(t)&&this.$elemOwnerLogin.html(t),i.tools.isString(e)&&this.$elemOwnerLogin.attr("href",i.helper.link.user(e))},r.prototype.setControls=function(t){var e=this;i.tools.isObject(t)&&(Object.keys(t).forEach(function(n){e.state[n]=!!t[n]}),this._update())},r.prototype.setButtonOptionsVisible=function(t){t?this.$elemButtonOptions.removeClass("m-hidden"):this.$elemButtonOptions.addClass("m-hidden")},r.prototype.setControlsVisible=function(t){t?this.$elemControls.removeClass("m-hidden"):this.$elemControls.addClass("m-hidden")},r.prototype.get$dc=function(){return this.$elemDynamicContent},r.prototype.appendForm=function(t){t&&this.$elemForm.append(t)},r.prototype.confirmRemove=function(){return t.confirm(this.$elemRemove.attr("data-confirm-text"))},r.prototype.updateSpinnerHeight=function(){this.$elemSpinner.height(this.$elem.height())},r.prototype.focus=function(){this.$elemContent.addClass("m-animate-focus")},r.prototype._initDropdownControls=function(){i.tools.isNull(this._dropdownControls)&&(this._dropdownControls=new l({$button:this.$elemButtonOptions,$container:this.$elemDropdown}))},r.prototype._initButtonShare=function(){i.tools.isNull(this._buttonShare)&&(this._buttonShare=new c({context:"impression"}),this._buttonShare.getElement().appendTo(this.$elemControls))},r.prototype._requireBookBlock=function(t){i.tools.isFunction(t)&&e.require(["BookBlockListItem"],function(e){t(e)})},r.prototype._initBookBlock=function(t,e){i.tools.isNull(this._bookBlock)&&(this._bookBlock=new e(this._getBookBlockConfig(t)),this.$elemBookBlockWrapper.append(this._bookBlock.getElement()))},r.prototype._getBookBlockConfig=function(t){return t.lc&&(t.libraryCard=t.lc),t=i.tools.mixin(t,{components:{readers:!1,owner:!1},openDocumentPopup:!0,readButton:{dropdownOptions:{$layout:n(".bm-document-popup-root").find(".bm-popup-content-wrapper")}},mixpanel_ctx:"impression",discovery_id:this.model.data.uuid})},r.prototype._update=function(){var t=void 0,e=void 0,n=void 0;for(t in this.state)this.state.hasOwnProperty(t)&&(e="m-"+i.helper.text.camelToHyphens(t)+"-enabled",n="m-"+i.helper.text.camelToHyphens(t)+"-disabled",this.state[t]?(this.$elem.addClass(e),this.$elem.removeClass(n)):(this.$elem.addClass(n),this.$elem.removeClass(e)));this.setButtonOptionsVisible(this.state.edit||this.state.remove)},r.prototype._getTemplateName=function(){return"bm-impression-item-template"},r.prototype._onLikePressed=function(t){this._notify("like-button-pressed")},r.prototype._onLikeContentPressed=function(t){t.stopPropagation(),t.preventDefault(),this._notify("like-button-pressed")},r.prototype._onContentPressed=function(){this.state.popup&&a.navigateToImpressionPage({uuid:this.model.data.uuid})},r.prototype._onControlEditPressed=function(){this._dropdownControls&&this._dropdownControls.close(),this._notify("edit-request")},r.prototype._onControlRemovePressed=function(){this._dropdownControls&&this._dropdownControls.close(),this._notify("remove-request")},r}(s);i.tools.mixin(h.prototype,{config:{events:{"press @bm-impression-item-like-button":"_onLikePressed","press @bm-impression-item-like-button-content":"_onLikeContentPressed","press @bm-impression-item-content":"_onContentPressed","press @bm-impression-item-control-edit":"_onControlEditPressed","press @bm-impression-item-control-remove":"_onControlRemovePressed"},bindings:{content:{type:"function",hook:"content",callback:function(t,e){i.tools.isString(e)&&(e=e.trim()),t.text(e),i.lib.emoji.supported()||i.lib.emoji.replace(t)}},"likers.liked":{type:"function",hook:"liked",callback:function(t,e){e===!0?t.addClass("m-liked"):t.removeClass("m-liked")}},created_at:{type:"function",callback:function(t,e){t.html(moment(1e3*e-9e4).fromNow(!0))}},user:{type:"component"},"likers.likers":{type:"collection_items",hook:"likers"},"likers.count":{type:"function",hook:"likers.count",callback:function(t,e){1>e?this.$elemLikesCounter.addClass("m-invisible"):this.$elemLikesCounter.removeClass("m-invisible"),e>0?t.html(e):t.html(t.data("i18n"))}},emotions:{type:"function",hook:"emotions",callback:function(t,e){i.tools.isArray(e)&&(t.html(""),e.forEach(function(e){var n=new u({data:{model:e}});n.view.setSize("small"),-1!==["thumbsup","thumbsdown"].indexOf(n.model.data.name)?t.prepend(n.view.el):t.append(n.view.el)}))}}}}}),o(h)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("UserPublicView",["View"],function(t,e){var n=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e.prototype._getTemplateName=function(){return"bm-book-reader-template"},e}(e);i.tools.mixin(n.prototype,{config:{bindings:{avatar_url:{type:"attr",name:"src"},login:{type:"function",hook:"login",callback:function(t,e){t.attr("href",i.helper.link.user(e))}}}}}),t(n)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){e.define("cipikaInit",["mobileOperatorLandingInit"],function(t,e){e({context:"cipika",special:"cipika",url:"cipika"}),t()})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i,o){e.define("kcellInit",["mobileOperatorLandingInit"],function(t,e){e({context:"kcell",special:"kcell",url:"activ"}),t()})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i){e.define("EmotionComponent",["Component","EmotionView","EmotionModel"],function(t,e,n,o){var r=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments),this.model.data.name&&this.view&&this._updateViewName()},e.prototype._updateViewName=function(){this.model&&this.view&&this.view.setName(this.model.data.name)},e}(e);i.tools.mixin(r.prototype,{config:i.tools.cloneExtend(e.prototype.config,{bundle:{view:n,model:o}})}),t(r)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("ImpressionItemGroup",["Component","ImpressionCollection","ImpressionCollectionView"],function(e,o,r,s){var a=function(e){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,e.apply(this,arguments))}return _inherits(i,e),i.prototype.initialize=function(t){var n=this;e.prototype.initialize.apply(this,arguments),this._fetchByScroll=!1,this.coll.on("fetch-success",function(){n._notify("fetch-success")}),this.view.on("window-scroll",function(){n._onViewScroll()})},i.prototype._onViewScroll=function(){this._fetchByScroll&&!this.coll.empty()&&this._checkIfHasToFetchNextPage()},i.prototype._checkIfHasToFetchNextPage=function(){var e=this.coll.last().view.offset(),i=n(t).scrollTop()+n(t).height();i>e.top-100&&this.coll.fetchNextPage()},i.prototype._onModelChange=function(){e.prototype._onModelChange.apply(this,arguments)},i.prototype._onCollectionChange=function(t,n){this.coll.items.forEach(function(t){t.renderViewWithModelData(),t.update()}),e.prototype._onCollectionChange.apply(this,arguments)},i.prototype.setPaginationByScroll=function(t){var e=this;t?(this._fetchByScroll=!0,this.coll.on("next-page-fetch-start",function(){e.view.loading(!0)}),this.coll.on("next-page-fetch-finish",function(){e.view.loading(!1)}),this.coll.on("all-items-fetched",function(){e.view.el.addClass("m-all-items-fetched")})):(this._fetchByScroll=!1,this.coll.off("next-page-fetch-start"),this.coll.off("next-page-fetch-finish"),this.coll.off("all-items-fetched"))},i}(o);i.tools.mixin(a.prototype,{config:{type:o.Type.GROUP,bundle:{collection:r,view:s},data:{view:{state:{owner:!0,bookBlock:!1}}}}}),e(a)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("ImpressionItem",["Component","ImpressionItemModel","ImpressionItemView","UserPublic","DocumentModel","ImpressionForm","dynamicContent","PopupBase","loginWindow"],function(e,n,o,r,s,a,u,l,c,d){var h=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,e.apply(this,arguments))}return _inherits(n,e),n.prototype.initialize=function(t){e.prototype.initialize.apply(this,arguments),this._compCurrentUser=null,this._form=null,this._dc=null,this._bindEvents(),this._iniDynamicContent(),this.update()},n.prototype.update=function(){this.model&&this.view&&(i.tools.isInstanceOf(this.model.data.document,a)&&this.model.data.document.data.uuid&&(this._updateBookBlock(),this.view&&this.view.updateShareButton(this.model)),i.tools.isInstanceOf(this.model.data.user,s)&&this._updateUserLogin(),this._updateViewProps())},n.prototype._bindEvents=function(){var t=this;this.view.on("like-button-pressed",function(){i.helper.auth.doAfterUserLogin(function(){t.model.toggleLike()})}),this.view.on("edit-request",function(){t.model.isCurrentUserOwner()&&t._showForm()}),this.view.on("remove-request",function(){t.model.isCurrentUserOwner()&&t._deleteImpression()})},n.prototype._deleteImpression=function(){var e,n=this;this.model.data.uuid&&this.view.confirmRemove()&&(e=this.model.data.book_uuid,this.view.updateSpinnerHeight(),this._dc.showStep("loading"),this.view.setControlsVisible(!1),this.model.on("remove-success",function(){t.location.href="/books/"+e,n.model.destroy()}),this.model.remove())},n.prototype._iniDynamicContent=function(){i.tools.isNull(this._dc)&&(this._dc=new l({element:this.view.get$dc()}))},n.prototype._showContent=function(){var t=this;c.setHistoryControlsVisible(!0),this._form.setButtonBackVisible(!1),this._dc.showStep("content",function(){t.view.setControlsVisible(!0)}),this._notify("showing-content")},n.prototype._showForm=function(){i.tools.isNull(this._form)&&this._initForm(),c.setHistoryControlsVisible(!1),this._updateForm(),this._dc.showStep("form"),this._form.setButtonBackVisible(!0),this._form.setMode(u.Mode.EDIT),this._form.focus(),this.view.setControlsVisible(!1),this._notify("showing-form")},n.prototype._initForm=function(){var t=this;i.tools.isNull(this._form)&&(this._form=new u,this._form.on("save-success",function(){t.model.setData(t._form.getModel().json()),t._showContent()}),this._form.on("back-click",function(){t._showContent()}),this.view.appendForm(this._form.getElement()))},n.prototype._updateForm=function(){this._form.getModel().setData(this.model.json())},n.prototype._onModelChange=function(t,n){e.prototype._onModelChange.apply(this,arguments),i.tools.isInstanceOf(n.target,o)?(i.tools.isObject(t)&&i.tools.isPresent(t["likers.liked"])&&(this._toggleCurrentUserAvatarAtLikersList(),this.model.saveLike()),this._updateViewProps()):i.tools.isInstanceOf(n.target,a)&&this._updateBookBlock()},n.prototype._updateViewProps=function(){this.view&&this.model&&(this.view.state={content:!!this.model.data.content})},n.prototype._onCollectionChange=function(t,n){e.prototype._onCollectionChange.apply(this,arguments)},n.prototype._toggleCurrentUserAvatarAtLikersList=function(){i.tools.isNull(this._compCurrentUser)&&(this._compCurrentUser=new s({data:{model:i.user.api4Attributes()}})),this.model.data.likers.liked?this.model.addLiker(this._compCurrentUser):this.model.removeLiker(this._compCurrentUser)},n.prototype._onBundle=function(){e.prototype._onBundle.apply(this,arguments),this.view.initBookBlock(this.model.data.document.json())},n.prototype._onChange=function(){e.prototype._onChange.apply(this,arguments)},n.prototype._updateBookBlock=function(){this.view&&this.view.updateBookBlock(this.model.data.document.json())},n.prototype._updateUserLogin=function(){var t=this.model.data.user.model;this.view.updateLogin(t.nameOrLogin(),t.data.login)},n}(n);i.tools.mixin(h.prototype,{config:i.tools.cloneExtend(n.prototype.config,{bundle:{view:r,model:o}})}),e(h)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("UserPublic",["Component","UserPublicModel","UserPublicView"],function(t,e,n,o){var r=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e}(e);i.tools.mixin(r.prototype,{config:i.tools.cloneExtend(e.prototype.config,{bundle:{model:n,view:o}})}),t(r)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o,r,s){"use strict";var a=function(t,e,i){var o=n(".js-partners-paypal-subscription"),a=n(".js-partners-paypal-payment-description"),u=n(".js-partners-paypal-initial, .js-partners-paypal-payment-description, .js-partners-paypal-response-error"),l=n(".js-partners-paypal-response"),c=new e({preventDefaultLoginBehavior:!0}),d=(new i({useTemplate:!0}),""),h="1month";n("#pp-dropin").on("click",function(){s.track("Subscription Initiated",{type:"month",method:"paypal"})});var p=function(){o.addClass("loading"),n.ajax({url:"/payments/braintree/client_token",method:"POST",error:function(t,e,n){console.log("AJAX Error:",e)},success:function(t,e,i){o.hide(),a.removeClass("hide"),n("#clientToken").val(t.client_token),d=t.client_token,braintree.setup(d,"paypal",{container:"pp-dropin",paymentMethodNonceInputField:"paymentMethodNonce",onSuccess:function(){u.addClass("hidden"),l.removeClass("hidden");var t=n(".js-partners-paypal-response-indicator");t.removeClass("hidden"),n.ajax({url:"/payments/braintree",method:"POST",data:{braintree:{plan:h,payment_method_nonce:n("#paymentMethodNonce").val(),device_data:r.helper.braintree.deviceData()}},error:function(e,i,o){t.addClass("hidden"),"Subscription is already active"==e.responseJSON.errors||"   "==e.responseJSON.errors?n(".js-partners-paypal-response-subscribed").removeClass("hidden"):(l.addClass("hidden"),u.removeClass("hidden"),n(".js-partners-paypal-payment-description").addClass("hidden"),n(".js-partners-paypal-response-error").removeClass("hidden")),console.log("AJAX Error:",i,o,e.responseJSON)},success:function(e,i,o){s.track("Subscription Successful",{type:"month",method:"paypal",payment_type:"paypal"}),t.addClass("hidden"),n(".js-partners-paypal-response-success").removeClass("hidden")}})}})}})};r.user.isUserPresent()&&p(),o.on("click",function(){r.user.isUserPresent()||(c.showWindow(),c.on("authenticationSuccessful",function(){p()}))}),t()};o.define("partnersPayPalSubscription",["loginWindow","paymentPopup"],a)}(this,this.document,this.jQuery,this.radio,this.modules,this.BM=this.BM||{},this.DIMixpanel),function(t,e,n){e.define("partnerProfitrollyAnalytics",[],function(t){n.track("Almost Ready Page Shown"),t()})}(this,this.modules,window.DIMixpanel),function(t,e,n,i){e.define("partnerProfitrollyFormVisa",["paymentPopup/visa"],function(e){var o=n.custom.popupPaymentFormVisa;n.widget("custom.partnerProfitrollyFormVisa",o,{_sendRequestSubscribe:function(){this._setFormWait(!0),this._sendGAEventPaymentButtonPress();var t=this;n.ajax({type:"post",url:"/payments/braintree",data:this._getPostData(),dataType:"json",success:function(e){t._onSubscribeSuccess(e)},error:function(e){t._handleSubscribeError(e.responseJSON)}})},_onSubscribeSuccess:function(){n.ajax({type:"post",url:"/payments/promo/use_v2",dataType:"json",success:function(){i&&i.track("Subscription Successful",{method:"code",payment_type:"code",type:"month",context:""}),setTimeout(function(){t.location.href="/"},150)},error:function(){this._setFormWait(!1)}})}}),e()})}(this,this.modules,this.jQuery,this.DIMixpanel),function(t,e,n){var i=function(e,i,o,r,s){$(t),$(t.document.body);n("partner-profitrolly-slide-second-request").subscribe(function(){$.scrollTo(r.getElement(),500)})};e.define("profitrollyInit",["partnerProfitrollyLayout","partnerProfitrollySlideFirst","partnerProfitrollySlideSecond","partnerProfitrollyAnalytics"],i)}(this,this.modules,this.radio),function(t,e){var n=function(e){var n=$(t),i=$(t.document.body),o=($(".bm-layout-profitrolly"),$(".bm-layout-header")),r=$(".bm-layout-footer"),s=$("@partner-profitrolly-slide-first"),a=$("@partner-profitrolly-slide-second"),u="partner-psycho-"+(new Date).getTime(),l=1.5,c=function(){var t=n.height(),e=o.height(),i=r.height(),u=t-e,l=t-i-56;s.height(u),s.css("line-height",u+"px"),a.css("min-height",l+"px")},d=function(){var t=s.width(),e=s.height();t/e>=l?s.removeAttr("data-bg-pos"):s.attr("data-bg-pos","ver")},h=function(){i.addClass("visible")},p=function(){n.on("resize."+u,function(){c(),d()})};$(function(){p(),c(),d(),h()}),e()};e.define("partnerProfitrollyLayout",[],n)}(this,this.modules),function(t,e,n){e.define("partnerProfitrollySlideFirst",[],function(e){var i=($(t),$("@partner-profitrolly-slide-first")),o=i.find("@slide-content"),r=function(){o.on("click",s)},s=function(){n("partner-profitrolly-slide-second-request").broadcast()};r(),e()})}(this,this.modules,this.radio),function(t,e,n){e.define("partnerProfitrollySlideSecond",["partnerProfitrollyFormVisa"],function(t,e){var n=$("@partner-profitrolly-slide-second"),i=$("@partner-profitrolly-form-visa"),o=function(){return n};i.partnerProfitrollyFormVisa();var r=i.data("custom-partnerProfitrollyFormVisa");r.setCurrentPlan("1month"),r.setAuthToken($("[name=authenticity_token]").val()),t({getElement:o})})}(this,this.modules,this.radio),function(t,e,n,i,o){e.define("tMobileInit",["mobileOperatorLandingInit"],function(t,e){e({context:"t-mobile",special:"t-mobile",url:"t-mobile",showPassword:!1}),t()})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i,o){e.define("initUlmartRecurringPaywallPageAnalytics",[],function(t){t()})}(this,this.modules,this.jQuery,this.DIMixpanel,this.docCookies),function(t,e,n,i){e.define("initUlmartRecurringPaywallFormVisa",["paymentPopup/visa"],function(e){var i=n.custom.popupPaymentFormVisa;n.widget("custom.discountFormVisa",i,{_getPostData:function(){var t={authenticity_token:this._getAuthToken(),braintree:{plan:this._getCurrentPlan(),number:this._braintreeHandler.encrypt(this._getInputCardNumberValue()),month:this._braintreeHandler.encrypt(this._getInputCardMonthValue()),year:this._braintreeHandler.encrypt(this._getInputCardYearValue()),cvv:this._braintreeHandler.encrypt(this._getInputCardCVVValue()),device_data:BM.helper.braintree.deviceData()}};return n.param(t)},_sendRequestSubscribe:function(){this._setFormWait(!0),this._sendGAEventPaymentButtonPress();var t=this;n.ajax({type:"post",url:"/payments/braintree",data:this._getPostData(),dataType:"json",success:function(e){t._onSubscribeSuccess(e),t.element.trigger("subscription_success")},error:function(e){t._handleSubscribeError(e.responseJSON),t.element.trigger("subscription_failed")}})},_onSubscribeSuccess:function(e){e.redirect_to?t.location.href=e.redirect_to:t.location.href="/library"},getElement:function(){return this.element}}),e(function(t){return t.discountFormVisa(),t.data("custom-discountFormVisa")})})}(this,this.modules,this.jQuery,this.DIMixpanel),function(t,e,n,i){e.define("initUlmartRecurringPaywallPage",["initUlmartRecurringPaywallFormVisa","initUlmartRecurringPaywallPageAnalytics"],function(t,e){var o=e(n("@bm-form-visa-standalone")),r=o.getElement();r.on("subscription_failed",function(){i.track("Subscription Failed")}),r.on("subscription_success",function(){i.track("Subscription Successful")}),o.setCurrentPlan("1monthUlmartSap"),o.setAuthToken(n("[name=authenticity_token]").val()),t()})}(this,this.modules,this.jQuery,this.DIMixpanel),function(t,e,n,i){e.define("quotesListPageInit",["extend","PubSub","moduleQuote","moduleQuoteGroup"],function(e,o,r,s,a){var u=o(r),l=u,c=l.superclass,d=n(t);i.tools.mixin(l.prototype,{initialize:function(t){c.initialize.apply(this,arguments),this.$elem=t.element,this.$elemSpinner=this.$elem.find("@bm-quotes-list-page-spinner"),this.$elemItemsWrapper=this.$elem.find("@bm-quotes-list-page-items-wrapper"),this.$elemEmpty=this.$elem.find("@bm-quotes-list-page-empty"),this._groupes=[],this._guoteGroupsPageNumber=1,this._quoteGroupsPerPage=7,this._allQuotesFetched=!1,this._firstTimeFetched=!0,this._fetchQuotes()},_fetchQuotes:function(){if(this._areAllQuotesFetched())return void this.$elem.removeClass("m-wait");var t=this;n.ajax({url:this._getGroupedQuotesUrl(),dataType:"json",type:"get",success:function(e){t._onQuotesFetchSuccess(e)},error:function(){t._onQuotesFetchError()}})},_stopFetchingQuotes:function(){this._allQuotesFetched=!0,d.off("scroll."+this.getInstanceId())},_getGroupedQuotesUrl:function(){return"/a/4/u/"+i.user.getViewingUserLogin()+"/m/grouped.json?only_public="+this._showOnlyPublicQuotes()+"&p="+this._guoteGroupsPageNumber+"&pp="+this._quoteGroupsPerPage},_showOnlyPublicQuotes:function(){return!1},_onQuotesFetchSuccess:function(t){this.$elem.removeClass("m-wait"),this._firstTimeFetched?this._isResponseEmpty(t)?this._showMessageEmpty():(t.length<this._quoteGroupsPerPage&&(this._allQuotesFetched=!0),this._processGroups(t),this._showQuotes()):this._isResponseEmpty(t)?this._allQuotesFetched=!0:(t.length<this._quoteGroupsPerPage&&(this._allQuotesFetched=!0),this._processGroups(t),this._showQuotes()),this._firstTimeFetched=!1},_isResponseEmpty:function(t){return i.tools.isArray(t)&&0===t.length||i.tools.isArray(t)&&t[0]&&i.tools.isArray(t[0].objects)&&0===t[0].objects.length},_onQuotesFetchError:function(){var t=this;setTimeout(function(){t._fetchQuotes()},5e3)},_showMessageError:function(){this._showMessageEmpty()},_showMessageEmpty:function(){var t=this;this.$elemSpinner.addClass("m-hidden"),setTimeout(function(){t.$elemEmpty.addClass("m-visible")},300)},_showQuotes:function(){var t=this;this.$elemSpinner.addClass("m-hidden"),setTimeout(function(){t.$elemItemsWrapper.addClass("m-visible")},300)},_processGroups:function(t){var e=this;this._processGroupEls=[],i.tools.isArray(t)&&t.forEach(function(t){e._processGroup(t)}),this.$elemItemsWrapper.append(this._processGroupEls)},_processGroup:function(t){i.tools.isObject(t)&&i.tools.mixin(t,{context:"user"});var e=new a(t);this._groupes.push(e),this._processGroupEls.push(e.getElement());
},checkForNextPageFetch:function(){var t=this.getLastGroup();i.tools.isNull(t)||d.height()+d.scrollTop()>t.getElement().offset().top&&(this.$elem.addClass("m-wait"),this._guoteGroupsPageNumber+=1,this._fetchQuotes())},getLastGroup:function(){return this._groupes.length<1?null:this._groupes[this._groupes.length-1]},_areAllQuotesFetched:function(){return this._allQuotesFetched===!0}});var h,p=new u({element:n("@bm-quote-list-page")});d.on("scroll."+p.getInstanceId(),function(t){clearTimeout(h),h=setTimeout(function(){p.checkForNextPageFetch()},300)}),e(u)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("quoteItemPageInit",["extend","moduleQuote"],function(t,e,i){var o=n("@bm-quote");new i({element:o,components:{link:!1,likeSimple:!1}});t()})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){"use strict";n.define("ActivityLoader",["LibraryCardStory","DocumentReadStory","MarkerStory","BookshelfDocumentStory","BookshelfStory","moduleQuoteGroup","ImpressionItemGroup","BookBlockListItemGroup"],function(n,r,s,a,u,l,c,d,h){var p=e(t),f=_.once(function(){var e="/feed/friends"===t.location.pathname?"feed":"superfeed";o.track("Feed Shown",{context:e})}),m=function(t,n){var o=this;o.$b=t,o.displayedIds=[],o.storiesToDisplay=[],o.loadStoriesButton=e("@activity-loadmore"),o.$empty=e(".bm-activity-empty"),o.Stories={library_card:r,document_read:s,marker:a,bookshelf_document:u,bookshelf:l,document_impression:"document_impression"},o.options=n||{},o.p=o.options.p||0,o.pp=o.options.pp||15,o.feedSourceUrl=o.options.feedSourceUrl||"/a/4/u/"+i.user.getLogin()+"/a/subscribed.json",o.useLocale=o.options.useLocale||!1,o.isExploreFeed=o.feedSourceUrl.indexOf("explore.json")>-1,o.initialPollingDelay=1e3,o.pollingInterval=5,o.pollingRetries=1,o.replaceableNode=[],o.$spinnerWrapper=e(".bm-spinner-wrapper"),o.bt=o.$b.offset().top,o.preventPaging,o.init()};m.prototype={init:function(){var t=this;t._loadNextPage(function(){p.on("scroll",function(){!t.preventPaging&&p.scrollTop()>t.bt+t.$b.height()/2&&t._loadNextPage()})}),t.loadStoriesButton.on("click",function(){t._drawStories(t.storiesToDisplay,"prepend"),t.storiesToDisplay=[],t._updateNewStoryCounter()}),t.isExploreFeed||setTimeout(function(){t._setupPolling()},t.initialPollingDelay)},makeReplaceable:function(t){this.replaceableNode=t},_moveRepalceableNode:function(){var t=this;t.displayedIds.length>2&&t.replaceableNode.length>0&&t.replaceableNode.insertAfter(t.$b.children().eq(1))},_setupPolling:function(){var t=this,e=1e3*t.pollingInterval;t.pollingRetries>14&&(t.pollingRetries=14);var n=10;t.pollingRetries>n&&(e=1e3*Math.pow(t.pollingInterval,t.pollingRetries-n)),setTimeout(function(){t._loadNewStories(),t._setupPolling()},e)},_updateNewStoryCounter:function(){var t=this,e=t.storiesToDisplay.length;e>0?t.loadStoriesButton.removeClass("hidden"):t.loadStoriesButton.addClass("hidden")},_drawStories:function(t,e){var n=this;if(t.length>0){n.preventPaging=!1,f();var i=0===n.displayedIds.length;t.forEach(function(t){var i,o=n.Stories[t.type];n.displayedIds.push(t.id),o&&(i=o===a?new c(n._prepareQuotesGroupConfig(t)).getElement():"document_impression"===o?n._initImpressionGroup(t).view.el:new o(t).getInstance(),"prepend"===e?n.$b.prepend(i):n.$b.append(i))}),("prepend"===e||i)&&n._moveRepalceableNode()}else 1===n.p&&n.$empty.removeClass("hidden")},_prepareQuotesGroupConfig:function(t){var e={count:t.resources.length,objects:t.resources};return e},_prepareListItemGroupConfig:function(t){var e={count:t.resources_size,objects:t.resources,url:"/a/4/a/"+t.id+"/resources.json"};return e},_initImpressionGroup:function(t){var e=this._prepareImpressionGroupConfig(t),n=new d(e);return n.coll.items[n.coll.items.length-1].view.state={book:!0},n},_prepareImpressionGroupConfig:function(t){return{data:{collection:{items:t.resources,pagination:{p:1,pp:5}}}}},_filterNewStories:function(t){var e=this;if(t.length>0){var n=e.storiesToDisplay.length,i=e.storiesToDisplay.map(function(t){return t.id});t.forEach(function(t){-1===e.displayedIds.indexOf(t.id)&&-1===i.indexOf(t.id)&&e.storiesToDisplay.push(t)}),n<e.storiesToDisplay.length?e.pollingRetries=1:e.pollingRetries++,e._updateNewStoryCounter()}},_loadNewStories:function(t){var n=this,o={};o.p=1,o.pp=n.pp,n.useLocale&&(o.lang=i.user.getLocale()),e.ajax({url:n.feedSourceUrl,data:o,method:"get",success:function(e){n._filterNewStories(e),t&&t()}})},_loadNextPage:function(t){var n=this,o={};++n.p,n.preventPaging=!0,n.$spinnerWrapper.removeClass("hidden"),o.p=n.p,o.pp=n.pp,n.useLocale&&(o.lang=i.user.getLocale()),e.ajax({url:n.feedSourceUrl,data:o,method:"get",success:function(e){n._drawStories(e,"append"),n.$spinnerWrapper.addClass("hidden"),t&&t()}})}},n(m)})}(this,this.jQuery,this.modules,this.BM,this.DIMixpanel),function(t,e,n,i){"use strict";i.define("BaseStory",[],function(e){var n={};n.prototype={initialize:function(t,e){var n=this;n.$b,n.options=e||{},n.resourceLimit=n.options.resourceLimit||3,n.storyItemProcessor,n.dataParser,n.storyData=t,n._createItemProcessor(),n._createDataParser(),n._prepareData(),n._initStoryBlock()},getInstance:function(){return this.$b},_createItemProcessor:function(){},_createDataParser:function(){},_prepareData:function(){var t=this;t.dataParser&&(t.storyData=t.dataParser.parse(t.storyData))},_initStoryBlock:function(){var e=this,n=t.location.pathname.indexOf("explore")>=0?"superfeed":"feed";if(Array.isArray(e.storyData)){e.$b=[];for(var i=0;i<e.storyData.length;i++)e.storyData[i].discovered=n,e.$b[i]=e.storyItemProcessor.getItem(e.storyData[i])}else e.storyData.discovered=n,e.$b=e.storyItemProcessor.getItem(e.storyData)}},e(n)})}(this,this.document,this.jQuery,this.modules),function(t,e,n,i,o){"use strict";n.define("BaseStoryItemProcessor",["ActivistItemProcessor","Pluralizer","BookBlockListItem"],function(n,r,s,a){var u={};u.prototype={initialize:function(t){var e=this;e.options=t||{},e.templateFactory,e.resourceItemProcessor,e.activistItemProcessor=r,o.locale(i.config.mainConfig.locale),e._createTemplateFactory(),e._setResourceItemProcessor(),e._postInit()},_createTemplateFactory:function(){},_setResourceItemProcessor:function(){},_postInit:function(){},baseItemInit:function(t,n){for(var r=this,u=(i.helper.event.clickName(),t.find(".bm-activity-activists-wrapper")),l=0;l<n.activists.length;l++)u.append(r.activistItemProcessor.getItem(n.activists[l],0===l,n.activists_size-1)),n.activists_size-1>0&&l!==n.activists.length-1&&u.append("<em>, </em>");var c=t.find(".bm-activity-update-time-timestamp");c.html(o(1e3*n.last_activity_at-9e4).fromNow(!0)),c.parent().removeClass("hidden");for(var d=t.find(".bm-activity-resources"),h=0;h<n.resources.length;h++){var p,f=n.resources[h];"d"===f.type?p=new a(r._getListItemConfig(f)).getElement():(f.discovered=n.discovered,p=r.resourceItemProcessor.getItem(f)),d.append(p)}if(n.resources_size>3){var m=t.find(".bm-activity-more"),g=m.find(".bm-activity-more-count"),b=m.find(".bm-activity-more-books"),_=n.resources_size-3;g.html(_),b.html(b.data(s.pluralize(_))),m.removeClass("hidden"),m.on("click",function(t){t.preventDefault(),m.addClass("loading"),e.ajax({url:"/a/4/a/"+n.id+"/resources.json",success:function(t){for(var e=t.slice(3),n=0;n<e.length;n++){var i,o=e[n];i="d"===o.type?new a(r._getListItemConfig(o)).getElement():r.resourceItemProcessor.getItem(o),d.append(i)}m.addClass("hidden")}})})}},_getListItemConfig:function(t){return i.tools.mixin(t,{components:{readers:!1,owner:!1},openDocumentPopup:!0,mixpanel_ctx:this._getFeedType()})},_getFeedType:function(){return t.location.pathname.indexOf("explore")>=0?"superfeed":"feed"}},n(u)})}(this,this.jQuery,this.modules,this.BM,this.moment),function(t,e,n,i){e.define("DocumentModel",["Model","LibraryCardModel"],function(t,e,n){var o=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e}(e);i.tools.mixin(o.prototype,{data:{uuid:"string",annotation:"string",authors:"string",book_uuid:"string",can_be_read:"boolean",cover:{height:"number",url:"string",width:"number"},external_links:[],labels:[],lang:"string",likers:[],paper_pages:"number",rights:{downloadable:"string",full_reading:"string",has_preview:"string"},size_approx:"number",subscription_level:"string",tags:[],title:"string",type:"string",lc:n,impressions_count:"number"}}),t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("EmotionModel",["Model"],function(t,e){var n=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e}(e);i.tools.mixin(n.prototype,{data:{name:"string",label:"string",unicode:"string",color:"number",image_url:"string",stucked:"string"}}),t(n)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("ImpressionModel",["Model","UserPublic","UserCollection","DocumentModel"],function(t,e,o,r,s){var a=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e.prototype.toggleLike=function(){var t=this.data.likers.count,e=!this.data.likers.liked;t=Math.max(0,e?t+1:t-1),this.setData({likers:{count:t,liked:e}})},e.prototype.addLiker=function(t){i.tools.isComponent(t)&&this.data.likers.likers.unshift(t)},e.prototype.removeLiker=function(t){i.tools.isComponent(t)&&this.data.likers.likers.eject(function(e){return e.model.data.login===t.model.data.login})},e.prototype.saveLike=function(){var t=this.data.likers.liked,e=t?"post":"delete",i=this._fillUrlWithParams(this.url.UPDATE)+"/likers",o=function(){this.unlock("likes"),t&&DIMixpanel.track("Like Button Pressed",{context:"impression"})}.bind(this);this.lock("likes"),n.ajax({type:e,dataType:"json",url:i,success:o,error:o})},e.prototype.isCurrentUserOwner=function(){return i.user.present()&&this.data.user.model.data.login===i.user.login()},e.prototype.emotionsAsString=function(){var t=this.data.emotions.map(function(t){return t.unicode+" "+t.label});return t.join(", ")},e.prototype.emotionsLablesAsString=function(){var t=this.data.emotions.map(function(t){return t.label});return t.join(", ")},e.prototype._onSaveSuccess=function(t){this.setData(t)},e.prototype._getSaveData=function(){var e=this.data.emotions;return e.length>0&&!i.tools.isString(e[0])&&(e=e.map(function(t){return t.name})),i.tools.mixin(t.prototype._getSaveData.call(this),{impression:{document_uuid:this.data.document_uuid,content:this.data.content,emotions:e}})},e.prototype._onModelChange=function(e,n){t.prototype._onModelChange.apply(this,arguments),i.tools.isInstanceOf(n.target,s)},e}(e);i.tools.mixin(a.prototype,{data:{type:"string",uuid:"string",emotions:[],likers:{count:"number",liked:"boolean",likers:r},user:o,content:"string",created_at:"number",book_uuid:"string",document_uuid:"string",document:s},url:{GET:"/a/4/d/impressions/:uuid?embed_document=true&embed_likers=10",CREATE:"/a/4/d/impressions",UPDATE:"/a/4/d/impressions/:uuid",DELETE:"/a/4/d/impressions/:uuid"}}),t(a)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("LibraryCardModel",["Model"],function(t,e){var n=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e}(e);i.tools.mixin(n.prototype,{data:{accessed_at:"number",chapter:"string",created_at:"number",fragment:"string",is_public:"boolean",is_uploaded:"boolean",progress:"number",started_at:"number",state:"string",sync_counter:"number",updated_at:"number",uuid:"string"}}),t(n)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("UserPublicModel",["Model"],function(t,e){var n=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e.prototype.nameOrLogin=function(){return this.data.name?this.data.name:this.data.login},e}(e);i.tools.mixin(n.prototype,{data:{type:"string",login:"string",gender:"string",avatar_url:"string",name:"string",about:"string",site:"string",bookshelves_count:"number",following_bookshelves_count:"number",library_cards_count:"number",following:"number"}}),t(n)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("UserModel",["Model"],function(t,e){var n=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e}(e);i.tools.mixin(e.prototype,{data:{}}),t(n)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){e.define("mobileOperatorLandingInit",["loginWindow","SocialCounters","mobileOperatorInputSubmit","appLandingSetup","appLandingIpad","appLandingSlider"],function(e,r,s){var a=function(e){var a=e.context,u=e.special,l=e.url,c=e.showPassword,d=void 0===c?!1:c,h=null,p=null,f="phone",m=n("@partners-phone-form"),g=n("@partners-phone-input"),b=g.find("input"),_=n("@partners-code-input"),y=(_.find("input"),n("@step-phone")),v=n("@step-code"),w=n("@step-success"),k=n("@partners-phone-error"),C=n("@partners-code-error"),S=n("@partners-scroll-top"),x=n("@partners-scroll-top-wrapper"),E=n("@partners-auth"),P=n("@partners-resend-button"),T=n("@partners-resend-text"),I=(n("@sticky-block"),n("@bm-social-counters")),A=n("@partners-bottom-app-buttons"),B=n("@partners-login-password"),O=n("@partners-login"),M=n("@partners-password"),$=n(".partners-phone-country-code").text(),D=$.replace("+",""),R=function(){return"phone"===f},L=function(){return"code"===f},F=function(){return"success"===f},N=function(){f="phone",V(null),v.addClass("hidden"),y.removeClass("hidden"),T.addClass("hidden")},j=function(){f="code",V(null),y.addClass("hidden"),v.removeClass("hidden"),_.find("input").val("").focus(),o.track("Phone Confirmation Screen Shown",{special:u})},U=function(t){var e=t.login,n=t.password;f="success",z(1),w.removeClass("hidden"),A.removeClass("hidden"),x.addClass("hidden"),O.html(e),M.html(n),o.track("Get Subscription Successful",{special:u})},V=function(t){t?(R()?k.text(t).removeClass("hidden"):C.text(t).removeClass("hidden"),o.track("Get Subscription Failed",{special:u,reason:t})):(k.text("").addClass("hidden"),C.text("").addClass("hidden"))},H=function(e){if(e||(e=R()?"phone":"code"),V(null),!F()){var i=b.val(),r=i.replace(/\s+/g,"");h=D+r,p=_.data("custom-inputSubmit")._value,n.ajax({url:"phone"===e?"/"+l+"/check_number.json":"/"+l+"/validate_code.json",type:"POST",data:"phone"===e?{number:h}:{number:h,code:p},success:function(e){switch(e.action){case"show_phone_page":N();break;case"show_code_page":j();break;case"show_success_page":U(e);break;case"redirect_with_informer":t.location.replace("/library?subscription_exist=true");break;case"redirect_without_informer":t.location.replace("/library")}},error:function(t){console.log("err",t);var e=t.responseJSON&&t.responseJSON.error||"error";V(e)}}),R()&&o.track("Get Subscription Initiated",{special:u}),L()&&o.track("Confirmation Code Entered",{special:u})}},z=function(){var t=arguments.length<=0||void 0===arguments[0]?300:arguments[0];n("body, html").animate({scrollTop:0},t,"easeInOutQuad")},q=new r({context:a,preventDefaultLoginBehavior:!0}),W=function(){var e=new s({context:a,element:I});e.setConfig({url:""+t.location.origin+t.location.pathname+"?lang="+i.user.getLocale()})},Q=m.data("phone-number");Q.length>0&&0===Q.indexOf($)?phoneNumberFromHeader=Q.replace($,""):phoneNumberFromHeader=Q,g.find("input").val(phoneNumberFromHeader),g.inputSubmit(),_.inputSubmit(),q.on("authenticationSuccessful",function(){t.location.replace("/library")}),m.on("submit",function(t){t.preventDefault(),H()}),S.on("click",function(t){z()}),P.on("click",function(t){H("phone"),T.removeClass("hidden"),_.find("input").val("").focus()}),E.on("click",function(e){i.user.isUserPresent()?t.location.replace("/library"):q.showWindow("inital")}),b.on("focus",function(t){L()&&N(),!g.data("custom-inputSubmit")._value}),n("@appld-install").on("click",function(){var t=n(this).data("platform")||"none";o.track("Install App Button Pressed",{app:t,context:a})}),n(t).on(i.tools.client.isMobile()?"orientationchange":"resize",function(){t.setSize()}),W(),o.track("Mobile Operator Number Set",{context:a,phone_number:phoneNumberFromHeader}),d&&B.removeClass("hidden")};e(a)})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i,o){e.define("moduleBooktiqueCookieInformer",["baseView","extend"],function(t,e,n){var r=n(e),s=r,a=s.superclass;i.tools.mixin(s.prototype,{initialize:function(t){a.initialize.apply(this,arguments),this.$elem&&(this.$elemButtonClose=this.$elem.find("@bm-starhub-cookie-informer-button-close"),this._setupEvents())},_setupEvents:function(){var t=this,e=i.tools.client.isTouch()?i.tools.client.touchEvent:"click";this.$elemButtonClose.on(e,function(){t.hide()})},hide:function(){this.$elem.height(this.$elem.height()),this.$elem.get(0).offsetHeight,this.$elem.attr("data-visible","false"),this.$elem.height(0),o.setItem("bm_starhub_cookie_informer_closed","1",2592e3,"/")}}),t(r)})}(this,this.modules,this.jQuery,this.BM,this.docCookies),function(t,e,n,i){e.define("moduleBooktiqueFaq",["baseView","extend"],function(t,e,n){var o=n(e),r=o,s=r.superclass;i.tools.mixin(r.prototype,{initialize:function(t){s.initialize.apply(this,arguments),this.$elem&&(this.$elemButtonClose=this.$elem.find("@bm-booktique-button-close"),this._setupEvents())},_setupEvents:function(){var t=this,e=i.tools.client.isTouch()?i.tools.client.touchEvent:"click";this.$elemButtonClose.on(e,function(){t.hide()})},show:function(){this.$elem.attr("data-visible","true"),this.$elem.get(0).scrollTop=0,this._notify("show")},hide:function(){this.$elem.removeAttr("data-visible"),this._notify("hide")}}),t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("moduleBooktiqueForm",["baseView","extend","moduleFormCheckboxLight","dynamicContent"],function(t,e,o,r,s){var a=o(e),u=a,l=u.superclass;i.tools.mixin(u.prototype,{initialize:function(t){l.initialize.apply(this,arguments),this.$elem&&(this.$elemInputName=this.$elem.find("@bm-booktique-form-input-name"),this.$elemInputEmail=this.$elem.find("@bm-booktique-form-input-email"),this.$elemCheckboxAgreement=this.$elem.find("@bm-booktique-form-checkbox-agreement"),this.$elemSubmit=this.$elem.find("@bm-booktique-form-submit"),this.$elemDynamicContent=this.$elem.find("@bm-booktique-form-dynamic-content"),this.$elemErrorMessage=this.$elem.find("@bm-booktique-form-error-message"),this._checkboxAgreementHandler=null,this._formErrors=[],this._dynamicContent=null,this._initCheckbox(),this._initDynamicContent(),this._setupEvents())},_initCheckbox:function(){null===this._checkboxAgreementHandler&&(this._checkboxAgreementHandler=new r({element:this.$elemCheckboxAgreement}))},_initDynamicContent:function(){null===this._dynamicContent&&(this._dynamicContent=new s({element:this.$elemDynamicContent}))},_setupEvents:function(){var t=this,e=i.tools.client.isTouch()?i.tools.client.touchEvent:"click";this.$elemInputName.on("keyup",function(e){t._onInputNameKeyUp(e)}),this.$elemInputEmail.on("keyup",function(e){t._onInputEmailKeyUp(e)}),this.$elemSubmit.on(e,function(){t._onFormSubmit()})},_onInputNameKeyUp:function(t){13===t.keyCode&&this._onFormSubmit()},_onInputEmailKeyUp:function(t){13===t.keyCode&&this._onFormSubmit()},_onFormSubmit:function(){this._isFormValid()?this._sendRequest():this._displayErrors()},_sendRequest:function(){var t=this;this.disable(),n.ajax({url:"/partners/starhub_lucky_emails.json",type:"post",dataType:"json",data:{email:this._getInputEmailValue(),name:this._getInputNameValue()},success:function(e){t._onRequestSuccess(e)},error:function(e){t._onRequestError(e)}})},_onRequestSuccess:function(t){this._notify("request-success")},_onRequestError:function(t){var e;t&&t.responseJSON&&t.responseJSON.errors&&(t.responseJSON.errors.email?e=t.responseJSON.errors.email:t.responseJSON.errors.name&&(e=t.responseJSON.errors.name),this._showErrorMessage(e),this._notify("request-error",e)),this.enable()},_displayErrors:function(){this._formErrors.forEach(function(t){t.unbindAnimationEnd(),t.animationEnd(function(){t.removeAttr("data-error")}),t.attr("data-error","true")})},_isFormValid:function(){return this._clearFormErrors(),this._isInputNameValid()||this._formErrors.push(this.$elemInputName),this._isInputEmailValid()||this._formErrors.push(this.$elemInputEmail),this._isCheckboxAgreementChecked()||this._formErrors.push(this.$elemCheckboxAgreement),0===this._formErrors.length?!0:void 0},_getInputNameValue:function(){return this.$elemInputName.val()},_getInputEmailValue:function(){return this.$elemInputEmail.val()},_clearFormErrors:function(){this._formErrors.length=0,this._formErrors=[]},_isInputNameValid:function(){return this.$elemInputName.val().length>0},_isInputEmailValid:function(){return/[^\s@]+@[^\s@]+\.[^\s@]+/.test(this.$elemInputEmail.val())},disable:function(){this.$elemInputName.attr("disabled","disabled"),this.$elemInputEmail.attr("disabled","disabled"),this.$elemSubmit.attr("disabled","disabled"),this.$elemSubmit.attr("data-wait","true"),this._checkboxAgreementHandler.disable()},enable:function(){this.$elemInputName.removeAttr("disabled"),this.$elemInputEmail.removeAttr("disabled"),this.$elemSubmit.removeAttr("disabled"),this.$elemSubmit.removeAttr("data-wait"),this._checkboxAgreementHandler.enable()},_isCheckboxAgreementChecked:function(){return this._checkboxAgreementHandler.isChecked()},_showErrorMessage:function(t){t&&(this.$elemErrorMessage.html(t),this._dynamicContent.showStep("error"))}}),t(a)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){e.define("initBooktiquePage",["dynamicContent","moduleBooktiqueForm","moduleBooktiqueFaq","moduleBooktiqueCookieInformer"],function(t,e,r,s,a){var u=n(document.body),l=n("@bm-booktique-form"),c=new r({element:l}),d=n("@bm-booktique-button-show-faq"),h=n("@bm-booktique-faq"),p=new s({element:h}),f=n("@bm-starhub-cookie-informer"),m=(new a({element:f}),new e({element:n("@bm-booktique-dynamic-content")}));c.on("request-success",function(){o.track("Get Subscription Successful",{special:"starhub"}),m.showStep("success"),n.scrollTo(0,300)}),c.on("request-error",function(t){t&&i.tools.isArray(t)&&(t=t[0]),o.track("Get Subscription Failed",{special:"starhub",reason:t})}),setTimeout(function(){n("[data-animation=true]").removeAttr("data-animation")},2500);var g=i.tools.client.isTouch()?i.tools.client.touchEvent:"click";d.on(g,function(){o.track("FAQ Button Pressed"),p.show()}),p.on("show",function(){u.css("overflow","hidden")}),p.on("hide",function(){u.css("overflow","")}),t()})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i,o,r){i.define("bmSocialConnect",["extend","PubSub"],function(e,n,i){var r=n(i),s=r.superclass,a=r;BM.tools.mixin(r.prototype,{initialize:function(){s.initialize.apply(this,arguments),this._fbLink="/auth/facebook",this._connectWindowFacebook,this._twLink="/auth/twitter",this._connectWindowTwitter,this._vkLink="/auth/vkontakte",this._connectWindowVkontakte},_setCookie:function(){var e=t.location.pathname+t.location.search;o.setItem("return_to",e,1800,"/")},facebook:function(e){var n=screen.width/2-300,i=screen.height/2-130;return this._connectWindowFacebook=t.open(this._fbLink,"","width=600,height=260,top="+i+",left="+n),this._redefineGetPubSubInstanceProp(),this._setCookie(),this._connectWindowFacebook},twitter:function(e){var n=screen.width/2-380;return this._connectWindowTwitter=t.open(this._twLink,"","width=760,height=380,left="+n),this._redefineGetPubSubInstanceProp(),this._setCookie(),this._connectWindowTwitter},vkontakte:function(e){var n=screen.width/2-350,i=screen.height/2-150;return this._connectWindowVkontakte=t.open(this._vkLink,"","width=700,height=300,top="+i+",left="+n),this._redefineGetPubSubInstanceProp(),this._setCookie(),this._connectWindowVkontakte},_redefineGetPubSubInstanceProp:function(){var e=new i;e.on("authenticationSuccessful",function(t,e,n){this._notify("authenticationSuccessful",t,e,n)}.bind(this)),t.pubSub=e,t.SocialConnectPubSub=e}}),e(a)})}(this,this.document,this.jQuery,this.modules,this.docCookies,this.DIMixpanel),function(t,e,n,i){e.define("blockAboutSubscription",["paymentPopup"],function(t,e){t({init:function(t){var i=BM.tools.domHelper.tojQueryObject(t)||n("@bm-block-about-subscription"),o=i.find("@button-subscribe"),r=new e({useTemplate:!0});o.on("click",function(){r.show()})}})})}(this,this.modules,this.jQuery,this.DIMixpanel),function(t,e,n,i){"use strict";e.define("blockCollectEmail",[],function(t){var e={BLOCK_SWITCH:1,ATTRIBUTE:2},o={INIT:"init",WAIT:"wait",SUCCESS:"success",ERROR:"error"};t({StepMode:e,init:function(t,r){var s=t?BM.tools.domHelper.tojQueryObject(t):n("@block-collect-email");if(s&&0!==s.length){var a=s.find("@bm-notification-email-step"),u=s.find("@bm-notification-submit"),l=s.find("@bm-notification-email-input"),c=s.find("@bm-notification-email-resend"),d=s.find("@bm-form-collect-email-message-error"),h=null,p=e.BLOCK_SWITCH;r&&r.stepMode&&(p=r.stepMode);var f=function g(t){p===p.BLOCK_SWITCH?(a.removeClass("active"),a.filter("@step-"+t).addClass("active")):p===e.ATTRIBUTE&&s.attr("data-active-state",t),clearTimeout(h),t===o.ERROR&&(h=setTimeout(function(){r&&r.autoHideError&&g(o.INIT)},2e3))},m=function(){var t="/a/4/u/"+l.data("login")+".json",e=l.val();return""==e?0:void n.ajax({url:t,type:"PUT",data:{user:{email:e}},beforeSend:function(){f(o.WAIT)},success:function(t){i("collect-email-success").broadcast();var n=a.filter("@step-success"),r=n.html().replace(/{{email}}/,e);n.html(r),f(o.SUCCESS)},error:function(t){if(d.length>0)try{d.html(t.responseJSON.error.messages.user.new_email[0])}catch(e){}f(o.ERROR)}})};u.click(function(){m()}),l.keypress(function(t){13==t.which&&m()}),c.live("click",function(){return n.ajax({url:n(this).attr("href"),type:"POST",beforeSend:function(){f(o.WAIT)},success:function(t){f(t.resent?o.SUCCESS:o.ERROR)}}),!1})}}})})}(this,this.modules,this.jQuery,this.radio),function(t,e,n,i){"use strict";e.define("blockDownloadSms",[],function(t){var e={BLOCK_SWITCH:1,ATTRIBUTE:2},o={INIT:"init",WAIT:"wait",SUCCESS:"success",ERROR:"error"};t({StepMode:e,init:function(t,r){var s=t?BM.tools.domHelper.tojQueryObject(t):n("@block-download-sms");if(s&&0!==s.length){var a=s.find("@bm-notification-email-step"),u=s.find("@bm-notification-submit"),l=s.find("@bm-notification-phone-input"),c=s.find("@bm-form-download-sms-message-error"),d=null,h=e.BLOCK_SWITCH;r&&r.stepMode&&(h=r.stepMode);var p=function m(t){h===h.BLOCK_SWITCH?(a.removeClass("active"),a.filter("@step-"+t).addClass("active")):h===e.ATTRIBUTE&&s.attr("data-active-state",t),clearTimeout(d),t===o.ERROR&&(d=setTimeout(function(){r&&r.autoHideError&&m(o.INIT)},2e3))},f=function(){var t=l.val();u.attr("wait",!0),u.attr("disabled","disabled"),n.ajax({url:"/a/4/u/send_link.json",method:"post",data:{credential:t},success:function(t){u.removeAttr("wait"),u.removeAttr("disabled"),t.error?(c.html(t.error.message),p(o.ERROR),i("download-sms-error").broadcast()):(p(o.SUCCESS),i("download-sms-success").broadcast())},error:function(t){if(c.length>0)try{c.html(t.responseJSON.error)}catch(e){}p(o.ERROR),i("download-sms-error").broadcast()}})};u.click(function(){f()}),l.keypress(function(t){13==t.which&&f()})}}})})}(this,this.modules,this.jQuery,this.radio),function(t,e,n,i){e.define("formSendLink",[],function(e){e(function(e,o){var r=BM.tools.domHelper.tojQueryObject(e)||n("@form-send-link"),s=r.find("@form-send-link-submit"),a=r.find("@form-send-link-input"),u=r.find("@form-send-link-input-message"),l=r.find("@form-send-link-message-success"),c=function(t){return/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(t)},d=function(t){var e=/^\+?([0-9]{4,})$/;return o&&o.validationMask&&(e=o.validationMask),e.test(t)},h=function(){var t,e=a.val();if(o){if(o.regionCode){var h;h="function"===n.type(o.regionCode)?o.regionCode():o.regionCode,t=h+e.replace(/[\(\)\-\s]/g,"")}}else t="+7"+e.replace(/[\(\)\-\s]/g,"");d(t)&&(e=t),c(e)||d(e)?(s.attr("wait",!0),s.attr("disabled","disabled"),n.ajax({url:"/a/4/u/send_link.json",method:"post",data:{credential:e},success:function(t){s.removeAttr("wait"),s.removeAttr("disabled"),l.removeClass("m-invisible"),u.addClass("m-hidden"),i&&!t.error&&i.track("Get the App Successful"),r.trigger("response",t)},error:function(t){u.html(t),u.removeClass("m-hidden"),s.removeAttr("wait"),s.removeAttr("disabled"),i&&i.track("Get the App Failed"),r.trigger("response",t)}})):(i&&i.track("Get the App Failed"),u.removeClass("m-hidden"))};null==t.orientation&&(s.on("click",h),a.on("focus",function(){l.addClass("m-invisible"),u.addClass("m-hidden")}).on("keyup",function(t){u.addClass("m-hidden"),13==t.keyCode&&h()}))})})}(this,this.modules,this.jQuery,this.DIMixpanel),function(t,e,n){e.define("blockSocialConnect",["bmSocialConnect"],function(t,e){t({init:function(t,n){var i=new e,o=BM.tools.domHelper.tojQueryObject(t),r=o.find("@form-social-connect-button-vkontakte"),s=o.find("@form-social-connect-button-facebook"),a=o.find("@form-social-connect-button-twitter");r.on("click",function(){i.vkontakte(n)}),s.on("click",function(){i.facebook(n)}),a.on("click",function(){i.twitter(n)})}})})}(this,this.modules,this.jQuery),function(t,e,n,i){e.define("blockStoreLinks",[],function(e){e({init:function(e){var o=void 0!==e?BM.tools.domHelper.tojQueryObject(e):n("@block-store-links"),r=o.find("@block-store-link");o.find("@link-app-store"),o.find("@link-google-play"),o.find("@link-marketplace");r.on("click",function(e){var o=n(this);e.preventDefault(),i&&(i.track("Install App Button Pressed",{app:o.attr("data-mx-store")}),setTimeout(function(){t.location.href=o.attr("href")},150))})}})})}(this,this.modules,this.jQuery,this.DIMixpanel),function(t,e,n,i,o){e.define("blockSubscription",["PopupPaywall","config"],function(e,r,s){e({init:function(e){var s={BRAINTREE:"card",INPLAT:"sms",RURU:"ruru",TELE2EE:"tele2ee",MTS_BY:"mts_by"},a=void 0!==e?o.tools.domHelper.tojQueryObject(e):n("@block-subscription"),u=new r,l=a.find("@payment-button"),c=a.find(".subscription-button-buy"),d=a.find(".subscription-button-stop.subscription-button-stop-braintree"),h=a.find(".subscription-button-stop.subscription-button-stop-inplat"),p=a.find(".subscription-button-stop.subscription-button-stop-tele2ee"),f=a.find(".subscription-button-stop.subscription-button-stop-ruru"),m=a.find(".subscription-button-stop.subscription-button-stop-mts-by"),g=function(){n(this);t.ga&&t.ga("send","event","Payment-Button-1","press")},b=function(t){var e;t===s.BRAINTREE?e="/payments/braintree":t===s.INPLAT?e="/payments/inplat":t===s.RURU?e="/payments/ruru":t===s.TELE2EE?e="/payments/tele2_cbg.json":t===s.MTS_BY&&(e="/payments/mts_by"),_(e,t)},_=function(e,i){var o=n(".subscription-button-stop"),r=function(){y(i,function(){t.location.reload()})},s=function(){o.removeAttr("wait")};n.ajax({type:"DELETE",url:e,success:r,error:s}),o.attr("disabled","disabled"),o.attr("wait","true")},y=function(t,e){i.track("Recurrent Subscription Stopped",{method:t}).then(e)};l.on("click",function(t){t.preventDefault(),u.show({context:"settings"})}),c.on("click",g),d.on("click",function(){b(s.BRAINTREE)}),h.on("click",function(){b(s.INPLAT)}),f.on("click",function(){b(s.RURU)}),p.on("click",function(){b(s.TELE2EE)}),m.on("click",function(){b(s.MTS_BY)}),-1!==t.location.hash.indexOf("pay")&&(u.setStateInitial(),u.show())}})})}(this,this.modules,this.jQuery,this.DIMixpanel,this.BM),
function(t,e,n,i){"use strict";e.define("UserUploadBadgeDropdown",["baseView","DropDown"],function(t,e,n){var o=function(t){function e(n){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,t.call(this,n));return t.prototype.initialize.apply(i,arguments),i._initElements(n),i._initDropDown(n),i._render(n),i}return _inherits(e,t),e.prototype._initElements=function(t){this.$badge=t.$badgeEl,this.$userInfo=this.$elem.find("@bm-user-upload-user-info"),this.$userNull=this.$elem.find("@bm-user-upload-user-null"),this.$userLink=this.$elem.find("@bm-user-upload-user-info-link"),this.$userAvatar=this.$elem.find("@bm-user-upload-user-info-avatar"),this.$userName=this.$elem.find("@bm-user-upload-user-info-name")},e.prototype._initDropDown=function(t){this.dropDown=new n({$button:this.$badge,$container:this.$elem})},e.prototype._render=function(t){var e=t.document.uploaded_by;e?(this.$userLink.attr("href",i.helper.link.user(e.login)),this.$userAvatar.attr("src",e.avatar_url),this.$userName.html(e.login),this.$userInfo.show()):this.$userNull.show()},e.prototype._getTemplateName=function(){return"bm-user-upload-badge-dropdown-template"},e}(e);t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){e.define("moduleBookBadge",["baseView","extend","loginWindow","PopupPaywall","UserUploadBadgeDropdown"],function(e,n,o,r,s,a){var u=new r({preventDefaultLoginBehavior:!0}),l=o(n),c=l,d=c.superclass,h="bm-book-badge-template";i.tools.mixin(c.prototype,{initialize:function(t){d.initialize.apply(this,arguments),this._config=[],this._popupPaywall=null,this._reloadPageOnPaywallHide=!1,t&&t.element&&(this.$elem=t.element),t&&t.document&&(this.document=t.document),this.$elem&&(this._parseConfig(),this._setConfig(t),this._applyConfig(),this._updateActiveState(),this._initPopupPaywall(),this._initBadgeDropDown(),this._setupEvents())},_setConfig:function(t){i.tools.isUndefined(t)||i.tools.isUndefined(t.config)||i.tools.mixin(this._config,t.config)},_applyConfig:function(){i.tools.isUndefined(this._config)||i.tools.isUndefined(this._config.kind)||("premium"===this._config.kind?(this.$elem.attr("data-type","premium"),this.$elem.addClass("m-premium"),this.$elem.html(this.$elem.attr("data-text-premium"))):"default"===this._config.kind?(this.$elem.attr("data-type","default"),this.$elem.addClass("m-default"),this.$elem.html(this.$elem.attr("data-text-default"))):"free"===this._config.kind?(this.$elem.attr("data-type","free"),this.$elem.addClass("free"),this.$elem.html(this.$elem.attr("data-text-free"))):"user_upload"===this._config.kind?(this.$elem.attr("data-type","user_upload"),this.$elem.addClass("m-user-upload"),this.$elem.html(this.$elem.attr("data-text-user-upload"))):(this.$elem.attr("data-type","private"),this.$elem.addClass("m-private"),this.$elem.html(this.$elem.attr("data-text-private"))))},_initPopupPaywall:function(){this._popupPaywall=new s},_initBadgeDropDown:function(){this._isBadgeUserUpload()&&this.document&&(this.badgeDropDown=new a({$badgeEl:this.$elem,document:this.document}))},_setupEvents:function(){var t=this,e=i.helper.event.clickName();this.$elem.data("book-badge-inited",!0),this.$elem.on(e,function(e){t._onElementClick(e)}),this._popupPaywall.on("hide",function(){t._onPopupPaywallHide()})},_onElementClick:function(t){t.preventDefault(),t.stopPropagation();var e=i.helper.experiments.getExperiment("Buy on book page"),n=e&&"Buy subscription"===e.group,o=this.$elem.attr("data-type");!n||i.user.present()||gon.browser.mobile||gon.browser.tablet||"default"!=o&&"premium"!=o?i.user.isUserPresent()?this._isBadgePremium()&&!i.user.isSubscriptionPremium()?i.user.isSubscriptionDefault()?this._popupPaywall.show({type:s.Type.ABOUT_BOOK,step:s.Step.BOOSTER,context:"badge"}):this._popupPaywall.show({type:s.Type.ABOUT_BOOK,step:s.Step.PREMIUM,context:"badge"}):this._isBadgeDefault()&&!i.user.isSubscriptionDefault()?this._popupPaywall.show({type:s.Type.ABOUT_BOOK,step:s.Step.DEFAULT,context:"badge"}):this._isBadgeUserUpload():this._authorizeUser():this._isBadgePremium()&&!i.user.isSubscriptionPremium()?i.user.isSubscriptionDefault()?this._popupPaywall.show({type:s.Type.ABOUT_BOOK,step:s.Step.BOOSTER,context:"badge"}):this._popupPaywall.show({type:s.Type.ABOUT_BOOK,step:s.Step.PREMIUM,context:"badge"}):this._isBadgeDefault()&&!i.user.isSubscriptionDefault()?this._popupPaywall.show({type:s.Type.ABOUT_BOOK,step:s.Step.DEFAULT,context:"badge"}):this._isBadgeUserUpload()},_onPopupPaywallHide:function(){this._reloadPageOnPaywallHide&&t.location.reload()},_updateActiveState:function(){this._isClickable()&&this._setStateActive()},_isClickable:function(){return i.user.isUserPresent()?this._isBadgePremium()&&!i.user.isSubscriptionPremium()?!0:this._isBadgeDefault()&&!i.user.isSubscriptionDefault()?!0:void 0:!0},_setStateActive:function(){this.$elem.attr("data-active","true")},_isBadgePremium:function(){return"premium"===this.$elem.attr("data-type")||this.$elem.hasClass("m-premium")},_isBadgeDefault:function(){return"default"===this.$elem.attr("data-type")||this.$elem.hasClass("m-default")},_isBadgeUserUpload:function(){return"user_upload"===this.$elem.attr("data-type")||this.$elem.hasClass("m-user-upload")},_authorizeUser:function(){var e=this;this._notify("book-popup:hide"),u.showWindow("inital","subscription"),u.on("authenticationSuccessful",function(n){i.config.updateMainConfig(function(){e._isBadgePremium()&&!i.user.isSubscriptionPremium()?(u.closeWindow(),e._reloadPageOnPaywallHide=!0,i.user.isSubscriptionDefault()?e._popupPaywall.show({type:s.Type.ABOUT_BOOK,step:s.Step.BOOSTER,context:"badge"}):e._popupPaywall.show({type:s.Type.ABOUT_BOOK,step:s.Step.PREMIUM,context:"badge"})):e._isBadgeDefault()&&!i.user.isSubscriptionDefault()?(u.closeWindow({silent:!0}),e._reloadPageOnPaywallHide=!0,e._popupPaywall.show({type:s.Type.ABOUT_BOOK,step:s.Step.DEFAULT,context:"badge"})):t.location.reload()})})},_getTemplateName:function(){return h}}),e(l)})}(this,this.modules,this.jQuery,this.BM,this.radio),function(t,e,n,i){e.define("moduleBookCard",["extend","baseView","hyphenizer","moduleButtonRead"],function(t,e,n,o,r){var s=e(n),a=s,u=a.superclass,l="bm-book-cover-template";i.tools.mixin(a,{CoverSize:{THUMB:"thumb",WEB:"web",LARGE:"large",SMALL_FIT:"small-fit"},prepareConfigFromDocumentAPI4Attributes:function(t){var e={title:t.title,authors:t.authors,book:{uuid:t.book_uuid},document:{uuid:t.uuid},cover:{size:null}};return t.cover&&t.cover.url&&(e.cover={url:t.cover.url}),t.lc&&i.tools.isString(t.lc.uuid)&&(e.libraryCard={uuid:t.lc.uuid,state:t.lc.state,is_public:t.lc.is_public,is_uploaded:t.lc.is_uploaded}),e}}),i.tools.mixin(a.prototype,{initialize:function(t){u.initialize.apply(this,arguments),this.$elem&&(this.$elemTitle=this.$elem.find("@bm-book-card-title"),this.$elemAuthors=this.$elem.find("@bm-book-card-authors"),this.$elemCoverImage=this.$elem.find("@bm-book-card-cover-image"),this.$elemButtonReadWrapper=this.$elem.find("@bm-book-card-button-read-wrapper"),this.$elemBookLink=this.$elem.find("@bm-book-card-link"),this._config={title:"",authors:"",document:{uuid:null},book:{uuid:null},libraryCard:{uuid:null,state:null,is_public:null},cover:{url:null,size:null,lazyload:!1},credits:{hover:!1},readButton:{enabled:!0,width:"fullwidth"},mClass:""},this._coverEnabled=null,this._coverSize=a.CoverSize.THUMB,this._showCreditsOnHover=!1,this._bookTitle="",this._bookAuthors="",this._readButtonHandler=null,this._parseConfig(),this.setConfig(t),this._hyphenize(),this._initButtonRead(),this._setupEvents(),this.updateLayout())},_parseConfig:function(){var t={};try{t=JSON.parse(this.$elem.attr("data-config")),t.library_card&&(t.libraryCard=t.library_card,delete t.library_card),t.read_button&&(t.readButton=t.read_button,delete t.read_button)}catch(e){}i.tools.mixin(this._config,t)},_mixinToConfig:function(t){var e=t;e.hasOwnProperty("element")&&delete e.element,this._config=i.tools.mixin(this._config,e)},setConfig:function(t){i.tools.isPresent(t)&&(this._mixinToConfig(t),i.tools.isPresent(this._config.cover)&&(null!==this._config.cover.url&&this.setCoverImage(this._config.cover.url),null!==this._config.cover.size&&this.setCoverSize(this._config.cover.size)),i.tools.isPresent(this._config.credits)&&this._config.credits.hover===!0&&this.setCreditsOnHover(this._config.credits.hover),this._config.title&&this.setBookTitle(this._config.title),this._config.authors&&this.setBookAuthors(this._config.authors),this._config.mClass&&this.setModClass())},_getTemplateName:function(){return l},_hyphenize:function(){this._hyphenizeTitle(),this._hyphenizeAuthors()},_hyphenizeTitle:function(){var t=this.getTitle();t&&t.length>0&&this.$elemTitle.html(o.hyphenize(t.split(" ")).join(" "))},_hyphenizeAuthors:function(){var t=this.getAuthors();t&&t.length>0&&this.$elemAuthors.html(o.hyphenize(t.split(" ")).join(" "))},_initButtonRead:function(){if(null===this._readButtonHandler&&this._isReadButtonEnabled()){if(this.$elem.find("@bm-button-read").length>0)this._readButtonHandler=new r({element:this.$elem.find("@bm-button-read")});else{var t=this._getConfigForReadButton();this._readButtonHandler=new r({config:t}),this._readButtonHandler.getElement().find("@button-read-reader-open").attr("href","/reader/"+t.document.uuid)}this._initReadButtonEvents(),this.$elemButtonReadWrapper.append(this._readButtonHandler.getElement())}},_initReadButtonEvents:function(){var t=this;this._readButtonHandler&&(this._readButtonHandler.on("dropdown-show",function(){t.$elem.attr("dropdown-visible","true")}),this._readButtonHandler.on("dropdown-hide",function(){t.$elem.attr("dropdown-visible","false")}))},_getConfigForReadButton:function(){var t={};return this._config.document&&(t.document={uuid:this._config.document.uuid}),this._config.book&&(t.book={uuid:this._config.book.uuid}),this._config.libraryCard&&(t.libraryCard={uuid:this._config.libraryCard.uuid,state:this._config.libraryCard.state,is_public:this._config.libraryCard.is_public,is_uploaded:this._config.libraryCard.is_uploaded}),this._config.readButton&&!i.tools.isUndefined(this._config.readButton.horAlign)&&(t.horAlign=this._config.readButton.horAlign),this._config.readButton&&!i.tools.isUndefined(this._config.readButton.horAlign)&&(t.dropdownOptions=this._config.readButton.dropdownOptions),t.controls={read:!0,sideButton:{addToLibrary:!0,dropdown:!0}},t.mixpanel_ctx=this._config.mixpanel_ctx,t},_setupEvents:function(){var t=this;t.$elem.on("click",function(e){t._onClick(e)})},_onClick:function(t){this._notify("click",t)},updateLayout:function(){null!==this._bookCoverUrl&&i.tools.isPresent(this._config.cover)&&!this._config.cover.lazyload&&this.$elemCoverImage.attr("src",this._bookCoverUrl),this._coverEnabled?this.$elem.attr("data-cover-visible","true"):this.$elem.attr("data-cover-visible","false"),this._showCreditsOnHover?this.$elem.attr("data-credits-on-hover","true"):this.$elem.attr("data-credits-on-hover","false"),this._bookTitle?(this.$elemTitle.html(this._bookTitle),this.$elemTitle.removeAttr("hidden")):this.$elemTitle.attr("hidden","hidden"),this._bookAuthors?(this.$elemAuthors.html(this._bookAuthors),this.$elemAuthors.removeAttr("hidden")):this.$elemAuthors.attr("hidden","hidden"),this._config.link?this.$elemBookLink.attr("href",this._config.link):null!==this._config.book.uuid&&this.$elemBookLink.attr("href",this._generateBookLink()),this._config.linkEnabled===!1&&this.$elemBookLink.removeAttr("href"),this.$elem.attr("data-size",this._coverSize)},_generateBookLink:function(){return i.helper.link.book(this._config.book.uuid)},_hideBlankCover:function(){},getTitle:function(){return this._config.title},getAuthors:function(){return this._config.authors},setModClass:function(){this.$elem.addClass(this._config.mClass)},setCoverImage:function(t){var e=function(){this._coverEnabled=!1,this.updateLayout()}.bind(this);if(t){if(this._config.cover.lazyload)this.$elemCoverImage.attr("data-original",t),this.$elemCoverImage.lazyload({effect:"fadeIn",placeholder:"",error:function(t,n,i){e()}});else{var n=new Image;n.onerror=function(){e()},n.src=t}this._bookCoverUrl=t,this._coverEnabled=!0,this.updateLayout()}},setCoverSize:function(t){if(t){switch(t){case a.CoverSize.THUMB:this._coverSize=a.CoverSize.THUMB;break;case a.CoverSize.WEB:this._coverSize=a.CoverSize.WEB;break;case a.CoverSize.LARGE:this._coverSize=a.CoverSize.LARGE;break;case a.CoverSize.SMALL_FIT:this._coverSize=a.CoverSize.SMALL_FIT}this.updateLayout()}},getCoverSize:function(){return this.$elem.attr("data-size")},setCoverImageVisible:function(t){void 0!==t&&(this._coverEnabled=t,this.updateLayout())},showImageCover:function(){this._coverEnabled=!0,this.updateLayout()},showAutoCover:function(){this._coverEnabled=!1,this.updateLayout()},setCreditsOnHover:function(t){void 0!==t&&(this._showCreditsOnHover=t,this.updateLayout())},setBookTitle:function(t){t&&(this._bookTitle=t,this.updateLayout())},setBookAuthors:function(t){t&&(this._bookAuthors=t,this.updateLayout())},getElement:function(){return this.$elem},destroy:function(){},_isReadButtonEnabled:function(){return this._config&&this._config.readButton&&void 0!==this._config.readButton.enabled?this._config.readButton.enabled:!1}}),t(s)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){"use strict";e(function(){var r=null;i.require(["loginWindow","moduleButtonRead","RouterWeb","DocumentPopup","bookHyphenizer"],function(i,s,a,u,l){e.widget("custom.bookcard",{_init:function(){this._readButtonHandler=null,this._reloadAfterBookAdding=!1,this._initLoginWindow(),this._initReadButton(),this._bindEvents()},_initReadButton:function(){null===this._readButtonHandler&&(this._readButtonHandler=new s({element:this.element.find("@bm-button-read"),config:{controls:{read:!0,sideButton:{addToLibrary:!0,dropdown:!0}}}}),this._bindReadButtonEvents())},_initLoginWindow:function(){this._loginWindow=new i({context:"library_add",preventDefaultLoginBehavior:!0})},_bindReadButtonEvents:function(){var t=this;this._readButtonHandler.on("dropdown-show",function(){t._onReadButtonDropdownShow()}),this._readButtonHandler.on("dropdown-hide",function(){t._onReadButtonDropdownHide()}),this._readButtonHandler.on("book-adding-success",function(){t._onBookAddingSuccess()}),this._readButtonHandler.on("user-auth-request",function(){t._onUserAuthRequest()})},_bindEvents:function(){var t=BM.tools.client.isTouch()?BM.tools.client.touchEvent:"click";e(this.element).on(t,".bookcard-hover-link, .cover > a",function(t){o.discovered.set({channel:"book",ctx:e(this).data("mixpanel-ctx"),uuid:e(this).data("discovery-id")}),e(this).hasClass("selectable")||BM.tools.client.isTouch()||(t.preventDefault(),t.stopPropagation(),a.navigateToBookPage(e(this).data("book-uuid")))}),this._radioSubscribe()},_radioSubscribe:function(){var t=this;n("authenticationSuccessful").subscribe(function(e,n,i,o){r===t&&(t._loginWindow.preventDefaultLoginBehavior!==!1?null!==t._readButtonHandler&&t._readButtonHandler.sendRequestAddBookToLibrary():t._reloadAfterBookAdding=!1)})},_onBookAddingSuccess:function(){setTimeout(function(){this._reloadAfterBookAdding&&t.location.reload()}.bind(this),200)},_onUserAuthRequest:function(t){r=this,this._reloadAfterBookAdding=!0,this._loginWindow.showWindow("inital")},_onReadButtonDropdownShow:function(){this.element.attr("dropdown-active","true")},_onReadButtonDropdownHide:function(){this.element.removeAttr("dropdown-active")}});var c=function(){},d=function(t){BM.tools.isFunction(t)&&(c=t,this._loginWindow.showWindow())},h=function(){c()},p=function(){n("authenticationSuccessful").subscribe(h),n("authorization-request").subscribe(d)},f=function(){e(".book, .bookcard, .bookpage-leftside, .wrapper.users-library-cards .read-button-container,.aboutBookNav").each(function(){void 0===e(this).data("custom-bookcard")&&(e(this).bookcard(),e(this).hyphenizeBookTitle())})};f(),p()})})}(this,this.jQuery,this.radio,this.modules,this.DIMixpanel),function(t,e,n,i,o,r){"use strict";o.define("moduleImportBookCard",["extend","moduleShelfBookCard","baseView","hyphenizer","moduleBookCard","RouterWeb"],function(t,e,i,o,s,a,u){var l="bm-shelf-book-cover-template",c=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.call(this,arguments),this.$elemStatus=this.$elem.find("@bm-shelf-book-status"),this.$elemTitle=this.$elem.find("@bm-shelf-book-title"),this.$elemBook=this.$elem.find("@bm-shelf-book-wrapper"),this.$elemAuthors=this.$elem.find("@bm-shelf-book-authors"),this.$elemRemove=this.$elem.find("@bm-shelf-book-import-delete"),this.$elemWait=this.$elem.find("@bm-shelf-book-import-waiting"),this._config={components:{readers:!0,owner:!1},refetch:!1,openDocumentPopup:!0},this._parseConfig(),this._setConfig(e),this._initStatus(),this._initBook(),this._initTitles(),this._bindEvents()},e.prototype._initTitles=function(){this.$elemTitle.html((this._config.document||this._config).title),this.$elemAuthors.html((this._config.document||this._config).authors)},e.prototype._initBook=function(){var t=this._config,e=a.prepareConfigFromDocumentAPI4Attributes(t.document||{});e.cover.size=a.CoverSize.WEB,"processed"!==t.state&&(e.title=t.status_message,e.authors=null,e.cover.lazy_load=!1,e.openDocumentPopup=!1,e.readButton={enabled:!1});var n=new a(e);this.$elemBook.html(n.getElement()),t.removable&&this.$elemRemove.removeClass("hidden"),"draft"===t.state&&this.$elemWait.removeClass("hidden")},e.prototype._initStatus=function(){var t=this._config.document&&this._config.document.lc;t&&(t.progress=0===t.progress||null===t.progress?1:t.progress,this.$elemStatus.find(".progress").html(t.progress+"%"),this.$elemStatus.find("."+t.state).removeClass("hidden"),t.is_public||this.$elemStatus.find(".private").removeClass("hidden"))},e.prototype._bindEvents=function(){var t=this,e=this,i=r.tools.client.isTouch()?r.tools.client.touchEvent:"click";this.$elem.on(i,".bm-book-cover-content-link, .bm-book-cover > a",function(i){i.preventDefault(),i.stopPropagation(),n(t).hasClass("selectable")||"processed"===e._config.state&&(r.tools.client.isTouch()||u.navigateToBookPage(e._config.document.book_uuid))}),this.$elemRemove.on(i,function(e){e.preventDefault(),e.stopPropagation(),n.ajax({url:"/a/4/u/imports/"+t._config.uuid,method:"DELETE",success:function(e){t.$elem.remove()}})})},e.prototype._parseConfig=function(){var t=this._parseDataConfig();r.tools.isEmpty(t)||r.tools.mixin(this._config,t)},e.prototype._setConfig=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];r.tools.mixin(this._config,t)},e.prototype._getTemplateName=function(){return l},e}(o);t(c)})}(this,this.document,this.jQuery,this.radio,this.modules,this.BM),function(t,e,n,i,o,r){"use strict";i.define("moduleShelfBookCard",["extend","baseView","hyphenizer","moduleBookCard","RouterWeb"],function(t,n,i,s,a,u){var l=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(n,t),n.prototype.initialize=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];t.prototype.initialize.call(this,arguments),this.$elemStatus=this.$elem.find("@bm-shelf-book-status"),this.$elemTitle=this.$elem.find("@bm-shelf-book-title"),this.$elemBook=this.$elem.find("@bm-shelf-book-wrapper"),this.$elemAuthors=this.$elem.find("@bm-shelf-book-authors"),this._config={components:{readers:!0,owner:!1},refetch:!1,openDocumentPopup:!0},this._parseConfig(),this._setConfig(e),this._initStatus(),this._initBook(),this._initTitles(),this._bindEvents()},n.prototype._initTitles=function(){var t=(o.user.getViewingUserLogin(),this._config.book_uuid);this._config.lc||null;this.$elemTitle.html(this._config.title),this.$elemAuthors.html(this._config.authors),this.$elemTitle.attr("href",o.helper.link.book(t)),this.$elemAuthors.attr("href",o.helper.link.book(t))},n.prototype._initBook=function(){var t=this._config,e=a.prepareConfigFromDocumentAPI4Attributes(t);e.cover.size=a.CoverSize.WEB,e.cover.lazy_load=!0,e.openDocumentPopup=!0,e.readButton={enabled:t.can_be_read,horAlign:"fullwidth"},e.libraryCard=t.lc||null,e.mClass="m-mobile-block",e.mixpanel_ctx=this._getMixpanelContext();var n=new a(e);this.$elemBook.html(n.getElement())},n.prototype._initStatus=function(){var t=this._config.lc;t&&(t.progress=0===t.progress||null===t.progress?1:t.progress,this.$elemStatus.find(".progress").html(t.progress+"%"),this.$elemStatus.find("."+t.state).removeClass("hidden"),t.is_public||this.$elemStatus.find(".private").removeClass("hidden"))},n.prototype._bindEvents=function(){var t=this,n=this,i=o.tools.client.isTouch()?o.tools.client.touchEvent:"click";this.$elem.on(i,".bm-book-cover-content-link, .bm-book-cover > a",function(i){r.discovered.set({channel:"book",ctx:n._getMixpanelContext()}),e(t).hasClass("selectable")||o.tools.client.isTouch()||(i.preventDefault(),i.stopPropagation(),u.navigateToBookPage(n._config.book_uuid))})},n.prototype._getMixpanelContext=function(){var t=gon.mixpanelIdentify===gon.viewingUser.login?"my_books":!1,e=!t&&gon.following?"user_friend":"user_stranger";return t||e},n.prototype._parseConfig=function(){var t=this._parseDataConfig();o.tools.isEmpty(t)||o.tools.mixin(this._config,t)},n.prototype._setConfig=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o.tools.mixin(this._config,t)},n.prototype._getTemplateName=function(){return"bm-shelf-book-cover-template"},n}(i);t(l)})}(this,this.jQuery,this.radio,this.modules,this.BM,this.DIMixpanel),function(t,e,n,i){e.define("ButtonAddSimple",["extend","baseView"],function(t,e,n){var o=e(n),r=o,s=r.superclass;i.tools.mixin(r.prototype,{initialize:function(t){s.initialize.apply(this,arguments),this._config={document:{uuid:null},libraryCard:{uuid:null}},this._parseConfig(),this._setupEvents(),this._update()},_setupEvents:function(){var t=this;this.$elem.on("click",function(){t._onElemClick()})},_onElemClick:function(){this._setStateWait(!0),setTimeout(function(){this._setStateWait(!1),this._setStateSuccess(!0),setTimeout(function(){this._setStateNotActive(!0)}.bind(this),500)}.bind(this),1e3)},_setStateWait:function(t){t?this.$elem.addClass("m-wait"):this.$elem.removeClass("m-wait")},_setStateSuccess:function(t){t?this.$elem.addClass("m-success"):this.$elem.removeClass("m-success")},_setStateNotActive:function(t){t?this.$elem.addClass("m-not-active"):this.$elem.removeClass("m-not-active")},_update:function(){}}),t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o,r){e.define("moduleButtonRead",["baseView","extend","loginWindow","moduleButtonReadDropdown"],function(e,s,a,u,l){var c=a(s),d=c,h=d.superclass,p=0,f="bm-button-read-template";n.tools.mixin(d,{ClassName:{SIDE_BUTTON_VISIBLE:"m-side-button-visible",SIDE_BUTTON_STATE_LOADING:"m-state-loading",SIDE_BUTTON_STATE_BOOK_ADDED:"m-state-book-added",SIDE_BUTTON_STATE_DROPDOWN:"m-dropdown-available",SIDE_BUTTON_ANIMATIONS_DISABLED:"m-animations-disabled",SIDE_BUTTON_STATE_ADDING_SUCCESS:"m-adding-success",BUTTON_READ_INVISIBLE:"m-button-read-invisible"},HorAlign:{READ_BUTTON:"readbutton",FULL_WIDTH:"fullwidth"},ViewMode:{DEFAULT:"default",BLUE_TRANSPARENT:"blue-transparent"},prepareConfigFromDocumentAPI4Attributes:function(t){var e={book:{uuid:t.book_uuid},document:{uuid:t.uuid}};return t.lc&&n.tools.isString(t.lc.uuid)&&(e.libraryCard={uuid:t.lc.uuid,state:t.lc.state,is_public:t.lc.is_public,is_uploaded:t.lc.is_uploaded}),e}}),n.tools.mixin(d.prototype,{initialize:function(t){h.initialize.apply(this,arguments),this.$elem&&0!==this.$elem.length&&(this.$elemButtonReaderOpen=this.$elem.find("@button-read-reader-open"),this.$elemSideButton=this.$elem.find("@button-read-side-button"),this._config={viewMode:d.ViewMode.DEFAULT,horAlign:d.HorAlign.FULL_WIDTH,controls:{read:!0,sideButton:{addToLibrary:!0,dropdown:!0}},document:{uuid:null},book:{uuid:null},libraryCard:{uuid:null,state:null,is_public:null},dropdownOptions:{},text:"text"},this._configDropdownOptions={$button:this.$elem,autoLayout:!0},this._isVisible=!0,this._dropdownHandler=null,this._timeoutAbortRequest=null,p+=1,this._initLoginWindow(),this._parseConfig(),this._setConfig(t.config),this._init())},_initLoginWindow:function(){this.loginWindow=new u({context:"library_add"})},_getTemplateName:function(){return f},_parseConfig:function(){var t=this.$elem.attr("data-config");if(t)try{n.tools.mixin(this._config,JSON.parse(t))}catch(e){}},_setConfig:function(t){t&&(n.tools.isUndefined(t.controls)?t.controls={}:n.tools.isUndefined(t.controls.read)?t.controls.read=!0:n.tools.isUndefined(t.controls.sideButton)?t.controls.sideButton={addToLibrary:!0,dropdown:!0}:n.tools.isUndefined(t.controls.sideButton.dropdown)?t.controls.sideButton.dropdown=!0:n.tools.isUndefined(t.controls.sideButton.addToLibrary)&&(t.controls.sideButton.addToLibrary=!0),n.tools.mixin(this._config,t))},_init:function(){this._disableTransitions(),this._initDropdown(),this._updateViewMode(),this._updateHorAlign(),this._update(),this._bindEvents(),this._enableTransitions()},_showAddingStateSuccess:function(){this.$elemSideButton.removeClass(d.ClassName.SIDE_BUTTON_STATE_LOADING),this.$elemSideButton.addClass(d.ClassName.SIDE_BUTTON_STATE_ADDING_SUCCESS)},_disableTransitions:function(){try{this.$elem.attr("no-transitions","true"),this.$elem.get(0).offsetHeight=this.$elem.get(0).offsetHeight}catch(t){}},_enableTransitions:function(){try{this.$elem.removeAttr("no-transitions"),this.$elem.get(0).offsetHeight=this.$elem.get(0).offsetHeight}catch(t){}},update:function(){this._update(),this.updateDropdownActions()},_update:function(){this._actionsAvailable()?(this._sideButtonActionsAvailable()?(this._sideButtonActionDropdownAvailable()&&this._showButtonDropdown(),this._sideButtonActionPlusAvailable()&&this._showButtonPlus(),this._showSideButton()):this._hideSideButton(),this._buttonReadActionsAvailable()?this._showButtonRead():this._hideButtonRead(),this.show()):this.hide(),this._updateLayout()},_updateLayout:function(){var t;n.tools.isNull(this._dropdownHandler)||(t=this._dropdownHandler.getElement())},_actionsAvailable:function(){return this._sideButtonActionsAvailable()||this._buttonReadActionsAvailable()},_sideButtonActionsAvailable:function(){return this._sideButtonActionPlusAvailable()||this._sideButtonActionDropdownAvailable()},_sideButtonActionPlusAvailable:function(){return n.tools.isUndefined(this._config.controls.sideButton)?!0:this._config.controls.sideButton.addToLibrary===!0&&!this._isBookAddedToLibrary()},_sideButtonActionDropdownAvailable:function(){return n.tools.isUndefined(this._config.controls.sideButton)?!0:this._config.controls.sideButton.dropdown&&this._isBookAddedToLibrary()},_buttonReadActionsAvailable:function(){return this._config.controls.read===!0},_isBookAddedToLibrary:function(){return null!==this._getLibraryCardUuid()},_showButtonRead:function(){this.$elem.removeClass(d.ClassName.BUTTON_READ_INVISIBLE)},_hideButtonRead:function(){this.$elem.addClass(d.ClassName.BUTTON_READ_INVISIBLE)},show:function(){this._actionsAvailable()&&(this._isVisible=!0,this.$elem.attr("visible","true"))},hide:function(){this._isVisible&&(this.$elem.attr("visible","false"),this._isVisible=!1)},_showButtonPlus:function(){this.$elemSideButton.addClass(d.ClassName.SIDE_BUTTON_VISIBLE),this.$elemSideButton.removeClass(d.ClassName.SIDE_BUTTON_STATE_BOOK_ADDED)},_showButtonDropdown:function(){var t=this;this.$elemSideButton.addClass(d.ClassName.SIDE_BUTTON_STATE_BOOK_ADDED),this.$elemSideButton.removeClass(d.ClassName.SIDE_BUTTON_ANIMATIONS_DISABLED),setTimeout(function(){t.$elemSideButton.addClass(d.ClassName.SIDE_BUTTON_ANIMATIONS_DISABLED)},800)},_showSideButton:function(){this.$elem.addClass(d.ClassName.SIDE_BUTTON_VISIBLE)},_hideSideButton:function(){this.$elem.removeClass(d.ClassName.SIDE_BUTTON_VISIBLE)},_bindEvents:function(){var t=this,e=n.helper.event.clickName();e="click",this.$elemButtonReaderOpen.on(e,function(e){e.preventDefault(),t._onButtonReaderOpenClick()}),this.$elemSideButton.on(e,function(e){t._onSideButtonClick(e)}),o("bm-library-card-removed").subscribe(function(e){t._config.libraryCard.uuid===e.libraryCard.uuid&&t._onLibraryCardRemoved()}),o("bm-book-added-to-library").subscribe(function(e,n){n!==t&&t._onBookAddToLibraryRequestSuccess(e)})},_onButtonReaderOpenClick:function(){this._setMixpanelDiscovered(),t.open(this._getReaderUrl(),"Bookmate Embedded Reader","toolbar=no,location=0,status=no,titlebar=no,menubar=no,width="+t.screen.width+",height="+t.screen.height),this._dropdownHandler&&this._dropdownHandler.setActionContinueReadingVisible()},_onSideButtonClick:function(t){t.stopPropagation(),t.preventDefault(),n.user.isUserPresent()?this._isBookAddedToLibrary()?this._toggleDropdown():this.sendRequestAddBookToLibrary():this._notify("user-auth-request")},_onLibraryCardRemoved:function(){var t=this._config.libraryCard.uuid;this._dropdownHandler.destroy(),this._dropdownHandler=null,this._config.libraryCard.uuid=null,this._update(),o("bm-library-card-removed").broadcast({libraryCard:{uuid:t}}),this._refreshBookshelfDocument(this)},_onBodyClick:function(t){this._dropdownHandler.hideAll()},sendRequestAddBookToLibrary:function(){var t,e=this;this._clearTimeoutAbortRequest(),this._setSideButtonStateLoading(),this._sendMixpanelEventAddedToLibrary(this),t=i.ajax({method:"POST",url:"/a/4/d/"+this._getDocumentUuid()+"/add.json",dataType:"json",data:r.discovered.backend_data(!1),success:function(t){e._clearTimeoutAbortRequest(),e._onBookAddToLibraryRequestSuccess(t);var n=i(".bm-bookshelf").attr("id");n&&e._addReader(e,n),o("bm-book-added-to-library").broadcast(t,this)},error:function(){e._clearTimeoutAbortRequest(),e._onBookAddToLibraryRequestError()}}),this._timeoutAbortRequest=setTimeout(function(){t&&t.abort&&(t.abort(),e._onBookAddToLibraryRequestError())},1e4)},_addReader:function(t,e){i.ajax({url:"/a/4/bs/"+e+"/d/"+this.getDocumentUuid()+"/read.json",method:"post",success:function(){t._refreshBookshelfDocument(t)},error:function(){}})},_refreshBookshelfDocument:function(t){var e=t.$elem.parents(".bm-bookshelf-post-attachment-book"),n=e.length>0?e.data("bsd_uuid"):void 0;if(n){var o=function(t){var n=e.find(".bm-bookshelf-post-attachment-book-meta-add-stats-avatars, @bm-book-block-list-item-readers-list"),i=e.find(".bm-bookshelf-post-attachment-book-meta-add-stats .counter, @bm-book-block-list-item-readers-count");i.text(t.readers_count),n.empty(),t.readers.forEach(function(t){n.append('<a class="bm-book-reader" role="bm-book-reader" data-hook="login" href="/'+t.login+'"><img class="bm-book-reader-avatar" role="bm-book-reader-avatar" data-hook="avatar_url" src="'+t.avatar_url+'"/></a>')})};i.ajax({url:"/a/4/bsd/"+n+".json?embed_readers=12",method:"get",success:function(t){o(t)},error:function(){}})}},_getMixpanelPaidValue:function(){var t=this._config.document,e=t.labels,n=this._config.libraryCard;if(n.is_uploaded)return"self_upload";if(e&&e.length>0){var i=e.map(function(t){return"default"===t.kind?"standard":t.kind})[0];return i}},_sendMixpanelEventAddedToLibrary:function(t){this._setMixpanelDiscovered(),r.track("Adding to Library",{paid:this._getMixpanelPaidValue()})},_setMixpanelDiscovered:function(){var t,e;"shelf"===this._config.mixpanel_ctx&&"feed_shelf"===r.discovered.context.get()?(t=r.discovered.context.get("book"),e=r.discovered.uuid.get("book")):"shelf"===this._config.mixpanel_ctx&&"featured"===r.discovered.context.get("shelf")?(t=r.discovered.context.get("shelf"),e=r.discovered.uuid.get("shelf")):"shelf"===this._config.mixpanel_ctx&&"hot"===r.discovered.context.get("shelf")?(t=r.discovered.context.get("shelf"),e=r.discovered.uuid.get("shelf")):this._config.mixpanel_ctx&&"other"!==this._config.mixpanel_ctx?(t=this._config.mixpanel_ctx,e=this._config.discovery_id||this._config.discovered_id):(t=r.discovered.context.get("book"),e=r.discovered.uuid.get("book")),r.discovered.set({channel:"book",ctx:t,uuid:e})},_clearTimeoutAbortRequest:function(){
null!==this._timeoutAbortRequest&&(clearTimeout(this._timeoutAbortRequest),this._timeoutAbortRequest=null)},_onBookAddToLibraryRequestSuccess:function(t,e){e!==this&&null!==t.uuid&&t.uuid===this._config.document.uuid?setTimeout(function(){null===this._config.libraryCard.uuid&&(this._config.libraryCard.uuid=t.lc.uuid,this._config.book.uuid=t.book_uuid,this._updateDropdownOptions(t.lc),setTimeout(function(){this._setSideButtonStateBookAdded(),this._update(),this._notify("book-adding-success")}.bind(this),1e3))}.bind(this),300):t&&t.lc&&t.lc.uuid||setTimeout(function(){this._update()}.bind(this),300)},_onBookAddToLibraryRequestError:function(){this._setSideButtonStatePlus(),this._notify("book-adding-error")},_setSideButtonStatePlus:function(){this.$elemSideButton.removeClass("m-state-book-added"),this.$elemSideButton.removeClass("m-state-loading")},_setSideButtonStateLoading:function(){this.$elemSideButton.removeClass("m-state-book-added"),this.$elemSideButton.addClass("m-state-loading")},_setSideButtonStateBookAdded:function(){this.$elemSideButton.addClass("m-state-book-added"),this.$elemSideButton.removeClass("m-state-loading")},_toggleDropdown:function(){null!==this._dropdownHandler&&(this._dropdownHandler.isVisible()?this._hideDropdown():this._showDropdown())},_showDropdown:function(){this._dropdownHandler.show(),this.$elem.addClass("m-dropdown-visible"),this._notifyDropdownShow()},_notifyDropdownShow:function(){this._notify("dropdown-show")},_hideDropdown:function(){this._dropdownHandler.hide(),this.$elem.removeClass("m-dropdown-visible"),this._notifyDropdownHide()},_notifyDropdownHide:function(){this._notify("dropdown-hide")},_initDropdown:function(){null===this._dropdownHandler&&(n.tools.mixin(this._configDropdownOptions,this._config.dropdownOptions),this._config.dropdownOptions=this._configDropdownOptions,this._dropdownHandler=new l(this._config),this._bindDropdownEvents())},_bindDropdownEvents:function(){var t=this;this._dropdownHandler&&(this._dropdownHandler.on("show",function(){t._notifyDropdownShow()}),this._dropdownHandler.on("hide",function(){t._notifyDropdownHide()}),this._dropdownHandler.on("closed",function(){t._hideButtonAfterDropDown()}),this._dropdownHandler.on("library-card-removed",function(){t._onLibraryCardRemoved()}))},_updateDropdownOptions:function(t){null===this._dropdownHandler&&this._initDropdown(),this._dropdownHandler.setLCInfo(t),this._dropdownHandler.updateActions()},updateDropdownActions:function(){n.tools.isNull(this._dropdownHandler)||this._dropdownHandler.updateActions()},_getDropdownOptions:function(){null===this._dropdownHandler},_getDocumentUuid:function(){return this._config.document.uuid},getDocumentUuid:function(){return this._config.document.uuid},_getLibraryCardUuid:function(){return this._config.libraryCard.uuid},_getReaderUrl:function(){return"/reader/"+this._getDocumentUuid()},_setBookAddedToLibrary:function(t){this._config.options.bookAdded=t},setViewMode:function(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=Object.keys(viewMode);e.includes(t)&&(this._config.viewMode=t,this._updateViewMode())},_updateViewMode:function(){this.$elem.attr("data-view-mode",this._config.viewMode)},setHorAling:function(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=Object.keys(HorAlign);e.includes(t)&&(this._config.horAlign=t,this._updateHorAlign())},_updateHorAlign:function(){this.$elem.attr("data-align",this._config.horAlign)},_hideButtonAfterDropDown:function(){this.$elem.removeClass("m-dropdown-visible"),this._notifyDropdownHide()},getElement:function(){return this.$elem},getAltText:function(){return this.$elemButtonReaderOpen.data("alt-text")},setText:function(t){this.$elemButtonReaderOpen.text(t)}}),e(c)})}(this,this.modules,this.BM,this.jQuery,this.radio,this.DIMixpanel),function(t,e,n,i,o){e.define("moduleButtonReadDropdown",["PubSub","extend","embedPopupApi","PopupContentProblem","DropDown"],function(e,r,s,a,u,l){var c=s(l),d=c,h=d.superclass;n.tools.mixin(d,{LCState:{PENDING:"pending",READING:"reading",FINISHED:"finished"},Visibility:{PUBLIC:!0,HIDDEN:!1}}),n.tools.mixin(d.prototype,{initialize:function(t){l.prototype.initialize.apply(this,arguments),this.event=n.tools.client.isTouch()?n.tools.client.touchEvent:"click",this.$elemParent=null,this.$elem=null,this.$elemContainer=null,this._actions=[],this._config={document:{uuid:null},book:{uuid:null},libraryCard:{uuid:null,state:null,is_public:null}},this._popupBookMistake=null,this._setConfig(t),this._createElement(),this._setProperties()},_setConfig:function(t){t&&(this._config=t)},_setProperties:function(){this.$window=i(t),this.$body=i("body"),this.$layout=this._config.dropdownOptions.$layout||this.$body,this.$page=null,this.$button=this._config.dropdownOptions.$button,this.$popup=this.$elem,this.autoLayout=this._config.dropdownOptions&&n.tools.isPresent(this._config.dropdownOptions.autoLayout)?this._config.dropdownOptions.autoLayout:!0,this.yPosition=this._config.dropdownOptions.yPosition||"bottom",this.xPosition=this._config.dropdownOptions.xPosition||"right",this.yOffset=this._config.dropdownOptions.yOffset||10,this.xOffset=this._config.dropdownOptions.xOffset||0,this.$layout.length||(this.$layout=i(this.$layout.selector),this.$layout=this.$layout.length?this.$layout:this.$body),this._setContainer(),this._setClasses(),this._setContainerDefaultStyles()},_createElement:function(){this.$elem=i(i("#bm-button-read-dropdown-template").html()),this._parseRoles(),this.updateActions(),this._bindEvents()},_parseRoles:function(){this._actions=[this.$elemActionContinueReading=this.$elem.find("@action-continue-reading"),this.$elemActionBeginReading=this.$elem.find("@action-begin-reading"),this.$elemActionReopen=this.$elem.find("@action-reopen"),this.$elemActionShow=this.$elem.find("@action-show"),this.$elemActionHide=this.$elem.find("@action-hide"),this.$elemActionMarkAsRead=this.$elem.find("@action-mark-as-read"),this.$elemActionReadLater=this.$elem.find("@action-read-later"),this.$elemActionEmbedCode=this.$elem.find("@action-embed-code"),this.$elemActionBookMistake=this.$elem.find("@action-book-mistake"),this.$elemActionDownload=this.$elem.find("@action-download"),this.$elemActionRemove=this.$elem.find("@action-remove")]},_bindEvents:function(){var t=this;this.$elem.on(this.event,function(t){t.stopPropagation()}),this.$elemActionBeginReading.on(this.event,function(){t._onActionBeginReadingClick()}),this.$elemActionContinueReading.on(this.event,function(){t._onActionContinueReadingClick()}),this.$elemActionReopen.on(this.event,function(){t._onActionReopenClick()}),this.$elemActionHide.on(this.event,function(){t._onActionHideClick()}),this.$elemActionShow.on(this.event,function(){t._onActionShowClick()}),this.$elemActionReadLater.on(this.event,function(){t._onActionReadLaterClick()}),this.$elemActionMarkAsRead.on(this.event,function(){t._onActionMarkAsReadClick()}),this.$elemActionBookMistake.on(this.event,function(){t._onActionBookMistakeClick()}),this.$elemActionEmbedCode.on(this.event,function(){t._onActionEmbedCodeClick()}),this.$elemActionRemove.on(this.event,function(){t._onActionRemoveClick()})},_onActionBeginReadingClick:function(){var t=this;this.openReader(),this.trHide(function(){t._config.libraryCard.state=d.LCState.READING,t.updateActions()})},_onActionContinueReadingClick:function(){this.openReader()},_onActionBookMistakeClick:function(){this._showPopupBookMistake(),this.trHide()},_onActionEmbedCodeClick:function(){this._showPopupEmbedCode(),this.trHide()},_onActionReopenClick:function(){this._onActionBeginReadingClick()},_onActionHideClick:function(){this._setLibraryCardVisible(!1)},_onActionShowClick:function(){this._setLibraryCardVisible(!0)},_setLibraryCardVisible:function(t){var e=this;this.$elemActionHide.attr("wait","true"),this.$elemActionShow.attr("wait","true"),i.ajax({type:"put",dataType:"json",url:this._getLibraryCardApiUrl(),data:{library_card:{is_public:t}},error:function(){e.$elemActionHide.removeAttr("wait"),e.$elemActionShow.removeAttr("wait")},success:function(){setTimeout(function(){e.trHide(function(){e.$elemActionHide.removeAttr("wait"),e.$elemActionShow.removeAttr("wait"),e._config.libraryCard.is_public=t,e.updateActions()})},300)}})},_onActionReadLaterClick:function(){this.$elemActionReadLater.attr("wait","true"),this._updateLibraryCardState(d.LCState.PENDING)},_onActionMarkAsReadClick:function(){this.$elemActionMarkAsRead.attr("wait","true"),this._updateLibraryCardState(d.LCState.FINISHED)},_updateLibraryCardState:function(t){var e=this;i.ajax({url:this._getLibraryCardApiUrl(),type:"put",dataType:"json",data:{library_card:{state:t}},error:function(){e.$elemActionMarkAsRead.removeAttr("wait"),e.$elemActionReadLater.removeAttr("wait")},success:function(t){var n;n=e._getData(),n.libraryCard.state=t.state,o("user-library-card-state-update").broadcast(n),e._config.libraryCard.state=t.state,e.trHide(function(){e.$elemActionMarkAsRead.removeAttr("wait"),e.$elemActionReadLater.removeAttr("wait"),e.updateActions()})}})},setLCInfo:function(t){var e=this._config.libraryCard.actions;this._config.libraryCard=t,this._config.libraryCard.actions=e},updateActions:function(){this._config.libraryCard.state&&!n.tools.isNull(this._config.libraryCard.is_public)&&(this._updateActions(),this._updateActionsValues())},_updateActions:function(){switch(this._config.libraryCard.state){case d.LCState.READING:this.$elemActionBeginReading.attr("visible","false"),this.$elemActionContinueReading.removeAttr("visible"),this.$elemActionReopen.attr("visible","false"),this.$elemActionMarkAsRead.removeAttr("visible"),this.$elemActionReadLater.removeAttr("visible");break;case d.LCState.PENDING:this.$elemActionBeginReading.removeAttr("visible"),this.$elemActionContinueReading.attr("visible","false"),this.$elemActionReopen.attr("visible","false"),this.$elemActionMarkAsRead.removeAttr("visible"),this.$elemActionReadLater.attr("visible","false");break;case d.LCState.FINISHED:this.$elemActionBeginReading.attr("visible","false"),this.$elemActionContinueReading.attr("visible","false"),this.$elemActionReopen.removeAttr("visible"),this.$elemActionMarkAsRead.attr("visible","false"),this.$elemActionReadLater.removeAttr("visible")}switch(this._config.libraryCard.is_public){case d.Visibility.PUBLIC:this.$elemActionShow.attr("visible","false"),this.$elemActionHide.removeAttr("visible");break;case d.Visibility.HIDDEN:this.$elemActionShow.removeAttr("visible"),this.$elemActionHide.attr("visible","false")}this._config.libraryCard.is_uploaded===!0?this.$elemActionDownload.removeAttr("visible"):this.$elemActionDownload.attr("visible","false")},_updateActionsValues:function(){this._config.libraryCard&&this._config.libraryCard.uuid&&this.$elemActionDownload.attr("href","/"+n.user.getLogin()+"/"+this._config.libraryCard.uuid+"/download")},_onActionRemoveClick:function(){var e=this;t.confirm(this.$elemActionRemove.data("confirm-text"))&&this._config.libraryCard.uuid&&(this.$elemActionRemove.attr("wait","true"),i.ajax({url:this._getLibraryCardApiUrl(),type:"delete",dataType:"json",data:{library_card_uuid:this._getLibraryCardUuid()},error:function(){e.$elemActionRemove.removeAttr("wait")},success:function(r){var s,a="/"+n.user.getLogin()+"/"+e._getLibraryCardUuid();r&&null!==r.link_back?t.location.href=r.link_back:t.location.pathname===a&&"LibraryCardRoute"!==n.routerState?void 0!==e._config.book.uuid?t.location.href="/books/"+e._config.book.uuid:t.location.href="/library":t.location.pathname===a&&"LibraryCardRoute"===n.routerState?(i(".bm-popup-content-wrapper").trigger("click"),t.location.reload()):(e.trHide(function(){e._notify("library-card-removed")}),s=e._getData(),s.libraryCard.state=r.state,o("user-library-card-removed").broadcast(s))}}))},getElement:function(){return this.$elem},show:function(){this.open()},hide:function(){this.close(function(){this._notify("hide")}.bind(this))},trHide:function(t){this.close(function(){this._notify("hide"),t&&t()}.bind(this))},isVisible:function(){return this.isOpened()},_getLibraryCardUuid:function(){return this._config.libraryCard.uuid},_getLibraryCardApiUrl:function(){return"/"+n.user.getLogin()+"/"+this._getLibraryCardUuid()+".json"},openReader:function(){t.open(this._getReaderUrl(),"Bookmate Embedded Reader","toolbar=no,location=0,status=no,titlebar=no,menubar=no,width="+t.screen.width+",height="+t.screen.height)},_getReaderUrl:function(){return"/reader/"+this._config.document.uuid},setActionContinueReadingVisible:function(){this.$elemActionBeginReading.attr("visible","false"),this.$elemActionContinueReading.removeAttr("visible"),this.$elemActionReopen.attr("visible","false")},_showPopupBookMistake:function(){this.contentProblemPopup||(this.contentProblemPopup=new u({documentUuid:this._getData().document.uuid})),this.contentProblemPopup.open()},_showPopupEmbedCode:function(){a.setBookUuid(this._config.book.uuid),a.show()},destory:function(){this.$elem.remove(),this.$elem=null,h.destroy.apply(this,arguments)},_getData:function(){return{book:{uuid:this._config.book.uuid},document:{uuid:this._config.document.uuid},libraryCard:{uuid:this._config.libraryCard.uuid}}}}),e(c)})}(this,this.modules,this.BM,this.jQuery,this.radio),function(t,e,n,i){e.define("ButtonSocialShare",["baseView","DropDown"],function(e,o,r){var s=function(e){function o(){return _classCallCheck(this,o),_possibleConstructorReturn(this,e.apply(this,arguments))}return _inherits(o,e),o.prototype.initialize=function(t){e.prototype.initialize.apply(this,arguments),this.$elem&&0!==this.$elem.length&&(this._config={autoFetch:!0,dropdown:!0,url:null,title:null,description:null,image:null,twitter:{title:null,description:null,image:null},vkontakte:{title:null,description:null,image:null},utms:{facebook:null,twitter:null,vkontakte:null}},this.$elemContainer=this.$elem.find("@bm-button-social-share-dropdown-container"),this.$elemButtonFacebook=this.$elem.find("@bm-button-social-share-button-facebook"),this.$elemButtonVkontakte=this.$elem.find("@bm-button-social-share-button-vkontakte"),this.$elemButtonTwitter=this.$elem.find("@bm-button-social-share-button-twitter"),this._dropdown=null,this.setConfig(t),this.isDropdown()?this._initDropdown():this._initBlock(),this._parsePageMeta(),this._setupEvents())},o.prototype.setConfig=function(t){i.tools.isObject(t)&&(this._config=i.tools.mixin(this._config,t))},o.prototype._parsePageMeta=function(){this._config.url=t.location.href,this._config.title=n('meta[property="og:title"]').attr("content"),this._config.description=n('meta[property="og:description"]').attr("content"),this._config.image=n('meta[property="og:image"]').attr("content"),this._config.twitter.title=n('meta[property="twitter:title"]').attr("content"),this._config.twitter.description=n('meta[property="twitter:description"]').attr("content"),this._config.twitter.image=n('meta[property="twitter:image:src"]').attr("content"),this._config.vkontakte.image=n("head link[rel=image_src]").attr("href")},o.prototype._initDropdown=function(){i.tools.isNull(this._dropdown)&&(this._dropdown=new r({$button:this.$elem,$container:this.$elemContainer}))},o.prototype._initBlock=function(){},o.prototype._setupEvents=function(){var t=this,e=i.helper.event.clickName();this.$elemButtonFacebook.on(e,function(){t._openSharingWindow("http://facebook.com/sharer.php?"+n.param({u:t._getUrl("facebook")})),t._sendMixpanelEvent("fb")}),this.$elemButtonTwitter.on(e,function(){t._openSharingWindow("http://twitter.com/share?"+n.param({text:t._getTitle("twitter"),url:t._getUrl("twitter")})),t._sendMixpanelEvent("twitter")}),this.$elemButtonVkontakte.on(e,function(){var e=t._getTitle("vkontakte"),i=t._getDescription("vkontakte"),o=t._getUrl("vkontakte"),r=t._getImage("vkontakte"),s={};e&&(s.title=e),i&&(s.description=i),o&&(s.url=o),r&&(s.image=r),t._openSharingWindow("http://vkontakte.ru/share.php?"+n.param(s)),t._sendMixpanelEvent("vk")})},o.prototype._getTitle=function(t){var e=this._config.title;return i.tools.isUndefined(t)||("vkontakte"===t&&i.tools.isPresent(this._config.vkontakte.title)?e=this._config.vkontakte.title:"twitter"===t&&i.tools.isPresent(this._config.twitter.title)&&(e=this._config.twitter.title)),"auto"!==e?e:void 0},o.prototype._getDescription=function(t){var e=this._config.description;return i.tools.isUndefined(t)||("facebook"===t&&i.tools.isPresent(this._config.facebook.description)?e=this._config.facebook.description:"vkontakte"===t&&i.tools.isPresent(this._config.vkontakte.description)?e=this._config.vkontakte.description:"twitter"===t&&i.tools.isPresent(this._config.twitter.description)&&(e=this._config.twitter.description)),"auto"!==e?e:void 0},o.prototype._getUrl=function(t,e){var n=this._config.url;return this._config.facebook&&this._config.facebook.url&&"facebook"===t?n=this._config.facebook.url:this._config.vkontakte&&this._config.vkontakte.url&&"vkontakte"===t?n=this._config.vkontakte.url:this._config.twitter&&this._config.twitter.url&&"twitter"===t&&(n=this._config.twitter.url),i.tools.isUndefined(t)||e!==!0&&("facebook"!==t||i.tools.isNull(this._config.utms.facebook)?"twitter"!==t||i.tools.isNull(this._config.utms.twitter)?"vkontakte"!==t||i.tools.isNull(this._config.utms.vkontakte)||(n=i.helper.link.appendParam(n,this._config.utms.vkontakte)):n=i.helper.link.appendParam(n,this._config.utms.twitter):n=i.helper.link.appendParam(n,this._config.utms.facebook)),n},o.prototype._getImage=function(t){var e=this._config.image;return i.tools.isUndefined(t)||("facebook"===t&&i.tools.isPresent(this._config.facebook.image)?e=this._config.facebook.image:"vkontakte"===t&&i.tools.isPresent(this._config.vkontakte.image)?e=this._config.vkontakte.image:"twitter"==t&&i.tools.isPresent(this._config.twitter.image)&&(e=this._config.twitter.image)),"auto"!==e?e:void 0},o.prototype._sendMixpanelEvent=function(t){DIMixpanel.track("Share Button Pressed",{context:this._getMixpanelContext(),source:t})},o.prototype._getMixpanelContext=function(){return i.tools.isPresent(this._config.context)?this._config.context:void 0},o.prototype._openSharingWindow=function(e){t.open(e,"","toolbar=0,status=0,width=626,height=436")},o.prototype._getTemplateName=function(t){var e=t?t.dropdown:!0,n="undefined"==typeof e?!0:e;return n?"bm-button-social-share-template":"bm-block-social-share-template"},o.prototype.isDropdown=function(){return this._config.dropdown},o}(o);e(s)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){"use strict";var r=function(t,e,i,o){var r=e(o),s=r,a=s.superclass;n.extend(s.prototype,{initialize:function(t){this._element=null,this._canvas=null,this._context=null,this._strokeWidth=20,this._circleColor="rgba(241, 241, 241, 0.4)",this._totalProgress=0,a.initialize.apply(this,arguments),i.isUndefined(t)||this.setConfig(t),this._element&&this._init()},setConfig:function(t){i.isUndefined(t)||(i.isUndefined(t.element)||this.setElement(t.element),i.isUndefined(t.strokeWidth)||this.setStrokeWidth(t.strokeWidth),i.isUndefined(t.circleColor)||this.setCircleColor(t.circleColor))},setElement:function(t){i.isUndefined(t)||(t instanceof n?this._element=t:this._element=n(t))},setStrokeWidth:function(t){i.isUndefined(t)||(this._strokeWidth=t)},setCircleColor:function(t){i.isUndefined(t)||(this._circleColor=t)},setProgress:function(t){i.isNumber(t)&&(this._totalProgress=t,this.render())},_init:function(){this._initCanvas(),this._appendCanvas()},_initCanvas:function(){var t=this._getElementSize();this._canvas=n("<canvas>"),this._canvas.css({left:"0",position:"absolute",top:"0",transform:"rotate(-90deg)"}),this._canvas.get(0).width=t.width,this._canvas.get(0).height=t.height,this._context=this._canvas.get(0).getContext("2d")},_appendCanvas:function(){var t=this._element.css("position");"static"===t&&this._element.css("position","relative"),this._element.append(this._canvas)},_getElementSize:function(){return{height:this._element.height(),width:this._element.width()}},render:function(){var t=this._getElementSize(),e=this._totalProgress/100*(2*Math.PI),n=this._canvas.get(0);n.width=n.width,this._context.beginPath(),this._context.arc(t.width/2,t.height/2,t.width/2-this._strokeWidth/2-1,0,e,!1),this._context.strokeStyle=this._circleColor,this._context.lineWidth=this._strokeWidth,this._context.stroke()}}),t(r)};i.define("canvasProgress",["extend","tools","baseClass"],r)}(this,this.document,this.jQuery,this.modules,this.radio),function(t,e,n,i){e.define("ButtonWithUsers",["baseView","UserCollection"],function(t,e,n){var o=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments),this._config={},i.tools.isObject(e)&&(this._config=i.tools.mixin(this._config,e)),this.$elemContent=this.$elem.find("@bm-button-with-users-content"),this._currentItems=[],this._coll=null,this._initColl(),this._bindEvents(),this._update()},e.prototype.push=function(t){var e=this;if(i.tools.isPresent(t)){if(i.tools.isArray(t))return void t.forEach(function(t){return e.push(t)});this._coll.push(t),this._renderUsers()}},e.prototype._bindEvents=function(){var t=this;this.$elem.on(i.helper.event.clickName(),function(){t._notify("press")})},e.prototype._initColl=function(){var t=this;i.tools.isNull(this._coll)&&(this._coll=new n,this._coll.on("change",function(){t._renderUsers()}))},e.prototype._update=function(){this._config&&this._config.type&&this.$elem.attr("data-type",this._config.type)},e.prototype._renderUsers=function(){var t=this,e=this._coll.getItems(3);i.tools.isArray(e)&&e.forEach(function(e){var n=e.view.getClone();t.$elemContent.has(n).length>0||(t.$elemContent.append(n),t._currentItems.push(e))})},e.prototype._getTemplateName=function(){return"bm-button-with-users-template"},e}(e);t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e){"use strict";e.widget("custom.carousel",{_init:function(t){this._$wrapper=this.element.find(".bm-carousel-wrapper"),this._$arrowLeft=this.element.find(".icon-left"),this._$arrowRight=this.element.find(".icon-right"),this._$gradientLeft=this.element.find(".bm-carousel-gradient-left"),this._$gradientRight=this.element.find(".bm-carousel-gradient-right"),this.width=this.element.width(),this.wrapperWidth=this._$wrapper[0].scrollWidth,this._initListeners()},_initListeners:function(){var t=this;this._$arrowLeft.on("click",function(e){e.preventDefault(),t._scrollTo(t._$wrapper.scrollLeft()-t.width)}),this._$arrowRight.on("click",function(e){e.preventDefault(),t._scrollTo(t._$wrapper.scrollLeft()+t.width)});var e=function(e){var n=t._$wrapper.scrollLeft()+(t.width-t.wrapperWidth),i=t._$wrapper.scrollLeft();t._$arrowLeft.toggleClass("disabled",0===i),t._$arrowRight.toggleClass("disabled",0===n)};e(),this._$wrapper.on("scroll",debounce(e,50))},_scrollTo:function(t){this._$wrapper.animate({scrollLeft:t},600)},destroy:function(){}})}(this,this.jQuery),function(t,e){"use strict";var n=30,i=e.custom.carousel;e.widget("custom.updateableCarousel",i,{_init:function(t){i.prototype._init.apply(this,arguments),this.element.addClass("bm-carousel-updateable"),this.isTransition=!1,this.scrollTimeout},_initListeners:function(){var t=this;i.prototype._initListeners.apply(this,arguments),t._$wrapper.on("scroll",function(){t.isTransition=!0,clearTimeout(t.scrollTimeout),t.scrollTimeout=setTimeout(function(){t.isTransition=!1},5e3)})},_scrollTo:function(t){var e=this;this.isTransition=!0,this._$wrapper.animate({scrollLeft:t},600,function(){setTimeout(function(){e.isTransition=!1},5e3)})},_animatedInsert:function(t){var i=this,o=0,r=[],s=this._$wrapper.find(".bm-carousel-block.ready");if(this._removePreparedToDelete(),0!==t.length){for(var a=0;a<t.length;a++){var u=e('<div class="bm-carousel-block ready">'+t[a]+"</div>");u.addClass("invisible"),r.push(u),this._$wrapper.append(u),o+=u.width(),s.length>n&&this._hideBlock(s[s.length-(a+1)])}this._$wrapper.transitionEnd(function(){i._$wrapper.unbindTransitionEnd(),i._$wrapper.css("transition","none"),i._$wrapper.css("transform","translate3d(0, 0, 0)");for(var t=0;t<r.length;t++){var e=r[t];i._$wrapper.prepend(e),function(t){setTimeout(function(){t.removeClass("invisible")},16)}(e)}}),this._$wrapper.css("transition","all 300ms cubic-bezier(0.860, 0.000, 0.070, 1.000)"),this._$wrapper.css("transform","translate3d("+(o+50*t.length+"px")+", 0, 0)")}},_hideBlock:function(t){var n=this,i=e(t);i.transitionEnd(function(){i.unbindTransitionEnd(),i.addClass("hidden"),setTimeout(function(){n._removePreparedToDelete()},16)}).removeClass("ready").addClass("invisible delete")},_removePreparedToDelete:function(){this._$wrapper.find(".delete, .delete:hidden").remove()},update:function(t){e(t);this.isTransition||this._animatedInsert(t)},destroy:function(){i.prototype._init.apply(this,arguments)}})}(this,this.jQuery),function(t,e,n,i){"use strict";var o=function(t,e){var i=function(){var t=function(t,e){var i=this;i.$input=t,i.$b=n('<div class="'+i.$input[0].className+'-counter"></div>'),i.maxLength=i.$input.attr("maxlength"),i.init()};return t.prototype={init:function(){var t=this;t.$input.after(t.$b),t.$input.on("keyup.charcounter",function(){t.$b.html(t.$input.val().length+"/"+t.maxLength)}).trigger("keyup.charcounter")}},t}();e.CharCounter=i,t(i)};i.define("CharCounter",["modules"],o)}(this,this.document,this.jQuery,this.modules),function(t,e,n,i,o){"use strict";n.define("BookshelvesListItemProcessor",["modules","TemplateFactory"],function(t,n,r){var s=function(){var t=function(){var t=this;t.bgTemplateFactory=new r("#bm-bookshelf-list-item-bg-template"),t.imageTemplateFactory=new r("#bm-bookshelf-list-item-image-template"),moment.locale(i.config.mainConfig.locale)};return t.prototype={getItem:function(t){var n,r,s,a,u=this;return t.cover?(n=u.imageTemplateFactory.getInstance(),n.find(".bm-bookshelf-list-item-cover img").attr("src",t.cover)):n=u.bgTemplateFactory.getInstance(),r=n.find("button"),s=r.data("followmsg"),a=r.data("unfollowmsg"),n.data("uuid",t.uuid),i.user.isUserPresent()&&i.user.getLogin()===t.creator.login&&n.addClass("current-user"),n.find(".bm-bookshelf-list-item-link").attr("href","/bookshelves/"+t.uuid),n.find(".bm-bookshelf-list-item-desc-title").html(t.title).dotdotdot({fallbackToLetter:!0}),n.find(".update-timestamp").html(moment(1e3*t.last_document_at-9e4).fromNow(!0)),t.last_document_at&&n.find(".bm-bookshelf-list-item-desc-stats-update").removeClass("hidden"),n.find(".bm-bookshelf-list-item-desc-stats-followers .bm-bookshelf-list-item-desc-stats-item-value").html(t.followers_count||0),n.find(".bm-bookshelf-list-item-desc-stats-bookcount .bm-bookshelf-list-item-desc-stats-item-value").html(t.documents_count||0),n.find(".bm-bookshelf-list-item-user").attr("href","/"+t.creator.login).find("img").attr("src",t.creator.avatar_url),n.find(".bm-bookshelf-list-item-user-name").html(t.creator.name||t.creator.login),t.creator.login===i.user.getLogin()?r.remove():(t.following?(r.data("following",!0),r.html(a)):(r.data("following",!1),r.html(s)),r.on("click",function(){var n=r.data("following"),i=n?"/a/4/bs/"+t.uuid+"/unfollow.json":"/a/4/bs/"+t.uuid+"/follow.json";r.attr("wait",!0),r.attr("disabled","disabled"),e.ajax({url:i,method:"post",success:function(){n=!n,r.removeAttr("wait"),r.removeAttr("disabled"),n?(r.html(a),o.track("Shelf Follow",{shelf_name:t.uuid})):r.html(s),r.data("following",n)}})})),n}},t}();n.ItemProcessor=s,t(s)})}(this,this.jQuery,this.modules,this.BM,this.DIMixpanel),function(t,e,n,i,o,r){"use strict";n.define("BookshelvesListInitializer",["modules","BookshelvesListItemProcessor","loginWindow"],function(n,s,a,u){var l=function(){var n=function(t,n){var i=this;i.$b=t||e(".bm-bookshelf-list-wrapper"),i.$blank=e("@bookshelves-list-blank"),i.$loader=e("@bookshelves-list-loader"),i.itemProcessor=new a,i.options=n||{},i.options.pagingAllowed&&(i.pagingUrl=i.options.pagingUrl,i.pageLoading=!1,i.pageCount=i.options.pageCount||2,i.pageSize=12),i.init()};return n.prototype={init:function(){var n=this,s=new u({context:"bookshelf_subscribe",preventDefaultLoginBehavior:!0});if(r.locale(i.config.mainConfig.locale),n.$b.find(".bm-bookshelf-list-item").each(function(t,n){var a=e(n),u=a.find(".bm-bookshelf-list-item-desc-title"),l=a.find("button"),c=a.find(".bm-bookshelf-list-item-desc-stats-update"),d=a.find(".update-timestamp"),h=a.find(".bm-bookshelf-list-item-desc-stats-followers .bm-bookshelf-list-item-desc-stats-item-value"),p=a.data("uuid"),f=l.data("followmsg"),m=l.data("unfollowmsg"),g=parseInt(h.html(),10),b=(a.find(".bm-bookshelf-list-item-user"),function(){h.html(++g)}),_=function(){h.html(--g)},y=function(){e.ajax({url:"/a/4/bs/"+p,method:"get",success:function(t){v(!0,t.following)}})},v=function(t,n){var r="boolean"==typeof n?n:l.data("following"),s=r?"/a/4/bs/"+p+"/unfollow.json":"/a/4/bs/"+p+"/follow.json";l.attr("wait",!0),l.attr("disabled","disabled"),e.ajax({url:s,method:"post",success:function(){r=!r,l.removeAttr("wait"),l.removeAttr("disabled"),r?(b(),l.html(m),o.track("Shelf Follow",{shelf_name:p})):(_(),l.html(f)),l.data("following",r),t&&i.tools.reload()}})};u.dotdotdot({fallbackToLetter:!0});var w=parseInt(d.html(),10);w&&(d.html(r(1e3*w-9e4).fromNow(!0)),c.removeClass("hidden")),l.on("click",function(){i.user.isUserPresent()?v():(s.showWindow("inital"),s.on("authenticationSuccessful",function(){y()}))})}),n.$b.on("click",".bm-bookshelf-list-item-link",function(i){var r=!(i.metaKey||i.ctrlKey);r&&i.preventDefault();var s=this.href,a=e(this).closest(".bm-bookshelf-list-item"),u=a.data("uuid"),l=a.data("mixpanel-ctx");o.discovered.set({channel:"shelf",ctx:l,uuid:u}),o.track("Shelf Selected",{shelf_name:u,context:n.options.context}),setTimeout(function(){r&&(t.location.href=s)},150)}),n.options.pagingAllowed){var a=e(t);a.on("scroll.bookshelveslist",function(){n.preventPageLoad&&a.off("scroll.bookshelveslist"),a.scrollTop()+a.height()>n.$b.offset().top+n.$b.height()&&!n.pageLoading&&n.loadMoreShelves()})}n.options.autoFetch&&this.loadMoreShelves()},loadMoreShelves:function(){var t=this;t.pageLoading=!0,t.$loader.show(),e.ajax({url:t.pagingUrl+"?pp="+t.pageSize+"&p="+t.pageCount,success:function(e){if(t.$loader.hide(),0===e.length)return t.pageLoading=!1,t.preventPageLoad=!0,void(1===t.pageCount&&t.$blank.show());for(var n=0;n<e.length;n++)t.$b.append(t.itemProcessor.getItem(e[n]));t.pageCount++,setTimeout(function(){t.pageLoading=!1},16)}})}},n}();s.BookshelvesListInitializer=l,n(l)})}(this,this.jQuery,this.modules,this.BM,this.DIMixpanel,this.moment),function(t,e,n,i,o,r){"use strict";o.define("dynamicContent",["extend","PubSub"],function(t,e,i){var o=e(i),r=o,s=r.superclass,a={FADE:1,SLIDE:2},u=150;n.tools.mixin(r.prototype,{initialize:function(t){s.initialize.apply(this,arguments),this._element=null,t&&(this.setElement(t.element),this._effect=a.FADE,this._firstStep=this._getStepInitial(),this.setConfig(t),this._currentElement=this._firstStep,this._stepsStack=[],this._updateInProgress=!1,this._timeoutTransitionEnd=null)},setConfig:function(t){n.tools.isUndefined(t)||(n.tools.isUndefined(t.element)||this.setElement(t.element),n.tools.isUndefined(t.effect)||this.setDynamicEffect(t.effect),n.tools.isUndefined(t.firstStep)||this.setFirstStep(t.firstStep))},setElement:function(t){n.tools.isUndefined(t)||(this._element=t)},setDynamicEffect:function(t){n.tools.isUndefined(t)||(this._effect=t)},setFirstStep:function(t){var e;n.tools.isUndefined(t)||(e=this._getStep(t),e.length>0&&(this._firstStep=e))},_updateSize:function(t){return},update:function(){},reset:function(){this.setStep(this._getStepFirst().attr("data-step"))},clearHeight:function(){this._element.css("height","")},clearStepsStack:function(){this._stepsStack.length=0,this._stepsStack=[]},showStep:function(t,e,i,o){if(this._isCurrentStep(t)||!this._isStepExist(t)||this.isUpdateInProgress())return void(i===!0&&n.tools.isFunction(e)&&e());var r,s=this,a=this._currentElement,u=a.attr("data-step"),l=this._getStep(t),c=a.height();this._updateInProgress=!0,
o!==!0&&this._stepsStack.push(a.attr("data-step")),this._notify("fade-out-start",u,t),this._fadeOut(function(){s._notify("fade-out-end",u,t),s._setHeightNoTransition(c),s.setStep(t),r=l.height(),s._notify("resize-start",u,t),s._element.css("height",r),setTimeout(function(){s._notify("resize-end",u,t),s._notify("fade-in-start",u,t),s._fadeIn(function(){s._notify("fade-in-end",u,t),s._setHeightNoTransition(""),n.tools.isFunction(e)&&e(),s._updateInProgress=!1})},350)})},showPreviousStep:function(){var t=this._stepsStack.pop();n.tools.isUndefined(t)||this.showStep(t,function(){},!1,!0)},isStepsStackEmpty:function(){return 0===this._stepsStack.length},setStep:function(t){var e=this._getStep(t);e.length>0&&(this._element.find("> [data-step]").removeClass("visible"),e.addClass("visible"),this._currentElement=e)},_getStep:function(t){return this._element.find("> [data-step="+t+"]")},_getStepInitial:function(){var t;return t=this._element.find(".visible[data-step]"),t=t.length>0?t.eq(0):this._getStepFirst()},_getStepFirst:function(){return this._element.find("> [data-step]").eq(0)},_isStepExist:function(t){return this._element.find("> [data-step="+t+"]").length>0},isUpdateInProgress:function(){return this._updateInProgress},_isCurrentStep:function(t){return this._currentElement.attr("data-step")===t.toString()},showNext:function(){},showPrev:function(){},_fadeOut:function(t){this._unbindTransitionEnd(),this._bindTransitionEnd(t),this._element.attr("visible","false")},_fadeOut2:function(t){this._unbindTransitionEnd(),this._bindTransitionEnd(t),this._element.attr("visible","false")},_fadeIn:function(t){this._unbindTransitionEnd(),this._bindTransitionEnd(t),this._element.removeAttr("visible")},_unbindTransitionEnd:function(){this._useTransitions()?this._element.unbindTransitionEnd():n.tools.isNull(this._timeoutTransitionEnd)||(clearTimeout(this._timeoutTransitionEnd),this._timeoutTransitionEnd=null)},_bindTransitionEnd:function(t){t=t||function(){},this._useTransitions()?this._element.transitionEnd(function(){this._unbindTransitionEnd(),t(),this._notify("fade-in-end")}.bind(this)):this._timeoutTransitionEnd=setTimeout(function(){this._unbindTransitionEnd(),t(),this._notify("fade-in-end")}.bind(this),u)},_useTransitions:function(){return!n.features.browser.isSafari()},collapse:function(){return this._fadeOut(function(){this._updateSize(0)}.bind(this))},getCurrentStepName:function(){return this._currentElement.attr("data-step")},_setHeightNoTransition:function(t){this._element.attr("data-no-transition","true"),this._triggerRender(),this._element.css("height",t),this._triggerRender(),this._element.removeAttr("data-no-transition")},_triggerRender:function(){this._element.get(0).offsetHeight}}),t(o)})}(this,this.document,this.BM,this.jQuery,this.modules,this.radio),function(t,e,n,i){n.define("DocumentBaseView",["ampersandView","documentUtils"],function(n,i,o){var r=i.extend({selfClick:function(t){$(t.target).hasClass("bm-document-popup-tools-share")||this.closeSharePopup(),e("close-dropdowns").broadcast()},shareFb:function(t){var e={u:this.model.book_url};this.shareBook("http://facebook.com/sharer.php?"+$.param(e)),this.trackSharing("Facebook")},shareTw:function(t){var e={url:this.model.book_url,text:o.sliceString({length:140,prefix:this.model.book_url,suffix:[this.model.title,this.model.authors]})};this.shareBook("http://twitter.com/share?"+$.param(e)),this.trackSharing("Twitter")},shareVk:function(t){var e={title:this.model.title,description:this.model.annotation?this.model.annotation.slice(0,100)+"":"",url:this.model.book_url,image:this.model.cover.url};this.shareBook("http://vkontakte.ru/share.php?"+$.param(e)),this.trackSharing("VK")},shareBook:function(e){t.open(e,"","toolbar=0,status=0,width=626,height=436")},trackSharing:function(t){DIMixpanel.track("Share Button Pressed",{source:t,context:"book"})},closeSharePopup:function(){this.shareDropDown.close()},appInstall:function(t){var e=$(t.target).data("platform");DIMixpanel.track("Install App Button Pressed",{app:e})},condenseAnnotation:function(){this.$annotation=$(this.el).find("@bookpage-annotation"),this.$annotation.condense({moreText:this.$annotation.data("more"),lessText:this.$annotation.data("less"),delim:".",ellipsis:"",moreSpeed:"fast",lessSpeed:"fast",condensedLength:600})}});n(r)})}(this,this.radio,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("documentBindings",["Pluralizer","moduleBookBadge"],function(t,e,i){var o=n.config.mainConfig.locale;"en"!==o&&"sv"!==o&&"uk"!==o&&"nl"!==o&&"da"!==o||e.setLocale("en_standart");var r={labels:{hook:"label",type:function(t,e){if(e){var n=this;e=_.pluck(e,"kind"),$(t).find(".bm-ui-badge").each(function(){var t=$(this).data("type");if(e.indexOf(t)>=0&&($(this).removeClass("hidden"),"free"!==t)){if($(this).data("book-badge-inited"))return;new i({element:$(this),document:n.model})}}),this.model.litres_spot&&$(t).find(".bm-ui-badge.m-litres").removeClass("hidden")}}},pluralized_count:{type:function(t,i){var o=$(t).data("name"),r=n.tools.rubyHashString2JSON(o),s=r[e.pluralize(i)];$(t).html(i+"&nbsp;"+s)}}};t(r)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n){"use strict";e.define("DocumentBookshelvesListFullView",["DocumentBookshelvesListView"],function(t,e){var i=function(t){function e(n){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,t.call(this,n));return i.hideCount=!1,i.elSelector="@bm-document-bookshelves-aside",i.parentSelector=".bm-document-slide-additional._bookshelves",i}return _inherits(e,t),e.prototype._setEventListeners=function(){},e.prototype._preRender=function(){n(n("#bm-document-slide-additional-bookshelves").html()).appendTo(this.$parent.find(this.parentSelector))},e.prototype.showLoader=function(){this.$loader&&this.$loader.show()},e.prototype.hideLoader=function(){this.$loader&&this.$loader.hide()},e}(e);t(i)})}(this,this.modules,this.jQuery),function(t,e,n){"use strict";e.define("DocumentBookshelvesListView",["PubSub","BookshelfResourceItemProcessor"],function(e,i,o){var r=function(e){function i(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,i);var n=_possibleConstructorReturn(this,e.call(this,t));return n.options=t,n.rendered=!1,n.hideCount=!0,n.elSelector="@bm-document-bookshelves",n}return _inherits(i,e),i.prototype._setParentElement=function(){this.$parent=this.options.parent_view.$main.parent()},i.prototype._setElements=function(){this.$el=this.$parent&&this.$parent.length?this.$parent.find(this.elSelector):n(this.elSelector),this.$container=this.$el.find("@bm-document-bookshelves-container"),this.$count=this.$el.find("@bm-document-bookshelves-count"),this.$loader=this.$el.find("@bm-document-bookshelves-loader"),this.$btn=this.$el.find("@bm-document-bookshelves-btn")},i.prototype._setEventListeners=function(){var t=this;this.$btn.on("click",function(e){return t.showAdditional(e)})},i.prototype._renderMeta=function(){var t=this.options.bookshelves_count||0;this.$count.text(t),(!this.hideCount||t>3)&&this.$count.removeClass("hidden"),t&&this.$el.removeClass("hidden"),this.rendered=!0},i.prototype.render=function(e){var i=this;this.$el||(this._setParentElement(),this._preRender&&this._preRender(),this._setElements(),this._setEventListeners(),this._renderMeta());var r={effect:"fadeIn",threshold:300,placeholder:""};n('.bm-document-popup-root[visible="true"]').length&&(r.container=n('.bm-document-popup-root[visible="true"] .bm-popup-content-wrapper')),e.forEach(function(e){var n=t.location.pathname.split("/")[2];e.discovered="book",e.discovered_id=n;var s=o.getItem(e);s.find("img").removeAttr("src").lazyload(r),i.$container.append(s)})},i.prototype.showAdditional=function(t){t.preventDefault(),this._notify("show:additional")},i.prototype.isRendered=function(){return this.rendered},i}(i);e(r)})}(this,this.modules,this.jQuery),function(t,e,n){"use strict";e.define("documentBookshelvesModule",["PubSub","DocumentBookshelvesListView","DocumentBookshelvesListFullView"],function(t,e,i,o){var r=function(t){function e(){var n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,e);var i=_possibleConstructorReturn(this,t.call(this,n));return i.options=n,i.nextPage=1,i.enabled=!0,i.count=n.bookshelves_count||0,i.documentUuid=n.document_uuid,i._setEventListeners(),i._initListView(),i._initListFullView(),i.fetch(),i}return _inherits(e,t),e.prototype._setEventListeners=function(){var t=this;this.on("scroll:reaches:bottom",function(){return t.fetch()})},e.prototype._initListView=function(){this.view=new i(this.options)},e.prototype._initListFullView=function(){this.fullView=new o(this.options)},e.prototype._handleRes=function(t){this.enabled=t.length;var e=t.map(function(t){return t.bookshelf});this.view.isRendered()||this.view.render(e.slice(0,3)),this.fullView.render(e)},e.prototype.fetch=function(){var t=this;this.enabled&&(this.enabled=!1,this.fullView.showLoader(),n.ajax({url:"/a/4/d/"+this.documentUuid+"/bookshelf_documents.json",data:{p:this.nextPage,pp:20},success:function(e){t.fullView.hideLoader(),t.nextPage+=1,t._handleRes(e)},error:function(e){t.fullView.hideLoader()}}))},e}(e);t(r)})}(this,this.modules,this.jQuery),function(t,e,n){e.define("DocumentExternalLinkModel",["ampersandModel"],function(t,e){var n=e.extend({props:{url:"string",title:"string",description:"string",image:"string"},derived:{url_text:{deps:["url"],fn:function(){return this.url}}}});t(n)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("DocumentExternalLinkView",["ampersandView"],function(t,e){var n=e.extend({template:$("#bm-document-external-link").html(),bindings:{"model.url":{type:function(t,e,n){var i=-1===e.indexOf("http://")?"http://"+e:e;$(t).attr("href",i)},hook:"url"},"model.url_text":{type:function(t,e,n){var i=e.replace("http://","").split("/")[0];$(t).text(i)},hook:"url_text"},"model.title":{type:"text",hook:"title"},"model.description":{type:"text",hook:"description"},"model.image":{type:"attribute",name:"src",hook:"image_url"}}});t(n)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n,i){e.define("DocumentImpressionsView",["extend","baseView","dynamicContent"],function(t,e,o,r){var s=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments),this._hasElement()&&(this._impressionFormDC=null,this.$elemWrapper=this.$elem.find("@bm-document-impressions-wrapper"),this.$elemButtonImpressionsCount=this.$elem.find("@bm-document-impressions-count"),this.$elemButtonAdd=this.$elem.find("@bm-document-impressions-button-add"),this.$elemButtonAddEmpty=this.$elem.find("@bm-document-impressons-empty-button-add"),this.$elemImpressionGroup=this.$elem.find("@bm-document-impressions-group"),this.$elemImpressionGroupAll=this.$elem.find("@bm-document-impressions-group-all"),this.$elemImpressionGroupAllContent=this.$elem.find("@bm-document-impressions-group-all-content"),this.$elemHeader=this.$elem.find("@bm-document-impressions-header"),this.$elemButtonAllWrapper=this.$elem.find("@bm-document-impressions-button-all-wrapper"),this.$elemControls=this.$elem.find("@bm-document-impressions-controls"),this.$elemImpressionFormDC=this.$elem.find("@bm-document-impression-form-dynamic-content"),this.$elemImpressionFormWrapper=this.$elem.find("@bm-document-impression-form-wrapper"),this.$elemEmotionsCarousel=this.$elem.find("@bm-document-impressions-emotions-carousel"),this.$dc=this.$elem.find("@bm-document-impressions-wrapper-dynamic-content"),this._emojiCarouselInterval=[],this._initDynamicContent(),this._initEmotionsCarousel(),this._bindEvents())},e.prototype.appendImpressionGroup=function(t){t&&this.$elemImpressionGroup.append(t)},e.prototype.appendImpressionGroupAll=function(t){t&&this.$elemImpressionGroupAllContent.append(t)},e.prototype.appendImpressionForm=function(t){t&&this.$elemImpressionFormWrapper.append(t)},e.prototype.appendButtonAllImpressions=function(t){t&&this.$elemButtonAllWrapper.append(t)},e.prototype.setButtonImpressionsCountValue=function(t){i.tools.isNumber(t)&&t>0?(this.$elemButtonImpressionsCount.html(t),this.$elemButtonImpressionsCount.removeAttr("hidden"),this.$elemButtonImpressionsCount.removeClass("m-hidden")):(this.$elemButtonImpressionsCount.addClass("m-hidden"),this.$elemButtonImpressionsCount.attr("hidden","hidden"))},e.prototype.setButtonAddStateEdit=function(t){t?this.$elemButtonAdd.addClass("m-state-edit"):this.$elemButtonAdd.removeClass("m-state-edit")},e.prototype.setButtonCountDisabled=function(t){t?this.$elemButtonImpressionsCount.attr("disabled","disabled"):this.$elemButtonImpressionsCount.removeAttr("disabled")},e.prototype.setButtonAddImpressionStateVisible=function(t){t?this.$elemButtonAdd.removeClass("m-hidden"):this.$elemButtonAdd.addClass("m-hidden")},e.prototype.setButtonAllStateVisible=function(t){t?this.$elemButtonAllWrapper.removeClass("m-hidden"):this.$elemButtonAllWrapper.addClass("m-hidden")},e.prototype.setControlsVisible=function(t){t?this.$elemControls.removeClass("m-hidden"):this.$elemControls.addClass("m-hidden")},e.prototype.setButtonAllUsers=function(t){i.tools.isArray(t)},e.prototype.setSeparatorVisible=function(t){t?this.$elemWrapper.addClass("m-separator-visible"):this.$elemHeader.removeClass("m-separator-visible")},e.prototype.setGroupStateVisible=function(t){t?this.$elemImpressionGroup.removeClass("m-hidden"):this.$elemImpressionGroup.addClass("m-hidden")},e.prototype.setStateVisible=function(t){},e.prototype.get$dc=function(){return this.$dc},e.prototype._bindEvents=function(){var t=this;this.$elemButtonAdd.on(i.helper.event.clickName(),function(e){t._onButtonAddClick()}),this.$elemButtonAddEmpty.on(i.helper.event.clickName(),function(e){t._onButtonAddClick()}),this.$elemButtonImpressionsCount.on(i.helper.event.clickName(),function(e){t._onButtonCountClick()})},e.prototype._onButtonAddClick=function(){this._notify("button-add-click")},e.prototype._onButtonCountClick=function(){this._notify("button-count-click")},e.prototype._initDynamicContent=function(){i.tools.isNull(this._impressionFormDC)&&(this._impressionFormDC=new r({element:this.$elemImpressionFormDC}))},e.prototype._initEmotionsCarousel=function(){var t=this,e=this.$elemEmotionsCarousel.data("item-template");i.helper.emotions.getAll(function(o){o.forEach(function(o){var r=n(e).html(o.unicode);i.lib.emoji.supported()||(r.addClass("m-as-image"),i.lib.emoji.replace(r)),t.$elemEmotionsCarousel.append(r)})}),i.tools.support.cssAnimations()||this._initEmotionsCarouselInterval()},e.prototype._initEmotionsCarouselInterval=function(){var t=this;this.$elemEmotionsCarousel.each(function(){var e=n(this),i=e.find(".item").length,o=0;e.addClass("m-no-animations"),t._emojiCarouselInterval.push(setInterval(function(){return 0===i?void(i=e.find(".item").length):(o+=1,o>=i&&(o=0),void t.$elemEmotionsCarousel.css({left:50*o*-1}))},250))})},e.prototype._clearEmotionsCarouselInterval=function(){i.tools.isArray(this._initEmotionsCarouselInterval)&&(this._emojiCarouselInterval.forEach(function(t){clearInterval(t)}),this._emojiCarouselInterval.length=0,this._emojiCarouselInterval=[])},e.prototype._showImpressionFormStateLoading=function(){i.tools.isNull(this._impressionFormDC)||this._impressionFormDC.showStep("loading")},e.prototype.destroy=function(){t.prototype.destroy.apply(this,arguments),this._clearEmotionsCarouselInterval()},e}(o);t(s)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){"use strict";e.define("documentImpressionsModule",["PubSub","ampersandState","ImpressionItemGroup","DocumentImpressionsView","ImpressionForm","ButtonWithUsers","dynamicContent","loginWindow"],function(t,e,o,r,s,a,u,l,c){var d=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){var n=this;t.prototype.initialize.apply(this,arguments),this.config=e,this.view=null,this.impressionGroup=null,this.impressionGroupAll=null,this.impressionForm=null,this.buttonAll=null,this.dc=null,this.loginWindow=null,this._focusCurrentUserImpression=!1,this._fetchCounter=0,this._state={group:!1,buttonAdd:!1,buttonAll:!1,controls:!1},setTimeout(function(){n._initView(),n._initDynamicContent(),n._initImpressionGroup(),n._initImpressionGroupAll(),n._initImpressionForm(),n._initButtonAll(),n._bindEvents()},300)},e.prototype.getCurrentUserImpression=function(){var t=this,e=!1;return i.user.isUserPresent()&&this.impressionGroup.coll.find(function(n){var o=n.model.data,r=o.user.model.data;r.login===i.user.getLogin()&&o.document_uuid===t.config.document_uuid&&(e=n)}),e},e.prototype._bindEvents=function(){var t=this;this.view&&(this.view.on("button-add-click",function(){i.user.present()?t._showImpressionForm():t._showLoginWindow()}),this.view.on("button-count-click",function(){t._state.buttonCountDisabled||t._notify("all-impressions-button-press")})),radio("bm-model-remove-success").subscribe(function(e){i.tools.isObject(e)&&e.uuid===t.config.document_uuid&&e.user&&e.user.login===i.user.login()&&t._decreaseImpressionsCount()})},e.prototype._initState=function(){var t=new(o.extend({}));Object.defineProperty(this,"state",{get:function(){return t}})},e.prototype._initView=function(){this.view=new s({element:n(this.config.parent_view.el)}),this.view.setStateVisible(!0),this.view.setButtonImpressionsCountValue(this.config.impressions_count)},e.prototype._initDynamicContent=function(){i.tools.isNull(this.dc)&&(this.dc=new l({element:this.view.get$dc()}))},e.prototype._initImpressionGroup=function(){var t=this;this.impressionGroup=new r({data:{collection:{data:{document_uuid:this.config.document_uuid},pagination:{p:1,pp:3}}}}),this.impressionGroup.on("fetch-success",function(){t._onImpressionsFetchSuccess()}),this.impressionGroup.fetch(),this.view.appendImpressionGroup(this.impressionGroup.view.el)},e.prototype._initImpressionGroupAll=function(){var t=this;this.impressionGroupAll=new r({data:{collection:{data:{document_uuid:this.config.document_uuid},pagination:{p:1,pp:20}}}}),this.impressionGroupAll.on("fetch-success",function(){t._onImpressionsAllFetchSuccess()}),this.view.appendImpressionGroupAll(this.impressionGroupAll.view.el),this.impressionGroupAll.fetch()},e.prototype.setImpressionsAllFetchByScroll=function(t){this.impressionGroupAll&&this.impressionGroupAll.setPaginationByScroll(t)},e.prototype._onImpressionsFetchSuccess=function(){this._updateState(),this._update(),this.dc.showStep("content")},e.prototype._focusImpression=function(t){i.tools.isPresent(t)&&t.view.focus()},e.prototype._updateState=function(){this._state.buttonAdd=this.getCurrentUserImpression()===!1,this._state.buttonAll=this._getImpressionsAll().length>3,this._state.group=this._getImpressions().length>0,this._state.controls=this._state.buttonAll,this._state.buttonCountDisabled=!this._state.buttonAll},e.prototype._onImpressionsAllFetchSuccess=function(){this._updateState(),this._update(),this._notify("fetched")},e.prototype._update=function(){i.tools.isPresent(this.view)&&(this.view.setSeparatorVisible(this._state.header),this.view.setGroupStateVisible(this._state.group),this.view.setButtonAddImpressionStateVisible(this._state.buttonAdd),this.view.setButtonAllStateVisible(this._state.buttonAll),this.view.setControlsVisible(this._state.controls),this.view.setButtonCountDisabled(this._state.buttonCountDisabled),this._setButtonAllUsers())},e.prototype._setButtonAllUsers=function(){i.tools.isNumber(this.buttonAll)||this.impressionGroupAll.coll.items.length>0&&this.buttonAll.push(this.impressionGroup.coll.mapUsers(3))},e.prototype._showLoginWindow=function(){var t=this;this._initLoginWindow(),this.loginWindow.off("authenticationSuccessful"),this.loginWindow.on("authenticationSuccessful",function(){t.impressionForm&&t.impressionForm.getModel().setData({user:i.user.api4Attributes()}),t.loginWindow.closeWindow({silent:!0}),t._showImpressionForm()}),this.loginWindow.showWindow()},e.prototype._initLoginWindow=function(){i.tools.isNull(this.loginWindow)&&(this.loginWindow=new c({context:"add_impression",preventDefaultLoginBehavior:!0}))},e.prototype._showImpressionForm=function(){this._notify("impressions-form-show-request")},e.prototype._getImpressions=function(){return this.impressionGroup.coll.items},e.prototype._getImpressionsAll=function(){return this.impressionGroupAll.coll.items},e.prototype._initImpressionForm=function(){var t=this;i.tools.isNull(this.impressionForm)&&(this.impressionForm=new a,this.impressionForm.getModel().setData({document_uuid:this.config.document_uuid,user:i.user.api4Attributes(),document:{title:this.config.title}}),this.impressionForm.on("create-success",function(){t._onImpressionFormCreateSuccess()}),this.impressionForm.on("save-success",function(){t._onImpressionFormSaveSuccess()}),this.view.appendImpressionForm(this.impressionForm.getElement()))},e.prototype._onImpressionFormCreateSuccess=function(){this._focusCurrentUserImpression=!0},e.prototype._onImpressionFormSaveSuccess=function(){var t=this;this.view._showImpressionFormStateLoading(),this._increaseImpressionsCount(),this.impressionGroup.coll.destroyAll(),this.impressionGroup.fetch(),this.impressionGroupAll.coll.destroyAll(),this.impressionGroupAll.fetch(),setTimeout(function(){t._notify("impressions-form-hide-request")},1e3)},e.prototype._increaseImpressionsCount=function(){this.config.impressions_count+=1,this.view.setButtonImpressionsCountValue(this.config.impressions_count)},e.prototype._decreaseImpressionsCount=function(){this.config.impressions_count-=1,this.view.setButtonImpressionsCountValue(this.config.impressions_count)},e.prototype._initButtonAll=function(){var t=this;i.tools.isNull(this.buttonAll)&&(this.buttonAll=new u,this.buttonAll.on("press",function(){t._notify("all-impressions-button-press")}),this.view.appendButtonAllImpressions(this.buttonAll.getElement()))},e}(e);return void t(d)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){n.define("documentMain",["extend","PubSub","ampersandModel","ampersandCollection","documentReadersModule","documentQuotesModule","documentImpressionsModule","documentRelatedModule","documentBookshelvesModule","DocumentExternalLinkView","DocumentExternalLinkModel","DocumentOwnerView","DocumentOwnerModel","DocumentMetaView","DocumentBaseView","DocumentModelBase","documentBindings","DropDown","PopupPaywall","moduleAuthRequest","loginWindow"],function(n,o,r,s,a,u,l,c,d,h,p,f,m,g,b,y,v,w,k,C,S,x){var E=o(r),P=E,T=P.superclass;i.tools.mixin(P.prototype,{initialize:function(){T.initialize.apply(this,arguments)},init:function(n,o){var r,s,E,P,T,I=this,A=t.location.origin+t.location.pathname;this._initialLocation=A;var B=a.extend({model:f}),O=v.extend({url:function(){var t,e=i.user.getViewingUserLogin()||i.user.getLogin();i.tools.isPresent(n.document_uuid)?t="&doc_uuid="+n.document_uuid:i.tools.isPresent(n.book_uuid)?t="&book_uuid="+n.book_uuid:i.tools.isPresent(n.lc_uuid)&&(t="&lc_uuid="+n.lc_uuid);var o=e?"&counters_for_login="+e:"";return"/a/4/books/smart_show?embed_counters=true"+t+o},collections:{external_links:B}}),M=y.extend({template:$("#bm-document").html(),events:{click:"selfClick","click @bm-document-back":"hideAdditional","click @bm-document-back-history":"historyBack","click @bm-document-share-fb":"shareFb","click @bm-document-share-tw":"shareTw","click @bm-document-share-vk":"shareVk","click @bm-document-app":"appInstall","click .bm-button-subscription":"openPopupPaywall","click @bm-wishlist-button":"addToWishlist","click @bm-buy-on-book-page":"openPopupPaywall","click @bm-buy-on-book-page-about":"openPopupPaywallWithoutAuth"},bindings:{"model.annotation":{hook:"annotation",type:function(t,e){e&&($(t).html(e),this.condenseAnnotation())}},"model.tags":{hook:"tags",type:function(t,e){if(e){$(t).empty();for(var n=e.length-1;n>=0;n--)$(t).prepend('<a class="bm-document-meta-tag" href="https://beta.bookmate.com/search/tag/'+encodeURIComponent(e[n])+'">'+e[n]+"</a>")}}},"model.paper_pages":{hook:"paper_pages",type:w.pluralized_count.type},"model.fetched":{type:function(t,e){e&&$(".bm-document-popup-root").removeClass("data-loading")}}},initialize:function(){this.setProps(),this.setShare(),this.bindToEl(),this.popupPaywall=new C,this.loginWindow=new x},setProps:function(){this.$main=$(this.el).find("@bm-document-main"),this.$aside=$(this.el).find("@bm-document-aside"),this.$btnBack=$(this.el).find("@bm-document-back"),this.$btnBackHistory=$(this.el).find("@bm-document-back-history"),this.$btnBackHistory.toggleClass("hidden",!n.showButtonBack),this.$btnShare=$(this.el).find("@bm-document-share")},setShare:function(){this.shareDropDown=new k({$button:$("@bm-document-share"),$container:$("@bm-document-share-container"),$layout:$(this.el),autoLayout:!1,eventStopPropagation:!1})},bindToEl:function(){n.renderedAsPopup||(this.renderSubview(r.viewFull,".bm-document-slide-additional._readers"),this.registerSubview(r.view),this.renderSubview(s.viewFull,".bm-document-slide-additional._related"),this.registerSubview(s.view),this.metaView=this.registerSubview(new b({el:$(".bm-document-book")[0],model:this.model})),this.renderOwner(),this.bindCusomEvents())},render:function(){return this.renderWithTemplate(this),this.renderSubview(r.viewFull,".bm-document-slide-additional._readers"),this.renderSubview(r.view,".bm-document-readers"),this.renderSubview(s.viewFull,".bm-document-slide-additional._related"),this.renderSubview(s.view,".bm-document-related"),this.metaView=this.renderSubview(new b({model:this.model}),".bm-document-book"),this.renderCollection(this.model.external_links,p,".bookpage-external-links"),_.defer(this.afterRender.bind(this)),this},afterRender:function(){this.setProps(),this.setShare(),this.renderOwner(),this.bindCusomEvents()},bindCusomEvents:function(){var t=_.throttle(this.scrollReachesBottom.bind(this),2e3),n=$(".bm-popup-content-wrapper").length>0?$(".bm-popup-content-wrapper"):$(e),i=$(".bm-popup-content-wrapper").length>0?$(".bm-popup-content-wrapper"):$("body");n.on("scroll",function(e){i[0].scrollHeight<=i.scrollTop()+i.innerHeight()&&t()})},scrollReachesBottom:function(){this.model.trigger("scroll:reaches:bottom")},renderOwner:function(){if(!($(this.el).find(".bm-document-owner").html().length>0)&&i.user.getViewingUserLogin()){var t=g.extend({url:function(){return"/a/4/u/"+i.user.getViewingUserLogin()}}),e=new t,n=new m({model:e});e.fetch(),this.renderSubview(n,".bm-document-owner")}},_onAdditionalShowed:function(t){"impression_form"===t&&$("@bm-impression-form-textarea-content").focus()},showAdditional:function(e){var o=!0;i.tools.isPresent(e)&&i.tools.isPresent(e.btnShare)&&(o=e.btnShare);var r=$(".bm-popup-content-wrapper").length>0?$(".bm-popup-content-wrapper"):$(t);r.scrollTo(0),$(this.el).find("@bm-document-aside._"+this.model.current_additional).removeClass("hidden"),$(this.el).find("@bm-document-aside._"+this.model.current_additional).addClass("_active"),$(this.el).find("@bm-document-aside._"+this.model.current_additional).on("transitionend",function(){this._onAdditionalShowed(this.model.current_additional)}.bind(this)),this.$main.addClass("hidden"),n.showButtonBack&&this.$btnBackHistory.addClass("hidden"),this.setShareVisible(o),this.$btnBack.removeClass("hidden"),T.setImpressionsAllFetchByScroll("all_impressions"===this.model.current_additional)},hideAdditional:function(t){var e=!0;i.tools.isPresent(t)&&i.tools.isPresent(t.btnShare)&&(e=t.btnShare),this.$aside.addClass("hidden").removeClass("_active"),this.$main.removeClass("hidden"),this.$btnBack.addClass("hidden"),n.showButtonBack&&this.$btnBackHistory.removeClass("hidden"),this.setShareVisible(e),this.model.current_additional=null},historyBack:function(t){t.preventDefault(),I._notify("history-back-click")},setShareVisible:function(t){t?this.$btnShare.removeClass("m-hidden"):this.$btnShare.addClass("m-hidden"),t?$(this.el).find("@bm-document-owner").removeClass("m-hidden"):$(this.el).find("@bm-document-owner").addClass("m-hidden")},addToWishlist:function(t){return i.user.present()?($(t.target).attr("wait",!0),void $.ajax({url:"/a/4/d/"+this.model.uuid+"/wishlists",method:"POST",success:function(e){e.error?$(t.target).removeAttr("wait"):($(t.target).addClass("hidden"),this.model.set({in_wishlist:!0}))}.bind(this)})):void this.loginWindow.showWindow("inital")},openPopupPaywall:function(){var t=this,e=!1,n=function(n){var i=n||"default";t.popupPaywall.show({step:"loading",context:"book_page"}),e===!0?t.popupPaywall.showPaymentForm(i):t.popupPaywall.on("prices-fetched",function(){e=!0,setTimeout(function(){t.popupPaywall.showPaymentForm(i)})})};i.user.present()?this.popupPaywall.show({step:this.model.label,context:"book_page"}):S(function(e){e.closeWindow({silent:!0}),n(t.model.label)})},openPopupPaywallWithoutAuth:function(t){t.preventDefault(),this.popupPaywall.show({step:"about-default",context:"book_page"})}});this.model=new O({book_url:A}),I.model.fetch({success:function(t){t.fetched=!0,n.document_uuid=t.uuid,n.book_uuid=t.book_uuid,n.readers_count=t.readers_count,n.related_count=t.related_count,n.markers_count=t.markers_count,n.user_markers_count=t.user_markers_count,n.impressions_count=t.impressions_count,n.bookshelves_count=t.bookshelves_count,n.title=t.title;var o=function(){t.current_additional="impression_form",I.view.showAdditional({btnShare:!1}),i.tools.client.isTouch()&&$(e.body).scrollTo(0,500)};r=new u(n),s=new d(n.document_uuid),s.fetch(),s.state.set("count",n.related_count),I.view=new M({el:n.renderedAsPopup===!0?void 0:$(".bm-document-popup")[0],model:I.model,current_additional:"null"}),n.parent_view=I.view,E=new l(n),E.state.on("show:additional",function(e){t.current_additional=e,I.view.showAdditional()}),P=new h(n),T=new c(n),T.on("fetched",function(){i.helper.hash.isParamPresent("show_impression_form")&&!T.getCurrentUserImpression()&&o()}),T.on("impressions-form-show-request",function(){o()}),T.on("impressions-form-hide-request",function(){I.view.hideAdditional()}),T.on("all-impressions-button-press",function(){t.current_additional="all_impressions",I.view.showAdditional()}),n.renderedAsPopup&&I.view.render(),r.view.on("show:additional",function(e){t.current_additional=e,I.view.showAdditional()}),s.view.on("show:additional",function(){t.current_additional="related",I.view.showAdditional()}),P.view.on("show:additional",function(){t.current_additional="bookshelves",I.view.showAdditional()}),I._notify("fetch-success",t.toJSON())}}),this.model.on("scroll:reaches:bottom",function(){"readers"===I.model.current_additional&&r.state.trigger("scroll:reaches:bottom"),"bookshelves"===I.model.current_additional&&P._notify("scroll:reaches:bottom"),E.state.trigger("scroll:reaches:bottom",I.model.current_additional)}),this.destroyModule=function(){this.view.remove()},$("@install-to-read").on("click",function(e){e.preventDefault();var n=e.target.href;DIMixpanel.track("App Banner Button Pressed"),setTimeout(function(){t.location.href=n},300)}.bind(this))},destroy:function(){i.tools.isPresent(this.view)&&this.view.remove()},getElement:function(){return this.view.el}}),n(E)})}(this,this.document,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("DocumentMetaView",["ampersandView","moduleBookCard","moduleButtonRead","moduleBookBadge","loginWindow","documentBindings","documentUtils"],function(t,e,i,o,r,s,a,u){var l=e.extend({template:$("#bm-document-book").html(),bindings:{"model.title":{hook:"title",type:"text"},"model.authors":{hook:"authors",type:function(t,e){if(e){var n=e.split(", ");n.forEach(function(e,i){var o=e.replace(/ /g," "),r=n.length-1>i?", ":"";$(t).append('<a class="bm-document-meta-authors-link" href="https://beta.bookmate.com/search/author/'+o+'">'+e+"</a>"+r)})}}},"model.labels":a.labels,"model.is_readable":{hook:"is_readable",type:"toggle"},"model.lc":{hook:"status",type:function(t,e){if(e){e.progress=0===e.progress?1:e.progress;var n={finished:'<div class="bookcover-status-type done">f</div>',
reading:'<div class="bookcover-status-type progress">'+e.progress+"%</div>","private":'<div class="bookcover-status-type private">L</div>'},i=n[e.state]?n[e.state]:"",o=e.is_public?i:i+n["private"];$(t).append(o)}}},"model.cover":{selector:".bm-document-meta-bookcard",type:function(t,e){if(void 0!==e&&!($(this.el).find(".bm-book-cover").length>0)){var o=this.model,r=new i({document:{uuid:o.uuid,labels:o.labels},cover:{url:e&&e.url||"",size:i.CoverSize.LARGE},readButton:{enabled:!1},title:o.title,authors:o.authors,link:n.helper.link.reader(o.uuid),linkEnabled:o.can_be_read});$(t).append(r.getElement())}}},"model.fetched":{selector:".bm-document-meta-readbutton",type:function(t,e){if(e&&this.model.can_be_read){var i=n.helper.experiments.getExperiment("Buy on book page"),o=i&&"Buy subscription"===i.group,r=this.model.label;if(!o||n.user.present()||gon.browser.mobile||gon.browser.tablet||"default"!=r&&"premium"!=r)u.initButtonRead({el:t,view:this,model:this.model,mixpanel_ctx:DIMixpanel.discovered.context.get("book"),discovery_id:DIMixpanel.discovered.uuid.get("book")}),this.buttonRead.on("user-auth-request",function(){this.loginWindow.showWindow("inital")}.bind(this));else{var s=$(this.el).find("@bm-buy-on-book-page"),a=$(this.el).find("@bm-buy-on-book-page-note"),l=$(this.el).find("@bm-buy-on-book-page-about");s.html(s.data(this.model.label)),a.html(a.data(this.model.label)),l.html(l.data(this.model.label)),s.removeClass("hidden"),a.removeClass("hidden"),l.removeClass("hidden")}}}},"model.is_book_can_be_added_to_wishlist":{hook:"bookcard-label-unavail-note",type:function(t,e){$(t).toggleClass("hidden",!e),$(this.el).find("@bm-wishlist-button").toggleClass("hidden",!e)}},"model.in_wishlist_and_still_unavail":{type:function(t,e){$(this.el).find("@bookcard-label-in-wishlist-note").toggleClass("hidden",!e)}}},initialize:function(){this.loginWindow=new s},render:function(){return this.renderWithTemplate(this),this}});t(l)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("DocumentModelBase",["ampersandModel"],function(t,e){var n=e.extend({props:{uuid:"string",title:"string",authors:"string",current_additional:"string",annotation:"string",tags:"array",fetched:"boolean",cover:"object",labels:"array",book_url:"string",book_uuid:"string",paper_pages:"number",subscription_level:"string",rights:"object",lc:"object",litres_spot:"boolean",can_be_read:"boolean",related_count:"number",readers_count:"number",markers_count:"number",user_markers_count:"number",bookshelves_count:"number",impressions_count:"number",uploaded_by:"object",in_wishlist:"boolean"},derived:{is_readable:{deps:["rights"],fn:function(){var t;return!t||!t.unavailable||"any"!==t.unavailable}},is_uploaded:{deps:["lc"],fn:function(){return this.lc&&this.lc.is_uploaded}},is_book_can_be_added_to_wishlist:{deps:["labels","in_wishlist"],fn:function(){return!this.in_wishlist&&!this.can_be_read}},in_wishlist_and_still_unavail:{deps:["labels","in_wishlist"],fn:function(){return this.in_wishlist&&!this.can_be_read}},label:{deps:["labels"],fn:function(){var t=_.pluck(this.labels,"kind")[0];return t}}}});t(n)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("DocumentOwnerModel",["ampersandModel"],function(t,e){var n=e.extend({props:{avatar_url:"string",login:"string",name:"string"},derived:{user_name:{deps:["name","login"],fn:function(){return this.name||this.login}},user_url:{deps:["login"],fn:function(){return"/"+this.login}}}});t(n)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("DocumentOwnerView",["ampersandView"],function(t,e){var n=e.extend({template:$("#bm-document-readers-template").html(),bindings:{"model.avatar_url":{type:"attribute",hook:"avatar_url",name:"src"},"model.user_url":{type:"attribute",hook:"user_url",name:"href"},"model.user_name":{type:"attribute",hook:"user_url",name:"title"}}});t(n)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("DocumentQuoteAltLinkView",["ampersandView","ampersandCollection","ampersandModel"],function(t,e,i,o){var r=e.extend({template:$("#bm-document-readers-simple-template").html(),bindings:{"model.avatar_url":{hook:"avatar_url",type:"attribute",name:"src"}}}),s=e.extend({template:$("#bm-document-quotes-alt-link").html(),bindings:{"model.quotes_owner":{hook:"quotes_owner",type:function(t,e){$(t).find("span").eq(1).text($(t).data(e))}},"model.count":{hook:"count",type:"text"}},events:{click:"showAdditional"},render:function(){this.renderWithTemplate();var t=o.extend({props:{avatar_url:"string"}}),e=i.extend({model:t}),s=new e,a={};return this.collection.each(function(t){a[t.user.login]=t.user.avatar_url}),n.user.isUserPresent()&&"my"===this.model.quotes_owner?s.add({avatar_url:n.user.avatarUrl()}):Object.keys(a).forEach(function(t){s.add({avatar_url:a[t]})}),this.renderCollection(s,r,this.el.querySelector(".bm-document-quotes-all-container")),_.defer(this.afterRender.bind(this)),this},afterRender:function(){$(this.el).find(".bm-document-quotes-all-container").removeClass("_my _his _all"),$(this.el).find(".bm-document-quotes-all-container").addClass("_"+this.model.quotes_owner)},showAdditional:function(t){t.preventDefault(),this.model.trigger("show:additional")}});t(s)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("DocumentQuoteListView",["ampersandView","DocumentQuoteView","loginWindow"],function(t,e,i,o){var r=5,s=e.extend({template:$("#bm-document-quotes").html(),events:{"click @bm-document-quotes-btn":"showAdditional","click .bm-document-quote-like":"unAuth"},bindings:{"model.quotes_owner":{hook:"quotes_owner",type:function(t,e){$(t).find("span:first").text($(t).data(e))}},"model.count":{hook:"count",type:function(t,e){e>r?($(t).text(e).removeClass("hidden"),$(this.el).addClass("m-filter-length")):($(t).addClass("hidden"),$(t).parent().addClass("m-inactive"))}}},initialize:function(){this.loginWindow=new o,this.el&&this.rerender()},render:function(){return this.renderWithTemplate(),this.renderCollection(this.collection,i,".bm-document-quotes-container"),this.showView(),this},rerender:function(){$(this.el).find(".bm-document-quotes-container").empty(),this.renderCollection(this.collection,i,".bm-document-quotes-container")},showView:function(){if(this.collection.length>0){var t=this.query(".bm-document-quotes-wrapper");$(t).removeClass("hidden")}},showAdditional:function(t){t.preventDefault(),this.model.count>r&&this.model.trigger("show:additional")},unAuth:function(){n.user.getLogin()||this.loginWindow.showWindow("inital")}});t(s)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("DocumentQuoteModel",["ampersandModel"],function(t,e){var i=e.extend({url:function(){return"/a/4/m/"+this.parent.uuid+"/likers.json"},props:{liked:"boolean",count:"number"},like:function(t){if(n.user.isUserPresent()){var e=t?"DELETE":"POST",i=function(){this.count=t?this.count-1:this.count+1,this.liked=!t,t||DIMixpanel.track("Like Button Pressed",{context:"quote"})};$.ajax({type:e,url:this.url(),success:i.bind(this)})}}}),o=e.extend({children:{likers:i},props:{content:"string",created_at:"number",uuid:"string",user:"object"},derived:{created_at_processed:{deps:["created_at"],fn:function(){return moment(1e3*this.created_at).fromNow()}},user_login_href:{deps:["user"],fn:function(){var t=this.user;return t&&t.login?"/"+t.login:""}},user_name:{deps:["user"],fn:function(){var t=this.user;return t&&(t.name||t.login)?t.name||t.login:""}},likers_count:{deps:["likers.count"],fn:function(){return this.likers.count>0?this.likers.count:""}},quote_link:{deps:["user","uuid"],fn:function(){var t=this.user;return t&&t.login?"/"+t.login+"/quotes/"+this.uuid:""}}}});t(o)})}(this,this.modules,this.BM),function(t,e,n){e.define("DocumentQuoteView",["ampersandView","RouterWeb"],function(t,e,i){var o=e.extend({template:n("#bm-document-quote-template").html(),events:{"click @bm-document-quote-content-link":"contentLinkClick","click @bm-document-quote-like":"toggleLike"},bindings:{"model.content":{hook:"content",type:"text"},"model.created_at":{hook:"created_at",type:"text"},"model.created_at_processed":{hook:"created_at_processed",type:"text"},"model.user_login_href":{hook:"user_login_href",type:"attribute",name:"href"},"model.user.avatar_url":{hook:"user_avatar_url",type:"attribute",name:"src"},"model.user_name":{hook:"user_name",type:"text"},"model.likers_count":{hook:"likers_count",type:function(t,e){var i=e>0?e:n(t).data("i18n");n(t).text(i)}},"model.likers.liked":{hook:"likers_liked",type:function(t,e){e?n(t).addClass("liked bounceIn"):n(t).removeClass("liked bounceIn")}},"model.quote_link":{hook:"quote_link",type:"attribute",name:"href"}},initialize:function(){this._popupQuote=null},toggleLike:function(){var t=this.model.likers.liked;this.model.likers.like(t)},contentLinkClick:function(t){BM.helper.event.isMouseLeftClick(t)&&(t.preventDefault(),t.stopPropagation(),this.showPopupQuote())},showPopupQuote:function(){var t=this;i.navigateToQuotePage(t.model.uuid,t.model.user.login)}});t(o)})}(this,this.modules,this.jQuery),function(t,e,n){"use strict";e.define("documentQuotesModule",["ampersandView","ampersandRestCollection","ampersandState","DocumentQuoteView","DocumentQuoteModel","DocumentQuoteListView","DocumentQuoteAltLinkView"],function(t,e,i,o,r,s,a,u){var l=function(t){var e=this,l=15,c=5,d=function(){var t=BM.user.getLogin(),e=BM.user.getViewingUserLogin();return t&&e&&t===e?"my":e?"his":"my"},h={all:t.markers_count,unique:t.markers_count,user:t.user_markers_count};return this._getContexts=function(){var e={},n=t.user_markers_count>0,i=t.markers_count>0,o=function(){return i?"all":"none"},r=function(){return i?"unique":"none"},s=function(e){return"all"===e||"unique"===e?t.markers_count>c?"all":"none":"user"===e?t.user_markers_count>c?"user":"none":"none"===e?"none":void 0};return BM.user.getViewingUserLogin()?(e.front=n?"user":r(),e.front_aside=s(n?"user":o()),e.alt=o(),e.alt_aside=o()):(e.front=r(),e.front_aside=s(o()),e.alt=n?"user":o(),e.alt_aside=n?"user":o()),e},this._getAllCollections=function(){var o=i.extend({model:s,page:1,fetchPage:function(){var t=this;if(!(this.count<=this.length)){var i=n(".bm-document-slide-additional._active .data-loader");i.removeClass("hidden").attr("data-loading","true"),setTimeout(function(){this.fetch({data:{p:this.page,pp:l},remove:!1,success:function(){1===t.page?e.collectionFetched():i.addClass("hidden").removeAttr("data-loading"),t.page++}})}.bind(this),600)}}}),r=o.extend({url:function(){return"/a/4/books/"+t.book_uuid+"/markers.json"}}),a=o.extend({url:function(){return"/a/4/books/"+t.book_uuid+"/markers.json?user_unique=true"}}),u=o.extend({url:function(){var e=BM.user.getViewingUserLogin()||BM.user.getLogin(),n=t.document_lc_uuid||t.document_uuid;return"/a/4/u/"+e+"/d/"+n+"/m.json"}});return{all:new r,unique:new a,user:new u}},this._getAllViews=function(){var t=a.extend({template:n("#bm-document-slide-additional").html(),bindings:_.extend({},a.prototype.bindings,{"model.count":{hook:"count",type:function(t,e){e>=0?(n(t).text(e).removeClass("hidden"),n(this.el).addClass("m-filter-length")):(n(t).addClass("hidden"),n(t).parent().addClass("m-inactive"))}}}),render:function(){return this.renderWithTemplate(),this.renderCollection(this.collection,r,".bm-document-slide-additional-container"),this}});return{front:a,front_aside:t,alt:u,alt_aside:t}},this._renderViews=function(){if(0!==Object.keys(this.collections).length){var i=function(i){var r=this.contexts[i];if("none"!==r){var s="alt"===i&&this.collections.unique?this.collections.unique:this.collections[r],a=this.views[i],u=o.extend({props:{quotes_owner:"string",count:"number",context:"string"}}),l=new u({quotes_owner:"user"===r?d():"all",count:h[r],context:i});if(l.on("show:additional",function(){var t=this.context.indexOf("alt")>=0?"quotes_alt":"quotes";e.state.trigger("show:additional",t)}),t.renderedAsPopup||"front"!==i)t.parent_view.renderSubview(new a({collection:s,model:l}),this.selectors[i]);else{new a({el:n(".bm-document-quotes")[0],collection:s,model:l})}}};Object.keys(this.selectors).forEach(i.bind(this))}},this._init=function(){var t=o.extend(),n={front:".bm-document-quotes",front_aside:".bm-document-slide-additional._quotes",alt:".bm-document-quotes-alt-link",alt_aside:".bm-document-slide-additional._quotes_alt"},i=this._getContexts(),r=this._getAllCollections(),s={},a=function(t){var e=i[t];"none"!==e&&("unique"===e&&(s.all=r.all),s[e]=r[e],s[e].count=h[e])};Object.keys(i).forEach(a),this.state=new t,this.views=this._getAllViews(),this.selectors=n,this.collections=s,this.contexts=i;var u=0;this.collectionFetched=function(){u++,Object.keys(s).length==u&&e._renderViews()};var l=function(t){s[t];s[t].fetchPage()};Object.keys(s).forEach(l)},this._init(),this.state.on("scroll:reaches:bottom",function(){var t,i=n(".bm-document-slide-additional._quotes._active"),o=n(".bm-document-slide-additional._quotes_alt._active");if(t=i.length>0?i:void 0,t||(t=o.length>0?o:void 0),t&&t.length>0){var r=t.data("context");e.collections[e.contexts[r]].fetchPage()}}),{state:this.state}};t(l)})}(this,this.modules,this.jQuery),function(t,e,n){e.define("DocumentReaderFullView",["DocumentReaderView","documentBindings"],function(t,e,n){var i=e.extend({template:$("#bm-document-readers-full-template").html(),bindings:_.extend({},e.prototype.bindings,{"model.user_name":{type:"text",hook:"user_name"},"model.library_cards_count":{hook:"library_cards_count",type:n.pluralized_count.type},"model.bookshelves_count_sum":{hook:"bookshelves_count",type:function(t,e){1>e?$(t).attr("hidden","hidden"):($(t).removeAttr("hidden"),n.pluralized_count.type(t,e))}}})});t(i)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("DocumentReaderListView",["ampersandView","DocumentReaderView"],function(t,e,n){var i=e.extend({template:$("#bm-document-readers").html(),bindings:{"model.count":{hook:"count",type:function(t,e){e>0&&($(t).text(e).removeClass("m-wait"),$(this.el).removeClass("hidden"))}}},events:{"click @bm-document-readers-btn":"showAdditional"},render:function(){return this.renderWithTemplate(),this.renderCollection(this.model.coll,n,".bm-document-readers-container"),this},showAdditional:function(t){t.preventDefault(),this.trigger("show:additional","readers")}});t(i)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("DocumentReaderModel",["ampersandModel"],function(t,e){var n=e.extend({props:{avatar_url:"string",login:"string",name:"string",library_cards_count:"number",bookshelves_count:"number",following_bookshelves_count:"number",following:"boolean"},derived:{user_name:{deps:["name","login"],fn:function(){return this.name||this.login}},user_url:{deps:["login"],fn:function(){return"/"+this.login}},bookshelves_count_sum:{deps:["bookshelves_count","following_bookshelves_count"],fn:function(){return this.bookshelves_count+this.following_bookshelves_count}}}});t(n)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n,i){e.define("DocumentReaderView",["ampersandView","loginWindow"],function(e,o,r){var s=o.extend({template:$("#bm-document-readers-template").html(),events:{"click @bm-document-reader-follow":"follow"},bindings:{"model.avatar_url":{type:"attribute",hook:"avatar_url",name:"src"},"model.user_url":{type:"attribute",hook:"user_url",name:"href"},"model.user_name":{type:"attribute",hook:"user_url",name:"title"},"model.following":{hook:"following",type:function(t,e){if(this.currentUserLogin&&this.currentUserLogin===this.model.login)return void $(t).addClass("hidden");var n=e?$(t).data("on"):$(t).data("off");$(t).toggleClass("_inactive",e).find("span").text(n)}}},follow:function(e){if(e.preventDefault(),!this.currentUserLogin)return void this.showLoginWindow();var n=this.model.following?"/a/4/u/unfollow.json":"/a/4/u/follow.json",o=t.location.pathname,r="books"===o.split("/")[1]?o.split("/")[2]:void 0;this.model.following||(t.location.href.indexOf("search")>=0?i.track("Friend Follow",{discovered:"search"}):i.track("Friend Follow",{discovered:"book",discovered_id:r}));var s=function(t){t.error||(this.model.following=!this.model.following)};$.ajax({type:"POST",url:n,data:{logins:JSON.stringify([this.model.login])},success:s.bind(this)})},initialize:function(){this.currentUserLogin=n.user.getLogin(),this.loginWindow=new r},showLoginWindow:function(){this.loginWindow.showWindow("inital")}});e(s)})}(this,this.modules,this.BM=this.BM||{},this.DIMixpanel),function(t,e,n,i){e.define("documentReadersModule",["ampersandRestCollection","ampersandState","DocumentReaderFullView","DocumentReaderModel","DocumentReaderListView"],function(t,e,n,o,r,s){var a=function(t){var a=15,u=e.extend({model:r,page:1,url:"/a/4/d/"+(t.document_lc_uuid||t.document_uuid)+"/readers.json",fetchPage:function(){var t=this;if(!(this.count<=this.length)){var e=i(".bm-document-slide-additional._active .data-loader");e.removeClass("hidden").attr("data-loading","true"),setTimeout(function(){this.fetch({data:{p:this.page,pp:a},remove:!1,success:function(){e.addClass("hidden").removeAttr("data-loading"),t.page++}})}.bind(this),600)}}}),l=s.extend({template:i("#bm-document-slide-additional-readers").html(),render:function(){return this.renderWithTemplate(),this.renderCollection(this.model.coll,o,".bm-document-slide-additional-container"),this}}),c=n.extend({collections:{coll:u},props:{count:"number"}}),d=new c({count:t.readers_count}),h=new s({el:i(".bm-document-readers")[0],model:d});return h.on("show:additional",function(t){setTimeout(function(){if(i(".bm-bookpage").length>0)return void(i("body").innerHeight()==i("body")[0].scrollHeight&&d.coll.fetchPage());var t=i(".bm-document-popup-content"),e=t.css("margin-top"),n=t.css("margin-bottom"),o=parseInt(e)+parseInt(n),r=i(".bm-document-popup"),s=r.height(),a=i(".bm-popup-content-wrapper");a.innerHeight()>s+o&&d.coll.fetchPage()},300)}),d.coll.count=d.count,d.coll.fetchPage(),d.on("scroll:reaches:bottom",function(){var t=i(".bm-document-slide-additional._readers._active");0!==t.length&&d.coll.fetchPage()}),{state:d,view:h,viewFull:new l({model:d})}};t(a)})}(this,this.modules,this.BM=this.BM||{},this.jQuery),function(t,e,n,i){e.define("DocumentRelatedFullView",["ampersandView","moduleBookCard","moduleBookBadge","documentBindings"],function(t,e,o,r,s){var a=e.extend({template:$("#bm-document-related-full-template").html(),events:{"click @bm-document-bookcard":"openBook"},bindings:{"model.authors":{hook:"authors",type:"text"},"model.title":{hook:"title",type:"text"},"model.labels":s.labels},render:function(){return this.renderWithTemplate(this),_.defer(this.afterRender.bind(this)),this},afterRender:function(){var t=this.model,e=t.cover&&t.cover.url?t.cover.url:"",n=new o({document:{uuid:t.uuid},book:{uuid:t.book_uuid},cover:{url:e,size:o.CoverSize.THUMB},readButton:{enabled:!1}});$(this.el).find("@bm-document-bookcard").append(n.getElement())},openBook:function(t){var e=this.model;i.discovered.set({channel:"book",ctx:"related"}),n.helper.event.isSimpleMouseLeftClick(t)&&(t.preventDefault(),e.trigger("show:book",{book_uuid:e.book_uuid,document_uuid:e.uuid,lc_uuid:e.lc&&e.lc.uuid?e.lc.uuid:void 0,document_lc_uuid:e.lc?e.uuid:void 0}))}});t(a)})}(this,this.modules,this.BM=this.BM||{},this.DIMixpanel),function(t,e,n){e.define("DocumentRelatedListFullView",["DocumentRelatedFullView","DocumentRelatedListView"],function(t,i,o){var r=null,s=o.extend({template:$("#bm-document-slide-additional-related").html(),bindings:_.extend({},o.prototype.bindings,{"model.fetched":{type:function(t,n){n===!0&&e.require(["BookBlockListItem"],function(t){r=t,this.renderListItems(this.model.coll.models)}.bind(this))}},"model.fetchedAll":{type:function(t,n){n===!0&&e.require(["BookBlockListItem"],function(t){r=t,this.renderListItems(this.model.coll.models)}.bind(this))}}}),initialize:function(){this._modelFetchOnce=!1,this._listItems=[]},render:function(){return this.renderWithTemplate(),this},renderListItems:function(t){var e=this.el.querySelector(".bm-document-slide-additional-container");this._listItems.forEach(function(t){t.destroy()}),this._listItems.length=0,this._listItems=[],e.innerHTML="",n.tools.isArray(t)&&t.forEach(function(t){var i=new r(n.tools.mixin(t.toJSON(),{components:{readers:!1,owner:!1},openDocumentPopup:!0,readButton:{dropdownOptions:{$layout:$(".bm-document-popup-root").find(".bm-popup-content-wrapper")}},mixpanel_ctx:"related"}));e.appendChild(i.getElement().get(0))}.bind(this))}});t(s)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("DocumentRelatedListView",["ampersandView","DocumentRelatedView","moduleBookCard"],function(t,e,n,i){var o=e.extend({template:$("#bm-document-related").html(),events:{"click @bm-document-related-btn":"showAdditional"},bindings:{"model.count":{hook:"count",type:function(t,e){e>0&&($(t).text(e).removeClass("m-wait"),$(this.el).removeClass("hidden"))}},"model.fetched":{type:function(t,e){e&&this.bindToEl()}}},render:function(){return this.renderWithTemplate(),this.renderCollection(this.model.coll,n,".bm-document-related-container"),this.isRendered=!0,this},bindToEl:function(){if(!this.isRendered){var t=this,e=this.model;$(this.el).find(".bm-document-related-bookcard").each(function(i){t.registerSubview(new n({el:this,model:e.coll.at(i)}))})}},showAdditional:function(t){t.preventDefault();var e=this.model;this.model.coll.fetch({data:{p:e.page},success:function(){e.fetchedAll=!0}}),this.trigger("show:additional")}});t(o)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n){e.define("DocumentRelatedModel",["ampersandModel"],function(t,e){var n=e.extend({props:{uuid:"string",cover:"object",authors:"string",title:"string",book_uuid:"string",lc:"object",labels:"array",rights:"object",can_be_read:"boolean",mixpanel_ctx:"string",discovery_id:"string",uploaded_by:"object"}});t(n)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n,i){e.define("DocumentRelatedView",["ampersandView","moduleBookCard","moduleButtonRead","loginWindow","documentUtils","RouterWeb"],function(t,e,o,r,s,a,u){var l=e.extend({template:$("#bm-document-related-template").html(),bindings:{"model.cover":{type:function(t,e){void 0!==e&&($(t).find(".bm-book-cover").length>0?a.initButtonRead({el:this.el,view:this}):(a.initBookCard({el:t,model:this.model,view:this,mixpanel_ctx:"related"}),this.model.can_be_read&&this.bc._readButtonHandler.on("user-auth-request",this.showLoginWindow.bind(this))))}}},events:{"click @bm-book-card-link":"openBook"},initialize:function(){this.loginWindow=new s},render:function(t){return this.renderWithTemplate(this),this},showLoginWindow:function(){this.loginWindow.showWindow("inital")},openBook:function(t){i.discovered.set({channel:"book",ctx:"related"}),t.ctrlKey||t.metaKey||1!==t.which||n.tools.client.isTouch()||(t.preventDefault(),u.navigateToBookPage(this.model.book_uuid))}});t(l)})}(this,this.modules,this.BM=this.BM||{},this.DIMixpanel),function(t,e){e.define("documentRelatedModule",["ampersandState","ampersandRestCollection","DocumentRelatedModel","DocumentRelatedListView","DocumentRelatedListFullView"],function(t,e,n,i,o,r){var s=function(t){var s=n.extend({model:i,url:function(){return"/a/4/d/"+t+"/related.json"}}),a=e.extend({collections:{coll:s},props:{count:"number",page:"number",fetched:"boolean",fetchedAll:"boolean"}}),u=new a({page:1}),l=function(){u.coll.fetch({data:{p:1,pp:5},success:function(){u.fetched=!0}})},c=$(".bookmate-popup").length>0?$(".bookmate-popup .bm-document-related")[0]:$(".bm-bookpage .bm-document-related")[0];return{state:u,view:new o({el:c,model:u}),viewFull:new r({model:u}),fetch:l}};t(s)})}(this,this.modules),function(t,e,n){e.define("documentUtils",["moduleButtonRead","moduleBookCard"],function(t,e,n){var i={initButtonRead:function(t){var n=t&&t.el?t.el:void 0,i=t&&t.model?t.model:void 0,o=t&&t.view?t.view:void 0;if(n&&$(n).find(".bm-read-button-wrapper").length>0)return void(o.buttonRead=new e({element:$(n).find(".bm-read-button-wrapper")}));if(n&&o&&i){var r={document:{uuid:i.uuid||i.document_uuid,labels:i.labels},book:{uuid:i.book_uuid},controls:{read:!0,sideButton:{addToLibrary:!0,dropdown:!0}},horAlign:"fullwidth",dropdownOptions:{$layout:$(".bm-document-popup-root").find(".bm-popup-content-wrapper")},mixpanel_ctx:t.mixpanel_ctx,discovery_id:t.discovery_id};i.lc&&i.lc.uuid&&(r.libraryCard={uuid:i.lc.uuid,state:i.lc.state,is_public:i.lc.is_public,is_uploaded:i.lc.is_uploaded}),o.buttonRead=new e({config:r}),$(n).append(o.buttonRead.getElement())}},initBookCard:function(t){var e=t&&t.el?t.el:void 0,i=t&&t.model?t.model:void 0,o=t&&t.view?t.view:void 0,r={document:{uuid:i.document_uuid||i.uuid},book:{uuid:i.book_uuid},cover:{url:i.cover&&i.cover.url||"",size:n.CoverSize.THUMB},credits:{hover:!1},readButton:{enabled:i.can_be_read,horAlign:"fullwidth",dropdownOptions:{$layout:$(".bm-document-popup-root").find(".bm-popup-content-wrapper")}},mixpanel_ctx:t.mixpanel_ctx};i.lc&&i.lc.uuid&&(r.libraryCard={uuid:i.lc.uuid,actions:["begin-reading","reopen","hide","show","mark-as-read","read-later","edit","remove"]}),o.bc=new n(r),o.bc.setBookTitle(i.title),o.bc.setBookAuthors(i.authors),$(e).append(o.bc.getElement())},sliceString:function(t){var e=t&&t.len?t.len:140,n=t&&t.prefix?t.prefix:"Empty prefix!",i=t&&t.suffix?t.suffix.join(", "):"Empty suffix!",o=function(t,e){for(var n=e[0],i=Math.abs(t-n),o=0;o<e.length;o++){var r=Math.abs(t-e[o]);i>r&&(i=r,n=e[o])}return n},r=function(t,e){for(var n=[],i=-1;-1!=(i=t.indexOf(e,i+1));)n.push(i);return n},s=function(){var t=e-n.length-1,s=i,a=null;if(s.length>t){var u=r(s," "),l=o(t,u);a=s.slice(0,l)+""}else a=s;return a};return s()}};t(i)})}(this,this.modules,this.BM=this.BM||{}),function(t,e,n,i){"use strict";e.define("DocumentPopup",["extend","PopupBase","tools","documentMain","ampersandState","ampersandRouter","loginWindow","RouterWeb"],function(t,e,n,o,r,s,a,u,l){var c=e(n),d=c,h=d.superclass;i.tools.mixin(d.prototype,{initialize:function(t){h.initialize.call(this,{rootClassName:["bm-document-popup-root","m-version-2","bm-popup-quote","data-loading"],useTemplate:!0,hasDependentPopups:!0}),this._loginWindow=null,this._documentHandler=null,this._stopPropagation=!1,this._config={document:{uuid:null},book:{uuid:null},libraryCard:{uuid:null}},this._setConfig(t),this._initLoginWindow()},_setConfig:function(t){i.tools.isPresent(t)&&i.tools.mixin(this._config,t)},_initLoginWindow:function(){this.loginWindow=new u},show:function(){return this.openModal.apply(this,arguments)},openModal:function(t,e){i.tools.isPresent(t)&&(this._setConfig(t),i.tools.isNull(this._documentHandler)?this._initDocumentAndShow():h.show.call(this,e))},_initDocumentAndShow:function(){var t=this._getConfigForDocumentModule();this._documentHandler=new r,this._documentHandler.on("fetch-success",function(t){this._elementContent.append(this._documentHandler.getElement()),this._notify("fetch-success",t)}.bind(this)),this._documentHandler.on("history-back-click",function(){this._notify("history-back-click")}.bind(this)),this._documentHandler.init(t),h.show.apply(this,arguments)},getDocumentHandler:function(){return this._documentHandler},_getConfigForDocumentModule:function(){var t={};return t.lc_uuid=this._config.libraryCard.uuid,t.document_uuid=this._config.document.uuid,t.book_uuid=this._config.book.uuid,t.showButtonBack=this._historyControls,t.renderedAsPopup=!0,t}}),t(c)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n){e.define("moduleFooterInit",["moduleFooterLanguageSelect","moduleFooterStoreLinks"],function(e,i){new i("@bm-language-select"),new i("@bm-library-language-select"),n(".bm-layout-library-language-select-popup-item").on("click",function(e){e.preventDefault();var i=n(this).data("locale"),o="/a/4/user.json?user[library_lang]="+i;n.ajax({url:o,type:"PATCH",success:function(e){t.location.reload()}})}),e()})}(this,this.modules,this.jQuery),function(t,e,n,i){e.define("moduleFooterLanguageSelect",["extend","baseClass","DropDown"],function(t,e,o,r){var s=e(o),a=s,u=a.superclass,l=(n(document.body),0);i.tools.mixin(a.prototype,{initialize:function(t){t&&(t instanceof n?this.$elem=t:this.$elem=n(t)),!this.$elem||this.$elem.length<1||(u.initialize.apply(this,arguments),this.$elemDropdownToggle=this.$elem,this.$elemDropdownPopup=this.$elem.find("@bm-language-select-dropdown-popup").not("@bm-language-select-search-dropdown-popup"),this.dropDown=new r({$button:this.$elemDropdownToggle,$container:this.$elemDropdownPopup,yPosition:i.tools.client.isBreakpointTablet()?"bottom":"top",yOffset:10,eventStopPropagation:!1}),i.tools.client.isTouch()?this._setupEventsTouch():this._setupEvents(),this._uniqueEventId=""+(new Date).getTime()+ ++l)},_setupEventsTouch:function(){this.$elem.on(i.tools.client.touchEvent,function(t){t.preventDefault()}),this.$elemDropdownToggle.on(i.tools.client.touchEvent,function(t){t.stopPropagation(),t.preventDefault()})},_setupEvents:function(){this.$elemDropdownToggle.on("click",function(t){t.stopPropagation()})},destroy:function(){u.destroy.apply(this,arguments)}}),t(s)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("moduleFooterStoreLinks",[],function(t){var e=n(".bm-layout-footer"),o=e.find(".bm-footer-store-links-item");o.on("click",function(t){var e=n(this);i.track("Install App Button Pressed",{app:e.attr("data-app"),context:"footer"})}),t()})}(this,this.modules,this.jQuery,this.DIMixpanel);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(t,e,n,i,o,r){"use strict";var s=function(t,e,i,o){var s=function(t){var e=this;e.$b=t,e.name=e.$b.attr("name"),e.url=e.$b.attr("action"),e.method=e.$b.attr("method"),e.$inputs=e.$b.find("input"),e.$textareas=e.$b.find("textarea"),e.inputs={},e.$submit=e.$b.find("button.bm-form-submit"),e.method=e.$b.attr("method"),e.initialize()};s.prototype={initialize:function(t){var e=this;e.createInputs(),e.initListeners()},createInputs:function(){var t=this;t.$inputs.each(function(e,o){var r=new i(n(o));t.inputs[r.getName()]=r}),t.$textareas.each(function(e,i){var r=new o(n(i));t.inputs[r.getName()]=r})},initListeners:function(){var t=this;t.$b.on("submit",function(e){var n={};e.preventDefault(),e.stopPropagation(),t.$submit.attr("disabled","disabled"),t.$submit.attr("wait",!0);for(var i in t.inputs){var o=t.inputs[i];if(!o.isValid())return;n[i]=o.getValue()}t.sendRequest(n)}),t.$inputs.on("keyup",function(e){for(var n in t.inputs){var i=t.inputs[n];if(!i.isValid())return void t.$submit.attr("disabled","disabled");t.$submit.removeAttr("disabled")}})},sendRequest:function(t){var e=this;n.ajax({url:e.url,method:e.method,data:t,success:function(t){var n=t.error;e.$submit.removeAttr("disabled"),e.$submit.removeAttr("wait"),n?e.setErrors(n.messages||n.message):r(e.name).broadcast(t)},error:function(t){var n=t.responseJSON.error;e.$submit.removeAttr("disabled"),e.$submit.removeAttr("wait"),e.setErrors(n.messages?n.messages:n.message)}})},setErrors:function(t){var e=this;if("string"==typeof t)if("phone-create"==e.name)e.inputs["user[phone_code]"].setError(t);else for(var n in e.inputs)e.inputs[n].setError(t);else if("object"===("undefined"==typeof t?"undefined":_typeof(t)))for(var i in t){var o=t[i];for(var r in o){var s=o[r],a=e.inputs[i+"["+r+"]"];a&&a.setError(s)}}},getName:function(){return this.name},setValue:function(t){for(var e in t){var n=t[e];this.inputs[e].setValue(n)}},getValue:function(t){return this.inputs[t].getValue()},clear:function(){for(var t in this.inputs)this.inputs[t].clear()},submit:function(){this.$b.submit()}},e.Form=s,t(s)};i.define("Form",["modules","TextInput","Textarea"],s)}(this,this.document,this.jQuery,this.modules,this.BM,this.radio),function(t,e,n,i){"use strict";i.define("InputBaseClass",["extend","PubSub","modules"],function(t,e,i,o){var r=e(i),s=r,a=s.superclass;BM.tools.mixin(s.prototype,{initialize:function(t,e){a.initialize.apply(this,arguments);var i=this;i.$b=t,i.ajax={url:i.$b.data("url"),
param:i.$b.attr("name")},i.options=e||{},i.paramTree=i.createParamTree(),i.completeIcon='<svg class="bm-complete-icon bm-text-input-complete-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 44 44" xml:space="preserve"><g fill="rgb(223,223,223)" fill-rule="evenodd"><g fill="rgb(0,0,0)"><g><path d="M22,42.9000015 C10.4759998,42.9000015 1.10000002,33.5229988 1.10000002,22 C1.10000002,10.4759998 10.4759998,1.10000002 22,1.10000002 C33.5229998,1.10000002 42.8999996,10.4760004 42.8999996,21.9999996 C42.9000015,33.5229988 33.5229988,42.9000015 22,42.9000015 L22,42.9000015 L22,42.9000015" id="Shape" fill="rgb(254,255,255)"></path><path d="M22,2.20000005 C32.9180002,2.20000005 41.7999992,11.082 41.7999992,21.9999993 C41.7999992,32.9179986 32.9179993,41.7999992 22,41.7999992 C11.0820007,41.7999992 2.20000005,32.9179993 2.20000005,22 C2.20000005,11.0820007 11.0819998,2.20000005 22,2.20000005 M22,0 C9.85099983,0 0,9.85099983 0,22 C0,34.1479998 9.85099983,44 22,44 C34.1479998,44 44,34.1479998 44,22 C44,9.85099983 34.1479988,0 22,0 L22,0 L22,0 L22,0" id="Shape" fill="rgb(91,214,144)"></path></g><path d="M32.9449997,16.0599995 L19.9960003,29.0100002 L12.6230001,21.6350002" id="Shape" stroke="rgb(91,214,144)" stroke-width="2.64" fill-opacity="0" fill="rgb(223,223,223)"></path></g></g></svg>',i.$completeIcon=n(i.completeIcon),i.extractValues(),i.buildDOM(),i.initListeners()},extractValues:function(){},buildDOM:function(){},initListeners:function(){},sendRequest:function(t){var e=this,i={};i[e.ajax.param]=t,n.ajax({url:e.ajax.url,method:"put",data:i,success:function(t){e.processResponse(t)},error:function(t){e.processResponse(t)}})},processResponse:function(t){t=t.responseJSON;var e=this;if(t.error){var n="";if(t.error.message)n=t.error.message;else if(t.error.messages){n=t.error.messages;for(var i=0;i<e.paramTree.length;i++)n=n[e.paramTree[i]]}e.$completeIcon.attr("class","bm-complete-icon bm-text-input-complete-icon"),e.setError(n),e._notify("save-error")}else e.$completeIcon.attr("class","bm-complete-icon bm-text-input-complete-icon show"),e.$errorLabel.removeClass("show"),setTimeout(function(){e.$completeIcon.attr("class","bm-complete-icon bm-text-input-complete-icon")},1500),e._notify("save-success")},getValue:function(){},setValue:function(t,e){},createParamTree:function(){return this.$b.attr("name").replace(/([\]\[]{1,2})/g,":").slice(0,-1).split(":")},getParamTree:function(){return this.paramTree},getName:function(){return this.ajax.param},setError:function(t){this.$errorLabel.html(t),this.$errorLabel.addClass("show")},hideError:function(){this.$errorLabel.removeClass("show")},clear:function(){this.$b.val("")}}),o.InputBaseClass=r,t(r)})}(this,this.document,this.jQuery,this.modules),function(t,e,n){"use strict";n.define("Header",["DropDown"],function(t,n){var i=function(){function t(e){_classCallCheck(this,t),this._setElements(),this._initMobileMenu(),this._setEventListeners()}return t.prototype._initMobileMenu=function(){this.mobileMenu=new n({$button:e("@mobile-menu-opener"),$container:e("@mobile-menu-container"),containerClass:"mobile-menu m-close-white"}),this.mobileMenu.$container.find('[href="/logout"]').on("click",function(t){t.preventDefault(),e.ajax({url:"/logout",type:"delete"})})},t.prototype._setElements=function(){this.$el=e("@bm-header"),this.$menu=this.$el.find("@header-menu"),this.$buttons=this.$el.find("@header-buttons")},t.prototype._setEventListeners=function(){},t.prototype.showMenu=function(){this.$menu.velocity("reverse",{duration:250,display:"inline-block"})},t.prototype.hideMenu=function(){this.$menu.velocity({opacity:0},{duration:200,display:"none"})},t.prototype.showButtons=function(){this.$buttons.velocity("reverse",{duration:250,visibility:"visible"})},t.prototype.hideButtons=function(){this.$buttons.velocity({opacity:0},{duration:200,visibility:"hidden"})},t}();t(i)})}(this,this.jQuery,this.modules),function(t,e,n){"use strict";e.define("HotSubscription",["PopupPaywall"],function(t,e){var n=$(".bm-button-hot-subscription"),i=(n.data("status"),new e);n.on("click",function(){i.show({context:"widget"})}),t()})}(this,this.modules,BM),function(t,e,n,i,o){"use strict";e.define("DropDown",["PubSub","PopupBase"],function(e,r,s){var a=function(e){function r(i){_classCallCheck(this,r);var s=_possibleConstructorReturn(this,e.call(this,i));return s.$window=n(t),s.$layout=i.$layout||n("body"),s.$page=null,s.$button=i.$button,s.$popup=i.$container,s.autoLayout=i&&o.tools.isPresent(i.autoLayout)?i.autoLayout:!0,s.opened=!1,s.event=o.tools.client.isTouch()?o.tools.client.touchEvent:"click",s.eventListeners=o.tools.isBoolean(i.eventListeners)?i.eventListeners:!0,s.eventStopPropagation=o.tools.isBoolean(i.eventStopPropagation)?i.eventStopPropagation:!0,s.containerClass=i.containerClass||"",s.yPosition=i.yPosition||"bottom",s.xPosition=i.xPosition||"right",s.yOffset=i.yOffset||10,s.xOffset=i.xOffset||0,s._setContainer(),s._setClasses(),s._setContainerDefaultStyles(),s._setEventListeners(),s}return _inherits(r,e),r.prototype.setLayoutElement=function(t){o.tools.isPresent(t)&&(this.$layout=t.find("@content"),this._setContainer())},r.prototype._setEventListeners=function(){var t=this;this.eventListeners&&(this.$button.on(this.event,function(e){t.eventStopPropagation&&e.stopPropagation(),t.toggle()}),this.$container.find("@dropdown-close").on(this.event,function(e){t.eventStopPropagation&&e.stopPropagation(),t.toggle()}),this.$container.on(this.event,function(e){t.eventStopPropagation&&e.stopPropagation()}))},r.prototype._setSingleEventListeners=function(){var t=this;i("dropdown-opened").subscribe(function(){return t.close()}),i("close-dropdowns").subscribe(function(){return t.close()});var e="body"===this.$layout.selector?this.$window:this.$layout;e.one(this.event,function(){return t.close()})},r.prototype._setClasses=function(){this.$button.hasClass("bm-dropdown-button")||this.$button.addClass("bm-dropdown-button"),this.$container.hasClass("bm-dropdown-container")||this.$container.addClass("bm-dropdown-container")},r.prototype._setContainer=function(){this._createContainer(),this._createDropDownsContainer(),this.$popup.appendTo(this.$container),this.$container.appendTo(this.$dropDownsContainer),this.$popup.css("display","block")},r.prototype._setContainerPosition=function(){var t=-10,e=0;if(!o.tools.client.isBreakpointTablet()){this.$pseudoContainer||this._createPseudoContainer();var n="top"===this.yPosition?this.$container.height():0,i=this.$container.width(),r="body"===this.$layout.selector?0:this.$layout.scrollTop(),s=this.$pseudoContainer.offset(),a=this.$layout.offset();t=s.top+r-a.top-n,e=s.left-a.left-i}this.$container.css({top:t,left:e})},r.prototype._updateYPosition=function(){var t=this._getContainerHeight(),e=this._getButtonOffset(),n=this._getPageHeight(),i=70;!o.tools.client.isBreakpointTablet()&&e.top+t+i>n?this.yPosition="top":this.yPosition="bottom",this._updatePseudoContainerPosition()},r.prototype._setContainerDefaultStyles=function(){this.$container.velocity({translateY:0,opacity:0,scale:o.tools.client.isBreakpointTablet()?1.2:1},{duration:1})},r.prototype._createContainer=function(){this.$container=n(n("#bm-dropdown-template").html()),this.$container.addClass(this.containerClass)},r.prototype._createDropDownsContainer=function(){var t=this.$layout.find("@dropdowns-container");this.$dropDownsContainer=t.length?t:n(n("#bm-dropdowns-template").html()).appendTo(this.$layout)},r.prototype._createPseudoContainer=function(){this.$pseudoContainer=n("<div>").addClass("bm-dropdown-pseudocontainer"),this.$pseudoContainer.appendTo(this.$button),this._updatePseudoContainerPosition()},r.prototype._updatePseudoContainerPosition=function(){if(this.$pseudoContainer){var t="top"===this.yPosition?"0":"auto",e="bottom"===this.yPosition?"0":"auto",n="left"===this.xPosition?"0":"auto",i="right"===this.xPosition?"0":"auto";this.$pseudoContainer&&this.$pseudoContainer.css({bottom:e,left:n,right:i,top:t})}},r.prototype._sendEventOpened=function(){this._notify("opened"),i("dropdown-opened").broadcast()},r.prototype._sendEventClosed=function(){this._notify("closed")},r.prototype._addHint=function(){this.$container.css("will-change","transform, opacity")},r.prototype._removeHint=function(){this.$container.css("will-change","auto")},r.prototype._addNoHoverCLass=function(){this.$container.addClass("m-no-hover")},r.prototype._removeNoHoverCLass=function(){this.$container.removeClass("m-no-hover")},r.prototype._removeSingleEventListeners=function(){var t=this;i("dropdown-opened").unsubscribe(function(){return t.close()}),i("close-dropdowns").unsubscribe(function(){return t.close()})},r.prototype._disableScroll=function(t){o.tools.client.isBreakpointTablet()&&(t?o.helper.scroll.disable():o.helper.scroll.enable())},r.prototype._getContainerHeight=function(){var t;return this.$container.addClass("m-invisible"),o.helper.client.triggerRerender(),t=this.$container.height(),this.$container.removeClass("m-invisible"),t},r.prototype._getButtonOffset=function(){return this.$button.offset()},r.prototype._getPageHeight=function(){return o.tools.isNull(this.$page)&&(this.$page=n("@bm-layout-page"),this.$page=this.$page.length?this.$page:n(".bm-layout-page")),this.$page.height()},r.prototype.open=function(t){var e=this;if(!this.isOpened()){this._updateYPosition();var n="bottom"===this.yPosition?"+":"-";s.getVisiblePopup()&&this.autoLayout&&(s.getVisiblePopup().$elem.hasClass("m-simple")||this.setLayoutElement(s.getLastVisiblePopup().getElement())),this.$container.velocity({opacity:1,translateY:""+n+this.yOffset,scale:1},{display:"block",easing:"easeOutExpo",begin:function(){e._sendEventOpened(),e._addHint(),e._setContainerPosition(),e._addNoHoverCLass()},complete:function(){e.opened=!0,e._removeNoHoverCLass(),e._setSingleEventListeners(),e._disableScroll(!0),t&&t()}})}},r.prototype.close=function(t){var e=this;this.isOpened()&&this.$container.velocity({opacity:0},{display:"none",duration:100,begin:function(){e._sendEventClosed(),e._disableScroll(!1)},complete:function(){e.opened=!1,e._setContainerDefaultStyles(),e._removeHint(),e._removeSingleEventListeners(),t&&t()}})},r.prototype.toggle=function(t){this.isOpened()?this.close(t):this.open(t)},r.prototype.isOpened=function(){return this.opened},r}(r);e(a)})}(this,this.modules,this.jQuery,this.radio,this.BM),function(t,e,n,i){e.define("Emotion",["extend","baseView"],function(t,e,n){var o=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments),this.$elem&&(this.$elemEmoji=this.$elem.find("@bm-emotion-emoji"),this.$elemText=this.$elem.find("@bm-emotion-text"),this._config={color:"",image_url:"",label:"",name:"",unicode:""},this.setConfig(e),this._bindEvents(),this.render())},e.prototype._bindEvents=function(){var t=this;this.$elem.on(i.helper.event.clickName(),function(e){t._notify("click",t._config.name)})},e.prototype.setConfig=function(t){i.tools.isPresent(t)&&(this._config=i.tools.mixin(this._config,t))},e.prototype.render=function(){this._config&&(this._config.name&&this.$elem.attr("data-name",this._config.name),this._config.unicode&&(this.$elemEmoji.html(this._config.unicode),i.lib.emoji.supported()||(this.$elem.addClass("m-as-image"),i.lib.emoji.replace(this.$elemEmoji))),this._config.label&&this.$elemText.html(this._config.label),this._config.color&&this.$elem.attr("data-color",this._config.color))},e.prototype.getName=function(){return this._config.name},e.prototype.isStucked=function(){return this._config.stucked},e.prototype.setStateTransparent=function(t){t?this.$elem.addClass("m-transparent"):this.$elem.removeClass("m-transparent")},e.prototype.setStateActive=function(t){t?this.$elem.addClass("m-selected"):this.$elem.removeClass("m-selected")},e.prototype.behaveAsControl=function(t){t?this.$elem.addClass("m-active"):this.$elem.removeClass("m-active")},e.prototype.setSize=function(t){switch(t){case e.Size.SMALL:this.$elem.attr("data-size","small");break;case e.Size.NORMAL:default:this.$elem.removeAttr("data-size")}},e.prototype._getTemplateName=function(){return"bm-emotion-template"},e}(n);o.Size={NORMAL:"normal",SMALL:"small"},t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){e.define("ImpressionForm",["extend","baseView","dynamicContent","Emotion","ImpressionModel","ImpressionFormAutoShare"],function(e,n,r,s,a,u,l){var c={CREATE:"create",EDIT:"edit"},d=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,e.apply(this,arguments))}return _inherits(n,e),n.prototype.initialize=function(n){if(e.prototype.initialize.apply(this,arguments),this.$elem){this._model=null,this._autoShare=null,this._config={dataForImpressionModel:{}},this.$elemAuthor=this.$elem.find("@bm-impression-form-author"),this.$elemAuthorName=this.$elem.find("@bm-impression-form-author-name"),this.$elemEmotionsDynamicContent=this.$elem.find("@bm-impression-form-emotions-dynamic-content"),this.$elemButtonExpandStickers=this.$elem.find("@bm-impression-form-button-expand-stickers"),this.$elemButtonSubmit=this.$elem.find("@bm-impression-form-submit"),this.$elemEmotionsForm=this.$elem.find("@bm-impression-form-emotions"),this.$elemEmotionsWrapper=this.$elem.find("@bm-impression-form-emotions-wrapper"),this.$elemSelectedEmotions=this.$elem.find("@bm-impression-form-selected-emotions"),this.$elemTextareaContent=this.$elem.find("@bm-impression-form-textarea-content"),this.$elemButtonBack=this.$elem.find("@bm-impression-form-button-back"),this.$elemBookName=this.$elem.find("@bm-impression-form-book-name"),this.$elemAutoShare=this.$elem.find("@bm-impression-form-auto-share"),this._emotions=null,this._emotionsControls=[],this._emotionsActive=[],this._hasToAutoShare=!1,this._emotionsFetched=!1,this._emotionsDynamicContent=null,this._initialEmotionsWrapperHeight=null,i.tools.isPresent(n)&&i.tools.isObject(n.data)&&(this._config.dataForImpressionModel=i.tools.mixin(this._config.dataForImpressionModel,n.data)),this._initModel(),this._initAutoShare(),this._resolveAutoShareAvailability(),this._initDynamicContent(),this._loadEmotions(),this._bindEvents();try{t.ImpressionsAutoSharing||(t.ImpressionsAutoSharing=function(t){t?i.tools.storage.setItem("bm-impressions-auto-share-enabled","true"):i.tools.storage.removeItem("bm-impressions-auto-share-enabled")})}catch(o){}}},n.prototype.getModel=function(){return this._model},n.prototype.setButtonBackVisible=function(t){t?this.$elemButtonBack.removeClass("m-hidden"):this.$elemButtonBack.addClass("m-hidden")},n.prototype.setMode=function(t){t===c.CREATE?this.$elemButtonSubmit.html(this.$elemButtonSubmit.data("text-create")):t===c.EDIT&&this.$elemButtonSubmit.html(this.$elemButtonSubmit.data("text-save"))},n.prototype.focus=function(){var t=this,e=this.$elemTextareaContent.val();this.$elemTextareaContent.val(""),setTimeout(function(){t.$elemTextareaContent.focus(),t.$elemTextareaContent.val(e)},500)},n.prototype._initModel=function(){var t=this;this._config.dataForImpressionModel&&(this._model=new u(this._config.dataForImpressionModel),this._model.on("change",function(){t._onModelChange()}))},n.prototype._onModelChange=function(){i.tools.isNull(this._autoShare)||this._autoShare.setData(this._model.json()),this._resolveAutoShareAvailability(),this._useSavedContent()},n.prototype._initAutoShare=function(){i.tools.isNull(this._autoShare)&&(this._autoShare=new l({element:this.$elemAutoShare,data:this._model.json()}))},n.prototype._resolveAutoShareAvailability=function(){i.tools.isNull(this._autoShare)||(this._isAutoShareEnabled()?this._autoShare.show():this._autoShare.hide())},n.prototype._isAutoShareEnabled=function(){return this._isNewImpression()},n.prototype._isNewImpression=function(){return this._model&&!this._model.data.uuid},n.prototype._bindEvents=function(){var t=this;this.$elemButtonExpandStickers.on(i.helper.event.clickName(),function(e){t._onButtonExpandStickersClick(e)}),this.$elemTextareaContent.on("input",function(e){t._onTextareaChange(e)}),this.$elemButtonSubmit.on(i.helper.event.clickName(),function(e){t._onSubmit()}),this.$elemButtonBack.on(i.helper.event.clickName(),function(){t._notify("back-click")}),i.tools.isNull(this._model)||this._model.on("change",function(e){t._updateView()})},n.prototype._onButtonExpandStickersClick=function(t){this._toggleEmotionsWrapper()},n.prototype._onTextareaChange=function(){this._update(),this._isNewImpression()&&this._saveCurrentContent()},n.prototype._saveCurrentContent=function(){if(this._canModelSave()){var t=i.tools.storage.getItem("bm-new-impressions");t||(t={}),t[this._model.data.document_uuid]={text:this.$elemTextareaContent.val()},i.tools.storage.setItem("bm-new-impressions",t)}},n.prototype._removeSavedContent=function(){if(this._canModelSave()){var t=i.tools.storage.getItem("bm-new-impressions");if(t)try{delete t[this._model.data.document_uuid],i.tools.storage.setItem("bm-new-impressions",t)}catch(e){}}},n.prototype._useSavedContent=function(){if(this._isNewImpression()&&this._canModelSave()){var t=i.tools.storage.getItem("bm-new-impressions"),e=t?t[this._model.data.document_uuid]:null;e&&(this._model.data.content||(this._model.data.content=e.text,this.$elemTextareaContent.val(e.text),this._update({updateModel:!1})))}},n.prototype._canModelSave=function(){return this._model&&(this._model.data.uuid||this._model.data.document_uuid)},n.prototype._onSubmit=function(){this._isValid()&&(this._setStateWait(!0),this._save())},n.prototype._save=function(){var e=this;this._model.on("before-save",function(){e._onModelBeforeSave()}),this._model.on("create-success",function(){e._model.off("create-success"),e._onModelSave("create-success");var n={},i=e._model.data.document.data.lc;i&&(n.reading_progress=i.data.progress?i.data.progress:0);var r=t.location.pathname;r.indexOf("books")>=0&&(n.context="book_page"),r.indexOf("reader")>=0&&(n.context="reader"),o.track("Impression Created",n)}),this._model.on("save-success",function(){e._model.off("save-success"),e._onModelSave("save-success")}),this._model.on("save-error",function(){e._model.off("save-error"),e._notify("save-error")}),this._model.save()},n.prototype._onModelBeforeSave=function(){this._isNewImpression()&&(this._hasToAutoShare=!0)},n.prototype._onModelSave=function(t){var e=this,n=function(){e._removeSavedContent(),e._setStateWait(!1),e._notify(t)};new Promise(function(t,e){try{if(!this._hasToAutoShare)return void t();this._hasToAutoShare=!1,this._execAutoShare(function(){t()})}catch(n){console.log(n)}}.bind(this)).then(function(){n()})["catch"](function(){n()})},n.prototype._execAutoShare=function(t){i.tools.isNull(this._autoShare)?t():this._autoShare.exec(t)},n.prototype._setStateWait=function(t){t?(this.$elemButtonSubmit.addClass("m-wait"),this.$elemButtonSubmit.attr("disabled","disabled"),this.$elemTextareaContent.attr("disabled","disabled")):(this.$elemButtonSubmit.removeClass("m-wait"),this.$elemButtonSubmit.removeAttr("disabled"),this.$elemTextareaContent.removeAttr("disabled"))},n.prototype._toggleEmotionsWrapper=function(){this.$elem.hasClass("m-emotions-expanded")?(this.$elem.removeClass("m-emotions-expanded"),this._emotionsDynamicContent.showStep("collapsed")):(this.$elem.addClass("m-emotions-expanded"),this._emotionsDynamicContent.showStep("expanded"))},n.prototype._initDynamicContent=function(){i.tools.isNull(this._emotionsDynamicContent)&&(this._emotionsDynamicContent=new s({element:this.$elemEmotionsDynamicContent}))},n.prototype._loadEmotions=function(){var t=this;i.helper.emotions.getAll(function(e){t._emotions=e,t._renderEmotions(),t._updateView()})},n.prototype._renderEmotions=function(){var t=this;i.tools.isNull(this._emotions)||(this._emotionsControls.forEach(function(t){return t.destroy()}),this._emotionsControls.length=0,this._emotionsControls=[],this._emotions.forEach(function(e){var n=t._renderEmotion(e);t._emotionsControls.push(n),t.$elemEmotionsWrapper.append(n.getElement())}))},n.prototype._renderEmotion=function(t){var e=this,n=new a(t);return n.on(i.helper.event.clickName(),function(t){e._onEmotionClick(t)}),n.behaveAsControl(!0),n},n.prototype._onEmotionClick=function(t){this._toggleEmotion(t)},n.prototype._toggleEmotion=function(t,e){var n=void 0;(n=this._emotionsActive.filter(function(e){return e.getName()===t})).length>0?this._unselectEmotion(n[0]):this._selectEmotion(t),this._update(e)},n.prototype._selectEmotion=function(t){var e=this,n=void 0,o=void 0,r=void 0;i.tools.isArray(this._emotions)&&(n=this._emotions.filter(function(e){return e.name===t})[0],n&&(o=this._renderEmotion(n),r=this._emotionsControls.find(function(t){return t.getName()===o.getName()}),o.setSize(a.Size.SMALL),this._emotionsActive.push(o),o.isStucked()?this.$elemSelectedEmotions.prepend(o.getElement()):this.$elemSelectedEmotions.append(o.getElement()),o.isStucked()?(r.setStateTransparent(!1),this._emotionsControls.filter(function(t){return t.isStucked()&&t.getName()!==o.getName()}).forEach(function(t){t.setStateTransparent(!0),e._unselectEmotion(t)})):r.setStateActive(!0)))},n.prototype._unselectEmotion=function(t){if(t){var e=this._emotionsControls.find(function(e){return e.getName()===t.getName()}),n=this._emotionsActive.find(function(e){return e.getName()===t.getName()});n&&(this._emotionsActive.splice(this._emotionsActive.indexOf(n),1),n.destroy()),e&&(e.isStucked()?0===this._emotionsActive.filter(function(t){return t.isStucked()}).length&&this._emotionsControls.filter(function(t){return t.isStucked()}).forEach(function(t){return t.setStateTransparent(!1)}):e.setStateActive(!1))}},n.prototype._update=function(t){var e=!0;i.tools.isPresent(t)&&i.tools.isPresent(t.updateModel)&&(e=t.updateModel),this._isValid()?this.$elemButtonSubmit.removeAttr("disabled"):this.$elemButtonSubmit.attr("disabled","disabled"),e&&this._updateModel()},n.prototype._updateModel=function(){var t={content:"",emotions:""};t.content=this.$elemTextareaContent.val(),t.emotions=this._emotionsActive.map(function(t){return t.getName()}),this._model.setData(t,{silent:!0})},n.prototype._updateView=function(){var t=this;i.tools.isNull(this._model)||(this.$elemAuthor.prepend(this._model.data.user.view.el),this.$elemAuthorName.html(this._model.data.user.model.nameOrLogin()),this.$elemTextareaContent.html(i.helper.text.escapeSpecialChars(this._model.data.content)),i.tools.isString(this._model.data.document.data.title)?this.$elemBookName.html(i.helper.text.wrapInLocaleDependentQuotes(this._model.data.document.data.title)):this.$elemBookName.html(""),i.tools.isArray(this._model.data.emotions)&&(this._emotionsActive.forEach(function(t){t.destroy(),t=null}),this._emotionsActive.length=0,this._emotionsActive=[],this._model.data.emotions.forEach(function(e){t._toggleEmotion(e.name,{updateModel:!1})})))},n.prototype._isValid=function(){return this._emotionsActive.length>0||i.tools.isString(this.$elemTextareaContent.val())&&this.$elemTextareaContent.val().trim().length>0},n.prototype._getTemplateName=function(){return"bm-impression-form-template"},n}(r);i.tools.mixin(d,{Mode:c}),e(d)})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i){e.define("ImpressionItemModel",["ImpressionModel"],function(t,e){var n=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments)},e}(e);t(n)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o,r,s,a){o.define("uInitAll",["uInitSystemEvents","uInitEnvironmentClasses","uInitBookBadges","uInitLoginWindow","uInitHeader","uInitFooter","uInitCookieInformer","uInitDeeplink","uInitSuperlinks"],function(t){t()})}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel,this.docCookies,this.BM),function(t,e,n,i,o,r,s,a){o.define("uInitBookBadges",["moduleBookBadge"],function(t,e){var i=function(){n("@bm-book-badge").each(function(){var t=n(this);new e({element:t})})};i(),t({init:i})})}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel,this.docCookies,this.BM),function(t,e,n,i,o,r,s,a){o.define("uInitCookieInformer",["moduleBooktiqueCookieInformer"],function(t,e){var i=n("@bm-starhub-cookie-informer");new e({element:i});t()})}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel,this.docCookies,this.BM),function(t,e,n,i,o,r,s,a){o.define("uInitDeeplink",["PopupInstallAppMinimal"],function(e,n){a.helper.deeplink.enabled()&&(s.getItem("deeplink-performed")?(a.tools.isNull(a.helper.session.getItem("inst-wapp-popup-shown"))||"#pasha_superstar"===t.location.hash)&&(a.helper.session.setItem("inst-wapp-popup-shown","true"),(new n).show()):(s.setItem("deeplink-performed",1,2592e6,"/"),a.helper.session.setItem("inst-wapp-popup-shown","true"),a.helper.deeplink.execAuto())),e()})}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel,this.docCookies,this.BM),function(t,e,n,i,o,r,s,a){o.define("uInitEnvironmentClasses",[],function(e){var i=n(t.document.body);a.tools.client.isTouch()?(i.addClass("m-touch"),a.tools.client.isiOS()?i.addClass("m-ios"):a.tools.client.isAndroid()?i.addClass("m-android"):a.tools.client.isWindowsPhone()&&i.addClass("m-windows-phone")):i.addClass("m-desktop"),a.helper.country.isSingapore()&&i.addClass("m-sg"),e()})}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel,this.docCookies,this.BM),function(t,e,n,i,o,r,s,a){o.define("uInitFooter",["moduleFooterInit"],function(t,e){t()})}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel,this.docCookies,this.BM),function(t,e){e.define("uInitHeader",["Header"],function(t,e){new e})}(this,this.modules),function(t,e,n,i,o,r,s,a){o.define("uInitLoginWindow",["loginWindow","embedPopupApi","loginWindowWithUlmartAddon"],function(e,i,o,s){var u=(n(t),n("body"),n("html"),n(".jsOpenLoginWindow")),l=n(".js-open-book-embed-popup"),c=n(".bookmate-popup-auth-overlay").eq(0),d=t.location.hash,h=new i,p=function(){return r.track("Registration Button Pressed",{context:n(this).data("mixpanelctx")}),h.showWindow(),!1},f=function(t){t.preventDefault(),t.stopPropagation();var e=n(this),i=e.attr("data-book-uuid");return i?(o.setBookUuid(i),o.show(),!1):void 0};l.on("click",f),a.tools.client.isTouch()?(u.on(a.tools.client.touchEvent,p),c.on(a.tools.client.touchEvent,h.closeWindow)):(u.on("click",p),c.on("click",h.closeWindow)),t.location.search.indexOf("utm_source=ulmart")>-1&&s.show(),"#login"===d&&h.showWindow(),e()})}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel,this.docCookies,this.BM),function(t,e,n,i,o,r,s,a){o.define("uInitMisc",[],function(e){"#mmm_such_original_so_1april_very_not_com.google"===t.location.hash&&n(".bm-layout").css({"transform-style":"preserve3d",transform:"rotateY(180deg)"}),e()})}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel,this.docCookies,this.BM),function(t,e,n,i,o,r,s,a){o.define("uInitSuperlinks",[],function(e){i("superlink-search-update").subscribe(function(){n("@bm-superlink-search").each(function(){var e=n(this),i=e.attr("href");e.attr("href",i.slice(i.indexOf("="))+"="+t.location.search)})}),e()})}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel,this.docCookies,this.BM),function(t,e,n,i,o,r,s,a){o.define("uInitSystemEvents",[],function(t){i("bm-config-update").subscribe(function(t){t&&t.user&&(t.user.login&&(a.config.mainConfig.userInfo.login=t.user.login),t.user.subscriptions&&(a.config.mainConfig.userInfo.subscriptions=t.user.subscriptions))}),t()})}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel,this.docCookies,this.BM);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(t,e,n,i){"use strict";n.define("FriendSuggestionBaseCardView",[],function(t){var e={};e.prototype={initialize:function(t,e,n){var i=this;i.itemProcessor,i._setItemProcessor(),i._setPostponeValue(t),i.$b=i.itemProcessor.getItem(t),i.$closeButton=i.$b.find(".bm-friend-suggestion-card-close"),i.$stub=i.$b.find(".bm-friend-suggestion-card-stub"),i.position="number"==typeof e?e:t,i.type=t.type,i.options=n||"object"===("undefined"==typeof e?"undefined":_typeof(e))?e:{},i.$b.addClass("card-"+i.position),i.options.animated&&i.$b.addClass("fadeIn"),i.$closeButton.on("click",function(){i.destroy({animated:!0,silent:!1})}),i._initListeners()},_setPostponeValue:function(t){this.postponeValue=""},_setItemProcessor:function(){},_initListeners:function(){},getItem:function(){var t=this;return t.$b},destroy:function(t,e){var n=this,t=t||{},o=function(t){n.$b.addClass("zoomOut"),setTimeout(function(){t()},400)},r=function(){n.$b.remove(),t.silent||i("bm-friend-suggestion-card-closed").broadcast(n.position),e&&e()};n.$closeButton.off(),t.animated?o(r):r()}},t(e)})}(this,this.jQuery,this.modules,this.radio),function(t,e,n,i,o,r){"use strict";e.define("FriendSuggestion",["FriendSuggestionUserView","FriendSuggestionFbConnectView","FriendSuggestionTwConnectView","FriendSuggestionVkConnectView"],function(t,e,s,a,u){var l=function(t){var i=this;i.$b=$(".bm-friend-suggestion"),i.$cardsList=i.$b.find(".bm-friend-suggestion-cards-list"),i.$refreshLink=i.$b.find(".bm-friend-suggestion-refresh-link"),i.$closeLink=i.$b.find(".bm-friend-suggestion-close"),i.options=t||{},i.Views={Facebook:s,Twitter:a,Vkontakte:u,User:e},i.cards=[],i.cardsFetched=[],i.$refreshLink.on("click",function(t){t.preventDefault(),i.preventRefresh||(i.preventRefresh=!0,i._postponeCards(i.cards),o.track("More Friends Button Pressed"))}),n("bm-friend-suggestion-card-closed").subscribe(function(t){0===i.$cardsList.find(".bm-friend-suggestion-card").length&&i._hide(),i._showCards(1,t)}),i.$closeLink.on("click",function(){for(var t=0;t<i.cards.length;t++)i.cards[t].destroy({animated:!0,silent:!0});i.$refreshLink.off(),i.$b.remove(),r.setItem("bm_friend_suggestion_hide",1,1209600,"/")}),i.fetchCards(30)};l.prototype={fetchCards:function(t){var e=this;$.ajax({url:"/a/4/potential_friendships",data:{limit:t,lang:i.config.mainConfig.locale},success:function(t){e.cardsFetched=t,0!==e.cardsFetched.length&&(e._show(),e._showCards(3))}})},_appendCard:function(t){var e=this;e.cards[t.position]=t,0===t.position?e.$cardsList.prepend(t.getItem()):e.cards[t.position-1].getItem().after(t.getItem())},_postponeCards:function(t){for(var e=[],n=this,i=0;i<t.length;i++){var o=t[i];!function(t){n.cards[t].destroy({animated:!0,silent:!1})}(i),e.push([o.type,o.postponeValue])}n.preventRefresh=!1,$.ajax({url:"/a/4/potential_friendships/postpone",data:{objects:JSON.stringify(e)},method:"post",success:function(){console.log("\\_()_/")}})},_show:function(){var t=this;setTimeout(function(){t.$b.removeClass("hidden_height")},1e3),setTimeout(function(){t.$b.css({height:"auto",transition:"none"})},2e3)},_hide:function(){this.$b.addClass("hidden_height")},_showCards:function(t,e,n){var i=this,o=0,r=i.cardsFetched.length,s=r>t?t:r;if(0!==r){if(3>=r&&i.$refreshLink.addClass("hidden"),e){var a=i.cardsFetched.pop();return void i._appendCard(new i.Views[a.type](a,e))}for(n&&(i.preventRefresh=!1);s>o;)!function(){var t=i.cardsFetched.pop();i._appendCard(new i.Views[t.type](t,o))}(),o++}}},t(l)})}(this,this.modules,this.radio,this.BM,this.DIMixpanel,this.docCookies),function(t,e){e.require(["blockCollectEmail"],function(t){t.init("@bm-notification-email",{autoHideError:!0})})}(this,this.modules),function(t,e,n){"use strict";e.define("notificationsModule",[],function(t){var e=function(){var t=n("@bm-notifications"),e=t.find("@bm-notification").not(".collapsed").length;0==e&&t.addClass("collapsed")};e();var i=function(t){var e=new Date;"expiration"===t&&docCookies.setItem("bm_subscription_notification","1",new Date(e.getFullYear(),e.getMonth(),e.getDate()+1),"/"),
"mts_by"===t&&docCookies.setItem("bm_mts_by_notification","1",new Date(e.getFullYear(),e.getMonth(),e.getDate()+365),"/")};n("@bm-notification-close").click(function(){return n(this).closest("@bm-notification").addClass("collapsed"),e(),i(n(this).data("notification")),!1}),t()})}(this,this.modules,this.jQuery),function(t,e,n,i,o,r){"use strict";i.define("BaseNotificationItemProcessor",["UserPublic"],function(e,n){var i={};i.prototype={initialize:function(t,e){var n=this;n.templateFactory,r.locale(o.config.mainConfig.locale),n._createTemplateFactory()},_createTemplateFactory:function(){},baseItemInit:function(e,i){var o=e.find(".bm-notification-inbox-item-avatar"),s=e.find(".bm-notification-inbox-item-message-user"),a=e.find(".bm-notification-inbox-item-activists"),u=i.initiators[0],l=i.initiators.length>1;o.attr("href","/"+u.login),o.find("img").attr("src",u.avatar_url),s.attr("href","/"+u.login),s.html(u.name||u.login),s.on("click",function(e){preventDefault(),DIMixpanel.discovered.set({ctx:"notifications",uuid:i.id}),setTimeout(function(){t.location=u.login},300)}),e.find(".bm-notification-inbox-item-timestamp").html(r(1e3*i.created_at-9e4).fromNow(!0)),l&&i.initiators.slice(1,17).forEach(function(t){var e=new n({data:{model:t}});a.append(e.view.el)}.bind(this))}},e(i)})}(this,this.document,this.jQuery,this.modules,this.BM,this.moment),function(t,e,n,i){"use strict";e.define("NotificationInbox",["FollowBookshelfItemProcessor","FollowUserItemProcessor","FriendReadItemProcessor","ReadBookshelfDocumentItemProcessor","LikeMarkerItemProcessor","LikeImpressionItemProcessor","SocialNetworkFriendRegisteredItemProcessor","InviteeRegisteredItemProcessor","InviteeSubscribedItemProcessor","DropDown"],function(e,n,o,r,s,a,u,l,c,d,h){var p=($(document),$("head > title")),f=function(t){var e=this;e.clickEvent=BM.tools.client.isTouch()?BM.tools.client.touchEvent:"click",e.$b=$(".bm-notification-inbox"),e.$icon=e.$b.find(".bm-notification-inbox-icon"),e.$container=e.$b.find(".bm-notification-inbox-list-container"),e.$empty=e.$b.find(".bm-notification-inbox-empty"),e.$wrapper=e.$b.find(".bm-notification-inbox-list-wrapper"),e.$loader=e.$b.find(".bm-notification-inbox-loader"),e.hasUnread=e.$b.hasClass("unread"),e.newNotificationStr=" ",e.opts=t||{},e.p=e.opts.p||1,e.pp=e.opts.pp||10,e.preventPaging,e.loading,e.Types={follow_user:o,follow_bookshelf:n,friend_read:r,read_bookshelf_document:s,like_marker:a,like_document_impression:u,social_network_friend_registered:l,invitee_registered:c,invitee_subscribed:d},e.dropDown=new h({$button:e.$b,$container:e.$container}),e._updateTitle(),e.$b.on(e.clickEvent,function(t){t.stopPropagation(),e._onIconClick()}),e.$container.on("click",".bm-notification-inbox-item-message-document",function(t){i.discovered.set({channel:"user",ctx:"notifications"})}),e.$wrapper.on("scroll",function(t){e._onWrapperScroll()})};f.prototype={_onIconClick:function(){var t=this;t.loading||(t.dropDown.isOpened()?t._hideContainer():(t._showLoader(),t._loadNotifications(!0),t._sendReadRequest()))},_onWrapperScroll:function(){var t=this;!t.preventPaging&&t.$wrapper.scrollTop()+t.$wrapper.height()>=70*Math.max(0,t.$wrapper.find("> .bm-notification-inbox-item").length-1)&&t._loadNotifications()},_hideContainer:function(){this.$wrapper.addClass("hidden"),this.$empty.addClass("hidden"),this.$loader.addClass("hidden")},_showLoader:function(t){t?this.$loader.addClass("inline"):this.$loader.removeClass("inline"),this.$loader.removeClass("hidden")},_hideLoader:function(){this.$loader.addClass("hidden")},_loadNotifications:function(t){var e=this;t?(e.p=1,e.$wrapper.html(""),e._showLoader()):(++e.p,e._showLoader(!0)),e.preventPaging=!0,e.loading=!0;var n="/a/4/n.json",i={p:e.p,pp:e.pp};$.ajax({url:n,data:i,success:function(t){if(e._hideLoader(),e.loading=!1,t.length<5?e.preventPaging=!0:e.preventPaging=!1,!t.length&&1===e.p)return void e._showEmpty();for(var n=0;n<t.length;n++){var i=t[n];e.Types[i.key]&&e.$wrapper.append(e.Types[i.key].getItem(i))}e._showWrapper()}})},_showEmpty:function(){this.$empty.removeClass("hidden"),this.$wrapper.addClass("hidden")},_showWrapper:function(){this.$empty.addClass("hidden"),this.$wrapper.removeClass("hidden")},_sendReadRequest:function(){var t=this;t.hasUnread&&$.ajax({url:"/a/4/n/read.json",method:"post",success:function(){t.hasUnread=!1,t.$b.removeClass("unread"),t._updateTitle()}})},_updateTitle:function(){var t=this,e=p.html();t.hasUnread&&-1===e.indexOf(t.newNotificationStr)?p.html(t.newNotificationStr+e):0===e.indexOf(t.newNotificationStr)&&p.html(e.substring(t.newNotificationStr.length))}},t.NotificationInbox=new f,e()})}(this,this.modules,this.radio,this.DIMixpanel),function(t,e,n,i,o){e.define("PaymentFormLoader",["baseView","extend","dynamicContent","PaymentForm"],function(t,e,n,o,r){var s=n(e),a=s,u=a.superclass,l="bm-payment-form-loader-template";i.tools.mixin(a.prototype,{initialize:function(t){u.initialize.apply(this,arguments),this.$elemDynamicContent=this.$elem.find("@bm-payment-form-loader-dynamic-content"),this.$elemPaymentFormWrapper=this.$elem.find("@bm-payment-form-loader-form"),this._dynamicContent=null,this._paymentForm=null,this._timeoutLoadMethods=null,this._requestPaymentMethods=null,this._allowedPaymentMethods=null,this._initDynamicContent(),this._appendPaymentForm()},_initDynamicContent:function(){this._dynamicContent=new o({element:this.$elemDynamicContent})},_appendPaymentForm:function(){this._paymentForm=new r,this.$elemPaymentFormWrapper.append(this._paymentForm.getElement())},show:function(t){var e=this;this.arePaymentMethodsLoaded()?(this._dynamicContent.setStep("form"),"function"==typeof t&&t()):this.loadPaymentMethods(function(n){e.clearTimeoutLoadMethods(),"function"==typeof t&&t(),e._dynamicContent.showStep("form")},function(){e.clearTimeoutLoadMethods()})},arePaymentMethodsLoaded:function(){return!i.tools.isNull(this._allowedPaymentMethods)},loadPaymentMethods:function(t,e){var n=this;this._dynamicContent.showStep("loading"),i.helper.subscription.fetchPrices(function(e){n._allowedPaymentMethods=e,n._applyPaymentMethodsRequestData(n._allowedPaymentMethods),t&&t(e)},function(t){i.tools.isFunction(e)&&e(t)})},_applyPaymentMethodsRequestData:function(t){var e=!1;t=this._prepareData(t),t.forEach(function(t){t.levels.forEach(function(t){"premium"===t.kind&&(e=!0)})}),this._paymentForm.setAvailableMethods(t)},_prepareData:function(t){return t},stop:function(){i.tools.isNull(this._requestPaymentMethods)||"function"!=typeof this._requestPaymentMethods.abort||(this._requestPaymentMethods.abort(),this._requestPaymentMethods=null),this.clearTimeoutLoadMethods()},clearTimeoutLoadMethods:function(){i.tools.isNull(this._timeoutLoadMethods)||(clearTimeout(this._timeoutLoadMethods),this._timeoutLoadMethods=null)},_getTemplateName:function(){return l},getPaymentForm:function(){return this._paymentForm}}),t(s)})}(this,this.modules,this.jQuery,this.BM,this.radio),function(t,e,n,i,o,r){e.define("PaymentForm",["baseView","extend","dynamicContent","modulePaymentFormBlockVisa","paymentFormPaypal","PaymentFormBlockQiwi"],function(e,s,a,u,l,c,d){var h=a(s),p=h,f=p.superclass;i.tools.mixin(p,{SubscriptionType:{DEFAULT:"default",BOOSTER:"booster",PREMIUM:"premium"},SubscriptionDuration:{MONTH:"month",YEAR:"year"},PaymentMethod:{VISA:"visa",PAYPAL:"braintreepaypal",QIWI:"qiwi"}}),i.tools.mixin(p.prototype,{initialize:function(){f.initialize.apply(this,arguments),this.$elemDynamicContent=this.$elem.find("@bm-dynamic-content-method-select"),this.$elemDynamicContentVisa=this.$elem.find("@bm-dynamic-content-visa"),this.$elemDynamicContentPaypal=this.$elem.find("@bm-dynamic-content-paypal"),this.$elemDynamicContentQiwi=this.$elem.find("@bm-dynamic-content-qiwi"),this.$elemButtonVisa=this.$elem.find("@form-payment-method-select-visa"),this.$elemButtonPaypal=this.$elem.find("@form-payment-method-select-paypal"),this.$elemButtonQiwi=this.$elem.find("@form-payment-method-select-qiwi"),this.$elemButtonTele2ee=this.$elem.find("@form-payment-method-select-tele2ee"),this.$elemsMethodButtons=this.$elem.find(".bm-payment-form-methods-item"),this._planButtons=[this.$elemButtonMonthVisa=this.$elem.find("@form-payment-button-plan-month-visa"),this.$elemButtonYearVisa=this.$elem.find("@form-payment-button-plan-year-visa"),this.$elemButtonMonthPaypal=this.$elem.find("@form-payment-button-plan-month-paypal"),this.$elemButtonYearPaypal=this.$elem.find("@form-payment-button-plan-year-paypal"),this.$elemButtonMonthQiwi=this.$elem.find("@form-payment-button-plan-month-qiwi"),this.$elemButtonYearQiwi=this.$elem.find("@form-payment-button-plan-year-qiwi")],this.$elemVisaOneYearNotice=this.$elem.find("@form-payment-visa-one-year-notice"),this.$elemFormVisa=this.$elem.find("@bm-form-visa-standalone"),this.$elemFormPaypal=this.$elem.find("@bm-payment-form-paypal"),this.$elemFormQiwi=this.$elem.find("@bm-form-qiwi"),this.$elemsSubscriptionPrice=this.$elem.find("@bm-subscription-price"),this.$elemsSavings=this.$elem.find("@bm-subscription-savings"),this._dynamicContent=null,this._dynamicContentVisa=null,this._dynamicContentPaypal=null,this._dynamicContentQiwi=null,this._formVisaHandler=null,this._formPaypalHandler=null,this._formQiwiHandler=null,this._availableMethods=null,this._currentSubscriptionKind="default",this._lastPaymentMethod=r.getItem("lastPaymentMethod")||null,this._lastSubscriptionDuration=null,this._initDynamicContent(),this._initForms(),this._setupEvents()},reset:function(){this._dynamicContent.setStep("empty"),this.$elemVisaOneYearNotice.attr("data-visible","false"),this._selectMethodButton(null),this._setPlanButtonActive(null),this._clearInnerDynamicContent()},setAvailableMethods:function(t){i.tools.isArray(t)&&(this._availableMethods=t,this._availableMethods.forEach(function(t){-1!==t.levels.map(function(t){return t.kind}).indexOf(this._currentSubscriptionKind)?this.enableMethod(t.payment_system):this.disableMethod(t.payment_system)}.bind(this))),this._updatePrices()},isPlanPremium:function(){},disableMethod:function(t){this.$elemsMethodButtons.filter("[data-payment-system="+t+"]").attr("disabled","disabled")},enableMethod:function(t){this.$elemsMethodButtons.filter("[data-payment-system="+t+"]").removeAttr("disabled")},setSubscriptionKind:function(t){t===p.SubscriptionType.BOOSTER&&(t=p.SubscriptionType.PREMIUM),this._currentSubscriptionKind=t,this._updatePrices(),this._updateAvailableMethods()},_updateAvailableMethods:function(){this._availableMethods&&this.setAvailableMethods(this._availableMethods)},_getPaymentMethodData:function(t){var e=null;return this._availableMethods.forEach(function(n){n.payment_system===t&&(e=n)}),e},_getSubscriptionPlan:function(t,e){var n=this,t=this._getPaymentMethodData(t),i=null;return t.levels.forEach(function(t){t.kind===n._currentSubscriptionKind&&t.products.forEach(function(t){t.duration===e&&(i=t.product_id)})}),i},_initDynamicContent:function(){i.tools.isNull(this._dynamicContent)&&(this._dynamicContent=new u({element:this.$elemDynamicContent})),i.tools.isNull(this._dynamicContentVisa)&&(this._dynamicContentVisa=new u({element:this.$elemDynamicContentVisa})),i.tools.isNull(this._dynamicContentPaypal)&&(this._dynamicContentPaypal=new u({element:this.$elemDynamicContentPaypal})),i.tools.isNull(this._dynamicContentQiwi)&&(this._dynamicContentQiwi=new u({element:this.$elemDynamicContentQiwi}))},_initForms:function(){this._initFormVisa(),this._initFormPaypal(),this._initFormQiwi()},_updatePrices:function(){var t=this;null!==this._availableMethods&&this._availableMethods.forEach(function(e){var n=t.$elemsSubscriptionPrice.filter("[data-method="+e.payment_system+"]");e.levels.forEach(function(e){var i;e.kind===t._currentSubscriptionKind&&e.products.forEach(function(t){i=n.filter("[data-duration="+t.duration+"]"),i.html(t.readable_price)})})}),this._updateVisaSavingsValue()},_updateVisaSavingsValue:function(){var t=this.$elemsSavings.filter("[data-method="+p.PaymentMethod.VISA+"]"),e=i.helper.subscription.getPriceAsInt(this._currentSubscriptionKind,"month",{keepFloats:!0}),n=i.helper.subscription.getPriceAsInt(this._currentSubscriptionKind,"year",{keepFloats:!0});return e&&n?void t.html(i.helper.subscription.toCurrency(12*e-n,i.helper.subscription.getCurrency(i.helper.subscription.getPrice(this._currentSubscriptionKind,"month")))):null},_initFormVisa:function(){this._formVisaHandler=new l({element:this.$elemFormVisa})},_initFormPaypal:function(){this._formPaypalHandler=new c({element:this.$elemFormPaypal})},_initFormQiwi:function(){this._formQiwiHandler=new d({element:this.$elemFormQiwi,iframe:!1})},_setupEvents:function(){var t=this,e=i.tools.client.isTouch()?i.tools.client.touchEvent:"click";this.$elemButtonVisa.on(e,function(){t._onButtonVisaClick()}),this.$elemButtonPaypal.on(e,function(){t._onButtonPaypalClick()}),this.$elemButtonQiwi.on(e,function(){t._onButtonQiwiClick()}),this.$elemButtonTele2ee.on(e,function(e){t._onButtonTele2eeClick(e)}),this.$elemButtonMonthVisa.on(e,function(){t._onButtonVisaMonthClick()}),this.$elemButtonYearVisa.on(e,function(){t._onButtonVisaYearClick()}),this.$elemButtonMonthPaypal.on(e,function(){t._onButtonPaypalMonthClick()}),this.$elemButtonYearPaypal.on(e,function(){t._onButtonPaypalYearClick()}),this.$elemButtonMonthQiwi.on(e,function(){t._onButtonQiwiMonthClick()}),this.$elemButtonYearQiwi.on(e,function(){t._onButtonQiwiYearClick()}),this._dynamicContent.on("fade-out-end",function(){t._clearInnerDynamicContent()}),this._formVisaHandler.on("subscription-success",function(e){t._onSubscriptionSuccess(e)}),this._formVisaHandler.on("subscription-error",function(e){t._onSubscriptionError(e)}),this._formPaypalHandler.on("payment-success",function(e){t._onSubscriptionSuccess(e)}),this._formPaypalHandler.on("payment-error",function(e){t._onSubscriptionError(e)}),this._formQiwiHandler.on("subscription-success",function(e){t._onSubscriptionSuccess(e)}),this._formQiwiHandler.on("subscription-error",function(e){t._onSubscriptionError(e)})},_onButtonVisaClick:function(){this._dynamicContent.isUpdateInProgress()||this._selectMethodVisa()},_onButtonPaypalClick:function(){this._dynamicContent.isUpdateInProgress()||this._selectMethodPaypal()},_onButtonQiwiClick:function(){this._dynamicContent.isUpdateInProgress()||this._selectMethodQiwi()},_onButtonTele2eeClick:function(e){var n=this;this._dynamicContent.isUpdateInProgress()||(o.track("Payment Type Selected",{payment_type:"tele_ee"}),setTimeout(function(){t.location.href=n.$elemButtonTele2ee.attr("href")},200)),e.preventDefault(),e.stopPropagation()},_onButtonVisaMonthClick:function(){var t=this;this._lastSubscriptionDuration=p.SubscriptionDuration.MONTH,this._formVisaHandler.setCurrentPlan(this._getSubscriptionPlan(p.PaymentMethod.VISA,p.SubscriptionDuration.MONTH)),this._setPlanButtonActive(this.$elemButtonMonthVisa),this._sendEventDurationTypeSelected(),this._dynamicContentVisa.showStep("form",function(){t.$elemVisaOneYearNotice.attr("data-visible","false"),t._notify("form-shown")},!0)},_onButtonVisaYearClick:function(){var t=this;this._lastSubscriptionDuration=p.SubscriptionDuration.YEAR,this._formVisaHandler.setCurrentPlan(this._getSubscriptionPlan(p.PaymentMethod.VISA,p.SubscriptionDuration.YEAR)),this._setPlanButtonActive(this.$elemButtonYearVisa),this._sendEventDurationTypeSelected(),this._dynamicContentVisa.showStep("form",function(){t.$elemVisaOneYearNotice.attr("data-visible","true"),t._notify("form-shown")},!0)},_onButtonPaypalMonthClick:function(){var t=this;this._lastSubscriptionDuration=p.SubscriptionDuration.MONTH,this._setPlanButtonActive(this.$elemButtonMonthPaypal),this._formPaypalHandler.setCurrentPlan(this._getSubscriptionPlan(p.PaymentMethod.PAYPAL,p.SubscriptionDuration.MONTH)),this._sendEventDurationTypeSelected(),this._dynamicContentPaypal.showStep("form",function(){t._formPaypalHandler.init(),t._notify("form-shown")})},_onButtonPaypalYearClick:function(){var t=this;this._lastSubscriptionDuration=p.SubscriptionDuration.YEAR,this._setPlanButtonActive(this.$elemButtonYearPaypal),this._formPaypalHandler.setCurrentPlan(this._getSubscriptionPlan(p.PaymentMethod.PAYPAL,p.SubscriptionDuration.YEAR)),this._sendEventDurationTypeSelected(),this._dynamicContentPaypal.showStep("form",function(){t._formPaypalHandler.init(),t._notify("form-shown")})},_onButtonQiwiMonthClick:function(){var t=this;this._lastSubscriptionDuration=p.SubscriptionDuration.MONTH,this._formQiwiHandler.setCurrentPlan(this._getSubscriptionPlan(p.PaymentMethod.QIWI,p.SubscriptionDuration.MONTH)),this._setPlanButtonActive(this.$elemButtonMonthQiwi),this._sendEventDurationTypeSelected(),this._dynamicContentQiwi.showStep("form",function(){t._notify("form-shown")},!0)},_onButtonQiwiYearClick:function(){var t=this;this._lastSubscriptionDuration=p.SubscriptionDuration.YEAR,this._formQiwiHandler.setCurrentPlan(this._getSubscriptionPlan(p.PaymentMethod.QIWI,p.SubscriptionDuration.YEAR)),this._setPlanButtonActive(this.$elemButtonYearQiwi),this._sendEventDurationTypeSelected(),this._dynamicContentQiwi.showStep("form",function(){t._notify("form-shown")},!0)},_selectMethodVisa:function(){this._selectMethod("visa")},_setCurrentPlan:function(){},_selectMethodPaypal:function(){this._selectMethod("braintreepaypal")},_selectMethodQiwi:function(){this._selectMethod("qiwi")},_selectMethod:function(t){r.setItem("lastPaymentMethod",t),this._lastPaymentMethod=t,this._dynamicContent.showStep(t),this._setPlanButtonActive(null),this._selectMethodButton(t),this._sendEventPaymentMethodSelected()},_sendEventPaymentMethodSelected:function(){o.track("Payment Type Selected",{sub_type:this._toMixpanelSubscriptionKind(this._currentSubscriptionKind),payment_type:this._toMixpanelPaymentType(this._lastPaymentMethod)})},_sendEventDurationTypeSelected:function(){o.track("Duration Type Selected",{sub_type:this._toMixpanelSubscriptionKind(this._currentSubscriptionKind),duration_type:this._toMixpanelSubscriptionDuration(this._lastSubscriptionDuration),payment_type:this._toMixpanelPaymentType(this._lastPaymentMethod)})},_toMixpanelPaymentType:function(t){var e=null;switch(t){case p.PaymentMethod.VISA:e="card";break;case p.PaymentMethod.PAYPAL:e="paypal";break;case p.PaymentMethod.QIWI:e="qiwi"}return e},_toMixpanelSubscriptionDuration:function(t){var e=null;switch(t){case p.SubscriptionDuration.MONTH:e="month";break;case p.SubscriptionDuration.YEAR:e="year"}return e},_toMixpanelSubscriptionKind:function(t){var e=null;switch(t){case p.SubscriptionType.DEFAULT:e="standard";break;case p.SubscriptionType.PREMIUM:case p.SubscriptionType.BOOSTER:e="premium"}return e},_selectMethodButton:function(t){this.$elemsMethodButtons.each(function(){var e=n(this);e.attr("data-step")===t?e.addClass("m-selected"):e.removeClass("m-selected")})},_setPlanButtonActive:function(t){null!==t?this._planButtons.forEach(function(e){e===t?(e.addClass("m-selected"),e.removeClass("m-grey")):(e.removeClass("m-selected"),e.addClass("m-grey"))}):this._planButtons.forEach(function(t){t.removeClass("m-selected"),t.removeClass("m-grey")})},_clearInnerDynamicContent:function(){this._dynamicContentVisa.setStep("initial"),this._dynamicContentPaypal.setStep("initial"),this._dynamicContentQiwi.setStep("initial")},_onSubscriptionSuccess:function(t){this._trackSuccess(),this._notify("subscription-success",t)},_onSubscriptionError:function(t){this._trackError(t)},_trackSuccess:function(){var t={sub_type:this._toMixpanelSubscriptionKind(this._currentSubscriptionKind),duration_type:this._toMixpanelSubscriptionDuration(this._lastSubscriptionDuration),payment_type:this._toMixpanelPaymentType(this._lastPaymentMethod)};o.track("Subscription Successful",t)},_trackError:function(t){var e={sub_type:this._toMixpanelSubscriptionKind(this._currentSubscriptionKind),duration_type:this._toMixpanelSubscriptionDuration(this._lastSubscriptionDuration),payment_type:this._toMixpanelPaymentType(this._lastPaymentMethod)};t&&t.errors&&(e.reason=t.errors),o.track("Subscription Failed",e)},_getTemplateName:function(){return"bm-payment-form-template"},getKindByPlan:function(t){var e=null;return this._availableMethods&&this._availableMethods.forEach(function(n){n.levels.forEach(function(n){n.products.forEach(function(i){t===i.product_id&&(e=n.kind)})})}),e}}),e(h)})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel,this.docCookies),function(t,e,n,i){e.define("paymentFormPaypal",["PubSub","extend","dynamicContent"],function(e,o,r,s){var a=r(o),u=a,l=u.superclass,c="bm-payment-form-paypal-template",d="bm-form-paypal-button-buy",h="bm-form-paypal-input-nonce",p=0;i.tools.mixin(u.prototype,{initialize:function(t){l.initialize.apply(this,arguments),this._clientToken=null,this._dynamicContent=null,this._currentPlan=null,this._timeoutCheckPaypalButtonPresence=null,this._lastRequestHandler=null,this._paypalControlsUniqueId=null,this.$elem=null,i.tools.isUndefined(t)||i.tools.isUndefined(t.element)?this.$elem=this._createElement():this.$elem=t.element,this.$elemDynamicContentElement=this.$elem.find("@bm-payment-form-paypal-dynamic-content"),this.$elemButtonRetryClientTokenLoad=this.$elem.find("@bm-payment-form-paypal-button-retry-client-token-load"),this.$elemButtonBuyWrapper=this.$elem.find("@bm-payment-form-paypal-button-buy-wrapper"),this.$elemInputNonce=this.$elem.find("@bm-payment-form-paypal-input-nonce"),this.$elemButtonPayHint=this.$elem.find("@bm-payment-form-paypal-button-pay-hint"),this.$elemButtonPaySpinner=this.$elem.find("@bm-payment-form-paypal-button-pay-spinner"),this.$elemErrorTextWrapper=this.$elem.find("@bm-payment-form-paypal-error-text-wrapper"),this.$elemErrorTextDynamic=this.$elem.find("@bm-payment-form-paypal-error-text-dynamic"),this.$elemErrorPossibleReason=this.$elem.find("@bm-payment-form-paypal-error-possible-reason"),this._initDynamicContent(),this._setupEvents()},_initDynamicContent:function(){i.tools.isNull(this._dynamicContent)&&(this._dynamicContent=new s({element:this.$elemDynamicContentElement}))},_setupEvents:function(){var t=this,e=i.tools.client.isTouch()?i.tools.client.touchEvent:"click";this.$elemButtonRetryClientTokenLoad.on(e,function(){t._loadClientToken()}),this.$elem.on("click",function(e){e.target===t.$elem.find("#bt-pp-cancel").get(0)&&t._onPaypalCancelClick()})},_onPaypalCancelClick:function(){this._showButtonPayHint(),this._hideButtonPaySpinner(),this._abort()},init:function(){return i.tools.isNull(this._clientToken)?void this._loadClientToken():void this._showButtonPayHint()},setCurrentPlan:function(t){this._currentPlan=t},_loadClientToken:function(){var t=this;this._dynamicContent.showStep("loading"),this._lastRequestHandler=n.ajax({url:"/payments/braintree/client_token",type:"post",success:function(e){t._clientToken=e.client_token,t._renderButtonBuy()},error:function(){t._showError(),t._notify("subscription-error",{message:"client_token_load_error"})}})},clear:function(){i.tools.isNull(this._clientToken)&&this._dynamicContent.setState("loading")},_renderButtonBuy:function(){if(!i.tools.isNull(this._clientToken)&&t.braintree){var e=this;this._startPaypalButtonCheckingLoop(),this._clearButtonBuy(),this._generateIdsForPaypalControls(),this._hideButtonPaySpinner(),t.braintree.setup(this._clientToken,"paypal",{container:this.$elemButtonBuyWrapper.attr("id"),nonce:this.$elemInputNonce.attr("id"),onSuccess:function(){e._hideButtonPayHint(),e._sendRequestPaypalPayment()},onError:function(){e._showError(),e._notify("subscription-error",{message:"paypal_button_render_error"})}})}},_clearButtonBuy:function(){this.$elemButtonBuyWrapper.html("")},_sendRequestPaypalPayment:function(){var t=this;this._showButtonPaySpinner(),this._lastRequestHandler=n.ajax({url:"/payments/braintree",type:"post",dataType:"json",data:{braintree:{plan:this._currentPlan,payment_method_nonce:this.$elemButtonBuyWrapper.find("[name=payment_method_nonce]").val(),device_data:i.helper.braintree.deviceData()}},success:function(e){t._notify("payment-success",e)},error:function(e){var n;t._notify("payment-error"),e&&e.responseJSON&&e.responseJSON.errors&&(n=e.responseJSON.errors),t._showError(n),t._notify("subscription-error",{message:n})}})},_startPaypalButtonCheckingLoop:function(){this._paypalButtonAlreadyRendered()?this._onPaypalButtonRendered():this._checkIfPaypalButtonRendered()},_checkIfPaypalButtonRendered:function(){var t=this;i.tools.isNull(this._timeoutCheckPaypalButtonPresence)||(clearTimeout(this._timeoutCheckPaypalButtonPresence),this._timeoutCheckPaypalButtonPresence=null),this._timeoutCheckPaypalButtonPresence=setTimeout(function(){t._paypalButtonAlreadyRendered()?t._onPaypalButtonRendered():t._checkIfPaypalButtonRendered()},250)},_paypalButtonAlreadyRendered:function(){return this.$elemButtonBuyWrapper.find("#braintree-paypal-button").length>0},_onPaypalButtonRendered:function(){this._showButtonPay()},_showButtonPay:function(){this._dynamicContent.showStep("button-pay")},_showButtonPayHint:function(){this.$elemButtonPayHint.removeAttr("data-visible")},_hideButtonPayHint:function(){this.$elemButtonPayHint.attr("data-visible","false")},_showButtonPaySpinner:function(){this.$elemButtonPaySpinner.attr("data-spinner","true")},_hideButtonPaySpinner:function(){this.$elemButtonPaySpinner.removeAttr("data-spinner")},_generateIdsForPaypalControls:function(){this._paypalControlsUniqueId=++p,this.$elemButtonBuyWrapper.attr("id",d+this._paypalControlsUniqueId),this.$elemInputNonce.attr("id",h+this._paypalControlsUniqueId)},_showError:function(t){i.tools.isUndefined(t)?(this.$elemErrorTextWrapper.removeAttr("data-error-custom"),this.$elemErrorPossibleReason.removeAttr("hidden")):(this.$elemErrorTextWrapper.attr("data-error-custom","true"),this.$elemErrorTextDynamic.html(t.replace("\n","<br/>")),this.$elemErrorPossibleReason.attr("hidden","hidden")),this._dynamicContent.showStep("error")},_clear:function(){this.$elemButtonBuyWrapper.html("")},_abort:function(){i.tools.isNull(this._lastRequestHandler)||"function"==typeof this._lastRequestHandler.abort&&this._lastRequestHandler.abort()},_createElement:function(){var t=this._getTemplateName();this.$elem=n(n("#"+t).html())},_setState:function(t){this.$elem.attr("data-state","state")},_getTemplateName:function(){return c}}),e(a)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("PaymentFormBlockQiwi",["baseView","FormInputPhone","dynamicContent","PopupIframe"],function(e,o,r,s,a){var u=function(e){function o(){return _classCallCheck(this,o),_possibleConstructorReturn(this,e.apply(this,arguments))}return _inherits(o,e),o.prototype.initialize=function(t){e.prototype.initialize.apply(this,arguments),this.$el&&(this.iframe=i.tools.isBoolean(t.iframe)?t.iframe:!1,this.$inputPhoneWrapper=this.$el.find("@bm-form-qiwi-input-phone-wrapper"),this.$iframeWrapper=this.$el.find("@bm-form-qiwi-iframe-wrapper"),this.$dc=this.$el.find("@bm-form-qiwi-dynamic-content"),this.$submit=this.$el.find("@bm-form-qiwi-submit"),this.$error=this.$el.find("@bm-form-qiwi-error"),this.$iframe=null,this._inputPhone=null,this._dc=null,this._plan=null,this._popupIframe=null,this._repeater=null,this._initDC(),this._initInputPhone(),this._bindEvents())},o.prototype.setCurrentPlan=function(t){i.tools.isString(t)&&(this._plan=t)},o.prototype._bindEvents=function(){var t=this;this.$submit.on(i.helper.event.clickName(),function(e){t._submit()})},o.prototype._bindIframeEvents=function(){this._popupIframe.on("hide",function(){return _onIframeClosed()})},o.prototype._initInputPhone=function(){var t=this;i.tools.isNull(this._inputPhone)&&(this._inputPhone=new r,this._inputPhone.on("keyup",function(e){t._update()}),this.$inputPhoneWrapper.append(this._inputPhone.$el))},o.prototype._initDC=function(){this._dc=new s({element:this.$dc})},o.prototype._setSubmitEnabled=function(t){t?this.$submit.removeAttr("disabled"):this.$submit.attr("disabled","disabled")},o.prototype._update=function(){this._setSubmitEnabled(this._isFormValid())},o.prototype._isFormValid=function(){return/^\+?([0-9]{4,})$/.test(this._inputPhone.val())},o.prototype._submit=function(){var e=this;this._isFormValid()&&(this._wait(!0),n.ajax({url:"/a/4/billing/qiwi",type:"post",dataType:"json",data:{auth_token:i.helper.auth.getAuthToken(),qiwi:{phone:this._inputPhone.val(),iframe:this.isIframe(),plan:this._plan}},success:function(n){e.isIframe()?(e._startCheckingLoop(),e._showPopupIframe(n.url)):(e.$error.hide(),e._wait(!1),setTimeout(function(){t.location.href=n.url},100))},error:function(t){t&&t.error&&"string"==typeof t.error&&e.$error.html(t.error),e.$error.show(),e._wait(!1)}}))},o.prototype._wait=function(t){t?(this.$submit.attr("wait","true"),this._setSubmitEnabled(!1)):(this.$submit.removeAttr("wait"),this._setSubmitEnabled(!0))},o.prototype._showPopupIframe=function(t){i.tools.isNull(this._popupIframe)||(this._popupIframe.destroy(),this._popupIframe=null),this._popupIframe=new a({attrs:{src:t}}),this._bindIframeEvents(),this._popupIframe.addRootClassName("m-qiwi-payment"),this._popupIframe.show()},o.prototype._startCheckingLoop=function(){this._stopCheckingLoop(),this._repeater=new i.helper.misc.repeater({callback:function(){},timeout:2500})},o.prototype._stopCheckingLoop=function(){i.tools.isNull(this._repeater)||(this._repeater.stop(),this._repeater.destroy(),this._repeater=null)},o.prototype._checkStatus=function(){n.ajax({url:"/a/4/billing/qiwi/status",data:{},success:function(t){}})},o.prototype._onIframeClosed=function(){},o.prototype.isIframe=function(){return this.iframe},o}(o);e(u)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("modulePaymentFormBlockVisa",["PubSub","extend","paymentPopup/visa"],function(t,e,o){var r=n.custom.popupPaymentFormVisa;n.widget("custom.formPaymentVisaHandler",r,{_sendRequestSubscribe:function(){var t=this;this._setFormWait(!0),this._sendGAEventPaymentButtonPress(),this._getPostDataWithNonce({success:function(e){n.ajax({type:"post",url:"/payments/braintree",data:e,dataType:"json",success:function(e){t._onSubscribeSuccess(e),t.element.trigger("subscription_success")},error:function(e){t._handleSubscribeError(e.responseJSON),t.element.trigger("subscription_failed",e.responseJSON)}})},error:function(){t._handleSubscribeError(""),t.element.trigger("subscription_failed","")}})},_onSubscribeSuccess:function(t){this.element.trigger("subscription-success",t)},_onSubscribeError:function(){this.element.trigger("subscription-error")},getElement:function(){return this.element}});var s=o(e),a=s,u=a.superclass;i.tools.mixin(a.prototype,{initialize:function(t){u.initialize.apply(this,arguments),t&&t.element&&(this.$elem=t.element,this._handler=null,this._initForm(),this._setupEvents())},_initForm:function(){this.$elem.formPaymentVisaHandler(),this._handler=this.$elem.data("custom-formPaymentVisaHandler")},_setupEvents:function(){var t=this;this.$elem.on("subscription-success",function(e,n){t._notify("subscription-success",n)}),this.$elem.on("subscription_failed",function(e,n){var i={};n.error&&(i.message=n.error),n.errors&&(i.message=n.errors),t._notify("subscription-error",n)})},setCurrentPlan:function(){null!==this._handler&&this._handler.setCurrentPlan.apply(this._handler,arguments)}}),t(s)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){var o=i.config=i.config||{},r=(o.mainConfig=o.mainConfig||{},function(t){e.track("Authentication Initiated",{source:t})}),s=function(t,n){mixpanel.register({"User ID":t.id}),"register"==t.context?t.context="registration":"",e.track("Authentication Successful",{source:t.source,context:t.context},void 0,n)},a=function(t,n){"login"===t&&(t="email"),e.track("Authentication Failed",{source:t,reason:n})};radio("authenticationInitiated").subscribe(r),radio("authenticationSuccessful").subscribe(s),radio("loginWindowAuthenticationSuccessful").subscribe(s),radio("authenticationFailed").subscribe(a)}(this,this.DIMixpanel,this.docCookies,this.BM=this.BM||{}),function(t,e,n,i,o){e.define("moduleAuthRequest",["loginWindow"],function(t,e){var n=null,i=new e({context:"subscription",preventDefaultLoginBehavior:!0});i.on("authpopup-login-window-hide",function(){
n=null}),i.on("authenticationSuccessful",function(){null!==n&&n(i)}),t(function(t){i.showWindow("inital"),n=t})})}(this,this.modules,this.jQuery,this.BM,this.radio),function(t,e,n,i,o){e.define("loginWindow",["PopupBase","extend","initialForm","loginForm","chooseRepairMethodForm","coderesendForm","entercodeForm","hubidForm","newPassForm","passrepairForm","passResetForm","passwordSentForm","resendPassResetForm","PromocodeForm"],function(t,e,o,r,s,a,u,l,c,d,h,p,f,m,g){var b=o(e),_=b,y=_.superclass,v="bm-popup-auth-template";i.tools.mixin(_.prototype,{initialize:function(t){y.initialize.call(this,{useTemplate:!0,rootClassName:["m-version-2","bm-popup-auth"]}),this.context="default",this.initalForm="inital",this.initedForm=null,this.isClosable=!0,this.preventDefaultLoginBehavior=!1,this.loginWindowForms={},this.$mainNode=this._element.find(".authpopup"),this.$popupNotes=this.$mainNode.find(".authpopup-note"),this.formsInWindow=this.$mainNode.find(".authpopup-form"),this.mainNode=this.$mainNode.eq(0),this._applyConfig(t),this._bindEvents(),this._addForms()},_bindEvents:function(){this.formsInWindow.on("submit",function(t){t.preventDefault(),t.stopPropagation()})},_getTemplateName:function(){return v},_applyConfig:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);this.isClosable||(this._backgroundClickHide=!1,this._showButtonClose=!1)},_addForms:function(){this._addForm("inital",r),this._addForm("login",s),this._addForm("chooserepair",a),this._addForm("coderesend",u),this._addForm("entercode",l),this._addForm("hubid",c),this._addForm("newpass",d),this._addForm("passrepair",h),this._addForm("passreset",p),this._addForm("passwordsent",f),this._addForm("resendpassreset",m),this._addForm("promocode",g)},_addForm:function(t,e){this.loginWindowForms[t]=e(this)},showForm:function(t,e){var n=t&&"string"==typeof t?t:this.initalForm,o=function(){var t=this.loginWindowForms[n].formNode;i.tools.client.isTouch()||t.find("input").eq(0).focus(),e&&e()}.bind(this),r=function(){var t=this.loginWindowForms[n].formNode;this.loginWindowForms[n].init(),t.fadeIn(200).promise().done(o)}.bind(this);this.loginWindowForms.hasOwnProperty(n)&&n!==this.initedForm&&(this.initedForm&&this.loginWindowForms[this.initedForm].hasOwnProperty("formOff")&&this.loginWindowForms[this.initedForm].formOff(),this.initedForm=n,this.formsInWindow.fadeOut(200).promise().done(r))},hideAllForms:function(){this.formsInWindow.hide()},showWindow:function(t,e){var i=t||this.initalForm;this.loginWindowContext=e||this.context;var o=this.$popupNotes.map(function(t,e){return n(e).data("context")==this.loginWindowContext?e:void 0}.bind(this));if(this.$popupNotes.removeClass("authpopup-note-active"),o.addClass("authpopup-note-active"),this.loginWindowForms.hasOwnProperty(i)){try{var r=n("body").attr("data-config");if(r=JSON.parse(r),r.userInfo.login)return}catch(s){}var a=this.loginWindowForms[i].formNode;return this.hideAllForms(),a.show(),i!==this.initedForm&&(this.initedForm=i,this.loginWindowForms[i].init(this.mainNode)),this.show(),this._notify("authpopup-login-window-show"),radio("authpopup-login-window-show").broadcast(),this.preventDefaultLoginBehavior&&docCookies.setItem("skip_social_login_reload",!0),!1}},closeWindow:function(t){var e=i.tools.isUndefined(t)?{}:t,n=i.tools.isUndefined(e.silent)?!1:e.silent;if(e&&e.isClosable);else if(!this.isClosable)return;return this.initedForm&&this.loginWindowForms[this.initedForm].hasOwnProperty("formOff")&&(this.loginWindowForms[this.initedForm].formOff(),this.initedForm=null),this.hide(),n||(this._notify("authpopup-login-window-hide"),radio("authpopup-login-window-hide").broadcast()),!1}}),t(b)})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i,o){"use strict";var r=function(t,e,o){var r=function(t){var r,s,a=".authpopup-chooserepair",u=t.mainNode.find(a).eq(0),l=u.find(".js-methods").eq(0),c=u.find(".js-status").eq(0),d=u.find(".js-submit"),h=function(){r.filter(":checked").length?d.removeAttr("disabled"):d.attr("disabled","disabled")},p=function(t){return c.addClass("m-err").html(t).stop(!0,!0).fadeIn(300),d.removeAttr("wait"),!1},f=function(){var n=s.login,i=r.filter(":checked").val(),a={login:n,method:i},u=function(n){"phone_number"===i?(a.phone=l.find('input[value="phone_number"] + span').html(),e.setItem("authpopupRepairLogin",a),t.showForm("passreset")):t.showForm("passwordsent")};return d.attr("wait",!0),o.reset_password(a,u,p),!1},m=function(){var t=e.getItem("authpopupRepairMethods"),o=n("#authpopup-repair-methods").html(),a=i.to_html(o,t),c=BM.tools.client.isTouch()?BM.tools.client.touchEvent:"click";e.removeItem("authpopupRepairMethods"),s=t,l.html(a),r=u.find(".js-choose-method"),d.removeAttr("wait"),h(),r.on("change",h),d.on(c,f),u.on("submit",f)},g=function(){r.off(),d.off(),u.off()};return{init:m,formNode:u,formOff:g}};t(r)};o.define("chooseRepairMethodForm",["storage","loginWindow_APIMethods"],r)}(this,this.document,this.jQuery,this.Mustache,this.modules),function(t,e,n,i,o){"use strict";var r=function(e,n,i){var r=function(e){var r=".authpopup-coderesend",s=e.mainNode.find(r).eq(0),a=s.find(".js-status").eq(0),u=a.find(".error").eq(0),l=s.find(".js-code-input"),c=s.find(".js-submit"),d=s.find(".js-change-number"),h=function(){var t=l.val();t.length?c.removeAttr("disabled"):c.attr("disabled","disabled")},p=function(t,n){return a.addClass("m-err"),l.addClass("m-err"),u.html(t),c.removeAttr("wait"),n&&n.source&&(e._notify("authenticationFailed",n.source,t),o("authenticationFailed").broadcast(n.source,t)),!1},f=function(){var r=n.getItem("authpopupLoginData"),s=l.val(),a=function(i){var r={source:i.source,action:i.action,id:i.user.id};o("bm-config-update").broadcast(i),e._notify("authenticationSuccessful",i.source,i.action),o("authenticationSuccessful").broadcast(r,function(){o("main-config-update").broadcast(),n.removeItem("authpopupLoginData"),e.preventDefaultLoginBehavior||(i&&i.redirect_to?t.location.href=i.redirect_to:t.location.reload())},e)};return r.user.code=s,c.attr("wait","true"),i.entrance(r,a,p),!1},m=function(){return e.showForm("login"),!1},g=function(){var t=BM.tools.client.isTouch()?BM.tools.client.touchEvent:"click";c.removeAttr("wait"),l.val(""),a.removeClass("m-err"),l.removeClass("m-err"),h(),s.on("submit",f),l.on("keyup",h),c.on(t,f),d.on(t,m)},b=function(){s.off(),l.off(),c.off(),d.off()};return{init:g,formNode:s,formOff:b}};e(r)};i.define("coderesendForm",["storage","loginWindow_APIMethods"],r)}(this,this.document,this.jQuery,this.modules,this.radio),function(t,e,n,i,o){"use strict";var r=function(e,n,i){var r=function(e){var r=".authpopup-entercode",s=e.mainNode.find(r).eq(0),a=s.find(".js-status").eq(0),u=a.find(".error").eq(0),l=s.find(".js-code-input"),c=s.find(".js-submit"),d=s.find(".js-code-resend"),h=function(){var t=l.val();t.length?c.removeAttr("disabled"):c.attr("disabled","disabled")},p=function(t){a.addClass("m-err"),l.addClass("m-err"),u.html(t),c.removeAttr("wait")},f=function(){var t=n.getItem("authpopupLoginData"),o={user:{credential:t.user.credential}},r=function(i){n.setItem("authpopupLoginData",t),e.showForm("coderesend")};return i.resend_code(o,r,p),!1},m=function(){var r=n.getItem("authpopupLoginData"),s=l.val(),a=function(i){var r={source:i.source,action:i.action,id:i.user.id};o("bm-config-update").broadcast(i),e._notify("authenticationSuccessful",i.source,i.action),o("authenticationSuccessful").broadcast(r,function(){n.removeItem("authpopupLoginData"),e.preventDefaultLoginBehavior||(i&&i.redirect_to?t.location.href=i.redirect_to:t.location.reload())},e)},u=function(t,n){p(t),n&&n.source&&(e._notify("authenticationFailed",n.source,t),o("authenticationFailed").broadcast(n.source,t))};return r.user.code=s,c.attr("wait","true"),i.entrance(r,a,u),!1},g=function(){var t=BM.tools.client.isTouch()?BM.tools.client.touchEvent:"click";c.removeAttr("wait"),l.val(""),a.removeClass("m-err"),l.removeClass("m-err"),h(),l.on("keyup",h),c.on(t,m),d.on(t,f),s.on("submit",m)},b=function(){l.off(),c.off(),d.off(),s.off()};return{init:g,formNode:s,formOff:b}};e(r)};i.define("entercodeForm",["storage","loginWindow_APIMethods"],r)}(this,this.document,this.jQuery,this.modules,radio),function(t,e,n,i,o){"use strict";o.define("hubidForm",["storage","loginWindow_APIMethods"],function(e,o,r){var s=function(e){var s=".authpopup-hubid",a=e.mainNode.find(s).eq(0),u=a.find(".js-status").eq(0),l=u.find(".error").eq(0),c=a.find(".js-enter").eq(0),d=a.find(".back-icon"),h=a.find(".js-login-input").eq(0),p=a.find(".js-pass-input").eq(0),f=function(){var t=h.val(),e=p.val();t.length&&e.length?c.removeAttr("disabled"):c.attr("disabled","disabled")},m=function(t,n,o){var r;if(l.html(t),u.addClass("m-err"),c.removeAttr("wait"),n&&n.field){var s="password"===n.field?p:h;s.addClass("m-err")}return n&&n.source?r=n.source:o&&o.user&&o.user.credential&&(r=o.user.credential.match(/[^0-9+]/g)?"email":"phone"),e._notify("authenticationFailed",r,t),i("authenticationFailed").broadcast(r,t),!1},g={login:function(n){var o="hubid",r={source:o,action:n.action,id:n.user.id};i("bm-config-update").broadcast(n),console.log("hubid login res.user.id >>>",n.user.id),e._notify("authenticationSuccessful",o,n.action),i("authenticationSuccessful").broadcast(r,function(){e.preventDefaultLoginBehavior||(n.redirect_to?t.location.href=n.redirect_to:t.location.reload())},e)},register:function(n){var o={source:"hubid",action:n.action,id:n.user.id};i("bm-config-update").broadcast(n),console.log("hubid login res.user.id >>>",n.user.id),e._notify("authenticationSuccessful","hubid",n.action),i("authenticationSuccessful").broadcast(o,function(){e.preventDefaultLoginBehavior||(n.redirect_to?t.location.href=n.redirect_to:t.location.reload())},e)},activation_sent:function(t){var n=h.val(),i=p.val(),r={user:{credential:n,password:i,code:0},environment:"web"};o.setItem("authpopupLoginData",r),e.showForm("entercode")}},b=function(){var t=h.val(),e=p.val(),n={user:{credential:t,password:e},environment:"web"},i=function(t){t.action&&t.success&&g[t.action](t)};return c.attr("wait","true"),r.entranceHubID(n,i,m),!1},_=function(){BM.tools.client.isAndroid()&&n(this).focus()},y=function(){e.showForm("inital")},v=function(){var t=BM.tools.client.isTouch()?BM.tools.client.touchEvent:"click";c.removeAttr("wait"),h.val(""),p.val(""),u.removeClass("m-err"),p.removeClass("m-err"),h.removeClass("m-err"),f(),c.on(t,b),d.on(t,y),a.on("submit",b),h.on("keyup",f),p.on("keyup",f),h.on("touchend",_),p.on("touchend",_)},w=function(){c.off(),a.off(),h.off(),p.off()};return{init:v,formNode:a,formOff:w}};e(s)})}(this,this.document,this.jQuery,this.radio,this.modules),function(t,e,n,i,o){i.define("initialForm",["bmSocialConnect"],function(e,n){var i=function(e){var i=null,r=".authpopup-inital",s=e.mainNode.find(r).eq(0),a=s.find(".js-mail-or-phone"),u=s.find(".js-vk"),l=s.find(".js-fb"),c=s.find(".js-tw"),d=s.find(".js-hubid"),h=function(){return e._notify("authenticationInitiated","VK"),radio("authenticationInitiated").broadcast("VK"),i.vkontakte(),!1},p=function(){return e._notify("authenticationInitiated","Facebook"),radio("authenticationInitiated").broadcast("Facebook"),i.facebook(),!1},f=function(){return e._notify("authenticationInitiated","Twitter"),radio("authenticationInitiated").broadcast("Twitter"),i.twitter(),!1},m=function(t){return e.showForm("login"),e._notify("authenticationInitiated","Email"),radio("authenticationInitiated").broadcast("Email"),!1},g=function(){return e.showForm("hubid"),e._notify("authenticationInitiated","HubID"),radio("authenticationInitiated").broadcast("HubID"),!1},b=function(){i=new n,i.on("authenticationSuccessful",function(n,i,o){return e.preventDefaultLoginBehavior===!1?void(""===o.redirectTo?t.location.reload():t.location.href=o.redirectTo):void e._notify("authenticationSuccessful",n,i,o)})},_=function(){var t=o.helper.event.clickName();b(),u.on(t,h),l.on(t,p),c.on(t,f),a.on(t,m),d.on(t,g)},y=function(){u.off(),l.off(),c.off(),a.off()};return{init:_,formNode:s,formOff:y}};e(i)})}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=0;o.define("loginForm",["storage","loginWindow_APIMethods"],function(e,o,s){var a=function(e){var a=".authpopup-login",u=e.mainNode.find(a).eq(0),l=u.find(".js-status").eq(0),c=l.find(".error").eq(0),d=u.find(".js-enter").eq(0),h=u.find(".js-forgot").eq(0),p=u.find(".back-icon"),f=u.find(".js-login-input").eq(0),m=u.find(".js-pass-input").eq(0),g=function(){var t=f.val(),e=m.val();t.length&&e.length?d.removeAttr("disabled"):d.attr("disabled","disabled")},b=function(t,n,o){var r;if(c.html(t),l.addClass("m-err"),d.removeAttr("wait"),n&&n.field){var s="password"===n.field?m:f;s.addClass("m-err")}return n&&n.source?r=n.source:o&&o.user&&o.user.credential&&(r=o.user.credential.match(/[^0-9+]/g)?"email":"phone"),e._notify("authenticationFailed",r,t),i("authenticationFailed").broadcast(r,t),!1},_={login:function(n){var o="login"===n.source?"email":n.source,r={source:o,action:n.action,id:n.user.id};mixpanel.register({"User ID":n.user.id}),i("bm-config-update").broadcast(n),e._notify("authenticationSuccessful",o,n.action,n),i("authenticationSuccessful").broadcast(r,function(){e.preventDefaultLoginBehavior||(n.redirect_to?t.location.href=n.redirect_to:t.location.reload())},e)},register:function(n){var o={source:n.source,action:n.action,id:n.user.id};mixpanel.register({"User ID":n.user.id}),i("bm-config-update").broadcast(n),e._notify("authenticationSuccessful",n.source,n.action,n),i("authenticationSuccessful").broadcast(o,function(){e.preventDefaultLoginBehavior||(n.redirect_to?t.location.href=n.redirect_to:t.location.reload())},e)},activation_sent:function(t){var n=f.val(),i=m.val(),r={user:{credential:n,password:i,code:0},environment:"web"};o.setItem("authpopupLoginData",r),e.showForm("entercode")}},y=function(){var t=f.val(),e=m.val(),n={user:{credential:t,password:e},environment:"web"},i=function(t){t.action&&t.success&&_[t.action](t)};return d.attr("wait","true"),s.entrance(n,i,b),!1},v=function(){return e.showForm("passrepair"),!1},w=function(){BM.tools.client.isAndroid()&&n(this).focus()},k=function(){e.showForm("inital")},C=function(){var t=BM.tools.client.isTouch()?BM.tools.client.touchEvent:"click";d.removeAttr("wait"),f.val(""),m.val(""),l.removeClass("m-err"),m.removeClass("m-err"),f.removeClass("m-err"),g(),d.on(t,y),h.on(t,v),p.on(t,k),u.on("submit",y),f.on("input",g),m.on("input",g),f.on("touchend",w),m.on("touchend",w),r+=1,f.attr("id","bm-login-window-input-login-"+r),m.attr("id","bm-login-window-input-password-"+r),d.attr("id","bm-login-window-button-submit-"+r)},S=function(){d.off(),h.off(),u.off(),f.off(),m.off()};return{init:C,formNode:u,formOff:S}};e(a)})}(this,this.document,this.jQuery,this.radio,this.modules),function(t,e,n,i){"use strict";var o=function(t,e){var i=function(){var t=function(t,i,o){var r,s=function(t,e){"string"==typeof t?o(t,e):t.error&&t.error.message?o(t.error.message,t):i(t)},a=function(t){s(t.responseJSON||t.statusText,t.responseJSON||{})};r=e.mixin(t,{success:s,error:a}),n.ajax(r)},i=function(e,i,o){var r=n.param(e),s={type:"POST",url:"/a/4/u/entrance.json",data:r};t(s,i,function(){var t=Array.prototype.slice.call(arguments,0);t.push(e),o.apply(null,t)})},o=function(e,i,o){var r=n.param(e),s={type:"POST",url:"/a/4/starhub_auth",data:r};t(s,i,function(){var t=Array.prototype.slice.call(arguments,0);t.push(e),o.apply(null,t)})},r=function(e,i,o){var r=n.param(e),s={type:"POST",url:"/a/4/u/send_activation_code.json",data:r};t(s,i,o)},s=function(e,i,o){var r=n.param(e),s={type:"POST",url:"/a/4/u/change_password.json",data:r};t(s,i,o)},a=function(e,i,o){var r=n.param(e),s={type:"POST",url:"/a/4/u/reset_password.json",data:r};t(s,i,o)},u=function(e,i,o){var r=n.param(e),s={type:"GET",url:"/a/4/u/reset_password_methods.json",data:r};t(s,i,o)};return{entrance:i,entranceHubID:o,resend_code:r,change_password:s,reset_password:a,getRepairMethods:u}}();t(i)};i.define("loginWindow_APIMethods",["tools"],o)}(this,this.document,this.jQuery,this.modules),function(t,e,n,i,o){"use strict";var r=function(e,n,i){var o=function(e){var o=".authpopup-newpass",r=e.mainNode.find(o).eq(0),s=r.find(".js-status"),a=s.find(".error"),u=r.find(".js-pass"),l=r.find(".js-submit"),c=function(){var t=u.val();t.length?l.removeAttr("disabled"):l.attr("disabled","disabled")},d=function(t){return s.addClass("m-err"),u.addClass("m-err"),a.html(t),l.removeAttr("wait"),!1},h=function(){var e=n.getItem("authpopupRepairData")||{user:{}},o=u.val(),r=function(e){n.removeItem("authpopupRepairData"),setTimeout(function(){t.location.search?t.location.search="":t.location.reload()},200)},s=t.location.search;return s&&s.indexOf("token=")&&(e.token=s.split("token=")[1].split("&")[0]),e.user.new_password=o,l.attr("wait","true"),i.change_password(e,r,d),!1},p=function(){var t=BM.tools.client.isTouch()?BM.tools.client.touchEvent:"click";u.val(""),l.removeAttr("wait"),s.removeClass("m-err"),u.removeClass("m-err"),c(),r.on("submit",h),u.on("keyup",c),l.on(t,h)},f=function(){r.off(),u.off(),l.off()};return{init:p,formNode:r,formOff:f}};e(o)};i.define("newPassForm",["storage","loginWindow_APIMethods"],r)}(this,this.document,this.jQuery,this.modules,this.radio),function(t,e,n,i,o){"use strict";var r=function(t,e,n){var i=function(t){var i=".authpopup-passrepair",o=t.mainNode.find(i).eq(0),r=o.find(".js-status").eq(0),s=r.find(".error").eq(0),a=o.find(".js-login-input").eq(0),u=o.find(".back-icon").eq(0),l=o.find(".js-submit").eq(0),c=function(){var t=a.val();t.length?l.removeAttr("disabled"):l.attr("disabled","disabled")},d=function(t){return r.addClass("m-err"),a.addClass("m-err"),s.html(t),l.removeAttr("wait"),!1},h=function(){r.removeClass(".m-err"),a.removeClass(".m-err")},p=function(i,o){var r={login:i,method:o},s=function(n){"phone_number"===o?(r.phone=a.val(),e.setItem("authpopupRepairLogin",r),t.showForm("passreset")):t.showForm("passwordsent")};n.reset_password(r,s,d)},f=function(){var i=a.val(),o={user:{credential:i}},r=function(n){1===n.methods.length?p(n.login,n.methods[0].type):(e.setItem("authpopupRepairMethods",n),t.showForm("chooserepair"))};return l.attr("wait","true"),n.getRepairMethods(o,r,d),!1},m=function(){return t.showForm("login"),!1},g=function(){var t=BM.tools.client.isTouch()?BM.tools.client.touchEvent:"click";l.removeAttr("wait"),a.val(""),c(),h(),o.on("submit",f),u.on(t,m),l.on(t,f),a.on("keyup",c)},b=function(){h(),o.off(),u.off(),l.off(),a.off()};return{init:g,formNode:o,formOff:b}};t(i)};i.define("passrepairForm",["storage","loginWindow_APIMethods"],r)}(this,this.document,this.jQuery,this.modules,this.radio),function(t,e,n,i,o){"use strict";var r=function(t,e,n){var i=function(t){var i=".authpopup-passreset",r=t.mainNode.find(i).eq(0),s=r.find(".js-status").eq(0),a=s.find(".error").eq(0),u=r.find(".js-code"),l=r.find(".js-reset"),c=r.find(".js-resend"),d=r.find(".authpopup-desc span"),h=function(){var t=u.val();t.length?l.removeAttr("disabled"):l.attr("disabled","disabled")},p=function(t){s.addClass("m-err"),u.addClass("m-err"),a.html(t),l.removeAttr("wait")},f=function(){var i=u.val(),r=e.getItem("authpopupRepairLogin"),s={user:{}},a={user:{credential:r.login,password:i},environment:"web"},c=function(n){t._notify("loginWindowAuthenticationSuccessful",n.source,n.action),o("loginWindowAuthenticationSuccessful").broadcast(n.source,n.action,n.user.id),s.user.password=i,e.setItem("authpopupRepairData",s),e.removeItem("authpopupRepairLogin"),t.showForm("newpass")};return l.attr("wait","true"),n.entrance(a,c,p),!1},m=function(){var i=e.getItem("authpopupRepairLogin"),o=function(e){t.showForm("resendpassreset")};return n.reset_password(i,o,p),!1},g=function(){var t=e.getItem("authpopupRepairLogin"),n=BM.tools.client.isTouch()?BM.tools.client.touchEvent:"click";u.val(""),l.removeAttr("wait"),s.removeClass("m-err"),u.removeClass("m-err"),d.html(t&&t.phone?t.phone:""),h(),u.on("keyup",h),l.on(n,f),c.on(n,m),r.on("submit",f)},b=function(){u.off(),l.off(),c.off(),r.off()};return{init:g,formNode:r,formOff:b}};t(i)};i.define("passResetForm",["storage","loginWindow_APIMethods"],r)}(this,this.document,this.jQuery,this.modules,this.radio),function(t,e,n,i){"use strict";var o=function(t,e,n){var i=function(t){var e=".authpopup-emailsent",n=t.mainNode.find(e).eq(0),i=n.find(".authpopup-icon-success"),o=n.find(".js-submit-close"),r=n.find(".js-submit-back"),s=function(){return t.closeWindow(),!1},a=function(){return t.showForm("login"),!1},u=function(){var e=BM.tools.client.isTouch()?BM.tools.client.touchEvent:"click";setTimeout(function(){i.addClass("animated bounceIn")},200),t.isClosable?r.hide():o.hide(),o.on(e,s),r.on(e,a)},l=function(){n.off(),o.off(),r.off()};return{init:u,formNode:n,formOff:l}};t(i)};i.define("passwordSentForm",[],o)}(this,this.document,this.jQuery,this.modules),function(t,e,n,i){i.define("PromocodeForm",[],function(n){var i=function(n){var i=".authpopup-promocode",o=n.mainNode.find(i).eq(0),r=o.find("@promo-user-avatar"),s=o.find("@promo-user-name"),a=o.find("@promo-duration"),u=o.find("@promo-login-button"),l=function(){u.on("click",function(){n.showForm("inital")})},c=function(){var n=t.location.search.split("promo=")[1].split("&")[0];e.ajax({url:"/a/4/billing/promos/"+n,success:function(t){var e=t.creator||{};s.text(""+(e.name||e.login)),a.text(t.duration),e.userpic&&r.css({"background-image":"url("+e.userpic+")","background-color":"transparent"}),o.removeClass("wait")}})},d=function(){l(),c()},h=function(){u.off()};return{init:d,formNode:o,formOff:h}};n(i)})}(this,this.jQuery,this.radio,this.modules),function(t,e,n,i,o){"use strict";var r=function(t,e,n){var i=function(t){var i=".authpopup-resendpassreset",r=t.mainNode.find(i).eq(0),s=r.find(".js-status").eq(0),a=s.find(".error").eq(0),u=r.find(".js-code"),l=r.find(".js-reset"),c=function(){var t=u.val();t.length?l.removeAttr("disabled"):l.attr("disabled","disabled")},d=function(e,n){return s.addClass("m-err"),u.addClass("m-err"),a.html(e),l.removeAttr("wait"),n&&n.source&&(t._notify("authenticationFailed",n.source,e),o("authenticationFailed").broadcast(n.source,e)),!1},h=function(){var i=u.val(),r=e.getItem("authpopupRepairLogin"),s={user:{}},a={user:{credential:r.login,password:i},environment:"web"},c=function(n){var r;n.user&&n.user.login?(r={source:n.source,action:n.action,id:n.user.id,login:n.user.login},t._notify("authenticationSuccessful",r,t),o("authenticationSuccessful").broadcast(r,t)):(r={source:n.source,action:n.action,id:n.user.id,login:null},t._notify("authenticationSuccessful",r,t),o("authenticationSuccessful").broadcast(r,t)),s.user.password=i,e.setItem("authpopupRepairData",s),e.removeItem("authpopupRepairLogin"),t.showForm("newpass")};return l.attr("wait","true"),n.entrance(a,c,d),!1},p=function(){var t=BM.tools.client.isTouch()?BM.tools.client.touchEvent:"click";u.val(""),s.removeClass("m-err"),u.removeClass("m-err"),l.removeAttr("wait"),c(),r.on("submit",h),u.on("keyup",c),l.on(t,h)},f=function(){r.off(),u.off(),l.off()};return{init:p,formNode:r,formOff:f}};t(i)};i.define("resendPassResetForm",["storage","loginWindow_APIMethods"],r)}(this,this.document,this.jQuery,this.modules,this.radio),function(t,e,n,i){e.define("PopupContentProblem",["PopupBase","dynamicContent","contentProblem"],function(t,e,o,r){var s="bm-popup-content-problem-template",a=function(t){function e(){var n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,e);var i={useTemplate:!0,rootClassName:["m-version-2","bm-popup-content-problem"]},o=_possibleConstructorReturn(this,t.call(this,i));return e.superclass.initialize(i),o.setProblemConfig(n),o._setElements(),o._setTemplates(),o._setEventListeners(),o._initDynamicContent(),r.getTypes()?o._setTypes():r.on("types-loaded",function(){return o._setTypes()}),o}return _inherits(e,t),e.prototype._initDynamicContent=function(){this.dynamicContent=new o({element:this.$elemDynamicContent})},e.prototype._setElements=function(){this.$elemDynamicContent=this.$elem.find("@bm-dynamic-content"),this.$elemLinkBack=this.$elem.find("@bm-popup-link-back"),this.$contentProblemTypes=this.$elem.find("@content-problem-types"),this.$contentProblemComment=this.$elem.find("@content-problem-comment"),this.$contentProblemButton=this.$elem.find("@content-problem-submit"),this.$contentProblemClose=this.$elem.find("@content-problem-close")},e.prototype._setTemplates=function(){this.contentProblemTypeTemplate=this.$contentProblemTypes.html()},e.prototype._setEventListeners=function(){var t=this;this.$elemLinkBack.on("click",function(){return t._goBack()}),this.$contentProblemButton.on("click",function(){return t._sendProblem()}),this.$contentProblemClose.on("click",function(){return t.hide()}),this.$contentProblemTypes.on("click","@content-problem-type",function(e){return t._selectType(e)})},e.prototype._setTypes=function(){var t=r.getTypes();this.$contentProblemTypes.html("");for(var e in t)if(t.hasOwnProperty(e)){var i=n(this.contentProblemTypeTemplate).attr("data-type",e);i.find("@content-problem-type-text").text(t[e]),this.$contentProblemTypes.append(i)}},e.prototype._getTemplateName=function(){return s},e.prototype._getProblemConfig=function(){return i.tools.mixin(this.problemConfig,{problem_type:this.problemType,comment:this.$contentProblemComment.val()})},e.prototype._resetProblemConfig=function(){this.problemConfig={}},e.prototype._selectType=function(t){this.problemType=n(t.currentTarget).data("type"),this.showStep(e.Step.COMMENT)},e.prototype._showLinkBack=function(){this.$elemLinkBack.attr("data-visible","true")},e.prototype._hideLinkBack=function(){this.$elemLinkBack.attr("data-visible","false")},e.prototype._goBack=function(){this.dynamicContent.showPreviousStep(),this.dynamicContent.isStepsStackEmpty()&&this._hideLinkBack()},e.prototype._sendProblem=function(){var t=this;n.ajax({url:"/a/4/cp.json",type:"post",dataType:"json",data:{content_problem:this._getProblemConfig()},success:function(n){t.showStep(e.Step.SUCCESS)},error:function(t){console.log("Error:",t)}})},e.prototype.setProblemConfig=function(t){this._resetProblemConfig(),t.documentUuid&&(this.problemConfig.document_uuid=t.documentUuid),t.itemUuid&&(this.problemConfig.item_uuid=t.itemUuid),t.cfi&&(this.problemConfig.cfi=t.cfi),t.progress&&(this.problemConfig.progress=t.progress),t.textSelection&&(this.problemConfig.text_selection=t.textSelection)},e.prototype.showStep=function(){var t=this,n=arguments.length<=0||void 0===arguments[0]?e.Step.SELECT:arguments[0];this.dynamicContent.showStep(n),n===e.Step.COMMENT?(this._showLinkBack(),setTimeout(function(){t.$contentProblemComment.focus()},1e3)):this._hideLinkBack()},e.prototype.open=function(){this.dynamicContent.reset(),this.dynamicContent.clearStepsStack(),this.$contentProblemComment.val(""),this.showStep(e.Step.SELECT),this.show()},e}(e);a.Step={SELECT:"select",COMMENT:"comment",SUCCESS:"success"},t(a)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("contentProblem",["PubSub"],function(t,e){var i=function(t){function e(){var n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,e);var i=_possibleConstructorReturn(this,t.call(this,n));return e.superclass&&e.superclass.initialize(n),i._fetchTypes(),i}return _inherits(e,t),e.prototype._fetchTypes=function(){var t=this;n.ajax({url:"/a/4/cp/types.json",success:function(e){t.types=e,t._notify("types-loaded")},error:function(t){console.log("Error load content problem types:",t)}})},e.prototype.getTypes=function(){return this.types||null},e}(e),o=new i;t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){"use strict";i.define("Pluralizer",["PluralizerRu","PluralizerEn","PluralizerTr","PluralizerId","PluralizerAz","PluralizerKk","PluralizerEs","PluralizerDa","PluralizerEnStandart"],function(t,e,n,i,r,s,a,u,l,c){var d=function(){var t=this;t.locale=o.config.mainConfig.locale,t.pluralizers={ru:e,en:n,sv:n,es:u,tr:i,id:r,az:s,kk:a,da:l,en_standart:c}};d.prototype={pluralize:function(t){return this.pluralizers[this.locale].pluralize(t)},setLocale:function(t){this.locale=t}},t(new d)})}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t,i){n.widget("custom.hyphenizeBookTitle",{_init:function(){this.element.length<1||!this.element.hasClass("blank")&&!this.element.hasClass("m-blank")||(this._elementTitle=n(".title",this.element),this._elementTitleContent=n(".title-content",this.element),this._words=[],this._elementTitleSize={width:this._elementTitle.width(),height:this._elementTitle.height()},this._elementTitleContentSize={width:this._elementTitleContent.width(),height:this._elementTitleContent.height()},this._isTitleFits()||(this._placeWordsInWrapper(),this._insertLineBreaks()))},_isTitleFits:function(){return this._elementTitleSize.width>=this._elementTitleContentSize.width},_placeWordsInWrapper:function(){var t=this,i=this._elementTitleContent.html().split(" ");this._elementTitleContent.html(""),i.forEach(function(i){var o=n("<span>").html(i);t._words.push(o),t._elementTitleContent.append(o),t._elementTitleContent.append(e.createTextNode(" "))})},_insertLineBreaks:function(){var t=this._words,e=this._elementTitleSize.width;t.forEach(function(t,n){t.width()>e&&t.html(i.hyphenize(t.html()))})}}),t({hyphenize:function(t){t&&t instanceof n&&t.hyphenizeBookTitle()}})};i.define("bookHyphenizer",["hyphenizer"],r)}(this,this.document,this.jQuery,this.modules,this.radio),function(t,e,n,i,o){"use strict";var r=function(t){var e={x:"",g:"aeiouy",s:"bcdfghjklmnpqrstvwxz"},n="&shy;",i={xgg:"x"+n+"gg",xgs:"x"+n+"gs",xsg:"x"+n+"sg",xss:"x"+n+"ss",gssssg:"gss"+n+"ssg",gsssg:"gss"+n+"sg",sgsg:"sg"+n+"sg",gssg:"gs"+n+"sg",sggg:"sg"+n+"gg",sggs:"sg"+n+"gs"},o=function(t){var n,i=Object.prototype.hasOwnProperty;for(n in e)if(i.call(e,n)&&-1!==e[n].indexOf(t))return n},r=function(t){var e,n=Object.prototype.hasOwnProperty,o=[];for(e in i)n.call(i,e)&&-1!==t.indexOf(e)&&o.push(e);return o.length>0?o:null},s=function(t){var e,n=t.length,i="",r=t.toLowerCase();for(e=0;n>e;++e)i+=o(r[e]);return i},a=function l(t){var e;return t=t.toLowerCase(),null!==(e=r(t))?(e.forEach(function(e){t=t.replace(e,i[e])}),l(t)):t},u=function(t,e){var i=[],o=0;return e.split(n).forEach(function(e){var n=e.length;i.push(t.slice(o,o+n)),o+=n}),i.join(n)};t({hyphenize:function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){var n=t[e];t[e]=u(n,a(s(n)))}return t}var i=a(s(t));return u(t,i)}})};i.define("hyphenizer",[],r)}(this,this.document,this.jQuery,this.modules,this.radio),function(window,document,$,modules){"use strict";var moduleGetIntentCartPixel=function moduleGetIntentCartPixel(provide){var script=$("#get-intent-cart-pixel").html(),setGetIntentCartPixel=function setGetIntentCartPixel(){eval(script)};provide(setGetIntentCartPixel)};modules.define("setGetIntentCartPixel",[],moduleGetIntentCartPixel)}(this,this.document,this.jQuery,this.modules),function(window,document,$,modules){"use strict";var moduleGetIntentConversionPixel=function moduleGetIntentConversionPixel(provide){var script=$("#get-intent-conversion-pixel").html(),setGetIntentConversionPixel=function setGetIntentConversionPixel(){eval(script)};provide(setGetIntentConversionPixel)};modules.define("setGetIntentConversionPixel",[],moduleGetIntentConversionPixel)}(this,this.document,this.jQuery,this.modules),function(t,e,n,i,o){"use strict";var r=function(t,e,i,r,s){var a=e(i),u={EMAIL_PASSWORD_CREATE_EMAIL:"email-password-create-email",EMAIL_PASSWORD_CREATE_PASSWORD:"email-password-create-password",EMAIL_CHANGE:"email-change",EMAIL_CHANGE_NO_PASSWORD:"email-change-no-password",PASSWORD_CREATE:"password-create",PASSWORD_CHANGE:"password-change",PHONE_CREATE:"phone-create",PHONE_CREATE_NO_PASSWORD:"phone-create-no-password",PHONE_CHANGE:"phone-change"},l=a,c=l.superclass,d="bm-account-settings-template";l.Scenarios=u,n.extend(l.prototype,{Scenarios:u,initialize:function(){
var t=this;this._stopPropagation=!1,this._context=null,c.initialize.apply(this,arguments),this.scenarios={};for(var e in this.Scenarios){var i=this.Scenarios[e],o=this._elementContent.find(".bm-account-settings-scenario-"+i),s=o.find('[class*="bm-account-settings-scenario-step"]'),a=o.find("form");this.scenarios[i]={$b:o,$steps:{},forms:{}},s.each(function(e,o){t.scenarios[i].$steps[e+1]=n(o)}),a.each(function(e,o){var s=n(o),a=new r(s);t.scenarios[i].forms[a.getName()]=a})}this._initScenarios()},show:function(t){c.show.apply(this,arguments);for(var e in this.scenarios){var n=this.scenarios[e];e===t.scenario?(n.$b.addClass("chosen"),n.$steps[1].addClass("chosen")):n.$b.removeClass("chosen")}t.form&&this.scenarios[t.scenario].forms[t.form.name].setValue(t.form.data)},hide:function(){c.hide.apply(this,arguments),this._clearForms()},setConfig:function(t){c.setConfig.apply(this,arguments),t&&(t.stopPropagation&&(this._stopPropagation=t.stopPropagation),t.context&&(this._context=t.context))},_initScenarios:function(){this._initEmailPasswordCreateEmailScenario(),this._initEmailPasswordCreatePasswordScenario(),this._initEmailChangeScenario(),this._initEmailChangeNoPasswordScenario(),this._initPasswordCreateScenario(),this._initPasswordChangeScenario(),this._initPhoneCreateScenario(),this._initPhoneCreateNoPasswordScenario(),this._initPhoneChangeScenario()},_initEmailPasswordCreateEmailScenario:function(){var t=this,e=this.scenarios[this.Scenarios.EMAIL_PASSWORD_CREATE_EMAIL];e.$resendLink=e.$steps[2].find(".resend-confirmation-mail"),o("email-password-create-email").subscribe(function(){t._proceedToStep(e,2)}),e.$resendLink.on("click",function(t){t.preventDefault(),e.forms["email-resend-verification"].submit()})},_initEmailPasswordCreatePasswordScenario:function(){var t=this,e=this.scenarios[this.Scenarios.EMAIL_PASSWORD_CREATE_PASSWORD];e.$resendLink=e.$steps[2].find(".resend-confirmation-mail"),o("email-password-create-password").subscribe(function(){t._proceedToStep(e,2)}),e.$resendLink.on("click",function(t){t.preventDefault(),e.forms["email-resend-verification"].submit()})},_initEmailChangeScenario:function(){var t=this,e=this.scenarios[this.Scenarios.EMAIL_CHANGE];e.$resendLink=e.$steps[2].find(".resend-confirmation-mail"),o("email-change").subscribe(function(){t._proceedToStep(e,2)}),e.$resendLink.on("click",function(t){t.preventDefault(),e.forms["email-resend-verification"].submit()})},_initEmailChangeNoPasswordScenario:function(){var t=this,e=this.scenarios[this.Scenarios.EMAIL_CHANGE_NO_PASSWORD];e.$resendLink=e.$steps[2].find(".resend-confirmation-mail"),o("email-change-no-password").subscribe(function(){t._proceedToStep(e,2)}),e.$resendLink.on("click",function(t){t.preventDefault(),e.forms["email-resend-verification"].submit()})},_initPasswordCreateScenario:function(){var t=this;this.scenarios[this.Scenarios.PASSWORD_CREATE];o("password-create").subscribe(function(){t.hide()})},_initPasswordChangeScenario:function(){var t=this;this.scenarios[this.Scenarios.PASSWORD_CHANGE];o("password-change").subscribe(function(){t.hide()})},_initPhoneCreateScenario:function(){var t=this,e=this.scenarios[this.Scenarios.PHONE_CREATE];o("phone-check").subscribe(function(){var n=e.forms["phone-check"].getValue("user[credential]");e.forms["phone-create"].setValue({"user[phone_number]":n}),t._proceedToStep(e,2)}),o("phone-create").subscribe(function(){t.hide()})},_initPhoneCreateNoPasswordScenario:function(){var t=this,e=this.scenarios[this.Scenarios.PHONE_CREATE_NO_PASSWORD];o("phone-check-no-password").subscribe(function(){var n=e.forms["phone-check-no-password"].getValue("user[credential]");e.forms["phone-create-no-password"].setValue({"user[phone_number]":n}),t._proceedToStep(e,2)}),o("phone-create-no-password").subscribe(function(){t.hide()})},_initPhoneChangeScenario:function(){var t=this;this.scenarios[this.Scenarios.PHONE_CHANGE];o("phone-change").subscribe(function(){t.hide()})},_proceedToStep:function(t,e){t.$steps[e-1].removeClass("chosen"),t.$steps[e].addClass("chosen")},_getTemplateName:function(){return d},_clearForms:function(){for(var t in this.scenarios){for(var e in this.scenarios[t].forms)this.scenarios[t].forms[e].clear();for(var n in this.scenarios[t].$steps)this.scenarios[t].$steps[n].removeClass("chosen")}}}),t(a)};i.define("AccountSettingsPopup",["extend","PopupBase","Form","tools"],r)}(this,this.document,this.jQuery,this.modules,this.radio),function(t,e,n,i,o){e.define("PopupInstallAppMinimal",["extend","PopupBase"],function(e,r,s){var a=r(s),u=a,l=u.superclass;i.tools.mixin(u.prototype,{initialize:function(t){l.initialize.call(this,{useTemplate:!0,rootClassName:["m-version-2","bm-popup-install-app","m-simple"]}),!this.$elem||this.$elem.length<1||(this._config={context:null},this.$elemStoreLink=this.$elem.find("@bm-popup-install-app-link"),this.$elemClose=this.$elem.find("@bm-popup-install-app-close"),this._setConfig(t),this._bindEvents(),this._calculateContentPosition=function(){})},_setConfig:function(t){i.tools.isPresent(t)&&(this._config=i.tools.mixin(this._config,t))},_bindEvents:function(){this.$elemClose.on(i.helper.event.clickName(),function(t){this._onCloseClick()}.bind(this)),this.$elemStoreLink.on(i.helper.event.clickName(),function(t){this._onStoreLinkClick()}.bind(this));var e=n("body").scrollTop();n(t).bind("scroll",function(t){var i=Math.abs(e-n("body").scrollTop());i>100&&(e-n("body").scrollTop()>0?this.$elem.removeClass("m-hidden"):this.$elem.addClass("m-hidden"),e=n("body").scrollTop())}.bind(this))},_unbindEvents:function(){n(t).unbind("scroll")},_onCloseClick:function(){this.hide()},_onStoreLinkClick:function(){i.helper.deeplink.exec({APP_STORE:"https://app.adjust.com/sjljfb?campaign=app_banner_new&deep_link=bookmate://",GOOGLE_PLAY:"https://app.adjust.com/6svwku?campaign=app_banner_new&deep_link=bookmate://"}),setTimeout(function(){this&&this.hide&&this.hide()}.bind(this),1e3),this._sendEventButtonPressed()},show:function(){this._sendEventBannerShown(),l.show.apply(this,arguments)},hide:function(){l.hide.apply(this,arguments),this._unbindEvents()},_sendEventBannerShown:function(){var t;i.tools.isNull(this._config.context)||(t=this._config.context),o.track("App Banner Shown",{context:t})},_sendEventButtonPressed:function(){var t;i.tools.isNull(this._config.context)||(t=this._config.context),o.track("App Banner Button Pressed",{context:t})},_getTemplateName:function(){return"bm-popup-install-app-template"},_blockBodyScrolling:function(){},_unblockBodyScrolling:function(){l._unblockBodyScrolling.apply(this,arguments),this._elementRoot.off("touchstart."+this._uniqueToken)}}),e(a)})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i,o){e.define("PopupInstallApp",["extend","PopupBase"],function(t,e,r){var s=e(r),a=s,u=a.superclass;i.tools.mixin(a.prototype,{initialize:function(t){u.initialize.call(this,{useTemplate:!0,rootClassName:["m-version-2","bm-popup-install-app"]}),!this.$elem||this.$elem.length<1||(this._config={context:null},this.$elemStoreLink=this.$elem.find("@bm-popup-install-app-link"),this.$elemClose=this.$elem.find("@bm-popup-install-app-close"),this._setConfig(t),this._bindEvents())},_setConfig:function(t){i.tools.isPresent(t)&&(this._config=i.tools.mixin(this._config,t))},_bindEvents:function(){this.$elemClose.on(i.helper.event.clickName(),function(t){this._onCloseClick()}.bind(this)),this.$elemStoreLink.on(i.helper.event.clickName(),function(t){this._onStoreLinkClick()}.bind(this))},_onCloseClick:function(){this.hide()},_onStoreLinkClick:function(){i.helper.deeplink.exec(),setTimeout(function(){this&&this.hide&&this.hide()}.bind(this),1e3),this._sendEventButtonPressed()},show:function(){this._sendEventBannerShown(),u.show.apply(this,arguments)},_sendEventBannerShown:function(){var t;i.tools.isNull(this._config.context)||(t=this._config.context),o.track("App Banner Shown",{context:t})},_sendEventButtonPressed:function(){var t;i.tools.isNull(this._config.context)||(t=this._config.context),o.track("App Banner Button Pressed",{context:t})},_getTemplateName:function(){return"bm-popup-install-app-template"},_blockBodyScrolling:function(){u._blockBodyScrolling.apply(this,arguments),this._elementRoot.on("touchstart."+this._uniqueToken,function(t){var e=n(event.target);e.hasClass("bm-popup-button-close")||e.is("@bm-popup-install-app-link")||e.is("@bm-popup-install-app-close")||(t.stopPropagation(),t.preventDefault())})},_unblockBodyScrolling:function(){u._unblockBodyScrolling.apply(this,arguments),this._elementRoot.off("touchstart."+this._uniqueToken)}}),t(s)})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i){e.define("PopupImpressionForm",["extend","PopupBase","ImpressionForm"],function(t,e,n,o){var r=e(n),s=r,a=s.superclass;i.tools.mixin(s.prototype,{initialize:function(t){a.initialize.call(this,{rootClassName:["m-version-2","bm-popup-impression-form"],useTemplate:!0}),this.$elemFormWrapper=this.$elem.find("@bm-popup-impression-form-wrapper"),this._impressionForm=null,this._initImpressionForm()},_initImpressionForm:function(){i.tools.isNull(this._impressionForm)&&(this._impressionForm=new o,this.$elemFormWrapper.append(this._impressionForm.getElement()))},_getTemplateName:function(){return"bm-popup-impression-form-template"}}),t(r)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("PopupImpression",["extend","PopupBase","dynamicContent","ImpressionModel","ImpressionItem","ImpressionForm"],function(t,e,n,o,r,s,a){var u=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.call(this,{useTemplate:!0,rootClassName:["m-version-2","bm-popup-impression"]}),this._data={},this._fetched=!1,this._model=null,this._item=null,this._dc=null,this._form=null,this._prevHistoryControlsValue=this._historyControls,this.$content=this.$elem.find("@bm-popup-impression-wrapper"),this.$dc=this.$elem.find("@bm-dynamic-content"),this.$form=this.$elem.find("@bm-popup-impression-form-wrapper"),this.$buttonBack=this.$elem.find("@bm-popup-impression-button-back"),this.$buttonClose=this.$elem.find("@bm-popup-impression-button-close"),i.tools.isPresent(e)&&i.tools.isPresent(e.data)&&(this._data=i.tools.mixin(this._data,e.data)),this._initDynamicContent(),this._initModel(),this._loadImpression(),this._bindEvents()},e.prototype.show=function(){this._fetched||this._model.fetch(),t.prototype.show.apply(this,arguments)},e.prototype._initDynamicContent=function(){i.tools.isNull(this._dc)&&(this._dc=new o({element:this.$dc}))},e.prototype._bindEvents=function(){var t=this;this.$buttonBack.on(i.helper.event.clickName(),function(){t._onButtonBackClick()}),this.$buttonClose.on(i.helper.event.clickName(),function(){t.hide()})},e.prototype._initModel=function(){var t=this;i.tools.isNull(this._model)&&(this._model=new r(this._data),this._model.on("fetch-success",function(e){t._fetched=!0,t._onModelFetchSuccess(e)}),this._model.on("fetch-error",function(){t._fetched=!0,t._onModelFetchError()}))},e.prototype._onModelFetchSuccess=function(t){this._initItem(),this._dc.showStep("content")},e.prototype._onModelFetchError=function(){this.hide()},e.prototype._loadImpression=function(){!this._data.uuid},e.prototype.updateLayout=function(){t.prototype.updateLayout.apply(this,arguments),this._historyControls?this.$buttonBack.removeClass("m-hidden"):this.$buttonBack.addClass("m-hidden")},e.prototype._onButtonClosePressed=function(){this.hide()},e.prototype._initItem=function(){var t=this;!i.tools.isNull(this._model)&&this._fetched&&(this._item=new s({data:{model:this._model.json(),view:{state:{likes:!0,likesSimple:!1,book:!0,socialCounters:!0,owner:!0,popup:!1}}}}),this._model.isCurrentUserOwner()&&(this._item.view.state={edit:!0,remove:!0}),this._item.view.state={topControls:!0},this.$content.append(this._item.view.getElement()),this._item.update(),this._item.on("showing-form",function(){t._hideHistroyControls()}),this._item.on("showing-content",function(){t._showHistroyControls()}))},e.prototype._showHistroyControls=function(){this._prevHistoryControlsValue=this._historyControls,this._historyControls=!1,this.updateLayout()},e.prototype._hideHistroyControls=function(){this._historyControls=this._prevHistoryControlsValue,this.updateLayout()},e.prototype._onButtonBackClick=function(){this._notify("button-back-click")},e.prototype._getTemplateName=function(){return"bm-popup-impression-template"},e}(n);t(u)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){"use strict";var r=function(e,i,r,s,a,u){var l=i(r),c=l,d=c.superclass,h="bookmate-popup-payment-template",p={VISA:"visa",QIWI:"qiwi",PAYPAL:"paypal",WEBMONEY:"webmoney",YANDEX_MONEY:"yandex-money",PROMO_CODE:"promo-code",SMS:"sms"},f={VISA:"card",QIWI:"qiwi",PAYPAL:"paypal",WEBMONEY:"webmoney",YANDEX_MONEY:"yandex",PROMO_CODE:"gift code",SMS:"sms"},m={VISA:"visa",QIWI:"qiwi",PAYPAL:"paypal",WEBMONEY:"webmoney",YANDEX_MONEY:"yandex-dengi",PROMO_CODE:"code",SMS:"sms"},g={ADMIN:"admin_test",DAY:"1day",MONTH:"1month",YEAR:"1year"},b={ADMIN:"admin",DAY:"day",MONTH:"month",YEAR:"year"},_={ADMIN:"admin",MONTH:"month",YEAR:"year"},y=n(t);c.Context={READER:1},n.extend(c.prototype,{initialize:function(){this._stopPropagation=!1,this._context=null,this._redirectToAfterSuccess=null,this._disabled={inplat:!1},d.initialize.apply(this,arguments),this._elementPaymentPopup=this._element.find(".bookmate-popup-payment"),this._elementPopupWrapper=this._element.find(".bookmate-popup-content-wrapper"),this._elementPaymentPopupHeader=this._element.find(".popup-header"),this._elementPaymentContentWrapper=this._element.find(".popup-payment-content-wrapper"),this._elementPaymentContent=this._element.find(".popup-payment-content.slide-payment-details"),this._elementPaymentSuccess=this._element.find(".popup-payment-content.slide-payment-success"),this._elementPaymentButtonsWrapper=this._element.find(".payment-buttons-wrapper"),this._elementPaymentButtonVisa=this._element.find(".popup-payment-button-visa"),this._elementPaymentButtonQiwi=this._element.find(".popup-payment-button-qiwi"),this._elementPaymentButtonPaypal=this._element.find(".popup-payment-button-paypal"),this._elementPaymentButtonWebmoney=this._element.find(".popup-payment-button-webmoney"),this._elementPaymentButtonYandexMoney=this._element.find(".popup-payment-button-yandex-money"),this._elementPaymentButtonSms=this._element.find(".popup-payment-button-sms"),this._elementPaymentButtonPromoCode=this._element.find(".popup-payment-button-promo-code"),this._paymentButtons=[this._elementPaymentButtonVisa,this._elementPaymentButtonQiwi,this._elementPaymentButtonPaypal,this._elementPaymentButtonWebmoney,this._elementPaymentButtonYandexMoney,this._elementPaymentButtonSms,this._elementPaymentButtonPromoCode],this._elementDynamicContent=this._element.find(".payment-dynamic-content"),this._elementSubscriptionInterval=this._element.find(".payment-subscription-interval"),this._elementButtonIntervalAdmin=this._element.find(".button-interval-admin"),this._elementButtonIntervalDay=this._element.find(".button-interval-day"),this._elementButtonIntervalMonth=this._element.find(".button-interval-month"),this._elementButtonIntervalYear=this._element.find(".button-interval-year"),this._buttonsInterval=[this._elementButtonIntervalAdmin,this._elementButtonIntervalDay,this._elementButtonIntervalMonth,this._elementButtonIntervalYear],this._elementIntervalButtonsSmsWrapper=this._element.find(".interval-buttons-sms"),this._elementDetailsCode=this._element.find(".payment-subscription-code"),this._elementDetailsVisa=this._element.find(".payment-details.payment-details-visa"),this._elementDetailsYandexMoney=this._element.find(".payment-details.payment-details-yandex-money"),this._elementDetailsPaypal=this._element.find(".payment-details.payment-details-paypal"),this._elementDetailsWebmoney=this._element.find(".payment-details.payment-details-webmoney"),this._elementDetailsSms=this._element.find(".payment-details.payment-details-sms"),this._elementDetailsQiwi=this._element.find(".payment-details.payment-details-qiwi"),this._currentPaymentType=null,this._elementFormVisa=this._element.find(".payment-form-visa"),this._elementFormQiwi=this._element.find(".payment-form-qiwi"),this._elementFormSms=this._element.find(".payment-form-sms"),this._elementFormPromoCode=this._element.find(".payment-subscription-code"),this._elementSubscriptionTextSuccess=this._elementPaymentSuccess.find(".text-success"),this._elementSubscriptionTillDate=this._elementPaymentSuccess.find(".date-till"),this._elementSlideSuccessButtonClose=this._elementPaymentSuccess.find(".bookmate-button.button-close"),this._elementIntervalFormPayPalWrapper=this._element.find(".interval-buttons-paypal"),this._elementIntervalFormPayPal=this._elementIntervalFormPayPalWrapper.find(".interval-form"),this._intervalFormPayPalEnabled=!1,this._elementIntervalLinksWebMoney=this._element.find(".interval-buttons-webmoney"),this._elementIntervalLinkWebMoney=this._elementIntervalLinksWebMoney.find(".bookmate-button"),this._elementIntervalLinksYandexMoney=this._element.find(".interval-buttons-yandex-money"),this._elementIntervalLinkYandexMoney=this._elementIntervalLinksYandexMoney.find(".bookmate-button"),this._contentClassName="bookmate-popup-payment-content",this._authToken=this._getAuthToken(),this._initTimestamp=(new Date).getTime(),this._currentPaymentInterval=null,this._prepare(),this._updateContentClassName(),this._initForms(),this._applyContextBehavior(),this._bindEvents(),this._bindEventsForms(),this._bindEventsIntervalActions()},setConfig:function(t){d.setConfig.apply(this,arguments),t&&(t.stopPropagation&&(this._stopPropagation=t.stopPropagation),t.context&&(this._context=t.context),t.redirectToAfterSuccess&&(this._redirectToAfterSuccess=t.redirectToAfterSuccess),t.disable&&t.disable.inplat&&(this._disabled.inplat=!0))},_bindEvents:function(){var e=this;this._stopPropagation&&this._element.on("mousedown keydown",function(t){t.stopPropagation()}),this._elementPaymentButtonVisa.on("click",function(){e._onElementPaymentButtonVisaClick()}),this._elementPaymentButtonQiwi.on("click",function(){e._onElementPaymentButtonQiwiClick()}),this._elementPaymentButtonPaypal.on("click",function(){e._onElementPaymentButtonPaypalClick()}),this._elementPaymentButtonWebmoney.on("click",function(){e._onElementPaymentButtonWebmoneyClick()}),this._elementPaymentButtonYandexMoney.on("click",function(){e._onElementPaymentButtonYandexMoneyClick()}),this._elementPaymentButtonSms.on("click",function(){e._onElementPaymentButtonSmsClick()}),this._elementPaymentButtonPromoCode.on("click",this._onElementPaymentButtonPromoCodeClick.bind(this)),this._elementButtonIntervalAdmin.on("click",function(){var t=n(this).attr("value");e._scrollToIfNeeded(),e._onElementButtonIntervalAdminClick(t)}),this._elementButtonIntervalDay.on("click",function(){var t=n(this).attr("value");e._scrollToIfNeeded(),e._onElementButtonIntervalDayClick(t)}),this._elementButtonIntervalMonth.on("click",function(){var t=n(this).attr("value");e._scrollToIfNeeded(),e._onElementButtonIntervalMonthClick(t)}),this._elementButtonIntervalYear.on("click",function(){var t=n(this).attr("value");e._scrollToIfNeeded(),e._onElementButtonIntervalYearClick(t)}),this._elementSlideSuccessButtonClose.on("click",this._onSlideSuccessButtonCloseClick.bind(this)),o&&(o("bookmate-subscription-ga-payment-button-pressed-event").subscribe(function(){ga&&ga("send","event","Payment-Button-2","press")}),t.radio("bm-popup-payment-form-sms-show-fields-request").subscribe(function(){e._onFormSmsShowFieldsRequest()}),t.radio("bm-popup-payment-form-sms-show-waiting-request").subscribe(function(){e._onFormSmsShowWaitingRequest()}),t.radio("bm-popup-payment-form-sms-show-unsupported-request").subscribe(function(){e._onFormSmsShowUnsupportedRequest()}),o("notify-on-billing-initialized").subscribe(function(){e._notifyOnBillingInitialized()}))},_bindEventsForms:function(){this._elementFormVisa.on("subscription_success",this._onFormVisaPaymentSuccess.bind(this)),this._elementFormVisa.on("subscription_error",this._onFormVisaPaymentError.bind(this)),this._elementFormPromoCode.on("subscription_success",this._onFormPromoCodePaymentSuccess.bind(this)),this._elementFormSms.on("subscription_success",this._onFormSmsPaymentSuccess.bind(this))},_onFormVisaPaymentSuccess:function(t,e){this._onPaymentSuccess(e)},_onFormVisaPaymentError:function(){this._onPaymentError()},_onFormPromoCodePaymentSuccess:function(t,e){this._showPaymentSuccess(e.expires_at),this._sendSociomanticEventTransactionSuccess(),this._setGetIntentConversionPixel()},_onFormSmsPaymentSuccess:function(){var t=(new Date).getTime()+864e5;this._sendMixpanelEventSubscriptionSuccess({paymentMethod:this._getMixpanelPaymentType(),type:"day"}),this._showPaymentSuccess(t)},_bindEventsIntervalActions:function(){this._elementIntervalFormPayPal.on("submit",this._onIntervalFormSubmit.bind(this,this._elementIntervalFormPayPal)),this._elementIntervalLinkWebMoney.on("click",this._onIntervalLinkClick.bind(this)),this._elementIntervalLinkYandexMoney.on("click",this._onIntervalLinkClick.bind(this))},_onIntervalFormSubmit:function(t,e){var n=!0;return t!==this._elementIntervalFormPayPal||this._intervalFormPayPalEnabled||(n=!1),n?void 0:(e.preventDefault(),!1)},_onIntervalLinkClick:function(t){t.preventDefault()},_onElementPaymentButtonVisaClick:function(){var t=this;this._isCurrentPaymentTypeVisa()||(this._setCurrentPaymentType(p.VISA),this._startResizingAnimation(),this._hideAllTogglingContent(),this._setVisibleSubscriptionIntervalButtons(),this._setVisibleDetailsVisa(),this._updateHeightPaymentContent(function(){t._showSubscriptionIntervalButtons(),t._showDetailsVisa(),t._finishResizingAnimation()}))},_onElementPaymentButtonQiwiClick:function(){var t=this;this._setCurrentPaymentType(p.QIWI),this._startResizingAnimation(),this._hideAllTogglingContent(),this._setVisibleSubscriptionIntervalButtons(),this._setVisibleDetailsQiwi(),this._updateHeightPaymentContent(function(){t._showSubscriptionIntervalButtons(),t._showDetailsQiwi(),t._finishResizingAnimation()})},_onElementPaymentButtonPaypalClick:function(){var t=this;this._setCurrentPaymentType(p.PAYPAL),this._startResizingAnimation(),this._hideAllTogglingContent(),this._setVisibleSubscriptionIntervalButtons(),this._setVisibleDetailsPaypal(),this._updateHeightPaymentContent(function(){t._showSubscriptionIntervalButtons(),t._showDetailsPaypal(),t._finishResizingAnimation()})},_onElementPaymentButtonWebmoneyClick:function(){var t=this;this._setCurrentPaymentType(p.WEBMONEY),this._startResizingAnimation(),this._hideAllTogglingContent(),this._setVisibleSubscriptionIntervalButtons(),this._setVisibleDetailsWebmoney(),this._updateHeightPaymentContent(function(){t._showSubscriptionIntervalButtons(),t._showDetailsWebmoney(),t._finishResizingAnimation()})},_onElementPaymentButtonYandexMoneyClick:function(){var t=this;this._setCurrentPaymentType(p.YANDEX_MONEY),this._startResizingAnimation(),this._hideAllTogglingContent(),this._setVisibleSubscriptionIntervalButtons(),this._setVisibleYandexMoneyDetails(),this._updateHeightPaymentContent(function(){t._showSubscriptionIntervalButtons(),t._showDetailsYandexMoney(),t._finishResizingAnimation()})},_onElementPaymentButtonSmsClick:function(){var t=this;this._setCurrentPaymentType(p.SMS),this._startResizingAnimation(),this._hideAllTogglingContent(),this._setVisibleSubscriptionIntervalButtons(),this._updateHeightPaymentContent(function(){t._showSubscriptionIntervalButtons(),t._finishResizingAnimation()}),this._sendMixpanelEventSubscriptionInitiated()},_onElementPaymentButtonPromoCodeClick:function(){var t=this;this._setCurrentPaymentType(p.PROMO_CODE),this._startResizingAnimation(),this._hideAllTogglingContent(),this._setVisibleDetailsCode(),this._updateHeightPaymentContent(function(){t._showDetailsCode(),t._finishResizingAnimation()})},_onElementButtonIntervalAdminClick:function(t){this._currentPaymentInterval=g.ADMIN,this._onIntervalButtonClick(t)},_onElementButtonIntervalDayClick:function(t){this._currentPaymentInterval=g.DAY,this._onIntervalButtonClick(t)},_onElementButtonIntervalMonthClick:function(t){this._currentPaymentInterval=g.MONTH,this._onIntervalButtonClick(t)},_onElementButtonIntervalYearClick:function(t){this._currentPaymentInterval=g.YEAR,this._onIntervalButtonClick(t)},_onFormSmsShowFieldsRequest:function(){var t=this._getFormSmsWidget();t.setVisibilityHidden(!0),setTimeout(function(){t.showBlockFields(),this._updateHeightPaymentContent(function(){t.setVisibilityHidden(!1)})}.bind(this),300)},_onFormSmsShowWaitingRequest:function(){var t=this._getFormSmsWidget();t.setVisibilityHidden(!0),setTimeout(function(){t.showBlockWaiting(),this._updateHeightPaymentContent(function(){t.setVisibilityHidden(!1)})}.bind(this),300)},_onFormSmsShowUnsupportedRequest:function(){var t=this._getFormSmsWidget();t.setVisibilityHidden(!0),setTimeout(function(){t.showBlockNotSupported(),this._updateHeightPaymentContent(function(){t.setVisibilityHidden(!1)})}.bind(this),300)},_onIntervalButtonClick:function(t){var e=function(){};this._isCurrentPaymentTypeVisa()?(this._highlightSelectedIntervalButton(),this._getFormVisaWidget().setCurrentPlan(this._getCurrentIntervalPlan()),this._showFormVisa()):this._isCurrentPaymentTypeQiwi()?(this._highlightSelectedIntervalButton(),this._getFormQiwiWidget().setPaymentAmount(t),this._showFormQiwi()):this._isCurrentPaymentTypeSms()?(this._highlightSelectedIntervalButton(),this._showFormSms()):(e=this._continueIntervalAction,this._setCurrentIntervalButtonStateWait(),this._isCurrentPaymentTypePromoCode()||this._notifyOnBillingInitialized()),this._isCurrentPaymentTypePromoCode()||this._sendMixpanelEventSubscriptionInitiated(e.bind(this))},_setCurrentIntervalButtonStateWait:function(){this._isCurrentPlanAdmin()?this._setButtonIntervalAdminStateWait():this._isCurrentPlanDay()?this._setButtonIntervalDayStateWait():this._isCurrentPlanMonth()?this._setButtonIntervalMonthStateWait():this._isCurrentPlanYear()&&this._setButtonIntervalYearStateWait()},_continueIntervalAction:function(){this._sendGAEventPaymentButtonPress(),this._isCurrentPaymentTypePayPal()?(this._intervalFormPayPalEnabled=!0,this._submitIntervalFormPayPal()):this._applyIntervalActionWindowLocationChange()},_submitIntervalFormPayPal:function(){var t;this._isCurrentPlanAdmin()?t=this._elementIntervalFormPayPalWrapper.find(".interval-form-admin"):this._isCurrentPlanMonth()?t=this._elementIntervalFormPayPalWrapper.find(".interval-form-month"):this._isCurrentPlanYear()&&(t=this._elementIntervalFormPayPalWrapper.find(".interval-form-year")),t.trigger("submit")},_applyIntervalActionWindowLocationChange:function(){t.location.href=this._getActiveIntervalLinkHref()},_getActiveIntervalLinkHref:function(){var t,e;return this._isCurrentPaymentTypeWebMoney()?t=this._elementIntervalLinksWebMoney:this._isCurrentPaymentTypeYandexMoney()&&(t=this._elementIntervalLinksYandexMoney),this._isCurrentPlanAdmin()?e=t.find(".button-interval-admin"):this._isCurrentPlanMonth()?e=t.find(".button-interval-month"):this._isCurrentPlanYear()&&(e=t.find(".button-interval-year")),e.attr("href")},_getSociomanticIdentifier:function(){var e=t.location.pathname.slice(1).split("/");return e[0]&&"books"===e[0]?e[1]:"r"===e[0]?t.location.hash.split("=")[1]:"subscription"===e[0]?"page_subscription":"library"!==e[0]&&e[0]?"else":"page_main"},_sendSociomanticEventPopupOpen:function(){t.sociomantic&&(t.sociomantic.sonar.adv["bookmate-ru"].clear(),t.basket={products:[{identifier:decodeURIComponent(this._getSociomanticIdentifier())}]},t.sociomantic.sonar.adv["bookmate-ru"].track())},_sendSociomanticEventTransactionSuccess:function(){t.sociomantic&&(t.sociomantic.sonar.adv["bookmate-ru"].clear(),t.lead={transaction:BM.user.getLogin()+(new Date).getTime()},t.sociomantic.sonar.adv["bookmate-ru"].track())},_setGetIntentConversionPixel:function(){a()},_setGetIntentCartPixel:function(){u()},_sendMixpanelEventSubscriptionInitiated:function(t){var e=t||function(){};DIMixpanel.track("Subscription Initiated",{method:this._getMixpanelPaymentType(),type:this._getMixpanelIntervalType()}).then(function(){e()})},_sendMixpanelEventSubscriptionSuccess:function(t,e){var n=e||function(){};n()},_sendMixpanelEventSubscriptionError:function(t){DIMixpanel.track("Subscription Failed",{method:t.paymentMethod,payment_type:t.paymentMethod,type:t.type})},_sendGAEventPaymentTypeSet:function(t){var e=this._getGAPaymentMethod(t);ga&&ga("send","event",e,"press")},_sendGAEventPaymentButtonPress:function(){o&&o("bookmate-subscription-ga-payment-button-pressed-event").broadcast()},_sendGAEventPaymentSuccess:function(){ga&&ga("send","event","Subscription-Successful",this._getGAIntervalType())},_onSlideSuccessButtonCloseClick:function(){null!==this._redirectToAfterSuccess?t.location.replace(this._redirectToAfterSuccess):t.location.reload()},_prepare:function(){this._disabled.inplat&&this._disableInplat()},_initForms:function(){this._initFormVisa(),this._initFormQiwi(),this._initFormPromoCode(),this._initFormSms()},_getPaymentAmountQiwiAdmin:function(){return this._elementButtonIntervalAdmin.attr("value")},_getPaymentAmountQiwiMonth:function(){return this._elementButtonIntervalMonth.attr("value")},_getPaymentAmountQiwiYear:function(){return this._elementButtonIntervalYear.attr("value")},_getCurrentIntervalPlan:function(){return this._currentPaymentInterval},_initFormVisa:function(){t.ppp=this._elementFormVisa,this._elementFormVisa.popupPaymentFormVisa(),this._getFormVisaWidget().setAuthToken(this._getAuthToken())},_initFormQiwi:function(){this._elementFormQiwi.popupPaymentFormQiwi(),this._getFormQiwiWidget().setAuthToken(this._getAuthToken())},_initFormPromoCode:function(){this._elementFormPromoCode.popupPaymentFormPromoCode(),this._getFormPromoCodeWidget().setAuthToken(this._getAuthToken())},_initFormSms:function(){this._elementFormSms.popupPaymentFormSms(),this._getFormSmsWidget().setAuthToken(this._getAuthToken())},_getAuthToken:function(){return this._element.find("input[name=authenticity_token]").val()},_getFormVisaWidget:function(){return this._elementFormVisa.data("custom-popupPaymentFormVisa")},_getFormQiwiWidget:function(){return this._elementFormQiwi.data("custom-popupPaymentFormQiwi")},_getFormPromoCodeWidget:function(){return this._elementFormPromoCode.data("custom-popupPaymentFormPromoCode")},_getFormSmsWidget:function(){return this._elementFormSms.data("custom-popupPaymentFormSms")},_setVisibleSubscriptionIntervalButtons:function(){this._elementSubscriptionInterval.removeAttr("hidden")},_showSubscriptionIntervalButtons:function(){this._elementSubscriptionInterval.attr("currency",this._currentCurrency),this._elementSubscriptionInterval.attr("visible","true")},_hideSubscriptionIntervalButtons:function(){this._elementSubscriptionInterval.attr("hidden","hidden"),this._elementSubscriptionInterval.removeAttr("visible")},_showButtonPromoCode:function(){this._elementPaymentButtonPromoCode.removeAttr("hidden")},_hideButtonPromoCode:function(){this._elementPaymentButtonPromoCode.attr("hidden","hidden")},_setVisibleDetailsVisa:function(){this._elementDetailsVisa.removeAttr("hidden")},_showDetailsVisa:function(){this._elementDetailsVisa.attr("visible","true")},_hideDetailsVisa:function(){this._elementDetailsVisa.attr("hidden","hidden"),this._elementDetailsVisa.removeAttr("visible")},_setVisibleYandexMoneyDetails:function(){this._elementDetailsYandexMoney.removeAttr("hidden")},_showDetailsYandexMoney:function(){this._elementDetailsYandexMoney.attr("visible","true")},_hideDetailsYandexMoney:function(){this._elementDetailsYandexMoney.attr("hidden","hidden"),this._elementDetailsYandexMoney.removeAttr("visible")},_setVisibleDetailsPaypal:function(){this._elementDetailsPaypal.removeAttr("hidden")},_showDetailsPaypal:function(){this._elementDetailsPaypal.attr("visible","true")},_hideDetailsPaypal:function(){
this._elementDetailsPaypal.attr("hidden","hidden"),this._elementDetailsPaypal.removeAttr("visible")},_setVisibleDetailsQiwi:function(){this._elementDetailsQiwi.removeAttr("hidden")},_showDetailsQiwi:function(){this._elementDetailsQiwi.attr("visible","true")},_hideDetailsQiwi:function(){this._elementDetailsQiwi.attr("hidden","hidden"),this._elementDetailsQiwi.removeAttr("visible")},_setVisibleDetailsWebmoney:function(){this._elementDetailsWebmoney.removeAttr("hidden")},_showDetailsWebmoney:function(){this._elementDetailsWebmoney.attr("visible","true")},_hideDetailsWebmoney:function(){this._elementDetailsWebmoney.attr("hidden","hidden"),this._elementDetailsWebmoney.removeAttr("visible")},_setVisibleFormSms:function(){this._elementFormSms.removeAttr("hidden","hidden")},_hideFormSms:function(){this._elementFormSms.attr("hidden","hidden"),this._elementFormSms.removeAttr("visible")},_setVisibleDetailsCode:function(){this._elementDetailsCode.removeAttr("hidden")},_showDetailsCode:function(){this._elementDetailsCode.attr("visible","true")},_hideDetailsCode:function(){this._elementDetailsCode.attr("hidden","hidden"),this._elementDetailsCode.removeAttr("visible")},_startResizingAnimation:function(t){var e=this;s.isFunction(t)&&this._elementDynamicContent.transitionEnd(function(){e._elementDynamicContent.unbindTransitionEnd(),t()}),this._elementDynamicContent.attr("visibility","hidden")},_hideAllTogglingContent:function(){var t=this._getFormVisaWidget(),e=this._getFormQiwiWidget();this._hideButtonPromoCode(),this._hideDetailsVisa(),this._hideDetailsYandexMoney(),this._hideDetailsWebmoney(),this._hideDetailsPaypal(),this._hideDetailsQiwi(),this._hideDetailsCode(),this._clearButtonsIntervalStateActive(),this._removeIntervalButtonsStateWait(),this._hideSubscriptionIntervalButtons(),this._hideFormSms(),t.hide(),e.hide()},_finishResizingAnimation:function(){this._elementDynamicContent.removeAttr("visibility")},_highlightSelectedIntervalButton:function(){this._isCurrentPlanAdmin()?this._setButtonIntervalAdminStateActive():this._isCurrentPlanDay()?this._setButtonIntervalDayStateActive():this._isCurrentPlanMonth()?this._setButtonIntervalMonthStateActive():this._isCurrentPlanYear()&&this._setButtonIntervalYearStateActive()},_setButtonIntervalAdminStateActive:function(){this._elementSubscriptionInterval.attr("interval-selected","true"),this._setButtonIntervalStateActive(this._elementButtonIntervalAdmin)},_setButtonIntervalDayStateActive:function(){this._elementSubscriptionInterval.attr("interval-selected","true"),this._setButtonIntervalStateActive(this._elementButtonIntervalDay)},_setButtonIntervalMonthStateActive:function(){this._elementSubscriptionInterval.attr("interval-selected","true"),this._setButtonIntervalStateActive(this._elementButtonIntervalMonth)},_setButtonIntervalYearStateActive:function(){this._elementSubscriptionInterval.attr("interval-selected","true"),this._setButtonIntervalStateActive(this._elementButtonIntervalYear)},_setButtonIntervalAdminStateWait:function(){this._elementButtonIntervalAdmin.attr("wait","true")},_removeButtonIntervalAdminStateWait:function(){this._elementButtonIntervalAdmin.removeAttr("wait")},_setButtonIntervalDayStateWait:function(){this._elementButtonIntervalDay.attr("wait","true")},_removeButtonIntervalDayStateWait:function(){this._elementButtonIntervalDay.removeAttr("wait")},_setButtonIntervalMonthStateWait:function(){this._elementButtonIntervalMonth.attr("wait","true")},_removeButtonIntervalMonthStateWait:function(){this._elementButtonIntervalMonth.removeAttr("wait")},_setButtonIntervalYearStateWait:function(){this._elementButtonIntervalYear.attr("wait","true")},_removeButtonIntervalYearStateWait:function(){this._elementButtonIntervalYear.removeAttr("wait")},_freezePopup:function(){},_showFormVisa:function(){var t=this._getFormVisaWidget();t.isVisible()||(this._hideDetailsVisa(),t.setVisible(!0),this._updateHeightPaymentContent(function(){t.show()}))},_showFormQiwi:function(){var t=this._getFormQiwiWidget();t.isVisible()||(this._hideDetailsQiwi(),t.setVisible(!0),this._updateHeightPaymentContent(function(){t.show()}))},_showFormSms:function(){var t=this._getFormSmsWidget();this._isCurrentPlanDay()?(this._notifyOnBillingInitialized(),t.useInplat()):this._isCurrentPlanMonth()&&t.usePlanet3(),t.setVisible(!0),this._updateHeightPaymentContent(function(){t.show()})},_setButtonIntervalStateActive:function(t){this._buttonsInterval.forEach(function(e){e===t?e.attr("active","true"):e.removeAttr("active")})},_clearButtonsIntervalStateActive:function(){this._elementSubscriptionInterval.removeAttr("interval-selected"),this._setButtonIntervalStateActive(null)},_setCurrentPaymentType:function(t){var e;this._getFormSmsWidget();switch(t){case p.VISA:e=this._elementPaymentButtonVisa;break;case p.QIWI:e=this._elementPaymentButtonQiwi;break;case p.PAYPAL:e=this._elementPaymentButtonPaypal;break;case p.WEBMONEY:e=this._elementPaymentButtonWebmoney;break;case p.YANDEX_MONEY:e=this._elementPaymentButtonYandexMoney;break;case p.SMS:e=this._elementPaymentButtonSms;break;case p.PROMO_CODE:e=this._elementPaymentButtonPromoCode}s.isUndefined(e)||this._setPaymentButtonStateActive(e),this._showIntervalButtons(t),this._sendGAEventPaymentTypeSet(t),this._currentPaymentType=t},_isCurrentPaymentTypeVisa:function(){return this._currentPaymentType===p.VISA},_isCurrentPaymentTypeQiwi:function(){return this._currentPaymentType===p.QIWI},_isCurrentPaymentTypePayPal:function(){return this._currentPaymentType===p.PAYPAL},_isCurrentPaymentTypeYandexMoney:function(){return this._currentPaymentType===p.YANDEX_MONEY},_isCurrentPaymentTypeSms:function(){return this._currentPaymentType===p.SMS},_isCurrentPaymentTypeWebMoney:function(){return this._currentPaymentType===p.WEBMONEY},_isCurrentPaymentTypePromoCode:function(){return this._currentPaymentType===p.PROMO_CODE},_isCurrentPlanAdmin:function(){return this._currentPaymentInterval===g.ADMIN},_isCurrentPlanDay:function(){return this._currentPaymentInterval===g.DAY},_isCurrentPlanMonth:function(){return this._currentPaymentInterval===g.MONTH},_isCurrentPlanYear:function(){return this._currentPaymentInterval===g.YEAR},_isCurrentPaymentTypeInplat:function(){return this._isCurrentPlanDay()&&this._isCurrentPaymentTypeSms()},_isPopupFreezeNeeded:function(){return this._isCurrentPaymentTypeYandexMoney()||this._isCurrentPaymentTypeWebMoney()||this._isCurrentPaymentTypePayPal()},_getMixpanelPaymentType:function(){var t,e=Object.prototype.hasOwnProperty;for(t in p)if(e.call(p,t)&&this._currentPaymentType===p[t])return f[t];return null},_getMixpanelIntervalType:function(){var t,e=Object.prototype.hasOwnProperty;for(t in g)if(e.call(g,t)&&this._currentPaymentInterval===g[t])return b[t];return null},_getGAPaymentMethod:function(t){var e,n=Object.prototype.hasOwnProperty;for(e in p)if(n.call(p,e)&&t===p[e])return m[e];return null},_getGAIntervalType:function(){var t,e=Object.prototype.hasOwnProperty;for(t in g)if(e.call(g,t)&&this._currentPaymentInterval===g[t])return _[t];return null},_showIntervalButtons:function(t){this._elementSubscriptionInterval.attr("type",t)},_setPaymentButtonStateActive:function(t){this._elementPaymentButtonsWrapper.attr("payment-type-selected","true"),this._paymentButtons.forEach(function(e){e===t?e.attr("active","true"):e.removeAttr("active")})},_resetPopupPaymentButtons:function(){this._elementPaymentButtonsWrapper.removeAttr("payment-type-selected"),this._paymentButtons.forEach(function(t){t.removeAttr("active")}),this._currentPaymentInterval=null},_updateSize:function(){this._updateHeightPaymentContent()},_updateHeightPaymentContent:function(t,e){var n,i=this;n=this._isSlidePaymentSuccess()?this._elementPaymentSuccess.height():this._elementPaymentContent.height(),e?(this._elementPaymentContentWrapper.attr("no-transitions","true"),this._elementPaymentContentWrapper.css({height:n}),this._elementPaymentContentWrapper[0].offsetHeight,this._elementPaymentContentWrapper.removeAttr("no-transitions")):(s.isFunction(t)&&this._elementPaymentContentWrapper.transitionEnd(function(){i._elementPaymentContentWrapper.unbindTransitionEnd(),t()}),this._elementPaymentContentWrapper.css({height:n}))},_isSlidePaymentSuccess:function(){return"second"===this._elementPaymentContentWrapper.attr("slide")},_showSlideFirst:function(t,e){this._setSlide("first"),this._updateHeightPaymentContent(t,e),this._showHeaderSelectMethod()},_showSlideSecond:function(t,e){this._setSlide("second"),this._updateHeightPaymentContent(t,e)},_showHeaderSelectMethod:function(){this._elementPaymentPopupHeader.removeAttr("data-header")},_showHeaderSuccess:function(){this._elementPaymentPopupHeader.attr("data-header","success")},_setSlide:function(t){this._elementPaymentContentWrapper.attr("slide",t)},_onPaymentSuccess:function(t){this._showPaymentSuccess(t.expires_at),this._sendMixpanelEventSubscriptionSuccess({paymentMethod:this._getMixpanelPaymentType(),type:this._getMixpanelIntervalType()}),this._sendSociomanticEventTransactionSuccess(),this._setGetIntentConversionPixel()},_onSmsPaymentSuccess:function(){this._sendSociomanticEventTransactionSuccess(),this._setGetIntentConversionPixel(),this._sendMixpanelEventSubscriptionSuccess({paymentMethod:this._getMixpanelPaymentType(),type:this._getMixpanelIntervalType()},function(){t.location.reload()})},_onPaymentError:function(){this._sendMixpanelEventSubscriptionError({paymentMethod:this._getMixpanelPaymentType(),type:this._getMixpanelIntervalType()})},_showPaymentSuccess:function(t){var e=this._getFormattedDate(t);this._elementSubscriptionTillDate.html(e),this._backgroundClickHide=!1,this._showSlideSecond(),this._showHeaderSuccess(),this._isCurrentPaymentTypeInplat()||this._isCurrentPaymentTypeVisa()?this._elementSubscriptionTextSuccess.addClass("hidden"):this._elementSubscriptionTextSuccess.removeClass("hidden"),this._updateSize()},_getFormattedDate:function(t){var e=new Date(t);return[e.getDate(),e.getMonth()+1,e.getFullYear()].join("/")},_show:function(){this._updateHeightPaymentContent(void 0,!0),this._isVisible||(this._sendSociomanticEventPopupOpen(),this._setGetIntentCartPixel(),d._show.apply(this,arguments))},_hide:function(){var t=this._getFormSmsWidget();t.stopPlanet3SmsCheckingLoop(),d._hide.apply(this,arguments)},_getTemplateName:function(){return h},setStateInitial:function(){this._backgroundClickHide=!0,this._currentPaymentType=null,this._hideAllTogglingContent(),this._showButtonPromoCode(),this._removeIntervalButtonsStateWait(),this._resetPopupPaymentButtons(),this._updateHeightPaymentContent(void 0,!0),this._showSlideFirst(void 0,!0)},reset:function(){return this.setStateInitial()},resetDefaults:function(){},_removeIntervalButtonsStateWait:function(){this._removeButtonIntervalAdminStateWait(),this._removeButtonIntervalMonthStateWait(),this._removeButtonIntervalYearStateWait()},_applyContextBehavior:function(){this._isContextReader()&&this._mixinDocumentUUIDInRequests()},_isContextReader:function(){return this._context===c.Context.READER},_mixinDocumentUUIDInRequests:function(){var t=this._parseUUIDFromHash(),e="document:"+t,i="return_to="+e;this._elementIntervalLinksWebMoney.find(".bookmate-button").add(this._elementIntervalLinksYandexMoney.find(".bookmate-button")).each(function(){var t=n(this),e=t.attr("href");t.attr("href",e+"&"+i)}),this._elementIntervalFormPayPalWrapper.find(".interval-form").each(function(){var t=n(this),i=n("<input>").attr("type","hidden").attr("name","return_to").attr("value",e);t.prepend(i)}),this._getFormQiwiWidget().mixinRequestParameter({return_to:e})},_parseUUIDFromHash:function(){var e=t.location.hash;return e=e.slice(1).split("="),e[1]},_disableInplat:function(){this._elementIntervalButtonsSmsWrapper.find(".button-interval-day").attr("hidden","hidden")},_scrollToIfNeeded:function(){var t=this;y.height()<this._element.height()+400&&setTimeout(function(){t._elementPopupWrapper.scrollTop(t._elementPopupWrapper.scrollTop()+1e3)},300)},_notifyOnBillingInitialized:function(){n.ajax({url:"/a/4/billing/initialized",method:"post",data:{source:"web"},success:function(){console.log("\\_()_/")}})}}),e(l)};i.define("paymentPopup",["extend","PopupBase","tools","setGetIntentConversionPixel","setGetIntentCartPixel","paymentPopup/visa","paymentPopup/qiwi","paymentPopup/promoCode","paymentPopup/sms"],r)}(this,this.document,this.jQuery,this.modules,this.radio),function(t,e,n,i){e.define("PopupIframe",["PopupBase","dynamicContent"],function(t,e,o){var r=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.call(this,{useTemplate:!0,rootClassName:["m-version-2","bm-popup-iframe"]}),this.$el&&(this.$dc=this.$el.find("@bm-popup-iframe-dynamic-content"),this.$content=this.$el.find("@bm-popup-iframe-content"),this.$closeButton=this.$el.find("@button-close"),this.$iframe=null,this._loaded=!1,this._config={},this._dc=null,this._initDC(),this._bindEvents(),i.tools.mixin(this._config,e))},e.prototype._bindEvents=function(){var t=this;this.$closeButton.on("click",function(){return t._onButtonCloseClick()})},e.prototype._initDC=function(){i.tools.isNull(this._dc)&&(this._dc=new o({element:this.$dc}))},e.prototype._updateAttrs=function(){var t,e=this;this._config.attrs&&!i.tools.isEmpty(this._config.attrs)&&(t=Object.keys(this._config.attrs),-1!==t.indexOf("src")?(this._initIframe(),i.tools.isObject(this._config.attrs)&&t.forEach(function(t){e.$iframe.attr(t,e._config.attrs[t])}),this._resolveCurrrentStep()):(this._destroyIframe(),this._resolveCurrrentStep()))},e.prototype.show=function(){t.prototype.show.apply(this,arguments),this._updateAttrs()},e.prototype.hide=function(){t.prototype.hide.apply(this,arguments),this._destroyIframe()},e.prototype._initIframe=function(){var t=this;i.tools.isNull(this.$iframe)||this._destroyIframe(),this.$iframe=n(document.createElement("iframe")),this.$iframe.addClass(this.$content.data("iframe-class-name")),this.$iframe.on("load",function(){t.$iframe.off("load"),t._loaded=!0,t._resolveCurrrentStep()}),this.$content.append(this.$iframe)},e.prototype._resolveCurrrentStep=function(){!i.tools.isNull(this.$iframe)&&this._loaded?this._dc.showStep("iframe"):this._dc.showStep("loading")},e.prototype._destroyIframe=function(){i.tools.isNull(this.$iframe)||(this.$iframe.off(),this.$iframe.remove(),this.$iframe=null,this._loaded=!1)},e.prototype._onButtonCloseClick=function(){this.hide()},e.prototype._getTemplateName=function(){return"bm-popup-iframe-template"},e}(e);t(r)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("PopupMailing",["extend","PopupBase"],function(t,e,o){var r=e(o),s=r,a=s.superclass;i.tools.mixin(s.prototype,{initialize:function(t){a.initialize.call(this,{useTemplate:!0,rootClassName:["m-version-2","bm-popup-mailing"]}),this._config={},this._setConfig(t),this._bindEvents()},_setConfig:function(t){i.tools.isPresent(this._config)&&i.tools.isObject(this._config)&&(this._config=i.tools.mixin(this._config,t))},_bindEvents:function(){},show:function(){a.show.apply(this,arguments),this.renderPopupHeader()},renderPopupHeader:function(){n("body").find(".mailing-popup-header").length||n("<div/>",{"class":"mailing-popup-header",text:n(".digest-content").find(".digest-content-subject-description").text()}).prependTo(".bm-popup-content-wrapper")},_getTemplateName:function(){return"bm-popup-mailing-template"}}),t(r)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o,r){"use strict";var s=function(t,e,i,o){var s=e(i),a=s,u=a.superclass,l="bm-popup-follow-suggest-template";r.tools.mixin(a.prototype,{initialize:function(t){u.initialize.apply(this,arguments),this.$body=this._element.find(".bm-popup-inner-content"),this.itemProcessor=new o,this.fetchURL=t.fetchURL,this.page=1,this.pp=t.pp||20,this._initListeners(),this._fetchUsers()},_initListeners:function(){},_fetchUsers:function(){var t=this;n.ajax({url:t.fetchURL,method:"get",data:{p:t.page,pp:t.pp},success:function(e){for(var n=0;n<e.length;n++)t.$body.append(t.itemProcessor.getItem(e[n]))}})},_getTemplateName:function(){return l}}),t(s)};i.define("followSuggestPopup",["extend","PopupBase","UserProcessor"],s)}(this,this.document,this.jQuery,this.modules,this.radio,this.BM),function(t,e,n,i,o){"use strict";var r=function(t,e,n){var i=function(){var t=function(){var t=this;t.userItemTemplateFactory=new n("#bm-popup-follow-suggest-user-template")};return t.prototype={getItem:function(t){var e,n=this;return e=n.userItemTemplateFactory.getInstance(),e.data("login",t.login),e.find("img").attr("src",t.avatar_url),e.find(".bm-popup-follow-suggest-user-info-name").html(t.name||t.login),e.find(".bm-popup-follow-suggest-user-info-stats-books span").html(t.library_cards_count),e.find(".bm-popup-follow-suggest-user-info-stats-bookshelves span").html(t.bookshelves_count),e}},t}();e.ItemProcessor=i,t(i)};i.define("UserProcessor",["modules","TemplateFactory"],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o,r){e.define("modulePopupPaymentLight",["PopupBase","extend","PaymentForm","dynamicContent"],function(e,s,a,u,l){var c=a(s),d=c,h=d.superclass,p="bm-popup-payment-light-template";i.tools.mixin(d,{Step:{LOADING:"loading",ABOUT_DEFAULT:"about-default",ABOUT_BOOSTER:"about-booster",PAYMENT_FORM:"payment-form",AUTO:"auto",SUCCESS:"success"}}),i.tools.mixin(d.prototype,{initialize:function(t){this._initialState=d.Step.PAYMENT_FORM,h.initialize.call(this,i.tools.mixin({useTemplate:!0,rootClassName:["m-version-2","bm-popup-payment-light"]},t)),this.$elemLinkBack=this._element.find("@bm-popup-payment-light-link-back"),this.$elemDynamicContent=this._element.find("@bm-popup-payment-light-dynamic-content"),this.$elemPaymentFormWrapper=this._element.find("@bm-popup-payment-light-form-wrapper"),this.$elemsHeaderItems=this._element.find("@bm-popup-payment-light-header-item"),this.$elemButtonBuyPremium=this._element.find("@bm-popup-block-about-button-buy-premium"),this.$elemButtonBuyBooster=this._element.find("@bm-popup-block-about-button-buy-booster"),this.$elemButtonBuyDefault=this._element.find("@bm-popup-block-about-button-buy-default"),this.$elemStateSuccessContent=this._element.find("@bm-popup-payment-light-state-success-content"),this.$elemNextChargeDate=this._element.find("@bm-popup-payment-light-next-charge-date"),this.$elemStateSuccessButtonOkWrapper=this._element.find("@bm-popup-payment-light-state-success-button-ok-wrapper"),this.$elemStateSuccessButtonOk=this._element.find("@bm-popup-payment-light-state-success-button-ok"),this.$elemStateSuccessIOSWarning=this._element.find("@bm-popup-payment-light-state-success-warning"),this.$elemSubscriptionExpirationDate=this._element.find("@subscription-expiration-date"),this.$elemsCheckmarkSuccess=this._element.find("@bm-checkmark-success"),this._dynamicContent=null,this._paymentForm=null,this._requestPaymentMethods=null,this._allowedPaymentMethods=null,this._initDynamicContent(),this._appendPaymentForm(),this._bindEvents()},setConfig:function(t){h.setConfig.apply(this,arguments),i.tools.isUndefined(t)||i.tools.isUndefined(t.initialState)||this.setInitialState(t.initialState)},show:function(t){var e=this,n=t&&t.step?t.step:null;"auto"!==n&&null!==n||(n=this._getStepByUserSubscription()),this.updateDefaultSubscriptionExpirationDate(),this._arePaymentMethodsLoaded()?this._showPopup(n):this._loadPaymentMethods(function(){e._isVisible?e._dynamicContent.showStep(n,function(){},!1,!0):e._dynamicContent.setStep(n)}),-1!==[d.Step.ABOUT_DEFAULT,d.Step.ABOUT_BOOSTER].indexOf(n)&&this._sendEventPopupShown({step:n,context:t&&t.context})},_sendEventPopupShown:function(t){var e,n;t&&(t.step&&(e=t.step),t.context&&(n=t.context)),e&&r.track("All Subscriptions Popup Shown",{context:n})},updateDefaultSubscriptionExpirationDate:function(){i.user.isUserPresent()&&i.user.isSubscriptionDefault()&&this.$elemSubscriptionExpirationDate.html(o(1e3*i.user.getSubscription("default").expires_at).format("D MMMM YYYY"))},clear:function(){i.tools.isNull(this._paymentForm)||this._paymentForm.reset()},setInitialState:function(t){i.tools.isUndefined(t)||(this._initialState=t)},showState:function(t){i.tools.isNull(this._dynamicContent)||(this._dynamicContent.showStep(t),t===d.Step.LOADING?this._hideHeader():this._showHeader(t))},setState:function(t){i.tools.isNull(this._dynamicContent)||(this._dynamicContent.setStep(t),t===d.Step.LOADING?this._hideHeader():this._showHeader(t))},_getStepByUserSubscription:function(){return i.user.isSubscriptionPremium()&&i.user.isRecurrentPremiumActive()?d.Step.PAYMENT_FORM:i.user.isRecurrentDefaultActive()?d.Step.ABOUT_BOOSTER:d.Step.ABOUT_DEFAULT},_showPopup:function(t){t=t||this._initialState,this.clear(),this._isVisible?this.showState(t):this.setState(t),h.show.apply(this,arguments)},_arePaymentMethodsLoaded:function(){return!i.tools.isNull(this._allowedPaymentMethods)},_loadPaymentMethods:function(t){var e=this,o="/a/4/billing/web/product_levels.json";this._hideHeader(),this._showPopup(d.Step.LOADING),i.user.getSubscriptionCoutryCode()&&(o+="?subscription_country="+i.user.getSubscriptionCoutryCode()),this._requestPaymentMethods=n.ajax({url:o,type:"get",dataType:"json",success:function(n){e._applyPaymentMethodsRequestData(n),e._allowedPaymentMethods=n,t()},error:function(){e.hide()}})},_applyPaymentMethodsRequestData:function(t){var e=!1;t.forEach(function(t){t.levels.forEach(function(t){"premium"===t.kind&&(e=!0)})}),e===!1?this._initialState=d.Step.PAYMENT_FORM:i.user.anySubscriptionPresent()?i.user.isSubscriptionDefault()&&(this._initialState=d.Step.ABOUT_BOOSTER):this._initialState=d.Step.ABOUT_DEFAULT,this._paymentForm.setAvailableMethods(t)},_initDynamicContent:function(){this._dynamicContent=new l({element:this.$elemDynamicContent})},_appendPaymentForm:function(){i.tools.isNull(this._paymentForm)&&(this._paymentForm=new u,this.$elemPaymentFormWrapper.append(this._paymentForm.getElement()))},_bindEvents:function(){var t=this,e=i.tools.client.isTouch()?i.tools.client.touchEvent:"click";this.$elemButtonBuyDefault.on(e,function(){t._paymentForm.setSubscriptionKind(u.SubscriptionType.DEFAULT),t._sendEventSubscriptionInitiated(u.SubscriptionType.DEFAULT),t._showPaymentForm(u.SubscriptionType.DEFAULT)}),this.$elemButtonBuyBooster.on(e,function(){t._paymentForm.setSubscriptionKind(u.SubscriptionType.PREMIUM),t._sendEventSubscriptionInitiated(u.SubscriptionType.PREMIUM),t._showPaymentForm(u.SubscriptionType.BOOSTER)}),this.$elemButtonBuyPremium.on(e,function(){t._paymentForm.setSubscriptionKind(u.SubscriptionType.PREMIUM),t._sendEventSubscriptionInitiated(u.SubscriptionType.PREMIUM),t._showPaymentForm(u.SubscriptionType.PREMIUM)}),this._dynamicContent.on("fade-out-start",function(e,n){t._onDynamicContentFadeOutStart(e,n)}),this._dynamicContent.on("resize-end",function(e,n){t._onDynamicContentResizeEnd(e,n)}),this._dynamicContent.on("fade-in-start",function(e,n){t._onDynamicContentFadeInStart(e,n)}),this.$elemLinkBack.on(e,function(){t._navigateBack()}),this._paymentForm.on("subscription-success",function(e){t._onPaymentFormPaymentSuccess(e)}),this.$elemStateSuccessButtonOk.on("click",function(){t._onStateSuccessButtonOkClick()})},_onDynamicContentFadeOutStart:function(t,e){this._hideHeader()},_onDynamicContentResizeEnd:function(t,e){this._elementOverlay.scrollTop(0)},_onDynamicContentFadeInStart:function(t,e){this._dynamicContent.isStepsStackEmpty()||this._showLinkBack(),this._showHeader(e)},_onPaymentFormPaymentSuccess:function(t){this._showStateSuccess(t)},_onStateSuccessButtonOkClick:function(){t.location.reload()},_showStateSuccess:function(t){var e,n;t&&(t.kind?e=t.kind:t.plan&&(e=this._paymentForm.getKindByPlan(t.plan)),t.expires_at&&(n=this._timestampToDate(t.expires_at))),e&&n&&(this._backgroundClickHide=!1,this.hideButtonClose(),this._hideLinkBack(),this.$elemNextChargeDate.html(n),this.$elemStateSuccessContent.attr("data-subscription-kind",e),this._dynamicContent.clearStepsStack(),i.user.isSubscriptionDefaultIOS()&&(this.$elemStateSuccessButtonOkWrapper.attr("hidden","hidden"),this.$elemStateSuccessIOSWarning.removeAttr("hidden")),this._dynamicContent.showStep(d.Step.SUCCESS,function(){},!1,!0))},_timestampToDate:function(t){var e=new Date(t);return[e.getDate(),e.getMonth()+1,e.getFullYear()].join("/")},_showHeader:function(t){this.$elemsHeaderItems.each(function(){var e=n(this);e.attr("data-step")===t?e.attr("data-visible","true"):e.attr("data-visible","false")})},_hideHeader:function(){this.$elemsHeaderItems.each(function(){var t=n(this);t.attr("data-visible","false")})},_showAboutDefaultSubscription:function(){this._dynamicContent.showStep(d.Step.ABOUT_DEFAULT)},_showAboutBoosterSubscription:function(){this.updateDefaultSubscriptionExpirationDate(),this._dynamicContent.showStep(d.Step.ABOUT_BOOSTER)},_showPaymentForm:function(t){this._paymentForm.reset(),this._dynamicContent.showStep(d.Step.PAYMENT_FORM)},_sendEventSubscriptionInitiated:function(t){t&&("default"===t&&(t="standard"),r.track("Subscription Initiated",{sub_type:t}))},_navigateBack:function(){this._dynamicContent.showPreviousStep(),this._dynamicContent.isStepsStackEmpty()&&this._hideLinkBack()},_showLinkBack:function(){this.$elemLinkBack.attr("data-visible","true")},_hideLinkBack:function(){this.$elemLinkBack.attr("data-visible","false")},_getTemplateName:function(){return p},_getTemplateContent:function(){var t=h._getTemplateContent.call(this);return t}}),e(c)})}(this,this.modules,this.jQuery,this.BM,this.moment,this.DIMixpanel),function(t,e,n,i){e.define("modulePopupQuote",["extend","PopupBase","dynamicContent","moduleQuote"],function(e,o,r,s,a){var u=o(r),l=u,c=l.superclass,d="bm-popup-quote-template";n(t);i.tools.mixin(l.prototype,{initialize:function(e){c.initialize.call(this,{useTemplate:!0,rootClassName:["m-version-2","bm-popup-quote"]}),this._config={uuid:null,openDocumentPopup:!0,components:{link:!1,likeSimple:!1},readButton:{dropdownOptions:{$layout:n(".bm-popup-quote").find(".bm-popup-content-wrapper")}}},this._quoteHandler=null,this._fetchRequest=null,this._router=null,this._state=null,this._initialPath=t.location.href,this.$elemDynamicContent=this.$elem.find("@bm-dynamic-content"),this.$elemQuoteWrapper=this.$elem.find("@bm-popup-quote-wrapper"),this.$elemButtonClose=this.$elem.find("@bm-popup-quote-button-close"),this.$elemButtonBack=this.$elem.find("@bm-popup-quote-button-back"),this._setConfig(e),this._initDynamicContent(),this._bindEvents(),this._updateLayout()},_setConfig:function(t){i.tools.isUndefined(t)||i.tools.isUndefined(t.uuid)||(this._config.uuid=t.uuid)},_bindEvents:function(){var t=this;this.$elemButtonBack.on(i.helper.event.clickName(),function(e){t._onButtonBackClick()}),this.$elemButtonClose.on(i.helper.event.clickName(),function(e){t._onButtonCloseClick()})},_onButtonBackClick:function(){this._notify("button-back-click")},_onButtonCloseClick:function(){this.hide()},_initDynamicContent:function(){this._dynamicContent=new s({element:this.$elemDynamicContent})},_initQuote:function(){this._isUUIDPresent()&&this.fetch()},fetch:function(){var t=this;this._fetchRequest=n.ajax({url:"/a/4/m/"+this._getUUID()+".json?embed_document=true",dataType:"json",type:"get",success:function(e){setTimeout(function(){t._onFetchSuccess(e)},300)},error:function(){t._onFetchError()}})},_onFetchSuccess:function(t){var e=this;t.marker&&(t=t.marker),i.tools.mixin(this._config,t),this._quoteHandler=new a(this._config),this._quoteHandler.on("like",function(t){e._notify("like",t)}),this._quoteHandler.on("unlike",function(t){e._notify("unlike",t)}),this._quoteHandler.on("authentication-successful",function(t){e.show()}),this.$elemQuoteWrapper.append(this._quoteHandler.getElement()),this._dynamicContent.showStep("content"),this._notify("fetched",t)},_onFetchError:function(){var t=this;setTimeout(function(){t.hide()},500)},show:function(t){i.tools.isNull(this._quoteHandler)?(this._dynamicContent.showStep("loading"),this._initQuote()):this._dynamicContent.showStep("content"),c.show.apply(this,arguments)},_pushConfigHistory:function(t){i.tools.isNull(this._state)||this._state.configHistory.push({uuid:t.uuid,login:t.login})},_showPopup:function(){c.show.apply(this,arguments)},_pushHistoryState:function(){i.tools.isNull(this._quoteHandler)||t.history.pushState(i.helper.history.getPopupQuoteState(i.user.getViewingUserLogin(),this._quoteHandler.getUuid()),null,this._quoteHandler.link())},_historyBack:function(){t.history.back()},hide:function(){!i.tools.isNull(this._fetchRequest)&&i.tools.isFunction(this._fetchRequest.abort)&&this._fetchRequest.abort(),c.hide.apply(this,arguments)},getQuote:function(){return this._quoteHandler},_updateLayout:function(){this._historyControls?this.$elemButtonBack.removeClass("m-hidden"):this.$elemButtonBack.addClass("m-hidden")},_isUUIDPresent:function(){return this._config&&i.tools.isString(this._config.uuid)},_getUUID:function(){return this._config.uuid},_getTemplateName:function(){return d},destroy:function(){i.tools.isNull(this._quoteHandler)||this._quoteHandler.destroy(),c.destroy.apply(this,arguments)}}),e(u)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o,r){"use strict";o.define("modulePopupUploadInit",["UploadPopup"],function(i,o){var s=["/gifts","/mts_by","/beeline","/megafon"];if(!s.includes(t.location.pathname)){var a=new o;n("@button-upload-book").click(function(t){t.preventDefault(),a.show()});var u=!1,l=function(t){var e=void 0;if(r.tools.isPresent(t.dataTransfer)&&r.tools.isPresent(t.dataTransfer.types)){if(r.tools.isString(t.dataTransfer.types))return-1!==t.dataTransfer.types.indexOf("Files");if(r.tools.isArray(t.dataTransfer.types)){if(t.dataTransfer.types.indexOf)return-1!==t.dataTransfer.types.indexOf("Files");try{return e=Array.prototype.slice.call(t.dataTransfer.types),-1!==e.indexOf("Files")}catch(n){}}}};e.addEventListener("dragover",function(t){!u&&l(t)&&(a.show(),u=!0)},!1);var c=function(t){u=!1};e.addEventListener("dragleave",c,!1),e.addEventListener("dragend",c,!1),e.addEventListener("drop",c,!1);var d=t.location.hash;"#upload_internet"!==d&&"#upload"!==d||a.show(),i()}})}(this,this.document,this.jQuery,this.radio,this.modules,this.BM),function(t,e,n,i,o){"use strict";e.define("UploadPopup",["extend","PopupBase","tools","documentMain","ampersandState","loginWindow","RouterWeb"],function(e,r,s,a,u,l,c,d){var h=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,e.apply(this,arguments))}return _inherits(r,e),r.prototype.initialize=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];e.prototype.initialize.call(this,{useTemplate:!0,rootClassName:["m-version-2","bm-popup-upload-root"],showButtonClose:!0}),this._loginWindow=null,this._documentHandler=null,this._stopPropagation=!1,this._currentTab="upload",this._radioButtonEventBound=!1,this.dragging=!1,this.loaded=!1,this.$overlay=this.$elem.find("@overlay"),this.$popup=this.$elem.find("@bm-popup-upload"),this.$form=this.$elem.find("@bm-popup-upload-from"),this.$formError=this.$elem.find("@bm-popup-upload-form-error"),this.$tabs=this.$elem.find("@bm-popup-upload-tab"),this.$pages=this.$elem.find("@bm-popup-upload-page"),this.$buttonFromInternet=this.$elem.find("@bm-upload-popup-button-from-internet"),this.$inputFromInternet=this.$elem.find("@bm-upload-popup-input-form-internet input"),this.$uploadLoader=this.$elem.find("@bm-popup-upload-loader"),this._setConfig(t),this._initLoginWindow(),this._bindEvents()},r.prototype._changeTab=function(t){this._currentTab=t,this.$tabs.removeClass("is-active"),this.$tabs.filter("[data-target="+t+"]").addClass("is-active"),this.$pages.addClass("hidden"),this.$pages.filter("[data-target="+t+"]").removeClass("hidden"),"internet"===t&&this.$inputFromInternet.focus()},r.prototype._bindEvents=function(){var e=this,i=this;this.$tabs.on("click",function(){i._changeTab(n(this).data("target"))}),n("#pickfiles").on("click",function(t){t.preventDefault()});var o=function(){
return i.$inputFromInternet.val()},r=function(){return d.validateURL(o())},s=function(){return""===o()};this.$inputFromInternet.on("input",function(t){r()?e.$buttonFromInternet.removeClass("disabled"):e.$buttonFromInternet.addClass("disabled"),r()||s()?e.$inputFromInternet.removeClass("invalid"):e.$inputFromInternet.addClass("invalid")}),this.$inputFromInternet.keypress(function(t){return 13==t.which?!1:void 0}),this.$form.on("submit",function(i){i.preventDefault();var o=n("[data-uploader]").data("uploader");n.ajax({method:"POST",url:e.$form.attr("action"),data:e.$form.serialize(),success:function(){t.location.href=o.changed}})})},r.prototype._setConfig=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];i.tools.mixin(this._config,t)},r.prototype._initLoginWindow=function(){this.loginWindow=new c},r.prototype.show=function(){return i.user.isUserPresent()||(t.location.href="/#login"),this.openModal(arguments)},r.prototype.openModal=function(t,n){e.prototype.show.call(this,n),this.loaded||(this.loaded=!0,this._setupUploader(),this._setupRadioButtons())},r.prototype._getTemplateName=function(){return"bm-popup-upload-template"},r.prototype._radioHandler=function(t){t.toggleClass("switched");var e=t.find("input");e[0].checked=!t.hasClass("switched")},r.prototype._setupRadioButtons=function(){var t=(n("@bm-upload-popup-readability"),n("@bm-upload-popup-visibility"),this);this._radioButtonEventBound||n("@bm-upload-popup-readability, @bm-upload-popup-visibility").find(".bm-radio-controls-wrapper, .bm-radio-label").click(function(e){e.preventDefault(),e.stopPropagation(),t._radioButtonEventBound=!0,t._radioHandler(n(this).parent())})},r.prototype._setupUploader=function(){var e=this;(d.queryParams().link||"#upload_internet"===t.location.hash||i.tools.client.isMobile())&&this._changeTab("internet"),this.$inputFromInternet.trigger("input"),n("[data-uploader]").length>0&&!function(){var r=n("[data-uploader]").data("uploader"),s=n("@bm-popup-upload-title"),a=n("@bm-popup-upload-delimeter"),u=n("@bm-popup-upload-droptarget"),l=function(t){e.dragging=!1,u.removeClass("visible")};o("bookmate-popup-hide").subscribe(l),e.$overlay.on({dragenter:l}),e.$popup.on({dragenter:function(t){t.stopPropagation(),e.dragging||(e.dragging=!0,u.addClass("visible"))},drop:l,dragover:function(){}});var c={runtimes:"html5,html4,flash",browse_button:"pickfiles",max_file_size:"100mb",container:"pickfiles_contaiter",url:r.url,file_data_name:"import[file]",flash_swf_url:"/flash/plupload.flash.swf",filters:[{title:"Book files",extensions:"epub,fb2,zip"}]};i.tools.client.isMobile()?(s.hide(),a.hide(),e.$tabs.hide()):c.drop_element="bm-popup-upload-drop-target";var d=new plupload.Uploader(c);d.init(),d.bind("BeforeUpload",function(t,i){d.settings.multipart_params={is_public:n("#is_public").is(":checked"),lc_public:n("#lc_public").is(":checked")},d.settings.multipart_params[r.session_key]=r.session,e.$formError.addClass("hidden")}),d.bind("FileUploaded",function(t,e){}),d.bind("UploadProgress",function(t,e){}),d.bind("FilesAdded",function(t,n){for(console.warn("FilesAdded");t.files.length>5;)t.removeFile(t.files[0]);e.$uploadLoader.removeClass("hidden"),e.$uploadLoader.addClass("animated"),e.$uploadLoader.find("div").removeClass("hidden"),d.start(),t.refresh()}),d.bind("StateChanged",function(n){n.files.length>0&&n.total.failed>0?e.$uploadLoader.addClass("hidden"):n.files.length===n.total.uploaded+n.total.failed&&(t.location.href=r.changed)}),d.bind("Error",function(t,n){var i=r.errors,o=n.message;(i[n.code]||i[n.status])&&(o=i[n.code]||i[n.status]),"File size error."==o&&(o="File too large. Please make sure the file is less than 100MB in size."),console.log(n),e.$formError.html(o),e.$formError.removeClass("hidden")})}()},r}(s);e(h)})}(this,this.modules,this.jQuery,this.BM,this.radio),function(t,e,n,i){e.define("popupRecurrentPresent",["PopupBase","extend","tools"],function(e,n,i,o){var r=i(n),s=r,a=r.superclass;o.mixin(s.prototype,{initialize:function(){a.initialize.apply(this,arguments),this._elementButtonOK=this._element.find("@button-close"),this._bindEvents()},_bindEvents:function(){this._elementButtonOK.on("click",function(){t.location.href="/library"}.bind(this))},_getTemplateName:function(){return"bookmate-popup-recurrent-present-template"}}),e(r)})}(this,this.modules,this.jQuery,this.radio),function(t,e,n,i,o){e.define("PopupSubscriptionState",["extend","PopupBase","PopupPaywall","PaymentForm","Event"],function(t,e,n,r,s,a){var u=e(n),l=u,c=l.superclass;i.tools.mixin(l.prototype,{initialize:function(t){c.initialize.call(this,{useTemplate:!0,rootClassName:["m-version-2","bm-popup-subscription-state"]}),this._config={},this._popupPaywall=null,this.$elemDynamicContent=this.$elem.find("@bm-dynamic-content"),this.$elemHeader=this.$elem.find("@bm-popup-subscription-state-header"),this.$elemText=this.$elem.find("@bm-popup-subscription-state-text"),this.$elemTill=this.$elem.find("@bm-popup-subscription-state-till"),this.$elemSource=this.$elem.find("@bm-popup-subscription-state-source"),this.$elemStop=this.$elem.find("@bm-popup-subscription-state-stop-recurrent"),this.$elemStopText=this.$elem.find("@bm-popup-subscription-state-stop-recurrent-text"),this.$elemExtend=this.$elem.find("@bm-popup-subscription-state-extend"),this.$elemExtendPremium=this.$elem.find("@bm-popup-subscription-state-extend-premium"),this.$elemHowToStop=this.$elem.find("@bm-popup-subscription-state-how-to-stop-ios-recurrent"),this._setConfig(t),this._bindEvents(),this._initPopupPaywall(),this._update()},_setConfig:function(t){i.tools.isPresent(this._config)&&i.tools.isObject(this._config)&&(this._config=i.tools.mixin(this._config,t))},_bindEvents:function(){this.$elemExtend.on(i.helper.event.clickName(),function(t){this._onRenewClick(t)}.bind(this)),this.$elemExtendPremium.on(i.helper.event.clickName(),function(){this._onRenewPremiumClick(event)}.bind(this)),this.$elemStop.on(i.helper.event.clickName(),function(t){this._onStopClick(t)}.bind(this))},_initPopupPaywall:function(){i.tools.isNull(this._popupPaywall)&&(this._popupPaywall=new r)},_onRenewClick:function(t){"default"===this._config.kind&&this._config.is_booster!==!0?this._skipDefaultRenewKindSelect()?this._popupPaywall.show({step:r.Step.PAYMENT_FORM,callback:function(){this._popupPaywall.showPaymentForm(s.SubscriptionType.DEFAULT)}.bind(this)}):this._popupPaywall.show({step:r.Step.ABOUT_BOOSTER}):("premium"===this._config.kind||"default"===this._config.kind&&this._config.is_booster===!0)&&this._popupPaywall.show({step:r.Step.PAYMENT_FORM,callback:function(){this._popupPaywall.showPaymentForm(s.SubscriptionType.PREMIUM)}.bind(this)})},_onRenewPremiumClick:function(t){this._popupPaywall.show({step:r.Step.ABOUT_PREMIUM})},_getSubscriptionTypeToShow:function(){if(i.tools.isPresent(this._config)&&i.tools.isPresent(this._config.kind)){if("default"===this._config.kind)return this._config.is_booster===!0?s.SubscriptionType.PREMIUM:s.SubscriptionType.BOOSTER;if("premium"===this._config.kind)return s.SubscriptionType.PREMIUM}return null},_onStopClick:function(t){this._stopRecurrent()},_stopRecurrent:function(){i.tools.isNull(this._config.recurrent)||(this.$elemStop.addClass("m-wait"),i.helper.subscription.recurrent.stop({type:this._config.recurrent.type,success:function(t){this.$elemExtend.addClass("m-wait"),this.$elemExtendPremium.addClass("m-wait"),this.$elem.attr("data-button-action","renew"),i.helper.client.triggerRerender(),this.$elemStop.removeClass("m-wait"),this.$elemExtend.removeClass("m-wait"),this.$elemExtendPremium.removeClass("m-wait"),this._config.recurrent=null,this._update(),radio("recurrent-subscription-canceled").broadcast(new a)}.bind(this),error:function(){this.$elemStop.removeClass("m-wait")}.bind(this)}))},_update:function(){if(i.tools.isPresent(this._config)){i.tools.isPresent(this._config.kind)&&("premium"===this._config.kind?(this.$elem.addClass("m-premium"),this.$elem.removeClass("m-default")):"default"===this._config.kind&&(this.$elem.addClass("m-default"),this.$elem.removeClass("m-premium")),this.$elemHeader.html(this.$elemHeader.data("text-"+this._config.kind)),this.$elemText.html(this.$elemText.data("text-"+this._config.kind)));var t=this._config&&this._config.recurrent&&"ulmartrecurrent"===this._config.recurrent.type?"ulmart":"default";this.$elemStopText.html(this.$elemStopText.data("text-"+t)),i.tools.isPresent(this._config.expires_at)&&(o.locale(i.user.getLocale()),this.$elemTill.html(o(1e3*this._config.expires_at).format("D MMMM YYYY"))),!i.tools.isNull(this._config.recurrent)&&this._config.recurrent.active===!0&&i.tools.isPresent(this._config.recurrent.human_name)?this.$elemSource.html(this._config.recurrent.human_name):i.tools.isPresent(this._config.human_name)&&this.$elemSource.html(this._config.human_name),i.tools.isPresent(this._config.type)&&this._config.type===i.helper.subscription.Type.APP_STORE||!i.tools.isNull(this._config.recurrent)&&this._config.recurrent.active===!0&&"inapp"===this._config.recurrent.type?this.$elem.attr("data-button-action","how-to-stop-ios-recurrent"):i.tools.isPresent(this._config.type)&&this._config.type===i.helper.subscription.Type.GOOGLE_PLAY||!i.tools.isNull(this._config.recurrent)&&this._config.recurrent.active===!0&&"androidinapp"===this._config.recurrent.type?this.$elem.attr("data-button-action","how-to-stop-android-recurrent"):i.tools.isObject(this._config.recurrent)?this._config.recurrent.active===!0&&this.$elem.attr("data-button-action","stop-recurrent"):"default"===this._config.kind?i.helper.subscription.currentUser.recurrentExists()?this.$elem.removeAttr("data-button-action"):this.$elem.attr("data-button-action","renew"):"premium"===this._config.kind&&this.$elem.attr("data-button-action","renew-premium"),i.tools.isPresent(this._config.recurrent)}},setSkipDefaultRenewKindSelect:function(t){this._config.skipDefaultRenewKindSelect=!!t},_skipDefaultRenewKindSelect:function(){return this._config.skipDefaultRenewKindSelect===!0},show:function(){this._update(),c.show.apply(this,arguments)},_getTemplateName:function(){return"bm-popup-subscription-state-template"}}),t(u)})}(this,this.modules,this.jQuery,this.BM,this.moment,this.radio),function(t,e,n){"use strict";n.require(["promoBanner"],function(t){var n=t.superclass;e.widget("custom.bigbook2015Banner",n,{_init:function(){n.prototype._init.apply(this,arguments),DIMixpanel.track("Big Book Banner Shown")},_getBannerHidingTime:function(){return 2016e5},_onBannerClick:function(t){t.preventDefault(),DIMixpanel.track("Big Book Banner Pressed"),setTimeout(function(){this._openBannerLink()}.bind(this),300)}}),e(".bm-promo-banner[data-event-name=bigbook2015]").bigbook2015Banner()})}(this,this.jQuery,this.modules),function(t,e,n,i,o){"use strict";n.require(["promoBanner","blockCollectEmail"],function(t,n){var r=t.superclass;t.Event;e.widget("custom.bookmateBannerCollectEmail",r,{_init:function(){r.prototype._init.apply(this,arguments),this._initBlockCollectEmail(),o.track("Scoop Email Banner Shown")},_initBlockCollectEmail:function(){var t=this;n.init(this.element,{stepMode:n.StepMode.ATTRIBUTE}),i("collect-email-success").subscribe(function(){o.track("Email Sent Successful"),t.hide()})},_showBanner:function(){r.prototype._showBanner.apply(this,arguments),this._showAnimation()},_showAnimation:function(){this.element.attr("banner-animation","true")},_getBannerHidingTime:function(){return 144e4},_getEventName:function(){return"collect_email"}}),e(".bm-promo-banner[data-event-name=collect-email]").bookmateBannerCollectEmail()})}(this,this.jQuery,this.modules,this.radio,this.DIMixpanel),function(t,e,n,i,o,r){"use strict";n.require(["promoBanner","blockDownloadSms"],function(n,s){var a=n.superclass;n.Event;e.widget("custom.bookmateBannerDownloadSms",a,{_init:function(){a.prototype._init.apply(this,arguments),this._initBlockDownloadSms(),o.track("Get the App Banner Shown")},_initBlockDownloadSms:function(){s.init(this.element,{stepMode:s.StepMode.ATTRIBUTE}),i("download-sms-success").subscribe(function(){o.track("Get the App Successful",{context:r.config.mainConfig.scriptTemplate}),t.docCookies.setItem("promo_banner_download_sms_closed","true",1439856e4,"/")}),i("download-sms-error").subscribe(function(){o.track("Get the App Failed")})},_showBanner:function(){a.prototype._showBanner.apply(this,arguments),this._showAnimation()},_showAnimation:function(){this.element.attr("banner-animation","true")},_getBannerHidingTime:function(){return 42e4},_getEventName:function(){return"download_sms"}}),e(".bm-promo-banner[data-event-name=download-sms]").bookmateBannerDownloadSms()})}(this,this.jQuery,this.modules,this.radio,this.DIMixpanel,this.BM),function(t,e,n,i){"use strict";n.require(["promoBanner"],function(n){var o=n.superclass;e.widget("custom.giftsBanner",o,{_init:function(){o.prototype._init.apply(this,arguments),DIMixpanel.track("Banner Shown",{locale:i.user.getLocale(),banner:"gifts"}),e(this.element).on("click",".bm-promo-banner-link",function(n){n.preventDefault();var o=e(n.target).attr("href");this._setCookie(),DIMixpanel.track("Banner Clicked",{locale:i.user.getLocale(),banner:"gifts"}),setTimeout(function(){t.location.href=o},300)}.bind(this))},_getBannerHidingTime:function(){return 12096e5}}),e(".bm-promo-banner[data-event-name=gifts]").giftsBanner()})}(this,this.jQuery,this.modules,this.BM),function(t,e,n,i){"use strict";n.require(["promoBanner"],function(n){var o=n.superclass;e.widget("custom.iwillreadBanner",o,{_init:function(){o.prototype._init.apply(this,arguments),DIMixpanel.track("Banner Shown",{locale:i.user.getLocale(),banner:"iwillread"}),e(this.element).on("click",".bm-promo-banner-link",function(n){n.preventDefault();var o=e(n.target).attr("href");this._setCookie(),DIMixpanel.track("Banner Clicked",{locale:i.user.getLocale(),banner:"iwillread"}),setTimeout(function(){t.location.href=o},300)}.bind(this))},_getBannerHidingTime:function(){return 12096e5}}),e(".bm-promo-banner[data-event-name=iwillread]").iwillreadBanner()})}(this,this.jQuery,this.modules,this.BM),function(t,e,n){"use strict";n.define("promoBanner",[],function(n){var i={BIGBOOK_2015:"bigbook2015"},o=0;e.widget("custom.bookmatePromoBanner",{_init:function(){this._elementWindow=e(t),this._responsive=!0,this._imageSize=null,this._eventNamespace="eventNamespace"+ ++o+(new Date).getTime(),this._elementButtonClose=this.element.find("@promo-banner-button-close"),this._elementImage=this.element.find("@promo-banner-image"),this._parseConfig(),this._bindEvents(),this._responsive&&this._calculateBannerSize(),setTimeout(function(){this._showBanner()}.bind(this),750)},_parseConfig:function(){this.element.attr("data-responsive")&&(this._responsive="true"===this.element.attr("data-responsive"))},_bindEvents:function(){this._elementButtonClose.on("click",this._onElementButtonCloseClick.bind(this)),this._elementImage.on("click",this._onBannerClick.bind(this)),this._responsive&&this._elementWindow.on("resize."+this._eventNamespace,this._onWindowResize.bind(this))},_onElementButtonCloseClick:function(t){t.preventDefault(),t.stopPropagation(),this._trackCloseEvent(),this.hide()},_trackCloseEvent:function(){"referral"===e(this.element).data("event-name")&&DIMixpanel.track("Referral Banner Closed"),"iwillread"===e(this.element).data("event-name")&&DIMixpanel.track("Banner Closed",{locale:BM.user.getLocale(),banner:"iwillread"}),"gifts"===e(this.element).data("event-name")&&DIMixpanel.track("Banner Closed",{locale:BM.user.getLocale(),banner:"gifts"}),"results2015"===e(this.element).data("event-name")&&DIMixpanel.track("Banner Closed",{locale:BM.user.getLocale(),banner:"results2015"})},_onBannerClick:function(t){this._openBannerLink()},_openBannerLink:function(){t.location.href=this._elementImage.attr("href")},_onWindowResize:function(){this._calculateBannerSize()},_calculateBannerSize:function(){var t=this._elementWindow.width(),e=this._elementImage.attr("data-image-width"),n=this._elementImage.attr("data-image-height"),i=Math.floor(n*(t/e));e>=t?this.element.height(i):this.element.height("")},_showBanner:function(){"ulmart_three_months"===this._getEventName()&&t.DIMixpanel.track("Ulmart Banner Shown"),this.element.removeAttr("collapsed")},hide:function(){this._setCookie(),this._collapse()},_fadeOut:function(){this.element.attr("transparent","true")},_collapse:function(){var t=this;this.element.transitionEnd(function(){t.element.unbindTransitionEnd(),t.element.attr("hidden","hidden"),t._unbindEvents()}),this.element.attr("collapsed","true")},_setCookie:function(){t.docCookies.setItem("promo_banner_"+this._getEventName()+"_closed","true",this._getBannerHidingTime(),"/")},_getEventName:function(){return this.element.attr("data-event-name")},_getBannerHidingTime:function(){return 864e5},_unbindEvents:function(){this._elementWindow.off("resize."+this._eventNamespace)}}),n({superclass:e.custom.bookmatePromoBanner,Event:i})})}(this,this.jQuery,this.modules),function(t,e,n,i){"use strict";n.require(["promoBanner","loginWindow"],function(n,o){var r=n.superclass;e.widget("custom.referralBanner",r,{_init:function(){r.prototype._init.apply(this,arguments);var n=i.tools.storage.getItem("bm-referral-banner-page-count")||0;return n>=2?(this._setCookie(),void i.tools.storage.removeItem("bm-referral-banner-page-count")):(i.tools.storage.setItem("bm-referral-banner-page-count",++n),1===n&&DIMixpanel.track("Referral Banner Shown"),this.loginWindow=new o({context:"referral",preventDefaultLoginBehavior:!0}),this.loginWindow.on("authenticationSuccessful",function(e){i.config.mainConfig.userInfo&&i.config.mainConfig.userInfo.login&&(t.location.href="/"+i.config.mainConfig.userInfo.login+"/profile/edit#referral")}.bind(this)),void e(this.element).on("click",".bm-promo-banner-link",function(n){n.preventDefault();var o=e(n.target).attr("href");return i.user.present()?(this._setCookie(),DIMixpanel.track("Referral Banner Clicked"),void setTimeout(function(){t.location.href="http://"+t.location.host+o},300)):void this.loginWindow.showWindow("inital")}.bind(this)))},_getBannerHidingTime:function(){return 12096e5}}),e(".bm-promo-banner[data-event-name=referral]").referralBanner()})}(this,this.jQuery,this.modules,this.BM),function(t,e,n,i){"use strict";n.require(["promoBanner"],function(n){var o=n.superclass;e.widget("custom.results2015Banner",o,{_init:function(){o.prototype._init.apply(this,arguments),DIMixpanel.track("Banner Shown",{locale:i.user.getLocale(),banner:"results2015"}),e(this.element).on("click",".bm-promo-banner-link",function(n){n.preventDefault();var o=e(n.target).attr("href");this._setCookie(),DIMixpanel.track("Banner Clicked",{locale:i.user.getLocale(),banner:"results2015"}),setTimeout(function(){t.location.href=o},300)}.bind(this))},_getBannerHidingTime:function(){return 12096e5}}),e(".bm-promo-banner[data-event-name=results2015]").results2015Banner()})}(this,this.jQuery,this.modules,this.BM),function(t,e,n){"use strict";n.require(["promoBanner"],function(t){var n=t.superclass;t.Event;e.widget("custom.singa500SuccessBanner",n,{_init:function(){n.prototype._init.apply(this,arguments)},_getBannerHidingTime:function(){return 2016e5},_onBannerClick:function(t){t.preventDefault(),setTimeout(function(){this._openBannerLink()}.bind(this),100)}}),e(".bm-promo-banner[data-event-name=singa_500_success]").singa500SuccessBanner()})}(this,this.jQuery,this.modules),function(t,e,n,i){"use strict";n.require(["promoBanner"],function(t){var n=t.superclass;t.Event;e.widget("custom.ulmartThreeMonthsBanner",n,{_init:function(){n.prototype._init.apply(this,arguments),e(this.element).on("click","a",function(t){i.track("Ulmart Banner Pressed")})},_getBannerHidingTime:function(){return 2016e5}}),e(".bm-promo-banner[data-event-name=ulmart_three_months]").ulmartThreeMonthsBanner()})}(this,this.jQuery,this.modules,this.DIMixpanel),function(t,e,n,i){e.define("moduleQuoteGroup",["extend","baseView","moduleQuote","Pluralizer","BookBlockListItem"],function(t,e,o,r,s,a){var u=e(o),l=u,c=l.superclass,d="bm-quote-group-template";i.tools.mixin(l.prototype,{initialize:function(t){c.initialize.apply(this,arguments),this._p=1,this._pp=20,this._config={},this._quoteHandlers=[],this._bookHandler=null,this.$elemItemsWrapper=this.$elem.find("@bm-quote-group-items-wrapper"),this.$elemButtonMore=this.$elem.find("@bm-quote-group-button-more"),this.$elemBookWrapper=this.$elem.find("@bm-quote-group-book-wrapper"),this._parseConfig(),this._setConfig(t),this._calculatePaginationPosition(),this._renderQuotes(),this._iniBookBlockListItem(),this._setupEvents(),this._update()},_setupEvents:function(){var t=this;this.$elemButtonMore.on("click",function(){t._onButtonMoreClick()})},_onButtonMoreClick:function(){this._fetchNextQuotes()},_setConfig:function(t){i.tools.isObject(t)&&i.tools.mixin(this._config,t)},_getTemplateName:function(){return d},_fetchNextQuotes:function(){var t=this;this.$elemButtonMore.addClass("m-wait"),n.ajax({url:"/a/4/u/"+this._getQuoteCreatorLogin()+"/d/"+this._getDocumentUuid()+"/m.json",dataType:"json",type:"get",data:{p:this._p,pp:this._pp},success:function(e){setTimeout(function(){t._onQuotesFetchSuccess(e)},300)},error:function(){t._onQuotesFetchError()}})},_onQuotesFetchSuccess:function(t){var e=this;this._assertConfigIsProper(),1===this._p&&(t=t.slice(this._config.objects.length)),this._p+=1,t.forEach(function(t){e._config.objects.push(t),e._renderQuote(t)}),this._areMoreObjectsToLoadAvailable()||this.$elemButtonMore.addClass("m-hidden"),this._updateButtonMore(),this.$elemButtonMore.removeClass("m-wait")},_onQuotesFetchError:function(){this.$elemButtonMore.removeClass("m-wait")},_getDocumentUuid:function(){return!i.tools.isUndefined(this._config.objects)&&this._config.objects.length>0?this._config.objects[0].document_uuid:void 0},_getDocumentData:function(){return!i.tools.isUndefined(this._config.objects)&&this._config.objects.length>0?this._config.objects[0].document:void 0},_getQuoteCreatorLogin:function(){return!i.tools.isUndefined(this._config.objects)&&this._config.objects.length>0?this._config.objects[0].user.login:void 0},_getQuoteUuid:function(){return!i.tools.isUndefined(this._config.objects)&&this._config.objects.length>0?this._config.objects[0].uuid:void 0},_calculatePaginationPosition:function(){this._assertConfigIsProper(),this._config.count>0&&(this._p=Math.max(Math.floor(this._config.objects.length/this._pp),1))},_renderQuotes:function(){var t=this;i.tools.isNumber(this._config.count)&&this._config.count>0&&this._config.objects.forEach(function(e){t._renderQuote(e)})},_renderQuote:function(t){t=i.tools.mixin(t,{context:this._config.context,refetch:!1,components:{bookBlock:!1,likes:!1,link:!0,sharing:!1,likeSimple:!0},listItem:{refetch:!1}});var e=new r(t);this._quoteHandlers.push(e),this.$elemItemsWrapper.append(e.getElement())},_update:function(){i.tools.isUndefined(this._config)||(this._areMoreObjectsToLoadAvailable()?(this.$elem.addClass("m-button-more-visible"),this._updateButtonMore()):this.$elem.removeClass("m-button-more-visible"))},_updateButtonMore:function(){var t=Math.min(this._getCountOfNotLoadedObjects(),this._pp);s.locale=i.user.getLocale();var e=this.$elemButtonMore.data("text").replace("%{count}",t).replace("%{word}",this.$elemButtonMore.data(s.pluralize(t)));this.$elemButtonMore.html(e)},_getCountOfNotLoadedObjects:function(){return this._isConfigProper()?this._config.count-this._config.objects.length:null},_areMoreObjectsToLoadAvailable:function(){var t=this._getCountOfNotLoadedObjects();return i.tools.isNumber(t)&&t>0},_isConfigProper:function(){return i.tools.isNumber(this._config.count)&&i.tools.isArray(this._config.objects)},_assertConfigIsProper:function(){this._config||(this._config={}),i.tools.isNumber(this._config.count)||(this._config.count=0),i.tools.isArray(this._config.objects)||(this._config.objects=[])},_iniBookBlockListItem:function(){var t=this._getDocumentData();i.tools.mixin(t,{components:{readers:!1,owner:!1},refetch:!0,mixpanel_ctx:"quote",discovery_id:this._getQuoteUuid()}),this._bookHandler=new a(t),this.$elemBookWrapper.append(this._bookHandler.getElement())}}),t(u)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o,r,s){e.define("moduleQuote",["extend","baseView","Event","BookBlockListItem","moduleBookReader","ButtonSocialShare","loginWindow","RouterWeb","loginWindow","hyphenizer","DropDown"],function(a,u,l,c,d,h,p,f,m,g,b,_){var y=u(l),v=y,w=v.superclass,k="bm-quote-template";i.tools.mixin(v.prototype,{initialize:function(t){w.initialize.apply(this,arguments),this.$elem&&(this._config={openDocumentPopup:!0,components:{bookBlock:!0,like:!0,link:!0,sharing:!0,likeSimple:!1},listItem:{refetch:!0},readButton:{dropdownOptions:{}}},this._loginWindowHandler=null,this._bookHandler=null,this._creatorHandler=null,this._popupQuote=null,this._socialCountersHandler=null,this._likeRequestActive=!1,this._likedOnce=!1,this._likersFetched=!1,this.$elemBlockCreator=this.$elem.find("@bm-quote-block-creator"),this.$elemBlockContent=this.$elem.find("@bm-quote-block-content"),this.$elemBookWrapper=this.$elem.find("@bm-quote-book-wrapper"),this.$elemLikeButton=this.$elem.find("@bm-quote-like-button"),this.$elemLikeHeart=this.$elem.find("@bm-quote-like-heart"),this.$elemLikeHeartSimple=this.$elem.find("@bm-quote-block-like-simple"),this.$elemLikesCountWrapper=this.$elem.find("@bm-quote-likes-count-wrapper"),this.$elemLikesCount=this.$elem.find("@bm-quote-likes-count"),this.$elemLikers=this.$elem.find("@bm-quote-likes-likers"),this.$elemLikersWrapper=this.$elem.find("@bm-quote-likes-likers-wrapper"),this.$elemCreatedAt=this.$elem.find("@bm-quote-created-at"),this.$elemQuoteContent=this.$elem.find("@bm-quote-content"),this.$elemQuoteComment=this.$elem.find("@bm-quote-comment"),this.$elemCreatorWrapper=this.$elem.find("@bm-quote-creator-wrapper"),this.$elemCreatorName=this.$elem.find("@bm-quote-creator-name"),this.$elemControls=this.$elem.find("@bm-quote-controls"),this.$elemDropdown=this.$elem.find("@bm-quote-controls-dropdown"),this.$elemButtonOptions=this.$elem.find("@bm-quote-button-options"),this.$elemRemove=this.$elem.find("@bm-quote-control-remove"),this._callbacks={},this._parseConfig(),this._setConfig(t),this._initQuoteCreator(),this._initBookBlockListItem(),this._initButtonShare(),this._initDropdownControls(),this._assertConfigStructure(),this._setupEvents(),this._updateLikers(),this._update(),this._isQuoteLiked()&&(this._likedOnce=!0))},_setupEvents:function(){var t=this,e=i.helper.event.clickName();this.$elemLikeButton.on(e,function(e){t._onLikeButtonClick(e)}),this.$elemBlockContent.on(e,function(e){t._onQuoteContentClick(e)}),this.$elemLikeHeartSimple.on(e,function(e){t._onLikeHeartSimpleClick(e)}),this.$elemRemove.on(e,this._remove.bind(this)),this._callbacks.bmQuoteLikeGlobal=function(e,n){t._onQuoteLikeGlobal.apply(t,arguments)}.bind(this),this._callbacks.bmQuoteUnlikeGlobal=function(e,n){t._onQuoteUnlikeGlobal.apply(t,arguments)}.bind(this),s("bm-quote-like").subscribe(this._callbacks.bmQuoteLikeGlobal),s("bm-quote-unlike").subscribe(this._callbacks.bmQuoteUnlikeGlobal)},_onLikeButtonClick:function(t){this._toggleLike()},_authorizateAndToggle:function(){i.tools.isNull(this._loginWindowHandler)?this._loginWindowHandler=new f:this._loginWindowHandler.off(),this._loginWindowHandler.on("authenticationSuccessful",function(){this._notify("authentication-successful"),this._toggleLike()}.bind(this)),this._loginWindowHandler.showWindow()},_onQuoteContentClick:function(t){var n=this;this._hasToDisplayLink()?i.helper.event.isMouseLeftClick(t)&&(i.tools.isNull(this._popupQuote)?e.require("modulePopupQuote",function(t){n._popupQuote=new t(i.tools.mixin(n._config,{element:null})),n._setupPopupQuoteEvents(),n._showPopupQuote()}):this._showPopupQuote(),t.preventDefault(),t.stopPropagation()):(t.preventDefault(),t.stopPropagation())},_onQuoteLikeGlobal:function(t,e){try{i.tools.isUndefined(t)||i.tools.isUndefined(e)||this._isEventRegistered(e)||(this.getUuid()===t.uuid&&this.likeByCurrentUser(t),this._registerEvent(e))}catch(n){}},_onQuoteUnlikeGlobal:function(t,e){try{i.tools.isUndefined(t)||i.tools.isUndefined(e)||this._isEventRegistered(e)||(this.getUuid()===t.uuid&&this.unlikeByCurrentUser(t),this._registerEvent(e))}catch(n){}},_showPopupQuote:function(){m.pushStatePopupQuote({uuid:this._config.uuid,login:this._config.user.login})},_getQuoteUrl:function(){return"/"+i.user.getViewingUserLogin()+"/quotes/"+this._config.uuid},_getWindowHistoryStateObject:function(){return{type:"m",data:{uuid:this._config.uuid}}},_setupPopupQuoteEvents:function(){var t=this;i.tools.isNull(this._popupQuote)||(this._popupQuote.on("like",function(e){t.likeByCurrentUser(e)}),this._popupQuote.on("unlike",function(e){t.unlikeByCurrentUser(e)}),this._popupQuote.on("hide",function(){t.onPopupQuoteHide()}))},onPopupQuoteHide:function(){i.helper.pageTitle.pop()},_onLikeHeartSimpleClick:function(t){t.preventDefault(),t.stopPropagation(),this._toggleLike()},_collapseListItem:function(){this.$elemBookWrapper.height(this.$elemBookWrapper.height()),this.$elemBookWrapper.get(0).offsetHeight=this.$elemBookWrapper.get(0).offsetHeight,this.$elemBookWrapper.addClass("m-collapsed")},_toggleLike:function(){return i.user.isUserPresent()?void(this._isLikesRequestActive()||(this._isQuoteLiked()?this.unlikeByCurrentUser():this.likeByCurrentUser())):void this._authorizateAndToggle()},likeByCurrentUser:function(t){var e=this;this._likeRequestActive=!0,this._config.likers.liked=!0,this._incrementLikes(),this._pushLikersWithCurrentUser(),this._update(),t?e._onQuoteLikeSuccess(t):n.ajax({url:"/a/4/m/"+this._config.uuid+"/likers.json",type:"post",dataType:"json",success:function(t){e._onQuoteLikeSuccess(t),e._notify("like",t);var n=new c;e._registerEvent(n),s("bm-quote-like").broadcast(i.tools.mixin(t,{uuid:e.getUuid()}),n),i.tools.isNull(e._popupQuote)||i.tools.isNull(e._popupQuote.getQuote())||e._popupQuote.getQuote().likeByCurrentUser(t),e._likeRequestActive=!1},error:function(){e._onQuoteLikeError(),e._likeRequestActive=!1}}),this._isQuoteLikedOnce()||(this._likedOnce=!0,r.track("Like Button Pressed",{context:"quote"}))},_getMixpanelContext:function(){var t;return i.tools.isUndefined(this._config.context)?(-1!==m.getInitialLocation().indexOf(i.user.getViewingUserLogin())&&(t="user"),t="quote"):t=this._config.context,t},_isLikesRequestActive:function(){return this._likeRequestActive===!0},_onQuoteLikeSuccess:function(t){this._config.likers.liked=t.liked,this._config.likers.count=t.count},_onQuoteLikeError:function(){},unlikeByCurrentUser:function(t){var e=this;this._likeRequestActive=!0,this._config.likers.liked=!1,this._decrementLikes(),this._popLikersWithCurrentUser(),this._update(),t?this._onQuoteUnlikeSuccess(t):n.ajax({url:"/a/4/m/"+this._config.uuid+"/likers.json",type:"delete",dataType:"json",success:function(t){e._onQuoteUnlikeSuccess(t),e._notify("unlike",t);var n=new c;e._registerEvent(n),s("bm-quote-unlike").broadcast(i.tools.mixin(t,{uuid:e.getUuid()}),n),e._likeRequestActive=!1},error:function(){e._onQuoteUnlikeError(),e._likeRequestActive=!1}})},_onQuoteUnlikeSuccess:function(t){this._config.likers.liked=t.liked,this._config.likers.count=t.count},_onQuoteUnlikeError:function(){},_incrementLikes:function(){var t=i.tools.isNumber(this._config.likers.count)?this._config.likers.count:0;this._config.likers.count=t+1},_decrementLikes:function(){var t=i.tools.isNumber(this._config.likers.count)?this._config.likers.count:0;this._config.likers.count=Math.max(0,t-1)},_pushLikersWithCurrentUser:function(){this._config.likers.likers.unshift(i.user.api4Attributes()),this._updateLikers()},_popLikersWithCurrentUser:function(){var t,e,n=this._config.likers.likers.length;for(t=0;n>t;++t)if(e=this._config.likers.likers[t],e.login===i.user.getLogin()){this._config.likers.likers.splice(t,1);break}this._updateLikers()},_assertConfigStructure:function(){i.tools.isUndefined(this._config)||i.tools.isUndefined(this._config.likers)&&(this._config.likers={count:0,liked:!1
})},_initDropdownControls:function(){this._isControlsAvailable()&&(this.$elemButtonOptions.addClass("active"),this._dropdownControls=new _({$button:this.$elemButtonOptions,$container:this.$elemDropdown}))},_initButtonShare:function(){this._buttonShare=new p({context:"quote"});var t=i.helper.link.full(i.helper.link.quote(this._config.uuid,this._config.user.uuid)),e=i.tools.isPresent(this._config.document)?this.$elem.data("marker-title-text").replace("%{book}",i.helper.text.sliceBookTitle(this._config.document.title,60)):null,n=i.helper.text.slice(this._config.content,150);this._buttonShare.setConfig({url:t,title:e,description:n,image:i.tools.isPresent(this._config.document)&&i.tools.isPresent(this._config.document.cover)?this._config.document.cover.url:void 0,twitter:{title:""+i.helper.text.slice(this._config.content,115)+"",description:n}}),this._buttonShare.getElement().appendTo(this.$elemControls)},_initQuoteCreator:function(){var t=this.$elemCreatorWrapper.find("@bm-book-reader"),e=t.length>0,n=this._getQuoteCreatorConfig();e&&(n.element=t),this._creatorHandler=new h(n),e||this.$elemCreatorWrapper.append(this._creatorHandler.getElement())},_getQuoteCreatorConfig:function(){return this._config.user},_initBookBlockListItem:function(){if(this._hasToDisplayBookBock()){var t=this.$elemBookWrapper.find("@bm-book-block-list-item"),e=t.length>0,n=this._getBookBlockListItemConfig();i.tools.mixin(n,{element:t,components:{readers:!1,owner:!1}}),e||(n.refetch=!0),this._bookHandler=new d(n),e||(this._bookHandler.wait(!0),this.$elemBookWrapper.append(this._bookHandler.getElement())),this._bookHandler.hasToBeRefetched()?this._setupBookBlockEvents():this._bookHandler.wait(!1)}},_hasToDisplayBookBock:function(){if(this._config.bookBlock===!1)return!1;if(i.tools.isPresent(this._config)&&i.tools.isPresent(this._config.document))if(i.tools.isPresent(this._config.document.lc)){if(m.getInitialLocation()===i.helper.link.libraryCard(i.user.getViewingUserLogin(),this._config.document.lc.uuid))return!1}else{if(m.getInitialLocation()===i.helper.link.book(this._config.document.book_uuid))return!1;if(m.getInitialLocation()===i.helper.link.libraryCard(i.user.getLogin(),this._config.document.book_uuid))return!1}return!0},_setupBookBlockEvents:function(){var t=this;this._bookHandler.on("fetch-success ready",function(){setTimeout(function(){t._onBookFetchSuccess()},300)}),this._bookHandler.on("fetch-error",function(){t._onBookFetchError()}),this._bookHandler.isRefetched()&&this._bookHandler.wait(!1)},_onBookFetchSuccess:function(){this._bookHandler&&this._bookHandler.wait(!1)},_onBookFetchError:function(){this._bookHandler&&(this._collapseListItem(),this._bookHandler.wait(!1))},_getBookBlockListItemConfig:function(){var t={};return this._config.document&&(t=this._config.document,t.refetch=!1),t=i.tools.mixin(t,this._config.listItem),t.openDocumentPopup=this._config.openDocumentPopup,t.context="quote",t.readButton=this._config.readButton,t.mixpanel_ctx="quote",t.discovery_id=this._config.uuid,t},_fetchLikers:function(){var t=this;(i.tools.isUndefined(this._config.likers)||i.tools.isUndefined(this._config.likers.likers)||i.tools.isNumber(this._config.likers.count)&&this._config.likers.count>0)&&(this.$elemLikers.addClass("m-loading"),n.ajax({url:"/a/4/m/"+this._config.uuid+"/likers.json",type:"get",dataType:"json",success:function(e){t._onLikersFetchSuccess(e)},error:function(){t._onLikersFetchError()}}))},_onLikersFetchSuccess:function(t){this._likersFetched=!0,this.$elemLikers.removeClass("m-loading"),i.tools.mixin(this._config.likers,t),this._updateLikers(),this._update()},_onLikersFetchError:function(){this._likersFetched=!0,this.$elemLikers.removeClass("m-loading")},_updateLikers:function(){var t,e=this;return i.tools.isUndefined(this._config.likers)||i.tools.isUndefined(this._config.likers.likers)?void(this._likersFetched===!1&&this._fetchLikers()):(this.$elemLikersWrapper.html(""),void this._config.likers.likers.forEach(function(n){t=new h(n),e.$elemLikersWrapper.append(t.getElement())}))},_update:function(){this._config&&(this._isQuoteLiked()?(this.$elemLikeButton.addClass("m-liked"),this.$elemLikeHeart.addClass("m-liked"),this.$elemLikeHeartSimple.addClass("m-liked")):(this.$elemLikeButton.removeClass("m-liked"),this.$elemLikeHeart.removeClass("m-liked"),this.$elemLikeHeartSimple.removeClass("m-liked")),this._config.likers&&(i.tools.isNull(this._getLikersCount())||(0===this._getLikersCount()?(this.$elemLikesCount.html(this.$elemLikesCount.data("i18n")),this.$elem.find(".bm-quote-likes-counter").addClass("hidden")):(this.$elemLikesCount.html(this._getLikersCount()),this.$elem.find(".bm-quote-likes-counter").removeClass("hidden")))),this._config.created_at&&(o.locale(i.user.getLocale()),this.$elemCreatedAt.html(o(1e3*this._config.created_at-9e4).fromNow(!0))),i.tools.isString(this._config.comment)&&this._config.comment.length>0?(this.$elemQuoteComment.html(this._config.comment),this.$elem.addClass("m-comment-visible")):this.$elem.removeClass("m-comment-visible"),this._config.content&&this.$elemQuoteContent.html(this._processContent()),this._config.user&&(this._config.user.name?this.$elemCreatorName.html(this._config.user.name):this.$elemCreatorName.html(this._config.user.login),this.$elemCreatorName.attr("href","/"+this._config.user.login)),i.tools.isUndefined(this._config.components)||(this._config.components.bookBlock===!1?this.$elem.addClass("m-book-disabled"):this.$elem.removeClass("m-book-disabled"),this._config.components.likes===!1?this.$elem.addClass("m-likes-disabled"):this.$elem.removeClass("m-likes-disabled"),this._config.components.likeSimple===!1?this.$elem.addClass("m-like-simple-disabled"):this.$elem.removeClass("m-like-simple-disabled"),this._config.components.link===!0?(this.$elem.addClass("m-content-clickable"),this.$elemBlockContent.attr("href","/"+this._config.user.login+"/quotes/"+this._config.uuid)):(this.$elem.removeClass("m-content-clickable"),this.$elemBlockContent.removeAttr("href")),this._config.components.sharing===!1?this.$elem.addClass("m-sharing-disabled"):this.$elem.removeClass("m-sharing-disabled")))},_processContent:function(){var t,e,n=25,o=[];return i.tools.isPresent(this._config.content)?(t=this._config.content,t.split(" ").forEach(function(t){if(t.length>n&&(t=b.hyphenize(t),-1===t.indexOf("&shy;")))for(e=n;e<t.length;)if(t=t.slice(0,e)+" "+t.slice(e),e+=n,e>1500)return;o.push(t)}),t=o.join(" "),t=t.replace(/\n/g,"<br>")):t="",t=t.replace(/&?nbsp;?/gi,"")},_parseConfig:function(){var t=this._parseDataConfig();i.tools.mixin(this._config,t)},_setConfig:function(t){t&&i.tools.mixin(this._config,t)},_hasToDisplayLink:function(){return!i.tools.isUndefined(this._config.components)&&this._config.components.link===!0},_isQuoteLiked:function(){return!i.tools.isUndefined(this._config.likers)&&this._config.likers.liked===!0},_isQuoteLikedOnce:function(){return this._likedOnce===!0},_isControlsAvailable:function(){return i.user.isUserPresent()&&i.user.getLogin()===this._getQuoteCreatorConfig().login},_getLikersCount:function(){if(!i.tools.isUndefined(this._config.likers)){if(i.tools.isNumber(this._config.likers.count))return this._config.likers.count;if(i.tools.isArray(this._config.likers))return this._config.likers.length}return null},_getTemplateName:function(){return k},link:function(){return i.helper.link.quote(this._config.uuid,this._config.user.login)},getUuid:function(){return this._config.uuid},destroy:function(){s("bm-quote-like").unsubscribe(this._callbacks.bmQuoteLikeGlobal),s("bm-quote-like").unsubscribe(this._callbacks.bmQuoteUnlikeGlobal),w.destroy.apply(this,arguments)},_remove:function(){var e=this._config.document.book_uuid;this._isControlsAvailable()&&t.confirm(this.$elemRemove.attr("data-confirm-text"))&&n.ajax({url:"/a/4/m/"+this.getUuid(),type:"delete",success:function(){t.location.href="/books/"+e}})}}),a(y)})}(this,this.modules,this.jQuery,this.BM,this.moment,this.DIMixpanel,this.radio),function(t,e,n,i,o){e.define("SocialCounters",["extend","baseView"],function(e,r,s){var a=r(s),u=a,l=u.superclass,c="bm-social-counters-template";i.tools.mixin(u.prototype,{initialize:function(t){l.initialize.apply(this,arguments),this.$elem&&(this._config={autoFetch:!0,url:null,title:null,description:null,image:null,twitter:{title:null,description:null,image:null},vkontakte:{title:null,description:null,image:null},utms:{facebook:null,twitter:null,vkontakte:null}},this._fetchTimeout=null,this._updatedCounters=0,this.$elemButtonFacebook=this.$elem.find("@bm-social-counter-button-facebook"),this.$elemButtonFacebookCounter=this.$elem.find("@bm-social-counter-button-facebook-counter"),this.$elemButtonTwitter=this.$elem.find("@bm-social-counter-button-twitter"),this.$elemButtonTwitterCounter=this.$elem.find("@bm-social-counter-button-twitter-counter"),this.$elemButtonVkontakte=this.$elem.find("@bm-social-counter-button-vkontakte"),this.$elemButtonVkontakteCounter=this.$elem.find("@bm-social-counter-button-vkontakte-counter"),this._parsePageMeta(),this._parseConfig(),this.setConfig(t),this._setupEvents(),this._isAutoFetch()&&this.fetch())},_parseConfig:function(){var t=this._parseDataConfig();i.tools.isNull(t)||i.tools.mixin(this._config,t)},setConfig:function(t){i.tools.isUndefined(t)||(i.tools.isString(t.url)&&(t.url=i.helper.link.toAbsolute(t.url)),i.tools.mixin(this._config,t))},_parsePageMeta:function(){this._config.url=t.location.href,this._config.title=n('meta[property="og:title"]').attr("content"),this._config.description=n('meta[property="og:description"]').attr("content"),this._config.image=n('meta[property="og:image"]').attr("content"),this._config.twitter.title=n('meta[property="twitter:title"]').attr("content"),this._config.twitter.description=n('meta[property="twitter:description"]').attr("content"),this._config.twitter.image=n('meta[property="twitter:image:src"]').attr("content"),this._config.vkontakte.image=n("head link[rel=image_src]").attr("href")},_setupEvents:function(){var t=this,e=i.helper.event.clickName();this.$elemButtonFacebook.on(e,function(){t._openSharingWindow("http://facebook.com/sharer.php?"+n.param({u:t._getUrl("facebook")})),t._sendMixpanelEvent("fb")}),this.$elemButtonTwitter.on(e,function(){t._openSharingWindow("http://twitter.com/share?"+n.param({text:t._getTitle("twitter"),url:t._getUrl("twitter")})),t._sendMixpanelEvent("twitter")}),this.$elemButtonVkontakte.on(e,function(){t._openSharingWindow("http://vkontakte.ru/share.php?"+n.param({title:t._getTitle("vkontakte"),description:t._getDescription("vkontakte"),url:t._getUrl("vkontakte"),image:t._getImage("vkontakte")})),t._sendMixpanelEvent("vk")})},_getTitle:function(t){if(!i.tools.isUndefined(t)){if("vkontakte"===t&&!i.tools.isNull(this._config.vkontakte.title))return this._config.vkontakte.title;if("twitter"==t&&!i.tools.isNull(this._config.twitter.title))return this._config.twitter.title}return this._config.title},_getDescription:function(t){if(!i.tools.isUndefined(t)){if("vkontakte"===t&&!i.tools.isNull(this._config.vkontakte.description))return this._config.vkontakte.description;if("twitter"==t&&!i.tools.isNull(this._config.twitter.description))return this._config.twitter.description}return this._config.description},_getUrl:function(t,e){var n=this._config.url;return i.tools.isUndefined(t)||e!==!0&&("facebook"!==t||i.tools.isNull(this._config.utms.facebook)?"twitter"!==t||i.tools.isNull(this._config.utms.twitter)?"vkontakte"!==t||i.tools.isNull(this._config.utms.vkontakte)||(n=i.helper.link.appendParam(n,this._config.utms.vkontakte)):n=i.helper.link.appendParam(n,this._config.utms.twitter):n=i.helper.link.appendParam(n,this._config.utms.facebook)),n},_appendParam:function(t,e){},_getImage:function(t){if(!i.tools.isUndefined(t)){if("vkontakte"===t&&!i.tools.isNull(this._config.vkontakte.image))return this._config.vkontakte.image;if("twitter"==t&&!i.tools.isNull(this._config.twitter.image))return this._config.twitter.image}return this._config.image},_sendMixpanelEvent:function(t){o.track("Share Button Pressed",{source:t})},_openSharingWindow:function(e){t.open(e,"","toolbar=0,status=0,width=626,height=436")},_isAutoFetch:function(){return this._config.autoFetch===!0},fetch:function(e){var o=this;e?i.tools.isNumber(e.timeout)&&(this._fetchTimeout=e.timeout):this._fetchTimeout=null,this._requestSocialCounterData(this._getCounterRequestUrl("facebook"),function(t){t[0]&&o.$elemButtonFacebookCounter.html(o._filterCounterValue(t[0].share_count)),o._registerUpdatedCounter()},!0),o._requestSocialCounterData(this._getCounterRequestUrl("twitter"),function(t){o.$elemButtonTwitterCounter.html(o._filterCounterValue(t.count)),o._registerUpdatedCounter()},!0),t.VK=t.VK||{},t.VK.Share=t.VK.share||{},i.tools.isFunction(t.VK.Share.count)?this._registerUpdatedCounter():t.VK.Share.count=function(t,e){o.$elemButtonVkontakteCounter.html(o._filterCounterValue(e)),o._registerUpdatedCounter()},n.getJSON(this._getCounterRequestUrl("vkontakte")),i.tools.isNull(this._fetchTimeout)&&(this._fetchTimeout=setTimeout(function(){this._notify("fetch-error"),this._fetchTimeout=null}.bind(this),this._fetchTimeout))},_filterCounterValue:function(t){return t=t||0,t=Math.max(0,t),t>999&&(t="999+"),t},_registerUpdatedCounter:function(){var t=this;this._updatedCounters+=1,this._updatedCounters>=2&&setTimeout(function(){t._notify("fetch-success")},300)},_requestSocialCounterData:function(t,e,i){var o=this,r={type:"get",url:t,success:e,error:function(){o._registerUpdatedCounter()}};i&&(r.dataType="json"),n.ajax(r)},_getCounterRequestUrl:function(e){if(!i.tools.isUndefined(e)){if("facebook"===e)return t.location.protocol+"//api.facebook.com/method/links.getStats?urls="+this._getUrl("facebook")+"&format=json";if("twitter"===e)return t.location.protocol+"//api.twitter.com/1.1/search/tweets.json?q="+t.encodeURIComponent(t.location.href);if("vkontakte"===e)return t.location.protocol+"//vkontakte.ru/share.php?act=count&index=1&url="+this._getUrl("vkontakte")+"&format=json&callback=?"}},_getTemplateName:function(){return c},generateQuoteTitle:function(t){return this.$elem.attr("data-quote-title-text").replace("%{book}",i.helper.text.sliceBookTitle(t,60))},generateImpressionTitle:function(t){return this.$elem.attr("data-impression-title-text").replace("%{book}",i.helper.text.sliceBookTitle(t,60))}}),e(a)})}(this,this.modules,this.jQuery,this.BM,this.DIMixpanel),function(t,e,n,i){e.define("moduleInitReviewSlider",["moduleReviewSlider"],function(t,e){n("@bm-review-slider").length>0&&new e({element:"@bm-review-slider"}),t()}),e.require(["moduleInitReviewSlider"],function(){})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){e.define("moduleReviewSlider",["extend","baseView"],function(t,e,o){var r=e(o),s=r,a=s.superclass;i.tools.mixin(s.prototype,{initialize:function(t){a.initialize.apply(this,arguments),this.$elem&&(this.$elemsSlides=this.$elem.find("@bm-review-slider-slide"),this.$elemArrowLeft=this.$elem.find("@bm-review-slider-arrow-left"),this.$elemArrowRight=this.$elem.find("@bm-review-slider-arrow-right"),this._currentSlide=0,this._totalSlides=this._getTotalSlidesCount(),this._slidingEnabled=!0,this.$elem.attr("data-current-slide")||this.$elem.attr("data-current-slide","0"),this.$elemsSlides.length>0&&!this._getSlide(0).hasClass("m-first")&&this._getSlide(0).addClass("m-first"),i.tools.client.isTouch()?this._setupEventsTouch():this._setupEvents())},_setupEventsTouch:function(){var t=this;this.$elemArrowLeft.on(i.tools.client.touchEvent,function(e){e.preventDefault(),t.slideLeft()}),this.$elemArrowRight.on(i.tools.client.touchEvent,function(e){e.preventDefault(),t.slideRight()})},_setupEvents:function(){var t=this;this.$elemArrowLeft.on("click",function(){t.slideLeft()}),this.$elemArrowRight.on("click",function(){t.slideRight()})},slideLeft:function(){return this._slidingEnabled?this._slide(-1):void 0},slideRight:function(){return this._slidingEnabled?this._slide(1):void 0},_slide:function(t){var e,n,i=this,o=this._currentSlide+t,r=this._getCurrentSlide();this._slidingEnabled=!1,n=0>t?"right":"left",0>o&&(o=this._totalSlides-1),o>=this._totalSlides&&(o=0),e=this._getSlide(o),r.animationEnd(function(){r.unbindAnimationEnd(),r.removeAttr("data-fade-out"),i._setCurrentSlide(o),e.animationEnd(function(){e.unbindAnimationEnd(),e.removeAttr("data-fade-in"),i._slidingEnabled=!0}),e.attr("data-fade-in",n)}),r.attr("data-fade-out",n)},_getTotalSlidesCount:function(){return this.$elemsSlides.length},_getCurrentSlide:function(){return this._getSlide(this._currentSlide)},_getSlide:function(t){return n(this.$elemsSlides[t])},_setCurrentSlide:function(t){this._currentSlide=t,this.$elem.attr("data-current-slide",t.toString())}}),t(r)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){"use strict";var o=function(i,o){var r=function(){var i,o=n(t),r=function(t){var n=e.body||e.documentElement,i=n.style;if("string"==typeof i[t])return t;var o=["Moz","webkit","Webkit","Khtml","O","ms"];t=t.charAt(0).toUpperCase()+t.substr(1);for(var r=0;r<o.length;r++){var s=o[r]+t;if("string"==typeof i[s])return s}return!1},s={windowWidth:520,blankHeight:230},a=null!=t.orientation,u=r("transition"),l=r("transform"),c=function(t,e){var i=this;i.$b=t,i.$wrapper=i.$b.find(".bm-slideshow-wrapper"),i.$slideList=i.$b.find(".bm-slideshow-slide"),i.currentSlide,i.onResize=function(){if(o.width()<s.windowWidth){var t=0,e=0;i.$slideList.each(function(i,o){var r=n(o).find("h1"),s=n(o).find("h2"),a=r.height(),u=s.height();a>t&&(t=a),u>e&&(e=u)}),i.$wrapper.css("height",t+e+s.blankHeight+"px"),i.$b.css("height",t+e+s.blankHeight+20+"px")}else i.$wrapper.css("height",""),i.$b.css("height","")},a?i.buildMobile():i.buildDesktop(),i.move=a?i.moveMobile:i.moveDesktop,i.update()};return c.prototype={update:function(){var t,e=this;e.$slideList=e.$b.find(".bm-slideshow-slide"),t=e.$slideList.length-1,e.currentSlide>t&&(e.currentSlide=t),e.show(void 0,!0),e.$b.removeClass("initial")},show:function(t,e){var n=this;void 0===t&&(t=n.currentSlide||0),t=parseInt(t,10),0>t?t=n.$slideList.length-1:t>=n.$slideList.length&&(t=0),n.transitionInProgress=!0,n.move(t,e),n.activateCtrl(t),setTimeout(function(){n.$slideList.eq(t),n.$slideList.eq(n.currentSlide);n.currentSlide=t,n.transitionInProgress=!1},a?360:1e3)},activateCtrl:function(t){var e=this;e.$controlsLinks.removeClass("active"),n(e.$controlsLinks[t]).addClass("active")},moveDesktop:function(t,e){var i=this;e?i.$b.addClass("transition-disabled"):i.$b.removeClass("transition-disabled"),this.$slideList.each(function(e,i){var o=n(i),r=(o.find(".bm-slideshow-slide-bg"),o.find(".bm-slideshow-slide-content")[0]);e-t===0?(o.removeClass("moving"),function(t){setTimeout(function(){t.addClass("visible")},500)}(o)):(o.addClass("moving"),function(t){setTimeout(function(){t.removeClass("visible")},500)}(o)),r.style[l]="translate3d("+100*(e-t)+"%, 0, 0)"})},moveMobile:function(t,e){this.$slideList.each(function(n,i){e?i.style[u]="none":i.style[u]="",i.style[l]="translate3d("+100*(n-t)+"%, 0, 0)"})},buildControls:function(){for(var t=this,e='<ul class="bm-slideshow-controls-links">',i=0;i<t.$slideList.length;i++)e+='<li><a href="#'+i+'"></a></li>';e+="</ul>",a||(e+='<div class="bm-slideshow-controls-arrows"><a class="bm-slideshow-controls-arrows-left" href="#"><span><</span></a><a class="bm-slideshow-controls-arrows-right" href="#"><span>></span></a></div>'),t.$controls=n(e),t.$controlsLinks=t.$controls.find("li a"),t.$b.find(".bm-slideshow-wrapper").append(t.$controls),a||(t.$left=t.$controls.find(".bm-slideshow-controls-arrows-left"),t.$right=t.$controls.find(".bm-slideshow-controls-arrows-right"),t.$controlsLinks.on("click",function(e){e.preventDefault();var n=this.hash.split("#")[1];this.currentSlide!==n&&t.show(n)}),t.$left.on("click",function(e){e.preventDefault(),t.show(t.currentSlide-1)}),t.$right.on("click",function(e){e.preventDefault(),t.show(t.currentSlide+1)}))},buildDesktop:function(){var t=this;t.buildControls(),o.on("resize.slideshow",function(){clearTimeout(i),i=setTimeout(t.onResize,300)}).trigger("resize.slideshow")},buildMobile:function(){var e,n,r,s,a,c,d,h=this,p=[];h.buildControls(),h.$b.addClass("touch").on({"touchstart.slider":function(t){var n=t.originalEvent.touches[0];e=n.clientX,r=n.clientY},"touchmove.slider":function(i){var o=i.originalEvent.touches[0];n=o.clientX-e,s=o.clientY-r,Math.abs(n)>3&&!c?(d=!0,c=!0):Math.abs(s)>3&&!c&&(a=!0,c=!0),(0===h.currentSlide&&n>0||h.currentSlide===h.$slideList.length-1&&0>n)&&(n=.2*n),d&&(i.preventDefault(),h.$slideList.each(function(e,i){p[e]||(p[e]=new t.WebKitCSSMatrix(getComputedStyle(i).webkitTransform).m41),i.style[u]="none",i.style[l]="translate3d("+(p[e]+n)+"px, 0, 0)"}))},"touchend.slider":function(t){if(Math.abs(n)>h.$b.width()/5){var i=h.currentSlide+(n>0?-1:1);i>=0&&i<h.$slideList.length?h.show(i):h.show()}else h.show();e=n=void 0,p=[],a=!1,d=!1,c=!1},"touchcancel.slider":function(t){e=n=void 0,p=[],a=!1,d=!1,c=!1}}),o.on("resize.slideshow",function(){clearTimeout(i),i=setTimeout(h.onResize,300)}).trigger("resize.slideshow")}},c}();o.Slideshow=r,i(r)};i.define("Slideshow",["modules"],o)}(this,this.document,this.jQuery,this.modules),function(t,e,n,i,o,r){"use strict";var s=function(i){var o=function(e,i){var o,r,s,a=this;a.$element=n(e),r=a.$element.data("url"),o="current"===r||""===r?t.location.href.gsub(/&?utm_.+?(&|$)/,""):r,s={url:o,header:a.$element.data("header"),title:a.$element.data("title"),summary:a.$element.data("summary"),summaryVK:a.$element.data("summary-vk"),image:a.$element.data("image"),small:a.$element.data("small"),colored:a.$element.data("colored")},a.options=n.extend({},a.defaults,i||{},s),a.linkFacebookCounter="https://api.facebook.com/method/links.getStats?urls="+a.options.url+"&format=json",a.linkTwitterCounter="https://urls.api.twitter.com/1/urls/count.json?url="+a.options.url+"&callback=?",a.linkVkontakteCounter="https://vkontakte.ru/share.php?act=count&index=1&url="+a.options.url+"&format=json&callback=?",a.applyTemplate(a.$element),a.bindSocialButtonEvents(),a.loadSocialCounters()};o.prototype={defaults:{url:t.location.href,title:e.getElementsByTagName("title")[0].innerHTML||"Bookmate",summary:null,image:null,header:null,small:!1,colored:!1,facebook:".js-social-counter-facebook",twitter:".js-social-counter-twitter",vk:".js-social-counter-vk",counter:".item-counter"},applyTemplate:function(t){var e=this;if(t.addClass("social-counters"),e.options.colored&&t.addClass("social-counters-colored"),e.options.small&&t.addClass("social-counters-small"),e.options.header){var i=n("<div class='social-counters-header'><span>"+e.options.header+"</span></div>");t.append(i)}var o="<div class='social-counters-item'></div>",r="<div class='item-icon'></div>",s="<div class='item-counter'>0</div>",a="<div class='item-text'></div>",u={facebook:"F",vk:"V",twitter:"T"},l={facebook:"Facebook",vk:"Vkontakte",twitter:"Twitter"};for(var c in u)if(u.hasOwnProperty(c)){var d=n(o).addClass("item-"+c+" js-social-counter-"+c),h=n(r).text(u[c]),p=n(a).text(l[c]),f=n(s);d.append(h,p,f),t.append(d)}},requestSocialCounterData:function(t,e,i){var o={type:"get",url:t,success:e};i&&(o.dataType="json"),n.ajax(o)},loadSocialCounters:function(){var e=this;e.requestSocialCounterData(e.linkFacebookCounter,function(t){t[0]&&e.$element.find(e.options.facebook).find(e.options.counter).html(t[0].share_count)},!0),e.requestSocialCounterData(e.linkTwitterCounter,function(t){e.$element.find(e.options.twitter).find(e.options.counter).html(t.count)},!0),t.VK=t.VK||{},t.VK.Share=t.VK.share||{},t.VK.Share.count=function(t,n){e.$element.find(e.options.vk).find(e.options.counter).html(n)},n.getJSON(e.linkVkontakteCounter)},openSharingWindow:function(e){t.open(e,"","toolbar=0,status=0,width=626,height=436")},bindSocialButtonEvents:function(){var t=this;t.$element.find(t.options.facebook).on("click",function(){t.openSharingWindow("http://facebook.com/sharer.php?"+n.param({u:t.options.url})),t.trackSharing("fb")}),t.$element.find(t.options.twitter).on("click",function(){t.openSharingWindow("http://twitter.com/share?"+n.param({text:t.options.title,url:t.options.url})),t.trackSharing("twitter")}),t.$element.find(t.options.vk).on("click",function(){t.openSharingWindow("http://vkontakte.ru/share.php?"+n.param({title:t.options.title,description:t.options.summaryVK,url:t.options.url,image:t.options.image})),t.trackSharing("vk")})},trackSharing:function(t){var e=this;r.track("Share Button Pressed",{source:t,context:e.options?e.options.entity:"other"})}},n.fn.extend({socialCounters:function(t){var e=arguments.length>1?arguments.slice(1):[];return this.each(function(){var i=n(this),r=i.data("socialCounters");r||i.data("socialCounters",r=new o(this,t)),"string"==typeof t&&r[t].apply(r,e)})}})};o.require([],s)}(this,this.document,this.jQuery,this.radio,this.modules,this.DIMixpanel),function(t,e,n,i,o){e.define("SubscriptionBadge",["extend","baseView","PopupSubscriptionState"],function(t,e,n,r){var s=e(n),a=s,u=a.superclass;i.tools.mixin(a.prototype,{initialize:function(t){u.initialize.apply(this,arguments),this.$elem&&(this._config={},this._popupSubscriptionState=null,this.$elemTextKind=this.$elem.find("@bm-subscription-badge-text-kind"),this.$elemTextTill=this.$elem.find("@bm-subscription-badge-text-till"),this._setConfig(t),this._bindEvents(),this._initPopupSubscriptionState(),this._update())},_setConfig:function(t){i.tools.isUndefined(t)||(this._config=i.tools.mixin(this._config,t))},_bindEvents:function(){this.$elem.on(i.helper.event.clickName(),function(t){this._onElemClick(t)}.bind(this))},_onElemClick:function(){i.tools.isNull(this._popupSubscriptionState)||this._popupSubscriptionState.show()},_initPopupSubscriptionState:function(){i.tools.isNull(this._popupSubscriptionState)&&(this._popupSubscriptionState=new r(this._config))},_update:function(){i.tools.isEmpty(this._config)||("default"===this._config.kind?(this.$elem.addClass("m-default"),this.$elem.removeClass("m-premium"),this.$elemTextKind.html(this.$elemTextKind.data("text-default"))):"premium"===this._config.kind&&(this.$elem.removeClass("m-default"),this.$elem.addClass("m-premium"),this.$elemTextKind.html(this.$elemTextKind.data("text-premium"))),this._config.expires_at&&(o.locale(i.user.getLocale()),this.$elemTextTill.html(o(1e3*this._config.expires_at).format("D MMM[, ]YYYY"))))},_getTemplateName:function(){return"bm-subscription-badge-template"},destroy:function(){if(i.tools.isPresent(this._popupSubscriptionwState))try{this._popupSubscriptionwState.destroy(),this._popupSubscriptionwState=null}catch(t){}u.destroy.apply(this,arguments)}}),t(s)})}(this,this.modules,this.jQuery,this.BM,this.moment),function(t,e,n,i,o){"use strict";i.define("embedPopupApi",["embedPopup"],function(t,e){var n=null,i=function(){null===n&&(n=new e({useTemplate:!0}))},o=function(t){i(),n.setBookUuid(t)},r=function(){i(),n.show()};t({setBookUuid:o,show:r})})}(this,this.document,this.jQuery,this.modules,this.radio),function(t,e,n,i,o){"use strict";var r=function(t,e,i,o){var r=e(i),s=r,a=s.superclass,u="bookmate-popup-embed-template",l=/%BOOK_UUID%/g;n.extend(s.prototype,{initialize:function(){a.initialize.apply(this,arguments),this._elementEmbedCodeWrapper=this._element.find("[role=embed-code]"),this._bookUuid=null,this._initialEmbedCode=null,this._saveInitialEmbedCode(),this._bindEvents()},_bindEvents:function(){var t=this;this._elementEmbedCodeWrapper.on("click",function(){t._onEmbedCodeWrapperClick()})},_onEmbedCodeWrapperClick:function(){this._elementEmbedCodeWrapper.focus(),this._elementEmbedCodeWrapper.select()},setConfig:function(t){a.setConfig.apply(this,arguments),t&&t.bookUuid&&this.setBookUuid(t.bookUuid)},_saveInitialEmbedCode:function(){this._initialEmbedCode=this._elementEmbedCodeWrapper.html()},setBookUuid:function(t){t&&(this._bookUuid=t,this._updateCode())},_updateCode:function(){this._bookUuid&&this._elementEmbedCodeWrapper.val(this._elementEmbedCodeWrapper.val().replace(l,this._bookUuid))},_getTemplateName:function(){return u}}),t(r)};i.define("embedPopup",["extend","PopupBase","tools"],r)}(this,this.document,this.jQuery,this.modules,this.radio),function(t,e,n,i){"use strict";var o=function(t,e){var i=function(){var t=function(t){var e=this;e.origin=n(t).html()};return t.prototype={getInstance:function(){return n(this.origin)}},t}();e.TemplateFactory=i,t(i)};i.define("TemplateFactory",["modules"],o)}(this,this.document,this.jQuery,this.modules),function(t,e,n,i,o){"use strict";var r=function(e){var i=n(t),o=n("body, html"),r=function(t,e,r){var s=this;s.$upLink=n(".bm-up-link"),s.$container=t,s.$trigger=e,s.preventScroll=!1,s.offset,s.right,i.on("resize.uplink",function(){s.offset=s.$trigger?s.$trigger.offset().top:i.height(),s.right=i.width()-(s.$container.offset().left+s.$container.width()),s.$upLink.css("right",s.right+"px")}).on("scroll.uplink",function(){s.preventScroll||(i.scrollTop()>=s.offset?s.$upLink.addClass("show"):s.$upLink.removeClass("show"))}).trigger("resize.uplink"),s.$upLink.on("click",function(t){t.preventDefault(),s.preventScroll=!0,s.$upLink.removeClass("show"),o.animate({scrollTop:0},300,"easeInOutQuad",function(){s.preventScroll=!1})})};e(r)};i.define("UpLink",[],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i){e.define("moduleBookReader",["extend","baseView"],function(t,e,n){var o=e(n),r=o,s=r.superclass,a="bm-book-reader-template";i.tools.mixin(r.prototype,{initialize:function(t){s.initialize.apply(this,arguments),this.$elem&&(this._config={login:"",avatar_url:""},this._parseConfig(),this._setConfig(t),this.$elemAvatar=this.$elem.find("@bm-book-reader-avatar"),this.update())},_parseConfig:function(){var t=this._parseDataConfig();i.tools.isEmpty(t)||i.tools.mixin(this._config,t)},_setConfig:function(t){i.tools.isUndefined(t)||i.tools.mixin(this._config,t)},update:function(){this._config&&(this._config.login&&this.$elem.attr("href","/"+this._config.login+"/recent"),this._config.avatar_url&&this.$elemAvatar.attr("src",i.helper.asset.path(this._config.avatar_url)))},getLogin:function(){return i.tools.isUndefined(this._config)||i.tools.isUndefined(this._config.login)?null:this._config.login},_getTemplateName:function(){return a}}),t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){"use strict";e.define("UserQuickMenu",["DropDown"],function(e,n){var i=function(e){var i=this;i.$b=$(".bm-user-quick-menu"),i.$icon=i.$b.find(".bm-user-quick-menu-icon"),i.$container=i.$b.find(".bm-user-quick-menu-container"),i.dropDown=new n({$button:i.$b,$container:i.$container}),i.$container.find('[data-action="logout"]').on("click",function(){$.ajax({url:"/logout",method:"delete",success:function(){t.location.href="/"}})})};t.UserQuickMenu=new i,e()})}(this,this.modules,this.radio,this.DIMixpanel),function(t,e,n,i,o){"use strict";e.define("userFollowButton",["loginWindow"],function(t,e){var r=$("#FollowButton"),s=r.data("following"),a=r.data("followmsg"),u=r.data("unfollowmsg"),l=n.user.getLogin(),c=n.user.isUserPresent(),d=n.user.getViewingUserLogin(),h=new e({context:"user_subscribe",preventDefaultLoginBehavior:!0}),p=function(){l=n.user.getLogin(),$.ajax({url:"/a/4/u/"+l+"/following.json",method:"get",success:function(t){s=!1;for(var e=0;e<t.length;e++)if(d===t[e].login){s=!0;break}f(!0)}})},f=function(t){var e=s?"/a/4/u/unfollow.json":"/a/4/u/follow.json";r.attr("wait",!0),r.attr("disabled","disabled"),s||o.track("Friend Follow"),$.ajax({url:e,method:"post",data:{logins:JSON.stringify([d])},success:function(){s=!s,r.removeAttr("wait"),r.removeAttr("disabled"),gon.following=s,s?(r.html(u),r.removeClass("bookmate-button-green").addClass("bm-button-black m-transparent"),i&&i("User","Follow",d)):(r.html(a),r.removeClass("bm-button-black m-transparent").addClass("bookmate-button-green"),i&&i("User","Unfollow",d)),t&&n.tools.reload()}})};r.on("click",function(t){t.preventDefault(),c?f():(h.showWindow("inital"),h.on("authenticationSuccessful",function(){p()}))}),t()})}(this,this.modules,this.BM,this.track_event,this.DIMixpanel),
function(t,e,n,i,o,r){e.define("PopupPaywall",["PopupBase","extend","dynamicContent","PaymentFormLoader","PaymentForm","moduleAuthRequest","ZendeskChatButton"],function(e,s,a,u,l,c,d,h){var p=a(s),f=p,m=f.superclass,g="bm-popup-paywall-template";i.tools.mixin(f,{Step:{PREMIUM:"premium",PREMIUM_PREVIEW:"premium-preview",DEFAULT:"default",DEFAULT_PREVIEW:"default-preview",BOOSTER:"booster",BOOSTER_PREVIEW:"booster-preview",ABOUT_DEFAULT:"about-default",ABOUT_BOOSTER:"about-booster",ABOUT_PREMIUM:"about-premium",PAYMENT_FORM:"payment-form",SUCCESS:"success",LOADING:"loading",HIDE:"hide"},Type:{ABOUT_BOOK:"about-book",PREVIEW_FINISH:"preview-finish"},Context:{READER:"reader"}}),i.tools.mixin(f.prototype,{initialize:function(t){var e=["m-version-2","bm-popup-paywall","bm-popup-paywall-2"];m.initialize.call(this,{useTemplate:!0,rootClassName:e,hasDependentPopups:!0}),this.$elemDynamicContent=this.$elem.find("@bm-dynamic-content"),this.$elemLinkBack=this.$elem.find("@bm-popup-paywall-link-back"),this.$elemLinkToAboutDefault=this.$elem.find("@bm-popup-paywall-link-to-about-default"),this.$elemLinkToAboutBooster=this.$elem.find("@bm-popup-paywall-link-to-about-booster"),this.$elemsHeaderItems=this.$elem.find("@bm-popup-paywall-header-item"),this.$elemHeaderPaymentForm=this.$elem.find("@bm-popup-paywall-payment-form-header"),this.$elemPaymentFormWrapper=this.$elem.find("@bm-popup-paywall-payment-form-wrapper"),this.$elemButtonBuyPremium=this.$elem.find("@bm-popup-paywall-button-buy-premium, @bm-popup-block-about-button-buy-premium"),this.$elemButtonBuyBooster=this.$elem.find("@bm-popup-paywall-button-buy-booster, @bm-popup-block-about-button-buy-booster"),this.$elemButtonBuyDefault=this.$elem.find("@bm-popup-paywall-button-buy-default, @bm-popup-block-about-button-buy-default"),this.$elemSubscriptionExpirationDate=this.$elem.find("@subscription-expiration-date"),this.$elemSubscriptionExpirationDatePremium=this.$elem.find("@subscription-expiration-date-premium"),this.$elemStateSuccessContent=this.$elem.find("@bm-popup-payment-light-state-success-content"),this.$elemNextChargeDate=this.$elem.find("@bm-popup-payment-light-next-charge-date"),this.$elemStateSuccessButtonOkWrapper=this.$elem.find("@bm-popup-payment-light-state-success-button-ok-wrapper"),this.$elemStateSuccessButtonOk=this.$elem.find("@bm-popup-payment-light-state-success-button-ok"),this.$elemStateSuccessWarning=this.$elem.find("@bm-popup-payment-light-state-success-warning"),this.$elemStateSuccessWarningMessage=this.$elem.find("@bm-popup-payment-light-state-success-warning-message"),this.$elemButtonExtendSubscription=this.$elem.find("@bm-popup-payment-light-button-extend-subscription"),this.$elemsPriceElements=this.$elem.find("@bm-popup-paywall-price"),this.$elemPromocode=this.$elem.find("@bm-popup-payment-light-state-success-promocode"),this._paymentFormLoader=null,this._paymentForm=null,this._dynamicContent=null,this._context=t&&t.context||null,this._lastRequiredSubscriptionLevel=null,this._initDynamicContent(),this._initZendeskChatButton(),this._setWaitState(),this._appendPaymentFormLoader(),this._bindEvents()},_initDynamicContent:function(){this._dynamicContent=new u({element:this.$elemDynamicContent})},_initZendeskChatButton:function(){this.zendeskChatButton=new h({$el:this.$elem})},_appendPaymentFormLoader:function(){var t=this;this._paymentFormLoader=new l,this._paymentForm=this._paymentFormLoader.getPaymentForm(),this._paymentForm.on("form-shown",function(){t._elementOverlay.scrollTo(99999,350)}),this.$elemPaymentFormWrapper.append(this._paymentFormLoader.getElement())},_setWaitState:function(){this.$elemsPriceElements.addClass("m-wait")},_bindEvents:function(){var t=this,e=i.tools.client.isTouch()?i.tools.client.touchEvent:"click";this.$elemLinkToAboutDefault.on(e,function(){var e=n(this);t._showAboutDefaultSubscription({context:e.attr("data-context")})}),this.$elemLinkToAboutBooster.on(e,function(){var e=n(this);t._showAboutBoosterSubscription({context:e.attr("data-context")})}),this.$elemLinkBack.on(e,function(){t._navigateBack()}),this.$elemButtonBuyDefault.on(e,function(){t.showPaymentForm(c.SubscriptionType.DEFAULT)}),this.$elemButtonBuyBooster.on(e,function(){t.showPaymentForm(c.SubscriptionType.BOOSTER)}),this.$elemButtonBuyPremium.on(e,function(){t.showPaymentForm(c.SubscriptionType.PREMIUM)}),this._dynamicContent.on("fade-out-start",function(e,n){t._onDynamicContentFadeOutStart(e,n)}),this._dynamicContent.on("resize-end",function(e,n){t._onDynamicContentResizeEnd(e,n)}),this._dynamicContent.on("fade-in-start",function(e,n){t._onDynamicContentFadeInStart(e,n)}),this._paymentForm.on("subscription-success",function(e){t._onPaymentFormPaymentSuccess(e)}),this.$elemStateSuccessButtonOk.on("click",function(){t._onStateSuccessButtonOkClick()}),this.$elemPromocode.on("click",function(){this.select()}),i.helper.subscription.on("prices-fetched",function(){t._updatePaywallPrices(),t._notify("prices-fetched")}),this.$elem.find(".bm-button-ulmart").on("click",function(t){r.track("Ulmart Button Pressed",{context:n(this).data("context")})})},_onDynamicContentFadeOutStart:function(t,e){this._hideHeader()},_onDynamicContentResizeEnd:function(t,e){this._elementOverlay.scrollTop(0)},_onDynamicContentFadeInStart:function(t,e){this._dynamicContent.isStepsStackEmpty()||this._showLinkBack(),this._showHeader(e)},_onPaymentFormPaymentSuccess:function(t){this._notify("subscription-success"),this._showStateSuccessWithPromocode(t),this._sendFacebookConversionData(t)},_onStateSuccessButtonOkClick:function(){"/reader/"===t.location.pathname.slice(0,8)?t.location.reload():t.location.pathname="/"},_updatePaywallPrices:function(){this.$elemsPriceElements.each(function(){var t=n(this),e=t.attr("data-text").replace("%{price}",i.helper.subscription.getPrice(t.attr("data-kind"),t.attr("data-duration")));t.html(e)}),this.$elemsPriceElements.removeClass("m-wait")},_showStateSuccess:function(t){var e,n,i;t&&(t.kind?e=t.kind:t.plan&&(e=this._paymentForm.getKindByPlan(t.plan)),t.expires_at&&(n=this._timestampToDate(t.expires_at)),t.message&&(i=t.message)),e&&n&&(this._backgroundClickHide=!1,this.hideButtonClose(),this._hideLinkBack(),this.$elemNextChargeDate.html(n),this.$elemStateSuccessContent.attr("data-subscription-kind",e),this._dynamicContent.clearStepsStack(),i&&(this.$elemStateSuccessButtonOkWrapper.attr("hidden","hidden"),this.$elemStateSuccessWarningMessage.html(i),this.$elemStateSuccessWarning.removeAttr("hidden")),this._dynamicContent.showStep(f.Step.SUCCESS,function(){},!1,!0))},_showStateSuccessWithPromocode:function(t){var e,n,o,r;t&&(t.kind?e=t.kind:t.plan&&(e=this._paymentForm.getKindByPlan(t.plan)),t.expires_at&&(n=this._timestampToDate(t.expires_at)),t.referral_code&&(o=i.helper.subscription.promo.getLinkFromCode(t.referral_code)),t.message&&(r=t.message)),e&&n&&(this._hideLinkBack(),this._dynamicContent.clearStepsStack(),this.$elemNextChargeDate.html(n),this.$elemStateSuccessContent.attr("data-subscription-kind",e),this.$elemPromocode.attr("value",o),r&&(this.$elemStateSuccessWarningMessage.html(r),this.$elemStateSuccessWarning.removeAttr("hidden")),this._dynamicContent.showStep(f.Step.SUCCESS,function(){},!1,!0))},_timestampToDate:function(t){var e=new Date(t);return[e.getDate(),e.getMonth()+1,e.getFullYear()].join("/")},_getTemplateName:function(){return g},show:function(t){var e=this,n=null,o=f.Type.ABOUT_BOOK,r=function(){};if(this._context=t&&t.context,i.tools.isUndefined(t)||(n=i.tools.isUndefined(t.step)?"auto":t.step,i.tools.isUndefined(t.type)||(o=t.type),i.tools.isUndefined(t.callback)||(r=t.callback)),o===f.Type.PREVIEW_FINISH&&t&&t.subscriptionLevel&&(this._lastRequiredSubscriptionLevel=t.subscriptionLevel,n=this._getStepToShowBySubscriptionLevel(t.subscriptionLevel)),"auto"===n&&(n=this._getStepByUserSubscription()),this._dynamicContent.reset(),this._dynamicContent.clearStepsStack(),this._hideLinkBack(),this._paymentFormLoader.arePaymentMethodsLoaded())n&&(this._showStep(n),r()),this._updateHeader(),m.show.apply(this,arguments),this._sendEventPopupShown({step:n,context:t&&t.context}),this._dynamicContent.update();else{if(n===f.Step.HIDE)return;this._dynamicContent.setStep(f.Step.LOADING),this._updateHeader(),m.show.apply(this,arguments),this._dynamicContent.update(),e._paymentFormLoader.loadPaymentMethods(function(){n&&(n!==f.Step.ABOUT_BOOSTER&&n!==f.Step.ABOUT_PREMIUM||(e.updateSubscriptionExpirationDate(),e.resolveButtonExtendSubscription()),e._dynamicContent.showStep(n,void 0,!1,!0),r()),e._sendEventPopupShown({step:n,context:t&&t.context})})}},_showStep:function(t){t!==f.Step.ABOUT_BOOSTER&&t!==f.Step.ABOUT_PREMIUM||(this.updateSubscriptionExpirationDate(),this.resolveButtonExtendSubscription()),this._dynamicContent.setStep(t)},hide:function(t){t=t||{};var e=void 0!==t.animation?!!t.animation:!0,n=void 0!==t.silent?!!t.silent:!1;this._paymentFormLoader.stop(),m.hide.call(this,n,{animation:e})},_sendEventPopupShown:function(t){r.subscriptionContext.set(t.context),-1!==[f.Step.ABOUT_DEFAULT,f.Step.ABOUT_BOOSTER].indexOf(t.step)?r.track("All Subscriptions Popup Shown"):-1!==[f.Step.PREMIUM,f.Step.PREMIUM_PREVIEW,f.Step.BOOSTER,f.Step.BOOSTER_PREVIEW].indexOf(t.step)?r.track("Subscription Popup Shown",{sub_type:"premium"}):-1!==[f.Step.DEFAULT,f.Step.DEFAULT_PREVIEW].indexOf(t.step)&&r.track("Subscription Popup Shown",{sub_type:"standard"})},_sendEventSubscriptionInitiated:function(t){t&&("default"===t&&(t="standard"),r.track("Subscription Initiated",{sub_type:t,method:this._lastPaymentMethod}))},updateSubscriptionExpirationDate:function(){i.user.isUserPresent()&&(i.user.isSubscriptionDefault()&&this.$elemSubscriptionExpirationDate.html(o(1e3*i.user.getSubscription("default").expires_at).format("D MMMM YYYY")),i.user.isSubscriptionPremium()&&this.$elemSubscriptionExpirationDatePremium.html(o(1e3*i.user.getSubscription("premium").expires_at).format("D MMMM YYYY")))},resolveButtonExtendSubscription:function(){!i.user.isSubscriptionDefault()||i.user.isRecurrentDefaultActive()||i.user.isSubscriptionPremium()?this.$elemButtonExtendSubscription.attr("hidden","hidden"):this.$elemButtonExtendSubscription.removeAttr("hidden")},_getStepByUserSubscription:function(){var e=this;return i.user.isUserPresent()?i.user.isSubscriptionPremium()&&i.user.isRecurrentPremiumActive()?f.Step.PAYMENT_FORM:i.user.isSubscriptionPremium()?f.Step.ABOUT_PREMIUM:i.user.isSubscriptionDefault()?f.Step.ABOUT_BOOSTER:f.Step.ABOUT_DEFAULT:(this.hide({animation:!1}),d(function(n){e.show({step:"auto"}),n.closeWindow({silent:!0}),e.on("hide",function(){t.location.reload()})}),f.Step.HIDE)},_getStepToShowBySubscriptionLevel:function(t){return t===c.SubscriptionType.DEFAULT?f.Step.DEFAULT_PREVIEW:t===c.SubscriptionType.PREMIUM?f.Step.PREMIUM_PREVIEW:t===c.SubscriptionType.BOOSTER?f.Step.BOOSTER_PREVIEW:null},_updateHeader:function(){var t=this._dynamicContent.getCurrentStepName();this._showHeader(t)},_showHeader:function(t){this.$elemsHeaderItems.each(function(){var e=n(this);e.attr("data-step")===t?e.attr("data-visible","true"):e.attr("data-visible","false")})},_hideHeader:function(){this.$elemsHeaderItems.each(function(){var t=n(this);t.attr("data-visible","false")})},_showAboutDefaultSubscription:function(t){this._dynamicContent.showStep(f.Step.ABOUT_DEFAULT),t=i.tools.mixin(t,{step:f.Step.ABOUT_DEFAULT}),this._sendEventPopupShown(t)},_showAboutBoosterSubscription:function(t){this.updateSubscriptionExpirationDate(),this.resolveButtonExtendSubscription(),this._dynamicContent.showStep(f.Step.ABOUT_BOOSTER),t=i.tools.mixin(t,{step:f.Step.ABOUT_BOOSTER}),this._sendEventPopupShown(t)},showPaymentForm:function(e){var n=this;e===c.SubscriptionType.DEFAULT?(this.$elemHeaderPaymentForm.addClass("m-default"),this.$elemHeaderPaymentForm.removeClass("m-premium")):(this.$elemHeaderPaymentForm.addClass("m-premium"),this.$elemHeaderPaymentForm.removeClass("m-default")),i.user.isUserPresent()?(this._paymentForm.reset(),this._paymentForm.setSubscriptionKind(e),this._paymentFormLoader.show(),this._dynamicContent.showStep(f.Step.PAYMENT_FORM)):(n.hide({animation:!1}),d(function(o){return n._isContextReader()&&null!==n._lastRequiredSubscriptionLevel&&("default"===n._lastRequiredSubscriptionLevel&&i.user.isSubscriptionDefault()||-1!==["premium","booster"].indexOf(n._lastRequiredSubscriptionLevel)&&i.user.isSubscriptionPremium())?void t.location.reload():(o.closeWindow({silent:!0}),n.on("hide",function(){t.location.reload()}),n.show({step:f.Step.PAYMENT_FORM}),void n._paymentFormLoader.show(function(){n._paymentForm.setSubscriptionKind(e)}))})),this._trackSubscriptionInitiated(e)},_trackSubscriptionInitiated:function(t){var e=t;e="default"===e?"standard":e,e===c.SubscriptionType.BOOSTER&&(e=c.SubscriptionType.PREMIUM),-1===r.subscriptionContext.get().indexOf("_popup")&&r.subscriptionContext.set(this._context),r.track("Subscription Initiated",{sub_type:e})},_sendFacebookConversionData:function(e){!function(){var e=t._fbq||(t._fbq=[]);if(!e.loaded){var n=document.createElement("script");n.async=!0,n.src="//connect.facebook.net/en_US/fbds.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(n,i),e.loaded=!0}}(),t._fbq=t._fbq||[],t._fbq.push(["track","6022233066062",{value:e.amount/100,currency:e.currency}])},_navigateBack:function(){this._dynamicContent.showPreviousStep(),this._dynamicContent.isStepsStackEmpty()&&this._hideLinkBack()},_showLinkBack:function(){this.$elemLinkBack.attr("data-visible","true")},_hideLinkBack:function(){this.$elemLinkBack.attr("data-visible","false")},setStep:function(t){},destroy:function(){},_isContextReader:function(){return this._context===f.Context.READER}}),e(p)})}(this,this.modules,this.jQuery,this.BM,this.moment,this.DIMixpanel),function(t,e,n,i){"use strict";n.define("BookshelfResourceItemProcessor",["TemplateFactory","loginWindow"],function(n,o,r){var s=this;s.$followButtons=this.$followButtons||[];var a=function(){var t=this;t.templateFactory=new o("#bm-activity-bookshelf-resource-template"),t.loginWindow=new r};a.prototype={getItem:function(n){var o=this,r=o.templateFactory.getInstance(),a=r.find("button"),u=(a.children(),a.data("followmsg")),l=a.data("unfollowmsg"),c=n.following,d=n.uuid,h={shelf_name:d,discovered:n.discovered,discovered_id:n.discovered_id};s.$followButtons.push(a),a.attr("data-bookshelf",d),r.find(".bm-activity-bookshelf-story-resource-wrapper").attr("href","/bookshelves/"+n.uuid),r.find(".bm-activity-bookshelf-story-resource-background img").attr("src",n.cover_thumb).attr("data-original",n.cover_thumb),r.find(".bm-activity-bookshelf-story-resource-desc h3").html(n.title),r.find("@bookshelf-creator").html(n.creator.name||n.creator.login),r.find(".bm-activity-bookshelf-story-resource-desc-books span").html(n.documents_count),r.find(".bm-activity-bookshelf-story-resource-wrapper").on("click",function(o){o.preventDefault(),console.log("bookshelf data.discovered >>>",n.discovered,"data.discovered_id >>>",n.discovered_id,"uuid >>>",d);var r="feed"===n.discovered||"superfeed"===n.discovered?n.discovered+"_shelf":n.discovered;i.track("Shelf Selected",h),i.discovered.set({channel:"shelf",ctx:r,uuid:n.discovered_id||d}),setTimeout(function(){t.location=e(o.currentTarget).attr("href")},200)}),BM.tools.isNull(n.followers_count)?r.find(".bm-activity-bookshelf-story-resource-desc-subscribers").hide():r.find(".bm-activity-bookshelf-story-resource-desc-subscribers span").html(n.followers_count),BM.user.present()&&n&&n.creator&&n.creator.login===BM.user.login()?a.attr("hidden","hidden"):a.removeAttr("hidden");var p=function(){var t=e(s.$followButtons).map(function(){return this.toArray()}).filter('[data-bookshelf="'+d+'"]');c?(t.removeClass("bm-button-lightblue follow"),t.addClass("bm-button-green-grey unfollow"),t.children().html(l)):(t.removeClass("bm-button-green-grey unfollow"),t.addClass("bm-button-lightblue follow"),t.children().html(u))},f=function(){var t=c?"/a/4/bs/"+d+"/unfollow.json":"/a/4/bs/"+d+"/follow.json";a.attr("disabled","disabled"),e.ajax({url:t,method:"post",success:function(){c=!c,c&&i.track("Shelf Follow",h),a.removeAttr("disabled"),p()}})};return p(),a.on("click",function(t){t.preventDefault(),t.stopPropagation(),BM.user.isUserPresent()?f():o.loginWindow.showWindow()}),r}},n(new a)})}(this,this.jQuery,this.modules,this.DIMixpanel),function(t,e,n,i,o){"use strict";i.define("BookshelfStory",["extend","BaseStory","BookshelfStoryItemProcessor"],function(t,e,n,i){var r=e(n);o.tools.mixin(r.prototype,{_createItemProcessor:function(){this.storyItemProcessor=i}}),t(r)})}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i){"use strict";i.define("BookshelfStoryItemProcessor",["extend","BaseStoryItemProcessor","TemplateFactory","BookshelfResourceItemProcessor","Pluralizer"],function(t,e,n,i,o,r){var s=e(n);BM.tools.mixin(s.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance(),i=n.find(".bm-activity-bookshelf-story-header-action"),o=n.find(".bm-activity-bookshelf-story-header-postfix");return e.baseItemInit(n,t),"f"===t.activists[0].gender?i.html(i.data("f")):i.html(i.data("m")),t.resources_size>1&&n.find(".bm-activity-bookshelf-story-header-shelfcount").html(t.resources_size),o.html(o.data(r.pluralize(t.resources_size))),n},_createTemplateFactory:function(){this.templateFactory=new i("#bm-activity-bookshelf-story-template")},_setResourceItemProcessor:function(){this.resourceItemProcessor=o}}),t(new s)})}(this,this.document,this.jQuery,this.modules),function(t,e,n,i,o){"use strict";i.define("BookshelfDocumentResourceItemProcessor",["TemplateFactory","BookItemProcessor","BookBlockListItem"],function(e,n,i,r){var s=function(){var t=this;t.templateFactory=new n("#bm-activity-bookshelf-document-resource-template"),t.bookItemProcessor=i};s.prototype={getItem:function(t){var e=this,n=e.templateFactory.getInstance(),i=n.find(".bm-activity-bookshelf-document-story-resource-annotation");return t.annotation?i.html(t.annotation):i.remove(),n.append(new r(this._getListItemConfig(t)).getElement()),n},_getListItemConfig:function(t){var e={components:{owner:!1,readers:!1},openDocumentPopup:!0,mixpanel_ctx:"feed_shelf",discovery_id:t.bookshelf.uuid};return o.tools.isObject(t)&&o.tools.isObject(t.document)&&(e=o.tools.mixin(e,t.document)),e},_getFeedType:function(){return t.location.pathname.indexOf("explore")>=0?"superfeed":"feed"}},e(new s)})}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t,e,n,i){var r=e(n);o.tools.mixin(r.prototype,{_createItemProcessor:function(){this.storyItemProcessor=i}}),t(r)};i.define("BookshelfDocumentStory",["extend","BaseStory","BookshelfDocumentStoryItemProcessor"],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t,e,n,i,o,r){var s=e(n);BM.tools.mixin(s.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance();e.baseItemInit(n,t);var i=n.find(".bm-activity-bookshelf-document-story-header-action");"f"===t.activists[0].gender?i.html(i.data("f")):i.html(i.data("m")),t.resources_size>1&&n.find(".bm-activity-bookshelf-document-story-header-bookcount").html(t.resources_size);var o=n.find(".bm-activity-bookshelf-document-story-header-postfix");o.html(o.data(r.pluralize(t.resources_size)));var s=n.find(".bm-activity-bookshelf-document-story-header-bookshelf-link"),a=t.activists[0];return s.attr("href","/bookshelves/"+a.uuid),s.html(a.title),n},_createTemplateFactory:function(){this.templateFactory=new i("#bm-activity-bookshelf-document-story-template")},_setResourceItemProcessor:function(){this.resourceItemProcessor=o}}),t(new s)};i.define("BookshelfDocumentStoryItemProcessor",["extend","BaseStoryItemProcessor","TemplateFactory","BookshelfDocumentResourceItemProcessor","Pluralizer"],r)}(this,this.document,this.jQuery,this.modules,this.moment),function(t,e,n,i,o){"use strict";var r=function(t,e,n,i){var r=e(n);o.tools.mixin(r.prototype,{_createItemProcessor:function(){this.storyItemProcessor=new i({action:"finish"})}}),t(r)};i.define("DocumentReadStory",["extend","BaseStory","LibraryCardStoryItemProcessor"],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i){"use strict";var o=function(t,e,n){var i=function(){var t=this;t.templateFactory=new e("#bm-activity-library-card-resource-template"),t.bookItemProcessor=n};i.prototype={getItem:function(t){var e=this,n=e.templateFactory.getInstance();return n.append(e.bookItemProcessor.getItem(t)),n}},t(new i)};i.define("LibraryCardResourceItemProcessor",["TemplateFactory","BookItemProcessor"],o)}(this,this.document,this.jQuery,this.modules),function(t,e,n,i,o){"use strict";var r=function(t,e,n,i){var r=e(n);o.tools.mixin(r.prototype,{_createItemProcessor:function(){this.storyItemProcessor=new i({action:"plan"})}}),t(r)};i.define("LibraryCardStory",["extend","BaseStory","LibraryCardStoryItemProcessor"],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o,r){"use strict";var s=function(t,e,n,i,r,s){var a=e(n);o.tools.mixin(a.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance(),i=e.options&&e.options.action?e.options.action:"plan";e.baseItemInit(n,t);var o=n.find(".bm-activity-library-card-story-header-action").filter("@activity-library-card-action-"+i),r=n.find(".bm-activity-library-card-story-header-bookcount"),a=n.find(".bm-activity-library-card-story-header-postfix"),u=t.activists[0],l=n.find(".bm-activity-library-card-more-activists"),c=l.find(".bm-activity-library-card-more-activists-count"),d=l.find(".bm-activity-library-card-more-activists-left"),h=t.activists_size-3;return h>0?(c.html(h),d.html(d.data(s.pluralize(h)))):l.remove(),t.activists_size>1?o.html(o.data("multiple")):"f"===u.gender?o.html(o.data("f")):o.html(o.data("m")),o.addClass("active"),a.html(a.data(s.pluralize(t.resources_size))),t.resources_size>1&&r.html(" "+t.resources_size),n},_createTemplateFactory:function(){this.templateFactory=new i("#bm-activity-library-card-story-template")},_setResourceItemProcessor:function(){this.resourceItemProcessor=r}}),t(a)};i.define("LibraryCardStoryItemProcessor",["extend","BaseStoryItemProcessor","TemplateFactory","LibraryCardResourceItemProcessor","Pluralizer"],s)}(this,this.document,this.jQuery,this.modules,this.BM,this.moment),function(t,e,n,i,o){"use strict";var r=function(t,e,i){var r=function(){var t=this;t.templateFactory=new e("#bm-activity-marker-resource-template")};r.prototype={getItem:function(t){var e=this,r=e.templateFactory.getInstance(),s=r.find(".bm-activity-marker-story-resource-like-heart"),a=r.find(".bm-activity-marker-story-resource-like-counter"),u=t.likers.liked,l=t.likers.count,c=null;return r.find(".bm-activity-marker-story-resource-content-link").attr("href","/"+t.user.login+"/quotes/"+t.uuid).attr("href",""),r.find(".bm-activity-marker-story-resource-content").html(t.content).on("click",function(e){BM.helper.event.isMouseLeftClick(e)&&(BM.tools.isNull(c)&&(c=new i({uuid:t.uuid})),c.show(),e.preventDefault(),e.stopPropagation())}),u&&s.addClass("liked"),l>0&&a.html(l),r.find(".bm-activity-marker-story-resource-like").on("click",function(e){e.preventDefault(),e.stopPropagation(),u||(s.addClass("bounceIn"),setTimeout(function(){s.removeClass("bounceIn")},760)),n.ajax({url:"/a/4/m/"+t.uuid+"/likers.json",method:u?"delete":"post",success:function(t){u=t.liked,l=t.count,o.track("Like Button Pressed",{context:"quote"}),u?(s.addClass("liked"),a.html(l)):(s.removeClass("liked"),l>0?a.html(l):a.html(""))}})}),r}},t(new r)};i.define("MarkerResourceItemProcessor",["TemplateFactory","modulePopupQuote"],r)}(this,this.document,this.jQuery,this.modules,this.DIMixpanel),function(t,e,n,i,o){"use strict";var r=function(t,e,n,i,r){var s=e(n);o.tools.mixin(s.prototype,{_createItemProcessor:function(){this.storyItemProcessor=i},_createDataParser:function(){this.dataParser=r}}),t(s)};i.define("MarkerStory",["extend","BaseStory","MarkerStoryItemProcessor","MarkerStoryDataParser"],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i){"use strict";var o=function(t){var e=function(){};e.prototype={parse:function(t){var e=this;return e.buildResult(e.groupData(t))},groupData:function(t){for(var e=this,n={},i=[],o=0;o<t.resources.length;o++){var r=t.resources[o],s=r.document_uuid,a=i.indexOf(s);-1===a&&i.push(s),n[s]||(n[s]=e.createStoryBody(t,r)),n[s].resources.push(e.prepareResource(r))}return{groupedData:n,documentUuids:i}},buildResult:function(t){for(var e=[],n=t.documentUuids,i=t.groupedData,o=0;o<n.length;o++){var r=n[o];e.push(i[r])}return e},createStoryBody:function(t,e){var n={};for(var i in t)"resources"===i?n[i]=[]:n[i]=t[i];return n.document_uuid=e.document_uuid,n.document=e.document,n},prepareResource:function(t){return delete t.document_uuid,delete t.document,t}},t(new e)};i.define("MarkerStoryDataParser",[],o)}(this,this.document,this.jQuery,this.modules),function(t,e,n,i){"use strict";var o=function(t,e,n,i,o,r){var s=e(n);BM.tools.mixin(s.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance(),i=t.document;return e.baseItemInit(n,t),n.append(e.bookItemProcessor.getItem(i)),n},_createTemplateFactory:function(){this.templateFactory=new i("#bm-activity-marker-story-template")},_setResourceItemProcessor:function(){this.resourceItemProcessor=o},_postInit:function(){this.bookItemProcessor=r}}),t(new s)};i.define("MarkerStoryItemProcessor",["extend","BaseStoryItemProcessor","TemplateFactory","MarkerResourceItemProcessor","BookItemProcessor"],o)}(this,this.document,this.jQuery,this.modules),function(t,e,n,i,o){"use strict";var r=function(t,e){var n=function(){var t=this;t.templateFactory=new e("#bm-activist-template")};n.prototype={getItem:function(t,e,n){var i=this,o=i.templateFactory.getInstance(),t=t.creator||t;o.find("a").attr("href","/"+t.login);var r=o.find(".bm-activity-activist-avatar-wrapper");if(e){if(n){var s=r.find("span");s.html("+"+n),s.addClass("visible"),r.addClass("shift")}r.find("img").attr("src",t.avatar_url),o.find("> a").html(t.name||t.login)}else r.remove(),o.find("> a").html(t.name||t.login);return o}},t(new n)};i.define("ActivistItemProcessor",["TemplateFactory"],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";i.define("BookItemProcessor",["TemplateFactory","hyphenizer","moduleBookBadge","RouterWeb"],function(t,e,i,r,s){var a=function(){var t=this;t.templateFactory=new e("#bm-activity-book-template")};a.prototype={getItem:function(t){var e,n,s,a;o.tools.isPresent(t.document)?(n=t.document.title,s=t.document.authors,e=o.tools.isPresent(t.cover)?t.document.cover.url:null,a=t.document.labels):(n=t.title,s=t.authors,e=o.tools.isPresent(t.cover)?t.cover.url:null,a=t.labels);var u=this,l=u.templateFactory.getInstance(),c=l.find(".bm-activity-book-cover-wrapper"),d=c.find("img"),h=c.find(".bm-activity-book-generated-cover");o.tools.isNull(e)?(h.find(".bm-activity-book-generated-cover-title-content").html(i.hyphenize(n.split(" ")).join(" ")),d.addClass("hidden")):(d.attr("src",e),h.addClass("hidden")),l.find(".bm-activity-book-meta-authors").html(s),l.find(".bm-activity-book-meta-title").html(n),l.attr("href","/documents/"+t.uuid+"/book");var p=l.find(".bm-ui-badge"),f=this._getLabelKey(t.labels);return p.html(p.data(f)),"free"!==f&&p.addClass("m-"+f),new r({element:p,document:t.document}),l},_getLabelKey:function(t){return t=_.pluck(t,"kind"),o.tools.isArray(t)?-1!==t.indexOf("free")?"free":-1!==t.indexOf("premium")?"premium":-1!==t.indexOf("default")?"default":-1!==t.indexOf("subscription")?"subscription":"private":t},_bindEvents:function(t,e){var i=o.tools.client.isTouch()?o.tools.client.touchEvent:"click";t.on(i,function(t){n(this).hasClass("selectable")||(t.preventDefault(),t.stopPropagation(),o.tools.client.isTouch()||s.navigateToBookPage(e.book_uuid))})}},t(new a)})}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i){e.define("BookBlockListItemGroup",["extend","baseView","BookBlockListItem"],function(t,e,n,o){var r=e(n),s=r,a=s.superclass;i.tools.mixin(s.prototype,{initialize:function(t){a.initialize.apply(this,arguments),this._config={count:null,objects:[]},this._url=null,this.$elemContent=this.$elem.find("@bm-book-block-list-item-group-content"),this.$elemMore=this.$elem.find("@bm-book-block-list-item-group-more"),this._setConfig(t),this._renderListItems(),this._update()},_setConfig:function(t){i.tools.isObject(t)&&(t.url&&this.setUrl(t.url),this._config=i.tools.mixin(this._config,t))},setUrl:function(t){i.tools.isString(t)&&(this._url=t)},_renderListItems:function(){i.tools.isUndefined(this._config)||i.tools.isArray(this._config.objects)&&this._config.objects.forEach(function(t){this._renderListItem(t)}.bind(this))},_renderListItem:function(t){var e=new o(i.tools.mixin(t,{components:{readers:!1,owner:!1}}));this.$elemContent.append(e.getElement())},_update:function(){i.tools.isUndefined(this._config)||i.tools.isUndefined(this._config.count)||(this._config.count>3?this.$elem.addClass("m-button-more-visible"):this.$elem.removeClass("m-button-more-visible"))},_getTemplateName:function(){return"bm-book-block-list-item-group-template"}}),t(r)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){e.define("BookBlockListItem",["extend","baseView","moduleBookCard","moduleButtonRead","moduleButtonReadDropdown","moduleBookBadge","DocumentPopup","moduleBookReader","RouterWeb"],function(e,r,s,a,u,l,c,d,h,p){var f=r(s),m=f,g=m.superclass,b=i(t),y=[],v=function(t){var e;for(e=0;e<y.length;++e)if(y[e]===t)return;y.push(t)},w=function(){var t;for(t=0;t<y.length;++t)y[t].update()};b.on("resize",n.tools.debounce(function(){w()},500)),n.tools.mixin(m.prototype,{initialize:function(t){g.initialize.apply(this,arguments),this.$elemCreatedAt=this.$elem.find("@bm-book-block-list-item-created-at"),this.$elemBookCoverWrapper=this.$elem.find("@bm-book-block-list-item-book-cover-wrapper"),this.$elemLabels=this.$elem.find("@bm-book-block-list-item-labels"),this.$elemAside=this.$elem.find("@bm-book-block-list-item-aside"),this.$elemTitle=this.$elem.find("@bm-book-block-list-item-title"),this.$elemAuthors=this.$elem.find("@bm-book-block-list-item-authors"),this.$elemReadersCount=this.$elem.find("@bm-book-block-list-item-readers-count"),this.$elemReadersList=this.$elem.find("@bm-book-block-list-item-readers-list"),this.$elemInnerLink=this.$elem.find("@bm-book-block-list-item-inner-link"),this._config={components:{readers:!0,readers_count:null,owner:!1},refetch:!1,openDocumentPopup:!1,readButton:{dropdownOptions:{}}},this._refetched=!1,this._bookCoverHandler=null,this._buttonReadHandler=null,this._uniqueToken=null,this._documentPopupHandler=null,this._readersHandlers=[],this._parseConfig(),this._setConfig(t),this._initBookCover(),this._initButtonRead(),this._initBookBadges(),this._setupEvents(),this._initBookReaders(),this.update(),v(this)},_setupEvents:function(){var t=this;this._bookCoverHandler&&this._bookCoverHandler.on(n.helper.event.clickName(),function(e){t._onBookCoverClick(e)}),this.$elemInnerLink.on(n.helper.event.clickName(),function(e){t._onInnerLinkClick(e)}),this.$elemAside.on(n.helper.event.clickName(),function(e){t._onAsideClick(e)})},_setupReadButtonEvents:function(){var t=this;this._buttonReadHandler&&(this._buttonReadHandler.on("dropdown-show",function(){t._addHoverClass()}),this._buttonReadHandler.on("dropdown-hide",function(){t._removeHoverClass()}))},_onBookCoverClick:function(t){this._openBook(t)},_onInnerLinkClick:function(t){this._openBook(t)},_onAsideClick:function(t){this._onInnerLinkClick(t)},_openBook:function(t){if(DIMixpanel.discovered.set({channel:"book",ctx:this._config.mixpanel_ctx,uuid:this._config.discovery_id}),(n.tools.isUndefined(t)||!n.helper.event.isClickWithCtrl(t)&&n.helper.event.isMouseLeftClick(t))&&this._config.openDocumentPopup){if(n.tools.client.isTouch())return;n.tools.isUndefined(t)||(t.preventDefault(),t.stopPropagation()),this._showDocumentPopup()}},_parseConfig:function(){
var t=this._parseDataConfig();n.tools.isEmpty(t)||n.tools.mixin(this._config,t)},setConfig:function(){return this._setConfig.apply(this,arguments)},_setConfig:function(t){t&&n.tools.mixin(this._config,t)},_initBookCover:function(){this._bookCoverHandler=new a(this._getBookCoverConfig()),this.$elemBookCoverWrapper.append(this._bookCoverHandler.getElement())},_getBookCoverConfig:function(){var t=a.prepareConfigFromDocumentAPI4Attributes(this._config);return t.cover.size=a.CoverSize.SMALL_FIT,t.readButton={enabled:!1},t.element=this.$elemBookCoverWrapper.find("@bm-book-card"),t},_initButtonRead:function(){if(n.tools.isPresent(this._config)&&this._config.can_be_read===!1)return this.$elemAside.find("@bm-button-read").remove(),void this._notify("ready");var t=this;return this.hasToBeRefetched()?void(this._config.uuid&&this.fetch(function(e){t._invokeButtonReadConstructor()})):void this._invokeButtonReadConstructor()},hasToBeRefetched:function(){return this._config.refetch===!0&&this._refetched===!1&&this._config.can_be_read!==!1},fetch:function(t){var e=this;i.ajax({url:"/a/4/d/"+this._config.uuid+".json",type:"get",dataType:"json",success:function(n){e._onFetchSuccess(n,t)},error:function(){e._onFetchError()}})},_onFetchSuccess:function(t,e){this._refetched=!0,n.tools.isFunction(e)&&(n.tools.mixin(this._config,t),this.update(),this._updateBookCover(),e.call(null,t)),this._notify("fetch-success")},_onFetchError:function(){this._notify("fetch-error")},isRefetched:function(){return this._refetched},_invokeButtonReadConstructor:function(){this._buttonReadHandler=new u({element:this.$elemAside.find("@bm-button-read"),config:this._getButtonReadConfig()}),this.$elemAside.append(this._buttonReadHandler.getElement()),this._showAside(),this._setupReadButtonEvents()},_getButtonReadConfig:function(){var t=u.prepareConfigFromDocumentAPI4Attributes(this._config);return this._config.labels&&this._config.labels.length>0&&(t.document.labels=this._config.labels),n.tools.mixin(t,{context:this._getContext(),controls:{read:!1,sideButton:{dropdown:!0,addToLibrary:!0}},viewMode:u.ViewMode.BLUE_TRANSPARENT,dropdownOptions:{},mixpanel_ctx:this._config.mixpanel_ctx,discovery_id:this._config.discovery_id}),n.tools.mixin(t.dropdownOptions,this._config.readButton.dropdownOptions),t},_getContext:function(){return n.tools.isPresent(this._config.context)?this._config.context:void 0},_initDocumentPopup:function(){n.tools.isNull(this._documentPopupHandler)&&(this._documentPopupHandler=new d(this._getDataForDocumentPopup()))},_showDocumentPopup:function(){p.navigateToBookPage(this._config.book_uuid)},_getDataForDocumentPopup:function(){return{book:{uuid:this._config.book_uuid},document:{uuid:this._config.uuid}}},_initBookBadges:function(){var t=this;if(!n.tools.isUndefined(this._config.labels)){var e=this,i=_.pluck(this._config.labels,"kind");i.forEach(function(n){"subscription"!==n&&t.$elemLabels.append(new c({config:{kind:n},document:e._config}).getElement())})}},_initBookReaders:function(){var t=this,e=this._config.components&&this._config.components.readers||this._config.readers,i=this._config.components&&this._config.components.readers_count||this._config.readers_count;n.tools.isArray(e)?(e.forEach(function(e){t._initBookReader(e)}),this.$elemReadersCount.html(n.tools.isNumber(i)?i:e.length)):this._hideReaders()},_initBookReader:function(t){var e=new h({login:t.login,avatar_url:t.avatar_url});this.$elemReadersList.append(e.getElement())},_showAside:function(){this.$elemAside.removeAttr("hidden","hidden")},wait:function(t){t?(this.$elem.addClass("m-loading"),this.$elem.attr("data-loading","true")):(this.$elem.removeClass("m-loading"),this.$elem.removeAttr("data-loading"))},getButtonRead:function(){return this._buttonReadHandler},getBookCover:function(){return this._bookCoverHandler},updateAll:function(){this.update(),this._updateBookCover(),this._updateLink(),this._updateButtonRead()},update:function(){this.$elemTitle.html(this._config.title),this.$elemTitle.dotdotdot({fallbackToLetter:!0}),this._config.authors&&this.$elemAuthors.html(this._config.authors),this._config.created_at&&(o.locale(n.user.getLocale()),this.$elemCreatedAt.html(o(1e3*this._config.created_at-9e4).fromNow(!0))),this._config.components&&(this._config.components.readers?this._showReaders():this._hideReaders(),this._config.components.owner?this.$elem.addClass("m-owner-enabled"):this.$elem.addClass("m-owner-disabled")),this._config.openDocumentPopup?this.$elem.addClass("m-document-popup-openable"):this.$elem.removeClass("m-document-popup-openable"),this._config.no_adders===!0?this.$elem.addClass("m-no-adders"):this.$elem.removeClass("m-no-adders"),this._updateLink()},_updateLink:function(){this._config.book_uuid&&this.$elemInnerLink.attr("href",n.helper.link.book(this._config.book_uuid))},_updateBookCover:function(){n.tools.isNull(this._bookCoverHandler)||n.tools.isNull(this._config.uuid)||(this._bookCoverHandler.setConfig({cover:this._config.cover,title:this._config.title,authors:this._config.authors}),this._bookCoverHandler.updateLayout())},_updateButtonRead:function(){n.tools.isNull(this._buttonReadHandler)||(this._buttonReadHandler._config.libraryCard=this._config.libraryCard,this._buttonReadHandler._update(),this._buttonReadHandler.update())},_showReaders:function(){this.$elem.addClass("m-readers-visible")},_hideReaders:function(){this.$elem.removeClass("m-readers-visible")},_getTemplateName:function(){return"bm-book-block-list-item-template"},_addHoverClass:function(){this.$elem.addClass("m-hover")},_removeHoverClass:function(){this.$elem.removeClass("m-hover")}}),e(f)})}(this,this.modules,this.BM,this.jQuery,this.moment),function(t,e,n,i){e.define("moduleFormCheckboxLight",["baseView","extend"],function(t,e,n){var o=n(e),r=o,s=r.superclass,a=0;i.tools.mixin(r.prototype,{initialize:function(t){s.initialize.apply(this,arguments),this.$elem&&(this.$elemElement=this.$elem.find("@bm-checkbox-light-element"),this.$elemBox=this.$elem.find("@bm-checkbox-light-box"),this.$elemLabel=this.$elem.find("@bm-checkbox-light-label"),this._uniqueId=null,this._linkCheckboxWithLabel())},_linkCheckboxWithLabel:function(){a+=1,this._uniqueId="bm-checkbox-"+a,this.$elemElement.attr("id",this._uniqueId),this.$elemBox.attr("for",this._uniqueId),this.$elemLabel.attr("for",this._uniqueId)},isChecked:function(){return this.$elemElement.is(":checked")},getId:function(){return this._uniqueId},enable:function(){this.$elemElement.removeAttr("disabled")},disable:function(){this.$elemElement.attr("disabled","disabled")}}),t(o)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){"use strict";var r=function(t,e,i,r){var s=i(r);o.tools.mixin(s.prototype,{initialize:function(t){var e=this;e.$label=n('label[for="'+t.attr("name")+'"]'),r.prototype.initialize.apply(this,arguments)},buildDOM:function(){var t=this;t.$errorLabel=n('<span class="bm-error-label"></span>'),t.$label.after(t.$errorLabel)},initListeners:function(){var t=this;t.$b.on("click.bm-checkbox",function(){t.sendRequest(this.checked)}),t.$label.on("click.bm-checkbox",function(){t.sendRequest(t.$b[0].checked)})}}),e.Checkbox=s,t(s)};i.define("Checkbox",["modules","extend","InputBaseClass"],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t,e,i,r){var s=i(r);o.tools.mixin(s.prototype,{initialize:function(t,e){var n=this;n.initialValue=t.val(),n.type=t.attr("type"),n.presaveCheck=e.presaveCheck,n.popup=e.popup,r.prototype.initialize.apply(this,arguments),n.setPreviewMode()},buildDOM:function(){if(!n(".bm-mailing").length){var t=this,e='<button class="bm-confirm-input-button-save bm-button-black m-transparent">'+t.$b.data("save")+"</button>",i='<button class="bm-confirm-input-button-cancel bm-button-black m-transparent">'+t.$b.data("cancel")+"</button>",o='<span class="bm-error-label"></span>';t.$b.wrap('<div class="bm-confirm-input"></div>'),t.$saveButton=n(e),t.$cancelButton=n(i),t.$errorLabel=n(o),t.$input=t.$b,t.$b=t.$b.parent(),t.$b.append(t.$saveButton),t.$b.append(t.$cancelButton),t.$b.append(t.$errorLabel),"phone"===t.type&&t._initPhoneMask()}},initListeners:function(){if(!n(".bm-mailing").length){var t=this;t.$input.on("click",function(){t.setEditMode()}),t.$saveButton.on("click",function(){var e=t.$input.val();return"email"===t.type?t.$input.val():t.$input.val(),"email"!==t.type||t.isEmail(e)?void(t.presaveCheck?t.presaveCheck(e,function(n,i){return n?(t.$errorLabel.removeClass("show"),void t.popup.show(e)):(t.$errorLabel.html(i),void t.$errorLabel.addClass("show"))}):t.popup.show(e)):(t.$errorLabel.html("  "),void t.$errorLabel.addClass("show"))}),t.$cancelButton.on("click",function(){t.setPreviewMode()}),t.$input.on("keyup",function(e){13===e.which&&t.$saveButton.trigger("click")})}},isEmail:function(t){return/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(t)},setEditMode:function(t){this.$saveButton.removeClass("hidden"),this.$cancelButton.removeClass("hidden"),this.$input.focus()},setPreviewMode:function(){n(".bm-mailing").length||(this.$saveButton.addClass("hidden"),this.$cancelButton.addClass("hidden"),this.$input.val(this.initialValue))},getValue:function(){return this.$input.val()},setValue:function(t){this.initialValue=t,this.$input.val(t)},_initPhoneMask:function(){var t,e=this,i=["Z99 (999) 999-99-999","Z9 (999) 999-99-999"];n.mask.rules.Z=/[\+\d]/,n.mask.options.autoTab=!1,e.$input.setMask(i[1]).on("keyup",function(n){t=e.$input.val().length>18?i[0]:i[1];var o=n.which;o>=37&&40>=o||(e.$input.unsetMask(),e.$input.setMask(t))})}}),e.ConfirmInput=s,t(s)};i.define("ConfirmInput",["modules","extend","InputBaseClass"],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i){e.define("FormInputPhone",["baseView"],function(t,e){var n=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(e,t),e.prototype.initialize=function(e){t.prototype.initialize.apply(this,arguments),this.$el&&(this.$inputPhone=this.$el.find("@bm-form-input-phone-number"),this._bindEvents())},e.prototype.val=function(t){return i.tools.isPresent(t)?void this.$inputPhone.val(t):"+"+this._prepareInputVal(this.$inputPhone.val())},e.prototype.valNumeric=function(){return this._prepareInputVal(this.$inputPhone.val())},e.prototype.focus=function(){this.$inputPhone.focus()},e.prototype._bindEvents=function(){var t=this;this.$inputPhone.on("change",function(e){t._notify("change",e)}),this.$inputPhone.on("keyup",function(e){t._notify("keyup",e)})},e.prototype._prepareInputVal=function(t){return t.replace(/\s/gi,"")},e.prototype._getTemplateName=function(){return"bm-form-input-phone-template"},e}(e);t(n)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i,o){"use strict";var r=function(t,e,i,r){var s=i(r);o.tools.mixin(s.prototype,{initialize:function(t){var e=this;e.values=[],e.checked,r.prototype.initialize.apply(this,arguments)},extractValues:function(){var t=this,e=[];t.$b.find("input").each(function(i,o){var r=n(o),s=n(o).val();e.push({value:s,label:t.$b.find('label[for="'+s+'"]').html()}),r.is(":checked")&&(t.initialVal=s)}),t.leftVal=e[0],t.rightVal=e[1]},buildDOM:function(){var t=this,e='<span class="bm-radio-label" data-val="'+t.leftVal.value+'">'+t.leftVal.label+'</span><div class="bm-radio-controls-wrapper"><div class="bm-radio-choice-bubble"></div><span class="bm-radio-choice" data-val="'+t.leftVal.value+'"></span><span class="bm-radio-choice" data-val="'+t.rightVal.value+'"></span></div><span class="bm-radio-label" data-val="'+t.rightVal.value+'">'+t.rightVal.label+'</span><span class="bm-error-label"></span>';t.$b.html(e),t.$b.append(t.$completeIcon),t.$bubble=t.$b.find(".bm-radio-choice-bubble"),t.$errorLabel=t.$b.find(".bm-error-label"),t.setValue(t.initialVal,!0)},initListeners:function(){var t=this;t.$b.find(".bm-radio-choice, .bm-radio-label").on("click",function(){var e=n(this).data("val");t.setValue(e)})},getValue:function(){return this.checked},setValue:function(t,e){var n=this;t!==n.checked&&(t!==n.leftVal.value?n.$b.addClass("switched"):n.$b.removeClass("switched"),n.checked=t,e||n.sendRequest(n.checked))}}),e.Radio=s,t(s)};i.define("Radio",["modules","extend","InputBaseClass"],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o,r){"use strict";var s=function(t,e,o,s,a){var u=o(s);r.tools.mixin(u.prototype,{initialize:function(t,e){var n=this;n.prepareData=e.prepareData,n.selects=[],n.allowBlank=e.allowBlank,s.prototype.initialize.apply(this,arguments)},buildDOM:function(){var t=this,e='<span class="bm-error-label"></span>';t.$b.find("select").each(function(e,i){t.selects.push(new a(n(i)))}),t.$errorLabel=n(e),t.$b.append(t.$completeIcon),t.$b.append(t.$errorLabel)},initListeners:function(){var t=this;i("select-value-set").subscribe(function(e){for(var n=[],i=0;i<t.selects.length;i++){var o=t.selects[i],r=o.getValue();if(r)n.push(r);else if(!t.allowBlank)return}t.allowBlank&&n.length>0&&n.length<t.selects.length||t.sendRequest(t.prepareData(n))})}}),e.SelectGroup=u,t(u)};o.define("SelectGroup",["modules","extend","InputBaseClass","Select"],s)}(this,this.document,this.jQuery,this.radio,this.modules,this.BM),function(t,e,n,i,o,r){"use strict";var s=function(t,o,s,a){var u=s(a);r.tools.mixin(u.prototype,{initialize:function(t){var e=this;e.values={},e.selected,a.prototype.initialize.apply(this,arguments)},extractValues:function(){var t=this;t.$b.find("option").each(function(e,i){var o=n(i),r=o.val(),s=o.html();t.values[r]=s}),t.selected=t.$b.val()},buildDOM:function(){r.tools.client.isTouch()||this.buildDesktop()},buildDesktop:function(){var t=this,e=t.$b.parent(),i="",o='<div class="bm-select"><div class="bm-select-box"><span class="bm-select-box-value" data-value="'+t.selected+'">'+t.values[t.selected]+'</span><span class="bm-select-box-expand-arrow">C</span></div><ul>';for(var r in t.values){var s=r,a=t.values[s];o+='<li data-value="'+s+'" class='+(s===t.selected?"selected":"")+">"+a+"</li>",a.length>i&&(i=a.length)}o+="</ul></div>",t.$b.remove(),t.$b=n(o),e.append(t.$b),t.$b.css("width",60+8*i+"px"),t.$box=t.$b.find(".bm-select-box"),t.$optionList=t.$b.find("ul"),t.$optionElements=t.$optionList.find("li"),t.$value=t.$b.find(".bm-select-box-value"),t.values[""]=""},initListeners:function(){r.tools.client.isTouch()?this.initTouch():this.initDesktop()},initDesktop:function(){var t=this,o=n(e);t.$box.on("click.bm-select",function(e){t.$optionList.hasClass("visible")||(e.stopPropagation(),o.trigger("click.bm-select"),t.$optionList.addClass("visible"),o.one("click.bm-select",function(){t.$optionList.removeClass("visible")}))}),t.$optionElements.on("click",function(e){var o=n(this),r=o.data("value"),s=o.html();t.$optionElements.removeClass("selected"),o.addClass("selected"),t.$value.data("value",r).html(s),i("select-value-set").broadcast({value:r})})},initTouch:function(){var t=this;t.$b.on("change",function(){var e=t.$b.val();i("select-value-set").broadcast({value:e})})},getValue:function(){return r.tools.client.isTouch()?this.$b.val():this.$value.data("value")}}),o.Select=u,t(u)};o.define("Select",["modules","extend","InputBaseClass"],s)}(this,this.document,this.jQuery,this.radio,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t,e,i,r){var s=i(r);o.tools.mixin(s.prototype,{initialize:function(t,e){var n=this;n.type=t.attr("type"),n.allowBlank=t.data("allowblank"),n.changeDelay=1500,n.timer,n.Types={EMAIL:"email",PHONE:"phone",NUMBER:"number",PASSWORD:"password"},n.options=e||{},n.postprocess=n.options.postprocess,r.prototype.initialize.apply(this,arguments)},buildDOM:function(){var t=this,e='<span class="bm-error-label"></span>',i='<span class="bm-text-input-eye">E</span>';t.$b.wrap('<div class="bm-text-input"></div>'),t.$errorLabel=n(e),t.$input=t.$b,t.$b=t.$b.parent(),t.$b.append(t.$errorLabel),t.ajax.url&&t.$b.append(t.$completeIcon),t.type===t.Types.PASSWORD&&(t.$eye=n(i),t.$b.append(t.$eye)),t.type===t.Types.PHONE&&t._initPhoneMask()},initListeners:function(){var t=this;t.ajax.url&&t.$input.on("keyup.bm-text-input",function(e){t.onEdit()}).on("focus.bm-text-input",function(e){t.$completeIcon.attr("class","bm-complete-icon bm-text-input-complete-icon"),t.initial=t.getValue()}).on("blur.bm-text-input",function(e){t.isValid()&&t.initial!==t.getValue()&&t.sendRequest(t.getValue())}),t.$eye&&t.$eye.on("click",function(e){"password"===t.$input.attr("type")?(t.$input.attr("type","text"),t.$eye.html("e")):(t.$input.attr("type","password"),t.$eye.html("E"))})},onEdit:function(){var t=this;clearTimeout(t.timer),t.timer=setTimeout(function(){t.isValid()&&t.sendRequest(t.getValue())},t.changeDelay)},processResponse:function(t){t=t.responseJSON;var e=this;if(t.error){var n="";if(t.error.message)n=t.error.message;else if(t.error.messages){n=t.error.messages;for(var i=0;i<e.paramTree.length;i++)n=n[e.paramTree[i]]}e.$completeIcon.attr("class","bm-complete-icon bm-text-input-complete-icon"),e.setError(n),e._notify("save-error")}else e.$completeIcon.attr("class","bm-complete-icon bm-text-input-complete-icon show"),e.$errorLabel.removeClass("show"),setTimeout(function(){e.$completeIcon.attr("class","bm-complete-icon bm-text-input-complete-icon")},1500),e._notify("save-success")},getValue:function(){var t=this.$input.val().trim();return this.type===this.Types.EMAIL&&(t=t.toLowerCase()),this.postprocess?this.postprocess(t):t},setValue:function(t){this.$input.val(t)},isValid:function(){var t=this.getValue();return this.type===this.Types.EMAIL?/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(t):this.allowBlank?!0:t.length>0},clear:function(){this.$input.val(""),this.hideError()},_initPhoneMask:function(){var t,e=this,i=["Z99 (999) 999-99-999","Z9 (999) 999-99-999"];n.mask.rules.Z=/[\+\d]/,n.mask.options.autoTab=!1,e.$input.setMask(i[1]).on("keyup",function(n){t=e.$input.val().length>18?i[0]:i[1];var o=n.which;o>=37&&40>=o||(e.$input.unsetMask(),e.$input.setMask(t))})}}),e.TextInput=s,t(s)};i.define("TextInput",["modules","extend","InputBaseClass"],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t,e,i,r){var s=i(r);o.tools.mixin(s.prototype,{initialize:function(t,e){var n=this;n.changeDelay=1e3,n.timer,n.autosize=t.data("autoexpand"),n.maxlength=parseInt(t.attr("maxlength"),10),r.prototype.initialize.apply(this,arguments)},buildDOM:function(){var t=this,e='<span class="bm-error-label"></span>';if(t.$b.wrap('<div class="bm-textarea"></div>'),t.$errorLabel=n(e),t.$input=t.$b,t.$b=t.$b.parent(),t.$b.append(t.$errorLabel),t.ajax.url){var i='<svg class="bm-complete-icon bm-textarea-complete-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 44 44" xml:space="preserve"><g fill="rgb(223,223,223)" fill-rule="evenodd"><g fill="rgb(0,0,0)"><g><path d="M22,42.9000015 C10.4759998,42.9000015 1.10000002,33.5229988 1.10000002,22 C1.10000002,10.4759998 10.4759998,1.10000002 22,1.10000002 C33.5229998,1.10000002 42.8999996,10.4760004 42.8999996,21.9999996 C42.9000015,33.5229988 33.5229988,42.9000015 22,42.9000015 L22,42.9000015 L22,42.9000015" id="Shape" fill="rgb(254,255,255)"></path><path d="M22,2.20000005 C32.9180002,2.20000005 41.7999992,11.082 41.7999992,21.9999993 C41.7999992,32.9179986 32.9179993,41.7999992 22,41.7999992 C11.0820007,41.7999992 2.20000005,32.9179993 2.20000005,22 C2.20000005,11.0820007 11.0819998,2.20000005 22,2.20000005 M22,0 C9.85099983,0 0,9.85099983 0,22 C0,34.1479998 9.85099983,44 22,44 C34.1479998,44 44,34.1479998 44,22 C44,9.85099983 34.1479988,0 22,0 L22,0 L22,0 L22,0" id="Shape" fill="rgb(91,214,144)"></path></g><path d="M32.9449997,16.0599995 L19.9960003,29.0100002 L12.6230001,21.6350002" id="Shape" stroke="rgb(91,214,144)" stroke-width="2.64" fill-opacity="0" fill="rgb(223,223,223)"></path></g></g></svg>';t.$completeIcon=n(i),t.$b.append(t.$completeIcon)}t.maxlength&&(t.$maxlength=n('<span class="bm-textarea-maxlength"></span>'),t.$b.append(t.$maxlength)),t.autosize&&t.$input.autosize()},initListeners:function(){var t=this;t.ajax.url&&t.$input.on("keyup.bm-textarea",function(e){t.onEdit()}).on("focus.bm-textarea",function(e){t.ajax.url&&t.$completeIcon.attr("class","bm-complete-icon bm-textarea-complete-icon")}).on("blur.bm-text-input",function(e){t.isValid()&&t.initial!==t.getValue()&&t.sendRequest(t.getValue())}),t.maxlength&&t.$input.on("keyup.bm-textarea-maxlength",function(){var e=t.getValue().length;t.$maxlength.html(e+"/"+t.maxlength),e===t.maxlength&&t.$maxlength.addClass("maximum")}).trigger("keyup.bm-textarea-maxlength")},onEdit:function(t){var e=this;clearTimeout(e.timer),e.timer=setTimeout(function(){e.isValid()&&e.sendRequest(e.getValue())},e.changeDelay)},processResponse:function(t){var e=this;if(t.error){for(var n=t.error.messages,i=1;i<e.paramTree.length;i++)n=n[e.paramTree[i]];e.$completeIcon.attr("class","bm-complete-icon bm-textarea-complete-icon"),e.setError(n)}else e.$completeIcon.attr("class","bm-complete-icon bm-textarea-complete-icon show"),e.$errorLabel.removeClass("show"),setTimeout(function(){e.$completeIcon.attr("class","bm-complete-icon bm-textarea-complete-icon")},1500)},getValue:function(){var t=this.$input.val();return t},setValue:function(t){this.$input.val(t)},isValid:function(){return!0},clear:function(){this.$input.val(""),this.hideError()}}),e.Textarea=s,t(s)};i.define("Textarea",["modules","extend","InputBaseClass"],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i){e.define("ImpressionFormAutoShare",["baseView","ImpressionModel","bmSocialConnect"],function(e,o,r,s){var a=function(e){function o(){return _classCallCheck(this,o),_possibleConstructorReturn(this,e.apply(this,arguments))}return _inherits(o,e),o.prototype.initialize=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];e.prototype.initialize.apply(this,arguments),this.$el&&(this._model=null,this._socialConnect=null,this._state=this._getState(),this.$buttons=this.$el.find("@bm-form-auto-share-button"),this.$facebook=this.$el.find("@bm-form-auto-share-button-facebook"),this.$twitter=this.$el.find("@bm-form-auto-share-button-twitter"),this._initModel(t.data),this._bindEvents(),this._update())},o.prototype._bindEvents=function(){var t=this;this.$facebook.on(i.helper.event.clickName(),function(e){i.user.isFacebookConnected()?(t.$facebook.toggleClass("m-active"),t._updateState()):t._connectFacebook()}),this.$twitter.on(i.helper.event.clickName(),function(e){i.user.isTwitterConnected()?(t.$twitter.toggleClass("m-active"),t._updateState()):t._connectTwitter()})},o.prototype._connectFacebook=function(){this._initSocialConnect(),this._socialConnect.facebook("impression-form-auto-share")},o.prototype._connectTwitter=function(){this._initSocialConnect(),this._socialConnect.twitter("impression-form-auto-share")},o.prototype._initSocialConnect=function(){i.tools.isNull(this._socialConnect)&&(this._socialConnect=new s,this._socialConnect.on("authenticationSuccessful",function(e,n,o){i.helper.page.isBookPage()&&(t.location.hash="#show_impression_form",t.location.reload())}))},o.prototype._initModel=function(t){i.tools.isNull(this._model)&&(this._model=new r(t))},o.prototype._getShareList=function(){return{facebook:this.$facebook.hasClass("m-active"),twitter:this.$twitter.hasClass("m-active")}},o.prototype._shareFacebook=function(){return this._share("facebook")},o.prototype._shareTwitter=function(){return this._share("twitter")},o.prototype._share=function(t){var e=this;return new Promise(function(i,o){return e._getShareList()[t]?void n.ajax({url:"/a/3/share.json",data:e._getShareData(t),type:"post",success:function(t){i()},error:function(){i()}}):void i()})},o.prototype._getShareData=function(t){return{provider:t,resource_type:"document/impression",resource_uuid:this._model.data.uuid}},o.prototype._getState=function(){var t={};return i.user.isFacebookConnected()?t.facebook=!0:t.facebook=!1,i.user.isTwitterConnected()?t.facebook?t.twitter=!1:t.twitter=!0:t.twitter=!1,i.user.isFacebookConnected()||(t.facebook=!1),i.tools.storage.getItem("impression-form-auto-share-state")&&(t=i.tools.storage.getItem("impression-form-auto-share-state")),i.user.isFacebookConnected()||(t.facebook=!1),i.user.isTwitterConnected()||(t.twitter=!1),t},o.prototype._updateState=function(){this._state=this._getShareList(),i.tools.storage.setItem("impression-form-auto-share-state",this._state)},o.prototype._update=function(){this._state.facebook?this.$facebook.addClass("m-active"):this.$facebook.removeClass("m-active"),this._state.twitter?this.$twitter.addClass("m-active"):this.$twitter.removeClass("m-active")},o.prototype.exec=function(t){Promise.all([this._shareFacebook(),this._shareTwitter()]).then(t)},o.prototype.show=function(){this.$el.removeClass("m-hidden")},o.prototype.hide=function(){this.$el.addClass("m-hidden")},o.prototype.setData=function(t){i.tools.isObject(t)&&(i.tools.isNull(this._model)&&this._initModel(),this._model.setData(t))},o.prototype.share=function(t){},o}(o);e(a)})}(this,this.modules,this.jQuery,this.BM),function(t,e,n,i){"use strict";n.define("FriendSuggestionUserItemProcessor",["TemplateFactory","Pluralizer"],function(t,e,n){var o=function(){var t=this;t.templateFactory=new e("#friend-suggestion-card-user-template")};o.prototype={getItem:function(t){var e=this,o=e.templateFactory.getInstance(),r=t.object,s=o.find(".bm-friend-suggestion-user-link");s.attr("href","/"+r.login),s.find("img").attr("src",r.avatar_url),s.find("strong").html(r.name||r.login),s.on("click",function(){i.discovered.set({channel:"user",ctx:"suggests"})});var a=o.find(".bm-friend-suggestion-user-meta-books"),u=o.find(".bm-friend-suggestion-user-meta-bookshelves");a.attr("href","/"+r.login+"/all"),a.html(r.library_cards_count+a.data(n.pluralize(r.library_cards_count)));var l=r.bookshelves_count+r.following_bookshelves_count;return l?(u.attr("href","/"+r.login+"/bookshelves"),u.html(l+u.data(n.pluralize(l)))):u.remove(),o.find(".bm-friend-suggestion-card-message").html(t.message),o.find(".bm-friend-suggestion-card-action").data("user",r.login),o}},t(new o)})}(this,this.jQuery,this.modules,this.DIMixpanel),function(t,e,n,i,o,r){"use strict";i.define("FriendSuggestionUserView",["extend","FriendSuggestionBaseCardView","FriendSuggestionUserItemProcessor"],function(t,e,i,s){var a=e(i);BM.tools.mixin(a.prototype,{_setItemProcessor:function(){this.itemProcessor=s},_setPostponeValue:function(t){this.postponeValue=t.object.login},_initListeners:function(){var t=this,e=function(e){var i=n(this),s=i.data("user");i.attr("wait",!0),i.attr("disabled","disabled"),r.track("Friend Follow",{discovered:"suggests"}),n.ajax({url:"/a/4/u/follow.json",method:"post",data:{logins:JSON.stringify([s])},success:function(){i.removeAttr("wait"),i.html(i.data("unfollow")),o&&o("User","Follow",s),setTimeout(function(){t.destroy()},1500)}})};t.$b.find(".bm-friend-suggestion-card-action").on("click",e)}}),t(a)})}(this,this.document,this.jQuery,this.modules,this.track_event,this.DIMixpanel),function(t,e,n,i,o){"use strict";i.define("FollowUserItemProcessor",["extend","BaseNotificationItemProcessor","TemplateFactory","UserPublic"],function(t,e,n,i,o){var r=e(n);BM.tools.mixin(r.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance();e.baseItemInit(n,t);var i=n.find(".bm-notification-inbox-item-message-action");return t.initiators.length>1?i.html(i.data("more").replace("%{count}",t.initiators.length-1)+i.data("many")):"f"===t.activist.gender?i.html(i.data("f")):i.html(i.data("m")),n},_createTemplateFactory:function(){this.templateFactory=new i("#notification-follow-user-template")}}),t(new r)})}(this,this.document,this.jQuery,this.modules,this.moment),function(t,e,n,i,o){"use strict";i.define("LikeMarkerItemProcessor",["extend","BaseNotificationItemProcessor","TemplateFactory"],function(t,e,n,i){var o=e(n);BM.tools.mixin(o.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance();e.baseItemInit(n,t);var i=n.find(".bm-notification-inbox-item-message-action");"f"===t.activist.gender?i.html(i.data("f")):i.html(i.data("m"));var o=n.find(".bm-notification-inbox-item-message-marker");return o.attr("href","/"+t.resource.user.login+"/quotes/"+t.resource.uuid),o.html(BM.helper.text.wrapInLocaleDependentQuotes(BM.helper.text.sliceQuote(t.resource.content,25))),n},_createTemplateFactory:function(){this.templateFactory=new i("#notification-like-marker-template")}}),t(new o)})}(this,this.document,this.jQuery,this.modules,this.moment),function(t,e,n,i,o){"use strict";i.define("InviteeRegisteredItemProcessor",["extend","BaseNotificationItemProcessor","TemplateFactory"],function(t,e,n,i){var o=e(n);BM.tools.mixin(o.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance(),i=t.initiators[0];e.baseItemInit(n,t);var o=n.find(".bm-notification-inbox-item-message-user"),r=n.find(".bm-notification-inbox-item-message-action");return o.attr("href",BM.helper.link.user(i.login)),o.html(i.name||i.login),"f"===t.activist.gender?r.html(r.data("f")):r.html(r.data("m")),n},_createTemplateFactory:function(){this.templateFactory=new i("#notification-invitee-registered-template")}}),t(new o)})}(this,this.document,this.jQuery,this.modules,this.moment),function(t,e,n,i,o){"use strict";var r=function(t,e,n,i){var o=e(n);BM.tools.mixin(o.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance();e.baseItemInit(n,t);var i=n.find(".bm-notification-inbox-item-message-action");"f"===t.activist.gender?i.html(i.data("f")):i.html(i.data("m"));var o=n.find("@bm-notification-inbox-item-message-impression");o.attr("href",BM.helper.link.impression(t.resource.uuid));var r=n.find(".bm-notification-inbox-item-message-impression-book");return r.html(BM.helper.text.sliceBookTitle(t.resource.document.title,25)),r.attr("href",t.resource.document.book_uuid),n},_createTemplateFactory:function(){this.templateFactory=new i("#notification-like-impression-template")}}),t(new o)};i.define("LikeImpressionItemProcessor",["extend","BaseNotificationItemProcessor","TemplateFactory"],r)}(this,this.document,this.jQuery,this.modules,this.moment),function(t,e,n,i,o){"use strict";var r=function(t,e,n,i){var o=e(n);BM.tools.mixin(o.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance();e.baseItemInit(n,t);var i=n.find(".bm-notification-inbox-item-message-document"),o=n.find(".bm-notification-inbox-item-message-action"),r=n.find(".bm-notification-inbox-item-message-bookshelf");return i.attr("href",BM.helper.link.book(t.resource.document.book_uuid)),i.html(BM.helper.text.sliceBookTitle(t.resource.document.title,25)),o.html(t.initiators.length>1?o.data("more").replace("%{count}",t.initiators.length-1)+o.data("many"):o.data("one")),r.attr("href","/bookshelves/"+t.resource.bookshelf.uuid),r.html(t.resource.bookshelf.title),n},_createTemplateFactory:function(){this.templateFactory=new i("#notification-read-bookshelf-document-template")}}),t(new o)};i.define("ReadBookshelfDocumentItemProcessor",["extend","BaseNotificationItemProcessor","TemplateFactory"],r)}(this,this.document,this.jQuery,this.modules,this.moment),function(t,e,n,i,o){"use strict";var r=function(t,e,n,i){var o=e(n);BM.tools.mixin(o.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance();e.baseItemInit(n,t);var i=n.find(".bm-notification-inbox-item-message-document"),o=n.find(".bm-notification-inbox-item-message-action");return i.attr("href","/documents/"+t.resource.uuid+"/book"),i.html(t.resource.title),o.html(t.initiators.length>1?o.data("more").replace("%{count}",t.initiators.length-1)+o.data("many"):o.data("one")),n},_createTemplateFactory:function(){this.templateFactory=new i("#notification-friend-read-template");
}}),t(new o)};i.define("FriendReadItemProcessor",["extend","BaseNotificationItemProcessor","TemplateFactory"],r)}(this,this.document,this.jQuery,this.modules,this.moment),function(t,e,n,i,o){"use strict";i.define("FollowBookshelfItemProcessor",["extend","BaseNotificationItemProcessor","TemplateFactory"],function(t,e,n,i){var o=e(n);BM.tools.mixin(o.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance();e.baseItemInit(n,t);var i=n.find(".bm-notification-inbox-item-message-action"),o=n.find(".bm-notification-inbox-item-message-bookshelf");return t.initiators.length>1?i.html(i.data("more").replace("%{count}",t.initiators.length-1)+i.data("many")):"f"===t.activist.gender?i.html(i.data("f")):i.html(i.data("m")),o.attr("href","/bookshelves/"+t.resource.uuid),o.html(t.resource.title),n},_createTemplateFactory:function(){this.templateFactory=new i("#notification-follow-bookshelf-template")}}),t(new o)})}(this,this.document,this.jQuery,this.modules,this.moment),function(t,e,n,i,o){"use strict";i.define("SocialNetworkFriendRegisteredItemProcessor",["extend","BaseNotificationItemProcessor","TemplateFactory"],function(t,e,n,i){var o=e(n);BM.tools.mixin(o.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance(),i=t.initiators[0];e.baseItemInit(n,t);var o=n.find(".bm-notification-inbox-item-message-user"),r=n.find(".bm-notification-inbox-item-message-action");return o.attr("href",BM.helper.link.user(i.login)),o.html(i.name||i.login),"f"===t.activist.gender?r.html(r.data("f")):r.html(r.data("m")),n},_createTemplateFactory:function(){this.templateFactory=new i("#notification-social-network-friend-registered-template")}}),t(new o)})}(this,this.document,this.jQuery,this.modules,this.moment),function(t,e,n,i,o){"use strict";i.define("InviteeSubscribedItemProcessor",["extend","BaseNotificationItemProcessor","TemplateFactory"],function(t,e,n,i){var o=e(n);BM.tools.mixin(o.prototype,{getItem:function(t){var e=this,n=e.templateFactory.getInstance(),i=t.initiators[0];e.baseItemInit(n,t);var o=n.find(".bm-notification-inbox-item-message-user"),r=n.find(".bm-notification-inbox-item-message-action");o.attr("href",BM.helper.link.user(i.login)),o.html(i.name||i.login);var s="f"===t.activist.gender?r.data("f"):r.data("m"),a='<a class="bm-notification-inbox-item-message-user" href="/'+i.login+'">'+(i.name||i.login)+"</a>",u=s.replace("%{invitee}",a);return r.html(u),n},_createTemplateFactory:function(){this.templateFactory=new i("#notification-invitee-subscribed-template")}}),t(new o)})}(this,this.document,this.jQuery,this.modules,this.moment),function(t,e,n,i,o){"use strict";i.define("PluralizerAz",[],function(t){var e=function(){};e.prototype={pluralize:function(t){return 1===t?"one":"other"}},t(new e)})}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t){var e=function(){};e.prototype={pluralize:function(t){return 1===t?"one":"other"}},t(new e)};i.define("PluralizerDa",[],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t){var e=function(){};e.prototype={pluralize:function(t){return 1===t?"one":"many"}},t(new e)};i.define("PluralizerEn",[],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t){var e=function(){};e.prototype={pluralize:function(t){return 1===t?"one":"other"}},t(new e)};i.define("PluralizerEnStandart",[],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t){var e=function(){};e.prototype={pluralize:function(t){return 1===t?"one":"other"}},t(new e)};i.define("PluralizerEs",[],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t){var e=function(){};e.prototype={pluralize:function(t){return"other"}},t(new e)};i.define("PluralizerId",[],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";i.define("PluralizerKk",[],function(t){var e=function(){};e.prototype={pluralize:function(t){return 1===t?"one":"other"}},t(new e)})}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t){var e=function(){};e.prototype={pluralize:function(t){return t%10==1&&t%100!=11?"one":t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?"few":"many"}},t(new e)};i.define("PluralizerRu",[],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o){"use strict";var r=function(t){var e=function(){};e.prototype={pluralize:function(t){return"one"}},t(new e)};i.define("PluralizerTr",[],r)}(this,this.document,this.jQuery,this.modules,this.BM),function(t,e,n,i,o,r){"use strict";var s=function(e){var n={INVALID_CODE:1};i.widget("custom.popupPaymentFormPromoCode",{_init:function(){this._elementForm=this.element.find(".promo-code-form"),this._elementInput=this.element.find(".promo-code-input"),this._elementButtonSubmit=this.element.find(".bookmate-button.promo-code-submit"),this._elementErrorMessage=this.element.find(".error-message"),this._formErrors=[],this._authToken=null,this._setupEvents()},_setupEvents:function(){this._elementInput.on("keyup",this._onElementInputKeyUp.bind(this)),this._elementButtonSubmit.on("click",this._onElementButtonSubmitClick.bind(this))},_onElementInputKeyUp:function(t){return 13===t.keyCode?void this._onFormSubmit():(this._isFormValid()?this._enableButtonSubmit():this._disableButtonSubmit(),void this._clearFormErrors())},_isFormValid:function(){return this._isInputValid()||this._formErrors.push(n.INVALID_CODE),0===this._formErrors.length},_isInputValid:function(){var t=this._getInputValue();return t&&t.length>0},_getInputValue:function(){return this._elementInput.val()},_onElementButtonSubmitClick:function(){this._onFormSubmit()},_onFormSubmit:function(){this._hideError(),this._isFormValid()?this._requestPromoCodeActivation():this._showFormErrors()},_requestPromoCodeActivation:function(){var t=this._getFormUrl(),e=this._getFormData();this._disableForm(),this._sendGAEventPaymentButtonPress(),i.ajax({url:t,type:"post",dataType:"json",data:e,success:this._onPromoCodeActivationSuccess.bind(this),error:this._onPromoCodeActivationError.bind(this)})},_getFormUrl:function(){return this._elementForm.attr("action")},_getFormData:function(){return{authenticity_token:this._getAuthToken(),code:this._getInputValue()}},_onPromoCodeActivationSuccess:function(t){this._enableForm(),r.track("Subscription Successful",{method:"code",payment_type:"code",type:"month"}),this.element.trigger("subscription_success",t)},_onPromoCodeActivationError:function(e){this._enableForm(),e&&e.responseJSON&&(e.responseJSON.error?this._showError(e.responseJSON.error):e.responseJSON.action&&"need-braintree-subscription"===e.responseJSON.action&&(t.location.href=e.responseJSON.link))},_showError:function(t){this._elementErrorMessage.html(t),this._elementErrorMessage.removeAttr("hidden")},_hideError:function(){this._elementErrorMessage.attr("hidden","hidden")},_showFormErrors:function(){-1!==this._formErrors.indexOf(n.INVALID_CODE)&&this._setInputStateError(!0)},_clearFormErrors:function(){this._formErrors.length=0,this._formErrors=[],this._setInputStateError(!1)},_setInputStateError:function(t){t?this._elementInput.attr("error","true"):this._elementInput.removeAttr("error")},_getAuthToken:function(){return this._authToken},setAuthToken:function(t){this._authToken=t},_enableButtonSubmit:function(){this._elementButtonSubmit.removeAttr("disabled")},_disableButtonSubmit:function(){this._elementButtonSubmit.attr("disabled","disabled")},_setButtonSubmitStateWait:function(t){t?(this._elementButtonSubmit.attr("wait","true"),this._disableButtonSubmit()):(this._elementButtonSubmit.removeAttr("wait"),this._enableButtonSubmit())},_enableForm:function(){this._elementInput.removeAttr("disabled"),this._enableButtonSubmit(),this._setButtonSubmitStateWait(!1)},_disableForm:function(){this._elementInput.attr("disabled","disabled"),this._disableButtonSubmit(),this._setButtonSubmitStateWait(!0)},_sendGAEventPaymentButtonPress:function(){o&&o("bookmate-subscription-ga-payment-button-pressed-event").broadcast()}}),e()};n.define("paymentPopup/promoCode",[],s)}(this,this.document,this.modules,this.jQuery,this.radio,this.DIMixpanel),function(t,e,n,i,o,r){"use strict";var s=function(e){i.widget("custom.popupPaymentFormQiwi",{_init:function(){this._elementInputPhoneNumber=this.element.find(".form-qiwi-input-phone-number"),this._elementButtonSubmit=this.element.find(".button-submit"),this._paymentAmount=null,this._authToken=null,this._mixedRequestParams={},this._initInputMasks(),this._setupEvents()},_setupEvents:function(){var t=this;this._elementInputPhoneNumber.on("keyup",function(e){t._onInputPhoneNumberKeyUp(e)}),this._elementButtonSubmit.on("click",function(){t._onButtonSubmitClick()})},_onInputPhoneNumberKeyUp:function(t){return 13===t.keyCode?void this._onFormSubmit():void(this._isFormValid()?this._enableButtonSubmit():this._disableButtonSubmit())},_onButtonSubmitClick:function(){this._onFormSubmit()},_onFormSubmit:function(){this._isFormValid()?(this._setButtonSubmitStateWait(!0),this._disableForm(),this._requestPayment()):this._displayFormErrors()},_isFormValid:function(){return!!this._isInputPhoneNumberValueValid()},_isInputPhoneNumberValueValid:function(){var t=this._getInputPhoneNumberValue();return t=t.replace(/[^0-9\+]/g,""),t.match(/^\+\d{10,13}$/)},_getInputPhoneNumberValue:function(){return this._elementInputPhoneNumber.val()},_displayFormErrors:function(){this._elementInputPhoneNumber.attr("error","true")},_clearFormErrors:function(){this._elementInputPhoneNumber.removeAttr("error")},_requestPayment:function(){var t=this;this._sendGAEventPaymentButtonPress(),this._sendNotifyOnBillingInitialized(),setTimeout(function(){i.ajax({type:"POST",dateType:"json",data:t._getPostData(),url:"/payments/qiwi/payment",timeout:3e4,success:function(e){t._onRequestPaymentSuccess(e)},error:function(){t._onRequestPaymentError()}})},100)},_onRequestPaymentSuccess:function(e){e&&(t.location.href=e.url)},_sendGAEventPaymentButtonPress:function(){o&&o("bookmate-subscription-ga-payment-button-pressed-event").broadcast()},_sendNotifyOnBillingInitialized:function(){o("notify-on-billing-initialized").broadcast()},_onRequestPaymentError:function(){this._setButtonSubmitStateWait(!1),this._enableForm()},_getPostData:function(){var t={authenticity_token:this._getAuthToken(),phone:this._getInputPhoneNumberValue(),amount:this._getPaymentAmount()};return i.extend(t,this._mixedRequestParams)},mixinRequestParameter:function(t){i.extend(this._mixedRequestParams,t)},_getMixedParams:function(){},_getAuthToken:function(){return this._authToken},setAuthToken:function(t){this._authToken=t},_enableButtonSubmit:function(){this._elementButtonSubmit.removeAttr("disabled")},_disableButtonSubmit:function(){this._elementButtonSubmit.attr("disabled","disabled")},_setButtonSubmitStateWait:function(t){t?(this._elementButtonSubmit.attr("wait","true"),this._disableButtonSubmit()):(this._elementButtonSubmit.removeAttr("wait"),this._enableButtonSubmit())},_initInputMasks:function(){var t,e=this._elementInputPhoneNumber,n=["Z99 (999) 999-99-999","Z9 (999) 999-99-999"];i.mask.rules.Z=/[\+\d]/,i.mask.options.autoTab=!1,this._elementInputPhoneNumber.setMask(n[1]).on("keyup",function(i){t=e.val().length>18?n[0]:n[1];var o=i.which;o>=37&&40>=o||(e.unsetMask(),e.setMask(t))})},setPaymentAmount:function(t){this._paymentAmount=t},_getPaymentAmount:function(){return this._paymentAmount},_enableForm:function(){this._elementInputPhoneNumber.removeAttr("disalbed")},_disableForm:function(){this._elementInputPhoneNumber.attr("disalbed","disalbed")},setVisible:function(t){t?this.element.removeAttr("hidden"):this.element.attr("hidden","hidden")},show:function(){this._clearFormErrors(),this.element.attr("visible","true")},hide:function(){this.setVisible(!1),this.element.removeAttr("visible")},isVisible:function(){return!this.element.attr("hidden")}}),e()};n.define("paymentPopup/qiwi",[],s)}(this,this.document,this.modules,this.jQuery,this.radio),function(t,e,n,i,o,r){"use strict";var s=function(e,n,s){var a={UNACTIVE:"unactive",ACTIVATED:"activated",CANCELED:"canceled",USER_CANCELED:"user_canceled"},u={unexpected:"unexpected server error",canceled:"tariff is not supported",user_canceled:"canceled by user"},l={CREATE:"/payments/inplat",STATUS:"/payments/inplat/status"},c={INPLAT:"inplat",PLANET3:"planet3"},d={CHECK_SMS_PAYMENT:1e4};i.widget("custom.popupPaymentFormSms",{_init:function(){this._elementInputPhoneNumber=this.element.find(".form-sms-input-phone-number"),this._elementButtonSubmit=this.element.find(".button-submit"),this._elementFormError=this.element.find(".form-item-error"),this._elementBlockFields=this.element.find("[role=block-fields]"),this._elementBlockNotSupported=this.element.find("[role=block-not-supported]"),this._elementBlockWaiting=this.element.find("[role=block-waiting]"),this._paymentAmount=null,this._authToken=null,this._mixedRequestParams={},this._timeoutStatus=null,this._currentPaymentSystem=null,this._planet3SinceTimestamp=(new Date).getTime(),this._initInputMasks(),this._setupEvents()},_setupEvents:function(){var t=this;this._elementInputPhoneNumber.on("keyup",function(e){t._onInputPhoneNumberKeyUp(e)}),this._elementInputPhoneNumber.on("focus",function(){t._onInputPhoneNumberFocus()}),this._elementButtonSubmit.on("click",function(){t._onButtonSubmitClick()})},_onInputPhoneNumberKeyUp:function(t){return 13===t.keyCode?void this._onFormSubmit():void(this._isFormValid()?this._enableButtonSubmit():this._disableButtonSubmit())},_onInputPhoneNumberFocus:function(){this._hideFormError()},_onButtonSubmitClick:function(){this._onFormSubmit()},_onFormSubmit:function(){this._isFormValid()?(this._setButtonSubmitStateWait(!0),this._disableForm(),this._requestPayment()):this._displayFormErrors()},_isFormValid:function(){return!!this._isInputPhoneNumberValueValid()},_isInputPhoneNumberValueValid:function(){var t=this._getInputPhoneNumberValue();return t=t.replace(/[^0-9\+]/g,""),t.match(/^\+\d{10,13}$/)},_getInputPhoneNumberValue:function(){return this._elementInputPhoneNumber.val()},_displayFormErrors:function(){this._elementInputPhoneNumber.attr("error","true")},_clearFormErrors:function(){this._elementInputPhoneNumber.removeAttr("error")},_requestPayment:function(){var t=this;setTimeout(function(){i.ajax({url:l.CREATE,type:"post",dataType:"json",data:{authenticity_token:t._getAuthToken(),phone:t._getUserPhoneNumber()},success:function(e){t._onRequestPaymentSuccess(e)},error:function(e){t._onRequestPaymentError(e)}})},100)},_onRequestPaymentSuccess:function(e){t.radio("bm-popup-payment-form-sms-show-waiting-request").broadcast(),this._startStatusCheckingLoop()},_sendGAEventPaymentButtonPress:function(){},_onRequestPaymentError:function(t){t&&t.responseJSON&&(this._showFormError(t.responseJSON.error),this._sendMixpanelEventSubscriptionFailed("unexpected")),this._setButtonSubmitStateWait(!1),this._enableForm()},_getUserPhoneNumber:function(){var t=this._getInputPhoneNumberValue();return t.replace(/[^0-9]/g,"")},mixinRequestParameter:function(t){i.extend(this._mixedRequestParams,t)},_getMixedParams:function(){},_getAuthToken:function(){return this._authToken},setAuthToken:function(t){this._authToken=t},_enableButtonSubmit:function(){this._elementButtonSubmit.removeAttr("disabled")},_disableButtonSubmit:function(){this._elementButtonSubmit.attr("disabled","disabled")},_setButtonSubmitStateWait:function(t){t?(this._elementButtonSubmit.attr("wait","true"),this._disableButtonSubmit()):(this._elementButtonSubmit.removeAttr("wait"),this._enableButtonSubmit())},_hideFormError:function(){this._elementFormError.attr("hidden","hidden")},_showFormError:function(t){this._elementFormError.html(t),this._elementFormError.removeAttr("hidden")},_initInputMasks:function(){var t,e=this._elementInputPhoneNumber,n=["Z99 (999) 999-99-999","Z9 (999) 999-99-999"];i.mask.rules.Z=/[\+\d]/,i.mask.options.autoTab=!1,this._elementInputPhoneNumber.setMask(n[1]).on("keyup",function(i){t=e.val().length>18?n[0]:n[1];var o=i.which;o>=37&&40>=o||(e.unsetMask(),e.setMask(t))})},setPaymentAmount:function(t){this._paymentAmount=t},_getPaymentAmount:function(){return this._paymentAmount},_enableForm:function(){this._elementInputPhoneNumber.removeAttr("disalbed")},_disableForm:function(){this._elementInputPhoneNumber.attr("disalbed","disalbed")},setVisible:function(t){t?this.element.removeAttr("hidden"):this.element.attr("hidden","hidden")},setVisibilityHidden:function(t){t?this.element.removeAttr("visible"):this.element.attr("visible","true")},show:function(){this.isCurrentBillingSystemPlanet3()&&(this._sendNotifyOnBillingInitialized(),this._startPlanet3SmsCheckingLoop()),this._clearFormErrors(),this.element.attr("visible","true")},hide:function(){this.setVisible(!1),this.element.removeAttr("visible")},isVisible:function(){return!this.element.attr("hidden")},showBlockFields:function(){this._hideFormError(),this._elementBlockFields.removeAttr("hidden"),this._elementBlockNotSupported.attr("hidden","hidden"),this._elementBlockWaiting.attr("hidden","hidden")},showBlockNotSupported:function(){this._elementBlockFields.attr("hidden","hidden"),this._elementBlockNotSupported.removeAttr("hidden"),this._elementBlockWaiting.attr("hidden","hidden")},showBlockWaiting:function(){this._elementBlockFields.attr("hidden","hidden"),this._elementBlockNotSupported.attr("hidden","hidden"),this._elementBlockWaiting.removeAttr("hidden")},_startStatusCheckingLoop:function(){this.stopStatusCheckingLoop();var t=(new Date).getTime();this._timeoutStatus=setTimeout(function(){this._checkPaymentStatus(t)}.bind(this),4e3)},stopStatusCheckingLoop:function(){this._timeoutStatus&&(clearTimeout(this._timeoutStatus),this._timeoutStatus=null)},_checkPaymentStatus:function(t){var e=this;i.ajax({url:l.STATUS,dataType:"json",type:"get",data:{since:t},success:function(t){e._onPaymentStatusCheckSuccess(t)},error:function(){e._startStatusCheckingLoop()}})},_onPaymentStatusCheckSuccess:function(e){if(e&&e.action)switch(e.action){case a.UNACTIVE:this._startStatusCheckingLoop();break;case a.ACTIVATED:this.stopStatusCheckingLoop(),r&&r.track("Subscription Successful",{method:"sms",payment_type:"sms",type:"day"}),this.element.trigger("subscription_success",{expires_at:(new Date).getTime()+864e5});break;case a.CANCELED:this.stopStatusCheckingLoop(),t.radio("bm-popup-payment-form-sms-show-unsupported-request").broadcast(),this._sendMixpanelEventSubscriptionFailed(a.CANCELED);break;case a.USER_CANCELED:this.stopStatusCheckingLoop(),this._setButtonSubmitStateWait(!1),this._enableForm(),t.radio("bm-popup-payment-form-sms-show-fields-request").broadcast(),this._sendMixpanelEventSubscriptionFailed(a.USER_CANCELED)}},_sendMixpanelEventSubscriptionFailed:function(e){t.DIMixpanel.track("Subscription Failed",{reason:this._getMixpanelErrorReason(e),type:"day",method:"sms",payment_type:"sms"})},_sendNotifyOnBillingInitialized:function(){o("notify-on-billing-initialized").broadcast()},_getMixpanelErrorReason:function(t){var e,n=Object.prototype.hasOwnProperty;for(e in u)if(n.call(u,e)&&e===t)return u[e];return"unknown"},_checkForPlanet3CheckingLoop:function(){this.isCurrentBillingSystemInplat()?this.stopPlanet3SmsCheckingLoop():this.isCurrentBillingSystemPlanet3()&&this._startPlanet3SmsCheckingLoop()},_startPlanet3SmsCheckingLoop:function(){this._loopCheckSmsPayment=!0,this._checkPlanet3SmsPayment()},stopPlanet3SmsCheckingLoop:function(){this._loopCheckSmsPayment=!1,this._clearTimeoutCheckSmsPayment()},_checkPlanet3SmsPayment:function(){var t=this;return this.isVisible()?void i.ajax({url:"/payments/planet3/progress_v2?since="+this._planet3SinceTimestamp,type:"get",dataType:"json",success:function(){t.stopPlanet3SmsCheckingLoop(),t._onPlanet3SmsPaymentSuccess()},error:function(){t._loopCheckSmsPayment&&t._setTimeoutCheckSmsPayment(function(){t._checkPlanet3SmsPayment()})}}):void this.stopPlanet3SmsCheckingLoop()},_setTimeoutCheckSmsPayment:function(t){this._clearTimeoutCheckSmsPayment(),this._timeoutCheckPlanet3SmsPayment=setTimeout(t,d.CHECK_SMS_PAYMENT)},_clearTimeoutCheckSmsPayment:function(){this._timeoutCheckPlanet3SmsPayment&&clearTimeout(this._timeoutCheckPlanet3SmsPayment),this._timeoutCheckPlanet3SmsPayment=null},_onPlanet3SmsPaymentSuccess:function(){r&&r.track("Subscription Successful",{method:"sms",type:"month"}),setTimeout(function(){t.location.reload()},500)},useInplat:function(){this._currentPaymentSystem=c.INPLAT,this.element.attr("data-billing-system",c.INPLAT)},usePlanet3:function(){this._currentPaymentSystem=c.PLANET3,this.element.attr("data-billing-system",c.PLANET3)},isCurrentBillingSystemInplat:function(){return this.element.attr("data-billing-system")===c.INPLAT},isCurrentBillingSystemPlanet3:function(){return this.element.attr("data-billing-system")===c.PLANET3}}),e()};n.define("paymentPopup/sms",["tools","dynamicContent"],s)}(this,this.document,this.modules,this.jQuery,this.radio,this.DIMixpanel),function(t,e,n,i,o,r,s){"use strict";var a=function(e,n){var s={UNKNOWN:"unknown",VISA:"visa",MASTER_CARD:"master-card"},a={CARD_NUMBER:1,CARD_MONTH:2,CARD_YEAR:3,CARD_CVV:4},u={PRODUCTION:"MIIBCgKCAQEA6h1fodQ/743wqurzVIt7KxVwFaghXYnXcN9Bi6EuWPXarAHFBd+zeedzz1GkbunOJ512lhjwCxJronh0CPw/WyOO0XKe68tqCcEdw1+CwQpRlQM8/EwGi5AgIzU0+NYDNHFfoaxnjvVZvCxfDGUVG0/ngV0NaMDCjhE0cyYNQ8Ftyd+lk0j1xDyrnf0XEI7FB7xDBz6vw5p92YVcweObM5S6MXyWuIhsgQqjWACBGI0agFPBdjjrHPaYj8VY7/lhpEXG0Mn7nHV/8L3oj6xvZc9Aapp8LUJkMBWqXfywQspT4++XV5b8kG+AlGQ6Ug6/AwdsFYVoWQ+fzr+3K4vgVQIDAQAB",SANDBOX:"MIIBCgKCAQEArfzZR2ED5oTYxiRfVwbO9/X5DfGPwCY1YJwXtKtPQik/NZT3Q1x8Y3tKHLsa4/bh/5eNDqxEWhb+8kPIjm0jpzXUQbR/Mg1RF70x46KcYBFZX/UMOxauLi/Bre/FytWo5/RSZYw2bJVSiHhiISZXqjkVE1WR/ellP/WRNcU9LxCecDhvPhHyePVWLl7uwH8k/Y6s4DyWJJXsckPQ96CdA2nMS3byDhc/Cgtr0Wig0ca/3chOg+Awb4VmS//7iw60sRt+D5BkhX6flD7keDd/7tKfOgHdleIOn43zD6/odd9Rh32D5qDK3YpPeK/lxOivbk3+TvWEdYDqwo1AOjfvNQIDAQAB"};i.widget("custom.popupPaymentFormVisa",{_init:function(){this._elementFormItemCardNumber=this.element.find(".form-item-card-number"),this._elementInputCardNumber=this.element.find(".form-visa-input-card-number"),this._elementInputCardMonth=this.element.find(".form-visa-input-card-month"),this._elementInputCardYear=this.element.find(".form-visa-input-card-year"),this._elementInputCardCVV=this.element.find(".form-visa-input-card-cvv"),this._elementCardTypeImageWrapper=this.element.find("@card-type-image-wrapper"),this._elementButtonSubmit=this.element.find(".form-item-submit .button-submit"),this._inputCardNumberMask=null,this._inputCardMonthMask=null,this._inputCardYearMask=null,this._inputCardCVVMask=null,this._authToken=null,this._cardType=s.UNKNOWN,this._currentPlan=null,this._braintreeHandler=null,this._formErrors=[],this._elementErrorInvalidCardData=this.element.find(".form-item-submit .form-item-error"),this._initBraintree(),this._initInputMasks(),this._setupEvents()},_setupEvents:function(){var t=this;this._elementInputCardNumber.on("keyup",function(e){t._onInputCardNumberKeyUp(e)}),this._elementInputCardMonth.on("keyup",function(e){t._onInputCardMonthKeyUp(e)}),this._elementInputCardYear.on("keyup",function(e){t._onInputCardYearKeyUp(e)}),this._elementInputCardCVV.on("keyup",function(e){t._onInputCardCVVKeyUp(e)}),this._elementButtonSubmit.on("click",function(){t._onButtonSubmitClick()}),this._elementInputCardNumber.on("focus",function(){t._onInputCardNumberFocus()}),this._elementInputCardMonth.on("focus",function(){t._onInputCardMonthFocus()}),this._elementInputCardYear.on("focus",function(){t._onInputCardYearFocus()}),this._elementInputCardCVV.on("focus",function(){t._onInputCardCVVFocus()}),this._elementCardTypeImageWrapper.on("click",function(){t._onCardTypeImageWrapperClick()})},_onInputCardNumberKeyUp:function(t){var e=this._getInputCardNumberValue();return 13===t.keyCode?void this._onFormSubmit():(this._validateForm()?this._enableButtonSubmit():this._disableButtonSubmit(),void(this._isVisaNumber(e)?this._setCurrentCardType(s.VISA):this._isMasterCardNumber(e)?this._setCurrentCardType(s.MASTER_CARD):this._setCurrentCardType(s.UNKNOWN)))},_onInputCardMonthKeyUp:function(t){return 13===t.keyCode?void this._onFormSubmit():void(this._validateForm()?this._enableButtonSubmit():this._disableButtonSubmit())},_onInputCardYearKeyUp:function(t){return 13===t.keyCode?void this._onFormSubmit():void(this._validateForm()?this._enableButtonSubmit():this._disableButtonSubmit())},_onInputCardCVVKeyUp:function(t){return 13===t.keyCode?void this._onFormSubmit():void(this._validateForm()?this._enableButtonSubmit():this._disableButtonSubmit())},_onButtonSubmitClick:function(){this._onFormSubmit()},_onInputCardNumberFocus:function(){this._setInputCardNumberStateError(!1)},_onInputCardMonthFocus:function(){this._setInputCardMonthStateError(!1)},_onInputCardYearFocus:function(){this._setInputCardYearStateError(!1)},_onInputCardCVVFocus:function(){this._setInputCardCVVStateError(!1)},_onCardTypeImageWrapperClick:function(){try{(BM.config.isDevelopment()||BM.config.isStaging())&&(this._elementInputCardNumber.val("4111111111111111"),this._elementInputCardNumber.trigger("keyup"),this._elementInputCardMonth.val("11"),this._elementInputCardMonth.trigger("keyup"),this._elementInputCardYear.val("14"),this._elementInputCardYear.trigger("keyup"),this._elementCardTypeImageWrapper.find(".card-type-image").css({"background-image":"url(https://bookmate.slack.com/emoji/frontendilissimus/be31d38524f9f6fb.jpg)","background-size":"auto 80%",width:"100%",height:"100%","background-position":"50%"}))}catch(t){}},_onFormSubmit:function(){this._clearFormErrors(),this._validateForm()?this._sendRequestSubscribe():this._displayFormErrors()},_validateForm:function(){return this._formErrors=[],this._validateCardNumber()||this._formErrors.push(a.CARD_NUMBER),this._validateCardMonth()||this._formErrors.push(a.CARD_MONTH),this._validateCardYear()||this._formErrors.push(a.CARD_YEAR),this._elementInputCardCVV.length&&!this._validateCardCVV()&&this._formErrors.push(a.CARD_CVV),0===this._formErrors.length},_displayFormErrors:function(){-1!==this._formErrors.indexOf(a.CARD_NUMBER)&&this._setInputCardNumberStateError(!0),-1!==this._formErrors.indexOf(a.CARD_MONTH)&&this._setInputCardMonthStateError(!0),-1!==this._formErrors.indexOf(a.CARD_YEAR)&&this._setInputCardYearStateError(!0),-1!==this._formErrors.indexOf(a.CARD_CVV)&&this._setInputCardCVVStateError(!0)},_clearFormErrors:function(){this._formErrors.length=0,this._formErrors=[],this._setInputCardNumberStateError(!1),this._setInputCardMonthStateError(!1),this._setInputCardYearStateError(!1),this._setInputCardCVVStateError(!1),this._hideRequestSubscribeError()},_enableButtonSubmit:function(){this._elementButtonSubmit.removeAttr("disabled")},_disableButtonSubmit:function(){this._elementButtonSubmit.attr("disabled","disabled")},_setInputCardNumberStateError:function(t){this._setInputStateError(this._elementInputCardNumber,t)},_setInputCardMonthStateError:function(t){this._setInputStateError(this._elementInputCardMonth,t)},_setInputCardYearStateError:function(t){this._setInputStateError(this._elementInputCardYear,t)},_setInputCardCVVStateError:function(t){this._setInputStateError(this._elementInputCardCVV,t)},_setInputStateError:function(t,e){e?t.attr("error","true"):t.removeAttr("error")},_validateCardNumber:function(){var t=this._getInputCardNumberValue();return t.length>=15&&t.length<=16},_validateCardMonth:function(){var t=this._getInputCardMonthValue();return t&&12>=t},_validateCardYear:function(){var t=this._getInputCardYearValue();return!!t},_validateCardCVV:function(){var t=this._getInputCardCVVValue();return!!t},_sendRequestSubscribe:function(){this._setFormWait(!0),this._sendGAEventPaymentButtonPress(),this._sendNotifyOnBillingInitialized();var t=this;i.ajax({type:"POST",url:"/payments/braintree",data:this._getPostData(),dataType:"json",success:function(e){t._onSubscribeSuccess(e)},error:function(e){t._handleSubscribeError(e.responseJSON)}})},_onSubscribeSuccess:function(t){this._setFormWait(!1),this.element.trigger("subscription_success",t)},_reloadPage:function(){t.location.reload()},_handleSubscribeError:function(t){this._showRequestSubscribeError(t),this._setFormWait(!1),this.element.trigger("subscription_error")},_setFormWait:function(t){this._setFormElementDisabled(this._elementInputCardNumber,t),this._setFormElementDisabled(this._elementInputCardMonth,t),this._setFormElementDisabled(this._elementInputCardYear,t),this._setFormElementDisabled(this._elementInputCardCVV,t),this._setFormElementDisabled(this._elementButtonSubmit,t),t?this._elementButtonSubmit.attr("wait","true"):this._elementButtonSubmit.removeAttr("wait")},_setFormElementDisabled:function(t,e){e?t.attr("disabled","disabled"):t.removeAttr("disabled")},_showRequestSubscribeError:function(t){t&&t.errors&&(BM.tools.isArray(t.errors)?this._elementErrorInvalidCardData.html(t.errors[0]):BM.tools.isString(t.errors)&&t.errors.indexOf("<br>")>-1?this._elementErrorInvalidCardData.html(t.errors.split("<br>").slice(-1)):this._elementErrorInvalidCardData.html(t.errors)),this._elementErrorInvalidCardData.removeAttr("hidden"),this._elementErrorInvalidCardData.removeAttr("hidden")},_hideRequestSubscribeError:function(){this._elementErrorInvalidCardData.attr("hidden","hidden")},_getPostData:function(){var t={authenticity_token:this._getAuthToken(),braintree:{plan:this._getCurrentPlan(),number:this._braintreeHandler.encrypt(this._getInputCardNumberValue()),month:this._braintreeHandler.encrypt(this._getInputCardMonthValue()),year:this._braintreeHandler.encrypt(this._getInputCardYearValue()),device_data:BM.helper.braintree.deviceData()}};return i.param(t)},_getPostDataWithNonce:function(t){var e=t&&t.success?t.success:function(){},n=t&&t.error?t.error:function(){},i=this._getInputCardNumberValue(),o=this._getInputCardMonthValue(),r=this._getInputCardYearValue(),s=this._getInputCardCVVValue(),a={number:i,expirationDate:o+"/"+r},u={authenticity_token:this._getAuthToken(),braintree:{plan:this._getCurrentPlan(),number:this._braintreeHandler.encrypt(this._getInputCardNumberValue()),month:this._braintreeHandler.encrypt(this._getInputCardMonthValue()),year:this._braintreeHandler.encrypt(this._getInputCardYearValue()),device_data:BM.helper.braintree.deviceData()}};this._elementInputCardCVV.length&&(a.cvv=s,u.braintree.cvv=this._braintreeHandler.encrypt(this._getInputCardCVVValue())),BM.helper.braintree.getCreditCardNonce({data:a,success:function(t){u.braintree.payment_method_nonce=t,e(u)}.bind(this),error:n})},_isVisaNumber:function(t){return/^4/.test(t)},_isMasterCardNumber:function(t){return/^5[1-5]/.test(t)},_setCurrentCardType:function(t){this._cardType=t,this._elementFormItemCardNumber.attr("data-card-type",t)},setCurrentPlan:function(t){n.isUndefined(t)||(this._currentPlan=t)},_getCurrentPlan:function(){return this._currentPlan},_getInputCardNumberValue:function(){return this._elementInputCardNumber.val().replace(/ /g,"")},_getInputCardMonthValue:function(){return parseInt(this._elementInputCardMonth.val(),10)},_getInputCardYearValue:function(){return parseInt(this._elementInputCardYear.val(),10)},_getInputCardCVVValue:function(){return this._elementInputCardCVV.val()},_initBraintree:function(){var t=this;return o?void(this._braintreeHandler=o.create(this._getBraintreeKey())):void setTimeout(function(){t._initBraintree()},100)},_getBraintreeKey:function(){var t=i("body").attr("data-config");try{t=JSON.parse(t)}catch(e){return u.SANDBOX}return"production"===t.environment?u.PRODUCTION:u.SANDBOX},_initInputMasks:function(){n.isNull(this._inputCardNumberMask)&&(this._inputCardNumberMask=this._elementInputCardNumber.setMask({mask:"9999 9999 9999 9999",maxLength:16,autoTab:!1,setSize:16})),n.isNull(this._inputCardMonthMask)&&(this._inputCardNumberMask=this._elementInputCardMonth.setMask({mask:"99",maxLength:2,autoTab:!1,setSize:2})),n.isNull(this._inputCardYearMask)&&(this._inputCardNumberMask=this._elementInputCardYear.setMask({
mask:"99",maxLength:2,autoTab:!1,setSize:2})),n.isNull(this._inputCardCVVMask)&&(this._inputCardNumberMask=this._elementInputCardCVV.setMask({mask:"9999",maxLength:4,autoTab:!1,setSize:3}))},_sendGAEventPaymentButtonPress:function(){r&&r("bookmate-subscription-ga-payment-button-pressed-event").broadcast()},_sendNotifyOnBillingInitialized:function(){r("notify-on-billing-initialized").broadcast()},setAuthToken:function(t){this._authToken=t},_getAuthToken:function(){return this._authToken},setVisible:function(t){t?this.element.removeAttr("hidden"):this.element.attr("hidden","hidden")},show:function(){this._clearFormErrors(),this.element.attr("visible","true")},hide:function(){this.setVisible(!1),this.element.removeAttr("visible")},isVisible:function(){return!this.element.attr("hidden")},getElement:function(){return this.element}}),e()};n.define("paymentPopup/visa",["tools"],a)}(this,this.document,this.modules,this.jQuery,this.Braintree,this.radio),function(t,e,n,i){"use strict";n.define("FriendSuggestionFbConnectItemProcessor",["modules","TemplateFactory"],function(t,e,n){var i=function(){var t=this;t.templateFactory=new n("#friend-suggestion-card-fb-connect-template")};i.prototype={getItem:function(t){var e=this,n=e.templateFactory.getInstance();return n}},t(new i)})}(this,this.jQuery,this.modules,this.BM),function(t,e,n){"use strict";n.define("FriendSuggestionFbConnectView",["extend","FriendSuggestionBaseCardView","FriendSuggestionFbConnectItemProcessor"],function(e,n,i,o){var r=n(i);BM.tools.mixin(r.prototype,{_setItemProcessor:function(){this.itemProcessor=o},_initListeners:function(){var e=this;e.$b.find(".bm-friend-suggestion-card-action").on("click",function(e){t.open("/auth/facebook","","width=600,height=260");DIMixpanel.track("Find Friend Initiated",{context:"suggestion-card",source:"Facebook"})})}}),e(r)})}(this,this.jQuery,this.modules),function(t,e,n,i){"use strict";n.define("FriendSuggestionTwConnectItemProcessor",["modules","TemplateFactory"],function(t,e,n){var i=function(){var t=this;t.templateFactory=new n("#friend-suggestion-card-tw-connect-template")};i.prototype={getItem:function(t){var e=this,n=e.templateFactory.getInstance();return n}},t(new i)})}(this,this.jQuery,this.modules,this.BM),function(t,e,n){"use strict";n.define("FriendSuggestionTwConnectView",["extend","FriendSuggestionBaseCardView","FriendSuggestionTwConnectItemProcessor"],function(e,n,i,o){var r=n(i);BM.tools.mixin(r.prototype,{_setItemProcessor:function(){this.itemProcessor=o},_initListeners:function(){var e=this;e.$b.find(".bm-friend-suggestion-card-action").on("click",function(e){t.open("/auth/twitter","","width=760,height=380");DIMixpanel.track("Find Friend Initiated",{context:"suggestion-card",source:"Twitter"})})}}),e(r)})}(this,this.jQuery,this.modules),function(t,e,n,i){"use strict";n.define("FriendSuggestionVkConnectItemProcessor",["modules","TemplateFactory"],function(t,e,n){var i=function(){var t=this;t.templateFactory=new n("#friend-suggestion-card-vk-connect-template")};i.prototype={getItem:function(t){var e=this,n=e.templateFactory.getInstance();return n}},t(new i)})}(this,this.jQuery,this.modules,this.BM),function(t,e,n){"use strict";n.define("FriendSuggestionVkConnectView",["extend","FriendSuggestionBaseCardView","FriendSuggestionVkConnectItemProcessor"],function(e,n,i,o){var r=n(i);BM.tools.mixin(r.prototype,{_setItemProcessor:function(){this.itemProcessor=o},_initListeners:function(){var e=this;e.$b.find(".bm-friend-suggestion-card-action").on("click",function(e){t.open("/auth/vkontakte","","width=600,height=260");DIMixpanel.track("Find Friend Initiated",{context:"suggestion-card",source:"VK"})})}}),e(r)})}(this,this.jQuery,this.modules),function(t,e,n){var i=n.config||{},o=e.body.getAttribute("data-config"),r=JSON.parse(o)||{};r.assetHost||"";i.loadScriptsConfig={"default":function(){modules.require("ui-modules")},"index-aviasales":function(){},"promo-subscriptions":function(){modules.require("ui-modules"),modules.require("promoCodeInit")},"reader-index":function(){modules.require("ui-modules"),modules.require("moduleReaderInit")},"app_landing-index":function(){modules.require("ui-modules"),modules.require("appLandingInit")},"ulmart_terminal-index":function(){modules.require("ui-modules"),modules.require("appLandingInit")},"action_landing-index":function(){modules.require("ui-modules"),modules.require("appLandingInit")},"lonely_users-index":function(){modules.require("ui-modules"),modules.require("lonelyUsersInit")},__expample:function(){modules.require("libraryInit"),logTimeAfterPartnerScript()},aboutbook:function(){modules.require("ui-modules"),modules.require("bookpageInit")},"show-subscriptions":function(){modules.require("ui-modules"),modules.require("subscriptionsInit")},"index-index":function(){modules.require("ui-modules"),modules.require("indexInit"),modules.require("indexSetup")},"old_index-index":function(){modules.require("ui-modules"),modules.require("indexInit")},"index-library":function(){modules.require("ui-modules"),modules.require("indexInit")},"bigbook2015-library":function(){modules.require("ui-modules"),modules.require("libraryBigbook2015Init")},"yap2015-library":function(){modules.require("ui-modules"),modules.require("libraryYap2015Init")},"index-users/bookshelves":function(){modules.require("ui-modules"),modules.require("moduleIndexBookshelvesInit")},"index-bookshelves":function(){modules.require("ui-modules"),modules.require("bookshelvesInit")},"editorial-bookshelves":function(){modules.require("ui-modules"),modules.require("bookshelvesInit")},"mine-bookshelves":function(){modules.require("ui-modules"),modules.require("bookshelvesInit")},"show-bookshelves":function(){modules.require("ui-modules"),modules.require("bookshelfInit")},"new-bookshelves":function(){modules.require("ui-modules"),modules.require("bookshelfInit")},"popular-library":function(){modules.require("ui-modules"),modules.require("libraryInit")},"recommendations-library":function(){modules.require("ui-modules"),modules.require("libraryInit")},"stats_2014-library":function(){modules.require("ui-modules"),modules.require("stats2014Init")},"stats_2015-library":function(){modules.require("ui-modules"),modules.require("stats2015Init")},"school-library":function(){modules.require("ui-modules"),modules.require("initLibrarySchool")},"psychologies-partners":function(){modules.require("ui-modules"),modules.require("psychologiesInit")},"profitrolly-partners":function(){modules.require("ui-modules"),modules.require("profitrollyInit")},"edit-users/profile":function(){modules.require("ui-modules"),modules.require("profileSettingsInit")},"following-users/bookshelves":function(){modules.require("ui-modules"),modules.require("userBookshelvesFollowingInit")},new_user_landing:function(){modules.require("ui-modules"),modules.require("newUserLandingInit")},"show-partners/tele2":function(){modules.require("ui-modules"),modules.require("mobileGenericInit")},"ulmart-partners":function(){},"index-friends":function(){modules.require("ui-modules"),modules.require("activityInit")},"index-explore":function(){modules.require("ui-modules"),modules.require("exploreInit")},"paywall-subscriptions":function(){modules.require("ui-modules"),modules.require("paywallInit")},"paypal-partners":function(){modules.require("ui-modules"),modules.require("partnersPayPalSubscription")},"vdnh-partners":function(){modules.require("ui-modules"),modules.require("preloadForWifiInit")},"bibirevo-partners":function(){modules.require("ui-modules"),modules.require("preloadForWifiInit")},"new-auth/signup":function(){modules.require("ui-modules"),modules.require("initSignupPage")},libraryCards:function(){modules.require("ui-modules"),modules.require("initLibraryCards"),modules.require("moduleUserLibraryInit")},"uploads-users/index":function(){modules.require("ui-modules"),modules.require("initLibraryCards"),modules.require("moduleUserLibraryInit")},zendesk_login:function(){modules.require("ui-modules"),modules.require("initZendeskLoginPage")},zendesk_ask_email:function(){modules.require("ui-modules"),modules.require("initZendeskAskEmailPage")},"discount-subscriptions":function(){modules.require("ui-modules"),modules.require("initDiscountPage")},"index-about":function(){modules.require("ui-modules"),modules.require("initAboutPage")},"legal-about":function(){modules.require("ui-modules"),modules.require("initAboutLegal")},"ulmart_recurring_paywall-partners":function(){modules.require("ui-modules"),modules.require("initUlmartRecurringPaywallPage")},"ulmart_three_months-partners":function(){DIMixpanel.track("Ulmart Promo User Landed")},"starhub-partners":function(){modules.require("ui-modules"),modules.require("initBooktiquePage")},"press-about":function(){modules.require("ui-modules"),modules.require("initAboutPress")},"index-iwillread":function(){modules.require("ui-modules"),modules.require("iwillreadInit")},"index-gifts":function(){modules.require("ui-modules"),modules.require("giftsInit")},"index-mailing":function(){modules.require("ui-modules"),modules.require("mailingInit")},"show-partners/mobile_operators/megafon_volga_region":function(){modules.require("ui-modules"),modules.require("megafonInit")},"show-partners/mobile_operators/beeline_siberia":function(){modules.require("ui-modules"),modules.require("beelineInit")},"show-partners/mobile_operators/tele2ee":function(){modules.require("ui-modules"),modules.require("tele2eeInit")},"show-partners/mobile_operators/tele2":function(){modules.require("ui-modules"),modules.require("tele2Init")},"show-users/quotes":function(){modules.require("ui-modules"),modules.require("quoteItemPageInit")},"index-users/quotes":function(){modules.require("ui-modules"),modules.require("quotesListPageInit")},"show-books/impressions":function(){modules.require("ui-modules"),modules.require("impressionPageInit")},"show-partners/mobile_operators/mts_by":function(){modules.require("ui-modules"),modules.require("mtsbelorusInit")},"following-users/friends":function(){modules.require("ui-modules"),modules.require("userFollowingInit")},"followers-users/friends":function(){modules.require("ui-modules"),modules.require("userFollowersInit")},"show-partners/mobile_operators/kyivstar":function(){modules.require("ui-modules"),modules.require("kievstarInit")},"show-partners/mobile_operators/azercell":function(){modules.require("ui-modules"),modules.require("azercellInit")},"show-partners/mobile_operators/cipika":function(){modules.require("ui-modules"),modules.require("cipikaInit")},"show-partners/mobile_operators/t_mobile":function(){modules.require("ui-modules"),modules.require("tMobileInit")},"show-partners/mobile_operators/kcell":function(){modules.require("ui-modules"),modules.require("kcellInit")},"show-referral":function(){modules.require("ui-modules"),modules.require("referralInit")},"index-giftsfromskyeng":function(){modules.require("ui-modules"),modules.require("skyengInit")},"show-partners_gift":function(){modules.require("ui-modules"),modules.require("netologyInit")},"index-specialios":function(){modules.require("ui-modules"),modules.require("specialiosInit")}}}(this,this.document,this.BM=this.BM||{}),function(t,e,n){var i=n.tools=n.tools||{},o=n.config=n.config||{},r=function(t){var e=o.loadScriptsConfig;e.hasOwnProperty(t)?e[t]():e["default"]()};i.loadScripts=r}(this,this.document,this.BM=this.BM||{}),function(t,e,n){"use strict";var i=n.tools=n.tools||{},o=n.config=n.config||{},r=e.body.getAttribute("data-scripts"),s=r||o.mainConfig.action+"-"+o.mainConfig.scriptTemplate;console.enable(),i.loadScripts(s)}(this,this.document,this.BM||{});